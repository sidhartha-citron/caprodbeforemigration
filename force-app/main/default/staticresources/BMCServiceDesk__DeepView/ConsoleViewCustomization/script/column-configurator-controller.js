(function(){var a=angular.module("consoleColumnConfiguModule",["ui.sortable","ui.sortable.multiselection","ngSanitize"]);angular.module("consoleColumnConfiguModule").controller("ConsoleColumnConfiguratorController",["$scope","consoleColumnConfiguratorService","uiSortableMultiSelectionMethods",function(b,c,d){b.state={savingConfiguration:false};b._labels=_labels;b.isServiceRequest=isServiceRequest;b.identifierField={};b.modulename=modulename;b.maxColumns=maxColumns;if(b.maxColumns){b.maxSelectedColumn=b.maxColumns-1}else{b.maxSelectedColumn=14}b.configParams={modulename:b.modulename,isServiceRequest:b.isServiceRequest};b.showMask=function(){$("#sideBarloader").css("display","block");$("#sideBarActionMask").css("display","block")};b.hideMask=function(){$("#sideBarloader").css("display","none");$("#sideBarActionMask").css("display","none")};b.showMask();c.getConsoleViewConfigurationMethod("getSelectedColumns",b.configParams).then(function(e){b.selectedColumns=e;if(!b.selectedColumns){b.selectedColumns=[]}b.removeSelected();var f=JSON.stringify(b.selectedColumns);if(f&&f.indexOf("RF_Attachments__c")!=-1){b.maxSelectedColumn++}});c.getConsoleViewConfigurationMethod("getAvailableColumns",b.configParams).then(function(e){b.availableColumns=e;b.removeSelected()});b.removeSelected=function(){if(b.selectedColumns&&b.availableColumns){if(b.selectedColumns.length==1){var g=b.availableColumns.slice(0,b.maxSelectedColumn);b.selectedColumns=b.selectedColumns.concat(g);var l=JSON.stringify(b.selectedColumns);if(l&&l.indexOf("RF_Attachments__c")!=-1){b.maxSelectedColumn++}b.availableColumns.splice(0,b.maxSelectedColumn)}var e=[];var f=[];if(b.availableColumns.length==0){for(var h=0;h<b.selectedColumns.length;h++){if(b.selectedColumns[h].APIName.toLowerCase()=="name"&&f.indexOf(h)==-1){b.identifierField=b.selectedColumns[h];f.push(h)}}}else{for(var k=b.availableColumns.length-1;k>=0;k--){for(var h=0;h<b.selectedColumns.length;h++){if(b.selectedColumns[h].APIName.toLowerCase()=="name"&&f.indexOf(h)==-1){b.identifierField=b.selectedColumns[h];f.push(h)}if(b.availableColumns[k]&&(b.availableColumns[k].APIName==b.selectedColumns[h].APIName)&&e.indexOf(k)==-1){e.push(k)}}if(b.availableColumns[k].APIName.toLowerCase()=="name"&&e.indexOf(k)==-1){e.push(k)}}}if(f.length>0){f.sort(function(j,i){return j==i?0:i>j?1:-1});angular.forEach(f,function(i){b.selectedColumns.splice(i,1)})}if(e.length>0){e.sort(function(j,i){return j==i?0:i>j?1:-1});angular.forEach(e,function(i){b.availableColumns.splice(i,1)})}b.hideMask();b.sortSelectedColumns()}};b.selectedItemsInAvailableFields=[];b.selectedItemsInSelectedFields=[];b.moveRight=function(h){var j=angular.element("#availableColumns").find(".ui-sortable-selected");b.selectedItemsInAvailableFields=[];var f=false;angular.forEach(j,function(k){var i;for(i=0;i<b.availableColumns.length;i++){if(k.id==b.availableColumns[i].APIName){b.selectedItemsInAvailableFields.push(i);if(b.availableColumns[i].APIName.indexOf("RF_Attachments__c")!=-1){b.maxSelectedColumn++;f=true}}}});if(b.selectedItemsInAvailableFields.length>0){var e=[];b.selectedItemsInAvailableFields.sort(function(k,i){return k==i?0:i>k?1:-1});if((b.selectedColumns.length+b.selectedItemsInAvailableFields.length)<=b.maxSelectedColumn){angular.forEach(b.selectedItemsInAvailableFields,function(i){if(b.selectedColumns.length<b.maxSelectedColumn){e.push(b.availableColumns[i]);b.availableColumns.splice(i,1)}});var g;for(g=e.length-1;g>=0;g--){b.selectedColumns.push(e[g])}}else{if(f){b.maxSelectedColumn--}}b.selectedItemsInAvailableFields=[]}};b.getSelectedIndices=function(){var f=angular.element("#selectedColumns").find(".ui-sortable-selected");var e=[];angular.forEach(f,function(h){var g;for(g=0;g<b.selectedColumns.length;g++){if(h.id==b.selectedColumns[g].APIName){e.push(g)}}});return e};b.moveLeft=function(g){b.selectedItemsInSelectedFields=[];b.selectedItemsInSelectedFields=b.getSelectedIndices();if(b.selectedItemsInSelectedFields.length>0){var e=[];b.selectedItemsInSelectedFields.sort(function(i,h){return i==h?0:h>i?1:-1});angular.forEach(b.selectedItemsInSelectedFields,function(h){e.push(b.selectedColumns[h]);if(b.selectedColumns[h].APIName.indexOf("RF_Attachments__c")!=-1){b.maxSelectedColumn--}b.selectedColumns.splice(h,1)});var f;for(f=e.length-1;f>=0;f--){b.availableColumns.push(e[f])}b.selectedItemsInSelectedFields=[];b.sortSelectedColumns()}};b.moveUp=function(e){b.selectedItemsInSelectedFields=[];b.selectedItemsInSelectedFields=b.getSelectedIndices();if(b.selectedItemsInSelectedFields.length>0){b.selectedItemsInSelectedFields.sort(function(h,g){return h==g?0:g>h?-1:1});var f=0;angular.forEach(b.selectedItemsInSelectedFields,function(g){if(g>0){var h=g-1;for(h;h>=0;h--){if(b.selectedItemsInSelectedFields.indexOf(h)==-1){break}}if(h>=0){var j=b.selectedColumns[g];b.selectedColumns[g]=b.selectedColumns[g-1];b.selectedColumns[g-1]=j;b.selectedItemsInSelectedFields[f]=g-1}}f=f+1})}};b.moveDown=function(e){b.selectedItemsInSelectedFields=[];b.selectedItemsInSelectedFields=b.getSelectedIndices();if(b.selectedItemsInSelectedFields.length>0){b.selectedItemsInSelectedFields.sort(function(h,g){return h==g?0:g>h?1:-1});var f=0;angular.forEach(b.selectedItemsInSelectedFields,function(g){if(g<b.selectedColumns.length-1){var h=g+1;for(h;h<b.selectedColumns.length;h++){if(b.selectedItemsInSelectedFields.indexOf(h)==-1){break}}if(h<b.selectedColumns.length){var j=b.selectedColumns[g];b.selectedColumns[g]=b.selectedColumns[g+1];b.selectedColumns[g+1]=j;b.selectedItemsInSelectedFields[f]=g+1}}f=f+1})}};b.moveTop=function(){b.selectedItemsInSelectedFields=[];b.selectedItemsInSelectedFields=b.getSelectedIndices();if(b.selectedItemsInSelectedFields.length>0){var e=0;b.selectedItemsInSelectedFields.sort(function(h,g){return h==g?0:g>h?-1:1});angular.forEach(b.selectedItemsInSelectedFields,function(g){var j=b.selectedColumns[g];var h=g;for(h;h>e;h--){b.selectedColumns[h]=b.selectedColumns[h-1]}b.selectedColumns[e]=j;e=e+1});var f=0;b.selectedItemsInSelectedFields=[];for(f;f<e;f++){b.selectedItemsInSelectedFields.push(f)}}};b.moveBottom=function(){b.selectedItemsInSelectedFields=[];b.selectedItemsInSelectedFields=b.getSelectedIndices();if(b.selectedItemsInSelectedFields.length>0){var e=b.selectedColumns.length-1;b.selectedItemsInSelectedFields.sort(function(h,g){return h==g?0:g>h?1:-1});angular.forEach(b.selectedItemsInSelectedFields,function(g){var j=b.selectedColumns[g];var h=g+1;for(h;h<=e;h++){b.selectedColumns[h-1]=b.selectedColumns[h]}b.selectedColumns[e]=j;e=e-1})}var f=e+1;b.selectedItemsInSelectedFields=[];for(f;f<b.selectedColumns.length;f++){b.selectedItemsInSelectedFields.push(f)}};b.maxSelectedColumnUpdate=true;b.sortableOptionsList=d.extendOptions({connectWith:".sortable-data-container",update:function(e,f){if(f.item.sortable.source[0]!==f.item.sortable.droptarget[0]&&"availableColumns"==f.item.sortable.source[0].id&&b.maxSelectedColumnUpdate){if(f.item.sortable.model&&f.item.sortable.model.APIName&&f.item.sortable.model.APIName.indexOf("RF_Attachments__c")!=-1){b.maxSelectedColumn++;b.maxSelectedColumnUpdate=false}if(f.item.sortable.droptargetModel.length>=b.maxSelectedColumn){f.item.sortable.cancel()}if(f.item.sortableMultiSelect.selectedModels&&f.item.sortableMultiSelect.selectedModels.length>1){if((f.item.sortableMultiSelect.selectedModels.length+f.item.sortable.droptargetModel.length)>=b.maxSelectedColumn){f.item.sortable.cancel()}}}else{if(f.item.sortable.source[0].id=="selectedColumns"&&(f.item.sortable.model&&f.item.sortable.model.APIName&&f.item.sortable.model.APIName.indexOf("RF_Attachments__c")!=-1)&&b.maxSelectedColumnUpdate){b.maxSelectedColumn--;b.maxSelectedColumnUpdate=false}else{b.maxSelectedColumnUpdate=true}}if(f.item.sortable.source[0].id==f.item.sortable.droptarget[0].id&&"availableColumns"==f.item.sortable.source[0].id){f.item.sortable.cancel()}}});b.sortSelectedColumns=function(){var e=[];if(b.selectedItemsInAvailableFields.length>0){angular.forEach(b.selectedItemsInAvailableFields,function(f){e.push(b.availableColumns[f].APIName)});b.selectedItemsInAvailableFields=[]}b.availableColumns.sort(function(g,f){return g.fieldLabel==f.fieldLabel?0:f.fieldLabel>g.fieldLabel?-1:1});if(e.length>0){angular.forEach(e,function(g){var f;for(f=0;f<b.availableColumns.length;f++){if(b.availableColumns[f].APIName==g){b.selectedItemsInAvailableFields.push(f)}}})}};b.cancel=function(){if(window.parent&&typeof window.parent.closeColumnConfigWindow=="function"){window.parent.closeColumnConfigWindow()}};b.submit=function(){var f={};console.log(b.availableColumns);console.log(b.selectedColumns);b.showMask();b.selectedColumnsByUser="[";var e=0;angular.forEach(b.selectedColumns,function(g){if(e<b.maxSelectedColumn){if(b.selectedColumnsByUser!="["){b.selectedColumnsByUser=b.selectedColumnsByUser+","}b.selectedColumnsByUser=b.selectedColumnsByUser+'{"name":"'+g.APIName+'"}'}e++});b.selectedColumnsByUser=b.selectedColumnsByUser+"]";b.configParams.userselection=b.selectedColumnsByUser;c.getConsoleViewConfigurationMethod("setSelectedColumns",b.configParams).then(function(g){if(window.parent&&typeof window.parent.closeColumnConfigWindow=="function"){window.parent.saveColumnConfigWindow()}b.hideMask()})}}]);angular.module("consoleColumnConfiguModule").service("consoleColumnConfiguratorService",["$q",function(b){this.getConsoleViewConfigurationMethod=function(e,c){var d=b.defer();Visualforce.remoting.Manager.invokeAction(_RemotingActions.getConsoleViewConfigurationMethod,e,c,function(f,g){if(g.status){d.resolve(f)}else{d.reject()}});return d.promise}}])})();