(function(){var a=angular.module("ui.grid.selection",["ui.grid"]);a.constant("uiGridSelectionConstants",{featureName:"selection",selectionRowHeaderColName:"selectionRowHeaderCol"});angular.module("ui.grid").config(["$provide",function(b){b.decorator("GridRow",["$delegate",function(c){c.prototype.setSelected=function(d){if(d!==this.isSelected){this.isSelected=d;this.grid.selection.selectedCount+=d?1:-1}};c.prototype.setFocused=function(d){if(d!==this.isFocused){this.grid.selection.focusedRow&&(this.grid.selection.focusedRow.isFocused=false);this.grid.selection.focusedRow=d?this:null;this.isFocused=d}};return c}])}]);a.service("uiGridSelectionService",function(){var b={initializeGrid:function(c){c.selection={lastSelectedRow:null,focusedRow:null,selectAll:false};c.selection.selectedCount=0;b.defaultGridOptions(c.options);var d={events:{selection:{rowFocusChanged:function(f,g,e){},rowSelectionChanged:function(f,g,e){},rowSelectionChangedBatch:function(f,g,e){}}},methods:{selection:{toggleRowSelection:function(f,e){var g=c.getRow(f);if(g!==null){b.toggleRowSelection(c,g,e,c.options.multiSelect,c.options.noUnselect)}},selectRow:function(f,e){var g=c.getRow(f);if(g!==null&&!g.isSelected){b.toggleRowSelection(c,g,e,c.options.multiSelect,c.options.noUnselect)}},selectRowByVisibleIndex:function(g,e){var f=c.renderContainers.body.visibleRowCache[g];if(f!==null&&typeof(f)!=="undefined"&&!f.isSelected){b.toggleRowSelection(c,f,e,c.options.multiSelect,c.options.noUnselect)}},unSelectRow:function(f,e){var g=c.getRow(f);if(g!==null&&g.isSelected){b.toggleRowSelection(c,g,e,c.options.multiSelect,c.options.noUnselect)}},unSelectRowByVisibleIndex:function(g,e){var f=c.renderContainers.body.visibleRowCache[g];if(f!==null&&typeof(f)!=="undefined"&&f.isSelected){b.toggleRowSelection(c,f,e,c.options.multiSelect,c.options.noUnselect)}},selectAllRows:function(e){if(c.options.multiSelect!==false){var f=[];c.rows.forEach(function(g){if(!g.isSelected&&g.enableSelection!==false&&c.options.isRowSelectable(g)!==false){g.setSelected(true);b.decideRaiseSelectionEvent(c,g,f,e)}});c.selection.selectAll=true;b.decideRaiseSelectionBatchEvent(c,f,e)}},selectAllVisibleRows:function(e){if(c.options.multiSelect!==false){var f=[];c.rows.forEach(function(g){if(g.visible){if(!g.isSelected&&g.enableSelection!==false&&c.options.isRowSelectable(g)!==false){g.setSelected(true);b.decideRaiseSelectionEvent(c,g,f,e)}}else{if(g.isSelected){g.setSelected(false);b.decideRaiseSelectionEvent(c,g,f,e)}}});c.selection.selectAll=true;b.decideRaiseSelectionBatchEvent(c,f,e)}},clearSelectedRows:function(e){b.clearSelectedRows(c,e)},getSelectedRows:function(){return b.getSelectedRows(c).map(function(e){return e.entity}).filter(function(e){return e.hasOwnProperty("$$hashKey")||!angular.isObject(e)})},getSelectedGridRows:function(){return b.getSelectedRows(c)},getSelectedCount:function(){return c.selection.selectedCount},setMultiSelect:function(e){c.options.multiSelect=e},setModifierKeysToMultiSelect:function(e){c.options.modifierKeysToMultiSelect=e},getSelectAllState:function(){return c.selection.selectAll}}}};c.api.registerEventsFromObject(d.events);c.api.registerMethodsFromObject(d.methods)},defaultGridOptions:function(c){c.enableRowSelection=c.enableRowSelection!==false;c.multiSelect=c.multiSelect!==false;c.noUnselect=c.noUnselect===true;c.modifierKeysToMultiSelect=c.modifierKeysToMultiSelect===true;c.enableRowHeaderSelection=c.enableRowHeaderSelection!==false;if(typeof(c.enableFullRowSelection)==="undefined"){c.enableFullRowSelection=!c.enableRowHeaderSelection}c.enableFocusRowOnRowHeaderClick=(c.enableFocusRowOnRowHeaderClick!==false)||!c.enableRowHeaderSelection;c.enableSelectRowOnFocus=(c.enableSelectRowOnFocus!==false);c.enableSelectAll=c.enableSelectAll!==false;c.enableSelectionBatchEvent=c.enableSelectionBatchEvent!==false;c.selectionRowHeaderWidth=angular.isDefined(c.selectionRowHeaderWidth)?c.selectionRowHeaderWidth:30;c.enableFooterTotalSelected=c.enableFooterTotalSelected!==false;c.isRowSelectable=angular.isDefined(c.isRowSelectable)?c.isRowSelectable:angular.noop},toggleRowSelection:function(d,i,c,h,f){if(i.enableSelection===false){return}var e=i.isSelected,g;if(!h){if(!e){b.clearSelectedRows(d,c)}else{g=b.getSelectedRows(d);if(g.length>1){e=false;b.clearSelectedRows(d,c)}}}if(!(e&&f)){i.setSelected(!e);if(i.isSelected===true){d.selection.lastSelectedRow=i}g=b.getSelectedRows(d);d.selection.selectAll=d.rows.length===g.length;d.api.selection.raise.rowSelectionChanged(i,c)}},shiftSelect:function(c,m,l,e){if(!e){return}var f=b.getSelectedRows(c);var d=f.length>0?c.renderContainers.body.visibleRowCache.indexOf(c.selection.lastSelectedRow):0;var n=c.renderContainers.body.visibleRowCache.indexOf(m);if(d>n){var j=d;d=n;n=j}var k=[];for(var h=d;h<=n;h++){var g=c.renderContainers.body.visibleRowCache[h];if(g){if(!g.isSelected&&g.enableSelection!==false){g.setSelected(true);c.selection.lastSelectedRow=g;b.decideRaiseSelectionEvent(c,g,k,l)}}}b.decideRaiseSelectionBatchEvent(c,k,l)},getSelectedRows:function(c){return c.rows.filter(function(d){return d.isSelected})},clearSelectedRows:function(e,c){var d=[];b.getSelectedRows(e).forEach(function(f){if(f.isSelected){f.setSelected(false);b.decideRaiseSelectionEvent(e,f,d,c)}});e.selection.selectAll=false;e.selection.selectedCount=0;b.decideRaiseSelectionBatchEvent(e,d,c)},decideRaiseSelectionEvent:function(e,f,d,c){if(!e.options.enableSelectionBatchEvent){e.api.selection.raise.rowSelectionChanged(f,c)}else{d.push(f)}},decideRaiseSelectionBatchEvent:function(e,d,c){if(d.length>0){e.api.selection.raise.rowSelectionChangedBatch(d,c)}}};return b});a.directive("uiGridSelection",["uiGridSelectionConstants","uiGridSelectionService","uiGridConstants",function(d,c,b){return{replace:true,priority:0,require:"^uiGrid",scope:false,compile:function(){return{pre:function(l,g,k,h){c.initializeGrid(h.grid);if(h.grid.options.enableRowHeaderSelection){var j={name:d.selectionRowHeaderColName,displayName:"",width:h.grid.options.selectionRowHeaderWidth,minWidth:10,cellTemplate:"ui-grid/selectionRowHeader",headerCellTemplate:"ui-grid/selectionHeaderCell",enableColumnResizing:false,enableColumnMenu:false,exporterSuppressExport:true,allowCellFocus:true};h.grid.addRowHeaderColumn(j,0)}var i=false;var m=function(n){n.forEach(function(o){o.enableSelection=h.grid.options.isRowSelectable(o)});return n};var f=function(){if(h.grid.options.isRowSelectable!==angular.noop&&i!==true){h.grid.registerRowsProcessor(m,500);i=true}};f();var e=h.grid.registerDataChangeCallback(f,[b.dataChange.OPTIONS]);l.$on("$destroy",e)},post:function(g,f,e,h){}}}}}]);a.directive("uiGridSelectionRowHeaderButtons",["$templateCache","uiGridSelectionService","gridUtil",function(b,c,d){return{replace:true,restrict:"E",template:b.get("ui-grid/selectionRowHeaderButtons"),scope:true,require:"^uiGrid",link:function(l,f,k,i){var m=i.grid;l.selectButtonClick=h;l.selectButtonKeyDown=g;if(d.detectBrowser()==="ie"){f.on("mousedown",j)}function g(o,n){if(n.keyCode===32){n.preventDefault();h(o,n)}}function h(p,n){n.stopPropagation();if(n.shiftKey){c.shiftSelect(m,p,n,m.options.multiSelect)}else{if(n.ctrlKey||n.metaKey){c.toggleRowSelection(m,p,n,m.options.multiSelect,m.options.noUnselect)}else{if(p.groupHeader){c.toggleRowSelection(m,p,n,m.options.multiSelect,m.options.noUnselect);for(var o=0;o<p.treeNode.children.length;o++){c.toggleRowSelection(m,p.treeNode.children[o].row,n,m.options.multiSelect,m.options.noUnselect)}}else{c.toggleRowSelection(m,p,n,(m.options.multiSelect&&!m.options.modifierKeysToMultiSelect),m.options.noUnselect)}}}m.options.enableFocusRowOnRowHeaderClick&&p.setFocused(!p.isFocused)&&m.api.selection.raise.rowFocusChanged(p,n)}function j(n){if(n.ctrlKey||n.shiftKey){n.target.onselectstart=function(){return false};window.setTimeout(function(){n.target.onselectstart=null},0)}}l.$on("$destroy",function e(){f.off()})}}}]);a.directive("uiGridSelectionSelectAllButtons",["$templateCache","uiGridSelectionService",function(b,c){return{replace:true,restrict:"E",template:b.get("ui-grid/selectionSelectAllButtons"),scope:false,link:function(e){var d=e.col.grid;e.headerButtonKeyDown=function(f){if(f.keyCode===32||f.keyCode===13){f.preventDefault();e.headerButtonClick(f)}};e.headerButtonClick=function(f){if(d.selection.selectAll){c.clearSelectedRows(d,f);if(d.options.noUnselect){d.api.selection.selectRowByVisibleIndex(0,f)}d.selection.selectAll=false}else{if(d.options.multiSelect){d.api.selection.selectAllVisibleRows(f);d.selection.selectAll=true}}}}}}]);a.directive("uiGridViewport",function(){return{priority:-200,scope:false,compile:function(c){var b=angular.element(c[0].querySelector(".ui-grid-canvas:not(.ui-grid-empty-base-layer-container)").children[0]),e="'ui-grid-row-selected': row.isSelected, 'ui-grid-row-focused': row.isFocused}",d=b.attr("ng-class");if(d){e=d.slice(0,-1)+","+e}else{e="{"+e}b.attr("ng-class",e);return{pre:function(h,g,f,i){},post:function(h,g,f,i){}}}}});a.directive("uiGridCell",["uiGridConstants","uiGridSelectionService",function(b,c){return{priority:-200,restrict:"A",require:"?^uiGrid",scope:false,link:function(o,i,m,l){var k=0,f=300;if(l.grid.api.cellNav){l.grid.api.cellNav.on.viewPortKeyDown(o,function(p,q){if(q===null||q.row!==o.row||q.col!==o.col){return}if(p.keyCode===b.keymap.SPACE&&o.col.colDef.name==="selectionRowHeaderCol"){p.preventDefault();c.toggleRowSelection(o.grid,o.row,p,(o.grid.options.multiSelect&&!o.grid.options.modifierKeysToMultiSelect),o.grid.options.noUnselect);o.$apply()}})}var e=function(p){if(p.target.className==="ui-grid-icon-minus-squared"||p.target.className==="ui-grid-icon-plus-squared"){return}i.off("touchend",n);if(p.shiftKey){c.shiftSelect(o.grid,o.row,p,o.grid.options.multiSelect)}else{if(p.ctrlKey||p.metaKey){c.toggleRowSelection(o.grid,o.row,p,o.grid.options.multiSelect,o.grid.options.noUnselect)}else{if(o.grid.options.enableSelectRowOnFocus){c.toggleRowSelection(o.grid,o.row,p,(o.grid.options.multiSelect&&!o.grid.options.modifierKeysToMultiSelect),o.grid.options.noUnselect)}}}o.row.setFocused(!o.row.isFocused);o.grid.api.selection.raise.rowFocusChanged(o.row,p);o.$apply();window.setTimeout(function(){i.on("touchend",n)},f)};var h=function(){k=(new Date()).getTime();i.off("click",e)};var n=function(p){var r=(new Date()).getTime();var q=r-k;if(q<f){e(p)}window.setTimeout(function(){i.on("click",e)},f)};function j(){if(o.grid.options.enableRowSelection&&o.grid.options.enableFullRowSelection&&o.col.colDef.name!=="selectionRowHeaderCol"){i.addClass("ui-grid-disable-selection");i.on("touchstart",h);i.on("touchend",n);i.on("click",e);o.registered=true}}function d(){if(o.registered){i.removeClass("ui-grid-disable-selection");i.off("touchstart",h);i.off("touchend",n);i.off("click",e);o.registered=false}}j();var g=o.grid.registerDataChangeCallback(function(){if(o.grid.options.enableRowSelection&&o.grid.options.enableFullRowSelection&&!o.registered){j()}else{if((!o.grid.options.enableRowSelection||!o.grid.options.enableFullRowSelection)&&o.registered){d()}}},[b.dataChange.OPTIONS]);i.on("$destroy",g)}}}]);a.directive("uiGridGridFooter",["$compile","gridUtil",function(b,c){return{restrict:"EA",replace:true,priority:-1000,require:"^uiGrid",scope:true,compile:function(){return{pre:function(f,e,d,g){if(!g.grid.options.showGridFooter){return}c.getTemplate("ui-grid/gridFooterSelectedItems").then(function(j){var i=angular.element(j);var h=b(i)(f);angular.element(e[0].getElementsByClassName("ui-grid-grid-footer")[0]).append(h)})},post:function(f,e,d,g){}}}}}])})();