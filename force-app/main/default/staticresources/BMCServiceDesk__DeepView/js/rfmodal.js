(function(b,a){if(typeof define==="function"&&define.amd){define(["angular"],function(c){return a(c)})}else{return a(b)}}(angular||null,function(b){var a=b.module("rfmodal",[]);var c;a.provider("rfModal",function(){var f=(document.body||document.documentElement).style;var e;var k;var i=0;var d={};var h;var g;var j=0;c=this.dialogDefaults={width:"300px",closeByXButton:true,closeByClickOutside:true,closeByEscKey:true,appendToElement:"",beforeCloseCallback:"",grayBackground:true,animation:true,message:"Message Place holder"};this.setDefaults=function(l){b.extend(c,l)};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","dataServices","SSLocalDataStore",function(s,q,v,y,z,A,o,m,l,u,p){var t=s.find("body");var r=function(B){return{title:B.title,icon:B.icon,message:B.message,actionButtonLabel:B.actionButtonLabel,closeButtonLabel:B.closeButtonLabel,closeAllDialogs:B.closeAllDialogs==undefined?undefined:B.closeAllDialogs,Referenceobject:B.Referenceobject,fieldName:B.fieldName,fielddata:B.fielddata,templatefor:B.templatefor}};var x=function(B,D){var F=B.attr("id");var C=B[0].animation;B.unbind("click");if(i===1){t.unbind("keydown")}i-=1;A.$broadcast("rfModal.closing",B);var E=function(){B.remove();if(i===0){t.removeClass("dialog-open")}A.$broadcast("rfModal.closed",B)};if(e&&e!=null){e.$destroy()}B.addClass("dialog-closing");E();if(d[F]){d[F].resolve({id:F,value:D,dialogObj:B,dialogCount:i});delete d[F]}};var n=function(B,C){x(B,C)};var w={getDefaults:function(){return c},openLookup:function(C){A.showloader=true;var B={};if(b.isObject(C)&&C.scope!=undefined&&b.isObject(C.scope)){B=C;B.templatefor="LOOKUP"}if(B.scope&&b.isObject(B.scope)){B.scope.dialogProp=r(B)}return w.open(B)},calculateNewImageSize:function(D,B){h=Math.floor(window.innerWidth*0.9);g=Math.floor(window.innerHeight*0.8);if(D&&D<h){h=D}else{if(D&&B&&B>g){var C=Math.ceil(g*D/B);var E=B;if(C>=h){E=h*B/D;C=E*D/B;h=Math.ceil(C);g=Math.ceil(E)}}}if(B&&B<g){g=B}else{var E=Math.ceil(h*B/D);var C=D;if(E>g){C=g*D/B;E=C*B/D;g=Math.ceil(E);h=Math.ceil(C)}}},openImagePopup:function(C){var D={};w.calculateNewImageSize(C.width,C.height);D.templatefor='<div style="height:100%;"><div set-dialog-body ><div ><img src="'+C.src+'" width="'+h+'px" height="'+g+'px" /></div></div></div>';D.timeout=500;D.closeByClickOutside=false,D.closeByXButton=true;D.closeByEscKey=true;var B="background:transparent; width:100%";return w.open(D,B)},openInfoMessage:function(C,F,D,E,B){var G={};G.scope=C;G.message=D;G.messagetype=F;G.appendToElement=B;G.templatefor="INFOMESSAGE";G.closeByXButton=false;G.timeout=(E!=undefined)?E:5000;if(G.scope&&b.isObject(G.scope)){G.scope.dialogProp=r(G)}return w.open(G)},open:function(F,H){var G=(window.innerHeight-g-66)>0?(window.innerHeight-g-66)/2+66:66;var C,I;var E=b.copy(c);if(F==undefined){F={}}b.extend(E,F);j+=1;var J="rfModal"+j;var B=d[J]=y.defer();if(E.scope&&E.scope!=null){e=b.isObject(E.scope)?E.scope.$new():A.$new()}y.when(D(E,E.templatefor)).then(function(L){if(E.closeByXButton){if(H==undefined){L+='<div class="x-close" ></div>'}}C=b.element('<div id="'+J+'" class="dialog-main" vertical-center style="'+H+'" ></div>');var N,M;N="dialog-content";M="dialog-backgray";C[0]["animation"]=E.animation;var K='<div class="'+M+'"></div><div class="'+N+" "+E.templatefor+'"  >'+L+"</div>";if(H){K='<div class="'+M+'" style="background-color:rgba(0, 0, 0, 0.8)"></div> <div id="Modelfooter" class="'+N+'" style="max-width:'+(window.innerWidth+50)+'px;"> <button type="button" class=" close btn btn-primary" >X</button></div><div class="'+N+'" style="background:transparent;text-align: center;top:'+G+'px">'+L+"</div>"}if(E.templatefor=="INFOMESSAGE"){K='<div style="background: transparent !important;" class="'+M+'"></div><div class="'+N+" "+E.templatefor+'"  >'+L+"</div>"}C.html(K);if(E.appendToElement&&b.isString(E.appendToElement)){I=b.element(document.querySelector(E.appendToElement))}else{I=t}o(function(){if(e&&e!=null){v(C)(e)}if(E.templatefor!="INFOMESSAGE"){t.addClass("dialog-open")}I.append(C);if(E.name){A.$broadcast("rfModal.opened",{dialog:C,name:E.name})}else{A.$broadcast("rfModal.opened",C)}if(C[0].children[1]){C[0].children[1].focus()}});if(E.templatefor=="INFOMESSAGE"&&E.timeout!=0){o(function(){w.closeAll("close")},E.timeout)}k=function(P){var O=b.element(P.target).hasClass("close");if(O){w.closeAll("close")}var Q=b.element(P.target).hasClass("x-close");if(Q){w.closeAll("close")}if(E.closeByClickOutside){if(b.element(P.target).hasClass("dialog-backgray")){w.closeAll("close")}}};C.bind("click",k);$(document).on("keydown",function(O){if($("#"+J).is(":visible")&&E.closeByEscKey){if(O.keyCode==27){w.closeAll("close")}}});i+=1;return w});function D(P,K){if(K=="LOOKUP"){var Q=String.fromCharCode(172);var O=P.fielddata.fadditionalInfo.split(Q);e.refObject=O[0];e.ObjectName=O[1];e.queryfields="Id, Name ";if(P.Isonbehalfof){e.defaultvalues=P.defaultvalues;e.Isonbehalfof=P.Isonbehalfof}if(P.lookupFilter&&P.lookupFilter!=""){if(e.whereclause!=""){e.whereclause=e.whereclause+escape(P.lookupFilterOperator+P.lookupFilter)}else{e.whereclause=escape(P.lookupFilter)}}if(typeof(selectedNodeAPI)!="undefined"&&selectedNodeAPI!=null&&selectedNodeAPI!="Incident__c"){e.isSelectedRecordSR=""}var L={};L.refObject=e.refObject;L.searchvalue="";L.queryfields=e.queryfields;L.isSelectedRecordSR=e.isSelectedRecordSR;L.fieldAPIName=P.fieldAPI;L.queueId=P.queueId;e.queueId=P.queueId;e.fieldAPIName=P.fieldAPI;var N=u.getLookupresult(L);N.then(function(R){if(R.length>0){e.IsNodata=false;b.forEach(R,function(T){if(!T.Queue){T.Name=RemedyForceHTMLProcessor.htmlUnescape(T.Name)}else{T.Queue.Name=RemedyForceHTMLProcessor.htmlUnescape(T.Queue.Name)}});e.lookupresult=R;var S=p.getAppMetadata("MinRecordCount");if(R.length>=S){e.isLoadButtonVisible=true}else{e.isLoadButtonVisible=false}}else{e.lookupresult={};e.IsNodata=false}A.showloader=false},function(R){});return'<div   style="  height:100%;"><div class="dialog-header" rf-model-header><div class="dialog-title"  set-dialog-title></div></div><div create-searchbar></div><div class="modelspacer"></div><div class="dialog-message dialog-body rfmodelcontent-smartviews" set-dialog-body> <div load-lookupdata></div></div></div>'}console.log(P);if(K=="INFOMESSAGE"){var M=" __status-success __icon-check_circle";if(P.messagetype){M=(P.messagetype.toUpperCase()=="ERROR")?" __status-error __icon-exclamation_triangle":(P.messagetype.toUpperCase()=="INFO")?" __status-info __icon-exclamation_bubble_o":(P.messagetype.toUpperCase()=="WARN")?" __status-warning __icon-exclamation_circle":M}return'<div><div class="d-notification '+M+'" style=" padding: 2px 10px 2px 10px;"><p   style="padding-top: 9px;padding-left: 30px;">'+P.message+"</p></div></div>"}if(K&&K.trim().substring(0,1)=="<"){return K}return"<div>"+e.dialogProp.message+"</div>"}return{id:J,closePromise:B.promise,close:function(K){closeDialog(C,K)}}},closeAll:function(C){var B=document.querySelectorAll(".dialog-main");b.forEach(B,function(D){n(b.element(D),C)})}};return w}]});a.directive("verticalCenter",["$window",function(d){return function(g,e){console.log(g);var f=b.element(d);g.$watch(function(){return{wh:window.innerHeight,ch:(e[0].children[1])?e[0].children[1].offsetHeight:e[0].children[0].offsetHeight,}},function(i){var h=(i.wh-i.ch)/2;if(g.dialogProp.templatefor=="INFOMESSAGE"){h=60}else{if(g.dialogProp.templatefor=="LOOKUP"){h=20}else{if(h<0){h=0}else{h=h-30}}}e.css("padding-top",h+"px")},true);f.bind("resize",function(){g.$apply()})}}]);a.directive("rfModelHeader",function(){return{restrict:"EA",link:function(e,f){var d=b.element(f);if(e.dialogProp.headerAddClass){d.addClass(e.dialogProp.headerAddClass)}}}});a.directive("setDialogTitle",function(){return{restrict:"EA",link:function(f,g,d){var e=b.element(g);console.log(f.dialogProp.templatefor);if(f.dialogProp.templatefor=="LOOKUP"){var h=(f.ObjectName=="OnBehalfOf")?_Labels.onBehalfOf:f.ObjectName;if(f.dialogProp.title!=""&&f.dialogProp.title!=undefined&&f.ObjectName=="Owner"){h=f.dialogProp.title}e.text(h)}else{e.text(f.dialogProp.title)}if(f.dialogProp.titleAddClass){e.addClass(f.dialogProp.titleAddClass)}}}});a.directive("createSearchbar",["dataServices","SSLocalDataStore",function(e,d){return{restrict:"EA",link:function(h,g,f){h.searchResult=function(){var j={};j.refObject=h.refObject;var i=h.lookupsearchvalue?h.lookupsearchvalue:"";j.searchvalue=i;j.queryfields=h.queryfields;j.isSelectedRecordSR=h.isSelectedRecordSR;j.fieldAPIName=h.fieldAPIName;j.queueId=h.queueId;var k=e.getLookupresult(j);k.then(function(l){if(l.length>0){h.IsNodata=false;b.forEach(l,function(n){if(!n.Queue){n.Name=RemedyForceHTMLProcessor.htmlUnescape(n.Name)}else{n.Queue.Name=RemedyForceHTMLProcessor.htmlUnescape(n.Queue.Name)}});h.lookupresult=l;var m=d.getAppMetadata("MinRecordCount");if(l.length>=m){h.isLoadButtonVisible=true}else{h.isLoadButtonVisible=false}}else{h.lookupresult={};h.IsNodata=true;h.isLoadButtonVisible=false}},function(l){})};h.callSearch=function(j){var i=j.which||j.keyCode;if(i===13){h.searchResult()}}},template:'<div class="d-text" id="lookupsearccomponent"> <span class="sr-only">Normal text input:</span><input type="text" placeholder="'+_Labels.search+' " ng-keypress="callSearch($event);" ng-keydown="callSearch($event);" ng-model="lookupsearchvalue" class="input-searchbar"><label class="__icon-right-search __icon-only" style="margin-bottom: 0;" ng-click="searchResult();" > </label><span ng-click=" lookupsearchvalue = \'\';searchResult();" ng-show="lookupsearchvalue.length" class="__icon-right-cross cross-icon"></span></div>'}}]);a.directive("loadLookupdata",["rfModal","dataServices",function(d,e){return{restrict:"A",link:function(h,g,f){h.lookupresult;h.htmlDecode=function(i){if(i){return b.element("<div>"+i+"</div>").text().replace(/&amp;/g,"&")}return""};h.Selectandassignvalue=function(k){if(k.Queue){h.dialogProp.fielddata.fRefFieldVal=h.htmlDecode(k.Queue.Name);h.dialogProp.fielddata.fvalue=k.Queue.Id}else{if(h.dialogProp.fielddata.relationshipName=="BMCServiceDesk__FKTemplate__r"){var i=k.Id;var j="";j=window.parent.parent;if(j.MultiPageLayout!=undefined&&j.MultiPageLayout.isEnabled){Visualforce.remoting.Manager.invokeAction(_RemotingActions.fetchTemplateDetails,i,null,function(m,q){if(q.status){var p="";var l="";var o=true;var n="";if(m){p=m.formLayoutId;l=m.formLayoutName}if(p){if(j.MultiPageLayout.isEnabled&&j.MultiPageLayout.ConsoleLayoutAccessValidation){o=j.hasLayoutAccess(h.objectMetaData.APIName,p,l,false)}if(!o){n=_Labels.message.LayoutInsufficientAccess+" "+l;d.openInfoMessage(h,"error",n);return}}h.dialogProp.fielddata.fRefFieldVal=k.Name;h.dialogProp.fielddata.fvalue=k.Id}})}else{h.dialogProp.fielddata.fRefFieldVal=k.Name;h.dialogProp.fielddata.fvalue=k.Id}}else{h.dialogProp.fielddata.fRefFieldVal=k.Name;h.dialogProp.fielddata.fvalue=k.Id}}d.closeAll("close")};h.isLoadButtonVisible=false;h.IsNodata=false;if(h.fieldAPIName=="OwnerId"&&!pageLoadData.isQueueAndUserAssignmentEnabled){h.noHeaders=pageLoadData.isQueueAndUserAssignmentEnabled}else{h.noHeaders=true}h.dialogTitle=h.dialogProp.title;h.LoadmoreRecords=function(){var i=e.getLookupresult(h.refObject,(h.lookupsearchvalue)?h.lookupsearchvalue:"",h.queryfields,h.whereclause,"true");i.then(function(j){console.log(j);h.lookupresult=h.lookupresult.concat(j);h.isLoadButtonVisible=false},function(j){})}},template:'<div><ul class="lookuplistcls"><li ng-show="Isonbehalfof"  ng-click="Selectandassignvalue(defaultvalues)"> <div  class="lookuprow" >{{defaultvalues.Name}}<span style="font-weight: bold;"> - {{defaultvalues.self}}</span></div><div class="lookupUserNameCls">{{defaultvalues.Username}} </div></li><li ng-show="!noHeaders || dialogTitle==_Labels.modal.approver"><div style="cursor:default;" ><b>'+_Labels.modal.user+'</b></div></li><li ng-show="records.Username" ng-repeat="records in lookupresult"  ng-click="Selectandassignvalue(records)"> <div class="lookuprow">{{records.Name}}</div><div  class="lookupUserNameCls" ng-show="refObject ==\'User\'">{{records.Username}} </div></li><div></div><li class="list-group-item rf-loadMore" style="background-color: #f4f6f9;text-align: center;padding: 10px; "ng-click="LoadmoreRecords()" ng-show="isLoadButtonVisible"><label>'+_Labels.ShowMore+'</label></li></ul></div><div><ul class="lookuplistcls"><li ng-show="!noHeaders || dialogTitle==_Labels.modal.approver"><div style="cursor:default;"><b>'+_Labels.modal.queue+'</b></div></li><li ng-show="records.QueueId" ng-repeat="records in lookupresult"  ng-click="Selectandassignvalue(records)"> <div class="lookuprow">{{records.Queue.Name}} </div></li><li ng-hide="records.QueueId || records.Username" ng-repeat="records in lookupresult"  ng-click="Selectandassignvalue(records)"> <div class="lookuprow">{{records.Name}} </div></li><div style="  padding-bottom: 90px"></div><li class="list-group-item rf-loadMore" style="background-color: #f4f6f9;text-align: center;padding: 10px; "ng-click="LoadmoreRecords()" ng-show="isLoadButtonVisible"><label>'+_Labels.ShowMore+'</label></li></ul></div><div ng-show="IsNodata" style="text-align: -webkit-center;  text-align: center;">'+_Labels.recordsNotFound+"</div>"}}])}));