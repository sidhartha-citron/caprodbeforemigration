(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{542:function(t,e,s){},543:function(t,e,s){},544:function(t,e,s){},545:function(t,e,s){},546:function(t,e,s){},547:function(t,e,s){},549:function(t,e,s){},550:function(t,e,s){},552:function(t,e,s){},553:function(t,e,s){},555:function(t,e,s){},556:function(t,e,s){},557:function(t,e,s){},558:function(t,e,s){},584:function(t,e,s){t.exports=s.p+"images/2470107d99a78aed9cde0ecb84acfbf5.svg"},585:function(t,e,s){"use strict";s(542)},586:function(t,e,s){"use strict";s(543)},587:function(t,e,s){"use strict";s(544)},588:function(t,e,s){"use strict";s(545)},589:function(t,e,s){"use strict";s(546)},590:function(t,e,s){"use strict";s(547)},591:function(t,e,s){t.exports=s.p+"images/bafce777ae52bb270fd2b7480c61df92.svg"},593:function(t,e,s){"use strict";s(549)},594:function(t,e,s){"use strict";s(550)},596:function(t,e,s){"use strict";s(552)},597:function(t,e,s){"use strict";s(553)},599:function(t,e,s){"use strict";s(555)},600:function(t,e,s){"use strict";s(556)},601:function(t,e,s){"use strict";s(557)},602:function(t,e,s){"use strict";s(558)},631:function(t,e,s){"use strict";s.r(e);var o=[function(){var t=this.$createElement,e=this._self._c||t;return e("figure",{staticClass:"slds-m-bottom--large"},[e("img",{attrs:{src:s(584)}})])}],i=s(5),a=s(13),n=s(61),r=s(541),l=s(84),u=s(86),d=s(20),c=s(62);function p(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}function h(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var _={computed:function(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?p(Object(s),!0).forEach((function(e){h(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):p(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}({},Object(a.mapGetters)("routes",{store__waypoints:"waypoints",store__first:"first",store__last:"last"})),methods:{getWaypointRecordsForSave:function(){var t=this,e=[],s=1;if(this.store__first&&0!==Object.keys(this.store__first).length){var o=this.$_RouteSave_buildRecordFromWaypoint(this.store__first,"start");o.sortOrder=s++,e.push(o)}if(this.store__waypoints.forEach((function(o){var i=t.$_RouteSave_buildRecordFromWaypoint(o,"unlocked");i.sortOrder=s++,e.push(i)})),this.store__last&&0!==Object.keys(this.store__last).length){var i=this.$_RouteSave_buildRecordFromWaypoint(this.store__last,"end");i.sortOrder=s++,e.push(i)}return e},$_RouteSave_convertToJSON:function(t){var e=window.htmlDecode(t);try{e=JSON.parse(e)}catch(t){(e=d.a.defaultOptions).saveError=!0}return e},$_RouteSave_buildRecordFromWaypoint:function(t,e){var s=t.Options__c;"string"==typeof s&&(s=this.$_RouteSave_convertToJSON(s)),s.LockType=e;var o=Object(i.e)(t.Name)||"";o.length>=80&&(o="".concat(o.substring(0,77),"..."));var a=null;void 0!==t.BaseObjectId__c&&""!==t.BaseObjectId__c?a=t.BaseObjectId__c:void 0!==t.baseObjectId&&""!==t.baseObjectId&&(a=t.baseObjectId);var n=null;return void 0!==t.BaseObject__c&&""!==t.BaseObject__c?n=t.BaseObject__c:""!==t.baseObjectLabel&&void 0!==t.baseObjectLabel&&(n=t.baseObjectLabel),{recordId:t.recordId,isLocked:t.isLocked__c||!1,name:o,address:Object(i.e)(t.Address__c),latitude:t.lat,longitude:t.lng,savedQueryId:0===(t.MASavedQry__c||"").indexOf("OptionsLayer")?void 0:t.MASavedQry__c,linkId:t.LinkId__c,notes:Object(i.e)(t.Notes__c),options:JSON.stringify(s),baseObjectId:a,baseObject:n}}}},m=s(43),f=s(4),v=s(44),b=window.MARemoting,y={components:{MASearch:v.a},props:{storedSearchTerm:{type:String,default:""},usersOnly:{type:Boolean,default:!1},placeholder:{type:String,default:"Search users and assets"},doDetach:{type:Boolean,default:!0}},data:function(){return{searchTerm:this.storedSearchTerm,searches:[{id:Object(m.b)(),onSearch:this.getAssets,label:"label"}]}},watch:{storedSearchTerm:function(){this.searchTerm!==this.storedSearchTerm&&(this.searchTerm=this.storedSearchTerm)}},methods:{errorHandler:function(t){console.warn("error in MASearch cmp: ",t)},getAssetType:function(t){return t.fields&&t.fields.length&&t.fields[0].label?t.fields[0].label:""},getAssets:function(t,e){var s=this;return new Promise((function(o,i){var a={ajaxResource:"MAWaypointAJAXResources",action:"getRouteUserOptions",term:t,usersOnly:s.usersOnly};(new f.a).setAction(b.processAJAXRequest).setErrorHandler(s.handleRemoteActionError.bind(s,i)).invoke([a],(function(t){var s={searchIndex:e};t.success?(s.results=t.data,o(s)):(console.warn(t),i(new Error(t.error)))}))}))},selected:function(t){this.$emit("selected",t)},handleRemoteActionError:function(t,e,s){t(new Error(s.message))}}},g=s(1),w=Object(g.a)(y,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"slds-form-element__control slds-input-has-icon slds-input-has-icon_right",attrs:{id:"scheduleUserSelectWrap"}},[s("div",{staticClass:"slds-form-element"},[s("div",{staticClass:"slds-form-element__control"},[s("div",{staticClass:"slds-combobox_container"},[s("div",{staticClass:"slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click has-option-selected",attrs:{id:"scheduleUserSelectInputWrap","aria-expanded":"true","aria-haspopup":"listbox",role:"combobox"}},[s("div",{staticClass:"slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"},[s("MASearch",{attrs:{searches:t.searches,doDetach:t.doDetach,placeholder:t.placeholder,loadingLabel:t.$Labels.MA_Loading,noSearchResultsLabel:t.$Labels.MA_NO_RESULTS_FOUND},on:{clear:function(e){return t.$emit("clear")},selected:t.selected,error:t.errorHandler},scopedSlots:t._u([{key:"result",fn:function(e){return s("span",{staticClass:"slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta",attrs:{id:"listbox-option-unique-id-01",role:"option"}},[s("span",{staticClass:"slds-media__body"},[s("span",{staticClass:"slds-listbox__option-text slds-listbox__option-text_entity"},[t._v(t._s(t._f("decode")(e.result.label)))]),t._v(" "),s("span",{staticClass:"slds-listbox__option-meta slds-listbox__option-meta_entity"},[t._v(t._s(t._f("decode")(t.getAssetType(e.result))))])])])}}]),model:{value:t.searchTerm,callback:function(e){t.searchTerm=e},expression:"searchTerm"}})],1)])])])])])])}),[],!1,null,null,null).exports,M=s(106);function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var C={name:"MASelect",mixins:[s(55).a],props:{label:{type:String,default:""},options:{type:Object|Array,required:!0},keyString:{type:String,default:"key"},valueString:{type:String,default:"value"},hasNoneOption:{type:Boolean,default:!0},value:{type:String|Number,default:""},default:{type:String|Number,default:""},isRequired:{type:Boolean,default:!1},isInvalid:{type:Boolean,default:!1},placeholder:{type:String,default:""},requiredLabel:{type:String,default:"Required"},noneLabel:{type:String,default:"--None--"}},data:function(){return{defaultValue:this.default}},computed:{showLabel:function(){return this.label}},watch:{value:function(){var t={};t[this.keyString]=this.value,t[this.valueString]=this.getSelectedValue(),this.$emit("change",t)}},methods:{getKey:function(t){return"string"==typeof t||"number"==typeof t?t:t[this.keyString]},getValue:function(t){return"string"==typeof t||"number"==typeof t?t:t[this.valueString]},isSelected:function(t){return this.getKey(t)===this.value},change:function(t){var e=this;t||(t=null);var s=this.options.find((function(s){return("object"===O(s)?s[e.keyString]:s).toString()===t}));"object"===O(s)&&(s=s[this.keyString]),this.$emit("input",s)},getSelectedValue:function(){var t=this;if(!this.options||!this.options.length)return"";var e=this.options.find((function(e){return t.getKey(e)===t.value}));return e?this.decodeHtml(this.getValue(e)):null},remove:function(){this.$emit("input",""),this.doHide()}}},A=Object(g.a)(C,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-form-element",class:{"slds-has-error":t.isInvalid}},[t.showLabel?s("label",{staticClass:"slds-form-element__label"},[t.isRequired?s("abbr",{staticClass:"slds-required",attrs:{title:t.requiredLabel}},[t._v("*")]):t._e(),t._v("\n        "+t._s(t.decodeHtml(t.label))+"\n    ")]):t._e(),t._v(" "),s("select",{staticClass:"slds-select",attrs:{placeholder:t.placeholder},on:{change:function(e){return t.change(e.target.value)}}},[t.hasNoneOption?s("option",{attrs:{value:""}},[t._v(t._s(t.noneLabel))]):t._e(),t._v(" "),t._l(t.options,(function(e,o){return s("option",{key:o,domProps:{value:t.getKey(e),selected:t.isSelected(e)}},[t._v(t._s(t.getValue(e)))])}))],2),t._v(" "),t.isInvalid?s("div",{staticClass:"slds-form-element__help"},[t._t("errors")],2):t._e()])}),[],!1,null,null,null).exports,R=s(54);function S(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}function T(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var $=window,L=$.$,k=$.moment,E=$.MA,j=$.isNum,x={components:{MASelect:A,AssetSearch:w,MAInput:R.a,MAPopover:M.a},mixins:[_],props:{routeAsset:{type:Object,required:!0},routeDate:{type:Object,required:!0}},validations:{newRoute:{name:{required:c.required}}},data:function(){return{asset:this.routeAsset,date:this.routeDate,routeName:"",$calendar:{},events:[],showSaveRoutePopover:!1,saveRoutePopoverBindTo:null,saveRoutePostition:{}}},computed:function(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?S(Object(s),!0).forEach((function(e){T(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):S(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}({month:{get:function(){return this.date.month()},set:function(t){j(t)&&(this.date=this.date.month(t).clone())}},monthName:{get:function(){return this.getMonths()[this.date.month()].name}},year:{get:function(){return this.date.year()},set:function(t){j(t)&&(this.date=this.date.year(t).clone())}},newRoute:{get:function(){return{name:Object(i.e)(this.routeName),date:this.date,asset:this.asset}}},assetSearchTerm:{get:function(){return this.asset.Name}},formattedNewRouteDate:function(){return this.newRoute.date.format("YYYY-MM-DD")},months:function(){return this.getMonths()},years:function(){return this.getYears()}},Object(a.mapGetters)("routes",{store__travelMode:"travelMode",store__route:"route",store__record:"record"})),watch:{date:function(t){t&&t.isValid()&&this.$calendar.fullCalendar("gotoDate",t),this.refreshEvents()},asset:function(){this.refreshEvents()},events:function(t){Array.isArray(t)&&this.$calendar.fullCalendar("renderEvents",t)}},created:function(){this.$bus.$on("render-calendar",this.render),this.routeName=this.store__record.Name},mounted:function(){this.initializeCalendar(),this.updateEvents()},destroyed:function(){this.$bus.$off("render-calendar")},methods:{initializeCalendar:function(){var t=this;this.$calendar=L(this.$refs.calendar),this.$calendar.fullCalendar({defaultDate:this.date,locale:"en",header:!1,height:"auto",contentHeight:"auto",eventLimit:3,eventLimitText:function(e){return"+".concat(e," ").concat(t.$Labels.MA_More)},fixedWeekCount:!1,dayPopoverFormat:"LL",dayRender:function(t,e){e.addClass("route-calender-day")},eventRender:function(t,e){e.addClass("route-calender-event")},eventTextColor:"#FFFFFF",eventColor:"#348CD4",eventClick:function(e){return t.$calendar.fullCalendar("select",e.start),!1},selectable:!0,select:function(e,s,o){t.newRoute.date=e.clone(),t.saveRoutePopoverBindTo=o.target,t.showSaveRoutePopover=!0},selectConstraint:{start:"0:00",end:"24:00"},views:{month:{titleFormat:"MMMM YYYY"}}})},render:function(){this.$calendar.fullCalendar("render")},getMonths:function(){return[{value:0,name:"January",label:this.$Labels.MA_January},{value:1,name:"February",label:this.$Labels.MA_February},{value:2,name:"March",label:this.$Labels.MA_March},{value:3,name:"April",label:this.$Labels.MA_April},{value:4,name:"May",label:this.$Labels.MA_May},{value:5,name:"June",label:this.$Labels.MA_June},{value:6,name:"July",label:this.$Labels.MA_July},{value:7,name:"August",label:this.$Labels.MA_August},{value:8,name:"September",label:this.$Labels.MA_September},{value:9,name:"October",label:this.$Labels.MA_October},{value:10,name:"November",label:this.$Labels.MA_November},{value:11,name:"December",label:this.$Labels.MA_December}]},getYears:function(){var t=[],e=Number(k().format("YYYY"));if("number"==typeof e)for(var s=e-5;s<=e+2;s++)t.push(s);return t},updateEvents:function(){var t=this,e=[];l.a.getMARoutes({month:this.month,year:this.year,lookupId:this.asset.Id,lookupField:this.asset.field}).then((function(s){var o=E.getProperty(s,"routes");Object.keys(o).forEach((function(t){var s=o[t];window.isNum(t)&&Array.isArray(s)&&s.forEach((function(t){var s;E.Util.removeNamespace(t,"sma__"),E.Util.removeNamespace(t,"mamd__");var o=E.getProperty(t,"routeId")||E.getProperty(t,"route.Id"),a=Object(i.e)(E.getProperty(t,"route.Name")),n=E.getProperty(t,"route.Date__c")||E.getProperty(t,"route.Route_Date__c");s={id:o,title:a,start:k(n,"YYYY-MM-DD"),allDay:!0},e.push(s)}))})),t.events=e})).catch((function(t){console.warn("error while gettig route calendar events",t)}))},refreshEvents:function(){this.removeEvents(),this.updateEvents()},removeEvents:function(){this.$calendar.fullCalendar("removeEvents")},routePopoverSaveRoute:function(){var t=this;this.hideSaveRoutePopover(),this.saveRoute().then((function(e){e&&e.routeId?(t.$bus.$emit("hide-plotted-route",e.routeId),t.$emit("close"),t.asset&&t.asset.Id!==t.routeAsset.Id&&t.$bus.$emit("update-asset",t.asset),t.$nextTick((function(){t.$bus.$emit("display-route",e.routeId),t.$bus.$emit("refresh-route-list")}))):console.warn("unexpected response format.",e)})).catch((function(e){t.hideSaveRoutePopover(),window.MAToastMessages.showError({message:"Unable to save this route.",subMessage:String(e),timeOut:8e3,closeButton:!0}),console.warn(e)}))},hideSaveRoutePopover:function(){this.showSaveRoutePopover=!1},saveRoute:function(){var t=this;return new Promise((function(e,s){var o={name:Object(i.e)(t.newRoute.name),day:t.newRoute.date.date(),month:t.newRoute.date.month(),year:t.newRoute.date.year(),lookupId:t.newRoute.asset.Id,lookupField:t.newRoute.asset.field,options:{DriveProfile:t.store__travelMode,TimeBasedOptions:t.store__route.timeBasedOptions},waypoints:t.getWaypointRecordsForSave()};l.a.saveMARoute(o).then((function(t){e(t)})).catch(s)}))},assetChange:function(t){t&&(this.asset={Id:t.id,Name:t.label,field:E.getProperty(t,["fields",0,"apiName"]),type:E.getProperty(t,["fields",0,"label"])})}}},D=(s(585),s(586),Object(g.a)(x,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{position:"relative"}},[s("div",{staticClass:"slds-scope slds-grid slds-grid_vertical-align-center slds-p-around_small",attrs:{id:"saveRouteOptions"}},[s("div",{staticClass:"slds-p-right_medium asset-search-wrap"},[s("AssetSearch",{attrs:{storedSearchTerm:t.assetSearchTerm,placeholder:t.$Labels.MA_Search_Users+"...",doDetach:!0,usersOnly:!1},on:{selected:t.assetChange}})],1),t._v(" "),s("div",{staticClass:"select-group slds-grid"},[s("div",[s("MASelect",{staticClass:"slds-p-right_xx-small",attrs:{options:t.months,hasNoneOption:!1,keyString:"value",valueString:"label"},model:{value:t.month,callback:function(e){t.month=e},expression:"month"}})],1),t._v(" "),s("div",[s("MASelect",{attrs:{options:t.years,hasNoneOption:!1},model:{value:t.year,callback:function(e){t.year=e},expression:"year"}})],1)]),t._v(" "),s("div",{staticClass:"slds-col_bump-left slds-p-right_medium"},[s("div",{staticClass:"slds-grid slds-grid_vertical-align-center routeSaveInstruction"},[t._m(0),t._v(" "),s("div",{staticClass:"slds-col"},[s("p",[t._v(t._s(t.$Labels.MA_Save_Route_Day))])])])])]),t._v(" "),s("div",{ref:"calendar",staticClass:"calendar-container saveRouteCalendar",attrs:{id:"fullCalendar"}}),t._v(" "),t.showSaveRoutePopover?s("MAPopover",{attrs:{bindTo:t.saveRoutePopoverBindTo},on:{close:t.hideSaveRoutePopover}},[s("div",{staticClass:"slds-grid slds-p-around_xx-small",attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-form-element slds-col"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"input-unique-id"}},[t._v(t._s(t.$Labels.MA_Route_Name))]),t._v(" "),s("div",{staticClass:"slds-form-element__control slds-grid"},[s("MAInput",{attrs:{isRequired:!0,isInvalid:t.$v.newRoute.name.$error,placeholder:t.$Labels.MA_Give_Route_Name+"...",requiredLabel:t.$Labels.MA_Required,inputClasses:"slds-input slds-col"},on:{input:t.$v.newRoute.name.$touch},model:{value:t.newRoute.name,callback:function(e){t.$set(t.newRoute,"name",e)},expression:"newRoute.name"}},[s("span",{attrs:{slot:"errors"},slot:"errors"},[t._v("\n                            "+t._s(t.$Labels.MA_This_Field_Is_Required)+"\n                        ")])]),t._v(" "),s("div",{staticClass:"slds-p-left_small"},[s("button",{staticClass:"slds-button slds-button_brand",attrs:{disabled:t.$v.$invalid},on:{click:t.routePopoverSaveRoute}},[t._v(t._s(t.$Labels.MA_Save))])])],1)])])]):t._e()],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("span",{staticClass:"slds-icon slds-icon_x-small slds-m-right_x-small slds-col slds-no-flex ma-icon ma-icon-info"})])}],!1,null,"80f447ec",null).exports),P=s(63),N=window.MASystem.Labels,I={components:{MAModal:P.a,RouteCalendar:D},props:{asset:{type:Object,required:!0},routeDate:{type:Object,required:!0}},data:function(){return{Labels:N,isVisible:!1}},created:function(){this.$bus.$on("open-route-calendar-save-modal",this.show)},destroyed:function(){this.$bus.$off("open-route-calendar-save-modal")},methods:{close:function(){this.isVisible=!1},show:function(){this.isVisible=!0},modalMounted:function(){this.$bus.$emit("render-calendar")}}},W=(s(587),Object(g.a)(I,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.isVisible?s("MAModal",{ref:"routeCalendarModal",staticClass:"save-route-calendar",attrs:{title:t.Labels.MA_Save_Route,closeLabel:t.$Labels.MA_Close,doDetach:!0,classes:"modal-override"},on:{mounted:t.modalMounted,close:t.close}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("RouteCalendar",{ref:"calendar",attrs:{routeDate:t.routeDate,routeAsset:t.asset},on:{close:t.close}})],1),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"slds-grid"},[s("div",{staticClass:"slds-col"}),t._v(" "),s("div",{staticClass:"save-route-buttons slds-scope"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.close}},[t._v(t._s(t.Labels.MA_Close))])])])])]):t._e()],1)}),[],!1,null,null,null).exports),B={components:{MAModal:P.a},props:{doShow:{type:Boolean,required:!0}},data:function(){return{Labels:window.MASystem.Labels}},methods:{deleteRoute:function(){this.$emit("delete-route")},doHide:function(){this.$emit("update:doShow",!1)}}},F=Object(g.a)(B,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.doShow?s("MAModal",{attrs:{title:t.Labels.MA_Delete_Route,closeLabel:t.$Labels.MA_Close},on:{close:t.doHide}},[s("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n        "+t._s(t.Labels.MA_Delete_Route_Confirm)+"\n    ")]),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.doHide}},[t._v(t._s(t.Labels.MA_Cancel))]),t._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:t.deleteRoute}},[t._v(t._s(t.Labels.MA_Delete))])])]):t._e()}),[],!1,null,null,null).exports,U={props:{start:{type:String,required:!0},isTwentyFourHour:{type:Boolean,required:!1,default:!1}},data:function(){return{time:{}}},computed:{minuteOptions:function(){for(var t=[],e=0;e<60;e++)e<10?t.push({value:"0".concat(e),text:"0".concat(e)}):t.push({value:e,text:e});return t},hourOptions:function(){for(var t=[],e=this.isTwentyFourHour?25:13,s=1;s<e;s++)t.push({value:s,text:s});return t}},watch:{time:{handler:function(){this.$emit("updateTime",this.time)},deep:!0},start:function(){this.parseStart()}},created:function(){this.parseStart()},methods:{parseStart:function(){var t="--",e="--",s="--",o=this.start||"";try{var i=window.moment(o,"hh:mm a");i.isValid()&&(t=i.format("h"),e=i.format("mm"),s=i.format("a"))}catch(t){}this.time={hour:t,minute:e,ampm:s}}}},G=Object(g.a)(U,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-select-group slds-grid"},[s("div",{staticClass:"slds-select_container slds-select_short"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.time.hour,expression:"time.hour"}],staticClass:"slds-select",attrs:{title:"Hour"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.time,"hour",e.target.multiple?s:s[0])}}},t._l(t.hourOptions,(function(e){return s("option",{key:e.value,domProps:{value:e.value}},[t._v("\n                "+t._s(e.text)+"\n            ")])})),0)]),t._v(" "),s("div",{staticClass:"slds-select_container slds-select_short"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.time.minute,expression:"time.minute"}],staticClass:"slds-select",attrs:{title:"Minute"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.time,"minute",e.target.multiple?s:s[0])}}},t._l(t.minuteOptions,(function(e){return s("option",{key:e.value,domProps:{value:e.value}},[t._v("\n                "+t._s(e.text)+"\n            ")])})),0)]),t._v(" "),t.isTwentyFourHour?t._e():s("div",{staticClass:"slds-select_container slds-select_short"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.time.ampm,expression:"time.ampm"}],staticClass:"slds-select",attrs:{title:"AM/PM"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.time,"ampm",e.target.multiple?s:s[0])}}},[s("option",{attrs:{value:"am"}},[t._v("AM")]),t._v(" "),s("option",{attrs:{value:"pm"}},[t._v("PM")])])])])}),[],!1,null,null,null).exports,H=s(139),q=s(140),Y=s(142);function V(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}function z(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?V(Object(s),!0).forEach((function(e){J(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):V(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function J(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var K=window,Q=K.MASystem,X=K.moment,Z={components:{RouteCalendarModal:W,RouteConfirmDelete:F,RouteHeaderTime:G,MAInput:R.a,MAActionMenu:H.a,MAActionMenuItem:q.a,MADatetimePicker:Y.a,MAModal:P.a},mixins:[_],props:{asset:{type:Object,required:!0}},validations:{store__record:{Name:{required:c.required}}},data:function(){return{isTwentyFourHour:!1,importDate:X(),routeTimeHasError:!1,showResetConfirmationModal:!1,showImportEvents:!1,showConfirmDelete:!1,startTime:{},endTime:{}}},computed:z({showSaveAs:function(){return!this.isNew&&!this.isGuideRoute&&!this.$v.$invalid},laborLawNotify:function(){return window.getProperty(Q||{},"Organization.LaborLawsNotify",!1)||!1},isNew:function(){return!this.store__record.Id},isGuideRoute:function(){return this.store__route.isGuideRoute},startString:function(){return this.store__route.timeBasedOptions.Start||n.a.getRoutingDefaultStartTime()},endString:function(){return this.store__route.timeBasedOptions.End||n.a.getRoutingDefaultEndTime()},recordName:{get:function(){return this.store__record.Name||""},set:function(t){this.store__updateRecord({Name:t}),this.store__setUnsavedChanges(!0)}},routeDate:function(){return window.moment(this.store__record.Date__c,"YYYY-MM-DD")},assetInfo:function(){return this.asset&&this.asset.type&&this.asset.Name?"".concat(this.asset.type,": ").concat(this.asset.Name):""},formattedRouteDate:function(){return this.routeDate.format(Q.User.dateFormat.toUpperCase())}},Object(a.mapGetters)("routes",{store__travelMode:"travelMode",store__isTimeBased:"isTimeBased",store__waypoints:"waypoints",store__route:"route",store__record:"record"})),created:function(){this.$bus.$on("save-close-route",this.saveCloseRoute),this.initTimeData()},destroyed:function(){this.$bus.$off("save-close-route")},methods:z(z(z({},Object(a.mapMutations)("routes",{store__addRouteCallout:"addRouteCallout",store__removeRouteCallout:"removeRouteCallout",store__setUnsavedChanges:"setUnsavedChanges",store__setIsTimeBased:"setIsTimeBased",store__updateRoute:"updateRoute",store__updateRecord:"updateRecord"})),Object(a.mapActions)("routes",{store__addWaypoints:"addWaypoints"})),{},{initTimeData:function(){this.startTime=this.createMomentTimeObject(this.startString),this.endTime=this.createMomentTimeObject(this.endString),this.emitUpdate()},updateStartTime:function(t){this.startTime=t,this.validateTime("start"),this.emitUpdate()},updateEndTime:function(t){this.endTime=t,this.validateTime("end"),this.emitUpdate()},emitUpdate:function(){var t={Enabled:this.store__isTimeBased,Start:this.buildTimeStringFromStartEndObj(this.startTime),End:this.buildTimeStringFromStartEndObj(this.endTime)};this.store__updateRoute({timeBasedOptions:t})},openImportEvents:function(){if(this.isGuideRoute){window.MAToastMessages.showWarning({message:"Unable to import events.",subMessage:"Import Events is not supported for Guide Routes.",timeOut:1e4,extendedTimeout:0,closeButton:!0})}else this.showImportEvents=!0},hideImportEvents:function(){this.showImportEvents=!1},importEvents:function(t){var e=this;this.store__isTimeBased||this.store__setIsTimeBased(!0),this.store__addRouteCallout(),l.a.getEvents(t).then((function(t){t?e.store__addWaypoints(t):window.MAToastMessages.showWarning({message:"No Events",subMessage:"No events to import for this day.",timeout:2e3}),e.showImportEvents=!1})).catch((function(t){window.MAToastMessages.showError({message:"Error encountered while importing events.",subMessage:String(t),timeOut:8e3,closeButton:!0})})).finally((function(){e.store__removeRouteCallout()}))},hideResetConfirmationModal:function(){this.showResetConfirmationModal=!1},toggleTimeBased:function(){this.isGuideRoute?window.MAToastMessages.showWarning({message:"Time Based Locked.",subMessage:"Time Based Settings are locked for Guide Generated Routes.",closeButton:!0,timeOut:7e3,extendedTimeout:0}):(this.store__setIsTimeBased(!this.store__isTimeBased),this.store__setUnsavedChanges(!0),this.$emit("generate",!this.store__lockOrder))},validateTime:function(t){var e=this.buildTimeStringFromStartEndObj(this.startTime),s=this.buildTimeStringFromStartEndObj(this.endTime),o=window.moment(e,"h:mm a"),i=window.moment(s,"h:mm a");"start"===t?o.isAfter(i)?this.routeTimeHasError=!0:this.routeTimeHasError=!1:"end"===t&&(i.isBefore(o)?this.routeTimeHasError=!0:this.routeTimeHasError=!1)},createMomentTimeObject:function(t){var e=window.moment(t,"h:mm a");return e.isValid()||(e=window.moment("12:00 pm","hh:mm a")),{hour:this.isTwentyFourHour?e.format("H"):e.format("h"),minute:e.format("mm"),ampm:e.format("a")}},buildTimeStringFromStartEndObj:function(t){var e,s;return this.isTwentyFourHour?(e="".concat(t.hour," : ").concat(t.minute),s=window.moment(e,"HH:mm")):(e="".concat(t.hour,":").concat(t.minute," ").concat(t.ampm),s=window.moment(e,"hh:mm a")),s.format("h:mm a")},confirmDeleteRoute:function(){this.showConfirmDelete=!0},deleteRoute:function(){this.$emit("deleteRoute")},confirmRemoveWaypoints:function(){this.showResetConfirmationModal=!0},removeWaypoints:function(){this.hideResetConfirmationModal(),this.$emit("resetRoute")},back:function(){this.$emit("back")},saveCloseRoute:function(){this.saveRoute(null,!0)},saveRoute:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.$v.$invalid)if(this.routeTimeHasError)window.MAToastMessages.showError({message:"Unable to save this route.",subMessage:"Please validate the start and end times.",timeOut:8e3,closeButton:!0});else{if(this.isGuideRoute){var o=!1;if(this.store__waypoints.forEach((function(t){var s=t.Options__c;"string"==typeof s&&(s=e.$_RouteSave_convertToJSON(s)),s&&s.TimeBasedOptions&&"Set start time..."!==s.TimeBasedOptions.Start||(o=!0)})),o)return void window.MAToastMessages.showError({message:"Unable to save this route.",subMessage:"All stops in a guide route require a start time to save.",timeOut:8e3,closeButton:!0})}if(this.isNew)this.saveRouteAs();else{var a={name:Object(i.e)(this.store__record.Name),Id:this.store__record.Id,day:this.routeDate.date(),month:this.routeDate.month(),year:this.routeDate.year(),lookupId:this.asset.Id,lookupField:this.asset.field,user:this.store__record.User__c,options:{DriveProfile:this.store__travelMode,TimeBasedOptions:this.store__route.timeBasedOptions},waypoints:this.getWaypointRecordsForSave()},n=window.MAToastMessages.showLoading({message:this.$Labels.MA_Saving_Route,timeOut:0,extendedTimeOut:0});l.a.saveMARoute(a).then((function(){window.MAToastMessages.showSuccess({message:"".concat(e.$Labels.MA_Success,"! "),timeOut:5e3}),e.store__setUnsavedChanges(!1),e.$bus.$emit("refresh-route-list"),s&&e.$emit("exit")})).catch((function(t){window.MAToastMessages.showError({message:"Unable to save this route.",subMessage:String(t),timeOut:8e3,closeButton:!0}),console.warn("error while saving route.",t)})).finally((function(){window.MAToastMessages.hideMessage(n)})),document.querySelector(".slds-button_success").blur()}}},saveRouteAs:function(){if(!this.$v.$invalid)if(this.isGuideRoute){window.MAToastMessages.showWarning({message:'"Save As" Unavailable',subMessage:"Guide-generated routes cannot be reassigned or rescheduled.",timeOut:1e4,extendedTimeout:0,closeButton:!0})}else this.$bus.$emit("open-route-calendar-save-modal")}})},tt=(s(588),Object(g.a)(Z,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.laborLawNotify?s("div",{staticClass:"labor-law-notification slds-notify_container slds-notify_container--inline"},[s("div",{staticClass:"slds-notify slds-notify--alert slds-theme--warning slds-theme--alert-texture slds-banner"},[s("h2",[t._v(t._s(t.$Labels.MA_Labor_Laws))])])]):t._e(),t._v(" "),s("div",{staticClass:"slds-p-top_small slds-p-bottom_small slds-p-left_medium slds-p-right_x-small slds-grid",attrs:{id:"routesSingleHeader"}},[t.showResetConfirmationModal?s("MAModal",{attrs:{title:t.$Labels.MA_Are_You_Sure,closeLabel:t.$Labels.MA_Close},on:{close:t.hideResetConfirmationModal}},[s("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                "+t._s(t.$Labels.MA_Clear_Waypoints)+"\n            ")]),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.hideResetConfirmationModal}},[t._v(t._s(t.$Labels.MA_Cancel))]),t._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:t.removeWaypoints}},[t._v(t._s(t.$Labels.MA_Remove_Waypoints))])])]):t._e(),t._v(" "),t.showImportEvents?s("MAModal",{staticClass:"ma-import-events-modal",attrs:{title:t.$Labels.MA_IMPORT_EVENTS,closeLabel:t.$Labels.MA_Close},on:{close:t.hideImportEvents}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("MADatetimePicker",{attrs:{locale:t.$User.UserLocale,timezone:t.$User.timezoneId,dateFormat:t.$User.dateFormat.toUpperCase(),showInputField:!1,displayAsStatic:!0,previousMonthLabel:t.$Labels.MA_Previous_Month,nextMonthLabel:t.$Labels.MA_Next_Month,selectDateLabel:t.$Labels.MA_Select_A_Date,pickAYearLabel:t.$Labels.MA_Pick_A_Year,todayLabel:t.$Labels.MA_TODAY},on:{input:t.importEvents},model:{value:t.importDate,callback:function(e){t.importDate=e},expression:"importDate"}})],1),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_brand",on:{click:t.hideImportEvents}},[t._v(t._s(t.$Labels.MA_Cancel))])])]):t._e(),t._v(" "),s("RouteConfirmDelete",{attrs:{doShow:t.showConfirmDelete},on:{"update:doShow":function(e){t.showConfirmDelete=e},"update:do-show":function(e){t.showConfirmDelete=e},"delete-route":t.deleteRoute}}),t._v(" "),s("div",{staticClass:"slds-col"},[s("div",{staticClass:"slds-grid slds-p-bottom_small ma-route-top-menu"},[s("div",{staticClass:"slds-col slds-p-right_xx-small"},[s("MAInput",{attrs:{isRequired:!0,isInvalid:t.$v.store__record.Name.$error,placeholder:t.$Labels.MA_Route_Name+"...",requiredLabel:t.$Labels.MA_Required,inputClasses:"slds-form-element_inverse"},on:{input:t.$v.store__record.Name.$touch},model:{value:t.recordName,callback:function(e){t.recordName=e},expression:"recordName"}},[s("span",{staticClass:"slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default ma-icon ma-icon-edit editHeaderRouteName",attrs:{slot:"extendInput"},slot:"extendInput"}),t._v(" "),s("span",{attrs:{slot:"errors"},slot:"errors"},[t._v(t._s(t.$Labels.MA_Give_Route_Name))])])],1),t._v(" "),s("div",{staticClass:"slds-p-right_small"},[s("div",{staticClass:"slds-button-group",attrs:{role:"group"}},[s("button",{staticClass:"slds-button slds-button_success",attrs:{disabled:t.$v.$invalid,"data-pendo":"route_save"},on:{click:t.saveRoute}},[t._v(t._s(t.$Labels.MA_Save))]),t._v(" "),t.showSaveAs?s("MAActionMenu",{staticClass:"slds-button_last ma-save-as",attrs:{forceRight:!0,showMoreLabel:t.$Labels.MA_SHOW_MORE}},[s("button",{staticClass:"slds-button slds-button_success slds-button_icon slds-button_icon-border-filled",attrs:{slot:"button",id:"routesSingleSaveDropdownButton"},slot:"button"},[s("span",{staticClass:"slds-button__icon ma-icon ma-icon-down"})]),t._v(" "),s("MAActionMenuItem",{staticClass:"ma-save-as-button",attrs:{"data-pendo":"route_save-as",label:"Save As"},on:{click:t.saveRouteAs}})],1):t._e()],1)]),t._v(" "),s("div",[s("MAActionMenu",{attrs:{showMoreLabel:t.$Labels.MA_SHOW_MORE}},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",attrs:{slot:"button"},slot:"button"},[s("span",{staticClass:"ma-icon ma-icon-threedots-vertical"})]),t._v(" "),s("MAActionMenuItem",{attrs:{label:t.$Labels.MA_Delete_Route},on:{click:t.confirmDeleteRoute}}),t._v(" "),s("MAActionMenuItem",{attrs:{label:t.$Labels.MA_Remove_Waypoints},on:{click:t.confirmRemoveWaypoints}}),t._v(" "),s("MAActionMenuItem",{attrs:{label:t.$Labels.MA_IMPORT_EVENTS},on:{click:t.openImportEvents}})],1)],1),t._v(" "),s("div",{staticClass:"slds-p-left_xx-small"},[s("button",{staticClass:"slds-button slds-button_icon-container has-hover-tooltip",attrs:{id:"routesSingleBackButton"},on:{click:t.back}},[s("span",{staticClass:"slds-button__icon ma-icon ma-icon-close"}),t._v(" "),s("div",{staticClass:"slds-popover slds-popover_tooltip slds-nubbin_left"},[s("div",{staticClass:"slds-popover__body"},[t._v("\n                                "+t._s(t.$Labels.MA_Close_Remove_Map)+"\n                            ")])])])])]),t._v(" "),s("div",{staticClass:"slds-grid slds-grid_vertical-align-center"},[s("div",{staticClass:"slds-col slds-grid slds-text-color_weak"},[s("div",{staticClass:"ma-user-label slds-truncate slds-p-right_medium"},[t._v(t._s(t.assetInfo))]),t._v(" "),s("div",{staticClass:"slds-grid",attrs:{id:"datepickerContainer"}},[t._m(0),t._v(" "),s("div",[t._v(t._s(t.formattedRouteDate))])])]),t._v(" "),s("div",{staticClass:"timeBasedTempButton slds-col_bump-left slds-p-left_xx-small"},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container has-hover-tooltip",class:{"active slds-is-selected":t.store__isTimeBased},attrs:{id:"js-toggleTimeBased"},on:{click:t.toggleTimeBased}},[s("span",{staticClass:"slds-button__icon_large ma-icon ma-icon-clock"}),t._v(" "),s("div",{staticClass:"slds-popover slds-popover_tooltip slds-nubbin_left"},[s("div",{staticClass:"slds-popover__body"},[t._v("\n                                "+t._s(t.$Labels.MA_Toggle_Time_Based)+"\n                            ")])])])])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.store__isTimeBased,expression:"store__isTimeBased"}],staticClass:"slds-grid slds-grid_vertical-align-center time-based-clock-container",class:{"slds-has-error":t.routeTimeHasError}},[s("div",{staticClass:"slds-grid"},[s("RouteHeaderTime",{attrs:{start:t.startString,isTwentyFourHour:t.isTwentyFourHour},on:{updateTime:t.updateStartTime}}),t._v(" "),s("div",{staticClass:"slds-p-horizontal_xx-small slds-p-top_xx-small"},[t._v("â€“")]),t._v(" "),s("RouteHeaderTime",{attrs:{start:t.endString,isTwentyFourHour:t.isTwentyFourHour},on:{updateTime:t.updateEndTime}})],1)]),t._v(" "),t.isGuideRoute?s("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-scope guide-route-header"},[t._m(1)]):t._e()]),t._v(" "),s("RouteCalendarModal",{attrs:{routeDate:t.routeDate,asset:t.asset}})],1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"slds-m-right_xx-small"},[e("span",{staticClass:"slds-icon slds-icon_xx-small ma-icon ma-icon-event"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"slds-text-title_caps",staticStyle:{"margin-top":"5px"}},[e("div",{staticClass:"icon ma-icon-guide-logo"},[this._v("Generated by Guide")])])}],!1,null,"66d0a11b",null).exports),et=s(85),st=s(18);function ot(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var s=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==s)return;var o,i,a=[],n=!0,r=!1;try{for(s=s.call(t);!(n=(o=s.next()).done)&&(a.push(o.value),!e||a.length!==e);n=!0);}catch(t){r=!0,i=t}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return a}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return it(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return it(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function it(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,o=new Array(e);s<e;s++)o[s]=t[s];return o}var at=window.MA,nt={components:{MASelect:A},directives:{"click-outside":st.a},props:{travelMode:{type:String,default:i.c.DRIVING.value},isGuideRoute:{type:Boolean,required:!1,default:!1}},data:function(){return{isTravelModeVisible:!1,selectedCustomProfile:"",customProfiles:[],isCustomDriveVisible:!1,TravelModes:i.c}},computed:{isDrivingTravelMode:function(){return this.travelMode===i.c.DRIVING.value},isWalkingTravelMode:function(){return this.travelMode===i.c.WALKING.value},isBicylingTravelMode:function(){return this.travelMode===i.c.BICYCLING.value},isCustomTravelMode:function(){return this.isValidCustomProfile(this.travelMode)},travelIcon:function(){var t=this,e=i.c.DRIVING.icon;return Object.keys(i.c).forEach((function(s){i.c[s].value===t.travelMode&&(e=i.c[s].icon)})),e},currentTravelModeTitle:function(){var t,e=this,s="";if(this.isValidStandardProfile(this.travelMode)?t=Object.keys(i.c).filter((function(t){return at.getProperty(i.c,[t,"value"])===e.travelMode})).map((function(t){return at.getProperty(i.c,[t,"label"])})):this.isValidCustomProfile(this.travelMode)&&(t=this.customProfiles.filter((function(t){return t.Id===e.travelMode})).map((function(t){return t.Name}))),Array.isArray(t)){var o=ot(t,1)[0];s=void 0===o?"Unknown":o}return s},customProfileOptions:function(){return this.customProfiles.map((function(t){return{value:t.Id,label:t.Name}}))},clickOutsideOptions:function(){return{active:!0,handler:this.hideTravelMode}}},watch:{travelMode:function(t){t&&!this.isValidCustomProfile(t)&&(this.selectedCustomProfile="")},selectedCustomProfile:function(t){t&&this.setTravelMode(t)}},created:function(){this.loadDriverProfiles()},methods:{showTravelMode:function(){this.isTravelModeVisible||(this.isTravelModeVisible=!0)},hideTravelMode:function(){this.isTravelModeVisible=!1},showCustomDriveSelector:function(){this.isCustomDriveVisible||(this.isCustomDriveVisible=!0)},hideCustomDriveSelector:function(){this.isCustomDriveVisible=!1},selectTravelMode:function(t){this.isGuideRoute?window.MAToastMessages.showWarning({message:"Drive Profile Unavailable.",subMessage:this.$Labels.MA_Guide_Profiles_Warning,timeOut:7e3,extendedTimeout:0,closeButton:!0}):t!==i.c.CUSTOM.value?(this.hideCustomDriveSelector(),this.setTravelMode(t)):this.showCustomDriveSelector()},setTravelMode:function(t){this.hideTravelMode(),this.isValidTravelMode(t)?this.$emit("update:travelMode",t):this.errmsg="Invalid travel mode. Please try again."},loadDriverProfiles:function(){var t=this;this.buildDriverProfiles().then((function(e){t.customProfiles=[],e.forEach((function(e){e.Name&&t.customProfiles.push(e)})),t.isValidCustomProfile(t.travelMode)&&(t.isCustomDriveVisible=!0,t.selectedCustomProfile=t.travelMode)}))},buildDriverProfiles:function(){var t=this,e={ajaxResource:"RouteCalendarAJAXResources",action:"getDriveProfiles"};return new Promise((function(s,o){(new f.a).setAction(window.MARemoting.processAJAXRequest).setErrorHandler(t.handleRemoteActionError.bind(t,o)).invoke([e],(function(t){t&&t.success&&s(t.data.driveProfiles)}),{escape:!1})}))},isValidTravelMode:function(t){return this.isValidStandardProfile(t)||this.isValidCustomProfile(t)},isValidStandardProfile:function(t){return Object.keys(i.c).map((function(t){return at.getProperty(i.c,[t,"value"])})).includes(t)},isValidCustomProfile:function(t){return this.customProfiles.map((function(t){return t.Id})).includes(t)},customProfileSelect:function(t){this.isValidCustomProfile(t)?this.showCustomDriveSelector():(this.hideCustomDriveSelector(),this.setTravelMode("driving"))},handleRemoteActionError:function(t,e,s){t(new Error("Unable to load custom driver profiles. ".concat(s.message)))}}},rt=(s(589),Object(g.a)(nt,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ma-travel-mode"},[s("div",{staticClass:"slds-is-relative ma-travel-mode",attrs:{"data-reactroot":""}},[s("div",{staticClass:"slds-button slds-button_icon slds-button_icon-container slds-button_icon-more-flex",attrs:{title:t.currentTravelModeTitle},on:{click:t.showTravelMode}},[s("span",{staticClass:"slds-button__icon_large ma-icon",class:t.travelIcon}),t._v(" "),s("span",{staticClass:"slds-button__icon_x-small ma-icon ma-icon-down"})]),t._v(" "),t._m(0)]),t._v(" "),t.isTravelModeVisible?s("section",{directives:[{name:"click-outside",rawName:"v-click-outside:[clickOutsideOptions]",arg:t.clickOutsideOptions}],staticClass:"slds-popover slds-nubbin_top-left slds-dynamic-menu",staticStyle:{position:"absolute","margin-top":"15px","margin-left":"-7px"}},[s("div",{staticClass:"slds-popover__body slds-p-horizontal_none"},[s("div",{staticClass:"slds-p-vertical_x-small slds-p-horizontal_small"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:""}},[t._v("Transportation Mode")]),t._v(" "),s("div",{staticClass:"slds-button-group slds-grid",attrs:{role:"group"}},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-border-filled",class:{"slds-is-selected":t.isDrivingTravelMode},attrs:{title:t.TravelModes.DRIVING.label,"aria-pressed":"true"},on:{click:function(e){return t.selectTravelMode(t.TravelModes.DRIVING.value)}}},[s("span",{staticClass:"slds-icon slds-button__icon slds-icon-text-default ma-icon ma-icon-custom31"}),t._v(" "),s("span",{staticClass:"slds-assistive-text"},[t._v(t._s(t.TravelModes.DRIVING.label))])]),t._v(" "),s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-border-filled",class:{"slds-is-selected":t.isWalkingTravelMode},attrs:{title:t.TravelModes.WALKING.label,"aria-pressed":"true"},on:{click:function(e){return t.selectTravelMode(t.TravelModes.WALKING.value)}}},[s("span",{staticClass:"slds-icon slds-button__icon slds-icon-text-default ma-icon ma-icon-walk"}),t._v(" "),s("span",{staticClass:"slds-assistive-text"},[t._v(t._s(t.TravelModes.WALKING.label))])]),t._v(" "),s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-border-filled",class:{"slds-is-selected":t.isBicylingTravelMode},attrs:{title:t.TravelModes.BICYCLING.label,"aria-pressed":"true"},on:{click:function(e){return t.selectTravelMode(t.TravelModes.BICYCLING.value)}}},[s("span",{staticClass:"slds-icon slds-button__icon slds-icon-text-default ma-icon ma-icon-bicycle"}),t._v(" "),s("span",{staticClass:"slds-assistive-text"},[t._v(t._s(t.TravelModes.BICYCLING.label))])]),t._v(" "),s("button",{staticClass:"slds-button slds-button_neutral custom-travel-button",class:{"slds-is-selected":t.isCustomTravelMode},attrs:{title:t.TravelModes.DRIVING.label,"aria-pressed":"true"},on:{click:function(e){return t.selectTravelMode(t.TravelModes.CUSTOM.value)}}},[s("span",{staticClass:"slds-icon slds-button__icon slds-button__icon_left ma-icon ma-icon-new-custom98"}),t._v("\n                        Custom\n                        "),s("span",{staticClass:"slds-assistive-text"},[t._v(t._s(t.TravelModes.CUSTOM.label))])])]),t._v(" "),t.isCustomDriveVisible?s("MASelect",{staticClass:"slds-p-top_small",attrs:{label:t.$Labels.MA_Drive_Profiles,options:t.customProfileOptions,hasNoneOption:!0,noneLabel:t.$Labels.MA_None,keyString:"value",valueString:"label"},on:{input:t.customProfileSelect},model:{value:t.selectedCustomProfile,callback:function(e){t.selectedCustomProfile=e},expression:"selectedCustomProfile"}}):t._e()],1)])]):t._e()])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("button",{staticClass:"slds-button slds-button_icon",attrs:{title:"Show Travel Modes"}},[e("span",{staticClass:"slds-assistive-text"},[this._v("Travel Mode")])])}],!1,null,"3e97fc76",null).exports);function lt(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}function ut(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?lt(Object(s),!0).forEach((function(e){dt(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):lt(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function dt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var ct={components:{MACheckbox:et.a,DriveProfileSelector:rt},props:{onMap:{type:Boolean,default:!1},showOnTheMapToggle:{type:Boolean,default:!1}},data:function(){return{storedTravelMode:"",Labels:window.MASystem.Labels}},computed:ut({buttonLabel:function(){return this.store__lockOrder?this.Labels.MA_Get_Directions||"Generate":this.Labels.MA_Optimize||"Optimize"}},Object(a.mapGetters)("routes",{store__pendingChanges:"pendingChanges",store__travelMode:"travelMode",store__lockOrder:"lockOrder",store__isGuideRoute:"isGuideRoute"})),watch:{storedTravelMode:function(t){t!==this.store__travelMode&&(this.store__setTravelMode(t),this.store__pendingChanges||this.store__setPendingChange(!0),this.reloadMap())},showOnTheMapToggle:{immediate:!0,handler:function(t,e){return e}}},created:function(){this.$bus.$on("toggle-order-lock-on",this.lock),this.storedTravelMode=this.store__travelMode},destroyed:function(){this.$bus.$off("toggle-order-lock-on",this.lock)},methods:ut(ut({},Object(a.mapMutations)("routes",{store__setTravelMode:"setTravelMode",store__setPendingChange:"setPendingChange",store__setLockOrder:"setLockOrder"})),{},{reloadMap:function(){this.$emit("generate",!this.store__lockOrder)},updateToggleValue:function(){this.$emit("toggleRoute",!this.onMap)},updateLockOrder:function(){this.store__setLockOrder(!this.store__lockOrder)},lock:function(){this.store__lockOrder||this.store__setLockOrder(!0)}})},pt=(s(590),Object(g.a)(ct,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-p-horizontal_medium slds-p-vertical_x-small slds-grid slds-grid_vertical-align-center",attrs:{id:"routesSingleControlBar"}},[s("div",[s("button",{staticClass:"slds-button slds-button_brand",attrs:{id:"generateRoute"},on:{click:t.reloadMap}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-route"}),t._v(" "),s("span",{attrs:{id:"optimizeGenerate"}},[t._v(t._s(t.buttonLabel))])])]),t._v(" "),s("div",{staticClass:"slds-p-left_x-small"},[s("DriveProfileSelector",{attrs:{isGuideRoute:t.store__isGuideRoute,travelMode:t.storedTravelMode},on:{"update:travelMode":function(e){t.storedTravelMode=e},"update:travel-mode":function(e){t.storedTravelMode=e}}})],1),t._v(" "),s("div",{staticClass:"lock-stop-toggle-wrap slds-form-element slds-p-left_x-small route-control-toggle-wrap"},[s("MACheckbox",{attrs:{value:t.store__lockOrder,title:t.Labels.MA_Lock_Order},on:{input:t.updateLockOrder}})],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showOnTheMapToggle,expression:"showOnTheMapToggle"}],staticClass:"on-the-map-toggle-wrap slds-form-element slds-col_bump-left route-control-toggle-wrap"},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",on:{click:t.updateToggleValue}},[s("span",{staticClass:"slds-button__icon slds-button__icon_hint ma-icon",class:[t.onMap?"ma-icon-preview":"ma-icon-hide"],attrs:{"aria-hidden":"true"}})])])])}),[],!1,null,"69d32cb0",null).exports),ht=[function(){var t=this.$createElement,e=this._self._c||t;return e("figure",{staticClass:"slds-m-bottom_medium"},[e("img",{attrs:{src:s(591)}})])}],_t={directives:{"click-outside":st.a},props:{doDetach:{type:Boolean,default:!1},direction:{type:String,default:"slds-nubbin_top-left"},isOpen:{type:Boolean,default:!0},position:{type:Object,required:!1,default:function(){return{top:0,left:0}}}},data:function(){return{}},computed:{clickOutsideOptions:function(){return{active:this.isOpen,handler:this.doHide}}},mounted:function(){this.doDetach?this.detachPopover():(this.$refs.popover.style.left="0px",this.$refs.popover.style.position="absolute")},methods:{detachPopover:function(){if(this.position&&this.position.top&&this.position.left){var t=this.$refs.popover.getBoundingClientRect(),e=this.position.left+t.width/10,s=this.position.top+t.height/2;this.$refs.popover.style.top="".concat(s,"px"),this.$refs.popover.style.left="".concat(e,"px"),this.$refs.popover.style.position="fixed"}},doHide:function(){this.isOpen&&this.$emit("update:isOpen",!1)}}},mt=Object(g.a)(_t,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{directives:[{name:"click-outside",rawName:"v-click-outside:[clickOutsideOptions]",arg:t.clickOutsideOptions},{name:"show",rawName:"v-show",value:t.isOpen,expression:"isOpen"}],ref:"popover",staticClass:"slds-popover slds-dynamic-menu slds-p-horizontal_small",class:t.direction,attrs:{role:"dialog","aria-label":"popover","aria-describedby":"dialog-body-id-17"}},[s("div",{staticClass:"slds-popover__body slds-p-horizontal_none",attrs:{id:"dialog-body-id-17"}},[s("div",{staticClass:"slds-form-element"},[t._t("content",(function(){return[t._v("default content")]}))],2)])])}),[],!1,null,null,null).exports,ft=s(535);function vt(t){return function(t){if(Array.isArray(t))return bt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return bt(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return bt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,o=new Array(e);s<e;s++)o[s]=t[s];return o}var yt={components:{MASelect:A,MAPicklist:s(40).a},props:{placeholder:{type:String,default:"Set start time..."},start:{type:String,required:!0},duration:{type:String,required:!0},isTwentyFourHour:{type:Boolean,required:!1,default:!1}},data:function(){return{time:"",hour:"0",minute:"0",times:[].concat(vt(this.getHours("am")),vt(this.getHours("pm"))),hours:this.generateHourOptions(),minutes:this.generateMinuteOptions()}},computed:{durationOutput:function(){return"".concat(this.hour," hr, ").concat(this.minute," min")}},created:function(){this.parseStart(),this.parseDuration()},methods:{getHours:function(t){for(var e=[],s=0;s<12;s++){var o=0===s?12:s;e.push(this.createOption("".concat(o,":00").concat(t))),e.push(this.createOption("".concat(o,":30").concat(t)))}return e},generateHourOptions:function(){for(var t=[],e=0;e<13;e++)t.push({key:e.toString(),value:e.toString()});return t},generateMinuteOptions:function(){for(var t=[],e=0;e<12;e++){var s=5*e;t.push({key:s.toString(),value:s.toString()})}return t},createOption:function(t){return{key:t,value:t}},selectTime:function(t){if(""!==t)try{var e=window.moment(t,"h:mma");e.isValid()?this.$emit("update:start",e.format("hh:mm a")):this.time=this.start}catch(t){console.warn("Failed to parse start time: ".concat(t))}else this.$emit("update:start",this.time)},selectMinute:function(t){this.minute=t,this.$emit("update:duration",this.durationOutput)},selectHour:function(t){this.hour=t,this.$emit("update:duration",this.durationOutput)},parseStart:function(){try{var t=window.moment(this.start,"hh:mm a");t.isValid()?this.time=t.format("h:mma"):this.time=""}catch(t){console.warn("Failed to parse start time: ".concat(t))}},parseDuration:function(){var t="0",e="0";try{var s=this.duration.split(",");t=s[0]||"0 hr",e=s[1]||"0 min",t=t.replace(/\D/g,""),e=e.replace(/\D/g,"")}catch(s){t="0",e="0"}this.hour=t,this.minute=e,this.minutes.find((function(t){return t.key===e}))||this.minutes.push(e)}}},gt=(s(593),Object(g.a)(yt,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-grid"},[s("div",{staticClass:"slds-form-element inline slds-p-right_small time-based-start-select-wrap"},[s("MAPicklist",{attrs:{options:t.times,useCombobox:!0,doDetach:!0,hasNoneOption:!1,placeholder:t.placeholder,showLabel:!1,clearLabel:t.$Labels.MA_Clear,noSearchResultsLabel:t.$Labels.MA_NO_RESULTS_FOUND},on:{input:t.selectTime},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),t._v(" "),s("div",{staticClass:"slds-col"},[s("div",{staticClass:"slds-grid slds-grid_vertical-align-center"},[s("MASelect",{attrs:{options:t.hours,doDetach:!0,hasNoneOption:!1,showLabel:!1},on:{input:t.selectHour},model:{value:t.hour,callback:function(e){t.hour=e},expression:"hour"}}),t._v(" "),s("div",{staticClass:"time-duration-units"},[t._v("hrs")]),t._v(" "),s("MASelect",{attrs:{options:t.minutes,doDetach:!0,hasNoneOption:!1,showLabel:!1},on:{input:t.selectMinute},model:{value:t.minute,callback:function(e){t.minute=e},expression:"minute"}}),t._v(" "),s("div",{staticClass:"time-duration-units"},[t._v("mins")])],1)])])}),[],!1,null,"c6ec1204",null).exports);function wt(t){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mt(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}function Ot(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(s),!0).forEach((function(e){Ct(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Mt(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function Ct(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var At=window.moment,Rt={components:{MAInput:R.a,MAActionMenu:H.a,MAActionMenuItem:q.a,RouteTimeOptions:gt,RouteTimeAndDistance:ft.a},props:{type:{type:String,default:"waypoint"},waypoint:{type:Object,required:!0}},validations:{name:{required:c.required},address:{required:c.required}},data:function(){return{showEditMode:!1,showTimeEditMode:!1,name:this.waypoint.Name||"",note:Object(i.e)(this.waypoint.Notes__c||""),address:this.waypoint.Address__c||"",waypointOptions:{},toast:"",duration:"",start:"",timeIs24Hr:!1,Labels:window.MASystem.Labels,showOverflowActions:!1,doShowActionMenu:!1}},computed:Ot(Ot({showTimeDistance:function(){return!this.store__pendingChanges&&this.waypoint.distance},formattedDuration:function(){return this.waypointOptions.TimeBasedOptions.Duration},startString:function(){return this.waypointOptions.TimeBasedOptions.Start},divClass:function(){var t="";return this.showError&&(this.isGuideRoute?t+="has-warning ":t+="has-error "),this.showEditMode&&(t+="is-editing "),this.isWaypoint?t+="routes-destination-list-item slds-card":this.isStart?t+="routes-start-list-item":this.isEnd&&(t+="routes-end-list-item"),t},editIcon:function(){return this.showEditMode?"ma-icon-check":"ma-icon-edit"},inlineErrorClass:function(){return this.store__isGuideRoute?"slds-inline_icon_text--warning":"slds-inline_icon_text--error"},isStart:function(){return"start"===this.type},isEnd:function(){return"end"===this.type},isWaypoint:function(){return"waypoint"===this.type},isLocked:function(){return!!this.waypoint.isLocked__c&&this.waypoint.isLocked__c},url:function(){return this.waypoint.LinkId__c?"/".concat(this.waypoint.LinkId__c):void 0},allowUpdateName:function(){return this.isWaypoint&&!this.waypoint.LinkId__c},showError:function(){return this.waypoint.errorMsg&&this.waypoint.erroramount&&this.waypoint.erroramount>120},errorString:function(){var t=this.waypoint.erroramount||0,e=Math.round(parseFloat(t/60)),s=this.waypoint.errorMsg;if(!s||""===s||"Unreachable"===s)if(e>=60){var o=Math.floor(e/60),i=e%60,a=0===i?" ":" ".concat(i," min(s) ");s="".concat(o," hour(s)").concat(a,"late for appointment")}else s="".concat(e," min(s) late for appointment");return s},showArrivalDeparture:function(){return this.waypoint.arrivaltime&&this.waypoint.departuretime&&this.store__isTimeBased&&!this.showEditMode&&!this.store__pendingChanges},arrivalDeparture:function(){return this.isStart?"".concat(this.arrivalString," Departure"):this.isEnd?"".concat(this.arrivalString," Arrival"):"".concat(this.arrivalString," Arrival â€“ ").concat(this.departureString," Departure")},departureString:function(){return this.waypoint.departuretime?At.unix(this.waypoint.departuretime).format("h:mma"):""},arrivalString:function(){return this.waypoint.arrivaltime?At.unix(this.waypoint.arrivaltime).format("h:mma"):""},appointmentStart:function(){return this.waypoint.start?At.unix(this.waypoint.start):void 0},applyLabel:function(){return this.isStart?"Apply to End":"Apply to Start"}},Object(a.mapGetters)("routes",{store__pendingChanges:"pendingChanges",store__travelMode:"travelMode",store__isTimeBased:"isTimeBased",store__isGuideRoute:"isGuideRoute"})),{},{scrollToThisError:function(){return this.waypoint.scrollToThisError}}),watch:{waypoint:function(){this.waypoint.Options__c&&"object"===wt(this.waypoint.Options__c)&&this.waypoint.Options__c.TimeBasedOptions!==this.waypointOptions.TimeBasedOptions&&this.applyWaypointOptions(),this.waypoint.Address__c!==this.address&&(this.address=this.waypoint.Address__c||""),this.waypoint.Name!==this.name&&(this.name=this.waypoint.Name||"")},scrollToThisError:function(t){if(t){var e=this.routeBodyRef();if(!e)return;var s=e.offsetTop,o=this.$el.offsetTop;e.scrollTop=o-s}}},created:function(){this.applyWaypointOptions()},inject:["routeBodyRef"],methods:Ot(Ot({},Object(a.mapActions)("routes",{store__updateFirst:"updateFirst",store__updateLast:"updateLast",store__setToStart:"setToStart",store__setToEnd:"setToEnd"})),{},{decodeWaypointOptions:function(){var t=this.waypoint.Options__c;if("object"===wt(t))t=this.waypoint.Options__c;else if("string"==typeof t){t=Object(i.e)(this.waypoint.Options__c);try{t=JSON.parse(t)}catch(e){t=d.a.defaultOptions}}else t=d.a.defaultOptions;return t},applyWaypointOptions:function(){this.waypointOptions=this.decodeWaypointOptions();var t=this.waypointOptions.TimeBasedOptions||{};this.timeIs24Hr=!1,this.start=t.Start,this.duration=t.Duration},applyTo:function(){this.isStart?this.store__updateLast(Ot(Ot({},this.waypoint),{id:Object(i.f)()})):this.store__updateFirst(Ot(Ot({},this.waypoint),{id:Object(i.f)()}))},remove:function(){this.$emit("remove",this.waypoint.id)},edit:function(){this.showEditMode?this.save():(this.showTimeEditMode=!1,this.showEditMode=!0)},applyRouteTime:function(){var t=this.start;""===t&&(t="Set start time..."),this.waypointOptions.TimeBasedOptions.Start=t;var e=this.duration;""===e&&(e="0 hr, 0 min"),this.waypointOptions.TimeBasedOptions.Duration=e},saveRouteTime:function(){this.applyRouteTime(),this.emitSave({Options__c:this.waypointOptions}),this.toggleTimeEditMode(!1)},toggleLockGuideRoute:function(){this.waypoint.isLocked__c=!this.waypoint.isLocked__c},toggleTimeEditMode:function(t){this.showEditMode||(t&&this.applyWaypointOptions(),this.showTimeEditMode=t)},save:function(){var t=this;this.$v.$touch(),this.$v.$invalid||(this.applyRouteTime(),this.address!==this.waypoint.Address__c?l.a.geocode(this.address).then((function(e){if(!(e&&e.position&&e.position.lat&&e.position.lng))throw new Error("New Address failed to geocode");t.emitSave({Name:t.name,Notes__c:t.note,Address__c:t.address,Options__c:t.waypointOptions,lat:e.position.lat,lng:e.position.lng})})).catch((function(e){t.toast=e.message})):this.emitSave({Name:this.name,Notes__c:this.note,Address__c:this.address,Options__c:this.waypointOptions}))},emitSave:function(t){this.showEditMode=!1,this.$emit("update",Ot(Ot({},this.waypoint),t))},over:function(){this.showOverflowActions=!0},out:function(t){var e=t.toElement||t.relatedTarget,s=this.$refs.wrapper.contains(e),o=this.$refs.actionMenu.$refs.menu,i=e===o,a=o&&this.$refs.actionMenu.$refs.menu.contains(e);s||i||a||(this.showOverflowActions=!1,this.doShowActionMenu=!1)},mouseoutActionMenu:function(t){this.$refs.actionMenu.$refs.menu.contains(t.toElement)||t.toElement===this.$refs.wrapper||this.$refs.wrapper.contains(t.toElement)||(this.doShowActionMenu=!1)}})},St=(s(594),Object(g.a)(Rt,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{ref:"wrapper",class:t.divClass,on:{mouseover:t.over,mouseleave:t.out}},[t.isWaypoint?s("div",{staticClass:"waypoint-marker routes-destination-sortable-icon"},[s("span",{staticClass:"ma-icon ma-icon-move"})]):t._e(),t._v(" "),t.isWaypoint?s("div",{staticClass:"routes-destination-counter-wrap"},[s("div",{staticClass:"routes-destination-counter"},[t._v("\n                "+t._s(t.waypoint.index)+"\n                "),s("div",{staticClass:"routes-destination-counter_nubbin-shadow"})])]):t.isStart?s("div",{staticClass:"routes-start-destination"},[t._m(0),t._v(" "),s("div",{staticClass:"routes-start-icon_nubbin-shadow"})]):t.isEnd?s("div",{staticClass:"routes-end-destination"},[t._m(1)]):t._e(),t._v(" "),s("div",{staticClass:"ma-routes-waypoint-entry slds-col slds-p-right_x-small",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"routes-destination-list-item-form-title"},[t.showEditMode&&t.allowUpdateName?s("MAInput",{key:"editTitle",attrs:{isRequired:!0,isInvalid:t.$v.name.$error,requiredLabel:t.$Labels.MA_Required},on:{input:t.$v.name.$touch},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}},[s("span",{attrs:{slot:"errors"},slot:"errors"},[t._v(t._s(t.Labels.MA_Field_Req))])]):t.url?s("a",{key:"urlTitle",staticClass:"routes-destination-list-item-form-title-inner",attrs:{href:t.url,target:"_blank"}},[t._v(" "+t._s(t._f("decode")(t.name))+" ")]):s("div",{key:"readOnlyTitle",staticClass:"routes-destination-list-item-form-title-inner"},[t._v(" "+t._s(t._f("decode")(t.name))+" ")])],1),t._v(" "),s("div",{staticClass:"routes-destination-list-item-description"},[t.showEditMode&&t.isWaypoint?s("MAInput",{key:"editWaypoint",attrs:{isRequired:!0,isInvalid:t.$v.address.$error,requiredLabel:t.$Labels.MA_Required},on:{input:t.$v.address.$touch},model:{value:t.address,callback:function(e){t.address=e},expression:"address"}},[s("span",{attrs:{slot:"errors"},slot:"errors"},[t._v(t._s(t.Labels.MA_Field_Req))])]):s("div",{key:"viewWaypoint",staticClass:"routes-destination-list-item-description-inline"},[t._v(t._s(t._f("decode")(t.address)))])],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showArrivalDeparture&&!t.showError,expression:"showArrivalDeparture && !showError"}],staticClass:"arrival-departure-wrap"},[t._v("\n                "+t._s(t.arrivalDeparture)+"\n            ")]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.store__isTimeBased&&t.isWaypoint&&!t.showTimeEditMode&&!t.showEditMode,expression:"store__isTimeBased && isWaypoint && !showTimeEditMode && !showEditMode"}],staticClass:"time-based-inline-wrap slds-grid slds-p-top_small"},[s("div",{staticClass:"time-based-inline_start-time slds-p-right_small slds-grid"},[t.store__isGuideRoute?s("div",[s("div",{staticClass:"slds-p-left_xx-small",on:{click:t.toggleLockGuideRoute}},[s("div",{staticClass:"slds-button slds-button_icon-container has-hover-tooltip guide-waypoint-lock-toggle-button js-toggle-guide-waypoint-lock",attrs:{title:"Locked appointments will not be rescheduled when MapAnything Guide reoptimizes.",alt:"Locked appointments will not be rescheduled when MapAnything Guide reoptimizes."}},[t.isLocked?s("span",{staticClass:"slds-button__icon ma-icon ma-icon-lock"}):s("span",{staticClass:"slds-button__icon ma-icon ma-icon-unlock"}),t._v(" "),t._e()])])]):t._e(),t._v(" "),s("div",{staticClass:"slds-m-right_x-small"},[s("button",{staticClass:"slds-button",on:{click:function(e){return t.toggleTimeEditMode(!0)}}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-clock"}),t._v("\n                            "+t._s(t.startString)+"\n                        ")])]),t._v(" "),s("div",{staticClass:"time-based-inline_start-time"},[s("button",{staticClass:"slds-button",on:{click:function(e){return t.toggleTimeEditMode(!0)}}},[t._v("\n                            "+t._s(t.formattedDuration)+"\n                        ")])])])]),t._v(" "),t.showTimeEditMode||t.showEditMode?s("div",{staticClass:"slds-form-element time-based-clock-container"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isWaypoint&&t.store__isTimeBased,expression:"isWaypoint && store__isTimeBased"}],staticClass:"slds-grid time-based-clock-container-inner"},[s("RouteTimeOptions",{attrs:{start:t.start,duration:t.duration},on:{"update:start":function(e){t.start=e},"update:duration":function(e){t.duration=e}}}),t._v(" "),s("div",[s("button",{directives:[{name:"show",rawName:"v-show",value:!t.showEditMode,expression:"!showEditMode"}],staticClass:"slds-button slds-button_brand slds-button_compact",on:{click:t.saveRouteTime}},[t._v("Done")])])],1),t._v(" "),t.showEditMode?s("MAInput",{attrs:{placeholder:t.Labels.MA_Notes+"...",useTextArea:!0,requiredLabel:t.$Labels.MA_Required},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}}):t._e()],1):t._e(),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showEditMode&&t.showError,expression:"!showEditMode && showError"}],staticClass:"waypoint-error-message"},[s("div",{staticClass:"slds-inline_icon_text slds-grid slds-inline_icon_text--error",class:t.inlineErrorClass},[s("span",{staticClass:"slds-icon slds-icon--small slds-m-right--small slds-col slds-no-flex ma-icon ma-icon-warning"}),t._v(" "),s("div",{staticClass:"slds-col slds-align-middle"},[s("p",[t._v(t._s(t.errorString))])])])])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showOverflowActions,expression:"showOverflowActions"}],staticClass:"routes-destination-list-item-overflow-actions slds-col_bump-left slds-grid"},[s("div",[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container route-edit-button",on:{click:t.edit}},[s("span",{staticClass:"slds-button__icon slds-button__icon_hint ma-icon",class:t.editIcon})])]),t._v(" "),s("div",[s("MAActionMenu",{ref:"actionMenu",attrs:{doDetach:!0,doShow:t.doShowActionMenu,showMoreLabel:t.$Labels.MA_SHOW_MORE},on:{"update:doShow":function(e){t.doShowActionMenu=e},"update:do-show":function(e){t.doShowActionMenu=e},hide:function(e){t.showOverflowActions=!1},mouseleave:t.mouseoutActionMenu}},[s("button",{directives:[{name:"show",rawName:"v-show",value:!t.showEditMode,expression:"!showEditMode"}],staticClass:"slds-button slds-button_icon slds-button_icon-container",attrs:{slot:"button"},slot:"button"},[s("span",{staticClass:"ma-icon ma-icon-threedots-vertical"})]),t._v(" "),t.isWaypoint?t._e():s("MAActionMenuItem",{attrs:{label:t.applyLabel},on:{click:t.applyTo}}),t._v(" "),t.isStart?t._e():s("MAActionMenuItem",{attrs:{"data-pendo":"route-stop_lock-to-start",label:"Lock to Start"},on:{click:function(e){return t.store__setToStart(t.waypoint)}}}),t._v(" "),t.isEnd?t._e():s("MAActionMenuItem",{attrs:{"data-pendo":"route-stop_lock-to-end",label:"Lock to End"},on:{click:function(e){return t.store__setToEnd(t.waypoint)}}})],1)],1),t._v(" "),s("div",[t.showEditMode?t._e():s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",on:{click:t.remove}},[s("span",{staticClass:"slds-button__icon slds-button__icon_hint ma-icon ma-icon-remove"})])])])]),t._v(" "),t.showTimeDistance?s("RouteTimeAndDistance",{staticClass:"routes-time-distance",attrs:{distance:t.waypoint.distance,totalTravelTime:t.waypoint.totaltraveltime,travelMode:t.store__travelMode,timeGap:t.waypoint.timeGap}}):t._e()],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"routes-start-icon"},[e("div",{staticClass:"ma-icon ma-icon-priority"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"routes-end-icon"},[e("div",{staticClass:"ma-icon ma-icon-goal"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"slds-popover__body"},[e("div",[this._v("Toggle Appointment Lock")]),this._v(" "),e("p",{staticClass:"slds-text-color_inverse-weak slds-text-body_small"},[this._v("\n                                            Locked appointments will not be rescheduled when MapAnything Guide reoptimizes.\n                                        ")])])}],!1,null,"164eddea",null).exports),Tt={components:{MASearch:v.a},data:function(){return{searchTerm:"",searches:[{id:Object(i.f)(),onSearch:function(t,e){return l.a.searchFavorites(t,e)},label:"Name"}]}},methods:{clearResults:function(){this.searchTerm=""},reactToSelected:function(t){this.searchTerm="",this.doHide(),this.$emit("update",{Name:t.Name,Address__c:t.sma__Address__c,lat:t.sma__Latitude__c,lng:t.sma__Longitude__c,Options__c:d.a.defaultStartEndOptions,id:Object(i.f)()})},doHide:function(){this.$emit("hide")}}},$t=Object(g.a)(Tt,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-grid",attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-col search-dropdown-wrap"},[s("MASearch",{ref:"MASearch",attrs:{searches:t.searches,placeholder:t.$Labels.MA_Search_Fav,loadingLabel:t.$Labels.MA_Loading,noSearchResultsLabel:t.$Labels.MA_NO_RESULTS_FOUND},on:{clear:t.clearResults,selected:t.reactToSelected},scopedSlots:t._u([{key:"result",fn:function(e){return s("span",{staticClass:"slds-listbox__option-text_entity slds-listbox__option slds-listbox__option_plain",attrs:{id:"listbox-option-unique-id-01"}},[t._v("\n                "+t._s(t._f("decode")(e.result.Name))+"\n            ")])}}]),model:{value:t.searchTerm,callback:function(e){t.searchTerm=e},expression:"searchTerm"}})],1),t._v(" "),s("div",{staticClass:"slds-p-left_x-small"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.doHide}},[t._v(t._s(t.$Labels.MA_Cancel))])])])}),[],!1,null,null,null).exports,Lt=s(551);function kt(t){return function(t){if(Array.isArray(t))return Et(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Et(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Et(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,o=new Array(e);s<e;s++)o[s]=t[s];return o}function jt(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}function xt(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?jt(Object(s),!0).forEach((function(e){Dt(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):jt(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function Dt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var Pt={components:{MAPopover:mt,RouteBodyWaypoint:St,FavoriteSearch:$t,draggable:s.n(Lt).a},data:function(){return{waypoints:[],addStart:!1,addEnd:!1,Labels:window.MASystem.Labels}},computed:xt({showAddStart:function(){return!this.store__start||0===Object.keys(this.store__start).length},showAddEnd:function(){return!this.store__end||0===Object.keys(this.store__end).length},showEmptyState:function(){return!this.waypoints||0===this.waypoints.length}},Object(a.mapGetters)("routes",{store__storedWaypoints:"waypoints",store__start:"first",store__end:"last"})),watch:{store__storedWaypoints:function(){this.waypoints=kt(this.store__storedWaypoints)}},created:function(){this.waypoints=kt(this.store__storedWaypoints)},provide:function(){var t=this;return{routeBodyRef:function(){return t.$el}}},methods:xt(xt(xt({},Object(a.mapActions)("routes",{store__updateFirst:"updateFirst",store__updateLast:"updateLast",store__removeWaypoint:"removeWaypoint",store__updateWaypoint:"updateWaypoint",store__updateWaypoints:"updateWaypoints"})),Object(a.mapMutations)("routes",{store__setPendingChange:"setPendingChange"})),{},{openStartModal:function(){var t=this;this.addStart=!0,this.$nextTick((function(){t.$refs.addStartMASearch.$refs.MASearch.$refs.search.focus()}))},openEndModal:function(){var t=this;this.addEnd=!0,this.$nextTick((function(){t.$refs.addEndMASearch.$refs.MASearch.$refs.search.focus()}))},doHide:function(){this.addEnd=!1,this.addStart=!1},updateWaypointOrder:function(){this.$bus.$emit("toggle-order-lock-on"),this.waypoints.forEach((function(t,e,s){s[e]=xt(xt({},t),{},{index:e+1})})),this.store__updateWaypoints(this.waypoints)},waypointDragChoose:function(){this.store__setPendingChange(!0)}})},Nt=(s(596),Object(g.a)(Pt,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ma-routes-wrapper slds-grid slds-grid_vertical slds-col"},[s("div",{staticClass:"slds-grid slds-grid_vertical",attrs:{id:"routesSingleBody"}},[s("div",{attrs:{id:"routesDestinationList"}},[t.showAddStart?s("div",{key:"add-start",staticClass:"ma-routes-add-location ma-routes-add-starting-location routes-start-list-item"},[s("button",{staticClass:"slds-button start-end-location-add-button",on:{click:t.openStartModal}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-add"}),t._v(" "+t._s(t.Labels.MA_Start_Loc)+"\n                ")]),t._v(" "),s("MAPopover",{staticClass:"ma-routes-places",attrs:{isOpen:t.addStart,direction:"slds-nubbin_top-left"},on:{"update:isOpen":function(e){t.addStart=e},"update:is-open":function(e){t.addStart=e}}},[s("FavoriteSearch",{ref:"addStartMASearch",attrs:{slot:"content"},on:{hide:t.doHide,update:t.store__updateFirst},slot:"content"})],1)],1):s("RouteBodyWaypoint",{key:"edit-start",attrs:{waypoint:t.store__start,type:"start"},on:{remove:function(e){return t.store__updateFirst({})},update:t.store__updateFirst}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showEmptyState,expression:"showEmptyState"}],staticClass:"slds-notify_container--inline no-destinations slds-text-align_center"},[s("div",{staticClass:"slds-grid"},[s("div",{staticClass:"slds-col slds-align-middle"},[t._m(0),t._v(" "),s("h4",{staticClass:"slds-text-heading_medium slds-p-bottom_x-small"},[t._v(t._s(t.Labels.MA_No_Stops))]),t._v(" "),s("p",{staticClass:"slds-p-bottom_x-small"},[t._v(t._s(t.Labels.MA_Go_Somewhere))])])])]),t._v(" "),s("div",{staticClass:"routeWaypointsWrap"},[s("draggable",{attrs:{options:{handle:".waypoint-marker"}},on:{update:t.updateWaypointOrder,choose:t.waypointDragChoose},model:{value:t.waypoints,callback:function(e){t.waypoints=e},expression:"waypoints"}},t._l(t.waypoints,(function(e){return s("RouteBodyWaypoint",{key:e.id,attrs:{waypoint:e},on:{remove:t.store__removeWaypoint,update:t.store__updateWaypoint}})})),1)],1),t._v(" "),t.showAddEnd?s("div",{key:"addEnd",staticClass:"ma-routes-add-location ma-routes-add-ending-location routes-ending-list-item"},[s("button",{staticClass:"slds-button start-end-location-add-button",on:{click:t.openEndModal}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-add"}),t._v(" "+t._s(t.Labels.MA_End_Loc)+"\n                ")]),t._v(" "),s("MAPopover",{staticClass:"ma-routes-places",attrs:{isOpen:t.addEnd,direction:"slds-nubbin_bottom-left"},on:{"update:isOpen":function(e){t.addEnd=e},"update:is-open":function(e){t.addEnd=e}}},[s("FavoriteSearch",{ref:"addEndMASearch",attrs:{slot:"content"},on:{hide:t.doHide,update:t.store__updateLast},slot:"content"})],1)],1):s("RouteBodyWaypoint",{key:"editEnd",attrs:{waypoint:t.store__end,type:"end"},on:{remove:function(e){return t.store__updateLast({})},update:t.store__updateLast}})],1)])])}),ht,!1,null,"4df2b2f2",null).exports);function It(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}function Wt(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?It(Object(s),!0).forEach((function(e){Bt(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):It(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function Bt(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var Ft=window,Ut=Ft.MARemoting,Gt=Ft.MA,Ht={components:{MAPopover:mt,MASearch:v.a},data:function(){return{searchTerm:"",addNew:!1,Labels:window.MASystem.Labels,searches:[{id:Object(i.f)(),onSearch:this.searchGoogle,label:"description"}]}},watch:{addNew:function(t){t||this.clearResults()}},methods:Wt(Wt({},Object(a.mapActions)("routes",{store__addWaypoints:"addWaypoints"})),{},{openAddDestination:function(){var t=this;this.addNew=!0,this.$nextTick((function(){t.$refs.addStopMASearch.$refs.search.focus()}))},doHide:function(){this.addNew=!1},handleRemoteActionError:function(t,e,s){t(new Error("Unable to load default start/stop location. ".concat(s.message)))},searchGoogle:function(t,e){var s=this;return new Promise((function(o,i){t&&""!==t||i(new Error("Missing Required Param: searchTerm"));var a=Gt.map.getCenter(),n=a.lat(),r=a.lng(),l=8e3;try{var u=Gt.map.getBounds();l=window.google.maps.geometry.spherical.computeDistanceBetween(a,u.getNorthEast())}catch(t){console.warn(t)}(new f.a).setAction(Ut.placeSearch).setErrorHandler(s.handleRemoteActionError.bind(s,i)).invoke([t,n,r,l,"queryAutocomplete"],(function(t){var s=window.MA.getProperty(t,["data","predictions"]),i=[];s.forEach((function(t){t.place_id&&i.push(t)})),o({results:i,searchIndex:e})}),{buffer:!1})}))},clearResults:function(){this.searchTerm=""},addDestination:function(t){this.store__addWaypoints([t])},reactToSelectedPlace:function(t){var e=this;this.doHide(),new Promise((function(e,s){new window.google.maps.places.PlacesService(Gt.map).getDetails({placeId:t.place_id},(function(t,o){o===window.google.maps.places.PlacesServiceStatus.OK?e(t):s(new Error("failed to load new destination"))}))})).then((function(t){e.addDestination({Name:t.name,Address__c:t.formatted_address,Options__c:d.a.defaultOptions,lat:t.geometry.location.lat(),lng:t.geometry.location.lng(),id:Object(i.f)()})}))}})},qt=(s(597),Object(g.a)(Ht,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ma-routes-add-location slds-p-right_xx-small slds-p-left_small slds-col_bump-left"},[s("button",{staticClass:"slds-button",on:{click:t.openAddDestination}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-add"}),t._v(" "+t._s(t.Labels.MA_ADD_A_STOP)+"\n    ")]),t._v(" "),s("MAPopover",{staticClass:"ma-routes-places",attrs:{isOpen:t.addNew,direction:"slds-nubbin_bottom-left"},on:{"update:isOpen":function(e){t.addNew=e},"update:is-open":function(e){t.addNew=e}}},[s("div",{staticClass:"slds-grid",attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-col search-dropdown-wrap"},[s("MASearch",{ref:"addStopMASearch",attrs:{searches:t.searches,placeholder:t.Labels.MA_Search_Loc_Add+"...",loadingLabel:t.$Labels.MA_Loading,noSearchResultsLabel:t.$Labels.MA_NO_RESULTS_FOUND,outputType:"list"},on:{clear:t.clearResults,selected:t.reactToSelectedPlace},scopedSlots:t._u([{key:"result",fn:function(e){return s("span",{staticClass:"slds-listbox__option-text_entity slds-listbox__option slds-listbox__option_plain",attrs:{id:"listbox-option-unique-id-01"}},[t._v("\n                        "+t._s(t._f("decode")(e.result.description))+"\n                    ")])}}]),model:{value:t.searchTerm,callback:function(e){t.searchTerm=e},expression:"searchTerm"}})],1),t._v(" "),s("div",{staticClass:"slds-p-left_x-small cancel-button-wrap"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.doHide}},[t._v(t._s(t.Labels.MA_Cancel))])])])])],1)}),[],!1,null,"6f1c8241",null).exports),Yt=s(578),Vt=s(19),zt=s(141);function Jt(t){return function(t){if(Array.isArray(t))return Kt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Kt(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Kt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kt(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,o=new Array(e);s<e;s++)o[s]=t[s];return o}function Qt(t){return(Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xt(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}function Zt(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?Xt(Object(s),!0).forEach((function(e){te(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Xt(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function te(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var ee=window,se=ee.MA,oe=ee.moment,ie={components:{RouteHeader:tt,RouteControlBar:pt,RouteBody:Nt,RouteAddStop:qt,RouteSummary:Yt.a,MAToast:zt.a,MAModal:P.a,MASpinner:Vt.a},props:{storedRoute:{type:Object,required:!0},asset:{type:Object,required:!0}},data:function(){return{date:{},toast:"",routing:null,showPendingChangeModal:!1,pendingPrint:!1,onMap:!1,Labels:window.MASystem.Labels}},computed:Zt(Zt({routeData:function(){return Zt(Zt({},this.store__route),{},{waypoints:this.store__waypoints,Name:this.store__record.Name})},isNewRoute:function(){return!this.store__record.Id},routeType:function(){return this.store__isTimeBased?u.a.TIME_BASED_ROUTE:u.a.ROUTE},startCount:function(){return 0!==Object.keys(this.store__first||{}).length?1:0},lastCount:function(){return 0!==Object.keys(this.store__last||{}).length?1:0}},Object(a.mapGetters)("routes",{store__route:"route",store__record:"record",store__pendingChanges:"pendingChanges",store__unsavedChanges:"unsavedChanges",store__travelMode:"travelMode",store__routeCallouts:"routeCallouts",store__lockOrder:"lockOrder",store__waypoints:"waypoints",store__first:"first",store__last:"last",store__totalStopCount:"totalStopCount",store__isTimeBased:"isTimeBased"})),Object(a.mapGetters)("tabs",{tabs__isTabActive:"isTabActive"})),watch:{store__pendingChanges:function(){this.store__pendingChanges&&(this.store__setUnsavedChanges(!0),this.clearRouteMap(),this.onMap=!1)}},created:function(){this.$bus.$on("hide-plotted-route",this.hideRoute),this.$bus.$on("add-to-new-route",this.addToNewRouteHandler),this.$bus.$on("zoom-to-fit-route",this.zoomToFitRoute),this.initalLoadRoute()},mounted:function(){this.store__setPendingChange(this.isNewRoute)},destroyed:function(){this.$bus.$off("hide-plotted-route",this.hideRoute),this.$bus.$off("add-to-new-route",this.addToNewRouteHandler),this.$bus.$off("zoom-to-fit-route",this.zoomToFitRoute)},methods:Zt(Zt(Zt(Zt({},Object(a.mapMutations)("tabs",{tabs__setTab:"setTab"})),Object(a.mapMutations)("routes",{store__setUnsavedChanges:"setUnsavedChanges",store__setPendingChange:"setPendingChange",store__clearRoute:"clearRoute",store__updateRoute:"updateRoute",store__updateRecord:"updateRecord",store__clearRecord:"clearRecord",store__addRouteCallout:"addRouteCallout",store__removeRouteCallout:"removeRouteCallout",store__setTravelMode:"setTravelMode",store__setFirst:"setFirst",store__setLast:"setLast",store__appendWaypoints:"appendWaypoints",store__clearWaypointData:"clearWaypointData"})),Object(a.mapActions)("routes",{store__loadWaypoints:"loadWaypoints",store__updateFirst:"updateFirst",store__updateLast:"updateLast",store__clearRoute:"clearRoute",store__clearWaypoints:"clearWaypoints",store__resetRouteFlags:"resetRouteFlags"})),{},{hidePendingChangeModal:function(){this.showPendingChangeModal=!1},saveAndClose:function(){this.$bus.$emit("save-close-route")},back:function(){this.store__unsavedChanges?this.showPendingChangeModal=!0:this.exitRoute()},exitRoute:function(){this.clearRouteMap(),this.$emit("hideRoute")},exitAndDeleteRoute:function(){this.exitRoute(),this.store__record.Id&&this.$emit("deleteRoute",this.store__record.Id)},clearRouteMap:function(){this.routing&&(se.Map.InfoBubble.hide(),this.routing.clearRouteOnMap())},resetRoute:function(){this.store__clearRoute(),this.clearRouteMap(),this.applyRouteDefaults(),this.store__setPendingChange(!0)},hideRoute:function(){this.toggleRoute(!1)},toggleRoute:function(t){this.onMap=t,this.onMap?this.store__pendingChanges||this.store__route.hasWaypointError||!this.store__pendingChanges&&!this.routing?this.getMAIORoute(!this.store__lockOrder):this.routing&&(this.$bus.$emit("hide-plotted-schedule"),this.routing.restoreRouteOnMap()):this.routing&&(se.Map.InfoBubble.hide(),this.routing.hideRouteOnMap())},initalLoadRoute:function(){if(this.store__clearRecord(),this.store__updateRecord(this.storedRoute.record),delete this.storedRoute.record,this.store__clearRoute(),this.store__updateRoute(this.storedRoute),this.store__loadWaypoints({waypoints:this.store__route.waypoints,isNew:this.isNewRoute}),this.store__resetRouteFlags(),this.store__route.travelMode&&this.store__setTravelMode(this.store__route.travelMode),this.isNewRoute)return u.b.isWaypointLengthLessThanMax(this.store__totalStopCount,this.routeType),void this.applyRouteDefaults();this.getMAIORoute()},getMAIORoute:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.validateWaypoints()?this.$nextTick((function(){t.onMap=!1})):(this.$bus.$emit("hide-plotted-schedule"),this.store__addRouteCallout(),this.store__clearWaypointData(),this.clearRouteMap(),this.routing=(new r.a).setWaypoints(this.store__waypoints).setOptimized(e).setDriveProfile(this.store__travelMode).setTraffic(d.a.isTrafficEnabled).setFirstWaypoint(this.store__first).setLastWaypoint(this.store__route.last).setIsGuideRoute(this.store__route.isGuideRoute),this.store__isTimeBased&&(this.routing.setRouteTimeBasedOptions(this.store__route.timeBasedOptions).setFirstWaypoint(this.store__first).setLastWaypoint(this.store__last).setTimeBased(!0),this.store__route.isGuideRoute?this.routing.setTimebasedlegacy(!0):this.routing.setTimebasedlegacy(!1)),this.routing.build("routing").then((function(){n.a.moreThanOneRoute(t.routing.route)?t.routing.route.routes.forEach((function(e){t.applyRoutingResult(e,t.routing.route)})):t.applyRoutingResult(t.routing.route,t.routing.route)})).catch((function(e){t.onMap=!1,t.showRoutingErrors(e),console.warn(e)})).finally((function(){t.store__removeRouteCallout()})))},validateWaypoints:function(){return!u.b.isWaypointLengthLessThanMax(this.store__totalStopCount,this.routeType)||!u.b.isWaypointLengthGreaterThanMin(this.store__totalStopCount,this.routeType)},showRoutingErrors:function(t){if(!t||!t.maioCode&&!t.status){if(!(t&&"object"===Qt(t)&&"string"==typeof t.message&&0===t.message.indexOf("Waypoint ")&&t.message.indexOf(" is not schedulable")>0))return;var e=t.message.substring(t.message.indexOf("Waypoint ")+9,t.message.indexOf(" is not schedulable"));t.maioCode=82016,t.details=[{id:e}]}u.b.showErrorMessage(t.maioCode,this.routeType);var s=u.b.getWaypointErrorMessage(t.maioCode,this.routeType);if(s&&t.details&&0!==t.details.length&&t.details[0].id){var o=this.store__waypoints;this.store__clearWaypoints();var i=[];o.forEach((function(e){e.id===t.details[0].id?i.push(Object.assign({},e,{errorMsg:void 0!==t.details[0].errormessage&&"Unreachable"===t.details[0].errormessage?t.details[0].errormessage:s,erroramount:void 0!==t.details[0].erroramount&&t.details[0].erroramount>=200?t.details[0].erroramount:200})):i.push(e)})),i.length>0&&this.store__appendWaypoints(i)}},applyRoutingResult:function(t,e){var s=this;this.store__setPendingChange(!1),!e.hasWaypointError||this.store__route.isGuideRoute?(this.store__updateRoute({url:e.url,boundingbox:e.boundingbox,hasWaypointError:!1}),this.onMap=!0):(this.store__updateRoute({hasWaypointError:!0}),this.onMap=!1);var o=this.store__waypoints;this.store__clearWaypoints();var i=[],a=!1;t.summary.totaltraveltime=0;for(var n=function(e){var n=t.waypoints[e];(n.totaltraveltime=60*Math.round(n.totaltraveltime/60),t.summary.totaltraveltime+=n.totaltraveltime,n.errormessage)&&(console.error(n.errormessage),0!==e&&t.waypoints[0].start&&n.erroramount&&oe.unix(t.waypoints[0].start).format("MM-DD-YYYY")!==oe.unix(n.start).format("MM-DD-YYYY")&&(n.errormessage="Your first stop is on a different day. Please remove the stop, because it's too far away, or disable time based routes."));if(n.isFirst){var r=s.applyMAIODataToWaypoint(s.store__first,n);s.store__setFirst(r)}else if(n.isLast){var l=s.applyMAIODataToWaypoint(s.store__last,n);s.store__setLast(l)}else{var u=o.find((function(t){return t.id===n.id}));if(u){var d=s.applyMAIODataToWaypoint(u,n);!a&&d.errorMsg&&(d.scrollToThisError=!0,a=!0),i.push(d)}}},r=0;r<t.waypoints.length;r++)n(r);this.store__updateRoute({summary:t.summary}),i.length>0&&this.store__appendWaypoints(i),this.pendingPrint&&this.$bus.$emit("ready-to-print"),this.store__isTimeBased&&!this.store__route.isGuideRoute&&this.maxTimeGap()},applyMAIODataToWaypoint:function(t,e){return Object.assign({},t,{index:e.index,distance:e.distance,nontraffictime:e.nontraffictime,totaltraveltime:e.totaltraveltime,maneuvers:e.maneuvers,tooltipMetadata:e.tooltipMetadata,duration:e.duration,start:e.start,errorMsg:e.errormessage,erroramount:e.erroramount,arrivaltime:e.arrivaltime,departuretime:e.departuretime})},applyRouteDefaults:function(){var t=this,e=d.a.routeDefaults,s=e.startLocationId,o=e.endLocationId;(s||o)&&(this.store__addRouteCallout(),l.a.getFavoriteInfo(s).then((function(e){return t.store__updateFirst(e),s===o&&t.store__route.first&&t.store__route.first.id?Promise.resolve({Name:e.Name,Address__c:e.Address__c,lat:e.lat,lng:e.lng,id:Object(i.f)(),Options__c:d.a.defaultStartEndOptions,record:e.record}):l.a.getFavoriteInfo(o)})).then((function(e){t.store__updateLast(e)})).catch((function(e){t.toast="failed to load default start/stop locations",console.warn(e)})).finally((function(){t.store__removeRouteCallout()})))},addToNewRouteHandler:function(t){var e=this;this.store__unsavedChanges?(this.tabs__isTabActive(i.b.ROUTES)||this.tabs__setTab(i.b.ROUTES),this.toast="Please save your current route first."):(this.exitRoute(),this.$nextTick((function(){e.$bus.$emit("add-to-route",t)})))},zoomToFitRoute:function(t){var e=!1;t.isEmpty()&&(e=!0),t.extend(this.store__route.boundingbox.southwest),t.extend(this.store__route.boundingbox.northeast),se.map.fitBounds(t),e&&se.map.setZoom(se.map.getZoom()-1)},maxTimeGap:function(){var t=0;return[].concat(Jt(this.store__waypoints),[this.store__route.first,this.store__route.last]).forEach((function(e,s,o){if(s){var i=se.getProperty(o,[s-1]),a=se.getProperty(e,"Options__c"),n=se.getProperty(i,"Options__c");try{"string"==typeof a&&(a=JSON.parse(window.htmlDecode(e.Options__c))),"string"==typeof n&&(n=JSON.parse(window.htmlDecode(o[s-1].Options__c)))}catch(t){}var r=oe(se.getProperty(a,"TimeBasedOptions.Start"),"h:mm a"),l=oe(se.getProperty(n,"TimeBasedOptions.Start"),"h:mm a");if(l){var u=se.getProperty(n,"TimeBasedOptions.Duration");"string"==typeof u&&u.split(",").forEach((function(t){var e=t.trim().replace("hr","hour").replace("min","minute").split(/\s+/);2===e.length&&window.isNum(e[0])&&(l=l.add(e[0],e[1]))}))}if(r.isValid()&&l.isValid()){var d=Math.abs(r.valueOf()-l.valueOf())/1e3;i.timeGap=d,d>t&&(t=d)}}})),t}})},ae=(s(599),Object(g.a)(ie,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-grid slds-grid--vertical",attrs:{id:"routesSingleWrapper"}},[s("MASpinner",{directives:[{name:"show",rawName:"v-show",value:t.store__routeCallouts>0,expression:"store__routeCallouts > 0"}],attrs:{loadingLabel:t.$Labels.MA_Loading}}),t._v(" "),t.toast?s("MAToast",{attrs:{msg:t.toast,closeLabel:t.$Labels.MA_Close,errorLabel:t.$Labels.MA_Error},on:{close:function(e){t.toast=""}}}):t._e(),t._v(" "),t.showPendingChangeModal?s("MAModal",{attrs:{title:t.Labels.MA_Route_SaveChanges,closeLabel:t.$Labels.MA_Close},on:{close:t.hidePendingChangeModal}},[s("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n            "+t._s(t.Labels.DO_YOU_WANT_TO_SAVE_YOUR_CHANGES_BEFORE_CONTINUING_PROMPT)+"\n        ")]),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.hidePendingChangeModal}},[t._v(t._s(t.Labels.MA_Cancel))]),t._v(" "),s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.exitRoute}},[t._v(t._s(t.Labels.MA_Close_Discard))]),t._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:t.saveAndClose}},[t._v(t._s(t.Labels.MA_Save_Close))])])]):t._e(),t._v(" "),s("RouteHeader",{attrs:{asset:t.asset},on:{back:t.back,exit:t.exitRoute,deleteRoute:t.exitAndDeleteRoute,resetRoute:t.resetRoute,generate:t.getMAIORoute}}),t._v(" "),s("RouteControlBar",{attrs:{onMap:t.onMap,showOnTheMapToggle:null!=t.routing},on:{generate:t.getMAIORoute,toggleRoute:t.toggleRoute}}),t._v(" "),s("RouteBody",{class:{"route-line-is-drawn":t.onMap,"start-location-exists":t.startCount,"end-location-exists":t.lastCount}}),t._v(" "),s("RouteSummary",{attrs:{route:t.routeData,pendingChanges:t.store__pendingChanges,pendingPrint:t.pendingPrint},on:{"update:pendingPrint":function(e){t.pendingPrint=e},"update:pending-print":function(e){t.pendingPrint=e},generate:t.getMAIORoute}},[s("RouteAddStop",{attrs:{slot:"button"},slot:"button"})],1)],1)}),[],!1,null,"3c081cfe",null).exports);function ne(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}function re(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var le=window,ue=le.moment,de=le.MASystem,ce=le.MA,pe={components:{MASelect:A,AssetSearch:w},directives:{"click-outside":st.a},props:{month:{type:Number,required:!0},year:{type:Number,required:!0},asset:{type:Object,required:!0}},data:function(){return{date:{},monthString:"",yearMin:2010,yearMax:2022,showDateWidget:!1,searchTerm:de.User.FullName,dateChanged:!1}},computed:function(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?ne(Object(s),!0).forEach((function(e){re(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ne(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}({clickOutsideOptions:function(){return{active:this.showDateWidget,handler:this.hideDateWidget}},monthAndYear:function(){return"".concat(this.monthString," ").concat(this.year)},months:function(){return this.getMonths()},years:function(){return this.getYears()}},Object(a.mapGetters)("tabs",{tabs__isTabActive:"isTabActive"})),watch:{month:function(){var t=this;this.date.month(this.month);var e=this.getMonths().filter((function(e){return e.key===t.month}));if(e.length>0){var s=e[0];this.monthString=s.value}else this.monthString=this.date.format("MMMM");this.showDateWidget||!0!==this.tabs__isTabActive(i.b.ROUTES)?this.dateChanged=!0:this.$emit("refresh-list")},year:function(){this.date.year(this.year),this.showDateWidget?this.dateChanged=!0:this.$emit("refresh-list")},asset:function(){this.asset&&this.asset.Name&&(this.searchTerm=this.asset.Name)}},created:function(){this.setDateToToday()},methods:{updateMonth:function(t){this.$emit("update:month",t)},updateYear:function(t){this.$emit("update:year",t)},hideDateWidget:function(t){var e=document.getElementById("ma-dropdowns");t.target.contains(e)||(this.showDateWidget&&this.dateChanged&&(this.$emit("refresh-list"),this.dateChanged=!1),this.showDateWidget=!1)},setDateToToday:function(){this.date=ue(),this.updateMonth(this.date.month()),this.updateYear(this.date.year())},todayClick:function(t){this.hideDateWidget(t),this.setDateToToday()},previousMonth:function(){this.date.subtract(1,"M"),this.updateMonth(this.date.month()),this.updateYear(this.date.year())},nextMonth:function(){this.date.add(1,"M"),this.updateMonth(this.date.month()),this.updateYear(this.date.year())},getYears:function(){for(var t=[],e=this.yearMin;e<=this.yearMax;e++)t.push(e);return t},getMonths:function(){return[{key:0,value:this.$Labels.MA_January},{key:1,value:this.$Labels.MA_February},{key:2,value:this.$Labels.MA_March},{key:3,value:this.$Labels.MA_April},{key:4,value:this.$Labels.MA_May},{key:5,value:this.$Labels.MA_June},{key:6,value:this.$Labels.MA_July},{key:7,value:this.$Labels.MA_August},{key:8,value:this.$Labels.MA_September},{key:9,value:this.$Labels.MA_October},{key:10,value:this.$Labels.MA_November},{key:11,value:this.$Labels.MA_December}]},reactToSelectedAsset:function(t){var e=this;this.$emit("clear-routes"),t&&t.id?(this.$emit("update:asset",{Id:t.id,Name:t.label,field:ce.getProperty(t,["fields",0,"apiName"]),type:ce.getProperty(t,["fields",0,"label"])}),this.$nextTick((function(){e.$emit("refresh-list")}))):this.searchTerm=""},openNewRoute:function(){this.$emit("open-new-route")}}},he=(s(600),Object(g.a)(pe,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-grid slds-p-top_small slds-p-bottom_x-small slds-p-horizontal_medium",attrs:{id:"routesIndexHeader"}},[s("div",{staticClass:"slds-p-right_x-small"},[s("AssetSearch",{attrs:{storedSearchTerm:t.searchTerm,placeholder:t.$Labels.MA_Search_Users_Assets},on:{selected:t.reactToSelectedAsset}})],1),t._v(" "),s("div",{staticClass:"slds-button-group slds-p-right_xx-small prev-next-button-group"},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",on:{click:t.previousMonth}},[s("span",{staticClass:"slds-button__icon ma-icon ma-icon-chevronleft"})]),t._v(" "),s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",on:{click:t.nextMonth}},[s("span",{staticClass:"slds-button__icon ma-icon ma-icon-chevronright"})])]),t._v(" "),s("div",{directives:[{name:"click-outside",rawName:"v-click-outside:[clickOutsideOptions]",arg:t.clickOutsideOptions}],attrs:{id:"routesIndexMonthSelectorWrap"}},[s("button",{staticClass:"slds-button routes-index-month-button",attrs:{id:"routesIndexMonthSelectorLabel"},on:{click:function(e){t.showDateWidget=!0}}},[t._v("\n            "+t._s(t.monthAndYear)+"\n        ")]),t._v(" "),t.showDateWidget?s("div",{staticClass:"slds-nubbin_top",attrs:{id:"routesIndexMonthSelectorBody"}},[s("div",{staticClass:"slds-grid slds-p-around_medium"},[s("div",{staticClass:"slds-form-element slds-col slds-p-right_xx-small"},[s("div",{staticClass:"slds-form-element__control"},[s("MASelect",{attrs:{value:t.month,doDetach:!0,options:t.months,hasNoneOption:!1},on:{input:t.updateMonth}})],1)]),t._v(" "),s("div",{staticClass:"slds-form-element slds-col"},[s("div",{staticClass:"slds-form-element__control"},[s("MASelect",{attrs:{value:t.year,options:t.years,hasNoneOption:!1},on:{input:t.updateYear}})],1)])]),t._v(" "),s("div",{staticClass:"slds-grid",attrs:{id:"routesIndexMonthSelectorFooter"}},[s("div",[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.todayClick}},[t._v(t._s(t.$Labels.MA_This_Month))])]),t._v(" "),s("div",{staticClass:"slds-col_bump-left"}),t._v(" "),s("div",[s("button",{staticClass:"slds-button slds-button_brand",on:{click:t.hideDateWidget}},[t._v(t._s(t.$Labels.MA_Done))])])])]):t._e()]),t._v(" "),s("div",{staticClass:"slds-col_bump-left"}),t._v(" "),s("div",[s("button",{staticClass:"slds-button slds-button_brand",attrs:{id:"openNewRouteButton"},on:{click:t.openNewRoute}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-new",attrs:{"aria-hidden":"true"}}),t._v("\n            "+t._s(t.$Labels.MA_New)+"\n        ")])])])}),[],!1,null,"5f452936",null).exports);function _e(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,o)}return s}function me(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?_e(Object(s),!0).forEach((function(e){fe(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):_e(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function fe(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var ve=window,be=ve.MASystem,ye=ve.moment,ge=ve.MA,we={components:{Route:ae,ConfirmDelete:F,ListHeader:he,MAToast:zt.a,MASpinner:Vt.a},data:function(){return{Tabs:i.b,toast:"",asset:{Id:ge.getProperty(be,"User.Id")||"",Name:ge.getProperty(be,"User.FullName")||"",field:"sma__User__c",type:be.Labels.MA_User},month:-1,year:0,routes:{},route:{record:{},waypoints:[]},showRouteCmp:!1,isLoading:!1,routeCounter:1,showPastRoutes:!0,showConfirmDelete:!1,deleteRouteId:"",Labels:window.MASystem.Labels}},computed:me({showRouteList:function(){return!this.showRouteCmp},togglePastRoutesLabel:function(){return this.showPastRoutes?this.Labels.MA_Hide_Past_Routes:this.Labels.MA_Show_Past_Routes},noRoutes:function(){return 0===Object.keys(this.routes).length},routesList:function(){var t=this,e=[];return Object.keys(this.routes).forEach((function(s){if(!t.showPastRoutes){var o=ye().date(s).month(t.month).year(t.year);if(ye()>o)return}t.routes[s].forEach((function(t){t.dayOfMonth=s,e.push(t)}))})),e}},Object(a.mapGetters)("tabs",{tabs__isTabActive:"isTabActive"})),created:function(){this.$bus.$on("refresh-route-list",this.getRoutes),this.$bus.$on("display-route",this.displayRoute),this.$bus.$on("add-to-route",this.addToRouteHandler),this.$bus.$on("add-to-new-route",this.addToNewRouteHandler),this.$bus.$on("update-asset",this.updateAsset)},destroyed:function(){this.$bus.$off("refresh-route-list",this.getRoutes),this.$bus.$off("display-route",this.displayRoute),this.$bus.$off("add-to-route",this.addToRouteHandler),this.$bus.$off("add-to-new-route",this.addToNewRouteHandler),this.$bus.$off("update-asset",this.updateAsset)},methods:me(me(me(me({},Object(a.mapMutations)("tabs",{tabs__setTab:"setTab"})),Object(a.mapMutations)("routes",{store__setIsTimeBased:"setIsTimeBased"})),Object(a.mapActions)("routes",{store__addWaypoints:"addWaypoints"})),{},{togglePastRoutes:function(){this.showPastRoutes=!this.showPastRoutes},hideRoute:function(){this.route={},this.showRouteCmp=!1},clearRoutes:function(){this.routes={}},displayRoute:function(t){var e=this;t?(this.isLoading=!0,this.showRouteCmp=!1,this.$nextTick((function(){l.a.getRoute(t).then((function(t){e.setRoute(t.route,t.multiday),e.setRouteWaypoints(t.waypoints,t.multiday),e.showRouteCmp=!0})).catch((function(t){e.toast=t.message,console.warn(t)})).finally((function(){e.isLoading=!1}))}))):this.toast="No id provided for display-route request."},setRoute:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];ge.Util.removeNamespace(t,"sma__"),ge.Util.removeNamespace(t,"mamd__");var s=t.Options__c?JSON.parse(Object(i.e)(t.Options__c)):{};e&&(t.Date__c=t.Route_Date__c),this.$set(this.route,"travelMode",s.DriveProfile||""),this.$set(this.route,"timeBasedOptions",s.TimeBasedOptions||d.a.defaultOptions),this.$set(this.route,"isGuideRoute",e),this.$set(this.route,"record",t)},setRouteWaypoints:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=[];t.forEach((function(t){ge.Util.removeNamespace(t,"sma__"),ge.Util.removeNamespace(t,"mamd__");var a=t.Options__c?JSON.parse(Object(i.e)(t.Options__c)):{};switch(s&&(t.Latitude__c=t.Lat_Long__c.latitude,t.Longitude__c=t.Lat_Long__c.longitude,t.BaseObject__c=t.Base_Object_Api__c,t.LinkId__c=t.Routed_Object_Id__c,t.MASavedQry__c=t.MapAnything_Saved_Query_Id__c),"start"!==a.LockType&&"end"!==a.LockType||(a.TimeBasedOptions.Duration="0 hr, 0 min",s||(a.TimeBasedOptions.Start="Set start time..."),t.Options__c=a),"undefined"===t.Notes__c&&(t.Notes__c=void 0),a.LockType){case"start":e.route.first=e.processWaypoint(t);break;case"end":e.route.last=e.processWaypoint(t);break;case"startend":e.route.first=e.processWaypoint(t),e.route.last=e.processWaypoint(t);break;case"unlocked":o.push(e.processWaypoint(t))}})),this.$set(this.route,"waypoints",o)},processWaypoint:function(t){return Object.assign({},t,{lat:t.Latitude__c,lng:t.Longitude__c,id:Object(i.f)(),recordId:t.Id})},confirmDeleteRoute:function(t,e){e&&e.stopPropagation(),t?(this.deleteRouteId=t,this.showConfirmDelete=!0):this.toast="No id provided for delete-route request."},deleteRouteFromList:function(){this.deleteRoute(this.deleteRouteId)},deleteRoute:function(t){var e=this;t?(this.isLoading=!0,l.a.deleteRoute(t).then((function(){e.getRoutes(),e.deleteRouteId="",e.showConfirmDelete=!1})).catch((function(t){e.toast=t.message,console.warn(t)})).finally((function(){e.isLoading=!1}))):this.toast="No id provided for delete-route request."},getRoutes:function(){var t=this;this.isLoading=!0,l.a.getMARoutes({month:this.month,year:this.year,lookupId:this.asset.Id,lookupField:this.asset.field}).then((function(e){t.routes=e.routes})).catch((function(e){t.routes={},t.toast=e.message,console.warn(e)})).then((function(){t.isLoading=!1}))},openNewRoute:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];try{var s=be&&be.User?be.User.timezoneId:void 0;t=s?ye().tz(s):ye()}catch(e){t=ye()}var o="";try{o=t.format(be.User.dateFormat.toUpperCase())}catch(e){o=t.format("MM-DD-YYYY")}!d.a.enabledDuplicateStops&&e&&e.length>0&&(e=this.removeDuplicates(e));var i={travelMode:d.a.mode,waypoints:e,record:{Name:"".concat(this.Labels.MA_ROUTE," ").concat(this.routeCounter," (").concat(o,")"),Date__c:t.format("YYYY-MM-DD"),User__c:be.User.Id,User__r:{Name:be.User.FullName,Id:be.User.Id},Options__c:d.a.defaultOptions},isGuideRoute:!1,timeBasedOptions:d.a.timeBasedOptions};this.routeCounter+=1,this.route=i,this.showRouteCmp=!0},removeDuplicates:function(t){var e=[];return t.forEach((function(t){var s=!1;e.forEach((function(e){(t.LinkId__c&&t.LinkId__c===e.LinkId__c||t.Name===e.Name&&t.Address__c===e.Address__c)&&(s=!0)})),s||e.push(t)})),e},addToRouteHandler:function(t){this.tabs__isTabActive(i.b.ROUTES)||this.tabs__setTab(i.b.ROUTES);var e=!1,s=[];t.forEach((function(t){if(t.id=Object(i.f)(),t.Name=t.title,t.Address__c=t.address||t.marker.address||t.marker.FormattedAddress_MA,t.Options__c=d.a.defaultOptions,t.marker&&t.marker.StartDateTime&&t.marker.EndDateTime){e=!0,t.marker.DurationInMinutes=(t.marker.EndDateTime-t.marker.StartDateTime)/1e3/60;var o=n.a.processEventData(t.marker);t=me(me({},t),o)}s.push(t)})),e&&this.store__setIsTimeBased(!0),this.showRouteCmp?this.store__addWaypoints(s):this.openNewRoute(s)},addToNewRouteHandler:function(t){this.showRouteCmp||this.addToRouteHandler(t)},updateAsset:function(t){this.asset=me({},t)}})},Me=(s(601),s(602),Object(g.a)(we,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"routesPanel left-ui-panel",class:{"is-in":t.tabs__isTabActive(t.Tabs.ROUTES)}},[s("MASpinner",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}],attrs:{loadingLabel:t.$Labels.MA_Loading}}),t._v(" "),t.toast?s("MAToast",{attrs:{msg:t.toast,closeLabel:t.$Labels.MA_Close,errorLabel:t.$Labels.MA_Error},on:{close:function(e){t.toast=""}}}):t._e(),t._v(" "),s("ConfirmDelete",{attrs:{doShow:t.showConfirmDelete},on:{"update:doShow":function(e){t.showConfirmDelete=e},"update:do-show":function(e){t.showConfirmDelete=e},"delete-route":t.deleteRouteFromList}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showRouteList,expression:"showRouteList"}],attrs:{id:"routesIndexWrapper"}},[s("ListHeader",{attrs:{month:t.month,year:t.year,asset:t.asset},on:{"update:month":function(e){t.month=e},"update:year":function(e){t.year=e},"update:asset":function(e){t.asset=e},"refresh-list":t.getRoutes,"open-new-route":t.openNewRoute,"clear-routes":t.clearRoutes}}),t._v(" "),s("div",{staticClass:"slds-p-bottom_x-small slds-p-top_xx-small slds-p-horizontal_medium past-routes-button-wrap"},[s("button",{staticClass:"slds-button",on:{click:t.togglePastRoutes}},[t._v("\n                "+t._s(t.togglePastRoutesLabel)+"\n            ")])]),t._v(" "),s("div",{attrs:{id:"routesIndexBody"}},[s("div",{attrs:{id:"routesIndexList"}},[t._l(t.routesList,(function(e){return s("div",{key:e.routeId,staticClass:"routes-index-list-item",on:{click:function(s){return t.displayRoute(e.routeId)}}},[s("div",{staticClass:"routes-index-list-item-click-area"},[s("div",{staticClass:"routes-index-list-item-date"},[s("div",{staticClass:"routes-index-list-item-date-image"}),t._v(" "),s("div",{staticClass:"routes-index-list-item-date-number"},[t._v(t._s(e.dayOfMonth))])]),t._v(" "),s("div",{staticClass:"slds-col slds-p-left_medium",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"routes-index-list-item-title"},[t._v("\n                                "+t._s(t._f("decode")(e.route.Name))+"\n                            ")]),t._v(" "),s("div",{staticClass:"routes-index-list-item-description"},[t._v("\n                                "+t._s(e.waypoints.length)+" "+t._s(t.Labels.MA_STOPS)+"\n                                "),e.guideGeneratedRoute?s("span",[t._v(" - Generated by Guide")]):t._e()])])]),t._v(" "),s("div",{staticClass:"routes-index-list-item-overflow-actions"},[s("div",{staticClass:"slds-hint-parent"},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",on:{click:function(s){return t.confirmDeleteRoute(e.routeId,s)}}},[s("span",{staticClass:"slds-button__icon slds-button__icon_hint ma-icon ma-icon-delete"})])])])])})),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.noRoutes,expression:"noRoutes"}],staticClass:"no-routes routesIndexEmptyState"},[s("div",{staticClass:"slds-notify_container--inline slds-p-around--large slds-text-align--center"},[t._m(0),t._v(" "),s("h4",[t._v(t._s(t.Labels.MA_No_Saved_Routes))]),t._v(" "),s("p",[t._v(t._s(t.Labels.MA_Select)+" "),s("button",{staticClass:"routesIndexEmptyStateButton slds-button slds-button_disabled"},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-new"}),t._v(" "+t._s(t.Labels.MA_New))]),t._v(" "+t._s(t.Labels.MA_Select_Part2))])])])],2)])],1),t._v(" "),s("transition",{attrs:{name:"single-route"}},[t.showRouteCmp?s("Route",{key:"singleRoute",attrs:{storedRoute:t.route,asset:t.asset},on:{hideRoute:t.hideRoute,deleteRoute:t.deleteRoute}}):t._e()],1)],1)}),o,!1,null,"44264b60",null));e.default=Me.exports}}]);