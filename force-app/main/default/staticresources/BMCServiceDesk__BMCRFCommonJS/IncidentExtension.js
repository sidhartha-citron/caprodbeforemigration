var disableTrue=true;var closeIncidentWindow;function closeIncident(){if(!closeIncidentWindow||closeIncidentWindow.closed){closeIncidentWindow=openWindow("/apex/closeIncidentPage?calledFrom=stdform&popupHeader="+IncidentPage.Labels.CloseIncident+"&incidentId="+incidentId+"&isLookup=true&IncidentCat="+incidentCategoryId)}if(closeIncidentWindow.focus){closeIncidentWindow.focus()}return !closeIncidentWindow}function openWindow(c,b){if(!b){b="status = 1,height = "+stdLayoutScreenHeight+", width = "+stdLayoutScreenWidth+",left="+stdScreenLeft()+",top="+stdScreenTop()+", resizable = 1,scrollbars=yes"}var a=window.open(c,"_blank",b);a.focus();return a}Ext.onReady(function(){if(isLookup){disableTrue=true;separator=""}else{disableTrue=false;separator="-"}var y;var j=function(M,N){var O="Client";if(!y||y.closed){y=openWindow("/apex/SearchPage?popupId=Incident&isLookup=true&standardLayout=true&popupFor=incidentsforclient&popupHeader=Select From Inci&isLookup=true&filterClause="+escape("FKClient__c='"+clientId+"'"))}if(y.focus){y.focus()}return !y};var C;var x=function(M,N){var O="Category";if(!C||C.closed){C=openWindow("/apex/SearchPage?popupId=Incident&filterClause="+escape("FKCategory__c='"+categoryId+"'")+"&isLookup=true&standardLayout=true&popupFor=incidentsforcategory&popupHeader=Select From Incidents")}if(window.focus){C.focus()}return !C};var L;var u;var i=function(M,N){if(M.id=="AssignToStaff"){profileName="ServiceDesk Staff";type="Staff";if(!L||L.closed){L=openWindow("/apex/SearchPage?standardLayout=true&popupFor=Assignto&popupHeader=Select From Staff&popupId=Client&isLookup=true&filterClause="+escape("IsStaffUser__c=true"))}if(L.focus){L.focus()}return !L}else{if(M.id=="AssignToMemberOf"){11;profileName=getProfileName();type="SysAdmin";if(!u||u.closed){u=openWindow("/apex/SearchPage?standardLayout=true&popupFor=Assignto&popupHeader=Select From Staff&popupId=Client&isLookup=true&filterClause="+escape("profileid='"+getProfileID()+"'And IsStaffUser__c=true "))}if(u.focus){u.focus()}return !u}}};var K;var w=function(M,N){if(!K||K.closed){K=openWindow("/apex/SearchPage?standardLayout=true&popupFor=Assignto&popupHeader=Select From Staff&popupId=SuggestedStaff&isLookup=true&isActiveUser=true&categoryId="+getIncidentCategory()+"&filterClause="+escape("FKUser__r.IsStaffUser__c=true"))}if(K.focus){K.focus()}return !K};var t;var a=function(M,N){if(!t||t.closed){t=openWindow("/apex/SearchPage?standardLayout=true&popupFor=Assignto&popupHeader=Select From Queue&popupId=Queue&isQueurorUser=true&isLookup=true&queueFor=Incident__c&isOnlyQueueList=true&filterClause="+escape("sobjectType='"+objName+"'"))}if(t.focus){t.focus()}return !t};var c=function(M,N){AssignedToMyselfNext()};var v;var q=function(P,R){if(!v||v.closed){var Q=1000;var M=1000;var O=parseInt((screen.availWidth/2)-(Q/2));var N=parseInt((screen.availHeight/2)-(M/2));v=openWindow("/apex/incProcMgmtPage","status = 1, height = 1000, width = 1000,left="+O+",top="+N+", resizable = 1,scrollbars=yes")}if(v.focus){v.focus()}return !v};var k=function(M,N){o()};function o(){quickCloseIncidentNext()}var I=function(M,N){p()};var A=function(M,N){reOpenIncident()};var B=function(M,N){callCounterBtnHandler()};var F;var r=function(M,N){D();if(!F||F.closed){F=openWindow("/apex/KnowledgeSearch?calledFromForm=true&standardLayout=true&popupHeader="+IncidentPage.Labels.GlobalSearch+"&search="+KMdescription+"&KMincidentID="+incidentId)}if(F.focus){F.focus()}return !F};var E;var E;var g=getIncidentName();var e=g;var b=function(M,N){if(!E||E.closed){E=openWindow("/apex/ComposeEmailPage?recordId="+incidentId+"&isNew=true&objectName=Incident__c&standardLayout=true&popupHeader="+e+"&popupFor=sendEmail")}if(E.focus){E.focus()}return !E};var m;var H=function(N,P){var M="fieldList=";M+=f("Id,Name,ClockState__c,StartDate__c,EndDate__c,ElapsedTime__c,TimeRemaining__c,TargetType__c,StateValue__c,Status__c");M+="&object=";M+=f("Incident_Service_Target__c");M+="&whereClause=";M+=f("FKIncident__c=");var O=getIncidentName();if(!m||m.closed){m=openWindow("/apex/SearchPage?popupId=IncidentServiceTarget&isLookup=true&popupFor=ServiceTargets&filterClause="+escape("FKIncident__c='"+incidentId+"'")+"&standardLayout=true&popupHeader="+O+" "+IncidentPage.Labels.ServiceTargets)}if(m.focus){m.focus()}return !m};function f(N){N=N.replace(/\r\n/g,"\n");var M="";for(var P=0;P<N.length;P++){var O=N.charCodeAt(P);if(O<128){M+=String.fromCharCode(O)}else{if((O>127)&&(O<2048)){M+=String.fromCharCode((O>>6)|192);M+=String.fromCharCode((O&63)|128)}else{M+=String.fromCharCode((O>>12)|224);M+=String.fromCharCode(((O>>6)&63)|128);M+=String.fromCharCode((O&63)|128)}}}return escape(M)}var J=function(M,N){refreshIncident()};function h(){if(!(typeof(document.getElementById(IncidentPageComp.ComponentVars.DueDateTime))=="undefined"||document.getElementById(IncidentPageComp.ComponentVars.DueDateTime)==null)){if(isDueDateOverridenByServiceTarget()==true){document.getElementById(IncidentPageComp.ComponentVars.DueDateTime).disabled=true;document.getElementById(IncidentPageComp.ComponentVars.DueDateTime).readOnly=true;document.getElementById(IncidentPageComp.ComponentVars.DueDateTime).className="clsPanelInputTextboxReadOnly"}else{document.getElementById(IncidentPageComp.ComponentVars.DueDateTime).disabled=false;document.getElementById(IncidentPageComp.ComponentVars.DueDateTime).readOnly=false;document.getElementById(IncidentPageComp.ComponentVars.DueDateTime).className="clsPanelInputTextbox"}}}function G(){isValid="True"}function p(){chkBoxValue=inactive;G();if(isValid=="True"){saveBeforeCloseIncident(chkBoxValue)}else{Ext.MessageBox.show({msg:IncidentPage.Labels.ValidDateTime,buttons:Ext.MessageBox.OK})}}var z;var l=function(M,N){var O=Ext.getCmp("templatebutton");if(incidentId!=null&&incidentId!=""){Ext.MessageBox.confirm("",IncidentPage.Labels.OverwriteWarning,function(P){if(P==="yes"){if(!z||z.closed){z=window.open("/apex/TemplatePageNew?id="+incidentId,null,"status = 1, height = 575, width = 691,left="+stdScreenLeft()+",top="+stdScreenTop()+", resizable = 1")}if(z.focus){z.focus()}return !z}})}else{if(O.disabled==false){openPopup("SearchPage?popupId=Template&isLookup=true&filterClause="+escape("templateFor__c='Incident'"),fetchIncidentTemplates,500,625)}}};var s=function(M,N){respondedBtnHandler()};function D(){var M=0;KMdescription=IncidentDescription;if(KMdescription.length>100){KMdescription=KMdescription.substring(0,99)}}var n=new Ext.Panel({title:"",bodyStyle:"border:0px;padding:0px;margin:0px;zoom:0px;",cls:"toolSpCls",width:315,renderTo:"btnToolbar",tbar:[]});var d=n.getTopToolbar();d.add({scale:"medium",iconCls:"bmcRefreshDasboard",tooltipType:"title",tooltip:"Refresh",listeners:{},id:"refreshButtonId",handler:J}," ",{scale:"medium",iconCls:"bmcView1",tooltipType:"title",tooltip:IncidentPage.Labels.ViewOpenIncidentsFor,id:"viewId",hidden:disableTrue,menu:[{text:IncidentPage.Labels.IncidentsforClient,id:"IncidentsforClientId",icon:getSDFStylesResPath()+"/SDEFimages/_.GIF",handler:j},{text:IncidentPage.Labels.IncidentsforCategory,id:"IncidentsforCategoryId",icon:getSDFStylesResPath()+"/SDEFimages/_.GIF",handler:x}]}," ",{scale:"medium",iconCls:"bmcAssign1",tooltip:IncidentPage.Labels.AssignTo,tooltipType:"title",id:"assignedToId",hidden:disableTrue,menu:[{text:IncidentPage.Labels.IncidentsStaff,id:"AssignToStaff",disabled:getAssignStaffState(),handler:i},{text:"Suggested Experts",id:"AssignToExpert",disabled:getAssignSuggestedStaffState(),handler:w},{text:IncidentPage.Labels.IncidentMyself,id:"AssignToMyself",disabled:getAssignMyselfState(),handler:c},{text:IncidentPage.Labels.IncidentMemberof+" "+getProfileName(),id:"AssignToMemberOf",disabled:getAssignMemberOfAdminState(),handler:i},{text:IncidentPage.Labels.Queue,id:"AssignToQueue",disabled:getAssignQueueState(),handler:a}]}," ",{scale:"medium",iconCls:"bmcAction1",id:"actionButton",tooltip:IncidentPage.Labels.Actions,tooltipType:"title",hidden:disableTrue,menu:[{text:IncidentPage.Labels.IncidentClose,icon:getSDFStylesResPath()+"/SDEFimages/_.GIF",id:"closeButtonId",disabled:getCloseState(),handler:I},{text:IncidentPage.Labels.IncidentQuickClose,icon:getSDFStylesResPath()+"/SDEFimages/_.GIF",id:"quickCloseButtonId",disabled:getCloseState(),handler:k},{text:IncidentPage.Labels.IncidentReopenIncident,icon:getSDFStylesResPath()+"/SDEFimages/_.GIF",id:"reopenButtonId",disabled:getReOpenState(),handler:A},{text:IncidentPage.Labels.IncidentIncrementCallCounter,disabled:getCloseState(),id:"incrementCallButtonId",icon:getSDFStylesResPath()+"/SDEFimages/_.GIF",handler:B},{text:IncidentPage.Labels.IncidentResponded,icon:getSDFStylesResPath()+"/SDEFimages/_.GIF",id:"respondedButtonId",disabled:getRespondedState(),handler:s},{text:Print,icon:getSDFStylesResPath()+"/SDEFimages/_.GIF",id:"printButtonId",handler:PrintBtnHandler},{text:PrintPDF,icon:getSDFStylesResPath()+"/SDEFimages/_.GIF",id:"printPdfButtonId",handler:PrintPDFBtnHandler},"-",customActionJsonString]}," ",{scale:"medium",iconCls:"bmcAPM",tooltipType:"title",tooltip:IncidentPage.Labels.IncidentMgmtProcess,id:"incProcButton",handler:q}," ",{scale:"medium",iconCls:"bmcEmailMessage",tooltipType:"title",tooltip:IncidentPage.Labels.Email,id:"emailId",hidden:disableTrue,handler:b}," ",{scale:"medium",iconCls:"bmcServiceTargets",tooltipType:"title",tooltip:IncidentPage.Labels.ServiceTargets,id:"servicetargets",disabled:!hasServiceTargets,listeners:{disable:function(){this.setIconClass("bmcServiceTargetsDisable")},enable:function(){this.setIconClass("bmcServiceTargets")}},handler:H}," ",{scale:"medium",iconCls:"bmcKMSearch",tooltipType:"title",tooltip:"Search Knowledge Database",id:"incidentKMSearch ",disabled:getSaveState(),listeners:{},handler:r});d.doLayout();Ext.QuickTips.init()});