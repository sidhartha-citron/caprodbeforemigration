"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[904],{673:(s,e,i)=>{i.r(e),i.d(e,{default:()=>m});var t=i(1515),a=i(257),o=i(6342),n=i(4461);const r={components:{Picklist:t.Gp},props:{permission:{type:Object,default:()=>{}},isLoading:{type:Boolean,default:!1}},data(){return{permSearch:{label:"",value:null},searches:[{options:s=>this.searchUserProfile(s)}]}},computed:{tableColumns(){const s=[{label:this.$Labels.MA_Permission_Type,id:"type",type:"string"},{label:this.$Labels.MA_Permission_For,id:"name",type:this.permission.isNew?"search":"string"},{label:this.$Labels.MA_Read,id:"maps__Read__c",type:"boolean"},{label:this.$Labels.MA_Create,id:"maps__Create__c",type:"boolean"},{label:this.$Labels.MA_Modify,id:"maps__Modify__c",type:"boolean"},{label:this.$Labels.MA_Delete,id:"maps__Delete__c",type:"boolean"},{label:this.$Labels.MA_Set_Perm,id:"maps__SetPermissions__c",type:"boolean"}];return this.permission.isNew?s.push({label:this.$Labels.MA_Save,id:"save",type:"button"}):s.push({label:this.$Labels.MA_Delete,id:"delete",type:"button"}),s}},methods:{updateCheckboxPermission(s=""){if(this.permission.isNew)return;const e=this.permission[s],i={id:this.permission.id,value:e,field:s};new Promise(((s,e)=>this.$emit("update-permission",i,s,e))).catch((()=>{this.permission[s]=!e}))},handleButton(s){"save"===s?this.saveRow():"delete"===s?this.deleteRow():(console.warn("action missing",s),this.$emit("update:isLoading",!1))},deleteRow(){this.$emit("update:isLoading",!0),new Promise(((s,e)=>this.$emit("delete-row",this.permission.id,s,e))).catch((s=>{window.MAToastMessages.showWarning({message:"Permissions Warning",subMessage:s.message,timeOut:1e4})})).finally((()=>{this.$emit("update:isLoading",!1)}))},saveRow(){if(this.permSearch.value){this.$emit("update:isLoading",!0);const s={maps__Read__c:this.permission.maps__Read__c,maps__Create__c:this.permission.maps__Create__c,maps__Modify__c:this.permission.maps__Modify__c,maps__Delete__c:this.permission.maps__Delete__c,maps__SetPermissions__c:this.permission.maps__SetPermissions__c};"profile"===this.permission.type?s.maps__ProfileId__c=this.permSearch.value:s.maps__User__c=this.permSearch.value,new Promise(((e,i)=>this.$emit("save-row",s,e,i))).catch((s=>{window.MAToastMessages.showWarning({message:"Permissions Warning",subMessage:s.message,timeOut:1e4})})).finally((()=>{this.$emit("update:isLoading",!1)}))}else window.MAToastMessages.showWarning({message:"Permissions Warning",subMessage:"User/Profile required.",timeOut:1e4})},clearResults(){this.permSearch={label:"",value:null}},searchUserProfile(s){return new Promise((e=>{const i={ajaxResource:"TooltipAJAXResources",action:"get_lookup_optionsv2",baseObject:"user"===this.permission.type?"User":"Profile",fieldApiName:"Id",fieldName:"Id",grandparentField:"--none--",term:s,keepSearch:!1};(new a.Z).setAction(this.$Remoting.processAJAXRequest).setErrorHandler((()=>{e([])})).invoke([i],(s=>{if(s.success){const{lookupOptions:i=[]}=s;e(i)}else e([])}),{escape:!1,buffer:!1})}))},selectItem(s){this.permSearch=s},removeRow(){this.$emit("cancelNewPermission",this.permission.id)}}};var l=i(1900);const c=(0,l.Z)(r,(function(){var s=this,e=s.$createElement,i=s._self._c||e;return i("tr",s._l(s.tableColumns,(function(e,t){return i("td",{key:e.id+" "+t,class:"permission-row__"+e.type+" slds-cell-buffer_left slds-cell-wrap",staticStyle:{padding:"0rem .5rem"}},["string"===e.type?i("div",{staticStyle:{position:"relative"}},[0===t&&s.permission.isNew?i("button",{staticClass:"slds-input__icon slds-input__icon_right slds-button slds-button_icon",on:{click:s.removeRow}},[i("span",{staticClass:"slds-button__icon slds-icon-text-light ma-icon ma-icon-close"})]):s._e(),s._v(" "),i("div",{staticStyle:{"text-transform":"capitalize",display:"inline"}},[s._v(s._s(s._f("decode")(s.permission[e.id])))])]):"search"===e.type?i("div",[i("Picklist",{ref:"addStopMASearch",refInFor:!0,staticClass:"slds-p-top_x-small",attrs:{filterable:"",options:s.searches,titleKey:"label",idKey:"value"},on:{clear:s.clearResults,"selected-option":s.selectItem},scopedSlots:s._u([{key:"result",fn:function(e){return e.result?i("span",{staticClass:"slds-listbox__option-text_entity slds-listbox__option slds-listbox__option_plain"},[s._v("\n                    "+s._s(s._f("decode")(e.result.label))+"\n                ")]):s._e()}}],null,!0),model:{value:s.permSearch.label,callback:function(e){s.$set(s.permSearch,"label",e)},expression:"permSearch.label"}})],1):"boolean"===e.type?i("div",{staticClass:"slds-form-element"},[i("div",{staticClass:"slds-form-element__control"},[i("div",{staticClass:"slds-checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:s.permission[e.id],expression:"permission[column.id]"}],attrs:{id:"checkbox-permission-"+s.permission.id+"_"+t,type:"checkbox"},domProps:{checked:Array.isArray(s.permission[e.id])?s._i(s.permission[e.id],null)>-1:s.permission[e.id]},on:{change:[function(i){var t=s.permission[e.id],a=i.target,o=!!a.checked;if(Array.isArray(t)){var n=s._i(t,null);a.checked?n<0&&s.$set(s.permission,e.id,t.concat([null])):n>-1&&s.$set(s.permission,e.id,t.slice(0,n).concat(t.slice(n+1)))}else s.$set(s.permission,e.id,o)},function(i){return s.updateCheckboxPermission(e.id)}]}}),s._v(" "),i("label",{staticClass:"slds-checkbox__label",attrs:{for:"checkbox-permission-"+s.permission.id+"_"+t}},[i("span",{staticClass:"slds-checkbox_faux"})])])])]):"button"===e.type?i("div",[i("button",{staticClass:"slds-button",on:{click:function(i){return s.handleButton(e.id)}}},[s._v("\n                "+s._s(s._f("decode")(e.label))+"\n            ")])]):s._e()])})),0)}),[],!1,null,"fda7486a",null).exports,d={components:{Modal:t.u_,Spinner:t.$j,permissionRow:c,Picklist:t.Gp,ActionMenu:t.PC,ActionMenuItem:t.F9,TextInput:t.oi},props:{options:{type:Object,default:()=>{}}},data(){return{isLoading:!1,searchIsLoading:!1,folderName:"",folderPermissions:[],showCreateNew:!1,page:1,nodeId:"",totalPermissions:0,permissionsPerPage:10,searchTimeout:null,filterCriteria:"both",permissionSearch:"",filterCriteriaOptions:[{label:this.$Labels.MA_Both,value:"both"},{label:this.$Labels.MA_User,value:"user"},{label:this.$Labels.MA_Profile,value:"profile"}],normalizedData:[],tableColumns:[{label:this.$Labels.MA_Permission_Type,type:"string"},{label:this.$Labels.MA_Permission_For,type:"string"},{label:this.$Labels.MA_Read,type:"boolean"},{label:this.$Labels.MA_Create,type:"boolean"},{label:this.$Labels.MA_Modify,type:"boolean"},{label:this.$Labels.MA_Delete,type:"boolean"},{label:this.$Labels.MA_Set_Perm,type:"boolean"},{label:"",type:"button"}]}},computed:{currentPagePermissions(){let s=[];return this.folderPermissions[this.page-1]&&(s=this.folderPermissions[this.page-1]),s},totalPages(){return this.folderPermissions.length},startingRecord(){let s=0;return 0!==this.totalPermissions&&(s=(this.page-1)*this.permissionsPerPage+1),s},endingRecord(){let s=0;if(Array.isArray(this.currentPagePermissions)&&this.currentPagePermissions.length>0){const e=this.currentPagePermissions.length;s=this.startingRecord+e-1}return s},computedTotal(){return this.totalPermissions},computedModalTitle(){return(0,o.N4)(this.$Labels.folderPermissions_Header_Title,[this.folderName])},computedDisplayingNumOfUsers(){return(0,o.N4)(this.$Labels.folderPermissions_Displaying_Users,[this.startingRecord,this.endingRecord,this.totalPermissions])}},watch:{permissionSearch(s,e){this.searchIsLoading=!0,s!==e&&this.debounceSearch()}},created(){this.folderName=this.options.folderName,this.nodeId=this.options.nodeId,this.getPermissions()},methods:{close(){this.$emit("close")},reloadPermissionData(){this.resetPermTable(),this.getPermissions()},resetPermTable(){this.page=1,this.filterCriteria="both",this.permissionSearch=""},getPermissions(){this.isLoading=!0,this.normalizedData=[];const s={ajaxResource:"TreeAJAXResources",action:"get_folder_permissions",id:this.options.nodeId||""};(new a.Z).setAction(this.$Remoting.processAJAXRequest).setErrorHandler((s=>{console.warn(s),window.MAToastMessages.showWarning({message:"Permissions Warning",subMessage:"Unable to load permission data",timeOut:1e4}),this.close()})).invoke([s],(s=>{const{success:e=!1,FolderPermissions:i=[],profileList:t=[]}=s;this.isLoading=!1,e?i.length>0?(this.normalizePermissionData(i,t),this.buildPermissionPages(this.normalizedData)):(this.folderPermissions=[[]],this.buildPermissionPages([])):(console.warn(s),window.MAToastMessages.showWarning({message:"Permissions Warning",subMessage:"Unable to load permission data",timeOut:1e4}),this.close())}))},normalizePermissionData(s=[],e=[]){const i=[];s.forEach((s=>{const t={maps__Read__c:s.maps__Read__c||!1,maps__Create__c:s.maps__Create__c||!1,maps__Modify__c:s.maps__Modify__c||!1,maps__Delete__c:s.maps__Delete__c||!1,maps__SetPermissions__c:s.maps__SetPermissions__c||!1,id:s.Id};if(s.maps__ProfileId__c){t.type="profile";for(let i=0;i<e.length;i++){const a=e[i];if(a.Id===s.maps__ProfileId__c){t.name=a.Name||"N/A";break}}}else{t.type="user";const e=s.maps__User__r||{};t.name=e.Name||"N/A"}i.push(t)})),this.normalizedData=i},buildPermissionPages(s=[]){const e=[];let i=[];this.totalPermissions=s.length,s.forEach((s=>{i.push(s),i.length===this.permissionsPerPage&&(e.push(i),i=[])})),i.length>0&&(e.push(i),i=[]),0===e.length&&e.push([]),this.folderPermissions=e,this.isLoading=!1,this.searchIsLoading=!1},nextPage(){if(this.checkIfNewVisible())return;const s=this.folderPermissions.length;this.page<s&&(this.page+=1)},showCreateNewOptions(){this.showCreateNew=!this.showCreateNew},previousPage(){this.checkIfNewVisible()||this.page>1&&(this.page-=1)},checkIfNewVisible(){let s=!1;return void 0!==this.currentPagePermissions&&this.currentPagePermissions.find((s=>s.isNew))&&(s=!0,window.MAToastMessages.showWarning({message:"Permissions Warning",subMessage:"Please finish current permission creation.",timeOut:8e3})),s},setPage(s){this.checkIfNewVisible()||(this.page=s)},debounceSearch(){null!==this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((()=>{this.searchTimeout=null,this.filterPermissions()}),500)},filterPermissions(){this.isLoading=!0;const s=this.normalizedData,e=[],i=this.permissionSearch.toLowerCase();s.forEach((s=>{"user"===this.filterCriteria&&"user"!==s.type||"profile"===this.filterCriteria&&"profile"!==s.type||s.name.toLowerCase().indexOf(i)>-1&&e.push(s)})),this.buildPermissionPages(e)},updateCheckboxPermission(s,e,i){this.isLoading=!0;const t={ajaxResource:"TreeAJAXResources",action:"update_permission_field",Id:s.id,Field:s.field,Value:s.value};(new a.Z).setAction(this.$Remoting.processAJAXRequest).setErrorHandler((s=>{console.warn(s),window.MAToastMessages.showWarning({message:"Permissions Warning",subMessage:"Unable to update permission data",timeOut:1e4})})).invoke([t],(s=>{const{success:t=!1}=s;this.isLoading=!1,t?e():(console.warn(s),window.MAToastMessages.showWarning({message:"Permissions Warning",subMessage:"Unable to update permission data",timeOut:1e4}),i())}))},createRow(s){this.checkIfNewVisible()||this.currentPagePermissions.push({maps__Read__c:!1,maps__Create__c:!1,maps__Modify__c:!1,maps__Delete__c:!1,maps__SetPermissions__c:!1,id:(0,n.x$)(),type:s,isNew:!0})},cancelNewPermission(s){const e=this.currentPagePermissions.findIndex((e=>e.id===s));this.currentPagePermissions.splice(e,1)},saveRow(s){return new Promise(((e,i)=>{s.maps__Folder__c=this.nodeId;const t={ajaxResource:"TreeAJAXResources",action:"save_new_permission",NewPermission:JSON.stringify(s)};(new a.Z).setAction(this.$Remoting.processAJAXRequest).setErrorHandler((s=>{console.warn(s),i(new Error("Unable to save permission data"))})).invoke([t],(s=>{s.success?(e(),this.reloadPermissionData()):(console.warn(s),i(new Error("Unable to save permission data")))}),{escape:!1,buffer:!1})}))},deleteRow(s){return new Promise(((e,i)=>{const t={ajaxResource:"TreeAJAXResources",action:"delete_folder_permission",id:s};(new a.Z).setAction(this.$Remoting.processAJAXRequest).setErrorHandler((s=>{i(s)})).invoke([t],(s=>{s.success?(this.reloadPermissionData(),e()):i(s)}),{escape:!1,buffer:!1})}))}}},m=(0,l.Z)(d,(function(){var s=this,e=s.$createElement,i=s._self._c||e;return i("Modal",{staticClass:"permission-modal",attrs:{title:s.computedModalTitle,labels:{close:s.$Labels.MA_Close}},on:{close:s.close}},[i("div",{attrs:{slot:"content"},slot:"content"},[i("Spinner",{directives:[{name:"show",rawName:"v-show",value:s.isLoading,expression:"isLoading"}],attrs:{loadingLabel:s.$Labels.MA_Loading}}),s._v(" "),i("div",{staticClass:"slds-grid slds-gutters slds-grid_vertical-align-center"},[i("div",{staticClass:"slds-p-right_x-small slds-m-bottom_x-small"},[s._v(s._s(s.$Labels.MA_Search_for))]),s._v(" "),i("Picklist",{staticClass:"slds-size_3-of-12 slds-p-right_x-small",attrs:{options:s.filterCriteriaOptions,idKey:"value",titleKey:"label"},on:{changed:s.filterPermissions},model:{value:s.filterCriteria,callback:function(e){s.filterCriteria=e},expression:"filterCriteria"}}),s._v(" "),i("TextInput",{staticClass:"slds-size_4-of-12",attrs:{labels:{placeholder:s.$Labels.MA_Filter_Placeholder}},model:{value:s.permissionSearch,callback:function(e){s.permissionSearch=e},expression:"permissionSearch"}})],1),s._v(" "),i("div",{staticClass:"slds-scrollable",attrs:{id:"permissions-grid-wrapper"}},[i("table",{staticClass:"slds-table slds-table_bordered slds-table_striped"},[i("thead",[i("tr",{staticClass:"slds-line-height_reset"},s._l(s.tableColumns,(function(e,t){return i("th",{key:t,staticClass:"slds-cell-buffer_left slds-cell-wrap"},[s._v("\n                            "+s._s(s._f("decode")(e.label))+"\n                        ")])})),0)]),s._v(" "),i("tbody",s._l(s.currentPagePermissions,(function(e,t){return i("permissionRow",{key:t,attrs:{permission:e,nodeId:s.nodeId,isLoading:s.isLoading},on:{"update:isLoading":function(e){s.isLoading=e},"update:is-loading":function(e){s.isLoading=e},"update-permission":s.updateCheckboxPermission,"rebuild-permission-table":s.reloadPermissionData,cancelNewPermission:s.cancelNewPermission,"save-row":s.saveRow,"delete-row":s.deleteRow}})})),1)])]),s._v(" "),i("div",{staticClass:"slds-grid slds-p-vertical_small slds-grid_vertical-align-center"},[i("div",{staticClass:"slds-button-group",staticStyle:{overflow:"auto","max-width":"70%"},attrs:{id:"permissions-buttons",role:"group"}},[i("button",{staticClass:"slds-button slds-button_icon slds-button_icon-border-filled",on:{click:s.previousPage}},[i("span",{staticClass:"slds-button__icon ma-icon ma-icon-chevronleft"})]),s._v(" "),s._l(s.totalPages,(function(e,t){return i("button",{key:t,staticClass:"slds-button slds-button_neutral permissions-pagenum",class:{"slds-is-selected":e===s.page},on:{click:function(i){return s.setPage(e)}}},[s._v("\n                    "+s._s(e)+"\n                ")])})),s._v(" "),i("button",{staticClass:"slds-button slds-button_icon slds-button_icon-border-filled",on:{click:s.nextPage}},[i("span",{staticClass:"slds-button__icon ma-icon ma-icon-chevronright"})])],2),s._v(" "),i("div",{staticClass:"slds-p-left_small"},[i("div",{attrs:{id:"permissions-pageinfo"}},[s._v("\n                    "+s._s(s.computedDisplayingNumOfUsers)+"\n                ")])])])],1),s._v(" "),i("template",{slot:"footer"},[i("div",{staticClass:"slds-grid"},[i("div",{staticClass:"slds-col_bump-right"},[i("ActionMenu",[i("button",{staticClass:"slds-button slds-button_success",attrs:{slot:"button"},slot:"button"},[s._v("\n                        "+s._s(s.$Labels.MA_Create_New)+"\n                        "),i("span",{staticClass:"slds-button__icon slds-button__icon_right ma-icon ma-icon-down"})]),s._v(" "),i("ActionMenuItem",{attrs:{label:s.$Labels.MA_User},on:{click:function(e){return s.createRow("user")}}}),s._v(" "),i("ActionMenuItem",{attrs:{label:s.$Labels.MA_Profile},on:{click:function(e){return s.createRow("profile")}}})],1)],1),s._v(" "),i("div",[i("button",{staticClass:"slds-button slds-button_brand",on:{click:s.close}},[s._v("\n                    "+s._s(s.$Labels.MA_Close)+"\n                ")])])])])],2)}),[],!1,null,null,null).exports}}]);