"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[853],{7641:(e,s,t)=>{t.r(s),t.d(s,{default:()=>n});var o=t(1515),a=t(8050);const i={props:{modalOptions:{type:Object,required:!0}},data:()=>({isLoading:!1,subject:"Call",comments:"",needsValidation:!1,actionHandler:"showpopup",fieldSet:null,fieldSetLoaded:!1,fieldSetHTML:"",hasError:!1,errors:0,errorMessages:[],success:0}),computed:{records(){const{records:e=[]}=this.modalOptions;return e},recordLength(){return this.records.length},cancelText(){let e=this.$Labels.MA_Close;return this.needsValidation&&(e=this.$Labels.MA_No),e}},created(){const{actionHandler:e="showPopup",fieldSet:s}=this.modalOptions;this.actionHandler=String(e).toLowerCase(),this.fieldSet=s,this.checkRecords()},methods:{checkRecords(){this.recordLength>1?this.needsValidation=!0:this.processOptions()},processOptions(){this.needsValidation=!1,"showpopup"===this.actionHandler?this.fieldSet&&this.getFieldSetHTML():(this.close(),this.openClassLogACall())},getFieldSetHTML(){this.isLoading=!0;const e=`${window.MA.resources.Click2Create}?sobject=Task&fieldset=${this.fieldSet}&platform=desktop`;this.$http.get(e).then((e=>{const{ok:s=!1,body:t=""}=e;if(s){this.fieldSetHTML=t;const e=document.querySelector("#LogACallModal .fieldSetHTML");this.setHTML(e,t)}else console.warn("Unable to get fieldSet info",e)})).catch((e=>{this.hasError=!0,console.warn(e)})).finally((()=>{this.fieldSetLoaded=!0,this.isLoading=!1}))},setHTML(e,s){e.innerHTML=s,Array.from(e.querySelectorAll("script")).forEach((e=>{const s=document.createElement("script");Array.from(e.attributes).forEach((e=>s.setAttribute(e.name,e.value))),s.appendChild(document.createTextNode(e.innerHTML)),e.parentNode.replaceChild(s,e)}))},openClassLogACall(){this.records.forEach((e=>{const s=e.Id,t=`${window.MA.resources.MapActions}?action=log_call&id=${s}`;window.open(t)})),this.close()},close(){window.MALayers.hideModal(),this.$emit("close")},convertFieldSetDataToSaveData(){let e="";if(this.fieldSet){const s=window.buildFieldSetValues(window.jQuery("#LogACallModal .fieldSetTable")).fields;s.TaskSubtype="Call",s.Status=s.Status?s.Status:"Completed",e=JSON.stringify(s)}else e=JSON.stringify({TaskSubtype:"Call",Status:"Completed",Subject:this.subject,Description:this.comments});return e},createBatchData(e){const s=[];let t=[];for(let o=0;o<this.records.length;o++){const a=this.records[o];t.push(a.Id),200===t.length&&(s.push({ajaxResource:"TooltipAJAXResources",action:"LogACallBatch",serializedRecordIds:JSON.stringify(t),callInfo:e}),t=[])}return t.length>0&&s.push({ajaxResource:"TooltipAJAXResources",action:"LogACallBatch",serializedRecordIds:JSON.stringify(t),callInfo:e}),s},saveForm(){this.isLoading=!0;const e=this.convertFieldSetDataToSaveData(),s=this.createBatchData(e),t=window.async.queue((async(e,s)=>{try{const t=await(0,a.wX)("maps.RemoteFunctions.processAJAXRequest",[e],{escape:!1,buffer:!1}),{success:o=!1,results:i=[]}=t;if(o)i.forEach((e=>{if(e.success)this.success++;else{const s=((e.errors||[])[0]||{}).message||"Unknown Error";this.errorMessages.push(s),this.errors++}}));else{let s=0;try{s=JSON.parse(e.serializedRecordIds).length}catch(e){s=0}this.errors+=s}s()}catch(t){let o=0;try{o=JSON.parse(e.serializedRecordIds).length}catch(e){o=0}this.errors+=o,s()}}));t.concurrency=3;for(let e=0;e<s.length;e++){const o=s[e];t.push(o)}t.drain=()=>{this.isLoading=!1;const e=`${this.success} successful, ${this.errors} failures`;this.errors>0&&this.success>0?window.MAToastMessages.showWarning({message:this.$Labels.ActionFramework_Log_a_Call,subMessage:e,timeOut:0,extendedTimeOut:0,closeButton:!0}):0===this.errors&&this.success>0?window.MAToastMessages.showSuccess({message:this.$Labels.ActionFramework_Log_a_Call,subMessage:e}):window.MAToastMessages.showError({message:this.$Labels.ActionFramework_Log_a_Call,subMessage:e,timeOut:0,extendedTimeOut:0,closeButton:!0}),this.close()}}}},l={components:{Spinner:o.$j,Modal:o.u_,TextInput:o.oi},mixins:[i]},n=(0,t(1900).Z)(l,(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("Modal",{staticClass:"slds-modal-fullscreen-phone js-search-modal-wrapper",attrs:{id:"LogACallModal",title:e.$Labels.ActionFramework_Log_a_Call,labels:{close:e.$Labels.MA_Close}},on:{close:e.close}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("Spinner",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}]}),e._v(" "),e.needsValidation?t("div",[t("div",{staticStyle:{"text-align":"center","line-height":"22px"}},[t("div",{staticStyle:{"font-weight":"bold",color:"#d4504c"}},[e._v("Multiple records selected.")]),e._v(" "),t("div",[e._v("Any information entered in the next step will be used for "+e._s(e.recordLength)+" records.")]),e._v(" "),t("div",[e._v("Do you wish to continue?")])])]):t("div",[e.fieldSet?t("div",{staticClass:"logacallform"},[t("div",[t("div",{staticClass:"slds-text-body_regular slds-m-bottom_medium"},[e._v("Fill in the fields below")]),e._v(" "),t("div",{staticClass:"fieldSetHTML"}),e._v(" "),t("ul",{staticClass:"logacallform-fieldset-errors"})])]):t("div",[t("TextInput",{staticClass:"slds-form-element",attrs:{required:"",labels:{name:e.$Labels.MA_Subject},type:"text"},model:{value:e.subject,callback:function(s){e.subject=s},expression:"subject"}}),e._v(" "),t("TextInput",{staticClass:"slds-form-element",attrs:{required:"",useTextArea:"",labels:{name:e.$Labels.MA_Comments},type:"text"},model:{value:e.comments,callback:function(s){e.comments=s},expression:"comments"}})],1)])],1),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("div",{staticClass:"float-left"},[t("button",{directives:[{name:"show",rawName:"v-show",value:!e.needsValidation,expression:"!needsValidation"}],staticClass:"slds-button slds-button_neutral",attrs:{disabled:e.isLoading,title:"Open in Salesforce"},on:{click:e.openClassLogACall}},[e._v("\n                Salesforce\n                "),t("span",{staticClass:"slds-button__icon slds-button__icon_right ma-icon ma-icon-new-window"})])]),e._v(" "),t("div",{staticClass:"float-right"},[t("button",{staticClass:"slds-button slds-button_neutral",attrs:{disabled:e.isLoading},on:{click:e.close}},[e._v("\n                "+e._s(e.cancelText)+"\n            ")]),e._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:e.needsValidation,expression:"needsValidation"}],staticClass:"slds-button slds-button_brand",attrs:{disabled:e.isLoading},on:{click:e.processOptions}},[e._v("\n                "+e._s(e.$Labels.MA_Yes)+"\n            ")]),e._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:!e.needsValidation,expression:"!needsValidation"}],staticClass:"slds-button slds-button_brand",attrs:{disabled:e.isLoading},on:{click:e.saveForm}},[e._v("\n                "+e._s(e.$Labels.MA_Finish)+"\n            ")])])])])}),[],!1,null,null,null).exports}}]);