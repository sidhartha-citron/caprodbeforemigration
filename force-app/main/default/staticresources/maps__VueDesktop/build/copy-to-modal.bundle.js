"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[532],{6182:(e,t,o)=>{o.r(t),o.d(t,{default:()=>n});var s=o(1515),r=o(257);const{jQuery:a}=window,i={components:{Spinner:s.$j,Modal:s.u_},props:{modalOptions:{type:Object,default:()=>{}}},data:()=>({isCopy:!1,isLoading:!1,itemName:"",layer:null,perms:{}}),computed:{modalHeader(){return`${this.isCopy?this.$Labels.MA_Copy:this.$Labels.MA_Move} ${this.itemName} ${this.$Labels.MA_To}`}},mounted(){const{layer:e={},isCopy:t=!1}=this.modalOptions;this.isCopy=t,this.layer=e,void 0!==a("#CopyToTree").data("jstree_instance_id")&&a("#CopyToTree").jstree("destroy").empty(),a("#CopyToTree").on("load_node.jstree load_node_json.jstree",(()=>{a("#CopyToTree li").each(((e,t)=>{const o=a(t);o.data("create",o.attr("create")),this.perms={...this.perms,[o.attr("id")]:{create:o.attr("create"),modify:o.attr("modify"),delete:o.attr("delete"),setperm:o.attr("setperm"),nodetype:o.attr("nodetype")}},(window.MASystem.User.IsCorporateAdmin||"CorporateRoot"!==o.attr("nodetype")&&("CorporateFolder"!==o.attr("nodetype")||"true"===this.perms[o.attr("id")].create))&&"RoleRoot"!==o.attr("nodetype")&&"RoleNameFolder"!==o.attr("nodetype")||o.addClass("disabled").find("> a > .jstree-checkbox").addClass("copyto-disabled")}))})).jstree({json_data:{data:"",ajax:{url:window.MA.resources.TreeXML,data:e=>({id:e.attr?e.attr("id"):0,rand:(new Date).getTime(),type:e.attr?e.attr("NodeType"):0,types:"Folder"})}},checkbox:{real_checkboxes:!0,real_checkboxes_names:e=>{let t=0;return a(e).each(((e,o)=>{t=a(o).attr("nodeid")})),[`check_${t}`,t]},two_state:!0},core:{animation:10,strings:{loading:"Loading...",new_node:"New Folder"}},plugins:["themes","json_data","ui","crrm","types","checkbox"]}),this.itemName=window.htmlEncode(e.name)},methods:{submit(){this.isCopy?this.SubmitCopyTo():this.SubmitMoveTo()},SubmitCopyTo(){const e=this;this.isLoading=!0;const t=[];if(a("#CopyToTree").jstree("get_checked",null,!0).each(((e,o)=>{const s=a(o);(window.MASystem.User.IsCorporateAdmin||"true"===this.perms[s.attr("id")].create||"PersonalRoot"===this.perms[s.attr("id")].nodetype||"PersonalFolder"===this.perms[s.attr("id")].nodetype)&&t.push(`${s.attr("id")}~${s.attr("NodeType")}`)})),Array.isArray(t)&&!t.length)return e.isLoading=!1,e.showError("You do not have the required permissions to copy to the selected folder/s"),void e.close();a.each(t,((t,o)=>{const s=o.split("~"),a={ajaxResource:"TreeAJAXResources",action:"copy_node",copyid:e.layer.id,copynodetype:e.layer.nodetype,folderid:s[0],foldernodetype:s[1]};(new r.Z).setAction("maps.RemoteFunctions.processAJAXRequest").setErrorHandler((t=>{e.isLoading=!1,e.showError(t),e.close()})).invoke([a],(t=>{const{success:o=!1,error:s="Unknown Error"}=t;o?(e.$bus.$emit("refresh-folder"),window.MAToastMessages.showSuccess({message:e.$Labels.MA_Success}),e.close()):(e.showError(s),e.close()),e.isLoading=!1}),{buffer:!1})}))},SubmitMoveTo(){const e=this;e.isLoading=!0;const t=[];if(a("#CopyToTree").jstree("get_checked",null,!0).each(((e,o)=>{const s=a(o);(window.MASystem.User.IsCorporateAdmin||"true"===this.perms[s.attr("id")].create||"PersonalRoot"===this.perms[s.attr("id")].nodetype||"PersonalFolder"===this.perms[s.attr("id")].nodetype)&&t.push(`${s.attr("id")}~${s.attr("NodeType")}`)})),Array.isArray(t)&&!t.length)return e.isLoading=!1,e.showError("You do not have the required permissions to move to the selected folder/s"),void e.close();a.each(t,((t,o)=>{const s=o.split("~"),a=e.layer.type,i=`${e.layer.id} ${e.layer.nodetype}`;let n="sqry";"folder"===a?n="folders":"marker"===a?n="sqry":"shape"===a?n="territories":"favorite"===a?n="favorites":"datalayer"===a?n="datalayers":"territory"===a&&(n="territory-layer");const d={ajaxResource:"TreeAJAXResources",action:"move_node",npid:s[0],npnt:s[1]};d[n]=i,(new r.Z).setAction("maps.RemoteFunctions.processAJAXRequest").setErrorHandler((t=>{e.isLoading=!1,e.showError(t),e.close()})).invoke([d],(t=>{const{success:o=!1,error:s="Unknown Error"}=t;o?(e.$bus.$emit("refresh-folder"),window.MAToastMessages.showSuccess({message:e.$Labels.MA_Success}),e.close()):(e.showError(s),e.close()),e.isLoading=!1}),{buffer:!1})}))},close(){this.$emit("close")},showError(e){(e.indexOf("Too many SOQL queries: 101")>-1||e.indexOf("Too many DML statements")>-1)&&(e="The amount of layers and subfolders is too large to handle in one operation. Please reduce the number and try again."),window.MAToastMessages.showError({message:"Unable to Perform Action",subMessage:e,setTimeout:7e3})}}},n=(0,o(1900).Z)(i,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("Modal",{attrs:{id:"CopyToPopup",title:e.modalHeader,labels:{close:e.$Labels.MA_Close}},on:{close:e.close}},[o("div",{attrs:{slot:"content"},slot:"content"},[o("Spinner",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}]}),e._v(" "),o("div",{staticClass:"slds-modal__content slds-p-around_medium",attrs:{id:"copyToPopupContent"}},[o("div",{staticStyle:{"padding-top":"3px"},attrs:{id:"CopyToTree"}})])],1),e._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("button",{staticClass:"slds-button slds-button_neutral",attrs:{disabled:e.isLoading},on:{click:e.close}},[e._v("\n            "+e._s(e.$Labels.MA_Cancel)+"\n        ")]),e._v(" "),o("button",{staticClass:"slds-button slds-button_brand",attrs:{disabled:e.isLoading},on:{click:e.submit}},[e._v("\n            "+e._s(e.$Labels.MA_Submit)+"\n        ")])])])}),[],!1,null,null,null).exports}}]);