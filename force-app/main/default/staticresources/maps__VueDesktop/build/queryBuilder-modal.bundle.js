"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[417],{9014:(e,t,s)=>{s.r(t),s.d(t,{default:()=>l});var r=s(1515);const o={props:{isLoading:{type:Boolean,default:!1},params:{type:Object,required:!0}},data:()=>({showBackDrop:!1,isDebug:!1}),created(){this.checkDebug()},mounted(){this.$emit("update:isLoading",!0),this.loadQueryBuilderHTML().then((()=>{this.showBackDrop=!0})).catch((e=>{const{message:t="Unknown Error"}=e;this.$emit("close-modal"),this.$bus.$emit("show-generic-modal",{title:"Query Builder Error",message:t})})).finally((()=>{this.$emit("update:isLoading",!1)}))},methods:{checkDebug(){const e=window.location.href.split("?");2===e.length&&e[1].indexOf("debug")>-1&&(this.isDebug=!0)},buildQueryHTML(){const{pageSuffix:e=""}=window,t=`${window.MA.resources.QueryBuilder}${e}`;this.isDebug&&(this.params.debug=!0);const s=Object.keys(this.params);let r="";for(let e=0;e<s.length;e++){const t=s[e];r=`${r}${0===e?"?":"&"}${t}=${this.params[t]}`}return`${t}${r}`},loadQueryBuilderHTML(){return new Promise(((e,t)=>{const s=this.buildQueryHTML();this.$http.get(s).then((r=>{const{ok:o=!1,body:i=""}=r;if(o)if(i.indexOf("Visualforce Error")>-1)t(new Error("Unable to create/edit this layer. If this error continues, please contact support.")),console.warn("failed layer",s);else{const{queryBuilderContent:t}=this.$refs;this.setHTML(t,i),e()}else t(new Error)})).catch((e=>{t(),console.warn(e)}))}))},setHTML(e,t){e.innerHTML=t,Array.from(e.querySelectorAll("script")).forEach((e=>{const t=document.createElement("script");Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(e.innerHTML)),e.parentNode.replaceChild(t,e)}))}}};var i=s(1900);const a=(0,i.Z)(o,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"slds-backdrop",class:{"slds-backdrop_open":e.showBackDrop}}),e._v(" "),s("div",{ref:"queryBuilderContent",staticClass:"query-editor-modal-content"})])}),[],!1,null,null,null).exports,n={components:{Spinner:r.$j,queryBuilderContent:a},props:{modalOptions:{type:Object,required:!0},doShow:{type:Boolean,default:!1}},data:()=>({isLoading:!1,showBackDrop:!1}),computed:{layerParams(){const{params:e={}}=this.modalOptions;return e}},created(){this.$bus.$on("close-query-builder",this.close)},destroyed(){this.$bus.$off("close-query-builder")},methods:{close(){this.$emit("close")}}},l=(0,i.Z)(n,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"queryeditor-modal"}},[e.isLoading?s("Spinner"):e._e(),e._v(" "),e.doShow?s("queryBuilderContent",{attrs:{isLoading:e.isLoading,params:e.layerParams},on:{"update:isLoading":function(t){e.isLoading=t},"update:is-loading":function(t){e.isLoading=t},"close-modal":e.close}}):e._e()],1)}),[],!1,null,null,null).exports}}]);