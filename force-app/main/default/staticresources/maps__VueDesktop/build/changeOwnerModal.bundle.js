"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[169],{8053:(s,e,t)=>{t.r(e),t.d(e,{default:()=>i});var a=t(1515),l=t(257);const n={components:{Modal:a.u_,Spinner:a.$j,Checkbox:a.XZ},props:{modalOptions:{type:Object,required:!0}},data:()=>({isLoading:!1,recordsAreValid:!1,isStep1:!0,defaultSubordinates:!1,futureEvents:!0,notes:!0,tasks:!0,attachments:!0,searchTerm:"",foundUsers:[],selectedUser:null}),computed:{records(){const{records:s=[]}=this.modalOptions;return s}},watch:{searchTerm(s,e){this.searchIsLoading=!0,s!==e&&this.debounceSearch()}},created(){0===this.records.length?(window.MAToastMessages.showWarning({message:"Change Owner Warning",subMessage:"No records found",timeOut:1e4}),this.$nextTick((()=>{this.close()}))):(this.recordsAreValid=!0,this.defaultSubordinates=window.getProperty(window.MASystem,"Organization.ShowOnlySubordinates",!1)||!1,this.getUsers())},methods:{close(){this.$emit("close")},getUsers(){this.foundUsers=[],this.isLoading=!0;const s={ajaxResource:"TooltipAJAXResources",subordinatesOnly:this.defaultSubordinates,action:"get_users",searchTerm:this.searchTerm};(new l.Z).setAction(this.$Remoting.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([s],(s=>{const{success:e=!1,users:t=[]}=s;this.isLoading=!1,e&&(this.foundUsers=t)}))},updateOwner(){this.isLoading=!0;const s={ajaxResource:"TooltipAJAXResources",ownerId:this.selectedUser.Id,action:"change_owner",transferAttachments:this.attachments,transferEvents:this.futureEvents,transferNotes:this.notes,transferTasks:this.tasks,records:this.records};window.ChangeOwner_Finish(s),this.close()},debounceSearch(){null!==this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((()=>{this.searchTimeout=null,this.getUsers()}),500)},handleRemoteActionError(){this.isLoading=!1},showStep2(s){this.selectedUser=s,this.isStep1=!1},showStep1(){this.selectedUser=null,this.isStep1=!0}}},i=(0,t(1900).Z)(n,(function(){var s=this,e=s.$createElement,t=s._self._c||e;return s.recordsAreValid?t("Modal",{attrs:{title:s.$Labels.ActionFramework_Change_Owner,labels:{close:s.$Labels.MA_Close}},on:{close:s.close}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("Spinner",{directives:[{name:"show",rawName:"v-show",value:s.isLoading,expression:"isLoading"}],attrs:{loadingLabel:s.$Labels.MA_Loading}}),s._v(" "),s.isStep1?t("div",[t("div",{staticClass:"slds-p-around_medium"},[t("h4",{staticClass:"slds-text-title_caps"},[s._v(s._s(s.$Labels.MA_Step_1_Select_New_Owner))]),s._v(" "),t("div",{staticClass:"grid-wrapper slds-m-top_small"},[t("table",{staticStyle:{width:"100%"}},[t("tr",[t("td",{staticStyle:{"vertical-align":"center"}},[t("table",[t("tr",[t("td",{staticClass:"data"},[t("label",{staticClass:"slds-form-element__label label",attrs:{for:"changeownder-filter-name"}},[s._v(s._s(s.$Labels.MA_Name))]),s._v(" "),t("div",{staticClass:"slds-form-element__control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.searchTerm,expression:"searchTerm"}],staticClass:"filter-text slds-input",attrs:{id:"changeowner-filter-name",type:"text","data-field":"Name"},domProps:{value:s.searchTerm},on:{input:function(e){e.target.composing||(s.searchTerm=e.target.value)}}})])])])])]),s._v(" "),t("td",{staticStyle:{"vertical-align":"center"}},[t("div",{staticClass:"slds-form-element slds-m-left_medium"},[t("div",{staticClass:"slds-form-element"},[t("div",{staticClass:"slds-form-element__control"},[t("Checkbox",{attrs:{labels:{name:s.$Labels.MA_Show_Only_Subordinates}},on:{changed:function(e){return s.getUsers()}},model:{value:s.defaultSubordinates,callback:function(e){s.defaultSubordinates=e},expression:"defaultSubordinates"}})],1)])])])])]),s._v(" "),t("div",{staticStyle:{height:"15px"}},[s._v(" ")]),s._v(" "),t("div",{staticClass:"loadmask-wrapper",attrs:{id:"changeowner-select-grid-wrapper"}},[t("table",{staticClass:"slds-table slds-table_bordered slds-table_cell-buffer slds-table_striped",attrs:{id:"changeowner-select-grid"}},[t("thead",[t("tr",{staticClass:"slds-text-title_caps"},[t("th",[s._v(s._s(s.$Labels.MA_Name))])])]),s._v(" "),t("tbody",s._l(s.foundUsers,(function(e,a){return t("tr",{key:a,on:{click:function(t){return s.showStep2(e)}}},[t("td",[s._v(s._s(e.Name))])])})),0)])])])])]):t("div",[t("div",{staticStyle:{height:"15px"}},[s._v(" ")]),s._v(" "),t("div",{staticClass:"slds-p-around_medium"},[t("h4",{staticClass:"slds-text-title_caps"},[s._v(s._s(s.$Labels.MA_Step_2_Transfer_Options))]),s._v(" "),t("div",{staticStyle:{height:"15px"}},[s._v(" ")]),s._v(" "),t("div",[t("h4",{staticClass:"slds-form-element__legend slds-form-element__label"},[s._v(s._s(s.$Labels.MA_Related_items_transfer))]),s._v(" "),t("div",{staticClass:"slds-form-element"},[t("div",{staticClass:"slds-form-element__control"},[t("Checkbox",{attrs:{labels:{name:s.$Labels.MA_Notes}},model:{value:s.notes,callback:function(e){s.notes=e},expression:"notes"}})],1)]),s._v(" "),t("div",{staticClass:"slds-form-element"},[t("div",{staticClass:"slds-form-element__control"},[t("Checkbox",{attrs:{labels:{name:s.$Labels.MA_Attachments}},model:{value:s.attachments,callback:function(e){s.attachments=e},expression:"attachments"}})],1)]),s._v(" "),t("div",{staticClass:"slds-form-element"},[t("div",{staticClass:"slds-form-element__control"},[t("Checkbox",{attrs:{labels:{name:s.$Labels.MA_Open_Tasks}},model:{value:s.tasks,callback:function(e){s.tasks=e},expression:"tasks"}})],1)]),s._v(" "),t("div",{staticClass:"slds-form-element"},[t("div",{staticClass:"slds-form-element__control"},[t("Checkbox",{attrs:{labels:{name:s.$Labels.MA_Future_Events}},model:{value:s.futureEvents,callback:function(e){s.futureEvents=e},expression:"futureEvents"}})],1)])])])])],1),s._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[s.isStep1?s._e():t("button",{staticClass:"slds-button slds-button_neutral",on:{click:s.showStep1}},[s._v("\n            "+s._s(s.$Labels.MA_Back)+"\n        ")]),s._v(" "),t("button",{staticClass:"slds-button slds-button_neutral",on:{click:s.close}},[s._v("\n            "+s._s(s.$Labels.MA_Cancel)+"\n        ")]),s._v(" "),s.isStep1?s._e():t("button",{staticClass:"slds-button slds-button_brand",on:{click:function(e){return s.updateOwner()}}},[s._v("\n            "+s._s(s.$Labels.MA_Save_Close)+"\n        ")])])]):s._e()}),[],!1,null,null,null).exports}}]);