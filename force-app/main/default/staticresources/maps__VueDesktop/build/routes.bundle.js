(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[770],{2004:(t,e,s)=>{t.exports=s.p+"images/a20d8c1bf1e76fff3792570d951fccf6.svg"},747:(t,e,s)=>{t.exports=s.p+"images/7655718e29302d75aebfb239a516b9e9.svg"},8737:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>$t});var o=[function(){var t=this.$createElement,e=this._self._c||t;return e("figure",{staticClass:"slds-m-bottom--large"},[e("img",{attrs:{src:s(747)}})])}],i=s(7387),a=s(5908),r=s(5262),n=s(1023),l=s(5493),d=s(1515),u=s(6342),c=s(257),h=s(2134);const{MARemoting:_}=window,m={components:{Picklist:d.Gp},props:{storedSearchTerm:{type:String,default:""},usersOnly:{type:Boolean,default:!1},placeholder:{type:String,default:"Search users and assets"},doDetach:{type:Boolean,default:!0}},data(){return{searchTerm:this.storedSearchTerm,searches:[{options:this.getAssets}]}},computed:{...(0,a.mapGetters)("scheduling",{scheduling__subRoleIdsList:"subRoleIdsList"})},watch:{storedSearchTerm(){this.searchTerm!==this.storedSearchTerm&&(this.searchTerm=this.storedSearchTerm)}},methods:{errorHandler(t){console.warn("error in MASearch cmp: ",t)},getAssetType:t=>t.fields&&t.fields.length&&t.fields[0].label?t.fields[0].label:"",getAssets(t){return new Promise(((e,s)=>{const o={ajaxResource:"WaypointAJAXResources",action:"getRouteUserOptions",roleIds:JSON.stringify(this.scheduling__subRoleIdsList),term:t,usersOnly:this.usersOnly};(new c.Z).setAction(_.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this,s)).invoke([o],(t=>{h.Z.debugRemotingData("getRouteUserOptions",[o],t);const i={};t.success?(i.results=t.data,e(i.results)):(console.warn(t),s(new Error(t.error)))}))}))},selected(t){this.$emit("selected",t)},handleRemoteActionError(t,e,s){t(new Error(s.message))}}};var p=s(1900);const v=(0,p.Z)(m,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"slds-form-element__control slds-input-has-icon slds-input-has-icon_right",attrs:{id:"scheduleUserSelectWrap"}},[s("div",{staticClass:"slds-form-element"},[s("div",{staticClass:"slds-form-element__control"},[s("div",{staticClass:"slds-combobox_container"},[s("div",{staticClass:"slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click has-option-selected",attrs:{id:"scheduleUserSelectInputWrap","aria-expanded":"true","aria-haspopup":"listbox",role:"combobox"}},[s("div",{staticClass:"slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"},[s("Picklist",{attrs:{options:t.searches,filterable:"",labels:{search:t.placeholder,noSearchResults:t.$Labels.MA_NO_RESULTS_FOUND},titleKey:"label"},on:{clear:function(e){return t.$emit("clear")},"selected-option":t.selected,error:t.errorHandler},scopedSlots:t._u([{key:"result",fn:function(e){return s("span",{staticClass:"slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta",attrs:{id:"listbox-option-unique-id-01",role:"option"}},[s("span",{staticClass:"slds-media__body"},[s("span",{staticClass:"slds-listbox__option-text slds-listbox__option-text_entity"},[t._v(t._s(t._f("decode")(e.result.label)))]),t._v(" "),s("span",{staticClass:"slds-listbox__option-meta slds-listbox__option-meta_entity"},[t._v(t._s(t._f("decode")(t.getAssetType(e.result))))])])])}}]),model:{value:t.searchTerm,callback:function(e){t.searchTerm=e},expression:"searchTerm"}})],1)])])])])])])}),[],!1,null,null,null).exports,{moment:b,MASystem:g,MA:f}=window,y={components:{AssetSearch:v,Button:d.zx,ButtonIcon:d.Ei,Layout:d.Ar,LayoutItem:d.cd,Popover:d.J2,Select:d.Ph},props:{month:{type:Number,required:!0},year:{type:Number,required:!0},asset:{type:Object,required:!0},togglePastRoutesLabel:String},data:()=>({date:{},monthString:"",yearMin:2010,yearMax:2022,showDateWidget:!1,searchTerm:g.User.FullName,dateChanged:!1}),computed:{monthAndYear(){return`${this.monthString} ${this.year}`},months(){return this.getMonths()},years(){return this.getYears()},...(0,a.mapGetters)("tabs",{tabs__isTabActive:"isTabActive"})},watch:{month(){this.date.month(this.month);const t=this.getMonths().filter((t=>t.key===this.month));if(t.length>0){const e=t[0];this.monthString=e.value}else this.monthString=this.date.format("MMMM");this.showDateWidget||!0!==this.tabs__isTabActive(i.mQ.ROUTES)?this.dateChanged=!0:this.$emit("refresh-list")},year(){this.date.year(this.year),this.showDateWidget?this.dateChanged=!0:this.$emit("refresh-list")},asset(){this.asset&&this.asset.Name&&(this.searchTerm=this.asset.Name)}},created(){this.setDateToToday()},methods:{updateMonth(t){this.$emit("update:month",t)},updateYear(t){this.$emit("update:year",t)},hideDateWidget(){this.showDateWidget&&this.dateChanged&&(this.$emit("refresh-list"),this.dateChanged=!1),this.showDateWidget=!1},setDateToToday(){this.date=b(),this.updateMonth(this.date.month()),this.updateYear(this.date.year())},todayClick(t){this.hideDateWidget(t),this.setDateToToday()},previousMonth(){this.date.subtract(1,"M"),this.updateMonth(this.date.month()),this.updateYear(this.date.year())},nextMonth(){this.date.add(1,"M"),this.updateMonth(this.date.month()),this.updateYear(this.date.year())},getYears(){const t=[];for(let e=this.yearMin;e<=this.yearMax;e++)t.push(e);return t},getMonths(){return[{key:0,value:this.$Labels.MA_January},{key:1,value:this.$Labels.MA_February},{key:2,value:this.$Labels.MA_March},{key:3,value:this.$Labels.MA_April},{key:4,value:this.$Labels.MA_May},{key:5,value:this.$Labels.MA_June},{key:6,value:this.$Labels.MA_July},{key:7,value:this.$Labels.MA_August},{key:8,value:this.$Labels.MA_September},{key:9,value:this.$Labels.MA_October},{key:10,value:this.$Labels.MA_November},{key:11,value:this.$Labels.MA_December}]},reactToSelectedAsset(t){this.$emit("clear-routes"),t&&t.id?(this.$emit("update:asset",{Id:t.id,Name:t.label,field:f.getProperty(t,["fields",0,"apiName"]),type:f.getProperty(t,["fields",0,"label"])}),this.$nextTick((()=>{this.$emit("refresh-list")}))):this.searchTerm=""},openNewRoute(){this.$emit("open-new-route")}}},w=(0,p.Z)(y,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"routesIndexHeader"}},[s("Layout",{staticClass:"slds-p-top_small slds-p-bottom_small slds-p-horizontal_medium",attrs:{horizontalAlign:"spread"}},[s("LayoutItem",[s("AssetSearch",{attrs:{storedSearchTerm:t.searchTerm,placeholder:t.$Labels.MA_Search_Users_Assets},on:{selected:t.reactToSelectedAsset}})],1),t._v(" "),s("LayoutItem",{attrs:{alignmentBump:"left"}},[s("Button",{attrs:{label:t.$Labels.MA_New,iconCategory:"utility",iconName:"new",variant:"brand"},on:{click:t.openNewRoute}})],1)],1),t._v(" "),s("Layout",{staticClass:"slds-p-horizontal_medium slds-p-bottom_x-small"},[s("LayoutItem",{staticClass:"slds-button-group slds-p-right_xx-small prev-next-button-group"},[s("ButtonIcon",{attrs:{assistiveText:"Previous Month",iconCategory:"utility",iconName:"chevronleft",title:"Previous Month"},on:{click:t.previousMonth}}),t._v(" "),s("ButtonIcon",{attrs:{assistiveText:"Next Month",iconCategory:"utility",iconName:"chevronright",title:"Next Month"},on:{click:t.nextMonth}})],1),t._v(" "),s("LayoutItem",[s("Button",{attrs:{variant:"base",label:t.monthAndYear},on:{click:function(e){t.showDateWidget=!0}}}),t._v(" "),t.showDateWidget?s("Popover",{on:{close:function(e){t.showDateWidget=!1}}},[s("template",{slot:"content"},[s("Layout",{staticClass:"slds-p-around_medium"},[s("LayoutItem",[s("Select",{attrs:{value:t.month,options:t.months,hasNoneOption:!1},on:{input:t.updateMonth}})],1),t._v(" "),s("LayoutItem",{attrs:{alignmentBump:"left"}},[s("Select",{attrs:{value:t.year,options:t.years,hasNoneOption:!1},on:{input:t.updateYear}})],1)],1),t._v(" "),s("Layout",[s("LayoutItem",[s("Button",{attrs:{label:t.$Labels.MA_This_Month},on:{click:t.todayClick}})],1),t._v(" "),s("LayoutItem",{attrs:{alignmentBump:"left"}},[s("Button",{attrs:{label:t.$Labels.MA_Done,variant:"brand"},on:{click:t.hideDateWidget}})],1)],1)],1)],2):t._e()],1),t._v(" "),s("LayoutItem",{attrs:{alignmentBump:"left"}},[s("Button",{attrs:{id:"togglePastRoutes",label:t.$props.togglePastRoutesLabel,variant:"base"},on:{click:function(e){return t.$emit("togglePastRoutes")}}})],1)],1)],1)}),[],!1,null,"7b48f232",null).exports,M={components:{Modal:d.u_},props:{doShow:{type:Boolean,required:!0}},data:()=>({Labels:window.MASystem.Labels}),methods:{deleteRoute(){this.$emit("delete-route")},doHide(){this.$emit("update:doShow",!1)}}},C=(0,p.Z)(M,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.doShow?s("Modal",{attrs:{title:t.Labels.MA_Delete_Route,labels:{close:t.$Labels.MA_Close}},on:{close:t.doHide}},[s("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n        "+t._s(t.Labels.MA_Delete_Route_Confirm)+"\n    ")]),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.doHide}},[t._v("\n            "+t._s(t.Labels.MA_Cancel)+"\n        ")]),t._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:t.deleteRoute}},[t._v("\n            "+t._s(t.Labels.MA_Delete)+"\n        ")])])]):t._e()}),[],!1,null,null,null).exports;var R=s(9211),T=s(7082),$=s(1433),A=s(2072),S=s(379);const O={props:{start:{type:String,required:!0},isTwentyFourHour:{type:Boolean,required:!1,default:!1}},data:()=>({time:{}}),computed:{minuteOptions(){const t=[];for(let e=0;e<60;e++)e<10?t.push({value:`0${e}`,text:`0${e}`}):t.push({value:e,text:e});return t},hourOptions(){const t=[],e=this.isTwentyFourHour?25:13;for(let s=1;s<e;s++)t.push({value:s,text:s});return t}},watch:{time:{handler(){this.$emit("updateTime",this.time)},deep:!0},start(){this.parseStart()}},created(){this.parseStart()},methods:{parseStart(){let t="--",e="--",s="--";const o=this.start||"";try{const i=window.moment(o,"hh:mm a");i.isValid()&&(t=i.format("h"),e=i.format("mm"),s=i.format("a"))}catch(t){}this.time={hour:t,minute:e,ampm:s}}}},L=(0,p.Z)(O,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-select-group slds-grid"},[s("div",{staticClass:"slds-select_container slds-select_short"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.time.hour,expression:"time.hour"}],staticClass:"slds-select",attrs:{title:"Hour"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.time,"hour",e.target.multiple?s:s[0])}}},t._l(t.hourOptions,(function(e){return s("option",{key:e.value,domProps:{value:e.value}},[t._v("\n                "+t._s(e.text)+"\n            ")])})),0)]),t._v(" "),s("div",{staticClass:"slds-select_container slds-select_short"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.time.minute,expression:"time.minute"}],staticClass:"slds-select",attrs:{title:"Minute"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.time,"minute",e.target.multiple?s:s[0])}}},t._l(t.minuteOptions,(function(e){return s("option",{key:e.value,domProps:{value:e.value}},[t._v("\n                "+t._s(e.text)+"\n            ")])})),0)]),t._v(" "),t.isTwentyFourHour?t._e():s("div",{staticClass:"slds-select_container slds-select_short"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.time.ampm,expression:"time.ampm"}],staticClass:"slds-select",attrs:{title:"AM/PM"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.time,"ampm",e.target.multiple?s:s[0])}}},[s("option",{attrs:{value:"am"}},[t._v("AM")]),t._v(" "),s("option",{attrs:{value:"pm"}},[t._v("PM")])])])])}),[],!1,null,null,null).exports;var k=s(9486);const x={computed:{...(0,a.mapGetters)("routes",{store__waypoints:"waypoints",store__first:"first",store__last:"last"})},methods:{getWaypointRecordsForSave(){const t=[];let e=1;if(this.store__first&&0!==Object.keys(this.store__first).length){const s=this.$_RouteSave_buildRecordFromWaypoint(this.store__first,"start");s.sortOrder=e++,t.push(s)}if(this.store__waypoints.forEach((s=>{const o=this.$_RouteSave_buildRecordFromWaypoint(s,"unlocked");o.sortOrder=e++,t.push(o)})),this.store__last&&0!==Object.keys(this.store__last).length){const s=this.$_RouteSave_buildRecordFromWaypoint(this.store__last,"end");s.sortOrder=e++,t.push(s)}return t},$_RouteSave_convertToJSON(t){let e=window.htmlDecode(t);try{e=JSON.parse(e)}catch(t){e=l.Z.defaultOptions,e.saveError=!0}return e},$_RouteSave_buildRecordFromWaypoint(t,e){let s=t.Options__c;"string"==typeof s&&(s=this.$_RouteSave_convertToJSON(s)),s.LockType=e;let o=(0,i.m9)(t.Name)||"";o.length>=80&&(o=`${o.substring(0,77)}...`);let a=null;void 0!==t.BaseObjectId__c&&""!==t.BaseObjectId__c?a=t.BaseObjectId__c:void 0!==t.baseObjectId&&""!==t.baseObjectId&&(a=t.baseObjectId);let r=null;return void 0!==t.BaseObject__c&&""!==t.BaseObject__c?r=t.BaseObject__c:""!==t.baseObjectLabel&&void 0!==t.baseObjectLabel&&(r=t.baseObjectLabel),{recordId:t.recordId,isLocked:t.isLocked__c||!1,name:o,address:(0,i.m9)(t.Address__c),latitude:t.lat,longitude:t.lng,savedQueryId:0===(t.MarkerLayer__c||"").indexOf("OptionsLayer")?void 0:t.MarkerLayer__c,linkId:t.LinkId__c,notes:(0,i.m9)(t.Notes__c),options:JSON.stringify(s),baseObjectId:a,baseObject:r}}}},{$:E,moment:D,MA:N,isNum:I}=window,P={components:{Select:d.Ph,AssetSearch:v,Popover:d.J2,TextInput:d.oi},mixins:[x],props:{routeAsset:{type:Object,required:!0},routeDate:{type:Object,required:!0}},validations:{newRoute:{name:{required:k.required}}},data(){return{asset:this.routeAsset,date:this.routeDate,routeName:"",$calendar:{},events:[],showSaveRoutePopover:!1,saveRoutePopoverBindTo:null,saveRoutePostition:{}}},computed:{month:{get(){return this.date.month()},set(t){I(t)&&(this.date=this.date.month(t).clone())}},monthName:{get(){return this.getMonths()[this.date.month()].name}},year:{get(){return this.date.year()},set(t){I(t)&&(this.date=this.date.year(t).clone())}},newRoute:{get(){return{name:(0,i.m9)(this.routeName),date:this.date,asset:this.asset}}},assetSearchTerm:{get(){return this.asset.Name}},formattedNewRouteDate(){return this.newRoute.date.format("YYYY-MM-DD")},months(){return this.getMonths()},years(){return this.getYears()},...(0,a.mapGetters)("routes",{store__travelMode:"travelMode",store__route:"route",store__record:"record"})},watch:{date(t){t&&t.isValid()&&this.$calendar.fullCalendar("gotoDate",t),this.refreshEvents()},asset(){this.refreshEvents()},events(t){Array.isArray(t)&&this.$calendar.fullCalendar("renderEvents",t)}},created(){this.$bus.$on("render-calendar",this.render),this.routeName=this.store__record.Name},mounted(){this.initializeCalendar(),this.updateEvents()},destroyed(){this.$bus.$off("render-calendar")},methods:{getValidationMessages:(0,A.ed)({required:window.MASystem.Labels.MA_This_Field_Is_Required}),initializeCalendar(){this.$calendar=E(this.$refs.calendar),this.$calendar.fullCalendar({defaultDate:this.date,locale:"en",header:!1,height:"auto",contentHeight:"auto",eventLimit:3,eventLimitText:t=>`+${t} ${this.$Labels.MA_More}`,fixedWeekCount:!1,dayPopoverFormat:"LL",dayRender(t,e){e.addClass("route-calender-day")},eventRender(t,e){e.addClass("route-calender-event")},eventTextColor:"#FFFFFF",eventColor:"#348CD4",eventClick:t=>(this.$calendar.fullCalendar("select",t.start),!1),selectable:!0,select:(t,e,s)=>{this.newRoute.date=t.clone(),this.saveRoutePopoverBindTo=s.target,this.showSaveRoutePopover=!0},selectConstraint:{start:"0:00",end:"24:00"},views:{month:{titleFormat:"MMMM YYYY"}}})},render(){this.$calendar.fullCalendar("render")},getMonths(){return[{value:0,name:"January",label:this.$Labels.MA_January},{value:1,name:"February",label:this.$Labels.MA_February},{value:2,name:"March",label:this.$Labels.MA_March},{value:3,name:"April",label:this.$Labels.MA_April},{value:4,name:"May",label:this.$Labels.MA_May},{value:5,name:"June",label:this.$Labels.MA_June},{value:6,name:"July",label:this.$Labels.MA_July},{value:7,name:"August",label:this.$Labels.MA_August},{value:8,name:"September",label:this.$Labels.MA_September},{value:9,name:"October",label:this.$Labels.MA_October},{value:10,name:"November",label:this.$Labels.MA_November},{value:11,name:"December",label:this.$Labels.MA_December}]},getYears(){const t=[],e=Number(D().format("YYYY"));if("number"==typeof e)for(let s=e-5;s<=e+2;s++)t.push(s);return t},updateEvents(){const t=[];r.Z.getMARoutes({month:this.month,year:this.year,lookupId:this.asset.Id,lookupField:this.asset.field}).then((e=>{const s=N.getProperty(e,"routes");Object.keys(s).forEach((e=>{const o=s[e];window.isNum(e)&&Array.isArray(o)&&o.forEach((e=>{let s=null;N.Util.removeNamespace(e,"maps__");const o=N.getProperty(e,"routeId")||N.getProperty(e,"route.Id"),a=(0,i.m9)(N.getProperty(e,"route.Name")),r=N.getProperty(e,"route.Date__c")||N.getProperty(e,"route.RouteDate__c");s={id:o,title:a,start:D(r,"YYYY-MM-DD"),allDay:!0},t.push(s)}))})),this.events=t})).catch((t=>{console.warn("error while gettig route calendar events",t)}))},refreshEvents(){this.removeEvents(),this.updateEvents()},removeEvents(){this.$calendar.fullCalendar("removeEvents")},routePopoverSaveRoute(){this.hideSaveRoutePopover(),this.saveRoute().then((t=>{t&&t.routeId?(this.$bus.$emit("hide-plotted-route",t.routeId),this.$emit("close"),this.asset&&this.asset.Id!==this.routeAsset.Id&&this.$bus.$emit("update-asset",this.asset),this.$nextTick((()=>{this.$bus.$emit("display-route",t.routeId),this.$bus.$emit("refresh-route-list")}))):console.warn("unexpected response format.",t)})).catch((t=>{this.hideSaveRoutePopover(),window.MAToastMessages.showError({message:"Unable to save this route.",subMessage:String(t),timeOut:8e3,closeButton:!0}),console.warn(t)}))},hideSaveRoutePopover(){this.showSaveRoutePopover=!1},saveRoute(){return new Promise(((t,e)=>{let{summary:{totaltraveltime:s,distance:o}}=this.store__route;s&&(s/=60),o&&(o=(621371e-9*o).toFixed(1));const a={name:(0,i.m9)(this.newRoute.name),day:this.newRoute.date.date(),month:this.newRoute.date.month(),year:this.newRoute.date.year(),lookupId:this.newRoute.asset.Id,lookupField:this.newRoute.asset.field,options:{DriveProfile:this.store__travelMode,TimeBasedOptions:this.store__route.timeBasedOptions},distance:o,totaltraveltime:s,waypoints:this.getWaypointRecordsForSave()};r.Z.saveMARoute(a).then((e=>{t(e)})).catch(e)}))},assetChange(t){t&&(this.asset={Id:t.id,Name:t.label,field:N.getProperty(t,["fields",0,"apiName"]),type:N.getProperty(t,["fields",0,"label"])})}}},B=(0,p.Z)(P,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{position:"relative"}},[s("div",{staticClass:"slds-scope slds-grid slds-grid_vertical-align-center slds-p-around_small",attrs:{id:"saveRouteOptions"}},[s("div",{staticClass:"slds-p-right_medium asset-search-wrap"},[s("AssetSearch",{attrs:{storedSearchTerm:t.assetSearchTerm,placeholder:t.$Labels.MA_Search_UsersWithEllipsis,doDetach:!1,usersOnly:!1},on:{selected:t.assetChange}})],1),t._v(" "),s("div",{staticClass:"select-group slds-grid"},[s("div",[s("Select",{staticClass:"slds-p-right_xx-small",attrs:{options:t.months,hasNoneOption:!1,keyString:"value",valueString:"label"},model:{value:t.month,callback:function(e){t.month=e},expression:"month"}})],1),t._v(" "),s("div",[s("Select",{attrs:{options:t.years,hasNoneOption:!1},model:{value:t.year,callback:function(e){t.year=e},expression:"year"}})],1)])]),t._v(" "),s("div",{ref:"calendar",staticClass:"calendar-container saveRouteCalendar",attrs:{id:"fullCalendar"}}),t._v(" "),t.showSaveRoutePopover?s("Popover",{attrs:{bindTo:t.saveRoutePopoverBindTo,width:"medium"},on:{close:t.hideSaveRoutePopover}},[s("div",{staticClass:"slds-grid slds-p-around_xx-small",attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-form-element slds-col"},[s("div",{staticClass:"slds-form-element__control slds-grid"},[s("TextInput",{staticClass:"slds-col",attrs:{required:"",errors:t.getValidationMessages(t.$v.newRoute.name),labels:{name:t.$Labels.MA_Route_Name,placeholder:t.$Labels.routes_Give_Route_Name,required:t.$Labels.MA_Required}},model:{value:t.$v.newRoute.name.$model,callback:function(e){t.$set(t.$v.newRoute.name,"$model",e)},expression:"$v.newRoute.name.$model"}}),t._v(" "),s("div",{staticClass:"slds-p-left_small slds-grid slds-grid_vertical"},[s("label",{staticClass:"slds-m-bottom_xx-small"},[t._v(" ")]),t._v(" "),s("button",{staticClass:"slds-button slds-button_brand",attrs:{disabled:t.$v.$invalid},on:{click:t.routePopoverSaveRoute}},[t._v("\n                            "+t._s(t.$Labels.MA_Save)+"\n                        ")])])],1)])])]):t._e()],1)}),[],!1,null,"3a70a45a",null).exports,{Labels:W}=window.MASystem,H={components:{Modal:d.u_,RouteCalendar:B},props:{asset:{type:Object,required:!0},routeDate:{type:Object,required:!0}},data:()=>({Labels:W,isVisible:!1}),created(){this.$bus.$on("open-route-calendar-save-modal",this.show)},destroyed(){this.$bus.$off("open-route-calendar-save-modal")},methods:{close(){this.isVisible=!1},show(){this.isVisible=!0},modalMounted(){this.$bus.$emit("render-calendar")}}},F=(0,p.Z)(H,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.isVisible?s("Modal",{ref:"routeCalendarModal",staticClass:"save-route-calendar",attrs:{title:t.Labels.MA_Save_Route,labels:{close:t.$Labels.MA_Close}},on:{mounted:t.modalMounted,close:t.close}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("RouteCalendar",{ref:"calendar",attrs:{routeDate:t.routeDate,routeAsset:t.asset},on:{close:t.close}})],1),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"slds-grid"},[s("div",{staticClass:"slds-col"}),t._v(" "),s("div",{staticClass:"save-route-buttons slds-scope"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.close}},[t._v("\n                        "+t._s(t.Labels.MA_Close)+"\n                    ")])])])])]):t._e()],1)}),[],!1,null,null,null).exports,{MASystem:U,moment:G}=window,Z={components:{RouteCalendarModal:F,RouteConfirmDelete:C,RouteHeaderTime:L,ActionMenu:d.PC,ActionMenuItem:d.F9,DatePicker:d.Mt,Modal:d.u_,TextInput:d.oi},mixins:[x],props:{asset:{type:Object,required:!0}},validations:{recordName:{required:S.C1}},data:()=>({isTwentyFourHour:!1,importDate:G(),routeTimeHasError:!1,showResetConfirmationModal:!1,showImportEvents:!1,showConfirmDelete:!1,startTime:{},endTime:{}}),computed:{...(0,a.mapGetters)("routes",{store__travelMode:"travelMode",store__isTimeBased:"isTimeBased",store__waypoints:"waypoints",store__route:"route",store__record:"record"}),showSaveAs(){return!this.isNew&&!this.isGuideRoute&&!this.$v.$invalid},laborLawNotify:()=>window.getProperty(U||{},"Organization.LaborLawsNotify",!1)||!1,isNew(){return!this.store__record.Id},isGuideRoute(){return this.store__route.isGuideRoute},startString(){return this.store__route.timeBasedOptions.Start||n.Z.getRoutingDefaultStartTime()},endString(){return this.store__route.timeBasedOptions.End||n.Z.getRoutingDefaultEndTime()},recordName:{get(){return this.store__record.Name||""},set(t){this.store__updateRecord({Name:t}),this.store__setUnsavedChanges(!0)}},routeDate(){return window.moment(this.store__record.Date__c,"YYYY-MM-DD")},assetInfo(){return this.asset&&this.asset.type&&this.asset.Name?`${this.asset.type}: ${this.asset.Name}`:""},formattedRouteDate(){return this.routeDate.format(U.User.dateFormat.toUpperCase())},isTimeBased(){let t;return t="timeBased"===this.$store.state.defaultSettings.routeType.value||this.store__isTimeBased,t}},created(){this.$bus.$on("save-close-route",this.saveCloseRoute),this.initTimeData()},destroyed(){this.$bus.$off("save-close-route")},methods:{getValidationMessages:(0,A.ed)({required:window.MASystem.Labels.MA_Give_Route_Name}),...(0,a.mapMutations)("routes",{store__addRouteCallout:"addRouteCallout",store__removeRouteCallout:"removeRouteCallout",store__setUnsavedChanges:"setUnsavedChanges",store__setIsTimeBased:"setIsTimeBased",store__updateRoute:"updateRoute",store__updateRecord:"updateRecord"}),...(0,a.mapActions)("routes",{store__addWaypoints:"addWaypoints"}),initTimeData(){this.startTime=this.createMomentTimeObject(this.startString),this.endTime=this.createMomentTimeObject(this.endString),this.emitUpdate()},updateStartTime(t){this.startTime=t,this.validateTime("start"),this.emitUpdate()},updateEndTime(t){this.endTime=t,this.validateTime("end"),this.emitUpdate()},emitUpdate(){const t={Enabled:this.isTimeBased,Start:this.buildTimeStringFromStartEndObj(this.startTime),End:this.buildTimeStringFromStartEndObj(this.endTime)};this.store__updateRoute({timeBasedOptions:t})},openImportEvents(){if(this.isGuideRoute){const t={message:"Unable to import events.",subMessage:"Import Events is not supported for Advanced Route Routes.",timeOut:1e4,extendedTimeout:0,closeButton:!0};window.MAToastMessages.showWarning(t)}else this.showImportEvents=!0},hideImportEvents(){this.showImportEvents=!1},importEvents(t){this.isTimeBased||this.store__setIsTimeBased(!0),this.store__addRouteCallout(),r.Z.getEvents(t).then((t=>{t?this.store__addWaypoints(t):window.MAToastMessages.showWarning({message:"No Events",subMessage:"No events to import for this day.",timeout:2e3}),this.showImportEvents=!1})).catch((t=>{window.MAToastMessages.showError({message:"Error encountered while importing events.",subMessage:String(t),timeOut:8e3,closeButton:!0})})).finally((()=>{this.store__removeRouteCallout()}))},hideResetConfirmationModal(){this.showResetConfirmationModal=!1},toggleTimeBased(){this.isGuideRoute?window.MAToastMessages.showWarning({message:"Time Based Locked.",subMessage:"Time Based Settings are locked for Advanced Route Generated Routes.",closeButton:!0,timeOut:7e3,extendedTimeout:0}):(this.store__setIsTimeBased(!this.isTimeBased),this.store__setUnsavedChanges(!0),this.validateTime("start"),this.validateTime("end"),this.$emit("generate",!this.store__lockOrder))},validateTime(t){const e=this.buildTimeStringFromStartEndObj(this.startTime),s=this.buildTimeStringFromStartEndObj(this.endTime),o=window.moment(e,"h:mm a"),i=window.moment(s,"h:mm a");this.isTimeBased&&("start"===t?o.isAfter(i)?this.routeTimeHasError=!0:this.routeTimeHasError=!1:"end"===t&&(i.isBefore(o)?this.routeTimeHasError=!0:this.routeTimeHasError=!1))},createMomentTimeObject(t){let e=window.moment(t,"h:mm a");return e.isValid()||(e=window.moment("12:00 pm","hh:mm a")),{hour:this.isTwentyFourHour?e.format("H"):e.format("h"),minute:e.format("mm"),ampm:e.format("a")}},buildTimeStringFromStartEndObj(t){let e,s;return this.isTwentyFourHour?(e=`${t.hour} : ${t.minute}`,s=window.moment(e,"HH:mm")):(e=`${t.hour}:${t.minute} ${t.ampm}`,s=window.moment(e,"hh:mm a")),s.format("h:mm a")},confirmDeleteRoute(){this.showConfirmDelete=!0},deleteRoute(){this.$emit("deleteRoute")},confirmRemoveWaypoints(){this.showResetConfirmationModal=!0},removeWaypoints(){this.hideResetConfirmationModal(),this.$emit("resetRoute")},back(){this.$emit("back")},saveCloseRoute(){this.saveRoute(null,!0)},saveRoute(t,e=!1){if(this.$v.$touch(),this.$v.$invalid)return;if(this.routeTimeHasError&&this.isTimeBased)return void window.MAToastMessages.showError({message:"Unable to save this route.",subMessage:"Please validate the start and end times.",timeOut:8e3,closeButton:!0});if(this.isGuideRoute){let t=!1;if(this.store__waypoints.forEach((e=>{let s=e.Options__c;"string"==typeof s&&(s=this.$_RouteSave_convertToJSON(s)),s&&s.TimeBasedOptions&&s.TimeBasedOptions.Start!==this.$Labels.MA_Set_Start||(t=!0)})),t)return void window.MAToastMessages.showError({message:"Unable to save this route.",subMessage:"All stops in a Advanced Route route require a start time to save.",timeOut:8e3,closeButton:!0})}if(this.isNew)return void this.saveRouteAs();let{summary:{totaltraveltime:s,distance:o}}=this.store__route;s&&(s/=60),o&&(o=(621371e-9*o).toFixed(1));const a={name:(0,i.m9)(this.store__record.Name),Id:this.store__record.Id,day:this.routeDate.date(),month:this.routeDate.month(),year:this.routeDate.year(),lookupId:this.asset.Id,lookupField:this.asset.field,user:this.store__record.User__c,options:{DriveProfile:this.store__travelMode,TimeBasedOptions:this.store__route.timeBasedOptions},distance:o,totaltraveltime:s,waypoints:this.getWaypointRecordsForSave()},n=window.MAToastMessages.showLoading({message:this.$Labels.MA_Saving_Route,timeOut:0,extendedTimeOut:0});r.Z.saveMARoute(a).then((()=>{window.MAToastMessages.showSuccess({message:`${this.$Labels.MA_Success}! `,timeOut:5e3}),this.store__setUnsavedChanges(!1),this.$bus.$emit("refresh-route-list"),e&&this.$emit("exit")})).catch((t=>{window.MAToastMessages.showError({message:"Unable to save this route.",subMessage:String(t),timeOut:8e3,closeButton:!0}),console.warn("error while saving route.",t)})).finally((()=>{window.MAToastMessages.hideMessage(n)})),document.querySelector(".slds-button_success").blur()},saveRouteAs(){if(this.$v.$touch(),!this.$v.$invalid)if(this.isGuideRoute){const t={message:'"Save As" Unavailable',subMessage:"Advanced Route-generated routes cannot be reassigned or rescheduled.",timeOut:1e4,extendedTimeout:0,closeButton:!0};window.MAToastMessages.showWarning(t)}else this.$bus.$emit("open-route-calendar-save-modal")}}},Y=(0,p.Z)(Z,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.laborLawNotify?s("div",{staticClass:"labor-law-notification slds-notify_container slds-notify_container--inline"},[s("div",{staticClass:"slds-notify slds-notify--alert slds-theme--warning slds-theme--alert-texture slds-banner"},[s("h2",[t._v(t._s(t.$Labels.MA_Labor_Laws))])])]):t._e(),t._v(" "),s("div",{staticClass:"slds-p-top_small slds-p-bottom_small slds-p-left_medium slds-p-right_x-small slds-grid",attrs:{id:"routesSingleHeader"}},[t.showResetConfirmationModal?s("Modal",{attrs:{title:t.$Labels.MA_Are_You_Sure,labels:{close:t.$Labels.MA_Close}},on:{close:t.hideResetConfirmationModal}},[s("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n                "+t._s(t.$Labels.MA_Clear_Waypoints)+"\n            ")]),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.hideResetConfirmationModal}},[t._v("\n                    "+t._s(t.$Labels.MA_Cancel)+"\n                ")]),t._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:t.removeWaypoints}},[t._v("\n                    "+t._s(t.$Labels.MA_Remove_Waypoints)+"\n                ")])])]):t._e(),t._v(" "),t.showImportEvents?s("Modal",{staticClass:"ma-import-events-modal",attrs:{title:t.$Labels.MA_IMPORT_EVENTS,labels:{close:t.$Labels.MA_Close}},on:{close:t.hideImportEvents}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("DatePicker",{attrs:{locale:t.$User.UserLocale,dateFormat:t.$User.dateFormat.toUpperCase(),showInputField:!1,displayAsStatic:"",labels:{previousMonth:t.$Labels.MA_Previous_Month,nextMonth:t.$Labels.MA_Next_Month,selectDate:t.$Labels.MA_Select_A_Date,pickYear:t.$Labels.MA_Pick_A_Year,today:t.$Labels.MA_TODAY}},on:{changed:t.importEvents},model:{value:t.importDate,callback:function(e){t.importDate=e},expression:"importDate"}})],1),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_brand",on:{click:t.hideImportEvents}},[t._v("\n                    "+t._s(t.$Labels.MA_Cancel)+"\n                ")])])]):t._e(),t._v(" "),s("RouteConfirmDelete",{attrs:{doShow:t.showConfirmDelete},on:{"update:doShow":function(e){t.showConfirmDelete=e},"update:do-show":function(e){t.showConfirmDelete=e},"delete-route":t.deleteRoute}}),t._v(" "),s("div",{staticClass:"slds-col"},[s("div",{staticClass:"slds-grid slds-p-bottom_small ma-route-top-menu"},[s("div",{staticClass:"slds-col slds-p-right_xx-small"},[s("TextInput",{staticClass:"slds-form-element_inverse",attrs:{required:"",errors:t.getValidationMessages(t.$v.recordName),labels:{placeholder:t.$Labels.routes_Route_Name,required:t.$Labels.MA_Required}},model:{value:t.$v.recordName.$model,callback:function(e){t.$set(t.$v.recordName,"$model",e)},expression:"$v.recordName.$model"}},[s("span",{staticClass:"slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default ma-icon ma-icon-edit editHeaderRouteName",attrs:{slot:"extendInput"},slot:"extendInput"})])],1),t._v(" "),s("div",{staticClass:"slds-p-right_small"},[s("div",{staticClass:"slds-button-group",attrs:{role:"group"}},[s("button",{staticClass:"slds-button slds-button_success",attrs:{disabled:t.$v.$invalid,"data-pendo":"route_save"},on:{click:t.saveRoute}},[t._v("\n                            "+t._s(t.$Labels.MA_Save)+"\n                        ")]),t._v(" "),t.showSaveAs?s("ActionMenu",{staticClass:"slds-button_last ma-save-as",attrs:{forceRight:!0,showMoreLabel:t.$Labels.MA_SHOW_MORE}},[s("button",{staticClass:"slds-button slds-button_success slds-button_icon slds-button_icon-border-filled",attrs:{slot:"button",id:"routesSingleSaveDropdownButton"},slot:"button"},[s("span",{staticClass:"slds-button__icon ma-icon ma-icon-down"})]),t._v(" "),s("ActionMenuItem",{staticClass:"ma-save-as-button",attrs:{"data-pendo":"route_save-as",label:t.$Labels.MA_SaveAs},on:{click:t.saveRouteAs}})],1):t._e()],1)]),t._v(" "),s("div",[s("ActionMenu",{attrs:{showMoreLabel:t.$Labels.MA_SHOW_MORE}},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",attrs:{slot:"button"},slot:"button"},[s("span",{staticClass:"ma-icon ma-icon-threedots-vertical"})]),t._v(" "),s("ActionMenuItem",{attrs:{label:t.$Labels.MA_Delete_Route},on:{click:t.confirmDeleteRoute}}),t._v(" "),s("ActionMenuItem",{attrs:{label:t.$Labels.MA_Remove_Waypoints},on:{click:t.confirmRemoveWaypoints}}),t._v(" "),s("ActionMenuItem",{attrs:{label:t.$Labels.MA_IMPORT_EVENTS},on:{click:t.openImportEvents}})],1)],1),t._v(" "),s("div",{staticClass:"slds-p-left_xx-small"},[s("button",{staticClass:"slds-button slds-button_icon-container has-hover-tooltip",attrs:{id:"routesSingleBackButton"},on:{click:t.back}},[s("span",{staticClass:"slds-button__icon ma-icon ma-icon-close"}),t._v(" "),s("div",{staticClass:"slds-popover slds-popover_tooltip slds-nubbin_left"},[s("div",{staticClass:"slds-popover__body"},[t._v("\n                                "+t._s(t.$Labels.MA_Close_Remove_Map)+"\n                            ")])])])])]),t._v(" "),s("div",{staticClass:"slds-grid slds-grid_vertical-align-center"},[s("div",{staticClass:"slds-col slds-grid slds-text-color_weak"},[s("div",{staticClass:"ma-user-label slds-truncate slds-p-right_medium"},[t._v(t._s(t.assetInfo))]),t._v(" "),s("div",{staticClass:"slds-grid",attrs:{id:"datepickerContainer"}},[t._m(0),t._v(" "),s("div",[t._v(t._s(t.formattedRouteDate))])])]),t._v(" "),s("div",{staticClass:"timeBasedTempButton slds-col_bump-left slds-p-left_xx-small"},[s("span",{staticClass:"slds-m-right_xx-small"},[t._v("\n                        "+t._s(t.$Labels.routes_Route_Type)+": "),s("span",{staticClass:"slds-text-title_bold"},[t._v(t._s(t.isTimeBased?t.$Labels.routes_Time_Based:t.$Labels.MA_Standard))])]),t._v(" "),s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container has-hover-tooltip",class:{"active slds-is-selected":t.isTimeBased},attrs:{id:"js-toggleTimeBased",disabled:!t.$store.state.defaultSettings.routeType.overridable},on:{click:t.toggleTimeBased}},[s("span",{staticClass:"slds-button__icon_large ma-icon ma-icon-clock"}),t._v(" "),s("div",{staticClass:"slds-popover slds-popover_tooltip slds-nubbin_left"},[s("div",{staticClass:"slds-popover__body"},[t._v("\n                                "+t._s(t.$Labels.MA_Toggle_Time_Based)+"\n                            ")])])])])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isTimeBased,expression:"isTimeBased"}],staticClass:"slds-grid slds-grid_vertical-align-center time-based-clock-container",class:{"slds-has-error":t.routeTimeHasError}},[s("div",{staticClass:"slds-grid"},[s("RouteHeaderTime",{attrs:{start:t.startString,isTwentyFourHour:t.isTwentyFourHour},on:{updateTime:t.updateStartTime}}),t._v(" "),s("div",{staticClass:"slds-p-horizontal_xx-small slds-p-top_xx-small"},[t._v("–")]),t._v(" "),s("RouteHeaderTime",{attrs:{start:t.endString,isTwentyFourHour:t.isTwentyFourHour},on:{updateTime:t.updateEndTime}})],1)]),t._v(" "),t.isGuideRoute?s("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-scope Advanced Route-route-header"},[s("div",{staticClass:"slds-text-title_caps",staticStyle:{"margin-top":"5px"}},[s("div",{staticClass:"icon ma-icon-Advanced Route-logo"},[t._v(t._s(t.$Labels.routes_Maps_Advanced))])])]):t._e()]),t._v(" "),s("RouteCalendarModal",{attrs:{routeDate:t.routeDate,asset:t.asset}})],1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"slds-m-right_xx-small"},[e("span",{staticClass:"slds-icon slds-icon_xx-small ma-icon ma-icon-event"})])}],!1,null,"6a6cf39e",null).exports;var j=s(7102);const{MA:q}=window,V={components:{Select:d.Ph},directives:{"click-outside":j.Z},props:{travelMode:{type:String,default:i.HM.DRIVING.value},isGuideRoute:{type:Boolean,required:!1,default:!1}},data:()=>({userOverridable:!0,isTravelModeVisible:!1,selectedCustomProfile:"",customProfiles:[],isCustomDriveVisible:!1,TravelModes:i.HM}),computed:{isDrivingTravelMode(){return this.travelMode===i.HM.DRIVING.value},isWalkingTravelMode(){return this.travelMode===i.HM.WALKING.value},isBicylingTravelMode(){return this.travelMode===i.HM.BICYCLING.value},isCustomTravelMode(){return this.isValidCustomProfile(this.travelMode)},travelIcon(){let{icon:t}=i.HM.DRIVING;return Object.keys(i.HM).forEach((e=>{i.HM[e].value===this.travelMode&&({icon:t}=i.HM[e])})),t},currentTravelModeTitle(){let t,e="";return this.isValidStandardProfile(this.travelMode)?t=Object.keys(i.HM).filter((t=>q.getProperty(i.HM,[t,"value"])===this.travelMode)).map((t=>q.getProperty(i.HM,[t,"label"]))):this.isValidCustomProfile(this.travelMode)&&(t=this.customProfiles.filter((t=>t.Id===this.travelMode)).map((t=>t.Name))),Array.isArray(t)&&([e="Unknown"]=t),e},customProfileOptions(){return this.customProfiles.map((t=>({value:t.Id,label:t.Name})))},clickOutsideOptions(){return{active:!0,handler:this.hideTravelMode}}},watch:{travelMode(t){t&&!this.isValidCustomProfile(t)&&(this.selectedCustomProfile="")},selectedCustomProfile(t){t&&this.setTravelMode(t)}},created(){this.loadDriverProfiles(),this.setDefaultValues()},methods:{showTravelMode(){this.isTravelModeVisible||(this.isTravelModeVisible=!0)},hideTravelMode(){this.isTravelModeVisible=!1},showCustomDriveSelector(){this.isCustomDriveVisible||(this.isCustomDriveVisible=!0)},hideCustomDriveSelector(){this.isCustomDriveVisible=!1},selectTravelMode(t){this.isGuideRoute&&t!==i.HM.DRIVING.value?window.MAToastMessages.showWarning({message:"Drive Profile Unavailable.",subMessage:this.$Labels.AdvRoute_Profiles_Warning,timeOut:7e3,extendedTimeout:0,closeButton:!0}):t!==i.HM.CUSTOM.value?(this.hideCustomDriveSelector(),this.setTravelMode(t)):this.showCustomDriveSelector()},setTravelMode(t){this.hideTravelMode(),this.isValidTravelMode(t)?this.$emit("update:travelMode",t):this.errmsg="Invalid travel mode. Please try again."},loadDriverProfiles(){this.buildDriverProfiles().then((t=>{this.customProfiles=[],t.forEach((t=>{t.Name&&this.customProfiles.push(t)})),this.isValidCustomProfile(this.travelMode)&&(this.isCustomDriveVisible=!0,this.selectedCustomProfile=this.travelMode)}))},buildDriverProfiles(){const t={ajaxResource:"RouteCalendarAJAXResources",action:"getDriveProfiles"};return new Promise(((e,s)=>{(new c.Z).setAction(window.MARemoting.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this,s)).invoke([t],(t=>{t&&t.success&&e(t.data.driveProfiles)}),{escape:!1})}))},isValidTravelMode(t){return this.isValidStandardProfile(t)||this.isValidCustomProfile(t)},isValidStandardProfile:t=>Object.keys(i.HM).map((t=>q.getProperty(i.HM,[t,"value"]))).includes(t),isValidCustomProfile(t){return this.customProfiles.map((t=>t.Id)).includes(t)},customProfileSelect(t){this.isValidCustomProfile(t)?this.showCustomDriveSelector():(this.hideCustomDriveSelector(),this.setTravelMode("driving"))},handleRemoteActionError(t,e,s){t(new Error(`Unable to load custom driver profiles. ${s.message}`))},setDefaultValues(){this.$store.state.defaultSettings.defaultTransportationMode.overridable?this.selectTravelMode(window.userSettings.RouteDefaults.driveProfile):(this.selectTravelMode(this.$store.state.defaultSettings.defaultTransportationMode.value),this.userOverridable=!1)}}},z=(0,p.Z)(V,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ma-travel-mode"},[s("div",{staticClass:"slds-is-relative ma-travel-mode",attrs:{"data-reactroot":""}},[s("div",{staticClass:"slds-button slds-button_icon slds-button_icon-container slds-button_icon-more-flex",attrs:{title:t.currentTravelModeTitle},on:{click:t.showTravelMode}},[s("span",{staticClass:"slds-button__icon_large ma-icon",class:t.travelIcon}),t._v(" "),s("span",{staticClass:"slds-button__icon_x-small ma-icon ma-icon-down"})]),t._v(" "),t._m(0)]),t._v(" "),t.isTravelModeVisible?s("section",{directives:[{name:"click-outside",rawName:"v-click-outside:[clickOutsideOptions]",arg:t.clickOutsideOptions}],staticClass:"slds-popover slds-nubbin_top-left slds-dynamic-menu",staticStyle:{position:"absolute","margin-top":"15px","margin-left":"-7px"}},[s("div",{staticClass:"slds-popover__body slds-p-horizontal_none"},[s("div",{staticClass:"slds-p-vertical_x-small slds-p-horizontal_small"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:""}},[t._v(t._s(t.$Labels.routes_Transportation_Mode))]),t._v(" "),s("div",{staticClass:"slds-button-group slds-grid",attrs:{role:"group"}},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-border-filled",class:{"slds-is-selected":t.isDrivingTravelMode},attrs:{title:t.TravelModes.DRIVING.label,"aria-pressed":"true",disabled:!t.userOverridable},on:{click:function(e){return t.selectTravelMode(t.TravelModes.DRIVING.value)}}},[s("span",{staticClass:"slds-icon slds-button__icon slds-icon-text-default ma-icon ma-icon-custom31"}),t._v(" "),s("span",{staticClass:"slds-assistive-text"},[t._v(t._s(t.TravelModes.DRIVING.label))])]),t._v(" "),s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-border-filled",class:{"slds-is-selected":t.isWalkingTravelMode},attrs:{title:t.TravelModes.WALKING.label,"aria-pressed":"true",disabled:!t.userOverridable},on:{click:function(e){return t.selectTravelMode(t.TravelModes.WALKING.value)}}},[s("span",{staticClass:"slds-icon slds-button__icon slds-icon-text-default ma-icon ma-icon-walk"}),t._v(" "),s("span",{staticClass:"slds-assistive-text"},[t._v(t._s(t.TravelModes.WALKING.label))])]),t._v(" "),s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-border-filled",class:{"slds-is-selected":t.isBicylingTravelMode},attrs:{title:t.TravelModes.BICYCLING.label,"aria-pressed":"true",disabled:!t.userOverridable},on:{click:function(e){return t.selectTravelMode(t.TravelModes.BICYCLING.value)}}},[s("span",{staticClass:"slds-icon slds-button__icon slds-icon-text-default ma-icon ma-icon-bicycle"}),t._v(" "),s("span",{staticClass:"slds-assistive-text"},[t._v(t._s(t.TravelModes.BICYCLING.label))])]),t._v(" "),s("button",{staticClass:"slds-button slds-button_neutral custom-travel-button",class:{"slds-is-selected":t.isCustomTravelMode},attrs:{title:t.TravelModes.DRIVING.label,"aria-pressed":"true",disabled:!t.userOverridable},on:{click:function(e){return t.selectTravelMode(t.TravelModes.CUSTOM.value)}}},[s("span",{staticClass:"slds-icon slds-button__icon slds-button__icon_left ma-icon ma-icon-new-custom98"}),t._v("\n                        "+t._s(t.TravelModes.CUSTOM.label)+"\n                        "),s("span",{staticClass:"slds-assistive-text"},[t._v(t._s(t.TravelModes.CUSTOM.label))])])]),t._v(" "),t.isCustomDriveVisible?s("Select",{staticClass:"slds-p-top_small",attrs:{labels:{name:t.$Labels.MA_Drive_Profiles,none:t.$Labels.MA_None},options:t.customProfileOptions,hasNoneOption:"",keyString:"value",valueString:"label"},on:{input:t.customProfileSelect},model:{value:t.selectedCustomProfile,callback:function(e){t.selectedCustomProfile=e},expression:"selectedCustomProfile"}}):t._e()],1)])]):t._e()])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{staticClass:"slds-button slds-button_icon",attrs:{title:"Show Travel Modes"}},[s("span",{staticClass:"slds-assistive-text"},[t._v("Travel Mode")])])}],!1,null,"44545e00",null).exports,J={components:{Checkbox:d.XZ,DriveProfileSelector:z},props:{onMap:{type:Boolean,default:!1},showOnTheMapToggle:{type:Boolean,default:!1}},data:()=>({storedTravelMode:"",Labels:window.MASystem.Labels}),computed:{buttonLabel(){return this.store__lockOrder?this.Labels.MA_Get_Directions:this.Labels.MA_Optimize},...(0,a.mapGetters)("routes",{store__pendingChanges:"pendingChanges",store__travelMode:"travelMode",store__lockOrder:"lockOrder",store__isGuideRoute:"isGuideRoute"})},watch:{storedTravelMode(t){t!==this.store__travelMode&&(this.store__setTravelMode(t),this.store__pendingChanges||this.store__setPendingChange(!0),this.reloadMap())}},created(){this.$bus.$on("toggle-order-lock-on",this.lock),this.storedTravelMode=this.store__travelMode},destroyed(){this.$bus.$off("toggle-order-lock-on",this.lock)},methods:{...(0,a.mapMutations)("routes",{store__setTravelMode:"setTravelMode",store__setPendingChange:"setPendingChange",store__setLockOrder:"setLockOrder"}),reloadMap(){this.$emit("generate",!this.store__lockOrder)},updateToggleValue(){this.$emit("toggleRoute",!this.onMap)},updateLockOrder(){this.store__setLockOrder(!this.store__lockOrder)},lock(){this.store__lockOrder||this.store__setLockOrder(!0)}}},K=(0,p.Z)(J,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-p-horizontal_medium slds-p-vertical_x-small slds-grid slds-grid_vertical-align-center",attrs:{id:"routesSingleControlBar"}},[s("div",[s("button",{staticClass:"slds-button slds-button_brand",attrs:{id:"generateRoute"},on:{click:t.reloadMap}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-route"}),t._v(" "),s("span",{attrs:{id:"optimizeGenerate"}},[t._v(t._s(t.buttonLabel))])])]),t._v(" "),s("div",{staticClass:"slds-p-left_x-small"},[s("DriveProfileSelector",{attrs:{isGuideRoute:t.store__isGuideRoute,travelMode:t.storedTravelMode},on:{"update:travelMode":function(e){t.storedTravelMode=e},"update:travel-mode":function(e){t.storedTravelMode=e}}})],1),t._v(" "),s("div",{staticClass:"lock-stop-toggle-wrap slds-form-element slds-p-left_x-small route-control-toggle-wrap"},[s("Checkbox",{attrs:{value:t.store__lockOrder,labels:{name:t.Labels.MA_Lock_Order},slide:""},on:{changed:t.updateLockOrder}})],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showOnTheMapToggle,expression:"showOnTheMapToggle"}],staticClass:"on-the-map-toggle-wrap slds-form-element slds-col_bump-left route-control-toggle-wrap"},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",on:{click:t.updateToggleValue}},[s("span",{staticClass:"slds-button__icon slds-button__icon_hint ma-icon",class:[t.onMap?"ma-icon-preview":"ma-icon-hide"],attrs:{"aria-hidden":"true"}})])])])}),[],!1,null,"06fa58cc",null).exports;var Q=[function(){var t=this.$createElement,e=this._self._c||t;return e("figure",{staticClass:"slds-m-bottom_medium"},[e("img",{attrs:{src:s(2004)}})])}],X=s(9980),tt=s.n(X);const et={directives:{"click-outside":j.Z},props:{doDetach:{type:Boolean,default:!1},direction:{type:String,default:"slds-nubbin_top-left"},isOpen:{type:Boolean,default:!0},position:{type:Object,required:!1,default:()=>({top:0,left:0})}},data:()=>({}),computed:{clickOutsideOptions(){return{active:this.isOpen,handler:this.doHide}}},mounted(){this.doDetach?this.detachPopover():(this.$refs.popover.style.left="0px",this.$refs.popover.style.position="absolute")},methods:{detachPopover(){if(!this.position||!this.position.top||!this.position.left)return;const t=this.$refs.popover.getBoundingClientRect(),e=this.position.left+t.width/10,s=this.position.top+t.height/2;this.$refs.popover.style.top=`${s}px`,this.$refs.popover.style.left=`${e}px`,this.$refs.popover.style.position="fixed"},doHide(){this.isOpen&&this.$emit("update:isOpen",!1)}}},st=(0,p.Z)(et,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{directives:[{name:"show",rawName:"v-show",value:t.isOpen,expression:"isOpen"},{name:"click-outside",rawName:"v-click-outside:[clickOutsideOptions]",arg:t.clickOutsideOptions}],ref:"popover",staticClass:"slds-popover slds-dynamic-menu slds-p-horizontal_small",class:t.direction,attrs:{role:"dialog","aria-label":"popover","aria-describedby":"dialog-body-id-17"}},[s("div",{staticClass:"slds-popover__body slds-p-horizontal_none",attrs:{id:"dialog-body-id-17"}},[s("div",{staticClass:"slds-form-element"},[t._t("content",(function(){return[t._v("default content")]}))],2)])])}),[],!1,null,null,null).exports;var ot=s(8939);const it={name:"RouteTimeOptions",components:{Select:d.Ph,Picklist:d.Gp},props:{start:{type:String,required:!0},duration:{type:String,required:!0},isTwentyFourHour:{type:Boolean,required:!1,default:!1}},data(){return{time:"",hour:"0",minute:"0",times:[...this.getHours("am"),...this.getHours("pm")],hours:this.generateHourOptions(),minutes:this.generateMinuteOptions()}},computed:{durationOutput(){return`${this.hour} hr, ${this.minute} min`}},created(){this.parseStart(),this.parseDuration()},methods:{getHours(t){const e=[];for(let s=0;s<12;s++){const o=0===s?12:s;e.push(this.createOption(`${o}:00${t}`)),e.push(this.createOption(`${o}:30${t}`))}return e},generateHourOptions(){const t=[];for(let e=0;e<13;e++)t.push({key:e.toString(),value:e.toString()});return t},generateMinuteOptions(){const t=[];for(let e=0;e<12;e++){const s=5*e;t.push({key:s.toString(),value:s.toString()})}return t},createOption:t=>({key:t,value:t}),selectTime(t){if(""!==t)try{const e=window.moment(t,"h:mma");e.isValid()?this.$emit("update:start",e.format("hh:mm a")):this.time=this.start}catch(t){console.warn(`Failed to parse start time: ${t}`)}else this.$emit("update:start",this.time)},selectMinute(t){this.minute=t,this.$emit("update:duration",this.durationOutput)},selectHour(t){this.hour=t,this.$emit("update:duration",this.durationOutput)},parseStart(){try{const t=window.moment(this.start,"hh:mm a");t.isValid()?this.time=t.format("h:mma"):this.time=""}catch(t){console.warn(`Failed to parse start time: ${t}`)}},parseDuration(){let t="0",e="0";try{const s=(window.userSettings.RouteDefaults.duration||"").split(",");t=s[0]||"0 hr",e=s[1]||"0 min",t=t.replace(/\D/g,""),e=e.replace(/\D/g,"")}catch(s){t="0",e="0"}this.hour=t,this.minute=e,this.minutes.find((t=>t.key===e))||this.minutes.push(e)}}},at=(0,p.Z)(it,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-grid"},[s("div",{staticClass:"slds-form-element inline slds-p-right_small time-based-start-select-wrap"},[s("Picklist",{attrs:{options:t.times,combobox:"",labels:{placeholder:t.$Labels.MA_Set_Start},titleKey:"value",idKey:"key"},on:{changed:t.selectTime},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),t._v(" "),s("div",{staticClass:"slds-col"},[s("div",{staticClass:"slds-grid slds-grid_vertical-align-center"},[t.$store.state.defaultSettings.stopEventDuration.overridable?s("Select",{attrs:{options:t.hours,hasNoneOption:!1},on:{input:t.selectHour},model:{value:t.hour,callback:function(e){t.hour=e},expression:"hour"}}):s("select",{staticClass:"slds-select",attrs:{placeholder:t.hour,disabled:""}},[s("option",{domProps:{value:t.hour}},[t._v("\n                    "+t._s(t.hour)+"\n                ")])]),t._v(" "),s("div",{staticClass:"time-duration-units"},[t._v(t._s(t.$Labels.MA_hrs))]),t._v(" "),t.$store.state.defaultSettings.stopEventDuration.overridable?s("Select",{attrs:{options:t.minutes,hasNoneOption:!1},on:{input:t.selectMinute},model:{value:t.minute,callback:function(e){t.minute=e},expression:"minute"}}):s("select",{staticClass:"slds-select",attrs:{placeholder:t.minute,disabled:""}},[s("option",{domProps:{value:t.minute}},[t._v("\n                    "+t._s(t.minute)+"\n                ")])]),t._v(" "),s("div",{staticClass:"time-duration-units"},[t._v(t._s(t.$Labels.MA_Mins))])],1)])])}),[],!1,null,"1adc7363",null).exports,{moment:rt,MA:nt}=window,lt={name:"RouteBodyWaypoint",components:{ActionMenu:d.PC,ActionMenuItem:d.F9,RouteTimeOptions:at,RouteTimeAndDistance:ot.Z,TextInput:d.oi},inject:["routeBodyRef"],props:{type:{type:String,default:"waypoint"},waypoint:{type:Object,required:!0},isDisabled:{type:Boolean,default:!1}},validations:{name:{required:k.required},address:{required:k.required}},data(){return{showEditMode:!1,showTimeEditMode:!1,name:this.waypoint.Name||"",note:(0,i.m9)(this.waypoint.Notes__c||""),address:this.waypoint.Address__c||"",waypointOptions:{},toast:"",duration:"",start:"",timeIs24Hr:!1,showOverflowActions:!1,doShowActionMenu:!1}},computed:{showTimeDistance(){return!this.store__pendingChanges&&this.waypoint.distance},formattedDuration(){return this.waypointOptions.TimeBasedOptions.Duration},startString(){return this.waypointOptions.TimeBasedOptions.Start},divClass(){let t="";return this.showError&&(this.isGuideRoute?t+="has-warning ":t+="has-error "),this.showEditMode&&(t+="is-editing "),this.isWaypoint?t+="routes-destination-list-item slds-card":this.isStart?t+="routes-start-list-item":this.isEnd&&(t+="routes-end-list-item"),t},editIcon(){return this.showEditMode?"ma-icon-check":"ma-icon-edit"},inlineErrorClass(){return this.store__isGuideRoute?"slds-inline_icon_text--warning":"slds-inline_icon_text--error"},isStart(){return"start"===this.type},isEnd(){return"end"===this.type},isWaypoint(){return"waypoint"===this.type},isLocked(){return!!this.waypoint.isLocked__c&&this.waypoint.isLocked__c},url(){let t;const e=window.getProperty(this.waypoint,"marker.record.Id");t=nt.IsCommunity?this.waypoint.LinkId__c?this.waypoint.LinkId__c:void 0!==e?e:void 0:this.waypoint.LinkId__c?this.waypoint.LinkId__c:void 0;const s=nt.IsCommunity&&nt.CommunityBaseUrl?nt.CommunityBaseUrl:"";return void 0!==t?`${s}/${t}`:void 0},allowUpdateName(){return this.isWaypoint&&!this.waypoint.LinkId__c},showError(){return this.waypoint.errorMsg&&this.waypoint.erroramount&&this.waypoint.erroramount>120},errorString(){const t=this.waypoint.erroramount||0,e=Math.round(parseFloat(t/60));let{errorMsg:s}=this.waypoint;if(!s||""===s||"Unreachable"===s)if(e>=60){const t=e%60;s=`${Math.floor(e/60)} hour(s)${0===t?" ":` ${t} min(s) `}late for appointment`}else s=`${e} min(s) late for appointment`;return s},showArrivalDeparture(){return this.waypoint.arrivaltime&&this.waypoint.departuretime&&this.store__isTimeBased&&!this.showEditMode&&!this.store__pendingChanges},arrivalDeparture(){return this.isStart?(0,u.N4)(this.$Labels.routes_Departure,[this.arrivalString]):this.isEnd?(0,u.N4)(this.$Labels.routes_Arrival,[this.arrivalString]):(0,u.N4)(this.$Labels.routes_Arrival_And_Departure,[this.arrivalString,this.departureString])},departureString(){return this.waypoint.departuretime?rt.unix(this.waypoint.departuretime).format("h:mma"):""},arrivalString(){return this.waypoint.arrivaltime?rt.unix(this.waypoint.arrivaltime).format("h:mma"):""},appointmentStart(){return this.waypoint.start?rt.unix(this.waypoint.start):void 0},applyLabel(){return this.isStart?this.$Labels.routes_Apply_End:this.$Labels.routes_Apply_Start},...(0,a.mapGetters)("routes",{store__pendingChanges:"pendingChanges",store__travelMode:"travelMode",store__isTimeBased:"isTimeBased",store__isGuideRoute:"isGuideRoute"}),scrollToThisError(){return this.waypoint.scrollToThisError}},watch:{waypoint(){this.waypoint.Options__c&&"object"==typeof this.waypoint.Options__c&&this.waypoint.Options__c.TimeBasedOptions!==this.waypointOptions.TimeBasedOptions&&this.applyWaypointOptions(),this.waypoint.Address__c!==this.address&&(this.address=this.waypoint.Address__c||""),this.waypoint.Name!==this.name&&(this.name=this.waypoint.Name||"")},scrollToThisError(t){if(t){const t=this.routeBodyRef();if(!t)return;const e=t.offsetTop,s=this.$el.offsetTop;t.scrollTop=s-e}}},created(){this.applyWaypointOptions()},methods:{getValidationMessages:(0,A.ed)({required:window.MASystem.Labels.MA_Field_Req,maxLength:window.MASystem.Labels.MA_Max_Length_80}),...(0,a.mapActions)("routes",{store__updateFirst:"updateFirst",store__updateLast:"updateLast",store__setToStart:"setToStart",store__setToEnd:"setToEnd"}),decodeWaypointOptions(){let t=this.waypoint.Options__c;if("object"==typeof t)t=this.waypoint.Options__c;else if("string"==typeof t){t=(0,i.m9)(this.waypoint.Options__c);try{t=JSON.parse(t)}catch(e){t=l.Z.defaultOptions}}else t=l.Z.defaultOptions;return t},applyWaypointOptions(){this.waypointOptions=this.decodeWaypointOptions();const t=this.waypointOptions.TimeBasedOptions||{};this.timeIs24Hr=!1,this.start=t.Start,this.duration=t.Duration},applyTo(){this.isStart?this.store__updateLast({...this.waypoint,id:(0,i.ZP)()}):this.store__updateFirst({...this.waypoint,id:(0,i.ZP)()})},remove(){this.$emit("remove",this.waypoint.id)},edit(){this.showEditMode?this.save():(this.showTimeEditMode=!1,this.showEditMode=!0)},applyRouteTime(){let t=this.start;""===t&&(t=this.$Labels.MA_Set_Start),this.waypointOptions.TimeBasedOptions.Start=t;let e=this.duration;""===e&&(e="0 hr, 0 min"),this.waypointOptions.TimeBasedOptions.Duration=e},saveRouteTime(){this.applyRouteTime(),this.emitSave({Options__c:this.waypointOptions}),this.toggleTimeEditMode(!1)},toggleLockGuideRoute(){this.waypoint.isLocked__c=!this.waypoint.isLocked__c},toggleTimeEditMode(t){this.showEditMode||(t&&this.applyWaypointOptions(),this.showTimeEditMode=t)},save(){this.$v.$touch(),this.$v.$invalid||(this.applyRouteTime(),this.address!==this.waypoint.Address__c?r.Z.geocode(this.address).then((t=>{if(!(t&&t.position&&t.position.lat&&t.position.lng))throw new Error("New Address failed to geocode");this.emitSave({Name:this.name,Notes__c:this.note,Address__c:this.address,Options__c:this.waypointOptions,lat:t.position.lat,lng:t.position.lng})})).catch((t=>{this.toast=t.message})):this.emitSave({Name:this.name,Notes__c:this.note,Address__c:this.address,Options__c:this.waypointOptions}))},emitSave(t){this.showEditMode=!1,this.$emit("update",{...this.waypoint,...t})},over(){this.showOverflowActions=!0},out(t){const e=t.toElement||t.relatedTarget,s=this.$refs.wrapper.contains(e),o=this.$refs.actionMenu.$refs.menu,i=e===o,a=o&&this.$refs.actionMenu.$refs.menu.contains(e);s||i||a||(this.showOverflowActions=!1,this.doShowActionMenu=!1)},mouseoutActionMenu(t){this.$refs.actionMenu.$refs.menu.contains(t.toElement)||t.toElement===this.$refs.wrapper||this.$refs.wrapper.contains(t.toElement)||(this.doShowActionMenu=!1)}}},dt=(0,p.Z)(lt,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{ref:"wrapper",class:t.divClass,on:{mouseover:t.over,mouseleave:t.out}},[t.isWaypoint?s("div",{staticClass:"waypoint-marker routes-destination-sortable-icon"},[s("span",{staticClass:"ma-icon ma-icon-move"})]):t._e(),t._v(" "),t.isWaypoint?s("div",{staticClass:"routes-destination-counter-wrap"},[s("div",{staticClass:"routes-destination-counter"},[t._v("\n                "+t._s(t.waypoint.index)+"\n                "),s("div",{staticClass:"routes-destination-counter_nubbin-shadow"})])]):t.isStart?s("div",{staticClass:"routes-start-destination"},[t._m(0),t._v(" "),s("div",{staticClass:"routes-start-icon_nubbin-shadow"})]):t.isEnd?s("div",{staticClass:"routes-end-destination"},[t._m(1)]):t._e(),t._v(" "),s("div",{staticClass:"ma-routes-waypoint-entry slds-col slds-p-right_x-small",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"routes-destination-list-item-form-title"},[t.showEditMode&&t.allowUpdateName?s("TextInput",{key:"editTitle",attrs:{required:"",errors:t.getValidationMessages(t.$v.name),labels:{required:t.$Labels.MA_Required}},model:{value:t.$v.name.$model,callback:function(e){t.$set(t.$v.name,"$model",e)},expression:"$v.name.$model"}}):t.url?s("a",{key:"urlTitle",staticClass:"routes-destination-list-item-form-title-inner",attrs:{href:t.url,target:"_blank"}},[t._v(" "+t._s(t._f("decode")(t.name))+" ")]):s("div",{key:"readOnlyTitle",staticClass:"routes-destination-list-item-form-title-inner"},[t._v("\n                    "+t._s(t._f("decode")(t.name))+"\n                ")])],1),t._v(" "),s("div",{staticClass:"routes-destination-list-item-description"},[t.showEditMode&&t.isWaypoint?s("TextInput",{key:"editWaypoint",attrs:{required:"",errors:t.getValidationMessages(t.$v.address),labels:{required:t.$Labels.MA_Required}},model:{value:t.$v.address.$model,callback:function(e){t.$set(t.$v.address,"$model",e)},expression:"$v.address.$model"}}):s("div",{key:"viewWaypoint",staticClass:"routes-destination-list-item-description-inline"},[t._v("\n                    "+t._s(t._f("decode")(t.address))+"\n                ")])],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showArrivalDeparture,expression:"showArrivalDeparture"}],staticClass:"arrival-departure-wrap"},[t._v("\n                "+t._s(t.arrivalDeparture)+"\n            ")]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.store__isTimeBased&&t.isWaypoint&&!t.showTimeEditMode&&!t.showEditMode,expression:"store__isTimeBased && isWaypoint && !showTimeEditMode && !showEditMode"}],staticClass:"time-based-inline-wrap slds-grid slds-p-top_small"},[s("div",{staticClass:"time-based-inline_start-time slds-p-right_small slds-grid"},[t.store__isGuideRoute?s("div",[s("div",{staticClass:"slds-p-left_xx-small",on:{click:t.toggleLockGuideRoute}},[s("div",{staticClass:"slds-button slds-button_icon-container has-hover-tooltip Advanced Route-waypoint-lock-toggle-button js-toggle-Advanced Route-waypoint-lock",attrs:{title:"Locked appointments will not be rescheduled when Maps Advanced Route reoptimizes.",alt:"Locked appointments will not be rescheduled when Maps Advanced Route reoptimizes."}},[t.isLocked?s("span",{staticClass:"slds-button__icon ma-icon ma-icon-lock"}):s("span",{staticClass:"slds-button__icon ma-icon ma-icon-unlock"}),t._v(" "),t._e()])])]):t._e(),t._v(" "),s("div",{staticClass:"slds-m-right_x-small"},[s("button",{staticClass:"slds-button",on:{click:function(e){return t.toggleTimeEditMode(!0)}}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-clock"}),t._v("\n                            "+t._s(t.startString)+"\n                        ")])]),t._v(" "),s("div",{staticClass:"time-based-inline_start-time"},[s("button",{staticClass:"slds-button",on:{click:function(e){return t.toggleTimeEditMode(!0)}}},[t._v("\n                            "+t._s(t.formattedDuration)+"\n                        ")])])])]),t._v(" "),t.showTimeEditMode||t.showEditMode?s("div",{staticClass:"slds-form-element time-based-clock-container"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isWaypoint&&t.store__isTimeBased,expression:"isWaypoint && store__isTimeBased"}],staticClass:"slds-grid time-based-clock-container-inner"},[s("RouteTimeOptions",{attrs:{start:t.start,duration:t.duration},on:{"update:start":function(e){t.start=e},"update:duration":function(e){t.duration=e}}}),t._v(" "),s("div",[s("button",{directives:[{name:"show",rawName:"v-show",value:!t.showEditMode,expression:"!showEditMode"}],staticClass:"slds-button slds-button_brand slds-button_compact",on:{click:t.saveRouteTime}},[t._v("\n                            "+t._s(t.$Labels.MA_Done)+"\n                        ")])])],1),t._v(" "),t.showEditMode?s("TextInput",{attrs:{useTextArea:"",labels:{required:t.$Labels.MA_Required,placeholder:t.$Labels.routes_Notes}},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}}):t._e()],1):t._e(),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showEditMode&&t.showError,expression:"!showEditMode && showError"}],staticClass:"waypoint-error-message"},[s("div",{staticClass:"slds-inline_icon_text slds-grid slds-inline_icon_text--error",class:t.inlineErrorClass},[s("span",{staticClass:"slds-icon slds-icon--small slds-m-right--small slds-col slds-no-flex ma-icon ma-icon-warning"}),t._v(" "),s("div",{staticClass:"slds-col slds-align-middle"},[s("p",[t._v(t._s(t.errorString))])])])])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showOverflowActions,expression:"showOverflowActions"}],staticClass:"routes-destination-list-item-overflow-actions slds-col_bump-left slds-grid"},[s("div",[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container route-edit-button",on:{click:t.edit}},[s("span",{staticClass:"slds-button__icon slds-button__icon_hint ma-icon",class:t.editIcon})])]),t._v(" "),s("div",[s("ActionMenu",{ref:"actionMenu",attrs:{doShowSync:t.doShowActionMenu,showMoreLabel:t.$Labels.MA_SHOW_MORE},on:{"update:doShowSync":function(e){t.doShowActionMenu=e},"update:do-show-sync":function(e){t.doShowActionMenu=e},hide:function(e){t.showOverflowActions=!1},mouseout:t.mouseoutActionMenu}},[s("button",{directives:[{name:"show",rawName:"v-show",value:!t.showEditMode,expression:"!showEditMode"}],staticClass:"slds-button slds-button_icon slds-button_icon-container",attrs:{slot:"button"},slot:"button"},[s("span",{staticClass:"ma-icon ma-icon-threedots-vertical"})]),t._v(" "),t.isWaypoint||t.isDisabled?t._e():s("ActionMenuItem",{attrs:{label:t.applyLabel},on:{click:t.applyTo}}),t._v(" "),t.isStart?t._e():s("ActionMenuItem",{attrs:{"data-pendo":"route-stop_lock-to-start",label:t.$Labels.routes_Lock_Start},on:{click:function(e){return t.store__setToStart(t.waypoint)}}}),t._v(" "),t.isEnd?t._e():s("ActionMenuItem",{attrs:{"data-pendo":"route-stop_lock-to-end",label:t.$Labels.routes_Lock_End},on:{click:function(e){return t.store__setToEnd(t.waypoint)}}})],1)],1),t._v(" "),s("div",[t.showEditMode||t.isDisabled?t._e():s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",on:{click:t.remove}},[s("span",{staticClass:"slds-button__icon slds-button__icon_hint ma-icon ma-icon-remove"})])])])]),t._v(" "),t.showTimeDistance?s("RouteTimeAndDistance",{staticClass:"routes-time-distance",attrs:{distance:t.waypoint.distance,totalTravelTime:t.waypoint.totaltraveltime,travelMode:t.store__travelMode,timeGap:t.waypoint.timeGap}}):t._e()],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"routes-start-icon"},[e("div",{staticClass:"ma-icon ma-icon-priority"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"routes-end-icon"},[e("div",{staticClass:"ma-icon ma-icon-goal"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-popover__body"},[s("div",[t._v("Toggle Appointment Lock")]),t._v(" "),s("p",{staticClass:"slds-text-color_inverse-weak slds-text-body_small"},[t._v("\n                                            Locked appointments will not be rescheduled when Maps Advanced Route reoptimizes.\n                                        ")])])}],!1,null,"962ab8a8",null).exports,ut={components:{Picklist:d.Gp},data:()=>({searchTerm:"",searches:[{options:async t=>{const{results:e}=await r.Z.searchFavorites(t);return e}}]}),methods:{clearResults(){this.searchTerm=""},reactToSelected(t){this.searchTerm="",this.doHide(),this.$emit("update",{Name:t.Name,Address__c:t.maps__Address__c,lat:t.maps__Latitude__c,lng:t.maps__Longitude__c,Options__c:l.Z.defaultStartEndOptions,id:(0,i.ZP)()})},doHide(){this.$emit("hide")}}},ct={components:{MAPopover:st,RouteBodyWaypoint:dt,FavoriteSearch:(0,p.Z)(ut,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-grid",attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-col search-dropdown-wrap"},[s("Picklist",{ref:"MASearch",attrs:{options:t.searches,filterable:"",titleKey:"Name",idKey:"Id",labels:{search:t.$Labels.MA_Search_Fav,noSearchResults:t.$Labels.MA_NO_RESULTS_FOUND}},on:{clear:t.clearResults,"selected-option":t.reactToSelected},scopedSlots:t._u([{key:"result",fn:function(e){return s("span",{staticClass:"slds-listbox__option-text_entity slds-listbox__option slds-listbox__option_plain",attrs:{id:"listbox-option-unique-id-01"}},[t._v("\n                "+t._s(t._f("decode")(e.result.Name))+"\n            ")])}}]),model:{value:t.searchTerm,callback:function(e){t.searchTerm=e},expression:"searchTerm"}})],1),t._v(" "),s("div",{staticClass:"slds-p-left_x-small"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.doHide}},[t._v("\n            "+t._s(t.$Labels.MA_Cancel)+"\n        ")])])])}),[],!1,null,null,null).exports,draggable:tt()},provide(){return{routeBodyRef:()=>this.$el}},data:()=>({waypoints:[],addStart:!1,addEnd:!1,Labels:window.MASystem.Labels}),computed:{showAddStart(){return!this.store__start||0===Object.keys(this.store__start).length},showAddEnd(){return!this.store__end||0===Object.keys(this.store__end).length},showEmptyState(){return!this.waypoints||0===this.waypoints.length},...(0,a.mapGetters)("routes",{store__storedWaypoints:"waypoints",store__start:"first",store__end:"last"})},watch:{store__storedWaypoints(){this.waypoints=[...this.store__storedWaypoints]}},created(){this.waypoints=[...this.store__storedWaypoints]},methods:{...(0,a.mapActions)("routes",{store__updateFirst:"updateFirst",store__updateLast:"updateLast",store__removeWaypoint:"removeWaypoint",store__updateWaypoint:"updateWaypoint",store__updateWaypoints:"updateWaypoints"}),...(0,a.mapMutations)("routes",{store__setPendingChange:"setPendingChange"}),openStartModal(){this.addStart=!0,this.$nextTick((()=>{this.$refs.addStartMASearch.$refs.MASearch.focus()}))},openEndModal(){this.addEnd=!0,this.$nextTick((()=>{this.$refs.addEndMASearch.$refs.MASearch.focus()}))},doHide(){this.addEnd=!1,this.addStart=!1},updateWaypointOrder(){this.$bus.$emit("toggle-order-lock-on"),this.waypoints.forEach(((t,e,s)=>{s[e]={...t,index:e+1}})),this.store__updateWaypoints(this.waypoints)},waypointDragChoose(){this.store__setPendingChange(!0)}}},ht=(0,p.Z)(ct,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ma-routes-wrapper slds-grid slds-grid_vertical slds-col"},[s("div",{staticClass:"slds-grid slds-grid_vertical",attrs:{id:"routesSingleBody"}},[s("div",{attrs:{id:"routesDestinationList"}},[t.showAddStart?s("div",{key:"add-start",staticClass:"ma-routes-add-location ma-routes-add-starting-location routes-start-list-item"},[s("button",{staticClass:"slds-button start-end-location-add-button",on:{click:t.openStartModal}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-add"}),t._v(" "+t._s(t.Labels.MA_Start_Loc)+"\n                ")]),t._v(" "),s("MAPopover",{staticClass:"ma-routes-places",attrs:{isOpen:t.addStart,direction:"slds-nubbin_top-left"},on:{"update:isOpen":function(e){t.addStart=e},"update:is-open":function(e){t.addStart=e}}},[s("FavoriteSearch",{ref:"addStartMASearch",attrs:{slot:"content"},on:{hide:t.doHide,update:t.store__updateFirst},slot:"content"})],1)],1):s("RouteBodyWaypoint",{key:"edit-start",attrs:{waypoint:t.store__start,type:"start",isDisabled:!t.$store.state.defaultSettings.defaultStartLocation.overridable},on:{remove:function(e){return t.store__updateFirst({})},update:t.store__updateFirst}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showEmptyState,expression:"showEmptyState"}],staticClass:"slds-notify_container--inline no-destinations slds-text-align_center"},[s("div",{staticClass:"slds-grid"},[s("div",{staticClass:"slds-col slds-align-middle"},[t._m(0),t._v(" "),s("h4",{staticClass:"slds-text-heading_medium slds-p-bottom_x-small"},[t._v(t._s(t.Labels.MA_No_Stops))]),t._v(" "),s("p",{staticClass:"slds-p-bottom_x-small"},[t._v(t._s(t.Labels.MA_Go_Somewhere))])])])]),t._v(" "),s("div",{staticClass:"routeWaypointsWrap"},[s("draggable",{attrs:{options:{handle:".waypoint-marker"}},on:{update:t.updateWaypointOrder},model:{value:t.waypoints,callback:function(e){t.waypoints=e},expression:"waypoints"}},t._l(t.waypoints,(function(e){return s("RouteBodyWaypoint",{key:e.id,attrs:{waypoint:e},on:{remove:t.store__removeWaypoint,update:t.store__updateWaypoint}})})),1)],1),t._v(" "),t.showAddEnd?s("div",{key:"addEnd",staticClass:"ma-routes-add-location ma-routes-add-ending-location routes-ending-list-item"},[s("button",{staticClass:"slds-button start-end-location-add-button",on:{click:t.openEndModal}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-add"}),t._v(" "+t._s(t.Labels.MA_End_Loc)+"\n                ")]),t._v(" "),s("MAPopover",{staticClass:"ma-routes-places",attrs:{isOpen:t.addEnd,direction:"slds-nubbin_bottom-left"},on:{"update:isOpen":function(e){t.addEnd=e},"update:is-open":function(e){t.addEnd=e}}},[s("FavoriteSearch",{ref:"addEndMASearch",attrs:{slot:"content"},on:{hide:t.doHide,update:t.store__updateLast},slot:"content"})],1)],1):s("RouteBodyWaypoint",{key:"editEnd",attrs:{waypoint:t.store__end,type:"end",isDisabled:!t.$store.state.defaultSettings.defaultEndLocation.overridable},on:{remove:function(e){return t.store__updateLast({})},update:t.store__updateLast}})],1)])])}),Q,!1,null,"d86bbe88",null).exports;var _t=s(2423);const{MARemoting:mt,MA:pt}=window,vt={components:{MAPopover:st,Picklist:d.Gp},data(){return{searchTerm:"",addNew:!1,Labels:window.MASystem.Labels,searches:[{options:this.searchGoogle}]}},watch:{addNew(t){t||this.clearResults()}},methods:{...(0,a.mapActions)("routes",{store__addWaypoints:"addWaypoints"}),openAddDestination(){this.addNew=!0,this.$nextTick((()=>{this.$refs.addStopMASearch.focus()}))},doHide(){this.addNew=!1},handleRemoteActionError(t,e,s){t(new Error(`Unable to load default start/stop location. ${s.message}`))},searchGoogle(t){return new Promise(((e,s)=>{t&&""!==t||s(new Error("Missing Required Param: searchTerm"));const o=pt.map.getCenter(),i=o.lat(),a=o.lng();let r=8e3;try{const t=pt.map.getBounds();r=window.google.maps.geometry.spherical.computeDistanceBetween(o,t.getNorthEast())}catch(t){console.warn(t)}(new _t.Z).setAction(mt.placeSearch).setErrorHandler(this.handleRemoteActionError.bind(this,s)).invoke([t,i,a,r,"queryAutocomplete"],(t=>{const s=window.MA.getProperty(t,["data","predictions"]),o=[];s.forEach((t=>{t.place_id&&o.push(t)})),e(o)}),{buffer:!1})}))},clearResults(){this.searchTerm=""},addDestination(t){this.store__addWaypoints([t])},reactToSelectedPlace(t){this.doHide(),new Promise(((e,s)=>{new window.google.maps.places.PlacesService(pt.map).getDetails({placeId:t.place_id},((t,o)=>{o===window.google.maps.places.PlacesServiceStatus.OK?e(t):s(new Error("failed to load new destination"))}))})).then((t=>{this.addDestination({Name:t.name,Address__c:t.formatted_address,Options__c:l.Z.defaultOptions,lat:t.geometry.location.lat(),lng:t.geometry.location.lng(),id:(0,i.ZP)()})}))}}},bt=(0,p.Z)(vt,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ma-routes-add-location slds-p-right_xx-small slds-p-left_small slds-col_bump-left"},[s("button",{staticClass:"slds-button",on:{click:t.openAddDestination}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-add"}),t._v(" "+t._s(t.Labels.MA_ADD_A_STOP)+"\n    ")]),t._v(" "),s("MAPopover",{staticClass:"ma-routes-places",attrs:{isOpen:t.addNew,direction:"slds-nubbin_bottom-left"},on:{"update:isOpen":function(e){t.addNew=e},"update:is-open":function(e){t.addNew=e}}},[s("div",{staticClass:"slds-grid",attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-col search-dropdown-wrap"},[s("Picklist",{ref:"addStopMASearch",attrs:{options:t.searches,labels:{search:t.$Labels.routes_Search_Loc_Add},titleKey:"description",idKey:"place_id",filterable:""},on:{clear:t.clearResults,"selected-option":t.reactToSelectedPlace},scopedSlots:t._u([{key:"result",fn:function(e){return s("span",{staticClass:"slds-listbox__option-text_entity slds-listbox__option slds-listbox__option_plain",attrs:{id:"listbox-option-unique-id-01"}},[t._v("\n                        "+t._s(t._f("decode")(e.result.description))+"\n                    ")])}}]),model:{value:t.searchTerm,callback:function(e){t.searchTerm=e},expression:"searchTerm"}})],1),t._v(" "),s("div",{staticClass:"slds-p-left_x-small cancel-button-wrap"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.doHide}},[t._v("\n                    "+t._s(t.Labels.MA_Cancel)+"\n                ")])])])])],1)}),[],!1,null,"6fe758d8",null).exports,{MA:gt,moment:ft}=window,yt={components:{RouteHeader:Y,RouteControlBar:K,RouteBody:ht,RouteAddStop:bt,RouteSummary:$.Z,Modal:d.u_,Spinner:d.$j},props:{storedRoute:{type:Object,required:!0},asset:{type:Object,required:!0}},data:()=>({date:{},routing:null,showPendingChangeModal:!1,pendingPrint:!1,onMap:!1,Labels:window.MASystem.Labels}),computed:{routeData(){return{...this.store__route,waypoints:this.store__waypoints,Name:this.store__record.Name}},isNewRoute(){return!this.store__record.Id},routeType(){return this.store__isTimeBased?T.D.TIME_BASED_ROUTE:T.D.ROUTE},startCount(){return 0!==Object.keys(this.store__first||{}).length?1:0},lastCount(){return 0!==Object.keys(this.store__last||{}).length?1:0},...(0,a.mapGetters)("routes",{store__route:"route",store__record:"record",store__pendingChanges:"pendingChanges",store__unsavedChanges:"unsavedChanges",store__travelMode:"travelMode",store__routeCallouts:"routeCallouts",store__lockOrder:"lockOrder",store__waypoints:"waypoints",store__first:"first",store__last:"last",store__totalStopCount:"totalStopCount",store__isTimeBased:"isTimeBased"}),...(0,a.mapGetters)("tabs",{tabs__isTabActive:"isTabActive"})},watch:{store__pendingChanges(){this.store__pendingChanges&&(this.store__setUnsavedChanges(!0),this.clearRouteMap(),this.onMap=!1,this.store__resetSummary())}},created(){this.$bus.$on("hide-plotted-route",this.hideRoute),this.$bus.$on("add-to-new-route",this.addToNewRouteHandler),this.$bus.$on("zoom-to-fit-route",this.zoomToFitRoute),this.initalLoadRoute()},mounted(){this.store__setPendingChange(this.isNewRoute)},destroyed(){this.$bus.$off("hide-plotted-route",this.hideRoute),this.$bus.$off("add-to-new-route",this.addToNewRouteHandler),this.$bus.$off("zoom-to-fit-route",this.zoomToFitRoute)},methods:{...(0,a.mapMutations)("tabs",{tabs__setTab:"setTab"}),...(0,a.mapMutations)("routes",{store__setUnsavedChanges:"setUnsavedChanges",store__setPendingChange:"setPendingChange",store__clearRoute:"clearRoute",store__updateRoute:"updateRoute",store__updateRecord:"updateRecord",store__clearRecord:"clearRecord",store__addRouteCallout:"addRouteCallout",store__removeRouteCallout:"removeRouteCallout",store__setTravelMode:"setTravelMode",store__setFirst:"setFirst",store__setLast:"setLast",store__appendWaypoints:"appendWaypoints",store__clearWaypointData:"clearWaypointData",store__resetSummary:"resetSummary"}),...(0,a.mapActions)("routes",{store__loadWaypoints:"loadWaypoints",store__updateFirst:"updateFirst",store__updateLast:"updateLast",store__clearRoute:"clearRoute",store__clearWaypoints:"clearWaypoints",store__resetRouteFlags:"resetRouteFlags"}),hidePendingChangeModal(){this.showPendingChangeModal=!1},saveAndClose(){this.$bus.$emit("save-close-route")},back(){this.store__unsavedChanges?this.showPendingChangeModal=!0:this.exitRoute()},exitRoute(){this.clearRouteMap(),this.$emit("hideRoute")},exitAndDeleteRoute(){this.exitRoute(),this.store__record.Id&&this.$emit("deleteRoute",this.store__record.Id)},clearRouteMap(){this.routing&&(gt.Map.InfoBubble.hide(),this.routing.clearRouteOnMap())},resetRoute(){this.store__clearRoute(),this.clearRouteMap(),this.applyRouteDefaults(),this.store__setPendingChange(!0)},hideRoute(){this.toggleRoute(!1)},toggleRoute(t){this.onMap=t,this.onMap?this.store__pendingChanges||this.store__route.hasWaypointError||!this.store__pendingChanges&&!this.routing?this.getMAIORoute(!this.store__lockOrder):this.routing&&(this.$bus.$emit("hide-plotted-schedule"),this.routing.restoreRouteOnMap()):this.routing&&(gt.Map.InfoBubble.hide(),this.routing.hideRouteOnMap())},initalLoadRoute(){if(this.store__clearRecord(),this.store__updateRecord(this.storedRoute.record),delete this.storedRoute.record,this.store__clearRoute(),this.store__updateRoute(this.storedRoute),this.store__loadWaypoints({waypoints:this.store__route.waypoints,isNew:this.isNewRoute}),this.store__resetRouteFlags(),this.store__route.travelMode&&this.store__setTravelMode(this.store__route.travelMode),this.isNewRoute)return T.Z.isWaypointLengthLessThanMax(this.store__totalStopCount,this.routeType),void this.applyRouteDefaults();this.getMAIORoute()},getMAIORoute(t=!1){this.validateWaypoints()?this.$nextTick((()=>{this.onMap=!1})):(this.$bus.$emit("hide-plotted-schedule"),this.store__addRouteCallout(),this.store__clearWaypointData(),this.clearRouteMap(),this.routing=(new R.Z).setWaypoints(this.store__waypoints).setOptimized(t).setDriveProfile(this.store__travelMode).setTraffic(l.Z.isTrafficEnabled).setFirstWaypoint(this.store__first).setLastWaypoint(this.store__route.last).setIsGuideRoute(this.store__route.isGuideRoute),this.store__isTimeBased&&(this.routing.setRouteTimeBasedOptions(this.store__route.timeBasedOptions).setFirstWaypoint(this.store__first).setLastWaypoint(this.store__last).setTimeBased(!0),this.store__route.isGuideRoute?this.routing.setTimebasedlegacy(!0):this.routing.setTimebasedlegacy(!1)),window.trackUsage("Maps",{action:"Plot Route",description:"Plotting a Route"}),this.routing.build("routing").then((()=>{n.Z.moreThanOneRoute(this.routing.route,(t=>{this.applyRoutingResult(t,this.routing.route)}))})).catch((t=>{this.onMap=!1,this.showRoutingErrors(t),console.warn(t)})).finally((()=>{this.store__removeRouteCallout()})))},validateWaypoints(){return!T.Z.isWaypointLengthLessThanMax(this.store__totalStopCount,this.routeType)||!T.Z.isWaypointLengthGreaterThanMin(this.store__totalStopCount,this.routeType)},showRoutingErrors(t){if(!t||!t.maioCode&&!t.status){if(!(t&&"object"==typeof t&&"string"==typeof t.message&&0===t.message.indexOf("Waypoint ")&&t.message.indexOf(" is not schedulable")>0))return;{const e=t.message.substring(t.message.indexOf("Waypoint ")+9,t.message.indexOf(" is not schedulable"));t.maioCode=82016,t.details=[{id:e}]}}T.Z.showErrorMessage(t.maioCode,this.routeType);const e=T.Z.getWaypointErrorMessage(t.maioCode,this.routeType);if(!e||!t.details||0===t.details.length||!t.details[0].id)return;const s=this.store__waypoints;this.store__clearWaypoints();const o=[];s.forEach((s=>{s.id===t.details[0].id?o.push({...s,errorMsg:void 0!==t.details[0].errormessage&&"Unreachable"===t.details[0].errormessage?t.details[0].errormessage:e,erroramount:void 0!==t.details[0].erroramount&&t.details[0].erroramount>=200?t.details[0].erroramount:200}):o.push(s)})),o.length>0&&this.store__appendWaypoints(o)},applyRoutingResult(t,e){this.store__setPendingChange(!1),!e.hasWaypointError||this.store__route.isGuideRoute?(this.store__updateRoute({url:e.url,boundingbox:e.boundingbox,hasWaypointError:!1}),this.onMap=!0):(this.store__updateRoute({hasWaypointError:!0}),this.onMap=!1);const s=this.store__waypoints;this.store__clearWaypoints();const o=[];let i=!1;t.summary.totaltraveltime=0;for(let e=0;e<t.waypoints.length;e++){const a=t.waypoints[e];if(a.totaltraveltime=60*Math.round(a.totaltraveltime/60),t.summary.totaltraveltime+=a.totaltraveltime,a.errormessage&&(console.error(a.errormessage),0!==e&&t.waypoints[0].start&&a.erroramount)&&ft.unix(t.waypoints[0].start).format("MM-DD-YYYY")!==ft.unix(a.start).format("MM-DD-YYYY")&&(a.errormessage="Your first stop is on a different day. Please remove the stop, because it's too far away, or disable time based routes."),a.isFirst){const t=this.applyMAIODataToWaypoint(this.store__first,a);this.store__setFirst(t)}else if(a.isLast){const t=this.applyMAIODataToWaypoint(this.store__last,a);this.store__setLast(t)}else{const t=s.find((t=>t.id===a.id));if(t){const e=this.applyMAIODataToWaypoint(t,a);!i&&e.errorMsg&&(e.scrollToThisError=!0,i=!0),o.push(e)}}}this.store__updateRoute({summary:t.summary}),o.length>0&&this.store__appendWaypoints(o),this.pendingPrint&&this.$bus.$emit("ready-to-print"),this.store__isTimeBased&&!this.store__route.isGuideRoute&&this.maxTimeGap()},applyMAIODataToWaypoint:(t,e)=>({...t,index:e.index,distance:e.distance,nontraffictime:e.nontraffictime,totaltraveltime:e.totaltraveltime,maneuvers:e.maneuvers,tooltipMetadata:e.tooltipMetadata,duration:e.duration,start:e.start,errorMsg:e.errormessage,erroramount:e.erroramount,arrivaltime:e.arrivaltime,departuretime:e.departuretime}),applyRouteDefaults(){const{startLocationId:t,endLocationId:e}=l.Z.routeDefaults;(t||e)&&(this.store__addRouteCallout(),r.Z.getFavoriteInfo(t).then((s=>(this.store__updateFirst(s),t===e&&this.store__route.first&&this.store__route.first.id?Promise.resolve({Name:s.Name,Address__c:s.Address__c,lat:s.lat,lng:s.lng,id:(0,i.ZP)(),Options__c:l.Z.defaultStartEndOptions,record:s.record}):r.Z.getFavoriteInfo(e)))).then((t=>{this.store__updateLast(t)})).catch((t=>{this.$root.$emit("toast",{message:"failed to load default start/stop locations",state:"error",duration:0}),console.warn(t)})).finally((()=>{this.store__removeRouteCallout()})))},addToNewRouteHandler(t){this.store__unsavedChanges?(this.tabs__isTabActive(i.mQ.ROUTES)||this.tabs__setTab(i.mQ.ROUTES),this.$root.$emit("toast",{message:"Please save your current route first.",state:"error",duration:0})):(this.exitRoute(),this.$nextTick((()=>{this.$bus.$emit("add-to-route",t)})))},zoomToFitRoute(t){let e=!1;t.isEmpty()&&(e=!0),t.extend(this.store__route.boundingbox.southwest),t.extend(this.store__route.boundingbox.northeast),gt.map.fitBounds(t),e&&gt.map.setZoom(gt.map.getZoom()-1)},maxTimeGap(){let t=0;return[...this.store__waypoints,this.store__route.first,this.store__route.last].forEach(((e,s,o)=>{if(s){const i=gt.getProperty(o,[s-1]);let a=gt.getProperty(e,"Options__c"),r=gt.getProperty(i,"Options__c");try{"string"==typeof a&&(a=JSON.parse(window.htmlDecode(e.Options__c))),"string"==typeof r&&(r=JSON.parse(window.htmlDecode(o[s-1].Options__c)))}catch(t){}const n=ft(gt.getProperty(a,"TimeBasedOptions.Start"),"h:mm a");let l=ft(gt.getProperty(r,"TimeBasedOptions.Start"),"h:mm a");if(l){const t=gt.getProperty(r,"TimeBasedOptions.Duration");"string"==typeof t&&t.split(",").forEach((t=>{const e=t.trim().replace("hr","hour").replace("min","minute").split(/\s+/);2===e.length&&window.isNum(e[0])&&(l=l.add(e[0],e[1]))}))}if(n.isValid()&&l.isValid()){const e=Math.abs(n.valueOf()-l.valueOf())/1e3;i.timeGap=e,e>t&&(t=e)}}})),t}}},wt=(0,p.Z)(yt,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"slds-grid slds-grid--vertical",attrs:{id:"routesSingleWrapper"}},[s("Spinner",{directives:[{name:"show",rawName:"v-show",value:t.store__routeCallouts>0,expression:"store__routeCallouts > 0"}],attrs:{loadingLabel:t.$Labels.MA_Loading}}),t._v(" "),t.showPendingChangeModal?s("Modal",{attrs:{title:t.Labels.MA_Route_SaveChanges,labels:{close:t.$Labels.MA_Close}},on:{close:t.hidePendingChangeModal}},[s("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n            "+t._s(t.Labels.DO_YOU_WANT_TO_SAVE_YOUR_CHANGES_BEFORE_CONTINUING_PROMPT)+"\n        ")]),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.hidePendingChangeModal}},[t._v("\n                "+t._s(t.Labels.MA_Cancel)+"\n            ")]),t._v(" "),s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.exitRoute}},[t._v("\n                "+t._s(t.Labels.MA_Close_Discard)+"\n            ")]),t._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:t.saveAndClose}},[t._v("\n                "+t._s(t.Labels.MA_Save_Close)+"\n            ")])])]):t._e(),t._v(" "),s("RouteHeader",{attrs:{asset:t.asset},on:{back:t.back,exit:t.exitRoute,deleteRoute:t.exitAndDeleteRoute,resetRoute:t.resetRoute,generate:t.getMAIORoute}}),t._v(" "),s("RouteControlBar",{attrs:{onMap:t.onMap,showOnTheMapToggle:null!=t.routing},on:{generate:t.getMAIORoute,toggleRoute:t.toggleRoute}}),t._v(" "),s("RouteBody",{class:{"route-line-is-drawn":t.onMap,"start-location-exists":t.startCount,"end-location-exists":t.lastCount}}),t._v(" "),s("RouteSummary",{attrs:{route:t.routeData,pendingChanges:t.store__pendingChanges,pendingPrint:t.pendingPrint},on:{"update:pendingPrint":function(e){t.pendingPrint=e},"update:pending-print":function(e){t.pendingPrint=e},generate:t.getMAIORoute}},[s("RouteAddStop",{attrs:{slot:"button"},slot:"button"})],1)],1)}),[],!1,null,"5953352d",null).exports,{MASystem:Mt,moment:Ct,MA:Rt}=window,Tt={components:{Route:wt,ConfirmDelete:C,RouteListHeader:w,Spinner:d.$j},data:()=>({Tabs:i.mQ,asset:{Id:Rt.getProperty(Mt,"User.Id")||"",Name:Rt.getProperty(Mt,"User.FullName")||"",field:"maps__User__c",type:Mt.Labels.MA_User},month:-1,year:0,routes:{},route:{record:{},waypoints:[]},showRouteCmp:!1,isLoading:!1,routeCounter:1,showPastRoutes:!0,showConfirmDelete:!1,deleteRouteId:"",Labels:window.MASystem.Labels}),computed:{showRouteList(){return!this.showRouteCmp},togglePastRoutesLabel(){return this.showPastRoutes?this.Labels.MA_Hide_Past_Routes:this.Labels.MA_Show_Past_Routes},noRoutes(){return 0===Object.keys(this.routes).length},routesList(){const t=[];return Object.keys(this.routes).forEach((e=>{if(!this.showPastRoutes){const t=Ct().date(e).month(this.month).year(this.year);if(Ct()>t)return}this.routes[e].forEach((s=>{s.dayOfMonth=e,t.push(s)}))})),t},...(0,a.mapGetters)("tabs",{tabs__isTabActive:"isTabActive"})},created(){this.$bus.$on("refresh-route-list",this.getRoutes),this.$bus.$on("display-route",this.displayRoute),this.$bus.$on("add-to-route",this.addToRouteHandler),this.$bus.$on("add-to-new-route",this.addToNewRouteHandler),this.$bus.$on("update-asset",this.updateAsset)},destroyed(){this.$bus.$off("refresh-route-list",this.getRoutes),this.$bus.$off("display-route",this.displayRoute),this.$bus.$off("add-to-route",this.addToRouteHandler),this.$bus.$off("add-to-new-route",this.addToNewRouteHandler),this.$bus.$off("update-asset",this.updateAsset)},methods:{...(0,a.mapMutations)("tabs",{tabs__setTab:"setTab"}),...(0,a.mapMutations)("routes",{store__setIsTimeBased:"setIsTimeBased"}),...(0,a.mapActions)("routes",{store__addWaypoints:"addWaypoints"}),togglePastRoutes(){this.showPastRoutes=!this.showPastRoutes},hideRoute(){this.route={},this.showRouteCmp=!1},clearRoutes(){this.routes={}},displayRoute(t){t?(this.isLoading=!0,this.showRouteCmp=!1,this.$nextTick((()=>{r.Z.getRoute(t).then((t=>{this.setRoute(t.route,t.multiday),this.setRouteWaypoints(t.waypoints,t.multiday),this.showRouteCmp=!0})).catch((t=>{this.$root.$emit("toast",{message:t.message,state:"error",duration:0}),console.warn(t)})).finally((()=>{this.isLoading=!1}))}))):this.$root.$emit("toast",{message:"No id provided for display-route request.",state:"error",duration:0})},formatStops(t){return(0,u.N4)(this.Labels.MA_NumOfStops,[t])},setRoute(t={},e=!1){Rt.Util.removeNamespace(t,"maps__");const s=t.Options__c?JSON.parse((0,i.m9)(t.Options__c)):{};e&&(t.Date__c=t.RouteDate__c),this.$set(this.route,"travelMode",s.DriveProfile||""),this.$set(this.route,"timeBasedOptions",s.TimeBasedOptions||l.Z.defaultOptions),this.$set(this.route,"isGuideRoute",e),this.$set(this.route,"record",t)},setRouteWaypoints(t,e=!1){const s=[],o=t.length;t.forEach(((t,a)=>{Rt.Util.removeNamespace(t,"maps__");const r=t.Options__c?JSON.parse((0,i.m9)(t.Options__c)):{};e&&(t.Latitude__c=t.LatLong__c.latitude,t.Longitude__c=t.LatLong__c.longitude,t.BaseObject__c=t.BaseObjectApi__c,t.LinkId__c=t.RoutedObjectId__c,t.MarkerLayer__c=t.SavedQueryId__c),"start"!==r.LockType&&"end"!==r.LockType||(r.TimeBasedOptions.Duration="0 hr, 0 min",e||(r.TimeBasedOptions.Start=this.$Labels.MA_Set_Start),t.Options__c=r),"undefined"===t.Notes__c&&(t.Notes__c=void 0);const{LockType:n}=r;if(e){const{IsStartLocation__c:e,IsEndLocation__c:i}=t;e&&0===a?this.route.first=this.processWaypoint(t):i&&a+1===o?this.route.last=this.processWaypoint(t):s.push(this.processWaypoint(t))}else switch(n){case"start":this.route.first=this.processWaypoint(t);break;case"end":this.route.last=this.processWaypoint(t);break;case"startend":this.route.first=this.processWaypoint(t),this.route.last=this.processWaypoint(t);break;case"unlocked":s.push(this.processWaypoint(t))}})),this.$set(this.route,"waypoints",s)},processWaypoint:t=>({...t,lat:t.Latitude__c,lng:t.Longitude__c,id:(0,i.ZP)(),recordId:t.Id}),confirmDeleteRoute(t,e){e&&e.stopPropagation(),t?(this.deleteRouteId=t,this.showConfirmDelete=!0):this.$root.$emit("toast",{message:"No id provided for delete-route request.",state:"error",duration:0})},deleteRouteFromList(){this.deleteRoute(this.deleteRouteId)},deleteRoute(t){t?(this.isLoading=!0,r.Z.deleteRoute(t).then((()=>{this.getRoutes(),this.deleteRouteId="",this.showConfirmDelete=!1})).catch((t=>{this.$root.$emit("toast",{message:t.message,state:"error",duration:0})})).finally((()=>{this.isLoading=!1}))):this.$root.$emit("toast",{message:"No id provided for delete-route request.",state:"error",duration:0})},getRoutes(){this.isLoading=!0,r.Z.getMARoutes({month:this.month,year:this.year,lookupId:this.asset.Id,lookupField:this.asset.field}).then((t=>{this.routes=t.routes})).catch((t=>{this.routes={},this.$root.$emit("toast",{message:t.message,state:"error",duration:0})})).then((()=>{this.isLoading=!1}))},openNewRoute(t=[]){let e;try{const t=Mt&&Mt.User?Mt.User.timezoneId:void 0;e=t?Ct().tz(t):Ct()}catch(t){e=Ct()}let s="";try{s=e.format(Mt.User.dateFormat.toUpperCase())}catch(t){s=e.format("MM-DD-YYYY")}!l.Z.enabledDuplicateStops&&t&&t.length>0&&(t=this.removeDuplicates(t));const o={travelMode:l.Z.mode,waypoints:t,record:{Name:`${this.Labels.MA_ROUTE} ${this.routeCounter} (${s})`,Date__c:e.format("YYYY-MM-DD"),User__c:Mt.User.Id,User__r:{Name:Mt.User.FullName,Id:Mt.User.Id},Options__c:l.Z.defaultOptions},isGuideRoute:!1,timeBasedOptions:l.Z.timeBasedOptions};this.routeCounter+=1,this.route=o,this.showRouteCmp=!0},removeDuplicates(t){const e=[];return t.forEach((t=>{let s=!1;e.forEach((e=>{(t.LinkId__c&&t.LinkId__c===e.LinkId__c||t.Name===e.Name&&t.Address__c===e.Address__c)&&(s=!0)})),s||e.push(t)})),e},addToRouteHandler(t){this.tabs__isTabActive(i.mQ.ROUTES)||this.tabs__setTab(i.mQ.ROUTES);let e=!1;const s=[];t.forEach((t=>{if(t.id=(0,i.ZP)(),t.Name=t.title,t.Address__c=t.address||t.marker.address||t.marker.FormattedAddress_MA,t.Options__c=l.Z.defaultOptions,t.marker&&t.marker.StartDateTime&&t.marker.EndDateTime){e=!0,t.marker.DurationInMinutes=(t.marker.EndDateTime-t.marker.StartDateTime)/1e3/60;const s=n.Z.processEventData(t.marker);t={...t,...s}}s.push(t)})),e&&this.store__setIsTimeBased(!0),this.showRouteCmp?this.store__addWaypoints(s):this.openNewRoute(s)},addToNewRouteHandler(t){this.showRouteCmp||this.addToRouteHandler(t)},updateAsset(t){this.asset={...t}}}},$t=(0,p.Z)(Tt,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"routesPanel left-ui-panel",class:{"is-in":t.tabs__isTabActive(t.Tabs.ROUTES)}},[s("Spinner",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}],attrs:{loadingLabel:t.$Labels.MA_Loading}}),t._v(" "),s("ConfirmDelete",{attrs:{doShow:t.showConfirmDelete},on:{"update:doShow":function(e){t.showConfirmDelete=e},"update:do-show":function(e){t.showConfirmDelete=e},"delete-route":t.deleteRouteFromList}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showRouteList,expression:"showRouteList"}],attrs:{id:"routesIndexWrapper"}},[s("RouteListHeader",{attrs:{month:t.month,year:t.year,asset:t.asset,togglePastRoutesLabel:t.togglePastRoutesLabel},on:{"update:month":function(e){t.month=e},"update:year":function(e){t.year=e},"update:asset":function(e){t.asset=e},togglePastRoutes:t.togglePastRoutes,"refresh-list":t.getRoutes,"open-new-route":t.openNewRoute,"clear-routes":t.clearRoutes}}),t._v(" "),s("div",{attrs:{id:"routesIndexBody"}},[s("div",{attrs:{id:"routesIndexList"}},[t._l(t.routesList,(function(e){return s("div",{key:e.routeId,staticClass:"routes-index-list-item",on:{click:function(s){return t.displayRoute(e.routeId)}}},[s("div",{staticClass:"routes-index-list-item-click-area"},[s("div",{staticClass:"routes-index-list-item-date"},[s("div",{staticClass:"routes-index-list-item-date-image"}),t._v(" "),s("div",{staticClass:"routes-index-list-item-date-number"},[t._v(t._s(e.dayOfMonth))])]),t._v(" "),s("div",{staticClass:"slds-col slds-p-left_medium",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"routes-index-list-item-title"},[t._v("\n                                "+t._s(t._f("decode")(e.route.Name))+"\n                            ")]),t._v(" "),s("div",{staticClass:"routes-index-list-item-description"},[t._v("\n                                "+t._s(t.formatStops(e.waypoints.length))+"\n                                "),e.guideGeneratedRoute?s("span",[t._v(" - "+t._s(t.Labels.routes_Maps_Advanced))]):t._e()])])]),t._v(" "),s("div",{staticClass:"routes-index-list-item-overflow-actions"},[s("div",{staticClass:"slds-hint-parent"},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",on:{click:function(s){return t.confirmDeleteRoute(e.routeId,s)}}},[s("span",{staticClass:"slds-button__icon slds-button__icon_hint ma-icon ma-icon-delete"})])])])])})),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.noRoutes,expression:"noRoutes"}],staticClass:"no-routes routesIndexEmptyState"},[s("div",{staticClass:"slds-notify_container--inline slds-p-around--large slds-text-align--center"},[t._m(0),t._v(" "),s("h4",[t._v(t._s(t.Labels.routes_Nothing_Planned))])])])],2)])],1),t._v(" "),s("transition",[t.showRouteCmp?s("Route",{key:"singleRoute",attrs:{storedRoute:t.route,asset:t.asset},on:{hideRoute:t.hideRoute,deleteRoute:t.deleteRoute}}):t._e()],1)],1)}),o,!1,null,"e85d0a1a",null).exports}}]);