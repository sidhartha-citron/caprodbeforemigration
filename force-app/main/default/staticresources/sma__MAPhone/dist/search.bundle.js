webpackJsonp([8],{208:function(e,a,t){var i=t(13)(t(659),t(666),null,null,null);e.exports=i.exports},659:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=t(14),r=t.n(i),s=t(660),o=t.n(s),n=t(35),c=(t.n(n),t(62)),l=t.n(c),u=t(63),d=t.n(u);a.default={components:{SearchBody:function(){return r()({},l()(),{component:t.e(75).then(t.bind(null,663)),error:d.a})},SearchTopBar:o.a},props:{disableGeolocation:{type:Boolean,default:!1}},data:function(){return{poiResults:[],markerResults:[],markersLoading:!1,poiLoading:!1,searchTerm:""}},computed:r()({},Object(n.mapGetters)("mainNavBar",{mainNavBar__activeTab:"activeTab"})),methods:{updateSearchResults:function(e){var a=e.poi,t=void 0===a?[]:a,i=e.markers,r=void 0===i?[]:i;this.poiResults=t,this.markerResults=r}}}},660:function(e,a,t){var i=t(13)(t(661),t(662),null,null,null);e.exports=i.exports},661:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=t(61),r=t.n(i),s=t(17),o=t.n(s),n=t(14),c=t.n(n),l=t(35),u=(t.n(l),t(7)),d=t.n(u),h=window,m=h.google,p=h.MA,v=h.MARemoting,f=h.$;a.default={props:{poiLoading:{type:Boolean,default:!1},markersLoading:{type:Boolean,default:!1},searchTerm:{type:String,default:""},disableGeolocation:{type:Boolean,default:!1}},data:function(){return{searchTimeout:null,isLoading:!1,markerResults:[],poiResults:[],localSarchTerm:"",window:{height:0,width:0}}},computed:c()({},Object(l.mapGetters)("mainNavBar",{mainNavBar__activeTab:"activeTab"}),{isPhone:function(){return this.window.width<769}}),watch:{localSarchTerm:function(e){this.$emit("update:searchTerm",e),this.markerResults=[],this.poiResults=[],this.updateResults(),e.length>2&&this.debounceSearch(e)}},created:function(){window.addEventListener("resize",this.handleResize),this.handleResize()},destroyed:function(){window.removeEventListener("resize",this.handleResize)},methods:c()({},Object(l.mapMutations)("mainNavBar",{mainNavBar__updateActiveTab:"updateActiveTab",mainNavBar__toggleSubView:"toggleSubView",mainNavBar__returnToPreviousTab:"returnToPreviousTab"}),{handleResize:function(){this.window.width=window.innerWidth,this.window.height=window.innerHeight},clearSearch:function(){this.removePOI(),this.markerResults=[],this.poiResults=[],this.localSarchTerm="",this.updateResults()},removePOI:function(){try{p.Map.Search.markers.forEach(function(e){e.setMap(null)}),p.Map.Search.markers=[],this.poiMarkerCount=0}catch(e){}},updateResults:function(){this.$emit("update-results",{poi:this.poiResults,markers:this.markerResults,search:this.localSarchTerm})},debounceSearch:function(e){var a=this;clearTimeout(this.searchTimeout),this.$emit("update:markersLoading",!0),this.$emit("update:poiLoading",!0),this.searchTimeout=setTimeout(function(){a.isLoading=!0,a.markerResults=[],a.poiResults=[];var t=a.searchMarkers(e),i=a.searchPOI(e);o.a.all([t,i]).then(function(){a.updateResults(),a.isLoading=!1})},400)},searchMarkers:function(e){var a=this;return new o.a(function(t){var i=f("#PlottedQueriesTable .savedQuery");if(i.length>0){a.markerResults=[];for(var s=0;s<i.length;s++){var o=i.eq(s);if(6===a.markerResults.length)break;for(var n=(o.data()||{}).records,c=void 0===n?{}:n,l=r()(c),u=0;u<l.length&&6!==a.markerResults.length;u++){var d=c[l[u]];(d.isVisible||d.isClustered||d.isScattered)&&-1!==d.marker.title.toLowerCase().indexOf(e.toLowerCase())&&a.markerResults.push(d)}}a.updateResults(),a.$emit("update:markersLoading",!1),t()}else a.$emit("update:markersLoading",!1),t()})},searchPOI:function(e){var a=this;return new o.a(function(t,i){var r=p.map.getCenter(),s=r.lat(),o=r.lng(),n=8e3;try{var c=p.map.getBounds();n=Math.round(m.maps.geometry.spherical.computeDistanceBetween(r,c.getNorthEast()))}catch(e){}(new d.a).setAction(v.placeSearch).setErrorHandler(function(e,t){console.warn(e);var r=p.isUserLoggedIn(e,t,!1);r&&i(new Error(r)),i(new Error(e)),a.$emit("update:poiLoading",!1)}).invoke([e,s,o,n,"queryAutocomplete"],function(e){var r=e.success,s=void 0!==r&&r,o=e.data,n=void 0===o?{}:o;if(a.$emit("update:poiLoading",!1),s){var c=n.predictions,l=void 0===c?[]:c;a.localSarchTerm.length<=2?a.poiResults=[]:a.poiResults=l,a.updateResults(),t()}else i()},{escape:!1,buffer:!1})})},showBody:function(){"search"!==this.mainNavBar__activeTab&&this.mainNavBar__updateActiveTab("search")},showSettings:function(){this.mainNavBar__toggleSubView({doShow:!0,subView:"settings"})},hideSearch:function(){this.mainNavBar__updateActiveTab("map")},getMyPosition:function(){window.myPosition({pan:!0})}})}},662:function(e,a){e.exports={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"ma-top-bar main-panel slds-scope",class:{in:"search"===e.mainNavBar__activeTab},attrs:{id:"searchTopBar"}},[t("div",{staticClass:"ma-top-bar-row"},[e.isPhone?t("div",{directives:[{name:"show",rawName:"v-show",value:"search"!==e.mainNavBar__activeTab,expression:"mainNavBar__activeTab !== 'search'"}],staticClass:"ma-top-bar-button ma-top-bar-button--fullsize phone-only show-nav-drawer ma-icon ma-icon-settings",on:{click:e.showSettings}}):e._e(),e._v(" "),t("div",{staticClass:"ma-form-control icon-left icon-right ma-top-bar-field-center"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.localSarchTerm,expression:"localSarchTerm"}],staticClass:"ma-input clearable-input",attrs:{id:"searchInput",placeholder:e._f("decode")(e.$Labels.MA_SEARCH_THE_MAP),type:"text"},domProps:{value:e.localSarchTerm},on:{focus:e.showBody,input:function(a){a.target.composing||(e.localSarchTerm=a.target.value)}}}),e._v(" "),t("div",{staticClass:"ma-icon icon-left ma-icon-search"}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.localSarchTerm.length>2,expression:"localSarchTerm.length > 2"}],staticClass:"ma-icon icon-right ma-icon-clear clear-input-button",on:{click:e.clearSearch}})]),e._v(" "),e.isPhone&&!e.disableGeolocation?t("div",{directives:[{name:"show",rawName:"v-show",value:"search"!==e.mainNavBar__activeTab,expression:"mainNavBar__activeTab !== 'search'"}],staticClass:"get-my-location ma-icon ma-icon-my-location ma-top-bar-button ma-top-bar-button--fullsize phone-only",on:{click:e.getMyPosition}}):e._e(),e._v(" "),e.isPhone?t("div",{directives:[{name:"show",rawName:"v-show",value:"search"===e.mainNavBar__activeTab,expression:"mainNavBar__activeTab === 'search'"}],staticClass:"ma-icon ma-icon-close ma-top-bar-button ma-top-bar-button--fullsize hide-search",staticStyle:{display:"block"},on:{click:e.hideSearch}}):e._e()])])},staticRenderFns:[]}},666:function(e,a){e.exports={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("SearchTopBar",{attrs:{markersLoading:e.markersLoading,poiLoading:e.poiLoading,searchTerm:e.searchTerm,disableGeolocation:e.disableGeolocation},on:{"update:markersLoading":function(a){e.markersLoading=a},"update:markers-loading":function(a){e.markersLoading=a},"update:poiLoading":function(a){e.poiLoading=a},"update:poi-loading":function(a){e.poiLoading=a},"update:searchTerm":function(a){e.searchTerm=a},"update:search-term":function(a){e.searchTerm=a},"update-results":e.updateSearchResults}}),e._v(" "),t("keep-alive",["search"===e.mainNavBar__activeTab?t("SearchBody",{attrs:{poiResults:e.poiResults,markerResults:e.markerResults,markersLoading:e.markersLoading,searchTerm:e.searchTerm,poiLoading:e.poiLoading},on:{"set-results":e.updateSearchResults}}):e._e()],1)],1)},staticRenderFns:[]}}});