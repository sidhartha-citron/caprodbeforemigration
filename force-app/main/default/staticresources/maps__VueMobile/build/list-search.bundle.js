"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[3628],{9207:(e,t,s)=>{s.r(t),s.d(t,{default:()=>c});var l=s(4141),a=s(675),i=s(7387),o=s(7579);const{$:r,getProperty:n,moment:d}=window,u={components:{MAModal:l.Z,MASpinner:a.Z,MobileSelect:o.Z,DateSelectionModal:()=>s.e(9822).then(s.bind(s,314))},props:{selectedQuery:{type:String,required:!0},currentFilters:{type:Array,required:!0}},data(){return{isLoading:!1,showDateModal:!1,date:d().tz(this.$User.timezoneId),dateRow:null,filterOptions:{boolean:[{label:this.$Labels.MA_Equals,value:"equals"}],picklist:[{label:this.$Labels.MA_Equals,value:"equals"},{label:this.$Labels.MA_Not_Equal,value:"notEqualTo"}],multipicklist:[{label:this.$Labels.MA_Contains,value:"contains"},{label:this.$Labels.MA_Does_Not_Contain,value:"doesNotContain"}],string:[{label:this.$Labels.MA_Equals,value:"equals"},{label:this.$Labels.MA_Not_Equal,value:"notEqualTo"},{label:this.$Labels.MA_Starts_With,value:"startsWith"},{label:this.$Labels.MA_Contains,value:"contains"},{label:this.$Labels.MA_Does_Not_Contain,value:"doesNotContain"}],double:[{label:this.$Labels.MA_Equals,value:"equals"},{label:this.$Labels.MA_Not_Equal,value:"notEqualTo"},{label:this.$Labels.MA_Less_Than,value:"lessThan"},{label:this.$Labels.MA_Less_Than_Equal,value:"lessThanEqualTo"},{label:this.$Labels.MA_Greater_Than,value:"greaterThan"},{label:this.$Labels.MA_Greater_Than_Equal,value:"greaterThanEqualTo"}]},filterRows:[],window:{height:0,width:0}}},computed:{isPhone(){return this.window.width<769},plottedLayer(){return r(`#PlottedQueriesTable .PlottedRowUnit[qid="${this.selectedQuery}"]`)}},created(){this.build(),window.addEventListener("resize",this.handleResize),this.handleResize()},destroyed(){window.removeEventListener("resize",this.handleResize)},methods:{close(){this.$emit("close")},handleResize(){this.window.width=window.innerWidth,this.window.height=window.innerHeight},doShowDateModal(e){this.showDateModal=!0,this.dateRow=e},setDate(e){this.dateRow.filterValue=e.format(this.$User.dateFormat.toUpperCase())},build(){const e=this.getTooltips(),t=this.currentFilters||[];e.forEach((e=>{const s=e.soapType;let l=n(e,"describe.picklistValues",!1)||[];const a=e.DisplayType,i=e.ActualFieldName.startsWith("maps__")?e.ActualFieldName.replace("maps__",""):e.ActualFieldName,o=t.find((e=>e.tooltip===i));"BOOLEAN"===a&&(l=[{label:"False",value:"false"},{label:"True",value:"true"}]);const[r={}]=l,u={label:e.FieldLabel,filterOptions:this.getFilterOptions(s),templateType:this.getTemplateType(a),filterOperator:void 0,filterValue:r.value||"",soapType:s,displayType:a,picklistOptions:l,sfdcField:e.ActualFieldName};if(o){let e=o.value;"DATE"!==s&&"DATETIME"!==s||(e=d(+o.value).format(this.$User.dateFormat.toUpperCase())),"MULTIPICKLIST"===a&&(e=o.value.split(";")),u.filterValue=e,u.filterOperator=o.operator}this.filterRows.push(u)}))},getTooltips(){const e=this.plottedLayer.data()||{},{tooltips:t=[]}=e,s=[...t];return s.splice(1,0,{DisplayType:"STRING",FieldName:"FormattedAddress_MA",FieldLabel:"Address",ActualFieldName:"FormattedAddress_MA",describe:{type:"string",label:"Address",name:"Address",soapType:"xsd:string"},soapType:"STRING",needsLink:!1}),s},getFilterOptions(e){let t=[];switch(e){case"DATETIME":case"DATE":case"DOUBLE":case"DECIMAL":case"INTEGER":t=this.filterOptions.double;break;case"BOOLEAN":t=this.filterOptions.boolean;break;case"PICKLIST":t=this.filterOptions.picklist;break;case"MULTIPICKLIST":t=this.filterOptions.multipicklist;break;default:t=this.filterOptions.string}return t},getTemplateType(e){let t="STRING";switch(e){case"BOOLEAN":case"PICKLIST":t="select";break;case"MULTIPICKLIST":t="multiselect";break;case"DATETIME":case"DATE":t="date";break;default:t="input"}return t},filter(){const e=this,t=[];e.filterRows.forEach((s=>{if(s.filterOperator){let l=s.sfdcField;l.startsWith("maps__")&&(l=l.replace("maps__","")),t.push({operator:s.filterOperator,value:e.normalizeFilterValue(s),tooltip:l,isMultiSelect:"MULTIPICKLIST"===s.displayType,filterType:s.soapType})}}));const s=e.plottedLayer.data()||{},{records:l={}}=s;let a=0;const i=Object.keys(l)||[],o=i.length,r=[];setTimeout((function s(){if(a<o){let d=0;for(;d<100&&a<o;){d++;const s=i[a],o=l[s];let u=0===t.length;for(let s=0,l=t.length;s<l;s++){const l=t[s];let a=n(o,l.tooltip,!1);if(l.isMultiSelect&&void 0===a&&(a=""),u=e.isMatch({searchTerm:l.value,operator:l.operator,value:a,dataType:l.filterType}),!1===u)break}u&&r.push(o.Id),a++}setTimeout(s,1)}else{const s={qid:e.selectedQuery,filters:t,records:r};e.$emit("filterResults",s),e.close()}}),100)},isMatch(e){let t=!1;const{value:s,searchTerm:l,operator:a}=e;if(void 0!==s&&void 0!==l&&null!==s&&null!==l||"notEqualTo"!==a&&"doesNotContain"!==a)switch(e.dataType){case"STRING":t=this.matchString(e);break;case"INTEGER":case"DOUBLE":t=this.matchNumber(e);break;case"BOOLEAN":t=this.matchBoolean(e);break;case"DATE":case"DATETIME":t=this.matchDate(e);break;default:t=!1}else t=!0;return t},matchDate(e){let t=!1,s=parseFloat(e.value||0),l=parseFloat(e.searchTerm||0);const a=d(s).set({hour:0,minute:0,second:0,millisecond:0});s=parseFloat(a.format("X"));const i=d(l).set({hour:0,minute:0,second:0,millisecond:0});return l=parseFloat(i.format("X")),("equals"===e.operator&&s===l||"notEqualTo"===e.operator&&s!==l||"lessThan"===e.operator&&s<l||"lessThanEqualTo"===e.operator&&s<=l||"greaterThan"===e.operator&&s>l||"greaterThanEqualTo"===e.operator&&s>=l)&&(t=!0),t},matchString(e){let t=!1,{searchTerm:s,value:l}=e;return l&&s&&(l=(0,i.m9)(l.toLowerCase()),s=(0,i.m9)(s.toLowerCase()),("equals"===e.operator&&l===s||"notEqualTo"===e.operator&&l!==s||"startsWith"===e.operator&&0===l.indexOf(s)||"contains"===e.operator&&l.indexOf(s)>-1||"doesNotContain"===e.operator&&-1===l.indexOf(s))&&(t=!0)),t},matchNumber(e){let t=!1;const s=parseFloat(e.value||0),l=parseFloat(e.searchTerm||0);return("equals"===e.operator&&s===l||"notEqualTo"===e.operator&&s!==l||"lessThan"===e.operator&&s<l||"lessThanEqualTo"===e.operator&&s<=l||"greaterThan"===e.operator&&s>l||"greaterThanEqualTo"===e.operator&&s>=l)&&(t=!0),t},matchBoolean(e){let t=!0;return t="string"==typeof e.searchTerm?"true"===e.searchTerm:e.searchTerm,e.value===t},normalizeFilterValue(e){let t=e.filterValue;const{displayType:s="STRING"}=e;switch(s){case"DATE":case"DATETIME":t=d(t,this.$User.dateFormat.toUpperCase()),t.isValid()&&(t=t.tz(this.$User.timezoneId).unix(),t*=1e3);break;case"MULTIPICKLIST":try{t=t.join(";")}catch(e){}break;case"DOUBLE":case"CURRENCY":case"INT":t=window.MA.Util.parseNumberString(t);break;default:t=e.filterValue}return t}}},c=(0,s(1900).Z)(u,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("MAModal",{directives:[{name:"show",rawName:"v-show",value:!e.showDateModal,expression:"!showDateModal"}],staticClass:"slds-modal-fullscreen-phone listview-search",attrs:{doDetach:!0,title:e.$Labels.MA_Filter_List_View,closeLabel:e.$Labels.MA_Close},on:{close:e.close}},[s("div",{staticClass:"momentum-scrolling-y slds-scrollable",attrs:{slot:"content"},slot:"content"},[s("MASpinner",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}]}),e._v(" "),s("div",{staticClass:"filter-list",class:{"ma-list__phone":e.isPhone}},e._l(e.filterRows,(function(t,l){return s("div",{key:l,staticClass:"filter-row",class:{"slds-grid slds-wrap":!e.isPhone}},[s("div",{staticClass:"slds-size_1-of-1 slds-large-size_4-of-12 slds-p-right_x-small"},[s("div",{staticClass:"slds-form-element"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"text-input-id-1"}},[e._v(e._s(e.$Labels.MA_Tooltip))]),e._v(" "),s("div",{staticClass:"slds-text-body_regular"},[e._v("\n                                "+e._s(e._f("decode")(t.label))+"\n                            ")])])]),e._v(" "),s("div",{staticClass:"slds-size_1-of-1 slds-large-size_4-of-12 slds-p-right_x-small"},[s("div",{staticClass:"slds-form-element"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"text-input-id-1"}},[e._v(e._s(e.$Labels.MA_OPERATOR))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},[s("MobileSelect",{attrs:{options:t.filterOptions,doDetach:!0,isRequired:!0,hasNoneOption:!0,keyString:"value",valueString:"label"},model:{value:t.filterOperator,callback:function(s){e.$set(t,"filterOperator",s)},expression:"row.filterOperator"}})],1)])]),e._v(" "),s("div",{staticClass:"slds-size_1-of-1 slds-large-size_4-of-12"},[s("div",{staticClass:"slds-form-element"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"text-input-id-1"}},[e._v(e._s(e.$Labels.MA_Value))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},["input"===t.templateType?s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.filterValue,expression:"row.filterValue"}],staticClass:"slds-input",attrs:{type:"text"},domProps:{value:t.filterValue},on:{input:function(s){s.target.composing||e.$set(t,"filterValue",s.target.value)}}})]):"select"===t.templateType||"multiselect"===t.templateType?s("div",[s("MobileSelect",{attrs:{options:t.picklistOptions,doDetach:!0,isRequired:!0,isMultiSelect:"multiselect"===t.templateType,hasNoneOption:!1,keyString:"value",valueString:"label"},model:{value:t.filterValue,callback:function(s){e.$set(t,"filterValue",s)},expression:"row.filterValue"}})],1):"date"===t.templateType?s("div",{on:{click:function(s){return e.doShowDateModal(t)}}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.filterValue,expression:"row.filterValue"}],staticClass:"slds-input",attrs:{type:"text",disabled:""},domProps:{value:t.filterValue},on:{input:function(s){s.target.composing||e.$set(t,"filterValue",s.target.value)}}})]):e._e()])])])])})),0)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("div",{staticClass:"float-right"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:e.close}},[e._v("\n                    "+e._s(e._f("decode")(e.$Labels.MA_Cancel))+"\n                ")]),e._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:e.filter}},[e._v("\n                    "+e._s(e._f("decode")(e.$Labels.MA_FILTER))+"\n                ")])])])]),e._v(" "),e.showDateModal?s("DateSelectionModal",{attrs:{date:e.date},on:{close:function(t){e.showDateModal=!1},update:e.setDate}}):e._e()],1)}),[],!1,null,"5937229e",null).exports},7579:(e,t,s)=>{s.d(t,{Z:()=>a});const l={name:"MASelect",props:{label:{type:String,default:""},options:{type:Object|Array,required:!0},keyString:{type:String,default:"key"},valueString:{type:String,default:"value"},hasNoneOption:{type:Boolean,default:!0},value:{type:String|Number,default:""},default:{type:String|Number,default:""},isRequired:{type:Boolean,default:!1},isInvalid:{type:Boolean,default:!1},placeholder:{type:String,default:""},isMultiSelect:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data(){return{defaultValue:this.default}},computed:{showLabel(){return this.label}},watch:{value(){const e={};e[this.keyString]=this.value,e[this.valueString]=this.getSelectedValue(),this.$emit("change",e)}},methods:{decodeHtml(e){if(!e)return e;const t=window.document.createElement("textarea");return t.innerHTML=e,t.value},getKey(e){return"string"==typeof e||"number"==typeof e?e:e[this.keyString]},getValue(e){return"string"==typeof e||"number"==typeof e?e:e[this.valueString]},isSelected(e){let t=!1;return t=Array.isArray(this.value)?this.value.includes(this.getKey(e)):this.getKey(e)===this.value,t},change(e){e||(e=null);let t=[];for(let s=0;s<e.length;s++){const l=e[s];t.push(l.value)}if(1===t.length){const[e]=t;t=e}this.$emit("input",t)},getSelectedValue(){if(!this.options||!this.options.length)return"";const e=this.options.find((e=>this.getKey(e)===this.value));return e?this.decodeHtml(this.getValue(e)):null},remove(){this.$emit("input",""),this.doHide()}}},a=(0,s(1900).Z)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"slds-form-element",class:{"slds-has-error":e.isInvalid}},[e.showLabel?s("label",{staticClass:"slds-form-element__label"},[e.isRequired?s("abbr",{staticClass:"slds-required",attrs:{title:"required"}},[e._v("*")]):e._e(),e._v("\n        "+e._s(e.decodeHtml(e.label))+"\n    ")]):e._e(),e._v(" "),s("div",{staticClass:"slds-is-relative"},[s("select",e._b({staticClass:"slds-select",staticStyle:{overflow:"auto"},attrs:{placeholder:e.placeholder,disabled:e.disabled},on:{change:function(t){return e.change(t.target.selectedOptions)}}},"select",{multiple:e.isMultiSelect},!1),[e.hasNoneOption?s("option",{attrs:{value:""}},[e._v("\n                -- None --\n            ")]):e._e(),e._v(" "),e._l(e.options,(function(t,l){return s("option",{key:l,domProps:{value:e.getKey(t),selected:e.isSelected(t)}},[e._v("\n                "+e._s(e.getValue(t))+"\n            ")])}))],2),e._v(" "),e._m(0)]),e._v(" "),e.isInvalid?s("div",{staticClass:"slds-form-element__help"},[e._t("errors",(function(){return[e._v("This field is required.")]}))],2):e._e()])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"select-icon"},[t("span",{staticClass:"ma-icon ma-icon-down"})])}],!1,null,null,null).exports}}]);