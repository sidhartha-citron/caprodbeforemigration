"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[6464],{8569:(e,a,t)=>{t.r(a),t.d(a,{default:()=>v});var s=t(5908),i=t(3589),r=t(2423);const{google:o,MA:n,MARemoting:c,$:l}=window,h={props:{poiLoading:{type:Boolean,default:!1},markersLoading:{type:Boolean,default:!1},searchTerm:{type:String,default:""}},data:()=>({searchTimeout:null,isLoading:!1,markerResults:[],poiResults:[],localSarchTerm:"",window:{height:0,width:0}}),computed:{...(0,s.mapGetters)("mainNavBar",{mainNavBar__activeTab:"activeTab"}),isPhone(){return this.window.width<769}},watch:{localSarchTerm(e){this.$emit("update:searchTerm",e),this.markerResults=[],this.poiResults=[],this.updateResults(),e.length>2&&this.debounceSearch(e)}},created(){window.addEventListener("resize",this.handleResize),this.handleResize()},destroyed(){window.removeEventListener("resize",this.handleResize)},methods:{...(0,s.mapMutations)("mainNavBar",{mainNavBar__updateActiveTab:"updateActiveTab",mainNavBar__toggleSubView:"toggleSubView",mainNavBar__returnToPreviousTab:"returnToPreviousTab"}),handleResize(){this.window.width=window.innerWidth,this.window.height=window.innerHeight},clearSearch(){this.removePOI(),this.markerResults=[],this.poiResults=[],this.localSarchTerm="",this.updateResults()},removePOI(){try{n.Map.Search.markers.forEach((e=>{e.setMap(null)})),n.Map.Search.markers=[],this.poiMarkerCount=0}catch(e){}},updateResults(){this.$emit("update-results",{poi:this.poiResults,markers:this.markerResults,search:this.localSarchTerm})},debounceSearch(e){clearTimeout(this.searchTimeout),this.$emit("update:markersLoading",!0),this.$emit("update:poiLoading",!0),this.searchTimeout=setTimeout((()=>{this.isLoading=!0,this.markerResults=[],this.poiResults=[];const a=this.searchMarkers(e),t=this.searchPOI(e);Promise.all([a,t]).then((()=>{this.updateResults(),this.isLoading=!1}))}),400)},searchMarkers(e){return new Promise((a=>{const t=l("#PlottedQueriesTable .savedQuery");if(t.length>0){this.markerResults=[];for(let a=0;a<t.length;a++){const s=t.eq(a);if(6===this.markerResults.length)break;const i=s.data()||{},{records:r={}}=i,o=Object.keys(r);for(let a=0;a<o.length&&6!==this.markerResults.length;a++){const t=r[o[a]];(t.isVisible||t.isClustered||t.isScattered)&&-1!==t.marker.title.toLowerCase().indexOf(e.toLowerCase())&&this.markerResults.push(t)}}this.updateResults(),this.$emit("update:markersLoading",!1),a()}else this.$emit("update:markersLoading",!1),a()}))},searchPOI(e){return new Promise(((a,t)=>{const s=n.map.getCenter(),i=s.lat(),l=s.lng();let h=8e3;try{const e=n.map.getBounds();h=Math.round(o.maps.geometry.spherical.computeDistanceBetween(s,e.getNorthEast()))}catch(e){}(new r.Z).setAction(c.placeSearch).setErrorHandler(((e,a)=>{console.warn(e);const s=n.isUserLoggedIn(e,a,!1);s&&t(new Error(s)),t(new Error(e)),this.$emit("update:poiLoading",!1)})).invoke([e,i,l,h,"queryAutocomplete"],(e=>{const{success:s=!1,data:i={}}=e;if(this.$emit("update:poiLoading",!1),s){const{predictions:e=[]}=i;this.localSarchTerm.length<=2?this.poiResults=[]:this.poiResults=e,this.updateResults(),a()}else t()}),{escape:!1,buffer:!1})}))},showBody(){"search"!==this.mainNavBar__activeTab&&this.mainNavBar__updateActiveTab("search")},showSettings(){this.mainNavBar__toggleSubView({doShow:!0,subView:"settings"})},hideSearch(){this.mainNavBar__updateActiveTab("map")},getMyPosition(){window.myPosition({pan:!0})}}};var m=t(1900);const u=(0,m.Z)(h,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"ma-top-bar main-panel slds-scope",class:{in:"search"===e.mainNavBar__activeTab},attrs:{id:"searchTopBar"}},[t("div",{staticClass:"ma-top-bar-row"},[e.isPhone?t("div",{directives:[{name:"show",rawName:"v-show",value:"search"!==e.mainNavBar__activeTab,expression:"mainNavBar__activeTab !== 'search'"}],staticClass:"ma-top-bar-button ma-top-bar-button--fullsize phone-only show-nav-drawer ma-icon ma-icon-settings",on:{click:e.showSettings}}):e._e(),e._v(" "),t("div",{staticClass:"ma-form-control icon-left icon-right ma-top-bar-field-center"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.localSarchTerm,expression:"localSarchTerm"}],staticClass:"ma-input clearable-input",attrs:{id:"searchInput",placeholder:e._f("decode")(e.$Labels.MA_SEARCH_THE_MAP),type:"text"},domProps:{value:e.localSarchTerm},on:{focus:e.showBody,input:function(a){a.target.composing||(e.localSarchTerm=a.target.value)}}}),e._v(" "),t("div",{staticClass:"ma-icon icon-left ma-icon-search"}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.localSarchTerm.length>2,expression:"localSarchTerm.length > 2"}],staticClass:"ma-icon icon-right ma-icon-clear clear-input-button",on:{click:e.clearSearch}})]),e._v(" "),e.isPhone?t("div",{directives:[{name:"show",rawName:"v-show",value:"search"!==e.mainNavBar__activeTab,expression:"mainNavBar__activeTab !== 'search'"}],staticClass:"get-my-location ma-icon ma-icon-my-location ma-top-bar-button ma-top-bar-button--fullsize phone-only",on:{click:e.getMyPosition}}):e._e(),e._v(" "),e.isPhone?t("div",{directives:[{name:"show",rawName:"v-show",value:"search"===e.mainNavBar__activeTab,expression:"mainNavBar__activeTab === 'search'"}],staticClass:"ma-icon ma-icon-close ma-top-bar-button ma-top-bar-button--fullsize hide-search",staticStyle:{display:"block"},on:{click:e.hideSearch}}):e._e()])])}),[],!1,null,null,null).exports;var d=t(9159);const p={components:{SearchBody:()=>({...(0,i.Z)(),component:t.e(7059).then(t.bind(t,6007)),error:d.Z}),SearchTopBar:u},props:{},data:()=>({poiResults:[],markerResults:[],markersLoading:!1,poiLoading:!1,searchTerm:""}),computed:{...(0,s.mapGetters)("mainNavBar",{mainNavBar__activeTab:"activeTab"})},methods:{updateSearchResults(e){const{poi:a=[],markers:t=[]}=e;this.poiResults=a,this.markerResults=t}}},v=(0,m.Z)(p,(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("SearchTopBar",{attrs:{markersLoading:e.markersLoading,poiLoading:e.poiLoading,searchTerm:e.searchTerm},on:{"update:markersLoading":function(a){e.markersLoading=a},"update:markers-loading":function(a){e.markersLoading=a},"update:poiLoading":function(a){e.poiLoading=a},"update:poi-loading":function(a){e.poiLoading=a},"update:searchTerm":function(a){e.searchTerm=a},"update:search-term":function(a){e.searchTerm=a},"update-results":e.updateSearchResults}}),e._v(" "),t("keep-alive",["search"===e.mainNavBar__activeTab?t("SearchBody",{attrs:{poiResults:e.poiResults,markerResults:e.markerResults,markersLoading:e.markersLoading,searchTerm:e.searchTerm,poiLoading:e.poiLoading},on:{"set-results":e.updateSearchResults}}):e._e()],1)],1)}),[],!1,null,null,null).exports}}]);