"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[1912],{5264:(t,e,o)=>{o.d(e,{Z:()=>a});const i=new Map;function s(t,e,o){const s=function(i){o.context._isDestroyed?document.removeEventListener("click",s):t.contains(i.target)||t===i.target||e(i)};i.set(t,s),setTimeout((()=>document.addEventListener("click",s)),0)}function n(t){const e=i.get(t);document.removeEventListener("click",e),i.delete(t)}const a={bind(t,{arg:{active:e,handler:o}},i){if("function"!=typeof o)throw new Error("v-click-outside: missing required handler argument.");!0===e&&s(t,o,i)},update(t,{arg:{active:e,handler:o}},a){e&&!i.has(t)?s(t,o,a):!e&&i.has(t)&&n(t)},unbind(t){n(t)}}},2634:(t,e,o)=>{o.r(e),o.d(e,{default:()=>_});var i=o(3589),s=o(5261),n=o(5908),a=o(2423),c=o(7335);const{MAActionFramework:r,getProperty:l}=window,d={components:{ActionSheet:c.Z},data:()=>({actionButtons:[],actionButtonsExtended:[],showActionSheet:!1,buttonSetMap:{"sfdc-marker":"tooltipLayout","my-position":"myPositionLayout","data-layer":"dataLayerLayout","favorite-marker":"FavoriteMarkerLayout","arcGIS-marker":"ArcGISLayerLayout",poi:"poiLayout"}}),computed:{buttonSetSettings:()=>l(window,"userSettings.ButtonSetSettings",!1)||{},...(0,n.mapGetters)("tooltip",{tooltip__record:"record",tooltip__queryMetaData:"queryMetaData",tooltip__markerType:"markerType",tooltip__marker:"marker"})},created(){this.$bus.$on("refresh-action-buttons",this.buildActionButtons),this.buildActionButtons()},beforeDestroy(){this.closeActionSheet(),this.$bus.$off("refresh-action-buttons")},methods:{buildActionButtons(){this.actionButtons=[],this.actionButtonsExtended=[];let t=[];const e=void 0!==this.buttonSetMap[this.tooltip__markerType];if("waypoint-marker"===this.tooltip__markerType)t.push({action:"Take Me There",header:!1,icon:"ma-icon-navigate-arrow",label:this.$Labels.ActionFramework_Take_Me_There,type:"Standard Action"});else if("c2c-marker"===this.tooltip__markerType)t.push({action:"View Record",header:!1,icon:"ma-icon-document",label:this.$Labels.MA_VIEW_RECORD,type:"Standard Action"}),t.push({action:"Add to Trip",header:!1,icon:"ma-icon-route",label:this.$Labels.ActionFramework_Add_to_Trip,Type:"Standard Action"}),t.push({action:"Take Me There",header:!1,icon:"ma-icon-navigate-arrow",label:this.$Labels.ActionFramework_Take_Me_There,type:"Standard Action"}),t.push({action:"Remove C2C Marker",header:!1,icon:"ma-icon-close",label:this.$Labels.Context_Remove_Marker,type:"Standard Action"}),t.push({action:"Check In",header:!1,icon:"ma-icon-checkin",label:this.$Labels.ActionFramework_Check_In,type:"Standard Action"});else if(e){const e=this.buttonSetMap[this.tooltip__markerType];if(t=r.buildMobileLayoutFromContentsListView(this.buttonSetSettings[e],{queryMetadata:this.tooltip__queryMetaData,record:this.tooltip__record,markerType:this.tooltip__markerType}),"sfdc-marker"===this.tooltip__markerType||"favorite-marker"===this.tooltip__markerType){const e={action:"View Record",header:!1,icon:"ma-icon-document",label:this.$Labels.MA_VIEW_RECORD,type:"Standard Action"};t.unshift(e)}}else console.warn("no button set info found");this.setActionButtons(t)},setActionButtons(t){let e=0;for(let o=0,i=t.length;o<i;o++){const i=t[o],n=i.icon||"ma-icon-solution";let a;a="Check In"===i.action?this.processCheckInStatus(i):{type:i.type,action:i.action,label:i.label,icon:n,id:(0,s.x$)()},i.header||this.tooltip__record.isRouteMarker&&"Remove Marker"===i.action||(e<=4?this.actionButtons.push(a):this.actionButtonsExtended.push(a)),e++}},processCheckInStatus(t){const e=this.tooltip__record.record.Id;return window.Plotting.getCheckInInformation(e).then((e=>{let o="";if(e.supportsActivities){for(let i=0;i<e.tasks.length;i++){o=e.tasks[i].Id,t.label=this.$Labels.ActionFramework_Check_Out,t.action="Check Out",t.checkInId=o;break}for(let i=0;i<e.events.length;i++){o=e.events[i].Id,t.label=this.$Labels.ActionFramework_Check_Out,t.action="Check Out",t.checkInId=o;break}}else this.actionButtons=this.actionButtons.filter((t=>"Check In"!==t.action)),this.actionButtonsExtended=this.actionButtonsExtended.filter((t=>"Check In"!==t.action))})),t},formatMarkerForActionFramework(){let t={};switch(this.tooltip__markerType){case"sfdc-marker":case"waypoint-marker":case"c2c-marker":t={records:[this.tooltip__record]};break;case"favorite-marker":t={favorites:[this.tooltip__marker]};break;case"data-layer":t={dataLayers:{}},t.dataLayers[this.tooltip__marker.qid]=[this.tooltip__marker];break;case"my-position":t={customMarkers:[{type:"MyPosition",title:"My Position",latlng:this.tooltip__marker.getPosition(),address:this.tooltip__marker.address||""}]};break;case"arcGIS-marker":t={records:[{type:"feature",title:this.tooltip__record.name||"ArcGIS Marker",location:this.tooltip__record.location,address:`Lat: ${this.tooltip__record.location.coordinates.lat}, Lng: ${this.tooltip__record.location.coordinates.lng}`,sublayer:this.tooltip__queryMetaData.sublayer,marker:{title:this.tooltip__record.name||"ArcGIS Marker"},feature:this.tooltip__marker.feature}]};break;case"poi":t={customMarkers:[{type:"POI",title:this.tooltip__marker.title,latlng:this.tooltip__marker.getPosition(),address:this.tooltip__record.formatted_address||"",place:l(this.tooltip__marker,"maData.place",!1)||{}}]};break;default:console.warn("type not found",this.tooltip__markerType)}return t},handleTooltipAction(t){const e=[];if("sfdc-marker"===this.tooltip__markerType){const{tooltips:t=[]}=this.tooltip__queryMetaData;for(let o=0;o<t.length;o++){const i=t[o];e.push({apiName:i.ActualFieldName,baseObject:i.BaseObject,value:this.tooltip__record[i.ActualFieldName]})}}const o="Custom Action"===t.type?r.customActions[t.action]||null:r.standardActions[t.action]||null,i={recString:"",record:{location:{lat:l(this.tooltip__record,"location.coordinates.lat",!1)||null,lng:l(this.tooltip__record,"location.coordinates.lng",!1)||null},formattedAddress:this.tooltip__record.FormattedAddress_MA||"",recordId:this.tooltip__record.Id,tooltipInfo:e}};if("Iframe"===o);else if("NewWindow"===o.Action){o.ActionValue.indexOf("{records}")>=0&&(i.records=!0);let t=`${o.ActionValue}${-1===o.ActionValue.indexOf("?")?"?noparams":""}&Button=${encodeURIComponent(o.Label)}&RecordId=${this.tooltip__record.record.Id}`;if("GET"===o.Options.method)o.Options.addRecords&&(t+=`&${o.Options.paramName}=${this.tooltip__record.Id}`),window.ma_navigateToUrl(t,"url","blank");else{const e={};o.Options.addRecords&&(e[o.Options.paramName]=this.tooltip__record.Id),window.openNewWindow("POST",t,e,"_blank")}}else if("LightningOut"===o.Action){o.ActionValue.indexOf("{records}")>=0&&(i.records=!0);const t=o.ActionValue;i.actionValue=t,i.qualifiedName=t,i.label=o.Label,o.Options.addRecords&&(i[o.Options.paramName]=this.tooltip__record.Id),i.frameworkOptions=o.Options,window.launch_custom_action(i)}else if("FlowAction"===o.Action)i.label=o.Label,i.actionValue="maps:MapsFlowDisplay",i.qualifiedName="maps:MapsFlowDisplay",i.bundleName="maps:MapsFlowDisplay",i.flowDevName=o.ActionValue,window.launch_custom_action(i);else if("QuickAction"===o.Action)this.performQuickAction(o.ActionValue,this.tooltip__record.Id,i);else if("Check In"===t.action||"Check Out"===t.action)o.ActionValue.call(this,{buttonInfo:t,records:[this.tooltip__record]}).then((e=>{window.MA.enabledFeatures.autoCheckOut||"Check Out"===t.action?(t.label=this.$Labels.ActionFramework_Check_In,t.action="Check In"):(t.label=this.$Labels.ActionFramework_Check_Out,t.action="Check Out"),t.checkInId=e}));else{const e=this.formatMarkerForActionFramework();e.button=t,o.ActionValue.call(this,e)}},openActionSheet(){this.showActionSheet=!0},closeActionSheet(){this.showActionSheet=!1},performQuickAction(t,e,o){(new a.Z).setAction(this.$Remoting.performQuickAction).setErrorHandler(((t,e)=>{console.warn(t),console.warn(e)})).invoke([t,e],((t={})=>{const{success:e=!1,actionType:i="",errorMessage:s="Unknown Error"}=t;if(e)switch(i){case"Create":o.actionValue="maps:MapsActionForm",o.qualifiedName="maps:MapsActionForm",o.bundleName="maps:MapsActionForm",o.targetObject=t.targetObject,window.launch_custom_action(o);break;case"Update":o.actionValue="maps:MapsActionForm",o.qualifiedName="maps:MapsActionForm",o.bundleName="maps:MapsActionForm",o.targetObject=t.targetObject,o.isUpdate=!0,window.launch_custom_action(o);break;case"lightning":o.actionValue=t.bundleName,o.qualifiedName=t.qualifiedName,o.bundleName=t.bundleName,o.sObjectType=t.sObjectType,window.launch_custom_action(o);break;case"flow":o.actionValue="maps:MapsFlowDisplay",o.qualifiedName="maps:MapsFlowDisplay",o.bundleName="maps:MapsFlowDisplay",o.flowDevName=t.flowDevName,window.launch_custom_action(o);break;default:console.warn("action type not found",i)}else window.MAToastMessages.showError({message:s})}),{escape:!1,buffer:!1})}}};var h=o(1900);const u=(0,h.Z)(d,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"action-bar-wrap"},[o("div",{staticClass:"slds-grid slds-grid_vertical-align-center",staticStyle:{width:"100%"}},[t._l(t.actionButtons,(function(e){return o("button",{key:e.id,staticClass:"action-button slds-col action-bar-button actionbutton",attrs:{"data-type":e.type,"data-action":e.action},on:{click:function(o){return t.handleTooltipAction(e)}}},[o("div",{staticClass:"slds-grid slds-grid_vertical slds-grid_vertical-align-center slds-grid_horizontal-align-center"},[o("div",{staticClass:"action-button_icon ma-icon",class:e.icon}),t._v(" "),o("div",{staticClass:"action-button_text action-bar-button-text"},[t._v(t._s(t._f("decode")(e.label)))])])])})),t._v(" "),t.actionButtonsExtended.length>0?o("ActionSheet",{attrs:{doDetach:!0,hideOverride:t.showActionSheet,options:t.actionButtonsExtended},on:{select:t.handleTooltipAction,hide:t.closeActionSheet}}):t._e()],2)])}),[],!1,null,"a999fdbe",null).exports;var p=o(9159);const m={components:{TooltipActionButtons:u,TooltipContent:()=>({...(0,i.Z)(),component:o.e(9887).then(o.bind(o,4429)),error:p.Z})}},_=(0,h.Z)(m,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"tooltip-body flex-grow-1",attrs:{id:"markerTooltipBody"}},[o("div",{staticClass:"tooltip-inner slds-grid slds-grid_vertical"},[o("TooltipActionButtons"),t._v(" "),o("TooltipContent")],1)])}),[],!1,null,null,null).exports},7335:(t,e,o)=>{o.d(e,{Z:()=>a});var i=o(5264);const{$:s}=window,n={name:"ActionSheet",directives:{"click-outside":i.Z},props:{options:{type:Array,required:!0},doDetach:{type:Boolean,default:!0},labelKey:{type:String,default:"label"},buttonText:{type:String,default:""},buttonIcon:{type:String,default:""},hideOverride:{type:Boolean,default:!1},selectedItems:{type:Array,default:()=>[]},buttonType:{type:String,default:""}},data:()=>({container:null,showOptions:!1,styleObject:{},window:{height:0,width:0},uid:"action-sheet"}),computed:{isPhone(){return this.window.width<769},computedIcon(){let t="";return""!==this.buttonIcon?t=this.buttonIcon:""===this.buttonText&&(t="ma-icon-threedots-vertical"),t},actionSheetClickOutsideOptions(){return{active:this.showOptions,handler:this.hideActionSheet}}},watch:{isPhone(){this.showOptions=!1}},created(){window.addEventListener("resize",this.handleResize),this.handleResize()},destroyed(){window.removeEventListener("resize",this.handleResize),this.hideActionSheet()},methods:{handleResize(){this.window.width=window.innerWidth,this.window.height=window.innerHeight},returnItem(t){t.isHeader||(this.$emit("select",t),this.hideActionSheet())},hideActionSheet(){this.showOptions=!1,this.container&&(this.container.remove(),this.container=null)},detach(){if(!this.$refs.button)return;const t=document.querySelector(`.slds-scope.${this.uid}`);try{t.remove()}catch(t){}const e=this.$refs.button.getBoundingClientRect();this.container=document.createElement("div"),this.container.className=`slds-scope ${this.uid}`,this.container.appendChild(this.$refs.actions),document.body.appendChild(this.container),this.styleObject={top:`${e.top+this.$refs.button.clientHeight+s(window).scrollTop()}px`,left:`${e.left+s(window).scrollLeft()}px`,"max-height":"300px"}},adjustForClipping(){const t=this.$refs.actions.getBoundingClientRect();let e;if(e=document.documentElement.clientHeight-window.innerHeight<=0?document.documentElement.clientHeight:window.innerHeight-this.getScrollbarWidth(),t.x<0)this.styleObject.left=`${this.$refs.actions.offsetLeft+Math.abs(t.x)}px`;else if(t.left+t.width>document.documentElement.clientWidth){const e=t.left+t.width-document.documentElement.clientWidth-s(window).scrollLeft();this.styleObject.left=t.left-e+"px"}const o=this.$refs.actions.scrollHeight,i=s(window).scrollTop();if(this.styleObject["max-height"]="300px",t.top+o>e){const s=t.top+o-i-e;this.$bus.$emit("ma-modal-scroll-by",s),this.styleObject.top=t.top-s+"px"}},disableClick(t){t.stopPropagation(),t.preventDefault()},openActionSheet(){this.showOptions=!0,this.doDetach&&this.detach(),this.$nextTick((()=>{this.doDetach&&this.adjustForClipping(),this.options.forEach(((t,e)=>{const o=t,i=this.$refs.optionItem[e];o.isHeader&&i.addEventListener("click",this.disableClick,!0)}))}))}}},a=(0,o(1900).Z)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{directives:[{name:"click-outside",rawName:"v-click-outside:[actionSheetClickOutsideOptions]",arg:t.actionSheetClickOutsideOptions}],staticClass:"action-sheet-wrapper slds-scope"},[o("div",{ref:"button",staticClass:"slds-grid slds-grid_vertical-align-center",on:{click:t.openActionSheet}},[o("div",{staticClass:"slds-button slds-col slds-truncate"},[t._v(t._s(t._f("decode")(t.buttonText)))]),t._v(" "),""!==t.computedIcon?o("div",[o("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",class:[t.buttonType]},[o("span",{staticClass:"slds-button__icon ma-icon",class:[t.computedIcon]})])]):t._e()]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.showOptions,expression:"showOptions"}],ref:"actions",staticClass:"ma-action-sheet-wrap in slds-grid slds-grid_vertical slds-grid_align-end",style:t.isPhone?{}:t.styleObject},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.isPhone,expression:"isPhone"}],staticClass:"action-sheet_mask",on:{click:t.hideActionSheet}}),t._v(" "),o("div",{staticClass:"action-sheet_wrap slds-grid slds-grid_vertical"},[o("div",{staticClass:"action-sheet_content slds-scrollable"},t._l(t.options,(function(e,i){return o("div",{key:i,ref:"optionItem",refInFor:!0,staticClass:"action-sheet_item slds-grid slds-p-around_medium",class:{"header slds-text-title_caps slds-section__title slds-theme--shade":e.isHeader,"slds-is-selected":t.selectedItems.includes(e.id)},on:{click:function(o){return t.returnItem(e)}}},[t._m(0,!0),t._v(" "),o("div",{staticClass:"slds-col"},[o("span",{staticStyle:{"word-break":"break-word"}},[t._v(t._s(t._f("decode")(e[t.labelKey])))])])])})),0),t._v(" "),o("div",{staticClass:"slds-button slds-button_neutral action-sheet_close-button",on:{click:t.hideActionSheet}},[t._v("\n                "+t._s(t._f("decode")(t.$Labels.MA_Close))+"\n            ")])])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"action-sheet_selected-icon slds-p-right_medium"},[e("span",{staticClass:"slds-icon slds-icon_x-small ma-icon ma-icon-check"})])}],!1,null,"44c08aa9",null).exports}}]);