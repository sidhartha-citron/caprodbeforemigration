(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[7241],{5264:(t,e,s)=>{"use strict";s.d(e,{Z:()=>n});const a=new Map;function i(t,e,s){const i=function(a){s.context._isDestroyed?document.removeEventListener("click",i):t.contains(a.target)||t===a.target||e(a)};a.set(t,i),setTimeout((()=>document.addEventListener("click",i)),0)}function o(t){const e=a.get(t);document.removeEventListener("click",e),a.delete(t)}const n={bind(t,{arg:{active:e,handler:s}},a){if("function"!=typeof s)throw new Error("v-click-outside: missing required handler argument.");!0===e&&i(t,s,a)},update(t,{arg:{active:e,handler:s}},n){e&&!a.has(t)?i(t,s,n):!e&&a.has(t)&&o(t)},unbind(t){o(t)}}},758:(t,e,s)=>{t.exports=s.p+"images/d61e60332b10a8fa7cd62815ef896afd.svg"},7335:(t,e,s)=>{"use strict";s.d(e,{Z:()=>n});var a=s(5264);const{$:i}=window,o={name:"ActionSheet",directives:{"click-outside":a.Z},props:{options:{type:Array,required:!0},doDetach:{type:Boolean,default:!0},labelKey:{type:String,default:"label"},buttonText:{type:String,default:""},buttonIcon:{type:String,default:""},hideOverride:{type:Boolean,default:!1},selectedItems:{type:Array,default:()=>[]},buttonType:{type:String,default:""}},data:()=>({container:null,showOptions:!1,styleObject:{},window:{height:0,width:0},uid:"action-sheet"}),computed:{isPhone(){return this.window.width<769},computedIcon(){let t="";return""!==this.buttonIcon?t=this.buttonIcon:""===this.buttonText&&(t="ma-icon-threedots-vertical"),t},actionSheetClickOutsideOptions(){return{active:this.showOptions,handler:this.hideActionSheet}}},watch:{isPhone(){this.showOptions=!1}},created(){window.addEventListener("resize",this.handleResize),this.handleResize()},destroyed(){window.removeEventListener("resize",this.handleResize),this.hideActionSheet()},methods:{handleResize(){this.window.width=window.innerWidth,this.window.height=window.innerHeight},returnItem(t){t.isHeader||(this.$emit("select",t),this.hideActionSheet())},hideActionSheet(){this.showOptions=!1,this.container&&(this.container.remove(),this.container=null)},detach(){if(!this.$refs.button)return;const t=document.querySelector(`.slds-scope.${this.uid}`);try{t.remove()}catch(t){}const e=this.$refs.button.getBoundingClientRect();this.container=document.createElement("div"),this.container.className=`slds-scope ${this.uid}`,this.container.appendChild(this.$refs.actions),document.body.appendChild(this.container),this.styleObject={top:`${e.top+this.$refs.button.clientHeight+i(window).scrollTop()}px`,left:`${e.left+i(window).scrollLeft()}px`,"max-height":"300px"}},adjustForClipping(){const t=this.$refs.actions.getBoundingClientRect();let e;if(e=document.documentElement.clientHeight-window.innerHeight<=0?document.documentElement.clientHeight:window.innerHeight-this.getScrollbarWidth(),t.x<0)this.styleObject.left=`${this.$refs.actions.offsetLeft+Math.abs(t.x)}px`;else if(t.left+t.width>document.documentElement.clientWidth){const e=t.left+t.width-document.documentElement.clientWidth-i(window).scrollLeft();this.styleObject.left=t.left-e+"px"}const s=this.$refs.actions.scrollHeight,a=i(window).scrollTop();if(this.styleObject["max-height"]="300px",t.top+s>e){const i=t.top+s-a-e;this.$bus.$emit("ma-modal-scroll-by",i),this.styleObject.top=t.top-i+"px"}},disableClick(t){t.stopPropagation(),t.preventDefault()},openActionSheet(){this.showOptions=!0,this.doDetach&&this.detach(),this.$nextTick((()=>{this.doDetach&&this.adjustForClipping(),this.options.forEach(((t,e)=>{const s=t,a=this.$refs.optionItem[e];s.isHeader&&a.addEventListener("click",this.disableClick,!0)}))}))}}},n=(0,s(1900).Z)(o,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"click-outside",rawName:"v-click-outside:[actionSheetClickOutsideOptions]",arg:t.actionSheetClickOutsideOptions}],staticClass:"action-sheet-wrapper slds-scope"},[s("div",{ref:"button",staticClass:"slds-grid slds-grid_vertical-align-center",on:{click:t.openActionSheet}},[s("div",{staticClass:"slds-button slds-col slds-truncate"},[t._v(t._s(t._f("decode")(t.buttonText)))]),t._v(" "),""!==t.computedIcon?s("div",[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",class:[t.buttonType]},[s("span",{staticClass:"slds-button__icon ma-icon",class:[t.computedIcon]})])]):t._e()]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showOptions,expression:"showOptions"}],ref:"actions",staticClass:"ma-action-sheet-wrap in slds-grid slds-grid_vertical slds-grid_align-end",style:t.isPhone?{}:t.styleObject},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isPhone,expression:"isPhone"}],staticClass:"action-sheet_mask",on:{click:t.hideActionSheet}}),t._v(" "),s("div",{staticClass:"action-sheet_wrap slds-grid slds-grid_vertical"},[s("div",{staticClass:"action-sheet_content slds-scrollable"},t._l(t.options,(function(e,a){return s("div",{key:a,ref:"optionItem",refInFor:!0,staticClass:"action-sheet_item slds-grid slds-p-around_medium",class:{"header slds-text-title_caps slds-section__title slds-theme--shade":e.isHeader,"slds-is-selected":t.selectedItems.includes(e.id)},on:{click:function(s){return t.returnItem(e)}}},[t._m(0,!0),t._v(" "),s("div",{staticClass:"slds-col"},[s("span",{staticStyle:{"word-break":"break-word"}},[t._v(t._s(t._f("decode")(e[t.labelKey])))])])])})),0),t._v(" "),s("div",{staticClass:"slds-button slds-button_neutral action-sheet_close-button",on:{click:t.hideActionSheet}},[t._v("\n                "+t._s(t._f("decode")(t.$Labels.MA_Close))+"\n            ")])])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"action-sheet_selected-icon slds-p-right_medium"},[e("span",{staticClass:"slds-icon slds-icon_x-small ma-icon ma-icon-check"})])}],!1,null,"44c08aa9",null).exports},5306:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>b});var a=s(7335),i=s(1595),o=s(5747),n=s(5261),l=s(2423);const{MA:r,async:d,google:c,$:h}=window,u={components:{MATabs:i.Z,MATab:o.Z},props:{layerData:{type:Object,required:!0}},data:()=>({isOpen:!1,legendInfo:[],aggregateData:[],aggregatesLoading:!0}),computed:{limitedMarkers(){const{markers:t=[]}=this.layerData;return t.slice(0,100)},showTooManyMarkersNotification(){const{markers:t=[]}=this.layerData;return t.length>100},clusterId(){return this.getTabId()}},created(){this.normalizeLegendData(),this.getAggregates()},methods:{toggleCard(){this.isOpen=!this.isOpen},getTabId:()=>(0,n.x$)(),normalizeLegendData(){const{type:t=""}=this.layerData;let e=[];if("data"===t){const{legendCounts:t={},legend:s={}}=this.layerData,{rows:a={}}=s;Object.keys(t).forEach((s=>{const i=a[s];e.push({...i,...t[s]})}))}else if("marker"===t){const{legendCounts:t={},legendInfo:s={}}=this.layerData;Object.keys(t).forEach((a=>{const i=s[a];e.push({...i,...t[a]})}))}e=this.sortByProperty(e,"rowId"),this.legendInfo=e},getIconColor(t){const e=h.parseHTML(t);return h(e).css("color")},sortByProperty:(t,e)=>(t.sort(((t,s)=>t[e]<s[e]?-1:t[e]>s[e]?1:0)),t),toggletooltip(t){t.isOpen||(t.isOpen=!1),t.isOpen=!t.isOpen},formatNumberString(t){const e=Math.round(100*t)/100;return r.Util.formatNumberString(e||"0")},getMarkerIcon(t){let e="";try{e=t.getIcon().url}catch(t){}return e},navigateToRecord(t){window.Plotting.marker_Click.call(t)},getAggregates(){const{type:t=""}=this.layerData;this.aggregatesLoading=!0,"data"===t?this.getDataLayerAggregateInfo().then((t=>{this.aggregatesLoading=!1,this.aggregateData=t})):(this.aggregatesLoading=!1,this.aggregateData=this.layerData.tooltips)},getDataLayerAggregateInfo(){return new Promise((t=>{const e=new c.maps.LatLngBounds,s=h(`#PlottedQueriesTable .DataLayer[qid="${this.layerData.qid}"]`).data().SFLayerParams||{},{uids:a=[]}=this.layerData,i=r.Util.createBatchable(a,500),o={method:"post",action:"markers",subType:"data",version:"2"},n={},u=e.getCenter(),p=e.getNorthEast(),g=e.getSouthWest(),m={data:s,mapinfo:{nelat:p.lat(),nelng:p.lng(),swlat:g.lat(),swlng:g.lng(),celat:u.lat(),celng:u.lng(),limit:0},ids:[],aggregates:"true",details:"false"},_=d.queue(((t,e)=>{const s=t.recs.length;m.ids=t.recs,m.mapinfo.limit=s;const a=JSON.stringify(m);(new l.Z).setAction(this.$Remoting.MapAnythingIORequestPOST).setErrorHandler(((t,s)=>{r.isUserLoggedIn(t,s,!0)||e()})).invoke([o,a],(t=>{if(t.success){const{data:e={}}=t,{aggregates:s=[]}=e;s.length>0&&(this.layerData.hasAggregates=!0,s.forEach((t=>{const e=n[t.label]||{max:void 0,sum:0,min:void 0,avg:0};void 0!==t.max&&(void 0===e.max||t.max>e.max)&&(e.max=t.max),void 0!==t.sum&&(e.sum+=t.sum),void 0!==t.min&&(void 0===e.min||t.min<e.min)&&(e.min=t.min),void 0!==t.avg&&(e.avg=(e.avg+t.avg)/2),n[t.label]=e})))}e()}),{escape:!1,buffer:!1})}));_.concurrency=5,i.forEach((t=>{_.push({recs:t},(()=>{}))})),_.drain=()=>{const e=[];Object.keys(n).forEach((t=>{const s=n[t];e.push({FieldLabel:t,sum:s.sum,max:s.max,avg:s.avg,min:s.min})})),t(e)}}))}}};var p=s(1900);const g=(0,p.Z)(u,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"cluster-card slds-card"},[a("div",{staticClass:"slds-section",class:[t.isOpen?"slds-is-open":""]},[a("h3",{staticClass:"slds-section__title"},[a("div",{staticClass:"slds-button slds-section__title-action",on:{click:t.toggleCard}},[a("span",{staticClass:"ma-icon ma-icon-chevrondown",class:[t.isOpen?"ma-icon-chevrondown":"ma-icon-chevronright"],staticStyle:{height:"25px"}}),t._v(" "),a("span",{staticClass:"slds-truncate slds-p-right_x-small",staticStyle:{"font-weight":"700",padding:"0px 60px 0 10px"},attrs:{title:t.layerData.name}},[t._v(t._s(t._f("decode")(t.layerData.name)))]),t._v(" "),a("span",{staticStyle:{position:"absolute",right:"8px"}},[t._v(t._s(t._f("decode")(t.layerData.totalRecords)))])])]),t._v(" "),a("div",{staticClass:"slds-section__content slds-p-horizontal_small",staticStyle:{"padding-top":"0","border-top":"2px solid rgb(216, 221, 230)"}},[a("MATabs",{attrs:{activeTabId:t.clusterId}},[a("MATab",{staticClass:"slds-p-around_none",attrs:{id:t.getTabId(),title:t._f("decode")(t.$Labels.MA_Aggregates)}},[t.aggregatesLoading?a("div",[t._v("\n                        "+t._s(t._f("decode")(t.$Labels.MA_Loading))+"\n                    ")]):a("div",t._l(t.aggregateData,(function(e,s){return a("div",{key:s,staticClass:"slds-section"},[a("h3",{staticClass:"slds-section__title"},[a("div",{staticClass:"slds-button slds-section__title-action"},[a("span",{staticClass:"slds-truncate slds-p-right_x-small",attrs:{title:t._f("decode")(e.FieldLabel)}},[t._v(t._s(e.FieldLabel))])])]),t._v(" "),a("div",{staticClass:"slds-section__content slds-p-around_small",staticStyle:{"border-top":"2px solid rgb(216, 221, 230)"}},[a("dl",{staticClass:"slds-dl_horizontal"},[a("dt",{staticClass:"slds-dl_horizontal__label"},[t._v(t._s(t._f("decode")(t.$Labels.MA_Sum))+":")]),t._v(" "),a("dd",{staticClass:"slds-dl_horizontal__detail"},[t._v(t._s(t.formatNumberString(e.sum)))]),t._v(" "),a("dt",{staticClass:"slds-dl_horizontal__label"},[t._v(t._s(t._f("decode")(t.$Labels.MA_Average))+":")]),t._v(" "),a("dd",{staticClass:"slds-dl_horizontal__detail"},[t._v(t._s(t.formatNumberString(e.avg)))]),t._v(" "),a("dt",{staticClass:"slds-dl_horizontal__label"},[t._v(t._s(t._f("decode")(t.$Labels.MA_Minimum_value))+":")]),t._v(" "),a("dd",{staticClass:"slds-dl_horizontal__detail"},[t._v(t._s(t.formatNumberString(e.min)))]),t._v(" "),a("dt",{staticClass:"slds-dl_horizontal__label"},[t._v(t._s(t._f("decode")(t.$Labels.MA_Maximum_value))+":")]),t._v(" "),a("dd",{staticClass:"slds-dl_horizontal__detail"},[t._v(t._s(t.formatNumberString(e.max)))])])])])})),0)]),t._v(" "),"feature"!==t.layerData.type?a("MATab",{attrs:{id:t.getTabId(),title:t._f("decode")(t.$Labels.MA_Legend)}},[a("table",{staticClass:"slds-table slds-table_cell-buffer slds-table_bordered slds-p-top_x-small"},[a("tbody",t._l(t.legendInfo,(function(e,i){return a("tr",{key:i,staticClass:"legend-row"},[a("td",{staticClass:"slds-truncate",staticStyle:{"min-width":"100px"}},[t._v("\n                                    "+t._s(t._f("decode")(e.label))+"\n                                ")]),t._v(" "),a("td",{staticClass:"slds-truncate"},[t._v(t._s(t._f("decode")(e.count)))]),t._v(" "),a("td",{staticClass:"slds-truncate"},[t._v(t._s(t._f("decode")(t.$Labels.MA_of)))]),t._v(" "),a("td",{staticClass:"slds-truncate"},[t._v(t._s(t._f("decode")(e.totalmarkers)))]),t._v(" "),a("td",{staticClass:"legend-color"},[e.icon.indexOf("/images/marker")>-1||e.icon.indexOf("servlet.FileDownload")>-1||e.icon.indexOf("sfc/servlet.shepherd/version/download/")>-1||e.icon.indexOf("sfc/servlet.shepherd/document/download/")>-1?a("img",{staticStyle:{height:"18px"},attrs:{src:e.icon}}):"marker"===t.layerData.type&&-1!==e.icon.indexOf("ion-ios-infinite")?a("span",{style:{"font-size":"18px",color:t.getIconColor(e.icon)}},[t._v("âˆž")]):"marker"===t.layerData.type&&-1!==e.icon.indexOf("glyphicon-comment")?a("span",{staticClass:"slds-icon-utility-prompt",style:{"font-size":"16px",fill:t.getIconColor(e.icon)}},[a("MAIcon",{attrs:{slot:"extendInput",src:s(758)},slot:"extendInput"})],1):a("span",[t._v(t._s(t._f("decode")(e.icon)))])])])})),0)])]):t._e(),t._v(" "),"feature"!==t.layerData.type?a("MATab",{attrs:{id:t.clusterId,title:t._f("decode")(t.$Labels.MA_Markers)}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showTooManyMarkersNotification,expression:"showTooManyMarkersNotification"}],staticClass:"shape-cluster-popup-message-firstXXmarkers"},[t._v("\n                        First 100 Markers Displayed\n                    ")]),t._v(" "),a("table",{staticClass:"slds-table slds-table_cell-buffer slds-table_bordered slds-p-top_x-small"},[a("tbody",t._l(t.limitedMarkers,(function(e,s){return a("tr",{key:s,staticClass:"legend-row",on:{click:function(s){return t.navigateToRecord(e)}}},[a("td",{staticStyle:{width:"60px"}},[a("img",{staticStyle:{height:"20px","max-width":"30px"},attrs:{src:t.getMarkerIcon(e)}})]),t._v(" "),a("td",{staticStyle:{"word-wrap":"break-word","white-space":"normal"}},[t._v(t._s(t._f("decode")(e.title)))])])})),0)])]):t._e()],1)],1)])])}),[],!1,null,"5fae3978",null).exports,{getProperty:m,google:_,$:f,MA:y}=window,v={components:{ActionSheet:a.Z,ClusterCard:g},props:{clickOptions:{type:Object,default:()=>{}},totalRecordCount:{type:String|Number,default:"0"},isLoading:{type:Boolean,default:!1}},data:()=>({totalRecords:0,actionButtons:[],actionButtonsExtended:[],massActionInfo:{},clickedShape:null,shapeLabel:"",dataBounds:new _.maps.LatLngBounds,shapeMgr:null,markerLayersInfo:[],layerSelector:"#PlottedQueriesTable .PlottedRowUnit",showActionSheet:!1,zoomedOnMarkers:!1}),computed:{buttonSetSettings:()=>m(window,"userSettings.ButtonSetSettings",!1)||{}},created(){this.buildActionButtons(),this.$nextTick((()=>{this.$emit("update:isLoading",!0),this.getMarkersInsideShapeCluster().finally((()=>{this.$emit("update:isLoading",!1)}))}))},methods:{buildActionButtons(){let t=0;if(this.buttonSetSettings.massActionLayout&&this.buttonSetSettings.massActionLayout.length>0){const e=["Clear Coordinates","Send Email","Chatter Post"];this.buttonSetSettings.massActionLayout.forEach((s=>{s.Buttons.forEach((s=>{let a={};if("Custom Action"===s.Type&&window.MAActionFramework.customActions[s.Label])a=window.MAActionFramework.customActions[s.Label];else if(window.MAActionFramework.standardActions[s.Action||s.Label]){if(e.indexOf(s.Label)>=0)return;a=window.MAActionFramework.standardActions[s.Action||s.Label]}const i={type:a.Type,action:s.Label,label:a.Label,icon:a.defaultIcon};t<4?this.actionButtons.push(i):this.actionButtonsExtended.push(i),t++}))}))}},handleTooltipAction(t){if("shape"===this.clickOptions.type){const e={shape:{geometry:this.massActionInfo.geometry}};window.massActionShapeClick(this.clickedShape,t.action,t.type,e)}else window.massActionClick(t.action,t.type,this.massActionInfo)},zoomToMarkers(){window.MA.map.fitBounds(this.clickOptions.cluster.getBounds()),this.zoomedOnMarkers=!0},createPolygon(){const t=new y.Map.ShapeManager,e=new _.maps.LatLngBounds;this.markerLayersInfo[0].markers.forEach((s=>{t.addLayer(s.getPosition()),e.extend(s.getPosition())})),window.addProximityLayer({shapeType:"Polygon"}).then((s=>{const a=s,i=a.data("qid");a.attr("data-id",i),a.data("proxObject",new _.maps.Polygon({map:y.map,paths:t.getConvexHull(),strokeColor:"#000000",strokeWeight:4,fillColor:"#22CC22",fillOpacity:.6,layerType:"prox",qid:i})),a.find(".queryLoader").hide(),a.find(".queryIcon").show(),window.MA.map.fitBounds(e),_.maps.event.addListener(a.data("proxObject"),"click",(t=>{window.proximityLayer_Click({position:t.latLng,type:"polygon",shape:a.data("proxObject")})}))}))},getMarkersInsideShapeCluster(){return new Promise((t=>{const e={type:"",cluster:{},...this.clickOptions};this.buildShapeClusterInfo(e),this.processLayerMarkers(e).then((()=>{t()}))}))},buildShapeClusterInfo(t){if("shape"===t.type)if(this.clickedShape=t.feature||t.shape,this.massActionInfo={target:this.clickedShape,latlng:y.map.getCenter(),type:"shape"},this.shapeMgr=(new y.Map.ShapeManager).addLayer(this.clickedShape),t.feature)this.shapeLabel=t.feature.label||"";else{try{t.shape instanceof _.maps.Polygon?t.shape.getPath().forEach((t=>{this.dataBounds.extend(t)})):this.dataBounds.union(t.shape.getBounds())}catch(t){this.dataBounds=y.map.getBounds()}this.shapeLabel=t.shape.label||""}else if("cluster"===t.type){const e=m(t||{},"cluster.markerClusterer_.qid",!1)||"";this.layerSelector=`#PlottedQueriesTable .PlottedRowUnit[qid="${e}"]`,this.massActionInfo={target:t.cluster,latlng:y.map.getCenter(),type:"cluster"}}},processLayerMarkers(t){const e=this;return new Promise((s=>{const a=f(this.layerSelector);let i=0;setTimeout((function o(){if(i<a.length){const s=a.eq(i);let n={},l=!1;s.hasClass("savedQuery")?n=e.processSFDCLayer(t,s):"marker"===s.attr("plot-type")||"point"===s.attr("plot-type")?n=e.processDataLayer(t,s):s.hasClass("ArcGISLayer")&&(l=!0,e.processArcGISLayer(t,s)),n.totalRecords>0&&!l&&e.markerLayersInfo.push(n),i++,setTimeout(o,1)}else s()}),1)}))},processSFDCLayer(t,e){const s={layerId:e.data("qid"),dataType:e.attr("data-type"),type:"marker",name:""!==e.data("savedQueryName")?e.data("savedQueryName"):e.find(".basicinfo-name").text(),markers:[],tooltips:[],totalRecords:0,fieldList:[],advancedOptions:f(this).data("advancedOptions"),legendInfo:e.data("legendInfo"),legendCounts:{},records:[],hasAggregates:!1,qid:e.attr("qid")};if((e.data("tooltips")||[]).forEach((t=>{"ToolTip"!==t.TooltipType&&!/color/i.test(t.TooltipType)||-1!==f.inArray(s.fieldList,t.ActualFieldName)||"currency"!==t.describe.type&&"double"!==t.describe.type&&"integer"!==t.describe.type&&"int"!==t.describe.type||(s.hasAggregates=!0,s.tooltips.push(f.extend({sum:0,avg:0,min:void 0,max:void 0},t)),s.fieldList.push(t.ActualFieldName))})),"cluster"===t.type){const a=e.data("records");t.cluster.getMarkers().forEach((t=>{const e=a[t.record.Id];if((e.isVisible||e.isClustered||e.isScattered)&&(s.records.push(e),s.totalRecords++,s.markers.push(e.marker),s.legendCounts[e.legendId]||(s.legendCounts[e.legendId]={count:0}),s.legendCounts[e.legendId].count++,this.totalRecords++,this.$emit("update:totalRecordCount",this.totalRecords),s.hasAggregates)){const{tooltips:t}=s;t.forEach((t=>{const a=m(e,t.FieldName);if(void 0!==a){const e=parseFloat(a);t.sum+=e,(void 0===t.min||t.min>e)&&(t.min=e),(void 0===t.max||t.max<e)&&(t.max=e),t.avg=t.sum/s.markers.length}}))}}))}else if("shape"===t.type){const t=e.data("records")||{},a={};Object.keys(t).forEach((e=>{const i=t[e];if(i.isVisible||i.isClustered||i.isScattered){const t=i.marker.getPosition();if(a[e]=[t.lat(),t.lng()],this.shapeMgr.containsLatLng(t)&&(s.totalRecords++,s.records.push(i),s.markers.push(i.marker),s.legendCounts[i.legendId]||(s.legendCounts[i.legendId]={count:0}),s.legendCounts[i.legendId].count++,this.totalRecords++,this.$emit("update:totalRecordCount",this.totalRecords),s.hasAggregates)){const{tooltips:t}=s;t.forEach((t=>{const e=m(i,t.FieldName);if(void 0!==e){const a=parseFloat(e);t.sum+=a,(void 0===t.min||t.min>a)&&(t.min=a),(void 0===t.max||t.max<a)&&(t.max=a),t.avg=t.sum/s.markers.length}}))}}}))}return s},processDataLayer(t,e){const s=this,a={layerId:e.data("id"),dataType:e.attr("data-type"),type:"data",name:e.data("name"),markers:[],tooltips:[],totalRecords:0,legend:e.data("legend"),key:e.data("key"),uids:[],tables:[],legendCounts:{},timestamp:(new Date).getTime(),qid:e.attr("qid")};if("cluster"===t.type)(t.cluster||{}).getMarkers().forEach((t=>{const e=m(t,"data.rowid",!1);a.legendCounts[e]||(a.legendCounts[e]={count:0}),a.legendCounts[e].count++,this.dataBounds.extend(t.getPosition()),a.uids.push(t.data.uid),a.markers.push(t),a.totalRecords++,this.totalRecords++,this.$emit("update:totalRecordCount",this.totalRecords)}));else if("shape"===t.type){const t=e.data("records")||{},i={};Object.keys(t).forEach((e=>{const o=t[e];if(o.isVisible||o.isClustered){const t=o.clusterMarker,n=m(t,"data.rowid",!1);a.legendCounts[n]||(a.legendCounts[n]={count:0}),a.legendCounts[n].count++;const l=t.getPosition();i[e]=[l.lat(),l.lng()],t&&s.shapeMgr.containsLatLng(l)&&(a.uids.push(t.data.uid),a.markers.push(t),a.totalRecords++,s.totalRecords++,s.$emit("update:totalRecordCount",this.totalRecords))}}))}return a},processArcGISLayer(t,e){const s=this;Array.prototype.push.apply([],window.ArcGIS.featureLayerHelpers.searchByShape(e,s.markerLayersInfo,s.clickedShape,s.shapeMgr,(()=>{s.totalRecords++,s.$emit("update:totalRecordCount",this.totalRecords)}),(()=>{}),(()=>{})))}}},b=(0,p.Z)(v,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tooltip-body flex-grow-1 qidLocation ma-view-body",attrs:{id:"clusterBodyWrapper"}},[s("div",{attrs:{id:"shapeActionsWrapper"}},[s("div",[s("div",{staticClass:"action-bar-wrap"},[s("div",{staticClass:"slds-grid slds-grid_vertical-align-center",staticStyle:{width:"100%"}},[t._l(t.actionButtons,(function(e,a){return s("button",{key:a,staticClass:"action-button slds-col action-bar-button actionbutton",attrs:{"data-type":e.type,"data-action":e.action},on:{click:function(s){return t.handleTooltipAction(e)}}},[s("div",{staticClass:"slds-grid slds-grid_vertical slds-grid_vertical-align-center slds-grid_horizontal-align-center"},[s("div",{staticClass:"action-button_icon ma-icon",class:e.icon}),t._v(" "),s("div",{staticClass:"action-button_text action-bar-button-text"},[t._v(t._s(t._f("decode")(e.label)))])])])})),t._v(" "),t.actionButtonsExtended.length>0?s("ActionSheet",{attrs:{doDetach:!0,options:t.actionButtonsExtended},on:{select:t.handleTooltipAction,hide:function(e){t.showActionSheet=!1}}}):t._e()],2)])])]),t._v(" "),s("div",{staticClass:"slds-scope momentum-scrolling-y slds-scrollable",staticStyle:{padding:"0.5rem 0.75rem 0.75rem"},attrs:{id:"clusterBody"}},[t.clickOptions.cluster?s("div",{staticClass:"slds-button-group slds-align_absolute-center",staticStyle:{margin:"0.5rem 0 1rem 0"}},[s("button",{staticClass:"slds-button slds-button_neutral",attrs:{disabled:t.zoomedOnMarkers},on:{click:t.zoomToMarkers}},[t._v("\n                "+t._s(t.$Labels.MA_Zoom_To_Markers)+"\n            ")]),t._v(" "),s("button",{staticClass:"slds-button slds-button_neutral",on:{click:t.createPolygon}},[t._v("\n                "+t._s(t.$Labels.MA_Draw_Polygon)+"\n            ")])]):t._e(),t._v(" "),t._l(t.markerLayersInfo,(function(t,e){return s("ClusterCard",{key:e,attrs:{layerData:t}})}))],2)])}),[],!1,null,"d9c905c0",null).exports}}]);