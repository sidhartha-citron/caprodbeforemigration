(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[4196],{1216:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var i=s(2423);const{MARemoting:a}=window;class r{static getLiveSummaryAndHistory(e){return new Promise(((t,s)=>{(new i.Z).setAction(a.MapAnythingIORequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([{method:"get",action:"devices/summary",subType:"live/client",version:"v5"},e],(e=>{if(e.success)t(e);else try{const t=JSON.parse(e.errInfo).error.message;s(t)}catch(t){s(e)}}),{escape:!1,buffer:!1})}))}static handleRemoteActionError(e,t,s){e(new Error(s.message))}static sortByProperty(e,t){return e.sort(((e,s)=>e[t]<s[t]?-1:e[t]>s[t]?1:0)),e}static getLiveConfigs(e){return new Promise((t=>{const s={speedLimitUnits:"mph",speedLimitDurationTimeUnits:"Minutes",speedLimitDuration:null,speedLimit:250,configName:"Maps Default Configuration",configId:"ma_defaultConfig",allowedTimeUnits:"Minutes",allowedTime:6e4,allowedDistanceUnits:"feet",allowedDistance:7e5};(new i.Z).setAction(a.getLiveConfigs).setErrorHandler((e=>{console.warn(e),t([s])})).invoke([e],(e=>{const{success:i=!1,data:a=[]}=e;if(i){let e=[];if("string"==typeof a)try{e=JSON.parse(a)}catch(t){e=[]}else Array.isArray(a)&&(e=a);e.length<1&&e.push(s),e.sort(((e,t)=>e.configName<t.configName?-1:e.configName>t.configName?1:0)),t(e)}else t([{speedLimitUnits:"mph",speedLimitDurationTimeUnits:"Minutes",speedLimitDuration:5,speedLimit:65,configName:"Teddy Summary Test",configId:"a3129000000AISqAAO",allowedTimeUnits:null,allowedTime:2,allowedDistanceUnits:"Feet",allowedDistance:15},{speedLimitUnits:"mph",speedLimitDurationTimeUnits:"Minutes",speedLimitDuration:1,speedLimit:5,configName:"All Live",configId:"a3129000000JSQOAA4",allowedTimeUnits:null,allowedTime:1,allowedDistanceUnits:null,allowedDistance:200}])}),{escape:!1,buffer:!1})}))}}},8249:(e,t,s)=>{"use strict";s.d(t,{Z:()=>u});var i=s(7387),a=s(1216),r=s(1023),l=s(5493);const{moment:o,getProperty:n,MASystem:d,MADevice:c,google:m,Plotting:p,MA:h}=window;class u{constructor(){const e=new window.OverlappingMarkerSpiderfier(window.MA.map,{keepSpiderfied:!0});e.addListener("spiderfy",(e=>{e.forEach((e=>{e.spiderfied=!0}))})),e.addListener("unspiderfy",(e=>{e.forEach((e=>{e.spiderfied=!1}))})),this.summaryOptions={},this.timeZone=d.User.timezoneId,this.id=(0,i.ZP)(),this.showIcons=!1,this.routeData={tileKey:null,events:[],summaryEvents:e,startVertice:null,endVertice:null}}setSummaryOptions(e){return this.summaryOptions=e,this}setTimeZone(e){this.timeZone=e}getSummaryEvents(){return this.summaryEvents}getEventTypes(){return this.eventTypes}getSummaryOptions(){return this.summaryOptions}build(){return new Promise(((e,t)=>{a.Z.getLiveSummaryAndHistory(this.summaryOptions).then((s=>{const{data:i={},success:a=!1}=s;a?this.plotLiveHistory(i).then((()=>{e()})).catch((e=>{t(e)})):t(new Error("Unable to get Live Events History"))})).catch((e=>{t(e)}))}))}updateEventTypes(){this.eventTypes=this.eventTypes.map((e=>{let t=0;return this.summaryEvents.forEach((s=>{e===s.formattedEventType&&t++})),{value:e,show:"Location Update"!==e,eventCount:t}}))}prepareSummaryEvents(e,t){const s=[];e.forEach((e=>{const t={};"Location Update"===e.eventType&&(t.formattedTime=o(e.timestamp).tz(this.timeZone).format("h:mm A"),t.timestamp=new Date(e.timestamp).getTime(),t.position={address:{address:n(e,"position.address.address",!1)||""},lat:n(e,"position.lat",!1),lng:n(e,"position.lng",!1)},t.formattedEventType="Location Update",t.eventType=n(e,"eventType",!1),s.push(t))}));let i=0;return t.events.forEach((e=>{const t={stop:"Stop",speeding:"Speeding",fastAcceleration:"Hard Acceleration",hardBrake:"Hard Braking",buttonPress:e.translation||"Button Press"},a={};a.formattedTime=o(e.start).tz(this.timeZone).format("h:mm A"),a.timestamp=new Date(e.start).getTime(),a.position={address:{address:n(e,"position.address.address",!1)||""},lat:n(e,"position.lat",!1),lng:n(e,"position.lng",!1)},a.formattedEventType=t[n(e,"eventType",!1)]||"Location Update",a.eventType=n(e,"eventType",!1)||"Location Update",a.duration=n(e,"duration",!1),a.postedSpeed=n(e,"speedLimit",!1),a.actualSpeed=n(e,"maxSpeed",!1),a.amountOverLimit=n(e,"maxSpeed",!1)-n(e,"speedLimit",!1)||void 0,"mi"===l.Z.units&&(a.postedSpeed=.621371*Number(a.postedSpeed)||void 0,a.actualSpeed=.621371*Number(a.actualSpeed)||void 0,a.amountOverLimit=.621371*Number(a.amountOverLimit)||void 0),"stop"===e.eventType?(i++,a.stopOrder=i,a.stopStartTime=e.start,a.stopEndTime=e.end):a.stopOrder=null,s.push(a)})),this.eventTypes=[...new Set(s.map((e=>e.formattedEventType)))],this.summaryEvents=a.Z.sortByProperty(s,"timestamp"),this}plotLiveHistory(e){return new Promise(((t,s)=>{const{positions:i=[],summary:a={}}=e;0===i.length?s(new Error("No events found")):(this.tileKey=e.key,this.prepareSummaryEvents(i,a),this.updateEventTypes(),this.removeDeviceHistory(),this.plotStarEndVertices(),this.plotHistoryRouterOverlay(),this.plotSummaryEvents(),t())}))}plotStarEndVertices(){const e=new c(this.summaryEvents[0]),t=new c(this.summaryEvents[this.summaryEvents.length-1]),s=new m.maps.Marker({position:e.getPosition(),icon:p.getFirstIcon(),device:e,timezoneId:this.timeZone}),i=new m.maps.Marker({position:t.getPosition(),icon:p.getLastIcon(),device:t,timezoneId:this.timeZone});s.setMap(h.map),i.setMap(h.map),this.routeData.startVertice=s,this.routeData.endVertice=i}plotHistoryRouterOverlay(){r.Z.addRouteTileOverlay(d.Organization.MAIO_URL,this.id,this.tileKey)}plotSummaryEvents(){const e=`${d.Organization.MAIO_URL}/images/marker?color=d50000`,t={stop:"&icon=markerWaypoint&text=",speeding:"&forlegend=false&icon=live_event_speeding_begin",fastAcceleration:"&forlegend=false&icon=live_event_quick_acceleration",hardBrake:"&forlegend=false&icon=live_event_hard_braking",buttonPress:"&forlegend=false&icon=live_event_touch","Location Update":"&forlegend=false&icon=LiveTrackingDot"};this.routeData.summaryEvents.getMarkers().forEach((e=>{e.setMap(null)})),this.routeData.summaryEvents.clearMarkers();const s=new m.maps.LatLngBounds;this.routeData.pathBounds=s;let i=0;this.summaryEvents.forEach((s=>{if(this.eventTypes.find((e=>e.value===s.formattedEventType)).show){i++;const a={url:this.showIcons?e+t[s.eventType]:e+t["Location Update"]};"stop"===s.eventType&&this.showIcons&&(a.url+=s.stopOrder,a.scaledSize={height:38,width:31});const r=new m.maps.Marker({position:{lat:s.position.lat,lng:s.position.lng},icon:a,map:h.map,optimized:!0,zIndex:1});this.routeData.pathBounds.extend({lat:s.position.lat,lng:s.position.lng}),s.marker=r,this.routeData.summaryEvents.addMarker(r)}})),this.routeData.startVertice&&this.routeData.pathBounds.extend(this.routeData.startVertice.getPosition()),this.routeData.endVertice&&this.routeData.pathBounds.extend(this.routeData.endVertice.getPosition()),i>0&&h.map.fitBounds(this.routeData.pathBounds)}removeDeviceHistory(){this.routeData.startVertice&&this.routeData.endVertice&&(this.routeData.startVertice.setMap(null),this.routeData.endVertice.setMap(null)),r.Z.removeTileOverlay(this.id),this.routeData.summaryEvents.getMarkers().forEach((e=>{e.setMap(null)})),this.routeData.summaryEvents.clearMarkers(),h.Map.InfoBubble.hide()}}},2741:(e,t,s)=>{e.exports=s.p+"images/e7f8b9fabe21d9ec504609c1cfefb8bc.svg"},4173:(e,t,s)=>{e.exports=s.p+"images/db7d9ca69c5dbfe3c77d602857a98939.svg"},7087:(e,t,s)=>{e.exports=s.p+"images/45442712971c2ecc3e6a481f63edac1e.svg"},1790:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>I});var i=s(5908),a=s(4549);const{$:r}=window,l={components:{MobileToggle:a.Z},props:{layer:{type:Object,default:()=>{},required:!0}},data:()=>({qid:"",id:"",isLoading:!0,loadingInt:null,timeCatch:null,isChecked:!0}),watch:{isChecked(){this.removeLayer()}},created(){this.qid=this.layer.qid,this.id=this.layer.id},mounted(){this.loadingHack()},methods:{removeLayer(){this.isLoading=!0,this.$emit("destroy",this.qid)},loadingHack(){const e=this.$refs["sfdc-layer"];this.loadingInt=setInterval((()=>{const{classList:t}=e;t.contains("loading")||(clearInterval(this.loadingInt),clearTimeout(this.timeCatch),this.isLoading=!1,this.layer.isLoading=!1)}),500),this.timeCatch=setTimeout((()=>{clearInterval(this.loadingInt)}),3e5)},showSingleView(){const e=r(`#PlottedQueriesTable .savedQuery[qid="${this.qid}"]`);if(e.hasClass("loading"))return;const t=e.data()||{},s={...this.layer,name:t.savedQueryName,baseObjectLabel:t.baseObjectLabel,type:"marker"};this.$bus.$emit("toggle-single-layer-view",!0,s)}}};var o=s(1900);const n=(0,o.Z)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._b({ref:"sfdc-layer",staticClass:"PlottedRowUnit layer-item slds-grid qidLocation",attrs:{id:"ACTIVE_"+e.layer.id,nodetype:e.layer.nodetype,type:e.layer.type}},"div",{"data-id":e.layer.id,qid:e.layer.qid,"perm-create":e.layer.create,"perm-delete":e.layer.delete,"perm-export":e.layer.export,"perm-modify":e.layer.modify,"perm-read":e.layer.read,"perm-setpermissions":e.layer.setpermissions},!1),[s("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_vertical-align-center"},[s("MobileToggle",{attrs:{isDisabled:e.isLoading},model:{value:e.isChecked,callback:function(t){e.isChecked=t},expression:"isChecked"}})],1),e._v(" "),s("div",{staticClass:"layer-nest-click-area layer-item_clickable-area slds-col slds-grid slds-p-left_medium",on:{click:e.showSingleView}},[e._m(0),e._v(" "),s("div",{staticClass:"ma-item-name layer-item_text slds-col slds-align-middle slds-p-vertical_small",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"ma-item-name-title basicinfo-name slds-truncate"},[e._v(e._s(e._f("decode")(e.layer.name)))]),e._v(" "),s("div",{staticClass:"ma-item-name-subtitle basicinfo-baseobjectname layer-item_subtext slds-truncate"},[e._v(e._s(e._f("decode")(e.layer.baseObjectLabel)))]),e._v(" "),e._m(1)]),e._v(" "),e._m(2)]),e._v(" "),s("div",{staticClass:"hidden legend"}),e._v(" "),s("ul",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"renderButtons"},[e._m(3),e._v(" "),e._m(4),e._v(" "),e._m(5),e._v(" "),e._m(6)])])}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-align-middle slds-p-right_medium layer-type-icon ftu-icon-left"},[s("div",{staticClass:"queryIcon ftu-icon-left layer-item_icon",staticStyle:{display:"none"}},[s("span",{staticClass:"ma-icon ma-icon-checkin"})]),e._v(" "),s("div",{staticClass:"layer-icon_spinner queryLoader"},[s("div",{staticClass:"slds-spinner slds-spinner_brand slds-spinner_x-small",attrs:{role:"status"}},[s("span",{staticClass:"slds-assistive-text"},[e._v("Loading")]),e._v(" "),s("div",{staticClass:"slds-spinner__dot-a"}),e._v(" "),s("div",{staticClass:"slds-spinner__dot-b"})])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"hidden ma-item-name-subtitle plottinginfo-wrapper"},[s("div",{staticClass:"status"}),e._v(" "),s("div",{staticClass:" info"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_align-end slds-grid_vertical-align-center"},[t("span",{staticClass:"layer-item_chevron ma-icon ma-icon-chevronright"})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticClass:"drop-menu-item item-selectable",attrs:{onclick:"Plotting.queryActions.renderSelection(this);"}},[s("a",{staticClass:"renderButtons-button markers",attrs:{"data-renderas":"Markers"}},[e._v("Render Markers")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticClass:"drop-menu-item item-selectable",attrs:{onclick:"Plotting.queryActions.renderSelection(this);"}},[s("a",{staticClass:"renderButtons-button cluster",attrs:{"data-renderas":"Cluster"}},[e._v("Render Clusters")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticClass:"drop-menu-item item-selectable",attrs:{onclick:"Plotting.queryActions.renderSelection(this);"}},[s("a",{staticClass:"renderButtons-button heatmap",attrs:{"data-renderas":"Heatmap"}},[e._v("Render Heatmap")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticClass:"drop-menu-item item-selectable",attrs:{onclick:"Plotting.queryActions.renderSelection(this);",role:"presentation"}},[s("a",{staticClass:"renderButtons-button scatter",attrs:{"data-renderas":"Scatter"}},[e._v("Render Scatter")])])}],!1,null,"31c3f975",null).exports;var d=s(2423),c=s(5511);const{MARemoting:m,google:p,MA:h,getProperty:u}=window,y={components:{MobileToggle:a.Z},props:{layer:{type:Object,default:()=>{},required:!0}},data:()=>({qid:"",id:"",optionsVisible:!1,isLoading:!1,markerVisible:!1,hasError:!1,isChecked:!0}),computed:{...(0,i.mapGetters)("layers",{layers__favoriteLayers:"favoriteLayers"}),markers:{get(){return this.layers__favoriteLayers[this.qid].markers}}},watch:{isChecked(){this.removeLayer()}},created(){this.qid=this.layer.qid,this.id=this.layer.id,this.layers__favoriteLayers[this.qid]={markers:[],address:"",id:this.layer.id,qid:this.layer.qid,name:this.layer.name,type:"Favorite"},this.build(this.layer),this.$bus.$on("remove-favorite",this.removeFavoriteLayer)},methods:{...(0,i.mapMutations)("layers",{layers__showSingleLayerViewByQID:"showSingleLayerViewByQID"}),removeLayer(){this.markers.forEach((e=>e.setMap(null))),this.$emit("destroy",this.qid)},removeFavoriteLayer(e){this.qid===e&&this.removeLayer()},build(e){this.isLoading=!0,c.Z.updateLayerAnalytics(e.id).then((()=>{this.$bus.$emit("load-recents-layers")})),this.getLayerInfo(e.id).then((e=>{this.layers__favoriteLayers[this.qid].address=e.maps__Address__c,this.createMarker(e)})).catch((e=>{this.hasError=!0,console.warn(e)})).finally((()=>{this.isLoading=!1}))},getLayerInfo:e=>new Promise(((t,s)=>{const i={action:"getLocationInfo",ajaxResource:"FavoriteLocationsAJAXResources",folderId:e};(new d.Z).setAction(m.processAJAXRequest).setErrorHandler(((e,t)=>{console.warn("err",e);const i=h.isUserLoggedIn(e,t,!1);i&&s(new Error(i)),s(new Error(e))})).invoke([i],(e=>{if(e.success){const i=u(e,"data.locations",!1)||[];if(0===i.length)return void s(new Error("No information found for this layer."));t(i[0])}else s(new Error("Unable to get location information."))}),{escape:!1,buffer:!1})})),calculateTooltipPosition(){const e=this.$refs.rowUnit.getBoundingClientRect(),t=document.getElementsByClassName("layersPanel")[0].getBoundingClientRect(),s=e.left-t.left,i=e.top-t.top,{tooltip:a}=this.$refs;let r=a.offsetHeight,l="";r>=400&&(l+="max-height: 400px; overflow-y: auto;",r=400);const o=i+r,n=document.getElementById("horizontalViewsWrap").offsetHeight,d=this.$refs.tooltipArrow;l+=o>=n?`top: ${i-(o-n)-2}px; left: ${s+436}px`:`top: ${i-20}px; left: ${s+436}px`,a.setAttribute("style",l),d.setAttribute("style",`top: ${i+3}px; left: ${s+426}px`)},createMarker(e){h.Util.loadImage(e.maps__FavoriteMarker__c,"Favorite").then((t=>{const s=new p.maps.Marker({title:e.Name,map:h.map,position:new p.maps.LatLng(parseFloat(e.maps__Latitude__c),parseFloat(e.maps__Longitude__c)),location:{lat:e.maps__Latitude__c,lng:e.maps__Longitude__c,address:e.maps__Address__c},icon:{url:t.imgURL,anchor:new p.maps.Point(10.5,32),scaledSize:{height:32,width:21}},layerType:"favorite-marker",record:{Id:e.Id,description:e.maps__Description__c||""},qid:this.qid});this.markerVisible=!0,p.maps.event.addListener(s,"click",window.favLocation_Click),p.maps.event.addListener(s,"rightclick",window.marker_Context),this.markers.push(s)}))},toggleOptions(){this.optionsVisible=!this.optionsVisible},toggleMarkerVisibility(){this.markerVisible=!this.markerVisible,this.markerVisible?this.markers.forEach((e=>e.setMap(h.map))):this.markers.forEach((e=>e.setMap(null)))},showSingleView(){const e={...this.layer,subText:this.$Labels.MA_Favorite};this.$bus.$emit("toggle-single-layer-view",!0,e)}}},v=(0,o.Z)(y,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._b({staticClass:"layer-item slds-grid FavoriteRowUnit qidLocation",attrs:{id:"ACTIVE_"+e.layer.id,nodetype:e.layer.nodetype,type:e.layer.type}},"div",{"data-id":e.layer.id,qid:e.layer.qid,"perm-create":e.layer.create,"perm-delete":e.layer.delete,"perm-export":e.layer.export,"perm-modify":e.layer.modify,"perm-read":e.layer.read,"perm-setpermissions":e.layer.setpermissions},!1),[s("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_vertical-align-center"},[s("MobileToggle",{attrs:{isDisabled:e.isLoading},model:{value:e.isChecked,callback:function(t){e.isChecked=t},expression:"isChecked"}})],1),e._v(" "),s("div",{staticClass:"layer-nest-click-area layer-item_clickable-area slds-col slds-grid slds-p-left_medium",attrs:{action:"plot-favorite"},on:{click:e.showSingleView}},[s("div",{staticClass:"slds-align-middle slds-p-right_medium"},[e.isLoading?s("div",{staticClass:"layer-icon_spinner"},[e._m(0)]):s("div",{staticClass:"layer-item_icon slds-grid slds-grid_vertical-align-center"},[s("span",{staticClass:"ma-icon ma-icon-favorite"})])]),e._v(" "),s("div",{staticClass:"layer-item_text slds-col slds-align-middle slds-p-vertical_small",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"ma-item-name-title basicinfo-name slds-truncate"},[e._v(e._s(e._f("decode")(e.layer.name)))]),e._v(" "),s("div",{staticClass:"layer-item_subtext ma-item-name-subtitle basicinfo-type slds-truncate"})]),e._v(" "),e._m(1)])])}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"slds-spinner slds-spinner_brand slds-spinner_x-small",attrs:{role:"status"}},[s("span",{staticClass:"slds-assistive-text"},[e._v("Loading")]),e._v(" "),s("div",{staticClass:"slds-spinner__dot-a"}),e._v(" "),s("div",{staticClass:"slds-spinner__dot-b"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_align-end slds-grid_vertical-align-center"},[t("span",{staticClass:"layer-item_chevron ma-icon ma-icon-chevronright"})])}],!1,null,"42b14736",null).exports;var _=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-align-middle slds-p-right_medium layer-type-icon ftu-icon-left"},[i("div",{staticClass:"queryIcon layer-item_icon"},[i("img",{staticClass:"arcGISQueryImage",staticStyle:{display:"none"},attrs:{width:"24",height:"24",src:s(4173)}})]),e._v(" "),i("div",{staticClass:"layer-icon_spinner queryLoader"},[i("div",{staticClass:"slds-spinner slds-spinner_brand slds-spinner_x-small",attrs:{role:"status"}},[i("span",{staticClass:"slds-assistive-text"},[e._v("Loading")]),e._v(" "),i("div",{staticClass:"slds-spinner__dot-a"}),e._v(" "),i("div",{staticClass:"slds-spinner__dot-b"})])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"hidden ma-item-name-subtitle plottinginfo-wrapper"},[s("div",{staticClass:"status"}),e._v(" "),s("div",{staticClass:" info"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_align-end slds-grid_vertical-align-center"},[t("span",{staticClass:"layer-item_chevron ma-icon ma-icon-chevronright"})])}];const g={components:{MobileToggle:a.Z},props:{layer:{type:Object,default:()=>{},required:!0}},data:()=>({qid:"",id:"",isChecked:!0}),watch:{isChecked(){this.removeLayer()}},created(){this.qid=this.layer.qid,this.id=this.layer.id,window.Plotting.plottedIds[this.layer.id]=this.layer},methods:{removeLayer(){this.$emit("destroy",this.qid)},showSingleView(){const e={...this.layer,subText:"ArcGIS Layer",type:"arcgisonline"};this.$bus.$emit("toggle-single-layer-view",!0,e)}}},f=(0,o.Z)(g,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._b({staticClass:"layer-item slds-grid PlottedRowUnit ArcGISLayer ma-folder-item qidLocation",attrs:{id:"ACTIVE_"+e.layer.id,nodetype:e.layer.nodetype,type:e.layer.type}},"div",{"data-id":e.layer.id,qid:e.layer.qid,"perm-create":e.layer.create,"perm-delete":e.layer.delete,"perm-export":e.layer.export,"perm-modify":e.layer.modify,"perm-read":e.layer.read,"perm-setpermissions":e.layer.setpermissions},!1),[s("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_vertical-align-center"},[s("MobileToggle",{model:{value:e.isChecked,callback:function(t){e.isChecked=t},expression:"isChecked"}})],1),e._v(" "),s("div",{staticClass:"layer-nest-click-area layer-item_clickable-area slds-col slds-grid slds-p-left_medium",on:{click:e.showSingleView}},[e._m(0),e._v(" "),s("div",{staticClass:"ma-item-name layer-item_text slds-col slds-align-middle slds-p-vertical_small",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"ma-item-name-title basicinfo-name layername slds-truncate"},[e._v(e._s(e._f("decode")(e.layer.name)))]),e._v(" "),s("div",{staticClass:"layer-item_subtext ma-item-name-subtitle basicinfo-baseobjectname slds-truncate"},[e._v("ArcGIS Layer")]),e._v(" "),e._m(1)]),e._v(" "),e._m(2)])])}),_,!1,null,"320e0acc",null).exports,{$:b}=window,w={components:{MobileToggle:a.Z},props:{layer:{type:Object,default:()=>{},required:!0}},data:()=>({qid:"",id:"",isChecked:!0}),watch:{isChecked(){this.removeLayer()}},created(){this.qid=this.layer.qid,this.id=this.layer.id},methods:{removeLayer(){this.$emit("destroy",this.qid)},showSingleView(){if(b(`#PlottedQueriesTable .DataLayer[qid="${this.qid}"]`).hasClass("loading"))return;const e={...this.layer,subText:"Data Layer"};this.$bus.$emit("toggle-single-layer-view",!0,e)}}},L=(0,o.Z)(w,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._b({staticClass:"PlottedRowUnit-DataLayer layer-item slds-grid ma-folder-item qidLocation",attrs:{id:"ACTIVE_"+e.layer.id,nodetype:e.layer.nodetype,type:e.layer.type}},"div",{"data-id":e.layer.id,qid:e.layer.qid,"perm-create":e.layer.create,"perm-delete":e.layer.delete,"perm-export":e.layer.export,"perm-modify":e.layer.modify,"perm-read":e.layer.read,"perm-setpermissions":e.layer.setpermissions},!1),[s("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_vertical-align-center"},[s("MobileToggle",{model:{value:e.isChecked,callback:function(t){e.isChecked=t},expression:"isChecked"}})],1),e._v(" "),s("div",{staticClass:"layer-nest-click-area layer-item_clickable-area slds-col slds-grid slds-p-left_medium",on:{click:e.showSingleView}},[e._m(0),e._v(" "),s("div",{staticClass:"ma-item-name layer-item_text slds-col slds-align-middle slds-p-vertical_small",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"ma-item-name-title basicinfo-name slds-truncate"},[e._v(e._s(e._f("decode")(e.layer.name)))]),e._v(" "),s("div",{staticClass:"ma-item-name-subtitle basicinfo-baseobjectname layer-item_subtext slds-truncate"},[e._v(e._s(e._f("decode")(e.layer.baseObjectLabel)))]),e._v(" "),e._m(1)]),e._v(" "),e._m(2)]),e._v(" "),s("ul",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"renderButtons"},[e._m(3),e._v(" "),e._m(4)])])}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-align-middle slds-p-right_medium layer-type-icon ftu-icon-left"},[s("div",{staticClass:"queryIcon layer-item_icon",staticStyle:{display:"none"}},[s("span",{staticClass:"ma-icon ma-icon-data-layer"})]),e._v(" "),s("div",{staticClass:"layer-icon_spinner queryLoader"},[s("div",{staticClass:"slds-spinner slds-spinner_brand slds-spinner_x-small",attrs:{role:"status"}},[s("span",{staticClass:"slds-assistive-text"},[e._v("Loading")]),e._v(" "),s("div",{staticClass:"slds-spinner__dot-a"}),e._v(" "),s("div",{staticClass:"slds-spinner__dot-b"})])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"hidden ma-item-name-subtitle plottinginfo-wrapper"},[s("div",{staticClass:"status"}),e._v(" "),s("div",{staticClass:" info"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_align-end slds-grid_vertical-align-center"},[t("span",{staticClass:"layer-item_chevron ma-icon ma-icon-chevronright"})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticClass:"drop-menu-item item-selectable",attrs:{onclick:"MADemographicLayer.renderSelection(this);",role:"presentation"}},[s("a",{staticClass:"renderButtons-button cluster",attrs:{"data-renderas":"Cluster",role:"menuitem"}},[e._v("Render Clusters")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticClass:"drop-menu-item item-selectable",attrs:{onclick:"MADemographicLayer.renderSelection(this);",role:"presentation"}},[s("a",{staticClass:"renderButtons-button heatmap",attrs:{"data-renderas":"Heatmap",role:"menuitem"}},[e._v("HeatMap")])])}],!1,null,"6a90acd5",null).exports,C={components:{MobileToggle:a.Z},props:{layer:{type:Object,default:()=>{},required:!0}},data:()=>({qid:"",id:"",isChecked:!0}),watch:{isChecked(){this.removeLayer()}},created(){this.qid=this.layer.qid,this.id=this.layer.id},methods:{removeLayer(){this.$emit("destroy",this.qid)},showSingleView(){const e={...this.layer,name:this.layer.name?this.layer.name:this.$Labels.MA_SHAPE,subText:this.layer.name?this.$Labels.MA_SHAPE:"",type:"shape"};this.$bus.$emit("toggle-single-layer-view",!0,e)}}},T=(0,o.Z)(C,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._b({staticClass:"PlottedShapeLayer layer-item slds-grid qidLocation",attrs:{id:"ACTIVE_"+e.layer.id,nodetype:e.layer.nodetype,type:e.layer.type}},"div",{"data-id":e.layer.id,"perm-create":e.layer.create,qid:e.layer.qid,"perm-delete":e.layer.delete,"perm-export":e.layer.export,"perm-modify":e.layer.modify,"perm-read":e.layer.read,"perm-setpermissions":e.layer.setpermissions},!1),[s("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_vertical-align-center"},[s("MobileToggle",{model:{value:e.isChecked,callback:function(t){e.isChecked=t},expression:"isChecked"}})],1),e._v(" "),s("div",{staticClass:"layer-nest-click-area layer-item_clickable-area slds-col slds-grid slds-p-left_medium",attrs:{action:"plot-shape"},on:{click:e.showSingleView}},[e._m(0),e._v(" "),e._m(1),e._v(" "),e._m(2)])])}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-align-middle slds-p-right_medium layer-type-icon ftu-icon-left"},[s("div",{staticClass:"queryIcon layer-item_icon",staticStyle:{display:"none"}},[s("span",{staticClass:"ma-icon ma-icon-shape-layer"})]),e._v(" "),s("div",{staticClass:"layer-icon_spinner queryLoader"},[s("div",{staticClass:"slds-spinner slds-spinner_brand slds-spinner_x-small",attrs:{role:"status"}},[s("span",{staticClass:"slds-assistive-text"},[e._v("Loading")]),e._v(" "),s("div",{staticClass:"slds-spinner__dot-a"}),e._v(" "),s("div",{staticClass:"slds-spinner__dot-b"})])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"layer-item_text slds-col slds-align-middle slds-p-vertical_small",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"ma-item-name-title basicinfo-name slds-truncate"},[e._v("Boundary")]),e._v(" "),s("div",{staticClass:"hidden ma-item-name-subtitle basicinfo-type"}),e._v(" "),s("div",{staticClass:"ma-item-name-subtitle basicinfo-totalGeometry layer-item_subtext slds-truncate"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_align-end slds-grid_vertical-align-center"},[t("span",{staticClass:"layer-item_chevron ma-icon ma-icon-chevronright"})])}],!1,null,"4b72da8b",null).exports,{google:M,$:k}=window,x={components:{MobileToggle:a.Z},props:{layer:{type:Object,default:()=>{},required:!0}},data(){return{id:"",isChecked:!0,isLoading:!1,units:"MILES",radius:50,address:"",kmlOptions:[],selectedKML:"",hideMoreOptions:!1,proxType:"Circle",dayOfWeek:0,travelTimeOptions:{hours:"",minutes:""},proxOptions:[{id:"Circle",label:"As the Crow Flies"},{id:"KML",label:"KML"},{id:"travelTime",label:this.$Labels.MA_Travel_Time},{id:"travelDistance",label:this.$Labels.MA_Travel_Distance}],travelDistanceOptions:{units:"MILES",radius:"50"},circleOptions:{units:"MILES",radius:"50"},opacity:"0.6",latitude:"",longitude:"",dayTimeString:"",daysOfWeek:[{label:"Sunday",value:0,shortHand:"S"},{label:"Monday",value:1,shortHand:"M"},{label:"Tuesday",value:2,shortHand:"T"},{label:"Wednesday",value:3,shortHand:"W"},{label:"Thursday",value:4,shortHand:"T"},{label:"Friday",value:5,shortHand:"F"},{label:"Saturday",value:6,shortHand:"S"}],fillColor:"#3083d3",borderColor:"#16325C",traffic:!1,shapeVisible:!1}},computed:{documentsFolderId:()=>`/${window.MASystem.MergeFields.documentsFolderId}`,fileLibraryId:()=>`/${window.MASystem.MergeFields.fileLibraryId}`,showOptionsText(){return this.hideMoreOptions?this.$Labels.MA_Show_Options:this.$Labels.MA_Hide_Options},plottedLayer(){return k(`.layer.proximity[qid="${this.qid}"]`)},qid(){return this.layer.qid},activeDay(){return this.daysOfWeek.find((e=>e.value===this.dayOfWeek))},invertProximityText(){return window.getProperty(window.userSettings||{},"InvertProximity",!1)?"Only show markers outside shape":this.$Labels.LayersTab_Shape_Display_OnlyShowMarkersInside}},watch:{isChecked(){this.removeLayer()}},created(){this.id=this.layer.id;const{defaultSettings:e={}}=this.$store.state,{defaultProximitySettings:t={}}=window.userSettings;e.defaultProximityType.overridable?(this.proxType=t.DefaultProximityType,this.circleOptions.units=t.circleRadiusUnits,this.circleOptions.radius=t.circleRadius,this.travelTimeOptions.hours=t.travelTimeRadiusHours,this.travelTimeOptions.minutes=t.travelTimeRadiusMinutes,this.travelDistanceOptions.units=t.travelDistanceRadiusUnits,this.travelDistanceOptions.radius=t.travelDistanceRadius):(this.proxType=e.defaultProximityType.value,this.circleOptions.units=e.defaultProximityUnits.value,this.circleOptions.radius=e.defaultProximityRadius.value,this.travelTimeOptions.hours=e.defaultProximityHours.value,this.travelTimeOptions.minutes=e.defaultProximityMins.value,this.travelDistanceOptions.units=e.defaultProximityUnits.value,this.travelDistanceOptions.radius=e.defaultProximityRadius.value);const s=new Date;this.dayOfWeek=s.getDay()},mounted(){window.jscolor.init();const{latitude:e,longitude:t,shapeType:s,drawnShape:i,isMapIt:a}=this.layer;if(i)if(this.hideMoreOptions=!0,this.shapeVisible=!0,"Circle"===s){this.proxType="Circle";const s=this.layer.radius,i=this.circleOptions.units;try{const e=Math.round(s*window.unitFactors.METERS[i]*100)/100;this.circleOptions.radius=e}catch(e){console.warn(e,"radius error, falling back to meters"),this.circleOptions.units="METERS",this.circleOptions.radius=s}this.address=`Lat: ${e}\nLong: ${t}`,this.latitude=e,this.longitude=t}else"Polygon"===s&&(this.proxOptions.push({id:"Polygon",label:"Polygon"}),this.proxType="Polygon");else if(e&&t){if(this.address=`Lat: ${e}\nLong: ${t}`,this.latitude=e,this.longitude=t,s&&(this.proxType=s),a){const{radius:e,unit:t}=this.layer;console.log(e),this.proxType="Circle",this.circleOptions.units=t,this.circleOptions.radius=e}this.$nextTick((()=>{this.submitChanges()}))}if(this.layer.drawnShape){const{proxLayer:e}=this.$refs,{fillColor:t,borderColor:s}=this.layer;t&&s&&this.$nextTick((()=>{try{e.querySelector(".color-wrapper .fillcolor").color.fromString(t),e.querySelector(".color-wrapper .bordercolor").color.fromString(s)}catch(e){}}))}},methods:{removeLayer(){this.$emit("destroy",this.qid)},showSingleView(){const e={...this.layer,name:this.$Labels.MA_Boundary,subText:"",type:"boundary"};this.$bus.$emit("toggle-single-layer-view",!0,e)},saveKML(){if(this.selectedKML){const e=this.kmlOptions.find((e=>e.Id===this.selectedKML)),{proxLayer:t}=this.$refs,s=t.getAttribute("qid");this.$bus.$emit("open-modal",{modal:"create-custom-shape",options:{isKML:!0,kmlId:e.Id,qid:s,kmlResourceType:e.ResourceType}})}else window.MAToastMessages.showWarning({message:"Save Error",subMessage:"Please select a kml before saving.",timeOut:5e3})},toggleOptions(){this.hideMoreOptions=!this.hideMoreOptions},clearLatLng(){this.latitude=null,this.longitude=null},setTypeOptions(){let e,t;switch(this.proxType){case"travelDistance":case"travelTime":case"Circle":e="#3083d3",t="#16325C";break;case"Isoline":e="#CCCC22",t="#000000";break;default:e="#22CC22",t="#000000"}this.fillColor=e,this.borderColor=t},removeProxLayer(){this.shapeVisible=!1;try{this.plottedLayer.data("proxObject").centerPoint.setMap(null)}catch(e){}try{k.each(this.plottedLayer.data("proxObjects"),((e,t)=>{try{t.centerPoint.setMap(null)}catch(e){}t.setMap(null)}))}catch(e){}if(this.plottedLayer.data("proxObject")&&"Polygon"!==this.plottedLayer.find(".proximitytype").val()){if(this.plottedLayer.data("proxObject").popupHandle)try{this.plottedLayer.data("proxObject").popupHandle.setMap(null)}catch(e){}try{this.plottedLayer.data("proxObject").setMap(null)}catch(e){console.log(e)}this.plottedLayer.removeData("proxObject")}this.plottedLayer.data("dataLayer")&&this.plottedLayer.data("dataLayer").setMap(null),this.plottedLayer.data("kmlLayer")&&this.plottedLayer.data("kmlLayer").hideDocument()},getAddressString(){return new Promise(((e,t)=>{let s=this.address;if("KML"===this.proxType||"Polygon"===this.proxType)e({latitude:"",longitude:""});else if("string"==typeof s){s=s.trim(),s=s.replace(/\n\s*\n/g,"\n");const i=s.toLowerCase(),a=/^lat: ([^\n]*)\nlong: ([^\n]*)$/;if(a.test(i)){const s=a.exec(i);if(Array.isArray(s)){const t=window.MA.Util.parseNumberString(s[1]),i=window.MA.Util.parseNumberString(s[2]);this.address=`Lat: ${t}\nLong: ${i}`,this.latitude=Number(t),this.longitude=Number(i),e({latitude:this.latitude,longitude:this.longitude})}else t(new Error("Unknown error while parsing the Lat/Lng input."))}else""===s?t(new Error("Address input cannot be blank.")):window.MA.Geocoding.geocode({address:s},(s=>{const{success:i=!1,result:a={}}=s;if(i){const{Latitude:s,Longitude:i}=a;this.latitude=Number(s),this.longitude=Number(i),Number.isNaN(this.latitude)||Number.isNaN(this.longitude)?t(new Error("No valid geocode received.")):e({latitude:this.latitude,longitude:this.longitude})}else t(new Error("Geocode error."))}))}else t(new Error("Invalid address input."))}))},showBoundaryErrorMsg(e){window.MAToastMessages.showError({message:"Boundary Error",subMessage:e,timeOut:0,closeButton:!0})},submitChanges(){this.removeProxLayer(),this.isLoading=!0,this.getAddressString().then((()=>{switch(this.proxType){case"Circle":this.renderCircle();break;case"Polygon":this.renderPolygon();break;case"KML":this.renderKML();break;case"travelTime":case"travelDistance":this.renderTravelData();break;default:console.warn("unknown type")}})).catch((e=>{this.showBoundaryErrorMsg(e.message),this.isLoading=!1}))},renderCircle(){console.log("render circle");const e=Number(this.circleOptions.radius);if(!(!1===Number.isNaN(e)&&e>0))return void this.showBoundaryErrorMsg("Radius must be a positive number");const t=e*window.unitFactors[this.circleOptions.units].METERS;if(this.plottedLayer.find(".js-radiusDistance").removeClass("error"),0===t)return this.plottedLayer.find(".js-radiusDistance").addClass("error"),void(this.isLoading=!1);const s=new M.maps.Circle({map:window.MA.map,center:new M.maps.LatLng(this.latitude,this.longitude),radius:t,layerType:"prox",strokeColor:this.borderColor,strokeWeight:3,strokeOpacity:1,fillColor:this.fillColor,fillOpacity:this.opacity,qid:this.qid});console.log(s);const i=new M.maps.Marker({map:window.MA.map,position:new M.maps.LatLng(this.latitude,this.longitude),title:this.address,icon:{path:M.maps.SymbolPath.CIRCLE,fillColor:"#ffffff",fillOpacity:1,strokeColor:"#000000",strokeWeight:1,scale:4}});s.centerPoint=i,this.plottedLayer.data("proxObject",s),M.maps.event.addListener(s,"click",(e=>{window.proximityLayer_Click({position:e.latLng,type:"circle",shape:s})})),M.maps.event.addListener(s,"rightclick",(e=>{window.Shape_Context.call(s,e)})),this.isLoading=!1,this.shapeVisible=!0,window.ChangeVisibilityWhenCircleIsAdded()},renderPolygon(){this.plottedLayer.data("proxObject")?this.plottedLayer.data("proxObject").setOptions({fillOpacity:this.opacity,fillColor:this.fillColor,strokeColor:this.borderColor}):this.showBoundaryErrorMsg("There is no polygon associated with this layer. In order to create a polygon layer, please use the drawing toolbar on the map."),this.shapeVisible=!0,this.isLoading=!1},renderKML(){const e=`${window.MA.resources.XMLDoc}?docId=${this.selectedKML}`;new window.ZipFile(e,(t=>{const s=t.status.length>0?"KML":"KMZ",i=new window.geoXML3.parser({map:window.MA.map,forceType:s,processStyles:!0,singleInfoWindow:!0,afterParse:()=>{window.ChangeVisibilityWhenCircleIsAdded(),this.isLoading=!1,this.plottedLayer.data("kmlLayer",i),this.shapeVisible=!0},failedParse:()=>{console.warn(`Unable to parse: ${window.MA.resources.XMLDoc}?docId=${this.selectedKML}`),this.showBoundaryErrorMsg("Unable to retreive or parse the KML document."),this.isLoading=!1,this.shapeVisible=!1}});i.parse(e)}))},renderTravelData(){this.hasError=!1;let e=!0;if(e="travelTime"===this.proxType?this.validateTravelTime():this.validateTravelDistance(),!e)return;const t=this.dayOfWeek,s=window.moment().day(t).add(-1,"weeks"),i=`${this.latitude},${this.longitude}`;let a=s;const r={mode:"fastest;car;traffic:disabled",start:`geo!${i}`};if("travelTime"===this.proxType){const e=Number(this.travelTimeOptions.hours),t=Number(this.travelTimeOptions.minutes),i=60*(60*e+t);s.hour(e).minutes(t),r.range=i,r.rangetype="time",a=s.format("YYYY-MM-DDTHH:mm:ss"),r.departure=a}else{const e=Number(this.travelDistanceOptions.radius*window.unitFactors[this.travelDistanceOptions.units].METERS*window.unitFactors.METERS.MILES),t=Math.round(1609.34*e);r.range=t,r.rangetype="distance",a=s.format("YYYY-MM-DDTHH:mm:ss")}window.Plotting.getServiceArea({subType:"core",action:"isoline",version:"1",method:"get"},r).then((e=>{this.handleTravelData(a,e),this.isLoading=!1,this.shapeVisible=!0})).fail((e=>{let t=e.message||"Unknown Error";t.indexOf("endpoint")>-1&&(t=`Unautorized endpoint: ${window.MASystem.Organization.MAIO_URL}`),t=`Unable to get the service area. ${t}`,this.showBoundaryErrorMsg(t),this.isLoading=!1}))},handleTravelData(e,t){const s=[],i=new M.maps.LatLngBounds,a=60*Number(this.travelTimeOptions.hours)+Number(this.travelTimeOptions.minutes),r=Number(this.travelDistanceOptions.radius*window.unitFactors[this.travelDistanceOptions.units].METERS*window.unitFactors.METERS.MILES),l=Math.round(1609.34*r),o=new M.maps.Marker({position:new M.maps.LatLng({lat:this.latitude,lng:this.longitude}),title:this.address||"",icon:{path:M.maps.SymbolPath.CIRCLE,fillColor:"#ffffff",fillOpacity:1,strokeColor:"#000000",strokeWeight:1,scale:4}});i.extend(o.getPosition());const n={isCustom:!0,proximityType:this.proxType,travelTime:"travelTime"===this.proxType?a:"",travelLatitude:this.latitude,travelLongitude:this.longitude,travelDistance:"travelTime"===this.proxType?"":l,travelMode:"car",travelPreference:"fastest",trafficEnabled:"travelTime"===this.proxType&&this.traffic,departure:e};t.shapes.forEach((e=>{const t=e.coordinates,a=new M.maps.Polygon({path:t,geodesic:!0,isTravelGeom:!0,shapeType:this.proxType,fillColor:this.fillColor,fillOpacity:this.opacity,layer:this.plottedLayer,strokeColor:this.borderColor,qid:this.qid,saveData:n});M.maps.event.addListener(a,"click",(e=>{window.proximityLayer_Click({position:e.latLng,type:"Polygon",shape:a})})),M.maps.event.addListener(a,"rightclick",(e=>{window.Shape_Context.call(a,e)})),a.centerPoint=o,s.push(a),i.union(e.bounds),a.setMap(window.MA.map)})),o.setMap(window.MA.map),window.MA.map.fitBounds(i),this.plottedLayer.data("proxObjects",s)},validateTravelDistance(){let e=!0,t="";const s=Number(this.travelDistanceOptions.radius*window.unitFactors[this.travelDistanceOptions.units].METERS*window.unitFactors.METERS.MILES),i=Math.round(1609.34*s);if(Number.isNaN(i)||""===this.address)e=!1,t="All fields must be completed with valid input to continue.";else if(i<=0)e=!1,t="Please enter a distance greater than 0.";else if(i>5e5){let e=Math.round(5e5*window.unitFactors.METERS[this.unit]);e=e>1?e-1:e,t=`Please reduce travel distance. Max travel distance is ${e} ${this.unit}`}return e||this.showBoundaryErrorMsg(t),e},validateTravelTime(){let e=!0,t="";const s=Number(this.travelTimeOptions.hours),i=Number(this.travelTimeOptions.minutes),a=3600*s+60*i;return Number.isNaN(s)&&Number.isNaN(i)||""===this.address?(e=!1,t="All fields must be completed with valid input to continue."):a<=0?(e=!1,t="Please enter a time greater than 0."):a>19800&&(e=!1,t="Please reduce travel time. Max travel time equals 5 hours and 30 minutes."),e||this.showBoundaryErrorMsg(t),e},toggleProximityLayerVisibility(){if(this.shapeVisible){(this.plottedLayer.data("proxObjects")||[]).forEach((e=>{try{e.setMap(window.MA.map)}catch(e){}}));try{this.plottedLayer.data("proxObject").setMap(window.MA.map)}catch(e){}try{this.plottedLayer.data("kmlLayer").showDocument()}catch(e){}}else{(this.plottedLayer.data("proxObjects")||[]).forEach((e=>{try{e.setMap(null)}catch(e){}}));try{this.plottedLayer.data("proxObject").setMap(null)}catch(e){}try{this.plottedLayer.data("kmlLayer").hideDocument()}catch(e){}}}}},E=(0,o.Z)(x,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._b({staticClass:"layer proximity ma-folder-item shapeWrapper qidLocation layer-item slds-grid",attrs:{id:"ACTIVE_"+e.layer.id,type:"shape"}},"div",{"data-id":e.layer.id,qid:e.layer.qid},!1),[s("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_vertical-align-center"},[s("MobileToggle",{model:{value:e.isChecked,callback:function(t){e.isChecked=t},expression:"isChecked"}})],1),e._v(" "),s("div",{staticClass:"layer-nest-click-area layer-item_clickable-area slds-col slds-grid slds-p-left_medium",attrs:{action:"plot-shape"},on:{click:e.showSingleView}},[s("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-align-middle slds-p-right_medium layer-type-icon ftu-icon-left"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"layer-item_icon layer-type-icon ftu-icon-left queryIcon",attrs:{type:"shape"}},[s("span",{staticClass:"ma-icon ma-icon-shape-layer"})]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}],staticClass:"layer-icon_spinner queryLoader"},[e._m(0)])]),e._v(" "),s("div",{staticClass:"layer-item_text slds-col slds-align-middle slds-p-vertical_small",staticStyle:{"min-width":"0"}},[s("div",{staticClass:"ma-item-name-title basicinfo-name"},[e._v(e._s(e._f("decode")(e.$Labels.MA_Boundary)))]),e._v(" "),s("div",{staticClass:"hidden ma-item-name-subtitle basicinfo-type slds-truncate"}),e._v(" "),s("div",{staticClass:"ma-item-name-subtitle basicinfo-totalGeometry layer-item_subtext slds-truncate"})]),e._v(" "),e._m(1)]),e._v(" "),s("div",{staticClass:"singleViewInfo hidden pad-16"},[e._m(2),e._v(" "),s("div",{staticClass:"color-wrapper js-colorOptions"},[s("div",{staticClass:"hidden ma-form-control-wrap color-select"},[s("label",{staticClass:"ma-input-label"},[e._v("Fill")]),e._v(" "),s("input",{ref:"fillColor",staticClass:"color fillcolor prox-style ma-input"})]),e._v(" "),s("div",{staticClass:"hidden ma-form-control-wrap color-select"},[s("label",{staticClass:"ma-input-label"},[e._v("Border")]),e._v(" "),s("input",{ref:"borderColor",staticClass:"color bordercolor prox-style ma-input"})]),e._v(" "),e._m(3)])])])}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"slds-spinner slds-spinner_brand slds-spinner_x-small",attrs:{role:"status"}},[s("span",{staticClass:"slds-assistive-text"},[e._v("Loading")]),e._v(" "),s("div",{staticClass:"slds-spinner__dot-a"}),e._v(" "),s("div",{staticClass:"slds-spinner__dot-b"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_align-end slds-grid_vertical-align-center"},[t("span",{staticClass:"layer-item_chevron ma-icon ma-icon-chevronright"})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"options-wrapper"},[s("div",{staticClass:"select-info"},[s("label",{staticClass:"ma-input-label"},[e._v("Type")]),e._v(" "),s("div",{staticClass:"ma-form-control has-inset-icon--right"},[s("i",{staticClass:"ma-icon ma-icon-down inset-icon--right"}),e._v(" "),s("select",{staticClass:"ma-input proximitytype"},[s("option",{attrs:{value:"Circle"}},[e._v("Circle")]),e._v(" "),s("option",{staticStyle:{display:"none"},attrs:{value:"Polygon"}},[e._v("\n                            Polygon\n                        ")]),e._v(" "),s("option",{attrs:{value:"KML"}},[e._v("KML")]),e._v(" "),s("option",{attrs:{value:"travelTime"}},[e._v("Travel Time")]),e._v(" "),s("option",{attrs:{value:"travelDistance"}},[e._v("Travel Distance")])])])]),e._v(" "),s("div",{staticClass:"prox-option-select"},[s("div",{staticClass:"prox-option"},[s("div",{staticClass:"ma-form-control-wrap js-toggleKML",attrs:{id:"boundary-address"}},[s("label",{staticClass:"ma-input-label",attrs:{for:"textAreaAddressInput"}},[e._v("\n                            Address\n                        ")]),e._v(" "),s("textarea",{staticClass:"ma-input js-address-input",attrs:{id:"textAreaAddressInput",placeholder:"Address...",type:"text"}})]),e._v(" "),s("div",{staticClass:"ma-form-control-wrap js-rowToggle",attrs:{"data-id":"travelDistance::Circle"}},[s("label",{staticClass:"ma-input-label",attrs:{for:"numberVal"}},[e._v("\n                            Radius\n                        ")]),e._v(" "),s("input",{staticClass:"numberVal ma-input js-radiusDistance prox-style",attrs:{id:"numberVal",placeholder:"0",type:"text"}})]),e._v(" "),s("div",{staticClass:"ma-form-control-wrap js-rowToggle",attrs:{"data-id":"travelDistance::Circle"}},[s("label",{staticClass:"ma-input-label"},[e._v("Units")]),e._v(" "),s("div",{staticClass:"ma-form-control has-inset-icon--right"},[s("i",{staticClass:"ma-icon ma-icon-down inset-icon--right"}),e._v(" "),s("select",{staticClass:"ma-input js-radiusUnit"},[s("option",{attrs:{value:"MILES"}},[e._v("Miles")]),e._v(" "),s("option",{attrs:{value:"KM"}},[e._v("Kilometers")]),e._v(" "),s("option",{attrs:{value:"METERS"}},[e._v("Meters")]),e._v(" "),s("option",{attrs:{value:"YARDS"}},[e._v("Yards")]),e._v(" "),s("option",{attrs:{value:"FEET"}},[e._v("Feet")])])])]),e._v(" "),s("div",{staticClass:"ma-form-control-wrap js-rowToggle hidden"},[s("label",{staticClass:"ma-input-label"},[e._v("hours")]),e._v(" "),s("input",{staticClass:"numberVal ma-input radius-hours prox-style"})]),e._v(" "),s("div",{staticClass:"ma-form-control-wrap js-rowToggle hidden"},[s("label",{staticClass:"ma-input-label"},[e._v("minutes")]),e._v(" "),s("input",{staticClass:"numberVal ma-input radius-minutes prox-style"})]),e._v(" "),s("div",{staticClass:"ma-form-control-wrap js-rowToggle hidden"},[s("div",{staticClass:"ma-form-control has-inset-icon--right"},[s("i",{staticClass:"ma-icon ma-icon-down inset-icon--right"}),e._v(" "),s("select",{staticClass:"ma-input options-kml-document"})])])])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ma-form-control-wrap opac-wrapper js-toggleKML"},[s("label",{staticClass:"ma-input-label"},[e._v("Opacity")]),e._v(" "),s("div",{staticClass:"ma-form-control has-inset-icon--right"},[s("i",{staticClass:"ma-icon ma-icon-down inset-icon--right"}),e._v(" "),s("select",{staticClass:"ma-input js-proxOpacity"},[s("option",{attrs:{value:"0.1"}},[e._v("10%")]),e._v(" "),s("option",{attrs:{value:"0.2"}},[e._v("20%")]),e._v(" "),s("option",{attrs:{value:"0.3"}},[e._v("30%")]),e._v(" "),s("option",{attrs:{value:"0.4"}},[e._v("40%")]),e._v(" "),s("option",{attrs:{value:"0.5"}},[e._v("50%")]),e._v(" "),s("option",{attrs:{value:"0.6"}},[e._v("60%")]),e._v(" "),s("option",{attrs:{value:"0.7"}},[e._v("70%")]),e._v(" "),s("option",{attrs:{value:"0.8"}},[e._v("80%")]),e._v(" "),s("option",{attrs:{value:"0.9"}},[e._v("90%")]),e._v(" "),s("option",{attrs:{value:"1"}},[e._v("100%")])])])])}],!1,null,"c1ee63e0",null).exports;var S=s(8249);const{moment:$}=window,O={components:{MobileToggle:a.Z},props:{layer:{type:Object,default:()=>{},required:!0}},data:()=>({id:"",optionsVisible:!1,isLoading:!1,markerVisible:!1,hasError:!1,isChecked:!0,liveHistory:null}),computed:{...(0,i.mapGetters)("layers",{layers__liveTrackingLayers:"liveTrackingLayers"}),summaryOptions(){return{deviceid:this.layer.selectedDeviceId,from:1e3*$.tz(`${this.layer.date.format("YYYY-MM-DD")} ${this.layer.startTime}`,"YYYY-MM-DD HH:mm a",this.layer.timeZone).unix(),to:1e3*$.tz(`${this.layer.date.format("YYYY-MM-DD")} ${this.layer.endTime}`,"YYYY-MM-DD HH:mm a",this.layer.timeZone).unix(),stoppriority:"distance",speedlimitduration:this.getSelectedConfigValue("speedLimitDuration"),speedlimitabove:this.getSelectedConfigValue("speedLimit"),allowedmins:this.getSelectedConfigValue("allowedTime"),allowedfeet:this.getSelectedConfigValue("allowedDistance"),history:!0,color:this.layer.color,opacity:1,snap:!0}},qid(){return this.layer.qid}},watch:{isChecked(){this.removeLayer()}},created(){this.build()},methods:{build(){const e=new S.Z;e.setSummaryOptions(this.summaryOptions),e.setTimeZone(this.layer.timeZone),e.build().then((()=>{this.layers__liveTrackingLayers[this.qid]=e})).catch((e=>{console.warn(e)}))},removeLayer(){this.layers__liveTrackingLayers[this.qid].removeDeviceHistory(),this.$emit("destroy",this.qid)},showSingleView(){const e={...this.layer,subText:this.$Labels.Live_Events_History};this.$bus.$emit("toggle-single-layer-view",!0,e)},getSelectedConfigValue(e){const t=this.layer.config;let s;return t&&(s=t[e],s&&("allowedDistance"===e&&"meters"===t.allowedDistanceUnits&&(s/=.3048),"allowedTime"===e&&"hours"===t.allowedTimeUnits&&(s*=60),"speedLimit"===e&&"kph"===t.speedLimitUnits&&(s*=.62137119),"speedLimitDuration"===e&&"hours"===t.speedLimitDurationTimeUnits&&(s*=60))),s}}},D=(0,o.Z)(O,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",e._b({staticClass:"liveTrackingLayer layer-item slds-grid qidLocation ma-folder-item",attrs:{id:"ACTIVE_"+e.layer.qid,nodetype:e.layer.nodetype,type:e.layer.type}},"div",{"data-id":e.layer.qid,qid:e.layer.qid},!1),[i("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_vertical-align-center"},[i("MobileToggle",{attrs:{isDisabled:e.isLoading},model:{value:e.isChecked,callback:function(t){e.isChecked=t},expression:"isChecked"}})],1),e._v(" "),i("div",{staticClass:"layer-nest-click-area layer-item_clickable-area slds-col slds-grid slds-p-left_medium",on:{click:e.showSingleView}},[i("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-align-middle slds-p-right_medium layer-type-icon ftu-icon-left"},[e.isLoading?i("div",{staticClass:"layer-icon_spinner queryLoader"},[e._m(0)]):i("div",{staticClass:"queryIcon layer-item_icon"},[i("img",{attrs:{src:s(7087)}})])]),e._v(" "),i("div",{staticClass:"ma-item-name layer-item_text slds-col slds-align-middle slds-p-vertical_small",staticStyle:{"min-width":"0"}},[i("div",{staticClass:"ma-item-name-title basicinfo-name slds-truncate"},[e._v(e._s(e._f("decode")(e.layer.name)))]),e._v(" "),i("div",{staticClass:"ma-item-name-subtitle basicinfo-type layer-item_subtext slds-truncate"},[e._v(e._s(e._f("decode")(e.$Labels.Live_Events_History)))])]),e._v(" "),e._m(1)])])}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"slds-spinner slds-spinner_brand slds-spinner_x-small",attrs:{role:"status"}},[s("span",{staticClass:"slds-assistive-text"},[e._v("Loading")]),e._v(" "),s("div",{staticClass:"slds-spinner__dot-a"}),e._v(" "),s("div",{staticClass:"slds-spinner__dot-b"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"slds-p-around_medium slds-grid slds-grid_align-end slds-grid_vertical-align-center"},[t("span",{staticClass:"layer-item_chevron ma-icon ma-icon-chevronright"})])}],!1,null,"8f1d4a16",null).exports,{$:A,MA:q}=window,P={components:{MarkerLayer:n,FavoriteLayer:v,DataLayer:L,ShapeLayer:T,ArcGISLayer:f,BoundaryLayer:E,LiveTrackingLayer:D},data:()=>({showLayerOptions:!1}),computed:{...(0,i.mapGetters)("layers",{layers__plottedLayers:"plottedLayers",layers__getPlottedLayerById:"getPlottedLayerById",layers__favoriteLayers:"favoriteLayers",layers__liveTrackingLayers:"liveTrackingLayers"}),...(0,i.mapGetters)("schedule",{schedule__storedScheduleData:"storedScheduleData"}),doShowEmptyState(){return!this.layers__plottedLayers.length}},created(){this.$bus.$on("add-layer",this.addLayer),this.$bus.$on("get-plotted-routes",this.getPlottedRoutes),this.$bus.$on("get-plotted-layers",this.getPlottedLayers),this.$bus.$on("get-schedule-data",this.getScheduleData),this.$bus.$on("remove-layer",this.removeLayerFromDom),this.layers__setLayersReady()},destroyed(){this.$bus.$off("add-layer"),this.$bus.$off("remove-layer"),this.$bus.$off("get-plotted-routes"),this.$bus.$off("get-plotted-layers")},methods:{...(0,i.mapMutations)("layers",{layers__addPlottedLayer:"addPlottedLayer",layers__removePlottedLayer:"removePlottedLayer",layers__setLayersReady:"setLayersReady"}),addLayer(e,t){this.$bus.$emit("update-layer-tab","tabLayersActive"),this.layers__addPlottedLayer(e),this.$nextTick((()=>{t(this.$refs[`layer-${e.qid}`][0].$el)}))},getPlottedLayers(e){return e(this.layers__plottedLayers)},getScheduleData(e){return e(this.schedule__storedScheduleData)},removeLayerFromDom(e){return new Promise(((t,s)=>{const i=this.layers__plottedLayers.filter((t=>t.qid===e))[0]||{};this.layers__removePlottedLayer(e);let{type:a=""}=i;if(a=a.toLowerCase(),"marker"===a||"live"===a){const s=A(`#PlottedQueriesTable .savedQuery[qid="${e||""}"]`);window.Plotting.mobile.removeQuery(s.addClass("unloading")).then((()=>{t()}))}else if("arcgisonline"===a)window.ArcGIS.plotHelpers.removeLayer(e).then((()=>{t()}));else if("datalayer"===a){const s=A(`#PlottedQueriesTable .DataLayer[qid="${e}"]`);window.MADemographicLayer.RemoveLayerFromDom(s).then((()=>{t()}))}else if("favorite"===a){this.layers__removePlottedLayer(e),this.layers__favoriteLayers[e]&&this.layers__favoriteLayers[e].markers.forEach((e=>e.setMap(null))),t();const s=A(`#PlottedQueriesTable .PlottedShapeLayer[qid="${e}"]`);if(s.data("isParcel")){const e=(s.data()||{}).proxObjects||[];A.each(e,((e,t)=>{try{q.map.data.remove(t[0])}catch(e){console.warn("Parcel removal error",e)}}))}s.find(".ftu-icon-left").hide(),s.find(".loading-icon").show(),s.find(".drop-menu-wrapper,.glyphicon-remove-circle").css("visibility","hidden"),window.removeProximityLayer(s).then((()=>{this.layers__removePlottedLayer(e),t()}))}else if("boundary"===a||"shape"===a){let s;s=A("boundary"===a?`#PlottedQueriesTable .layer.proximity[qid="${e}"]`:`#PlottedQueriesTable .PlottedShapeLayer[qid="${e}"]`),s.data("marker")&&s.data("marker").setMap(null),window.unrenderProximityLayer(s).then((()=>{t()}))}else"livetrackinglayer"===a?(this.layers__liveTrackingLayers[e]&&this.layers__liveTrackingLayers[e].removeDeviceHistory(),t()):(console.warn("Layer type not found",a),s(new Error(`Layer type not found: ${a}`)))}))}}},I=(0,o.Z)(P,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"tabLayersActive"}},[i("div",{staticClass:"ma-folder-content-wrap"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.doShowEmptyState,expression:"!doShowEmptyState"}],staticClass:"momentum-scrolling-y slds-scrollable",attrs:{id:"PlottedQueriesTable"}},e._l(e.layers__plottedLayers,(function(t){return i(t.component,{key:t.qid,ref:"layer-"+t.qid,refInFor:!0,tag:"component",attrs:{layer:t},on:{destroy:e.removeLayerFromDom}})})),1),e._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.doShowEmptyState,expression:"doShowEmptyState"}],staticClass:"slds-grid slds-grid_align-center slds-grid_vertical-align-center",attrs:{id:"onTheMapLayersEmptyState"}},[i("div",{staticClass:"slds-notify_container--inline slds-p-around--large slds-text-align--center empty-state-wrap"},[i("figure",{staticClass:"slds-m-bottom--large"},[i("img",{staticClass:"ma-logo",attrs:{width:"183",height:"183",src:s(2741)}})]),e._v(" "),i("h4",[e._v(e._s(e._f("decode")(e.$Labels.MA_No_Layer_Map)))]),e._v(" "),i("p",[e._v(e._s(e._f("decode")(e.$Labels.MA_No_Layers_Empty_State)))])])])])],1)])}),[],!1,null,"cb967a02",null).exports}}]);