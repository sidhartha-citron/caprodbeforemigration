"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[4241],{1216:(e,t,i)=>{i.d(t,{Z:()=>o});var a=i(2423);const{MARemoting:s}=window;class o{static getLiveSummaryAndHistory(e){return new Promise(((t,i)=>{(new a.Z).setAction(s.MapAnythingIORequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([{method:"get",action:"devices/summary",subType:"live/client",version:"v5"},e],(e=>{if(e.success)t(e);else try{const t=JSON.parse(e.errInfo).error.message;i(t)}catch(t){i(e)}}),{escape:!1,buffer:!1})}))}static handleRemoteActionError(e,t,i){e(new Error(i.message))}static sortByProperty(e,t){return e.sort(((e,i)=>e[t]<i[t]?-1:e[t]>i[t]?1:0)),e}static getLiveConfigs(e){return new Promise((t=>{const i={speedLimitUnits:"mph",speedLimitDurationTimeUnits:"Minutes",speedLimitDuration:null,speedLimit:250,configName:"Maps Default Configuration",configId:"ma_defaultConfig",allowedTimeUnits:"Minutes",allowedTime:6e4,allowedDistanceUnits:"feet",allowedDistance:7e5};(new a.Z).setAction(s.getLiveConfigs).setErrorHandler((e=>{console.warn(e),t([i])})).invoke([e],(e=>{const{success:a=!1,data:s=[]}=e;if(a){let e=[];if("string"==typeof s)try{e=JSON.parse(s)}catch(t){e=[]}else Array.isArray(s)&&(e=s);e.length<1&&e.push(i),e.sort(((e,t)=>e.configName<t.configName?-1:e.configName>t.configName?1:0)),t(e)}else t([{speedLimitUnits:"mph",speedLimitDurationTimeUnits:"Minutes",speedLimitDuration:5,speedLimit:65,configName:"Teddy Summary Test",configId:"a3129000000AISqAAO",allowedTimeUnits:null,allowedTime:2,allowedDistanceUnits:"Feet",allowedDistance:15},{speedLimitUnits:"mph",speedLimitDurationTimeUnits:"Minutes",speedLimitDuration:1,speedLimit:5,configName:"All Live",configId:"a3129000000JSQOAA4",allowedTimeUnits:null,allowedTime:1,allowedDistanceUnits:null,allowedDistance:200}])}),{escape:!1,buffer:!1})}))}}},1319:(e,t,i)=>{i.r(t),i.d(t,{default:()=>d});var a=i(5908),s=i(5261),o=i(1216),l=i(7579);const{moment:n,MASystem:r}=window,c={components:{MobileSelect:l.Z,DateSelectionModal:()=>i.e(9822).then(i.bind(i,314))},data(){return{isLoading:!1,date:n().tz(this.$User.timezoneId),showDateModal:!1,startTime:"00:00",endTime:"23:59",liveConfigs:[],liveConfig:"",timeZoneList:[],timeZoneId:"",selectedColor:"#4986E7",colorOptions:["#4986E7","#000000","#A4BDFC","#46D6DB","#7AE7BF","#51B749","#FBD75B","#FFB878","#FF887C","#DC2127","#DBADFF","#E1E1E1"]}},computed:{...(0,a.mapGetters)("tooltip",{tooltip__queryMetaData:"queryMetaData",tooltip__record:"record"})},created(){this.buildView(),this.buildTimeZones(),this.dateString=this.date.format(this.$User.dateFormat.toUpperCase())},methods:{...(0,a.mapMutations)("mainNavBar",{mainNavBar__updateActiveTab:"updateActiveTab"}),buildView(){this.isLoading=!0;const e=this.tooltip__queryMetaData.id;o.Z.getLiveConfigs(e).then((e=>{this.liveConfigs=e;try{this.liveConfig=e[0].configId}catch(e){}})).finally((()=>{this.isLoading=!1}))},buildTimeZones(){const e=window.getProperty(r,"Organization.timeZoneList",!1);this.timeZoneId=this.$User.timezoneId,Array.isArray(e)?this.timeZoneList=e:(this.timeZoneId="GMT",this.timeZoneList=[{label:"(GMT+00:00) Greenwich Mean Time (GMT)",value:"GMT"}])},setDate(e){this.date.set({date:e.get("date"),month:e.get("month"),year:e.get("year")}),this.dateString=this.date.format(this.$User.dateFormat.toUpperCase())},toggleDateModal(e){this.showDateModal=e},viewFullHistory(){const{device:e}=this.tooltip__record,t={component:"LiveTrackingLayer",type:"LiveTrackingLayer",nodetype:"liveTracking",name:this.tooltip__record.Name,selectedDeviceId:e.deviceId,record:this.tooltip__record,qid:(0,s.x$)(),layerId:this.tooltip__queryMetaData.id,liveLayerQid:this.tooltip__record.qid,startTime:this.startTime,endTime:this.endTime,date:this.date,timeZone:this.timeZoneId,config:this.liveConfigs.filter((e=>e.configId===this.liveConfig))[0],color:this.selectedColor,eventHistory:null,eventList:[]};this.$bus.$emit("hide-tooltip"),this.mainNavBar__updateActiveTab("layers"),this.$bus.$emit("update-layer-tab","tabLayersActive"),this.$bus.$emit("add-layer",t,(()=>{console.log("TODO: show layer after plot?")}))}}},d=(0,i(1900).Z)(c,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ma-tab-content active"},[i("div",{staticClass:"liveTracking device-history-input slds-scope",staticStyle:{padding:"0 16px"}},[i("MobileSelect",{attrs:{options:e.liveConfigs,doDetach:!0,isRequired:!0,hasNoneOption:!1,label:e.$Labels.SUMMARY_CONFIGURATION,keyString:"configId",valueString:"configName"},model:{value:e.liveConfig,callback:function(t){e.liveConfig=t},expression:"liveConfig"}}),e._v(" "),i("div",{staticClass:"ma-form-control-wrap",on:{click:function(t){return e.toggleDateModal(!0)}}},[i("label",{staticClass:"ma-input-label"},[e._v(e._s(e.$Labels.MA_Date))]),e._v(" "),i("div",{staticClass:"ma-form-control icon-right"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.dateString,expression:"dateString"}],staticClass:"ma-datepicker live-input ma-input date-input",attrs:{type:"text",placeholder:"Select a date",disabled:""},domProps:{value:e.dateString},on:{input:function(t){t.target.composing||(e.dateString=t.target.value)}}}),e._v(" "),i("i",{staticClass:"ma-icon ma-icon-event icon-right"})])]),e._v(" "),i("div",{staticClass:"ma-form-control-wrap"},[i("label",{staticClass:"ma-input-label"},[e._v("Start Time")]),e._v(" "),i("div",{staticClass:"ma-form-control icon-right"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.startTime,expression:"startTime"}],staticClass:"live-starttime time-input ma-input live-starttime",attrs:{type:"time"},domProps:{value:e.startTime},on:{input:function(t){t.target.composing||(e.startTime=t.target.value)}}}),e._v(" "),i("i",{staticClass:"ma-icon ma-icon-clock icon-right"})])]),e._v(" "),i("div",{staticClass:"ma-form-control-wrap"},[i("label",{staticClass:"ma-input-label"},[e._v("End Time")]),e._v(" "),i("div",{staticClass:"ma-form-control icon-right"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.endTime,expression:"endTime"}],staticClass:"live-endtime time-input ma-input live-endtim",attrs:{type:"time"},domProps:{value:e.endTime},on:{input:function(t){t.target.composing||(e.endTime=t.target.value)}}}),e._v(" "),i("i",{staticClass:"ma-icon ma-icon-clock icon-right"})])]),e._v(" "),i("MobileSelect",{attrs:{options:e.timeZoneList,doDetach:!0,isRequired:!0,hasNoneOption:!1,label:e.$Labels.TIMEZONE,keyString:"value",valueString:"label"},model:{value:e.timeZoneId,callback:function(t){e.timeZoneId=t},expression:"timeZoneId"}}),e._v(" "),i("div",{staticClass:"ma-form-control-wrap"},[i("label",{staticClass:"ma-input-label"},[e._v("Pick a Color")]),e._v(" "),i("div",{staticClass:"ma-form-control"},[i("div",{staticClass:"tracking-history-content"},[i("div",{staticClass:"tracking-history-forms-full"},[i("div",{staticClass:"live-history-color"},e._l(e.colorOptions,(function(t,a){return i("div",{key:a,staticStyle:{display:"inline-block"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedColor,expression:"selectedColor"}],staticClass:"liveColorInput",attrs:{id:"cor"+a,type:"radio",name:"colorChoice"},domProps:{value:t,checked:e._q(e.selectedColor,t)},on:{change:function(i){e.selectedColor=t}}}),e._v(" "),i("label",{staticClass:"liveColorOption",class:["cor"+(a+1),e.selectedColor===t?"colorIsChecked":""],attrs:{for:"cor"+a}})])})),0)])])])]),e._v(" "),i("div",{staticClass:"ma-form-control-wrap",staticStyle:{"margin-top":"28px"}},[i("div",{staticStyle:{"text-align":"center"}},[i("button",{staticClass:"actionbutton  ma-button ma-button--blue device-history-button live-button",attrs:{"data-action":"Track History"},on:{click:e.viewFullHistory}},[e._v("\n                    Track History\n                ")])])])],1),e._v(" "),e.showDateModal?i("DateSelectionModal",{attrs:{date:e.date},on:{close:function(t){return e.toggleDateModal(!1)},update:e.setDate}}):e._e()],1)}),[],!1,null,null,null).exports},7579:(e,t,i)=>{i.d(t,{Z:()=>s});const a={name:"MASelect",props:{label:{type:String,default:""},options:{type:Object|Array,required:!0},keyString:{type:String,default:"key"},valueString:{type:String,default:"value"},hasNoneOption:{type:Boolean,default:!0},value:{type:String|Number,default:""},default:{type:String|Number,default:""},isRequired:{type:Boolean,default:!1},isInvalid:{type:Boolean,default:!1},placeholder:{type:String,default:""},isMultiSelect:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data(){return{defaultValue:this.default}},computed:{showLabel(){return this.label}},watch:{value(){const e={};e[this.keyString]=this.value,e[this.valueString]=this.getSelectedValue(),this.$emit("change",e)}},methods:{decodeHtml(e){if(!e)return e;const t=window.document.createElement("textarea");return t.innerHTML=e,t.value},getKey(e){return"string"==typeof e||"number"==typeof e?e:e[this.keyString]},getValue(e){return"string"==typeof e||"number"==typeof e?e:e[this.valueString]},isSelected(e){let t=!1;return t=Array.isArray(this.value)?this.value.includes(this.getKey(e)):this.getKey(e)===this.value,t},change(e){e||(e=null);let t=[];for(let i=0;i<e.length;i++){const a=e[i];t.push(a.value)}if(1===t.length){const[e]=t;t=e}this.$emit("input",t)},getSelectedValue(){if(!this.options||!this.options.length)return"";const e=this.options.find((e=>this.getKey(e)===this.value));return e?this.decodeHtml(this.getValue(e)):null},remove(){this.$emit("input",""),this.doHide()}}},s=(0,i(1900).Z)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"slds-form-element",class:{"slds-has-error":e.isInvalid}},[e.showLabel?i("label",{staticClass:"slds-form-element__label"},[e.isRequired?i("abbr",{staticClass:"slds-required",attrs:{title:"required"}},[e._v("*")]):e._e(),e._v("\n        "+e._s(e.decodeHtml(e.label))+"\n    ")]):e._e(),e._v(" "),i("div",{staticClass:"slds-is-relative"},[i("select",e._b({staticClass:"slds-select",staticStyle:{overflow:"auto"},attrs:{placeholder:e.placeholder,disabled:e.disabled},on:{change:function(t){return e.change(t.target.selectedOptions)}}},"select",{multiple:e.isMultiSelect},!1),[e.hasNoneOption?i("option",{attrs:{value:""}},[e._v("\n                -- None --\n            ")]):e._e(),e._v(" "),e._l(e.options,(function(t,a){return i("option",{key:a,domProps:{value:e.getKey(t),selected:e.isSelected(t)}},[e._v("\n                "+e._s(e.getValue(t))+"\n            ")])}))],2),e._v(" "),e._m(0)]),e._v(" "),e.isInvalid?i("div",{staticClass:"slds-form-element__help"},[e._t("errors",(function(){return[e._v("This field is required.")]}))],2):e._e()])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"select-icon"},[t("span",{staticClass:"ma-icon ma-icon-down"})])}],!1,null,null,null).exports}}]);