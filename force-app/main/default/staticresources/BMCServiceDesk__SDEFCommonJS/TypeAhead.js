var selectClientId=0;var currentPosition=0;var currentField;var currentObject;var filterClause;var isCustomUserReference=false;var isAutocomplete=false;var typingTimer;var _typeahead_bylayoutID=null;var typeAheadFieldTop;function queryData(b,g,f,c,k){if(b.value.length>1){var j=getKeyCode(f);if((j==38||j==40||j==13||j==27)&&isConsoleForm()){handleKeyEvent(j,"rf-resultlist",b,"autocompleteDiv")}else{try{currentField=b;currentObject=g;var i="Id,Name";var h="Name ";isCustomUserReference=false;var d="";if(currentConsole=="Incident"){if(typeof(ciId)!=undefined&&ciId!=null&&ciId!="undefined"&&b.id==ciId){d="FKBMC_BaseElement__c"}else{if(typeof(serviceId)!=undefined&&serviceId!=null&&serviceId!="undefined"&&b.id==serviceId){d="FKBusinessService__c";if(!isFlattenedCmdb){i="FKBMC_BaseElement__c,FKBMC_BaseElement__r.Name";h="FKBMC_BaseElement__r.Name ";g="BMC_BusinessService__c"}}else{if(typeof(offeringId)!=undefined&&offeringId!=null&&offeringId!="undefined"&&b.id==offeringId){d="FKServiceOffering__c";if(!isFlattenedCmdb){i="FKBMC_BaseElement__c,FKBMC_BaseElement__r.Name";h="FKBMC_BaseElement__r.Name ";g="BMC_BusinessService__c"}}}}}if(g=="User"){isCustomUserReference=(k&&k==true)?true:false;i+=",Username, Account_ID__c, Account_Name__c, VIP__c, SmallPhotoUrl ";if(typeof staffId!="undefined"&&b.id==staffId){h="Staff"}}if(g=="Group"){i="SobjectType, Queue.Id, Queue.Email, Queue.Type, Queue.Name, QueueId";h="";if(currentConsole=="Incident"){h="Incident__c"}else{if(currentConsole=="Task"){h="Task__c"}else{if(currentConsole=="Problem"){h="Problem__c"}else{if(currentConsole=="Change Request"){h="Change_Request__c"}else{if(currentConsole=="Broadcast"){h="Broadcasts__c"}else{if(currentConsole=="Release"){h="Release__c"}}}}}}}filterClause=getFilterCondition(false,currentObject,"",d,b.id);currentObject=g;var a=new Object();if(currentConsole==""||currentConsole=="CMDB_InstanceEditor"||currentConsole=="CMDBLISTVIEW"){if(currentLookupId.toLowerCase()==("LookupIdBtn"+orgNamespace+"fkbusinessservice__c").toLowerCase()){g+=String.fromCharCode(172)+"BusinessService";filterClause=getUrlParameter("InstanceID")}if(currentLookupId.toLowerCase()==("LookupIdBtn"+orgNamespace+"fklocation__c").toLowerCase()){g+=String.fromCharCode(172)+"Location";filterClause=getUrlParameter("InstanceID")}if(currentLookupId.toLowerCase()==("LookupIdBtn"+orgNamespace+"fkmodel__c").toLowerCase()){g+=String.fromCharCode(172)+"Model";filterClause=currentClassName}if(currentObject.toLowerCase()=="Account".toLowerCase()){filterClause="active_custom";if(currentLookupId.toLowerCase()==("LookupIdBtn"+orgNamespace+"vendor__c").toLowerCase()){filterClause+=String.fromCharCode(172)+"acc_ven"}else{if(currentLookupId.toLowerCase()==("LookupIdBtn"+orgNamespace+"service_provider__c").toLowerCase()){filterClause+=String.fromCharCode(172)+"acc_sp"}}}}else{if(currentConsole=="searchAndLinkInFilter"){if(referencedObjName.toLowerCase()==(orgNamespace+"fkbusinessservice__c").toLowerCase()){g+=String.fromCharCode(172)+"BusinessService";filterClause=getUrlParameter("InstanceID")}if((referencedObjName.toLowerCase()=="bmc_baseelement__c")&&(k.toLowerCase().replace(orgNamespace.toLowerCase(),""))=="fklocation__c"){g+=String.fromCharCode(172)+"Location";filterClause=getUrlParameter("InstanceID")}}else{if(currentConsole=="model"){if(selectedApiName.toLowerCase()==(orgNamespace+"fklocation__c").toLowerCase()){g+=String.fromCharCode(172)+"Location"}else{if(selectedApiName.toLowerCase()==(orgNamespace+"fkbusinessservice__c").toLowerCase()){g+=String.fromCharCode(172)+"BusinessService"}}filterClause=""}else{if(currentConsole.toLowerCase()=="incident"){if(currentObject.toLowerCase()=="srm_requestdefinition__c"){if(currentField.id==document.getElementById(getHTMLInputID(orgNamespace+"FKRequestDefinition__c")).id){c+=String.fromCharCode(216)+"true"}else{c+=String.fromCharCode(216)+"false"}}}}}}if(filterClause==undefined){filterClause=""}if(_typeahead_bylayoutID){a.layoutid=_typeahead_bylayoutID}if(currentObject&&currentObject.toLowerCase()=="bmc_baseelement__c"){if(typeof(readAccessClassIds)!="undefined"){a.readAccessClassIds=readAccessClassIds}if(typeof(readAccessRBAClassIds)!="undefined"){a.readAccessRBAClassIds=readAccessRBAClassIds}}Visualforce.remoting.Manager.invokeAction(_RemotingActions.getLookupFieldData,g,b.value,filterClause,i,h,c,a,function(m,q){var l=document.getElementById("autocompleteDiv");l.style.display="block";if(currentConsole=="searchAndLinkInFilter"){setDivPosition1()}else{var p=setDivPosition(b);typeAheadFieldTop=p[1];if(typeof userLanguage!="undefined"&&userLanguage=="iw"&&typeof parentContainerId!="undefined"){var n=document.getElementById(parentContainerId);if(n){var r=n.offsetWidth-b.offsetWidth-p[0]+17;l.style.right=r+"px"}}else{l.style.left=p[0]+0+"px";try{if(((typeof(isLightningExperience)!="undefined"&&isLightningExperience==true||isLightningExperience=="true")||(typeof(calledFromConsoleListViewPage)!="undefined"&&calledFromConsoleListViewPage))&&(typeof(FilterObjectName)!="undefined"&&FilterObjectName)){l.style.left=p[0]+7+"px"}}catch(o){l.style.left=p[0]+0+"px"}}}if(g=="User"&&isCustomUserReference==false){if(currentConsole!="CMDB_InstanceEditor"&&currentConsole!=""&&currentConsole!="model"&&currentConsole!="searchAndLinkInFilter"&&currentConsole!="location"){VIPClientIcon(false)}}if(currentConsole=="Incident"||currentConsole=="Task"||currentConsole=="Problem"||currentConsole=="Broadcast"||currentConsole=="Release"||currentConsole=="Change Request"||currentConsole=="CMDBLISTVIEW"||currentConsole=="CMDB_InstanceEditor"||currentConsole=="serviceOutage"){populateResultList(m,"rf-resultlist","autocompleteDiv",b,f)}else{findAutoOption(m,"selectAutoOptions","autocompleteDiv",b,f)}},{escape:false})}catch(e){}}}else{document.getElementById("autocompleteDiv").style.visibility="hidden";clearResultList()}}function setTypeAheadForLookups(){try{var a=false;var e="";var d=getElementsByClassName("RFlookupClass");if(d.length>0){for(var f=0;f<d.length;f++){(function(h){var l=d[h];if(l.type=="text"){var c="";if(l.id=="owner_Name"){c="00G"}else{if(typeof staffId!=="undefined"&&l.id==staffId){c="005"}else{c=document.getElementById(l.id+"_lktp").value}}a=true;for(var g=0;g<prefixMap.length;g++){if(c==prefixMap[g][0]){var k=prefixMap[g][1];if(k=="Case"||k=="Solution"||k=="Idea"){break}if(l.addEventListener){l.addEventListener("keyup",function(j){clearTimeout(typingTimer);var i=this;typingTimer=setTimeout(function(){if(fieldApiName!=null&&fieldApiName!=undefined&&fieldApiName!=""){var p=orgNamespace.length;if(fieldApiName.indexOf(orgNamespace)!=-1){fieldApiName=fieldApiName.substring(p,fieldApiName.length)}fieldApiName=fieldApiName.toLowerCase();var n=getFilterQueryString(fieldApiName);n=decodeURIComponent(n);var m=prefixMap[g][1];var o=getKeyCode(j);if((o==38||o==40||o==13||o==27)&&isConsoleForm()){handleKeyEvent(o,"rf-resultlist",i,"autocompleteDiv")}else{queryData(i,prefixMap[g][1],j,n)}}},300,j,i)},"false")}else{if(l.attachEvent){l.attachEvent("onkeyup",function(j){clearTimeout(typingTimer);var i=this;typingTimer=setTimeout(function(){var p=orgNamespace.length;if(fieldApiName!=null&&fieldApiName!=undefined&&fieldApiName!=""){if(fieldApiName.indexOf(orgNamespace)!=-1){fieldApiName=fieldApiName.substring(p,fieldApiName.length)}fieldApiName=fieldApiName.toLowerCase();var n=getFilterQueryString(fieldApiName);n=decodeURIComponent(n);var m=prefixMap[g][1];var o=getKeyCode(j);if((o==38||o==40||o==13||o==27)&&isConsoleForm()){handleKeyEvent(o,"rf-resultlist",i,"autocompleteDiv")}else{queryData(i,prefixMap[g][1],j,n)}}},300,j,i)})}}break}}}})(f)}}}catch(b){}}function initiateTypeAhead(b,e,a){if(a){if(a.formLayoutId){_typeahead_bylayoutID=a.formLayoutId}}var c=document.getElementById(b);if(!c){var f=document.body;if(typeof e!=="undefined"){f=document.getElementById(e)}var c=document.createElement("DIV");c.id=b;c.className="rfDPL-auto-complete-div";var d=document.createElement("UL");d.id="rf-resultlist";d.className="rfDPL-auto-complete-list";d.style.width="auto !important";d.addEventListener("mousedown",function(){isAutocomplete=true});c.appendChild(d);f.appendChild(c)}setTypeAheadForLookups();if(document.addEventListener){document.addEventListener("click",function(){if(isAutocomplete!="undefined"&&isAutocomplete!=undefined&&isAutocomplete){disableAutoDiv()}})}else{if(document.attachEvent){document.attachEvent("onclick",function(){if(isAutocomplete!="undefined"&&isAutocomplete!=undefined&&isAutocomplete){disableAutoDiv()}})}}}function populateResultList(q,y,g,h,N){resultSetCategory=q;if(resultSetCategory===null){return}clientData=[];if(currentConsole=="Incident"&&currentObject=="User"&&currentField.id!=staffId&&!isCustomUserReference&&typeof clientData!="undefined"&&q.length==1){clientData=q}var c=document.getElementById(y);c.scrollTop="0px";var m=document.getElementById(g);isAutocomplete=false;iKeyCodeEvt=N.keyCode||N.which||N.keyChar||"";currentField=h;if(iKeyCodeEvt!=""&&iKeyCodeEvt!=undefined&&iKeyCodeEvt==13){selectPosition(c,g,currentPosition);return}var G=0;var n=0;var I=0;RemedyForceHTMLProcessor.clearHTML(c);if(typeof queueId!=="undefined"&&currentObject==="User"&&queueId!==null&&queueId!==""&&currentField.id===staffId&&resultSetCategory.length>0){document.getElementById(g).style.visibility="visible";var k=document.createElement("li");var r=document.getElementById("owner_Name").value;if(r===null||r===""){var F=document.getElementById(getHTMLInputID("OwnerId"));if(F!==null&&F!==""){r=F.value}}var o=membersOf+" "+r;var p="queuemebertxt";k.setAttribute("id",p);k.setAttribute("style","background-color:#f0f0f0;");k.setAttribute("value",o);k.setAttribute("title",o);k.className="rfDPL-simple-blade";appendText(k,o,h.value);c.appendChild(k);I=32}if(h.value.length>1){var H=null;for(var L=0;L<resultSetCategory.length;L++){document.getElementById(g).style.visibility="visible";H=document.createElement("li");H.addEventListener("mouseover",function(O){var i=O.target.getAttribute("rf-position");if(i){highlightItem(parseInt(i),"mouseover");currentPosition=i}});var o,p;if(currentObject=="BMC_BusinessService__c"&&currentConsole=="Incident"){o=resultSetCategory[L][orgNamespace+"FKBMC_BaseElement__r"].Name;p=resultSetCategory[L][orgNamespace+"FKBMC_BaseElement__r"].Id}else{if(currentObject==="Group"){o=resultSetCategory[L].Queue.Name;p=resultSetCategory[L].Queue.Id}else{o=resultSetCategory[L].Name;p=resultSetCategory[L].Id}}H.setAttribute("id",p);H.setAttribute("title",o);H.addEventListener("click",function(){SelectListValue(this,typeAheadDivId)});if(typeof staffId!=="undefined"&&currentObject=="User"&&currentField.id===staffId){createUserBlade(false,H,h.value,resultSetCategory[L])}else{if(currentObject=="User"){createUserBlade(false,H,h.value,resultSetCategory[L])}else{H.className="rfDPL-simple-blade";appendText(H,o,h.value);if(n<o.length){n=o.length}}}H.setAttribute("rf-position",L);c.appendChild(H);G++}if(currentObject==="User"&&typeof(isNewIncident)!=="undefined"&&isNewIncident==="true"&&createClient==="true"&&currentConsole==="Incident"&&currentField.id!==staffId){document.getElementById(g).style.visibility="visible";var K=document.createElement("li");o="< "+lblCreateNewClient+" >";p=lblCreateNewClient;K.setAttribute("id",p);K.setAttribute("title",o);K.setAttribute("rf-position",resultSetCategory.length);K.addEventListener("click",function(){SelectListValue(this,typeAheadDivId)});createUserBlade(true,K);c.appendChild(K);if(n<o.length){n=o.length}G++}var v=c.children;var z="auto";if(v.length>0){var A,B,E;n=(n*6)+20;var t=window.getComputedStyle(h);var C=parseFloat(t.getPropertyValue("width"),10);var j=parseFloat(t.getPropertyValue("padding-left"),10)+parseFloat(t.getPropertyValue("padding-right"),10);var f=window.location.href;if(f.indexOf("/apex/CIAssetSlideIn")!=-1){E=C}else{E=C+j}if(navigator.userAgent.toLowerCase().indexOf("msie")>-1){A=(G*20)+2+I;B=(G*13)+2;if(n<204){E=204+"px"}else{E="auto !important"}}else{var s=E*0.95/0.7;if(s>600){s=600}if(currentObject=="User"){A=(G*50)+I;s=E+23}else{A=(G*32)+I}B=(G*13)+5}if(currentConsole!=="searchAndLinkInFilter"){if(currentObject=="User"){if(A>225){A=225}}else{if(A>208){A=208}}if(v.length<=4){z="hidden"}c.setAttribute("style","width: auto; height: "+A+"px; min-width: "+E+"px; max-width: "+s+"px; overflow-y:"+z)}else{if(n>150){B=B+20+"px"}else{B=B+"px"}c.setAttribute("style","height: "+B+";width:150px;overflow:auto;")}try{if(((typeof isLightningExperience!="undefined"&&isLightningExperience.toString()=="true")||(typeof calledFromConsoleListViewPage!="undefined"&&calledFromConsoleListViewPage))&&(typeof FilterObjectName!="undefined"&&FilterObjectName)){m.style.top=typeAheadFieldTop+h.offsetHeight+56+"px"}else{if(typeof(FilterObjectName)!="undefined"&&FilterObjectName){m.style.top=typeAheadFieldTop+h.offsetHeight+"px"}else{var J;if(currentConsole=="Incident"||currentConsole=="Task"||currentConsole=="Problem"||currentConsole=="Broadcast"||currentConsole=="Release"||currentConsole=="Change Request"){J=document.getElementById("formoutputpanel").getBoundingClientRect()}else{if(currentConsole=="CMDB_InstanceEditor"){J=document.getElementById("ciTabPanel").getBoundingClientRect()}}if(J){var u=h.getBoundingClientRect();var l=c.getBoundingClientRect();var w=u.bottom;var e=J.bottom;var D=l.height;if((e-w)>D){m.style.top=typeAheadFieldTop+h.offsetHeight+"px"}else{if((w-h.offsetHeight)>D){m.style.top=typeAheadFieldTop-D+"px"}else{m.style.top=typeAheadFieldTop+h.offsetHeight+"px"}}}else{m.style.top=typeAheadFieldTop+h.offsetHeight+"px"}}}}catch(M){m.style.top=typeAheadFieldTop+h.offsetHeight+"px"}}else{c.style.height="0px";n=0;document.getElementById(g).style.visibility="hidden"}}else{n=0;document.getElementById(g).style.visibility="hidden"}if(typeof queueId!=="undefined"&&currentObject==="User"&&queueId!==null&&queueId!==""&&currentField.id===staffId&&resultSetCategory.length>0){currentPosition=0}if(window.document.body!==null&&typeof(window.document.body)!=="undefined"){var d=m.style.left.substring(0,m.style.left.length-2);var E=c.style.width.substring(0,c.style.width.length-2);if(window.document.body.clientWidth<parseInt(d)+parseInt(E)){var b=window.document.body.clientWidth-E-10;m.style.left=b+"px"}}var x;if(v){x=v.length}if(currentObject=="User"&&x!=0&&x<=2){if(currentConsole=="Incident"&&typeof(isNewIncident)!="undefined"&&isNewIncident=="true"&&createClient=="true"){var a=v[lblCreateNewClient];if(typeof(a)!="undefined"){x=x-1}}if(x==1&&typeof q[0]!="undefined"&&(q[0].Name.toLowerCase()==currentField.value.toLowerCase()||q[0].Username.toLowerCase()==currentField.value.toLowerCase())){selectPosition(c,g,currentPosition);return}}handleKeyEvent(iKeyCodeEvt,"rf-resultlist",h,"autocompleteDiv")}function addClass(b,a){if(b.classList){b.classList.add(a)}else{b.className+=" "+a}}function removeClass(b,a){if(b.classList){b.classList.remove(a)}else{b.className=b.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")}}function highlightItem(a,c){var f=document.getElementById("rf-resultlist");var e=f.children;if(e.length>0){for(var b=0;b<e.length;b++){var g=e[b];var d=g.getAttribute("rf-position");if(d){if(a===parseInt(d)){addClass(g,"rfDPL-selected-item");if(typeof c!=="undefined"&&c==="keyboard"){f.scrollTop="0px";f.scrollTop=(g.offsetTop+g.clientHeight)-f.clientHeight}}else{removeClass(g,"rfDPL-selected-item")}}}}}function findAutoOption(r,t,n,d,o){resultSetCategory=r;if(resultSetCategory==null){return}if(typeof staffId=="undefined"){staffId=" "}clientData=[];if(currentConsole=="Incident"&&currentObject=="User"&&currentField.id!=staffId&&!isCustomUserReference&&typeof clientData!="undefined"&&r.length==1){clientData=r}var a=document.getElementById(t);var e=document.getElementById(n);isAutocomplete=false;if(currentObject=="User"&&currentField.id!=staffId&&!isCustomUserReference){var z=a.length;if(currentConsole=="Incident"&&z==2){var F="< "+lblCreateNewClient+" >";if(a[1].value==F){z=z-1}}if(z==1&&typeof r[0]!="undefined"&&(r[0].Name.toLowerCase()==currentField.value.toLowerCase()||r[0].Username.toLowerCase()==currentField.value.toLowerCase())){SelectAutoValue(a,n);return}}try{iKeyCodeEvt=o.keyCode||o.which||o.keyChar||""}catch(A){iKeyCodeEvt=""}currentField=d;if(iKeyCodeEvt!=""&&iKeyCodeEvt!=undefined&&iKeyCodeEvt==13){SelectAutoValue(a,n);return}var p=escSpeChars(d.value);var m=0;var j=0;var D=0;var E="";var x=resultSetCategory.length;a.options.length=0;if(typeof queueId!="undefined"&&currentObject=="User"&&queueId!=null&&queueId!=""&&currentField.id==staffId&&resultSetCategory.length>0){document.getElementById(n).style.visibility="visible";var l=document.createElement("option");var h=document.getElementById("owner_Name").value;if(h==null||h==""){var w=document.getElementById(getHTMLInputID("OwnerId"));if(w!=null&&w!=""){h=w.value}}var q=membersOf+" "+h;var C="queuemebertxt";l.setAttribute("id",C);l.setAttribute("style","text-shadow: 0px 0px 0px black; font-family: Arial,Helvetica,sans-serif;background-color:#f0f0f0;padding-top:2px;padding-bottom:2px;");l.setAttribute("value",q);l.setAttribute("title",q);l.appendChild(document.createTextNode(q));a.appendChild(l);D=4;a.selectedIndex=1;if(j<q.length+2){j=q.length+2}m++}if(d.value.length>0){var B=null;for(var v=0;v<resultSetCategory.length;v++){document.getElementById(n).style.visibility="visible";B=document.createElement("option");var q,C;if(currentObject=="BMC_BusinessService__c"&&currentConsole=="Incident"){q=resultSetCategory[v][orgNamespace+"FKBMC_BaseElement__r"].Name;C=resultSetCategory[v][orgNamespace+"FKBMC_BaseElement__r"].Id}else{if(currentObject=="Group"){q=resultSetCategory[v].Queue.Name;C=resultSetCategory[v].Queue.Id}else{q=resultSetCategory[v].Name;C=resultSetCategory[v].Id}}B.setAttribute("id",C);if(currentConsole==""&&currentLookupId.toLowerCase()==("LookupIdBtn"+orgNamespace+"fklocation__c").toLowerCase()){var u=resultSetCategory[v][orgNamespace+"City__c"];if(!u){u=""}else{u=", "+u}var s=resultSetCategory[v][orgNamespace+"Country__c"];if(!s){s=resultSetCategory[v][orgNamespace+"CountryCode__c"];if(!s||s.toLowerCase()=="none"){s=""}else{s=", "+s}}else{s=", "+s}B.setAttribute("value",resultSetCategory[v].Name);B.setAttribute("title",resultSetCategory[v].Name+u+s);B.appendChild(document.createTextNode(resultSetCategory[v].Name+u+s));E=document.createTextNode(resultSetCategory[v].Name+u+s)}else{if(typeof staffId!="undefined"&&currentObject=="User"&&currentField.id==staffId){B.setAttribute("value",resultSetCategory[v].Username);B.setAttribute("title",q+" ("+resultSetCategory[v].Username+")");B.appendChild(document.createTextNode(q+" ("+resultSetCategory[v].Username+")"));E=document.createTextNode(q+" ("+resultSetCategory[v].Username+")")}else{if(currentObject=="User"){B.setAttribute("value",resultSetCategory[v].Name);B.setAttribute("title",q+" ("+resultSetCategory[v].Username+" )");B.appendChild(document.createTextNode(q+" ("+resultSetCategory[v].Username+" )"));E=document.createTextNode(q+" ("+resultSetCategory[v].Username+" )")}else{B.setAttribute("value",q);B.setAttribute("title",q);B.appendChild(document.createTextNode(q));E=q}}}a.appendChild(B);if(j<E.length){j=E.length}m++}if(currentObject=="User"&&typeof(isNewIncident)!="undefined"&&isNewIncident=="true"&&createClient=="true"&&currentConsole=="Incident"&&currentField.id!=staffId){document.getElementById(n).style.visibility="visible";var k=document.createElement("option");q="< "+lblCreateNewClient+" >";C=lblCreateNewClient;k.setAttribute("id",C);k.setAttribute("value",q);k.setAttribute("title",q);k.appendChild(document.createTextNode(q));a.appendChild(k);if(j<q.length){j=q.length}m++}if(a.options.length>0){var y,f;var c;j=(j*6)+20;if(navigator.userAgent.toLowerCase().indexOf("msie")>-1){y=(m*13)+2+D+"px";f=(m*13)+2;if(navigator.userAgent.toLowerCase().indexOf("msie 7")>-1){y=(m*15)+4+D+"px";f=(m*15)+4}if(j<204){c=204+"px"}else{c="auto !important"}}else{y=(m*13)+5+D+"px";f=(m*13)+5;if(j<204){c=204+"px"}else{c="auto !important"}}if(currentConsole!="searchAndLinkInFilter"){a.setAttribute("style","height: "+y+"; width: "+c)}else{if(j>150){f=f+20+"px"}else{f=f+"px"}a.setAttribute("style","height: "+f+";width:150px;overflow:auto;")}}else{a.style.height="0px";j=0;document.getElementById(n).style.visibility="hidden"}}else{j=0;document.getElementById(n).style.visibility="hidden"}if((a.selectedIndex==-1||a.selectedIndex==0)&&m>selectClientId){a.selectedIndex=selectClientId}else{a.selectedIndex=0}if(typeof queueId!="undefined"&&currentObject=="User"&&queueId!=null&&queueId!=""&&currentField.id==staffId&&resultSetCategory.length>0){a.selectedIndex=1}if(window.document.body!=null&&typeof(window.document.body)!="undefined"){var g=e.style.left.substring(0,e.style.left.length-2);var c=a.style.width.substring(0,a.style.width.length-2);if(window.document.body.clientWidth<parseInt(g)+parseInt(c)){var b=window.document.body.clientWidth-c-10;e.style.left=b+"px"}}e.style.top=typeAheadFieldTop+d.offsetHeight+"px";switch(iKeyCodeEvt){case 38:if(selectClientId>0){a.selectedIndex=selectClientId-1}selectClientId--;break;case 40:if(selectClientId<a.options.length-1){a.selectedIndex++;selectClientId++}else{a.selectedIndex=selectClientId}break;case 13:currentField=d;SelectAutoValue(a,n);break;case 27:d.value="";disableAutoDiv();break}}function SelectAutoValue(l,e){var k=l.selectedIndex;var f="";if(currentConsole==""||currentConsole=="CMDB_InstanceEditor"){if(currentObject=="User"){currentField.value=j=resultSetCategory[k].Username;f=currentField.id.replace("username","id")}else{currentField.value=j=resultSetCategory[k].Name;f=currentField.id.replace("name","id")}var g=parseInt(f.substring(f.lastIndexOf("_")+1))+1;f=f.replace(f.substring(f.lastIndexOf("_")+1),g);document.getElementById(f).value=resultSetCategory[k].Id;document.getElementById(e).style.visibility="hidden";if(currentObject!=undefined&&currentObject=="Model__c"){applyModelAttribute(resultSetCategory[k].Id)}}else{if(currentConsole=="model"){if(currentObject=="User"){currentField.value=j=resultSetCategory[k].Username}else{currentField.value=j=resultSetCategory[k].Name}document.getElementById("referenceID").value=resultSetCategory[k].Id;document.getElementById(e).style.visibility="hidden";lookupSelectedValue=currentField.value;lookupSelectedId=document.getElementById("referenceID").value;validateValue()}else{if(currentConsole=="location"||currentConsole=="modelform"){if(currentObject=="User"){currentField.value=j=resultSetCategory[k].Username}else{currentField.value=j=resultSetCategory[k].Name}document.getElementById(currentField.id+"_lkid").value=resultSetCategory[k].Id;document.getElementById(currentField.id+"_lkold").value=currentField.value;document.getElementById(e).style.visibility="hidden"}else{if(currentConsole=="searchAndLinkInFilter"){if(currentObject=="User"){currentField.value=j=resultSetCategory[k].Username}else{currentField.value=j=resultSetCategory[k].Name}f=currentField.id.replace("LookUpText","inputHidden");document.getElementById(f).value=resultSetCategory[k].Id;document.getElementById(e).style.visibility="hidden";lookupSelectedValue=currentField.value;lookupSelectedId=document.getElementById(f).value}else{var h="";var r=resultSetCategory.length;var n="";var c="";if(k>-1){h=l.options[k];if(currentObject!=undefined&&currentObject=="User"){if(resultSetCategory[k]!=null&&resultSetCategory[k]!=undefined&&isCustomUserReference==false){VIPClientIcon(resultSetCategory[k][orgNamespace+"VIP__c"])}if(currentConsole=="Incident"){var u="< "+lblCreateNewClient+" >";if(h.value==u){createNewClient()}}}for(var p=0;p<resultSetCategory.length;p++){var j,t;if(currentObject=="BMC_BusinessService__c"&&currentConsole=="Incident"){j=resultSetCategory[p][orgNamespace+"FKBMC_BaseElement__r"].Name;t=resultSetCategory[p][orgNamespace+"FKBMC_BaseElement__r"].Id}else{if(currentObject=="User"){j=resultSetCategory[p].Name}else{if(currentObject=="Group"){j=resultSetCategory[p].Queue.Name}else{j=resultSetCategory[p].Name}}if(currentObject=="Group"){t=resultSetCategory[p].Queue.Id}else{t=resultSetCategory[p].Id}}if(j==h.value){currentField.value=j;var d=currentField.id+"_lkid";if(currentObject=="Group"){ownerType="QUEUE";assignOwnerfields(t,j,"","")}if(d!=null&&d!="undefined"){var b=document.getElementById(d);if(b){b.value=t;if(b.onchange){b.onchange()}}}setMandatoryFieldValue(currentField,t);if(currentObject!=undefined&&currentObject=="Category__c"){categoryLookupId=t;categoryfields(t,j,true,currentField.id)}if(currentObject!=undefined&&currentObject=="User"&&isCustomUserReference==false){if(currentConsole=="Incident"){if(currentField.id==staffId){ownerType="STAFF";assignOwnerfields("","",t,resultSetCategory[p].Name)}else{var o=resultSetCategory[p][orgNamespace+"Account_ID__c"];var a=resultSetCategory[p][orgNamespace+"Account_Name__c"];clientfields(t,j,o,a)}}else{if(currentField.id==staffId){ownerType="STAFF";assignOwnerfields("","",t,resultSetCategory[p].Name)}else{clientfields(t,j)}}}if(currentObject!=undefined&&currentObject=="User"&&isCustomUserReference==true){if(currentField.id==staffId){ownerType="STAFF";assignOwnerfields("","",t,resultSetCategory[p].Name)}else{document.getElementById(currentField.id+"_lkid").value=t;document.getElementById(currentField.id+"_lkold").value=j}}if(currentObject!=undefined&&currentObject=="Contact"){if(currentConsole=="Incident"||currentConsole=="Task"){contactFieldId=t}}if(currentObject!=undefined&&currentObject=="Account"&&currentConsole=="Incident"){isAccountByClient=false;accountFieldId=t}if(currentConsole=="Incident"&&document.getElementById(getHTMLInputID(orgNamespace+"FKBusinessService__c"))&&currentField.id==document.getElementById(getHTMLInputID(orgNamespace+"FKBusinessService__c")).id){buisnessServiceId=t}if(currentConsole=="Incident"&&document.getElementById(getHTMLInputID(orgNamespace+"FKRequestDefinition__c"))&&currentField.id==document.getElementById(getHTMLInputID(orgNamespace+"FKRequestDefinition__c")).id){c=t}if(currentConsole!="Problem"){if(document.getElementById(getHTMLInputID(orgNamespace+"FKTemplate__c"))&&currentField.id==document.getElementById(getHTMLInputID(orgNamespace+"FKTemplate__c")).id){var s,m;if(currentConsole=="Incident"){s=incidentId;m=IncidentIsClosed}else{if(currentConsole=="Task"){s=taskId;m=TaskIsClosed}else{if(currentConsole=="Change Request"){s=changeReqId;m=CrClosed}else{if(currentConsole=="Release"){s=releaseId;m=ReleaseIsClosed}}}}if((s!=""&&status=="false")){alert(m);return}if(applytemplateToExistingRecord=="false"&&s!=""){alert(TemplateValidationError);return}n=t;if(isTemplateSelectedFromTypeAhead){isTemplateSelectedFromTypeAhead=false}else{if(overrideRecWithTemplateVal!=null&&overrideRecWithTemplateVal=="true"){var q="";if(window.parent.clickedOnce){q=confirm(OverwriteWarning);if(q==false){currentField.value="";setMandatoryFieldValue(currentField,"");document.getElementById(e).style.visibility="hidden";return}}}}}}break}}isAutocomplete=false}document.getElementById(e).style.visibility="hidden";if(n!=""){templateApplied=true;applyTemplateToRecord(n,"","TYPEAHEAD")}if(c!=""){setReqDefId(c)}}}}}}function selectPosition(e,b,a){if(e){var g;for(var d=0;d<e.children.length;d++){var f=e.children[d];var c=f.getAttribute("rf-position");if(c){if(parseInt(a)===parseInt(c)){g=f;break}}}if(g){SelectListValue(g,b)}}}function SelectListValue(o,f){var p=o.getAttribute("rf-position");var n=parseInt(p);var g="";if(currentConsole==""){if(currentObject=="User"){currentField.value=m=resultSetCategory[n].Username;g=currentField.id.replace("username","id")}else{currentField.value=m=resultSetCategory[n].Name;g=currentField.id.replace("name","id")}var h=parseInt(g.substring(g.lastIndexOf("_")+1))+1;g=g.replace(g.substring(g.lastIndexOf("_")+1),h);document.getElementById(g).value=resultSetCategory[n].Id;document.getElementById(f).style.visibility="hidden";if(currentObject!=undefined&&currentObject=="Model__c"){applyModelAttribute(resultSetCategory[n].Id)}}else{if(currentConsole=="model"){if(currentObject=="User"){currentField.value=m=resultSetCategory[n].Username}else{currentField.value=m=resultSetCategory[n].Name}document.getElementById("referenceID").value=resultSetCategory[n].Id;document.getElementById(f).style.visibility="hidden";lookupSelectedValue=currentField.value;lookupSelectedId=document.getElementById("referenceID").value;validateValue()}else{if(currentConsole=="location"||currentConsole=="modelform"){if(currentObject=="User"){currentField.value=m=resultSetCategory[n].Username}else{currentField.value=m=resultSetCategory[n].Name}document.getElementById(currentField.id+"_lkid").value=resultSetCategory[n].Id;document.getElementById(currentField.id+"_lkold").value=currentField.value;document.getElementById(f).style.visibility="hidden"}else{if(currentConsole=="searchAndLinkInFilter"){if(currentObject=="User"){currentField.value=m=resultSetCategory[n].Username}else{currentField.value=m=resultSetCategory[n].Name}g=currentField.id.replace("LookUpText","inputHidden");document.getElementById(g).value=resultSetCategory[n].Id;document.getElementById(f).style.visibility="hidden";lookupSelectedValue=currentField.value;lookupSelectedId=document.getElementById(g).value}else{if(currentConsole=="CMDB_InstanceEditor"){if(currentObject=="User"){currentField.value=m=resultSetCategory[n].Username;g=currentField.id.replace("username","id")}else{currentField.value=m=resultSetCategory[n].Name;g=currentField.id.replace("name","id")}var h=parseInt(g.substring(g.lastIndexOf("_")+1))+1;g=g.replace(g.substring(g.lastIndexOf("_")+1),h);document.getElementById(g).value=resultSetCategory[n].Id;document.getElementById(f).style.visibility="hidden";if(currentObject!=undefined&&currentObject=="Model__c"){applyModelAttribute(resultSetCategory[n].Id)}if(typeof currentTooltipId!="undefined"){if(document.getElementById(currentTooltipId)){document.getElementById(currentTooltipId).setAttribute("style","display:inline-block")}var y=false;if(typeof existingValue!="undefined"&&existingValue!=""&&existingValue!=currentField.value){y=true}if(y&&!currentTooltipId.match("^primaryclient__c")&&currentTooltipId.match("primaryclient__c$")){showPrimaryClientWarningMessage()}}}else{if(currentConsole=="serviceOutage"){m=resultSetCategory[n].Name;setLookUpField(currentField.id,resultSetCategory[n].Id,m);document.getElementById(f).style.visibility="hidden"}else{if(typeof IsConsoleClosedForm!="undefined"&&IsConsoleClosedForm){if(currentObject=="User"){currentField.value=m=resultSetCategory[n].Username}else{currentField.value=m=resultSetCategory[n].Name}setPopUpValue(resultSetCategory[n].Id,currentField.value);document.getElementById(f).style.visibility="hidden"}else{var r="";var c="";if(n>-1){if(currentObject!=undefined&&currentObject=="User"){if(resultSetCategory[n]!=null&&resultSetCategory[n]!=undefined&&isCustomUserReference==false){VIPClientIcon(resultSetCategory[n][orgNamespace+"VIP__c"])}if(currentConsole=="Incident"){if(o.id==lblCreateNewClient){createNewClient()}}}for(var t=0;t<resultSetCategory.length;t++){var m,w;if(currentObject=="BMC_BusinessService__c"&&currentConsole=="Incident"){m=resultSetCategory[t][orgNamespace+"FKBMC_BaseElement__r"].Name;w=resultSetCategory[t][orgNamespace+"FKBMC_BaseElement__r"].Id}else{if(currentObject=="User"){m=resultSetCategory[t].Name}else{if(currentObject=="Group"){m=resultSetCategory[t].Queue.Name}else{m=resultSetCategory[t].Name}}if(currentObject=="Group"){w=resultSetCategory[t].Queue.Id}else{w=resultSetCategory[t].Id}}if(w==o.id){currentField.value=m;var e=currentField.id+"_lkid";if(currentObject=="Group"){ownerType="QUEUE";assignOwnerfields(w,m,"","")}if(e!=null&&e!="undefined"){var b=document.getElementById(e);if(b){b.value=w;if(b.onchange){b.onchange()}}}var k=currentField.id+"_lkold";var x=document.getElementById(k);if(x){x.value=m}setMandatoryFieldValue(currentField,w);if(currentObject!=undefined&&currentObject=="Category__c"){categoryLookupId=w;categoryfields(w,m,true,currentField.id);try{if(typeof(isAutoClassificationEnable)!="undefined"&&isAutoClassificationEnable&&currentConsole.toLowerCase()=="incident"){if(typeof(modifiedCategorizationMode)!="undefined"){modifiedCategorizationMode=""}}}catch(d){}}if(currentObject!=undefined&&currentObject=="User"&&isCustomUserReference==false){if(currentConsole=="Incident"){if(currentField.id==staffId){ownerType="STAFF";assignOwnerfields("","",w,resultSetCategory[t].Name)}else{var s=resultSetCategory[t][orgNamespace+"Account_ID__c"];var a=resultSetCategory[t][orgNamespace+"Account_Name__c"];clientfields(w,m,s,a)}}else{if(currentField.id==staffId){ownerType="STAFF";assignOwnerfields("","",w,resultSetCategory[t].Name)}else{clientfields(w,m)}}}if(currentObject!=undefined&&currentObject=="User"&&isCustomUserReference==true){if(currentField.id==staffId){ownerType="STAFF";assignOwnerfields("","",w,resultSetCategory[t].Name)}else{document.getElementById(currentField.id+"_lkid").value=w;document.getElementById(currentField.id+"_lkold").value=m}}if(currentObject!=undefined&&currentObject=="Contact"){if(currentConsole=="Incident"||currentConsole=="Task"){contactFieldId=w}}if(currentObject!=undefined&&currentObject=="Account"&&currentConsole=="Incident"){isAccountByClient=false;accountFieldId=w}if(currentConsole=="Incident"&&document.getElementById(getHTMLInputID(orgNamespace+"FKBusinessService__c"))&&currentField.id==document.getElementById(getHTMLInputID(orgNamespace+"FKBusinessService__c")).id){buisnessServiceId=w}if(currentConsole=="Incident"&&document.getElementById(getHTMLInputID(orgNamespace+"FKRequestDefinition__c"))&&currentField.id==document.getElementById(getHTMLInputID(orgNamespace+"FKRequestDefinition__c")).id){c=w;if(overrideRecWithTemplateVal!=null&&overrideRecWithTemplateVal=="true"){var u="";if(window.parent.clickedOnce&&incidentId!=""){u=confirm(OverwriteWarningForRequestDef);if(u==false){currentField.value="";return}}}}if(currentConsole!="Problem"){if(document.getElementById(getHTMLInputID(orgNamespace+"FKTemplate__c"))&&currentField.id==document.getElementById(getHTMLInputID(orgNamespace+"FKTemplate__c")).id){var v,q;if(currentConsole=="Incident"){v=incidentId;q=IncidentIsClosed}else{if(currentConsole=="Task"){v=taskId;q=TaskIsClosed}else{if(currentConsole=="Change Request"){v=changeReqId;q=CrClosed}else{if(currentConsole=="Release"){v=releaseId;q=ReleaseIsClosed}}}}if((v!=""&&status=="false")){alert(q);return}if(applytemplateToExistingRecord=="false"&&v!=""){alert(TemplateValidationError);return}r=w;if(isTemplateSelectedFromTypeAhead&&v==""){isTemplateSelectedFromTypeAhead=false}else{if(overrideRecWithTemplateVal!=null&&overrideRecWithTemplateVal=="true"){var u="";if(window.parent.clickedOnce){u=confirm(OverwriteWarning);if(u==false){currentField.value="";setMandatoryFieldValue(currentField,"");document.getElementById(f).style.visibility="hidden";return}}}}}}break}}isAutocomplete=false}document.getElementById(f).style.visibility="hidden";clearResultList();if(r!=""){templateApplied=true;applyTemplateToRecord(r,"","TYPEAHEAD")}if(c!=""){setReqDefId(c)}}}}}}}}currentPosition=0;if(currentField){var j=currentField.getAttribute("rf-fieldapiname");if(j){var l=document.getElementById("rf-tooltip"+j);if(l){l.setAttribute("style","display:inline")}}}if(currentConsole=="Incident"&&typeof(dynamicFieldsHandler)!="undefined"){dynamicFieldsHandler(currentField.getAttribute("rf-fieldapiname"),"reference")}}function disableDiv(g,f,c){if(!isAutocomplete){var a=document.getElementById(g);if(a){a.style.visibility="hidden"}}if(f=="reference"){currentField=c;if(currentField.value==""){setMandatoryFieldValue(currentField,"");var e;var b;if(currentConsole=="Incident"||currentConsole=="Task"){e=getHTMLInputID(orgNamespace+"FKClient__c");b=getHTMLInputID(orgNamespace+"FKContact__c");if(b!=null&&b!="undefined"&&currentField.id==document.getElementById(b).id){contactFieldId=""}}else{if(currentConsole=="Change Request"){e=getHTMLInputID(orgNamespace+"FKInitiator__c")}else{if(currentConsole=="Release"){e=getHTMLInputID(orgNamespace+"FKReleaseCoordinator__c")}}}if(staffField&&staffField==currentField.id){var i=document.getElementById(ownerOpenById);if(i){i.value=""}}if(e!=null&&e!="undefined"&&document.getElementById(e)&&currentField.id==document.getElementById(e).id){document.getElementById(currentField.id+"_lkid").value="";document.getElementById(currentField.id+"_lkold").value="";if(document.getElementById(userId)!=null&&document.getElementById(userId)!="undefined"){document.getElementById(userId).value=""}if(currentConsole=="Incident"){ChangeStateOfParentButtons(false)}}var j=getHTMLInputID(orgNamespace+"FKCategory__c");if(j!=null&&j!="undefined"&&currentField.id==document.getElementById(j).id){categoryLookupId="";if(currentConsole=="Incident"){ChangeStateOfParentButtons(false)}}if(currentConsole=="Incident"){var d=getHTMLInputID(orgNamespace+"FKAccount__c");var h=getHTMLInputID(orgNamespace+"FKBusinessService__c");if(d!=null&&d!="undefined"&&currentField.id==document.getElementById(d).id){accountFieldId=""}if(h!=null&&h!="undefined"&&currentField.id==document.getElementById(h).id){buisnessServiceId=""}}}else{if(typeof(isFromLookup)!="undefined"&&isFromLookup==true){isFromLookup=false;setMandatoryFieldValue(currentField,currentField.value)}}}else{if(c!="undefined"&&c!=undefined){if(typeof setMandatoryFieldValue=="function"){setMandatoryFieldValue(c,c.value==""?"":"y")}}}}function disableAutoDiv(){currentPosition=0;document.getElementById("autocompleteDiv").style.visibility="hidden";document.getElementById("autocompleteDiv").style.display="none";clearResultList();isAutocomplete=false}function appendText(f,h,g){var c=e();if(c.length===0){f.appendChild(document.createTextNode(h))}else{for(var d=0;d<c.length;d++){var b=c[d];if(d===0){f.appendChild(document.createTextNode(h.substr(0,b)));a(h.substr(b,g.length));if(c.length==1){f.appendChild(document.createTextNode(h.substr(b+g.length)))}else{f.appendChild(document.createTextNode(h.substr(b+g.length,c[d+1]-b-g.length)))}}else{a(h.substr(b,g.length));if(d===c.length-1){f.appendChild(document.createTextNode(h.substr(b+g.length)))}else{f.appendChild(document.createTextNode(h.substr(b+g.length,c[d+1]-b-g.length)))}}}}function e(){var l=[],m=-1,k=0;while((m=h.toLowerCase().indexOf(g.toLowerCase(),k))!=-1){if(m===0){l.push(m)}else{if(h.charAt(m-1)==" "){l.push(m)}}k=m+g.length}return l}function a(j){var i=document.createElement("span");i.appendChild(document.createTextNode(j));i.style.fontWeight="bold";f.appendChild(i)}}function createUserBlade(n,e,k,c){var m=document.createElement("DIV");m.className="rfDPL-user-blade";var p=document.createElement("DIV");p.className="rfDPL-user-img-container";if(!n){var i=document.createElement("IMG");i.src=c.SmallPhotoUrl;i.className="rfDPL-user-image";i.height=30;i.width=30;p.appendChild(i)}else{var j=document.createElement("SPAN");j.className="d-icon-plus_circle_o";j.style.fontSize="26px";p.appendChild(j)}m.appendChild(p);var d=document.createElement("DIV");d.className="rfDPL-name-col";d.style.width="100%";if(!n){var a=document.createElement("P");a.className="rfDPL-user-fullname";appendText(a,c.Name,k);d.appendChild(a);var b=document.createElement("P");b.className="rfDPL-user-name";appendText(b,c.Username,k);d.appendChild(b);e.setAttribute("title",c.Name+" ("+c.Username+")")}else{var f=document.createElement("P");f.className="rfDPL-user-fullname";f.appendChild(document.createTextNode("< "+lblCreateNewClient+" >"));d.appendChild(f)}m.appendChild(d);if(c){var l=c[orgNamespace+"Account_Name__c"];if(typeof l!=="undefined"&&l!==""){var o=document.createElement("P");o.className="rfDPL-pull-right";var h=document.createElement("DIV");h.style.width="40%";d.style.width="60%";h.className="rfDPL-account-col";o.appendChild(document.createTextNode(l));h.appendChild(o);m.appendChild(h)}}e.appendChild(m);m.addEventListener("mouseover",function(r){var s=r.currentTarget;if(s){var q=s.parentElement.getAttribute("rf-position");if(q){highlightItem(parseInt(q),"mouseover");currentPosition=q}}});var g=document.createElement("DIV");g.className="rfDPL-blade-separator";e.appendChild(g);e.style.height="50px"}function getKeyCode(c){var a="";try{a=c.keyCode||c.which||c.keyChar||""}catch(b){a=""}return a}function handleKeyEvent(d,e,c,a){var b=document.getElementById(e);switch(d){case 38:if(currentPosition>0){currentPosition--}break;case 40:if(typeof staffId!="undefined"&&c.id==staffId&&typeof queueId!="undefined"&&queueId!=null&&queueId!=""){if(currentPosition<b.children.length-2){currentPosition++}}else{if(currentPosition<b.children.length-1){currentPosition++}}break;case 13:currentField=c;selectPosition(b,a,currentPosition);break;case 27:c.value="";disableAutoDiv();break}highlightItem(currentPosition,"keyboard")}function isConsoleForm(){if(currentConsole=="Incident"||currentConsole=="Task"||currentConsole=="Problem"||currentConsole=="Broadcast"||currentConsole=="Release"||currentConsole=="Change Request"){return true}else{return false}}function clearResultList(){var a=document.getElementById("rf-resultlist");if(a){RemedyForceHTMLProcessor.clearHTML(a)}};