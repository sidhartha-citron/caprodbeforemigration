ServiceHealthApp.controller("ServiceHealthTiles",["$scope","dataServices","$interval",function(a,c,b){a.tiles=[];a.outages=[];a.outageHistory=[];a.isFromSS=isCalledFromSS;a.isNoServicesFound=false;a.isTileClicked=false;a.isShowHistory=true;a.selectedTab="current";a.tileWidth="0px";a.screensWidth="0px";a.detialsMaxHeight="0px";a.tilesDivHeight="0px";a.isFilterClicked=false;a.seachStr="";a.outageStatuses=[];a.selectedStatusArr=[];a.selectedStatusCurrentTabArr=[];a.accountInterval;a.accountName="";a.isShowLoader=false;a.selectedServiceTile={};a.init=function(){a.isShowLoader=true;angular.forEach(statusValues,function(f){if(f.value=="All"||f.value=="Available"){if(isCalledFromSS==true){a.selectedStatusArr.push(f.value)}}else{a.selectedStatusArr.push(f.value)}});a.outageStatuses=statusValues;if(a.isFromSS){$("#mainDiv").width(screen.width-80)}var e=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);var d=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);if(e||d){a.tileWidth=(((screen.width-80)/4)-60)+"px"}else{a.tileWidth=(((screen.width-80)/4)-30)+"px"}a.detialsMaxHeight=((screen.height/2)-100)+"px";a.tilesDivHeight=(screen.height/2)+"px";a.screensWidth=((screen.width/2)-40)+"px";a.selectedTab="current";$("#currentTab").addClass("fontWithBold");a.isNoServicesFound=false;a.showServiceTiles("current","")};a.showServiceTiles=function(d,f){var e=c.getTileDataForServices(isCalledFromSS,[d,f]);e.then(function(g){a.isShowLoader=false;a.tiles=g;a.isTileClicked=false;if(g.length==0){a.isNoServicesFound=true}},function(g){a.isShowLoader=false})};a.showServiceTileDetails=function(d){a.outageHistory=[];a.isShowHistory=true;a.outages={};$("#historyBtn").val(showHistoryLbl);a.selectedServiceTile=d;$("#tileNavDiv").text(function(f,g){return(g=="")?" > "+d.title:g});var e=c.getServiceOutageDetails(isCalledFromSS,[d.serviceId,a.selectedTab]);e.then(function(f){a.outages=f;a.isTileClicked=true},function(f){})};a.checkChangeDetails=function(d){var e=c.changeSubscription(d,a.outages.isSubscriptionChecked)};a.getServiceOutagesPerTab=function(d){a.clearSearch();a.isShowLoader=true;$("#tileNavDiv").empty();a.accountName="";if(d==""){d=a.selectedTab}else{a.selectedTab=d}if(d=="current"){$("#currentTab").addClass("fontWithBold");$("#futureTab").removeClass("fontWithBold");if(a.selectedStatusCurrentTabArr.length!=0){a.selectedStatusArr=a.selectedStatusCurrentTabArr}}else{$("#futureTab").addClass("fontWithBold");$("#currentTab").removeClass("fontWithBold");a.selectedStatusCurrentTabArr=a.selectedStatusArr;a.selectedStatusArr=[];angular.forEach(statusValues,function(e){if(e.value=="All"||e.value=="Available"){if(isCalledFromSS==true){a.selectedStatusArr.push(e.value)}}else{a.selectedStatusArr.push(e.value)}})}a.tiles=[];a.isNoServicesFound=false;a.showServiceTiles(d,"")};a.showOutageHistory=function(){var e=a.selectedServiceTile.serviceId;var d="";if(a.outages[0]!=undefined){d=a.outages[0].outageId}if(a.isShowHistory==true){var f=c.getServiceOutageHistory(isCalledFromSS,[e,d]);f.then(function(g){a.outageHistory=g;a.isShowHistory=false;$("#historyBtn").val(hideHistoryLbl)},function(g){})}else{$("#historyBtn").val(showHistoryLbl);a.isShowHistory=true}};a.searchService=function(){a.seachStr=$("#searchTxt").val()};a.clearSearch=function(){$("#searchTxt").val("");a.seachStr=""};a.clearAccount=function(){a.accountName="";a.isShowLoader=true;a.showServiceTiles(a.selectedTab,"")};a.setSelectedStatus=function(e,f){if(e=="All"&&a.selectedStatusArr.indexOf("All")==-1){a.selectedStatusArr=[];angular.forEach(a.outageStatuses,function(g){a.selectedStatusArr.push(g.value)})}else{if(e=="All"&&a.selectedStatusArr.indexOf("All")>-1){a.selectedStatusArr=[]}else{var d=a.selectedStatusArr.indexOf(e);if(d>-1){if(e!="All"&&a.selectedStatusArr.indexOf("All")>-1){var d=a.selectedStatusArr.indexOf("All");a.selectedStatusArr.splice(d,1)}a.selectedStatusArr.splice(a.selectedStatusArr.indexOf(e),1)}else{a.selectedStatusArr.push(e);if(a.selectedStatusArr.length==4){a.selectedStatusArr.push("All")}}}}f.stopPropagation()};a.openPopup=function(d){var f=(screen.width/2)-300;var e=(screen.height/2)-300;lookupWindow=window.open(d,"popupWindow","width=600,height=500,scrollbars=yes,left="+f+",top="+e);a.accountInterval=b(function(){if(lookupWindow.closed){b.cancel(a.accountInterval);if(selectedAccId!=null&&selectedAccId!=undefined&&typeof(selectedAccId)!="undefined"&&selectedAccId!=""){a.accountName=selectedAccName;a.isShowLoader=true;a.isNoServicesFound=false;a.showServiceTiles(a.selectedTab,selectedAccId);selectedAccId=""}}},1000)};a.goBackToServices=function(){$("#tileNavDiv").empty();a.isTileClicked=false};a.showStatusFilter=function(d){a.isFilterClicked=!a.isFilterClicked;d.stopPropagation()};a.init()}]);ServiceHealthApp.filter("filterServicesByStatus",function(){return function(b,a,c){var d=[];angular.forEach(b,function(e){if(a.indexOf("All")>-1){d=b}else{if(a.indexOf(e.status)>-1){d.push(e)}}});if(d.length==0){c.$parent.isNoServicesFound=true}else{c.$parent.isNoServicesFound=false}return d}});ServiceHealthApp.filter("truncateString",function(){return function(a,b){if(a!=null&&a!=""&&a.length>b){return(a.substring(0,b)+"...")}else{return a}}});