var gridDataStore;var statusList;var grid=null;var uniqueId=0;var statusComboId;var orderComboId;function openWindow(a){window.open("/"+a)}function closeWindow(){window.close()}function waitbox(a){if(parseInt(a)>0){setTimeout("waitMsg.hide()",a)}waitMsg=new Ext.Window({height:100,width:200,resizable:false,closable:false,header:false,frame:false,modal:true,shadow:false,items:[{xtype:"panel",height:100,width:200,bodyStyle:"background-color:transparent;border:none;",html:'<div align="center"><img src="'+tabOutImg+'"/></div>'}]});waitMsg.show()}function showMessage(a){if(a!=""){showErrorMessage(a)}else{showErrorMessage(savedSuccessfullyLabel)}waitMsg.hide()}function showErrorMessage(a){alertMsg=Ext.Msg.show({msg:a,buttons:Ext.Msg.OK,width:300,frame:false});return}Ext.onReady(function(){Ext.QuickTips.init();eval(store);gridDataStore=new Ext.data.ArrayStore({id:"gridDataStore",fields:[{name:"releaseItem"},{name:"itemId"},{name:"description"},{name:"status"},{name:"dueDate",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"priority"},{name:"assignedTo"},{name:"releaseStatus"},{name:"Order",type:"int"},{name:"releaseElementId"},{name:"assignedToId"},{name:"isDisabled"},{name:"manifestId"},{name:"hasAccessToRecord"},{name:"processTemplateId"},{name:"templateId"}]});gridDataStore.loadData(wrappedmanifestList);eval(orderNumStore);OrderNumber=new Ext.data.ArrayStore({id:"Orderid",fields:[{name:"DisplayOrderno"},{name:"OrderNum"}]});OrderNumber.loadData(order);eval(JSONStatusStore);statusList=new Ext.data.ArrayStore({id:"statusList",fields:[{name:"statusId"},{name:"statusName"}]});statusList.loadData(status);var SelectedRowIndex;statusComboId=new Ext.form.ComboBox({id:"statusComboId",width:85,fieldLabel:"",store:statusList,valueField:"statusName",displayField:"statusName",typeAhead:true,mode:"local",editable:false,triggerAction:"all",selectOnFocus:true,emptyText:"-",focusClass:"x-grid3-col-Status-focus",autoShow:true,autoLoad:true,listeners:{load:function(){statusComboId.focus()},beforeshow:function(obj){if(SelectedRowIndex!=undefined&&SelectedRowIndex!=null&&Object.keys(ManifestNonLayoutStatuses).length>0&&gridDataStore.getAt(SelectedRowIndex).get("manifestId")!=null){eval(JSONStatusStore);var newStatus=status;var newStatusList=this.getStore();if(ManifestNonLayoutStatuses[gridDataStore.getAt(SelectedRowIndex).get("manifestId")]!=null){var ManifestStatusId=ManifestNonLayoutStatuses[gridDataStore.getAt(SelectedRowIndex).get("manifestId")];var fieldValue=ManifestStatusId.split("Â¬");if(fieldValue.length>1){newStatus.push([fieldValue[0],fieldValue[1],""]);newStatusList.loadData(newStatus)}}else{newStatusList.loadData(newStatus)}newStatusList.sort("statusName","ASC");this.bindStore(newStatusList)}}}});orderComboId=new Ext.form.ComboBox({id:"OrderComboId",fieldLabel:"",store:OrderNumber,valueField:"OrderNum",displayField:"DisplayOrderno",typeAhead:false,mode:"local",editable:false,triggerAction:"all",forceSelection:true,selectOnFocus:true,lazyRender:true,emptyText:"-",listeners:{}});grid=new Ext.grid.EditorGridPanel({store:gridDataStore,id:"manifestEditorGrid",columnLines:true,clicksToEdit:true,layout:"fit",stripeRows:true,height:420,autowidth:true,frame:false,enableHdMenu:false,sm:new Ext.grid.RowSelectionModel(),columns:[{header:releaseItemLabel,sortable:true,dataIndex:"releaseItem"},{header:itemIdLabel,sortable:true,dataIndex:"itemId",renderer:function(value,metaData,record,rowIndex,colIndex,store){if(gridDataStore.getAt(rowIndex).get("status")!=pendingCreationLabel&&gridDataStore.getAt(rowIndex).get("hasAccessToRecord")=="true"){var rec=gridDataStore.getAt(rowIndex).get("releaseElementId");var clickedRecordName=gridDataStore.getAt(rowIndex).get("itemId");var link='<a target="_blank" href="/'+rec+'">'+value+"</a>";if(isRFConsoleEnabled=="true"){if(gridDataStore.getAt(rowIndex).get("releaseItem")=="Task"){link='<a href="#" onclick="openPopupRecord(\''+rec+"','"+clickedRecordName+"','Task__c',null,null,null);\">"+value+"</a>"}if(gridDataStore.getAt(rowIndex).get("releaseItem")=="Change Request"){link='<a href="#" onclick="openPopupRecord(\''+rec+"','"+clickedRecordName+"','Change_Request__c',null,null,null);\">"+value+"</a>"}}return link}return value}},{header:descriptionLabel,sortable:true,width:150,dataIndex:"description"},{header:statusLabel,sortable:true,dataIndex:"status"},{header:dueDateLabel,sortable:true,dataIndex:"dueDate",renderer:Ext.util.Format.dateRenderer("m/d/Y h:i A")},{header:priorityLabel,sortable:true,width:60,dataIndex:"priority"},{header:assignedToLabel,sortable:true,dataIndex:"assignedTo",renderer:function(value,metaData,record,rowIndex,colIndex,store){var rec=gridDataStore.getAt(rowIndex).get("assignedToId");var link;if(rec!="null"){link='<a target="_blank" href="/'+rec+'">'+value+"</a>"}else{link="-"}return link}},{id:"Status",header:releaseStatusLabel,sortable:true,dataIndex:"releaseStatus",readOnly:true,editor:statusComboId},{id:"OrderNo",sortable:true,dataIndex:"Order",header:orderLabel,width:50,readOnly:true,editor:orderComboId},{dataIndex:"releaseElementId",hidden:true},{dataIndex:"assignedToId",hidden:true},{dataIndex:"isDisabled",hidden:true},{dataIndex:"manifestId",hidden:true},{dataIndex:"processTemplateId",hidden:true},{dataIndex:"templateId",hidden:true}],viewConfig:{scrollOffset:16,forceFit:true,stripeRows:true,emptyText:'<div style="width:auto; color:black; text-align:center; padding-top:160px; ">'+emptyText+"</div>",deferEmptyText:false},listeners:{beforeedit:function(e){if(gridDataStore.getAt(e.row).get("isDisabled")!="false"){return false}},rowclick:function(obj,rowIndex,e){SelectedRowIndex=rowIndex}},plugins:[new Ext.ux.grid.ColumnHeaderGroup({rows:[[{},{header:itemDetailsLabel,colspan:6,align:"center",dataIndex:"assignedTo"},{},{}]],hierarchicalColMenu:true})],renderTo:"manifestGrid"});refreshGrid();window.onresize=function(event){refreshGrid()};document.getElementById(pageBlocktopSection).style.display="block";document.getElementById(pageBlockBottomSection).style.display="block"});