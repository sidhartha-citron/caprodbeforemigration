var forcetk=window.forcetk;if(forcetk===undefined){forcetk={}}if(forcetk.Client===undefined){forcetk.Client=function(a,b,c){this.clientId=a;this.loginUrl=b||"https://login.salesforce.com/";if(c===undefined||c===null){if(location.protocol==="file:"||location.protocol==="ms-appx:"){this.proxyUrl=null}else{this.proxyUrl=location.protocol+"//"+location.hostname+"/services/proxy"}this.authzHeader="Authorization"}else{this.proxyUrl=c;this.authzHeader="X-Authorization"}this.refreshToken=null;this.sessionId=null;this.apiVersion=null;this.visualforce=false;this.instanceUrl=null;this.asyncAjax=true};forcetk.Client.prototype.setRefreshToken=function(a){this.refreshToken=a};forcetk.Client.prototype.refreshAccessToken=function(d,b){var c=this,a=this.loginUrl+"/services/oauth2/token";return $.ajax({type:"POST",url:(this.proxyUrl!==null&&!this.visualforce)?this.proxyUrl:a,cache:false,processData:false,data:"grant_type=refresh_token&client_id="+this.clientId+"&refresh_token="+this.refreshToken,success:d,error:b,dataType:"json",beforeSend:function(e){if(c.proxyUrl!==null&&!this.visualforce){e.setRequestHeader("SalesforceProxy-Endpoint",a)}}})};forcetk.Client.prototype.setSessionToken=function(e,c,b){this.sessionId=e;this.apiVersion=(c===undefined||c===null)?"v29.0":c;if(b===undefined||b===null){this.visualforce=true;var d=location.hostname.split("."),a=null;if(d.length===4&&d[1]==="my"){a=d[0]+"."+d[1]}else{if(d.length===3){a=d[0]}else{a=d[1]}}this.instanceUrl="https://"+a+".salesforce.com"}else{this.instanceUrl=b}};forcetk.Client.prototype.ajax=function(f,h,c,g,e,a){var d=this,b=(this.visualforce?"":this.instanceUrl)+"/services/data"+f;return $.ajax({type:g||"GET",async:this.asyncAjax,url:(this.proxyUrl!==null&&!this.visualforce)?this.proxyUrl:b,contentType:g==="DELETE"?null:"application/json",cache:false,processData:false,data:e,success:h,error:(!this.refreshToken||a)?c:function(i,k,j){if(i.status===401){d.refreshAccessToken(function(l){d.setSessionToken(l.access_token,null,l.instance_url);d.ajax(f,h,c,g,e,true)},c)}else{c(i,k,j)}},dataType:"json",beforeSend:function(i){if(d.proxyUrl!==null&&!d.visualforce){i.setRequestHeader("SalesforceProxy-Endpoint",b)}i.setRequestHeader(d.authzHeader,"Bearer "+d.sessionId);i.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+d.apiVersion)}})};forcetk.Client.prototype.getChatterFile=function(f,g,h,c,a){var e=this,b=(this.visualforce?"":this.instanceUrl)+f,d=new XMLHttpRequest();d.open("GET",(this.proxyUrl!==null&&!this.visualforce)?this.proxyUrl:b,true);d.responseType="arraybuffer";d.setRequestHeader(this.authzHeader,"Bearer "+this.sessionId);d.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+this.apiVersion);if(this.proxyUrl!==null&&!this.visualforce){d.setRequestHeader("SalesforceProxy-Endpoint",b)}d.onreadystatechange=function(){if(d.readyState===4){if(d.status===200){try{h(d.response)}catch(i){alert("Error reading the response: "+i.toString())}}else{if(d.status===401&&!a){e.refreshAccessToken(function(j){e.setSessionToken(j.access_token,null,j.instance_url);e.getChatterFile(f,g,h,c,true)},c)}else{c(d,d.statusText,d.response)}}}};d.send()};var randomString=function(){var b="",a;for(a=0;a<4;a+=1){b+=(Math.random().toString(16)+"000000000").substr(2,8)}return b};forcetk.Client.prototype.blob=function(m,h,b,f,k,l,j,c){var i=this,d=(this.visualforce?"":this.instanceUrl)+"/services/data"+m,e=randomString(),a=new Blob(["--boundary_"+e+'\nContent-Disposition: form-data; name="entity_content";\nContent-Type: application/json\n\n'+JSON.stringify(h)+"\n\n--boundary_"+e+'\nContent-Type: application/octet-stream\nContent-Disposition: form-data; name="'+f+'"; filename="'+b+'"\n\n',k,"\n--boundary_"+e+"--"],{type:'multipart/form-data; boundary="boundary_'+e+'"'});var g=null;if(Sarissa.originalXMLHttpRequest){g=new Sarissa.originalXMLHttpRequest()}else{if(window.XMLHttpRequest){g=new XMLHttpRequest()}}g.open("POST",(this.proxyUrl!==null&&!this.visualforce)?this.proxyUrl:d,this.asyncAjax);g.setRequestHeader("Accept","application/json");g.setRequestHeader(this.authzHeader,"Bearer "+this.sessionId);g.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+this.apiVersion);g.setRequestHeader("Content-Type",'multipart/form-data; boundary="boundary_'+e+'"');if(this.proxyUrl!==null&&!this.visualforce){g.setRequestHeader("SalesforceProxy-Endpoint",d)}if(this.asyncAjax){g.onreadystatechange=function(){if(g.readyState===4){if(g.status>=200&&g.status<300){l(g.response?JSON.parse(g.response):null)}else{if(g.status===401&&!c){i.refreshAccessToken(function(n){i.setSessionToken(n.access_token,null,n.instance_url);i.blob(m,h,b,f,k,l,j,true)},j)}else{j(g,g.statusText,g.response)}}}}}g.send(a);return this.asyncAjax?null:JSON.parse(g.response)};forcetk.Client.prototype.createBlob=function(d,a,e,c,g,h,f,b){return this.blob("/"+this.apiVersion+"/sobjects/"+d+"/",a,e,c,g,h,f,b)};forcetk.Client.prototype.updateBlob=function(h,c,e,b,d,g,i,f,a){return this.blob("/"+this.apiVersion+"/sobjects/"+h+"/"+c+"?_HttpMethod=PATCH",e,b,d,g,i,f,a)};forcetk.Client.prototype.apexrest=function(i,h,e,a,g,f,b){var d=this,c=this.instanceUrl+"/services/apexrest"+i;a=a||"GET";if(a==="GET"){if(this.proxyUrl&&g){if(typeof g!=="string"){g=$.param(g)}c+="?"+g;g=null}}else{if(g&&typeof g!=="string"){g=JSON.stringify(g)}}return $.ajax({type:a,async:this.asyncAjax,url:this.proxyUrl||c,contentType:"application/json",cache:false,processData:false,data:g,success:h,error:(!this.refreshToken||b)?e:function(j,l,k){if(j.status===401){d.refreshAccessToken(function(m){d.setSessionToken(m.access_token,null,m.instance_url);d.apexrest(i,h,e,a,g,f,true)},e)}else{e(j,l,k)}},dataType:"json",beforeSend:function(k){var j;if(d.proxyUrl!==null){k.setRequestHeader("SalesforceProxy-Endpoint",c)}if(f===null){f={}}for(j in f){if(f.hasOwnProperty(j)){k.setRequestHeader(j,f[j])}}k.setRequestHeader(d.authzHeader,"Bearer "+d.sessionId);k.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+d.apiVersion)}})};forcetk.Client.prototype.versions=function(b,a){return this.ajax("/",b,a)};forcetk.Client.prototype.resources=function(b,a){return this.ajax("/"+this.apiVersion+"/",b,a)};forcetk.Client.prototype.describeGlobal=function(b,a){return this.ajax("/"+this.apiVersion+"/sobjects/",b,a)};forcetk.Client.prototype.metadata=function(a,c,b){return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/",c,b)};forcetk.Client.prototype.describe=function(a,c,b){return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/describe/",c,b)};forcetk.Client.prototype.create=function(b,a,d,c){return this.ajax("/"+this.apiVersion+"/sobjects/"+b+"/",d,c,"POST",JSON.stringify(a))};forcetk.Client.prototype.retrieve=function(b,f,d,e,c){if(arguments.length===4){c=e;e=d;d=null}var a=d?"?fields="+d:"";return this.ajax("/"+this.apiVersion+"/sobjects/"+b+"/"+f+a,e,c)};forcetk.Client.prototype.upsert=function(b,e,d,a,f,c){return this.ajax("/"+this.apiVersion+"/sobjects/"+b+"/"+e+"/"+d+"?_HttpMethod=PATCH",f,c,"POST",JSON.stringify(a))};forcetk.Client.prototype.update=function(b,e,a,d,c){return this.ajax("/"+this.apiVersion+"/sobjects/"+b+"/"+e+"?_HttpMethod=PATCH",d,c,"POST",JSON.stringify(a))};forcetk.Client.prototype.del=function(a,d,c,b){return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/"+d,c,b,"DELETE")};forcetk.Client.prototype.query=function(c,b,a){return this.ajax("/"+this.apiVersion+"/query?q="+encodeURIComponent(c),b,a)};forcetk.Client.prototype.queryMore=function(c,e,b){var d="services/data",a=c.indexOf(d);if(a>-1){c=c.substr(a+d.length)}return this.ajax(c,e,b)};forcetk.Client.prototype.search=function(b,c,a){return this.ajax("/"+this.apiVersion+"/search?q="+encodeURIComponent(b),c,a)}};