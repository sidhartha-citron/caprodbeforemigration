var selectedEntitlementListJS;var unselectedEntitlementListJS;var preEntitlementValue="";var selectedIndex=0;var typingTimer;var scope;(function(){angular.module("selfServiceApp",["ui.bootstrap","ngAnimate","ngSanitize"]).controller("MainController",["$scope","$timeout","errorModel","$q","$sce",function(c,e,f,b,a){c.tooltipContent=undefined;c.remoteDataLoaded=false;c.actionDataLoaded=false;c.noRecordFound=noRecordFoundJS;c.accountSelect={};c.accountSelect.isSelectAllAccounts=true;c.accountSelect.isSelectedAccounts=false;c.pagination={};c.pagination.hasNext=hasNext;c.pagination.hasPrevious=hasPrevious;c.toolTipMessage="";c.status={isopen:false,};c.displaySpinner=false;var d={text:"",hide:"10000"};c.noAccountEntitlementEnabled=noAccountEntitlementEnabled;c.getToolTipInfo=function(){c.tooltipContent="<b>"+everyOne+": </b> "+EntitlementForEveryoneInfo+"</br><b>"+selectedAccount+": </b>";if(noAccountEntitlementEnabled){c.tooltipContent+=NoAccountEntitlementEnableInfo}else{if(!noAccountEntitlementEnabled){c.tooltipContent+=NoAccountEntitlementDisableInfo}}c.tooltipContent=a.trustAsHtml(c.tooltipContent)};c.getToolTipInfo();c.toggeleAccountSelection=function(h){var g=false;if(h=="AllAccount"){g=true}else{if(h=="SelectedAccount"){g=false}}c.accountSelection=g;c.accountSelect.isSelectAllAccounts=g;c.accountSelect.isSelectedAccounts=!g};c.bindingSelectedUserEnt=function(g){c.entitlementSelection=g;c.status.isopen=!c.status.isopen;c.changeSelectListData()};c.clearSearchString=function(){c.searchText="";c.onSearchTextChange();c.displaySpinner=true};c.preventEnter=function(g){if(g.which==13){g.preventDefault();return false}};c.nextAccount=function(){var g=getIdCSV(c.selectedAccounts);nextAccounts(g)};c.prevAccount=function(){var g=getIdCSV(c.selectedAccounts);prevAccounts(g)};c.onSearchTextChange=function(){var g=getIdCSV(c.selectedAccounts);var h=c.searchText;g=g+",";if((h.length>1||h.length==0)){clearTimeout(typingTimer);typingTimer=setTimeout(function(){searchCall(h,g)},500)}};c.addDataInRightAccSection=function(){var h=0;var g=0;if(!c.selectedAccountsLeft){return}for(h=c.selectedAccountsLeft.length-1;h>=0;h--){if(c.selectedAccountsLeft[h].name==c.noRecordFound){continue}c.selectedId=c.selectedAccountsLeft[h].id;c.selectedAccounts.push(c.selectedAccountsLeft[h]);for(g=c.unselectedAccounts.length-1;g>=0;g--){if(c.unselectedAccounts[g].id==c.selectedId){c.unselectedAccounts.splice(g,1);break}}}};c.isIE11=function(){if(window.navigator.userAgent.indexOf("MSIE ")>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)){return true}return false};c.clearData=function(){c.displaySpinner=true;var h=[].slice.call(document.getElementById("selectedAccountsList"));try{if(c.isIE11()==false){c.deleteChildren(h).then(function(j){c.selectedAccounts=[]})}}catch(g){c.selectedAccounts=[]}};c.getSelectedAccounts=function(h){c.clearData();var g=b.defer();Visualforce.remoting.Manager.invokeAction(_RemotingActions.getUserProfileInfo,h,function(j,k){if(k.status){c.$apply(function(){g.resolve(j);c.selectedAccounts=j.accounts?j.accounts:[];c.remoteDataLoaded=true})}else{c.selectedAccounts=[];c.remoteDataLoaded=true;g.reject()}if(c.remoteDataLoaded&&c.actionDataLoaded){c.displaySpinner=false}return g.promise},{escape:false})};c.closePopup=function(){f.clearAllErrors();var g=document.getElementById("AdminSSTileOrder");c.displaySpinner=false;g.classList.remove("disabledDiv");c.searchText="";document.getElementById("EntitlementPopup").style.display="none"};c.deleteChildren=function(j){var g=b.defer();for(var h=j.length-1;h>=0;h--){j[h].remove()}return g.promise};c.addDataInLeftAccSection=function(){var h=0;var g=0;if(!c.selectedAccountsRight){return}for(h=c.selectedAccountsRight.length-1;h>=0;h--){c.selectedId=c.selectedAccountsRight[h].id;if(!c.checkSelectedAccount(c.selectedId,false)){c.unselectedAccounts.push(c.selectedAccountsRight[h])}for(g=c.selectedAccounts.length-1;g>=0;g--){if(c.selectedAccounts[g].id==c.selectedId){c.selectedAccounts.splice(g,1);break}}}};c.addDataInRightProSection=function(){var h=0;var g=0;if(!c.selectedProfilesLeft){return}for(h=c.selectedProfilesLeft.length-1;h>=0;h--){c.selectedId=c.selectedProfilesLeft[h].id;c.selectedEntitlementList.push(c.selectedProfilesLeft[h]);for(g=c.unselectedEntitlementList.length-1;g>=0;g--){if(c.unselectedEntitlementList[g].id==c.selectedId){c.unselectedEntitlementList.splice(g,1);break}}}};c.addDataInLeftProSection=function(){var h=0;var g=0;if(!c.selectedProfilesRight){return}for(h=c.selectedProfilesRight.length-1;h>=0;h--){c.selectedId=c.selectedProfilesRight[h].id;c.unselectedEntitlementList.push(c.selectedProfilesRight[h]);for(g=c.selectedEntitlementList.length-1;g>=0;g--){if(c.selectedEntitlementList[g].id==c.selectedId){c.selectedEntitlementList.splice(g,1);break}}}};c.saveData=function(){f.clearAllErrors();var j=getIdCSV(c.selectedAccounts);var k=getIdCSV(c.selectedEntitlementList);var h=c.validate();var g=new Map();if(h){c.displaySpinner=true;document.getElementById("saveButton").setAttribute("disabled",true);document.getElementById("cancelButton").setAttribute("disabled",true);document.getElementById("closePopupIcon").setAttribute("disabled",true);saveEntitlementData(j,c.accountSelection,c.entitlementSelection.value,k)}};c.checkSelectedAccount=function(g,k){var h=-1;var j=0;for(j=0;j<c.unselectedAccounts.length;j++){if(c.unselectedAccounts[j].id==g){h=j;break}}if(h!==-1){c.unselectedAccounts[h].disable=k;return true}return false};c.validate=function(){if(c.accountSelect.isSelectedAccounts&&c.selectedAccounts.length==0){c.displayErrorCommon(NoAccountSelected);return false}if(c.entitlementSelection.value!="All"&&c.selectedEntitlementList.length==0){if(c.entitlementSelection.value=="00e"){c.displayErrorCommon(NoProfileSelected)}else{c.displayErrorCommon(NoPermissionsetSelected)}return false}return true};c.displayErrorCommon=function(g){d.text=g;f.addModalError(d)};c.togglePaginationButtons=function(){if(hasNext){c.nextButton.classList.add("active-pagination-key")}else{c.nextButton.classList.remove("active-pagination-key")}if(hasPrevious){c.prevButton.classList.add("active-pagination-key")}else{c.prevButton.classList.remove("active-pagination-key")}if(c.remoteDataLoaded&&c.actionDataLoaded){c.displaySpinner=false}};c.changeSelectListData=function(){var g=c.entitlementSelection.value;if(g=="00e"&&preEntitlementValue!=g){if(c.selectedEntitlementList&&c.unselectedEntitlementList&&preEntitlementValue!="All"){c.selectedPermissionSet=c.selectedEntitlementList;c.unselectedPermissionSet=c.unselectedEntitlementList}c.selectedEntitlementList=c.selectedProfiles;c.unselectedEntitlementList=c.unselectedProfiles;document.getElementById("entitlementRight").innerText=selectedProfile;document.getElementById("entitlementLeft").innerText=availableProfile}else{if(g=="0PS"&&preEntitlementValue!=g){if(c.selectedEntitlementList&&c.unselectedEntitlementList&&preEntitlementValue!="All"){c.selectedProfiles=c.selectedEntitlementList;c.unselectedProfiles=c.unselectedEntitlementList}c.selectedEntitlementList=c.selectedPermissionSet;c.unselectedEntitlementList=c.unselectedPermissionSet;document.getElementById("entitlementRight").innerText=selectedPS;document.getElementById("entitlementLeft").innerText=availablePS}}preEntitlementValue=g};c.nextAccountJS=function(){if(hasNext){c.displaySpinner=true;nextAccounts()}};c.prevAccountJS=function(){if(hasPrevious){c.displaySpinner=true;prevAccounts()}};scope=c}])})();function getIdCSV(c){var b=0;var a="";if(c.length==0){return a}for(b=0;b<c.length;b++){a+=c[b].id+","}a=a.substring(0,a.length-1);return a}function searchCall(b,a){scope.$apply(function(){scope.displaySpinner=true});getSearchAccounts(b,a)}function loadSearchData(){var b=document.getElementById("nextButton");if(hasNext){b.classList.add("active-pagination-key")}else{b.classList.remove("active-pagination-key")}var a=document.getElementById("previousButton");if(hasPrevious){a.classList.add("active-pagination-key")}else{a.classList.remove("active-pagination-key")}scope.$apply(function(){scope.unselectedAccounts=accLeftStoreData;scope.displaySpinner=false;angular.forEach(scope.selectedAccounts,function(c){scope.checkSelectedAccount(c.id,true)});scope.togglePaginationButtons()})}function loadLeftData(a){for(i=0;i<entitlementList.length;i++){if(entitlementList[i].value==entitlementSelectionJS){selectedIndex=i;preEntitlementValue=entitlementSelectionJS;if(entitlementSelectionJS=="0PS"){selectedEntitlementListJS=permissionsetRightStoreData;unselectedEntitlementListJS=permissionsetLeftStoreData;document.getElementById("entitlementRight").innerText=selectedPS;document.getElementById("entitlementLeft").innerText=availablePS}else{selectedEntitlementListJS=profileRightStoreData;unselectedEntitlementListJS=profileLeftStoreData;document.getElementById("entitlementRight").innerText=selectedProfile;document.getElementById("entitlementLeft").innerText=availableProfile}break}}scope.$apply(function(){scope.unselectedAccounts=accLeftStoreData;scope.displaySpinner=false;if(!a){scope.accountSelection=accountSelectionJS;scope.accountSelect.isSelectAllAccounts=accountSelectionJS=="False"?false:true;scope.accountSelect.isSelectedAccounts=accountSelectionJS=="False"?true:false;scope.unselectedProfiles=profileLeftStoreData;scope.selectedProfiles=profileRightStoreData;scope.selectedPermissionSet=permissionsetRightStoreData;scope.unselectedPermissionSet=permissionsetLeftStoreData;scope.entitlementOptions=entitlementList;scope.accountEntitleOption=accountEntitleOptionJS;scope.entitlementSelection=entitlementList[selectedIndex];scope.selectedEntitlementList=selectedEntitlementListJS;scope.unselectedEntitlementList=unselectedEntitlementListJS;if(accountSelectionJS!="False"){scope.toolTipMessage=EntitlementForEveryoneInfo}else{if(accountSelectionJS=="False"&&noAccountEntitlementEnabled){scope.toolTipMessage=NoAccountEntitlementEnableInfo}else{if(accountSelectionJS=="False"&&!noAccountEntitlementEnabled){scope.toolTipMessage=NoAccountEntitlementDisableInfo}}}}scope.actionDataLoaded=true;scope.pagination.hasNext=hasNext;scope.pagination.hasPrevious=hasPrevious;scope.nextButton=document.getElementById("nextButton");scope.prevButton=document.getElementById("previousButton");scope.togglePaginationButtons()});document.getElementById("headerLabel").innerText=unescape(headerName)}function displayErrorMessage(){document.getElementById("saveButton").removeAttribute("disabled");document.getElementById("cancelButton").removeAttribute("disabled");document.getElementById("closePopupIcon").removeAttribute("disabled");if(errorMessageForEntitlment=="Success"){scope.$apply(function(){scope.closePopup()})}else{scope.$apply(function(){scope.displaySpinner=false;scope.displayErrorCommon(errorMessageForEntitlment)})}};