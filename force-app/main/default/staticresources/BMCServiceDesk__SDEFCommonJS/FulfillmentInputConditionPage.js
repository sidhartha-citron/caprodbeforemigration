var pickListArray=new Array(),pickListComboStore,pickListComboBx;var selectedInputValue;Ext.onReady(function(){logOpeStore=new Ext.data.SimpleStore({id:"logOpeStore",data:[["AND","AND"],["OR","OR"],["NONE","NONE"]],fields:["logOpeValue","logOpeName"]});logicalOperator=new Ext.form.field.ComboBox({id:"logicalOperatorCombo",store:logOpeStore,queryMode:"local",triggerAction:"all",valueField:"logOpeValue",displayField:"logOpeName",selectOnFocus:true,renderTo:"qualLogicalOperatorCombo",editable:false,width:"80",height:13,emptyText:logicalConditionHeader});compStore.text=[["=","="],["!=","!="],["LIKE","LIKE"],["NOT LIKE","NOT LIKE"]];compStore.number=[[">",">"],[">=",">="],["=","="],["!=","!="],["<","<"],["<=","<="]];compStore.booleanVar=[["=","="],["!=","!="]];compStore.reference=[["=","="],["!=","!="]];compStore.dateTime=[[">",">"],[">=",">="],["=","="],["!=","!="],["<","<"],["<=","<="]];compStore.textArea=[["LIKE","LIKE"],["NOT LIKE","NOT LIKE"]];comparisonOperator=new Ext.form.field.ComboBox({id:"compareOpCombo",store:compStore.text,queryMode:"local",triggerAction:"all",renderTo:"compareOpDiv",valueField:"comOpeValue",displayField:"comOpeName",editable:false,width:"110",height:13,proxy:{type:"memory",reader:{type:"json"},data:compStore},emptyText:labelOperator});inputsComboStore=new Ext.data.JsonStore({id:"inputStore",data:inputData,proxy:{type:"memory",reader:{type:"json"},data:inputData},fields:["id","type","label","e"]});inputsEditor=new Ext.form.field.ComboBox({id:"inputCombo",store:inputsComboStore,queryMode:"local",triggerAction:"all",valueField:"id",displayField:"label",renderTo:"extFieldList",editable:false,forceSelection:true,width:"100%",height:30,emptyText:inputHeader,tpl:'<tpl for="."><div class="x-boundlist-item">{[fm.htmlEncode(values.label)]}</div></tpl>',listeners:{select:function(g,f,c){comparisonOperator.store.removeAll();var a=f[0].data.type;if(a.indexOf(":")>0){a=a.split(":")[0]}else{if(a.indexOf(EF)>0){a=RFSplit(a,EF)[0]}}var e=f[0].data.id;var b=f[0].data.label;var d=f[0].data.type;var h=f[0].data.e;setComparisonOperatorStore(a);setAddUpdateOnClick(null);setVisibilityData(e,h,b,d);selectedInputValue=e}}});pickListComboStore=new Ext.data.ArrayStore({id:"pickListFieldStore",data:pickListArray,fields:["id","val"],sorters:[{property:"DisplayName",direction:"ASC"}]});pickListComboBx=new Ext.form.field.ComboBox({id:"pickListFieldCombo",store:pickListComboStore,queryMode:"local",triggerAction:"all",valueField:"id",displayField:"val",selectOnFocus:true,editable:false,renderTo:"picklistCombo",hidden:true,width:"100%"});booleanComboStore=new Ext.data.ArrayStore({id:"booleanFieldStore",data:booleanArray,fields:["id","val"]});booleanComboBx=new Ext.form.field.ComboBox({id:"booleanFieldCombo",store:booleanComboStore,queryMode:"local",triggerAction:"all",valueField:"id",displayField:"val",selectOnFocus:true,editable:false,renderTo:"booleanCombo",hidden:true,width:"100%"});conditionGridStore=new Ext.data.SimpleStore({fields:["orderIndex","inputId","inputName","operatorValue","operandValue","ResponseType","groupingOperator"]});ConditionGrid=new Ext.grid.GridPanel({id:"conditionGrid",store:conditionGridStore,columns:[{dataIndex:"orderIndex",header:conditionHeader,sortable:false,menuDisabled:true,flex:1},{dataIndex:"inputId",header:"Input Id",menuDisabled:true,hidden:true},{dataIndex:"inputName",header:inputHeader,sortable:false,menuDisabled:true,flex:2},{dataIndex:"operatorValue",header:operatorHeader,sortable:false,menuDisabled:true,flex:0.8},{dataIndex:"operandValue",header:operandHeader,sortable:false,menuDisabled:true,flex:2},{dataIndex:"ResponseType",hidden:true,menuDisabled:true,},{dataIndex:"groupingOperator",header:logicalConditionHeader,sortable:false,menuDisabled:true,flex:1},{dataIndex:"inputName",flex:0.3,menuDisabled:true,renderer:function(b,c,a){if(b){b='<div style="cursor: pointer;"><img onclick="confirmationOnDelete();" title="'+labelRemove+'" src="'+deleteIconPath+'" /></div>'}return b}}],enableColumnResize:false,enableColumnMove:false,width:"97.3%",height:280,border:false,layout:"fit",viewConfig:{forceFit:true,scrollOffset:0,stripeRows:false},selModel:new Ext.selection.RowModel({mode:"SINGLE"}),listeners:{itemclick:function(a,c,b){setInputDataAndElementsOnRowClick(b.viewIndex)}}});ConditionGrid.render("conditionGridDiv");if(window.parent.infixCondition!=null&&window.parent.infixCondition!=""){getData(window.parent.infixCondition)}else{loadDataToGrids()}hideLoadingMask()});function setVisibilityData(f,h,b,e,a,d,c){isInList=false;var g=inputData.length;selectedApiName=h;selectedLabel=b;if(isInList==false){if(e.indexOf(":")>0){selectedTextAreaLength=e.split(":")[1];e=e.split(":")[0]}popUpString=h;if(e.toLowerCase()=="text field"){assignVisibility("inline","none","none","none","none","none","none",null,1,a)}else{if(e.toLowerCase()=="number"){assignVisibility("inline","none","none","none","none","none","none",null,4,a)}else{if(e.toLowerCase()=="radio button"||e.toLowerCase()=="picklist"){selectedApiName=f;setPickListOptions(f);assignVisibility("none","none","none","none","inline","none","none",null,8,Ext.util.Format.htmlDecode(a))}else{if(e.toLowerCase()=="check box"){assignVisibility("none","none","none","inline","none","none","none",null,2,a)}else{if(e.toLowerCase()=="text area"||e.toLowerCase()=="text area (rich)"){assignVisibility("none","inline","none","none","none","none","none",null,3,a)}else{if(e.toLowerCase()=="lookup"){assignVisibility("inline","none","inline","none","none","none","none",h,5,a)}else{if(e.toLowerCase()=="date/time"){assignVisibility("none","none","none","none","none","block","none",null,6,a)}else{if(e.toLowerCase()=="date"){assignVisibility("none","none","none","none","none","none","block",null,7,a)}}}}}}}}setAddUpdateOnClick(a)}setComparisonOperatorStore(e);if(d!=null&&d!="undefined"){comparisonOperator.setValue(d)}if(c!=null&&c!="undefined"){logicalOperator.setValue(c)}}function setComparisonOperatorStore(a){if(a.indexOf(":")>0){a=a.split(":")[0]}else{if(a.indexOf(EF)>0){a=RFSplit(a,EF)[0]}}if(a.toLowerCase()=="lookup"){comparisonOperator.store.loadData(compStore.reference)}else{if(a.toLowerCase()=="date/time"){comparisonOperator.store.loadData(compStore.dateTime)}else{if(a.toLowerCase()=="date"){comparisonOperator.store.loadData(compStore.dateTime)}else{if(a.toLowerCase()=="text area"||a.toLowerCase()=="text area (rich)"){comparisonOperator.store.loadData(compStore.textArea)}else{if(a.toLowerCase()=="text field"){comparisonOperator.store.loadData(compStore.text)}else{if(a.toLowerCase()=="number"){comparisonOperator.store.loadData(compStore.number)}else{if(a.toLowerCase()=="radio button"||a.toLowerCase()=="check box"||a.toLowerCase()=="picklist"){comparisonOperator.store.loadData(compStore.booleanVar)}}}}}}}comparisonOperator.reset()}function setAddUpdateOnClick(a){if(a!=null&&a!="undefined"){getUpdateBtnEle().style.display="inline";getUpdateBtnEle().style.visibility="visible";getAddBtnEle().style.display="none";getAddBtnEle().style.visibility="hidden"}else{getUpdateBtnEle().style.display="none";getUpdateBtnEle().style.visibility="hidden";getAddBtnEle().style.display="inline";getAddBtnEle().style.visibility="visible"}}function assignVisibility(h,p,m,k,d,b,q,c,l,g){var e=getInputTxtEle();var r=getInputTextAreaEle();var f=getDateTimeInputEle();var j=getDateTimePickerImg();var n=getDateInputEle();var o=getDatePickerImg();var s=getLookupEle();var a=Ext.getCmp("booleanFieldCombo");var i=document.getElementById("inputTxtAreaButtonEle");var t=Ext.getCmp("pickListFieldCombo");if(e!=null&&typeof(e)!="undefined"){e.style.display=h;if(h=="inline"&&g!=null&&g!="undefined"){e.value=g}else{e.value=""}e.disabled=false}if(r!=null&&typeof(r)!="undefined"){r.style.display=p;if(i!=null&&typeof(i)!="undefined"){if(p=="inline"){i.style.display="block"}else{i.style.display="none"}if(p=="inline"&&g!=null&&g!="undefined"){r.value=g}else{r.value=""}}}if(f!=null&&typeof(f)!="undefined"){f.style.display=b;if(j!=null&&typeof(j)!="undefined"){j.style.display=b}if(b=="block"&&g!=null&&g!="undefined"){f.value=g}else{f.value=""}}if(n!=null&&typeof(n)!="undefined"){n.style.display=q;if(o!=null&&typeof(o)!="undefined"){o.style.display=q}if(q=="block"&&g!=null&&g!="undefined"){n.value=g}else{n.value=""}}if(a!=null&&typeof(a)!="undefined"){if(k=="inline"){a.setVisible(true)}else{a.hide()}if(k=="inline"&&g!=null&&g!="undefined"){a.setValue(g)}else{a.value=""}}if(t!=null&&typeof(t)!="undefined"){if(d=="inline"){t.setVisible(true)}else{t.hide();t.reset()}if(d=="inline"&&g!=null&&g!="undefined"){setPickListOptions(selectedApiName);t.setValue(g)}else{t.value=""}}if(m=="inline"){if(s!=null&&typeof(s)!="undefined"){s.disabled=false;s.style.visibility="visible";s.style.display="inline"}if(g!=null&&g!="undefined"){e.disabled=g}e.disabled=true;popUpEnable=true}else{if(s!=null&&typeof(s)!="undefined"){s.style.visibility="hidden";s.style.display="none";s.disabled=true}}compTypeNo=l}var isCalledfromUpdate;function upadateCndData(){var a=ConditionGrid.getSelectionModel().getSelection();addUpdateConditionData(a);isCalledfromUpdate=true}function addCndData(){addUpdateConditionData()}function addUpdateConditionData(i){errorStr="";var g;var d=conditionGridStore.data.length;Ext.define("condRec",{extend:"Ext.data.Model",fields:["orderIndex","inputId","inputName","operatorValue","operandValue","ResponseType","groupingOperator"]});if(i==null||i=="undefined"||typeof(i)=="undefined"){if(d!=null&&d!=""&&d>0){conditionOrderIndex=d+1}else{conditionOrderIndex=1}g=Ext.create(condRec);g.set("orderIndex",conditionOrderIndex)}else{g=i}var c;if(inputsEditor.valueField&&typeof selectedInputValue!="undefined"&&selectedInputValue!=null){c=inputsEditor.findRecord(inputsEditor.valueField,selectedInputValue);selectedInputValue=null}if(!c){c=fetchConditionComboFieldLabel()}if(c!=null&&c!=""&&c!="undefined"){var f=Ext.util.Format.htmlEncode(c.get("label"));if(f!=null&&f!=""&&f!="undefined"){if(g.length>=1){g[0].set("inputId",c.get("id"));g[0].set("inputName",f)}else{g.set("inputId",c.get("id"));g.set("inputName",f)}var a=c.get("type");if(a!=null&&a.indexOf(":")>0){a=a.split(":")[0]}if(g.length>=1){g[0].set("ResponseType",a)}else{g.set("ResponseType",a)}}}else{showExtMsg(OperandErrMsg);return}var e=comparisonOperator.getValue();if(e!=null&&e!=""&&e!="undefined"){if(g.length>=1){g[0].set("operatorValue",e)}else{g.set("operatorValue",e)}}else{showExtMsg(comOpErrMsg);return}var h=logicalOperator.getValue();if(h!=null&&h!=""&&h!="undefined"){if(g.length>=1){g[0].set("groupingOperator",h)}else{g.set("groupingOperator",h)}}else{showExtMsg(logicalOpErrMsg);return}var l;if(compTypeNo=="1"||compTypeNo=="4"||compTypeNo=="5"){var k=getInputTxtEle();if(k!=null&&k!="undefined"){l=k.value}}else{if(compTypeNo=="2"){l=booleanComboBx.getValue()}else{if(compTypeNo=="3"){var j=getInputTextAreaEle();if(j!=null&&j!="undefined"){l=j.value}}else{if(compTypeNo=="6"){l=getDateTimeInputEle().value}else{if(compTypeNo=="7"){l=getDateInputEle().value}else{if(compTypeNo=="8"){l=Ext.util.Format.htmlEncode(pickListComboBx.getValue())}}}}}}var b;if(l!=null&&l!=""&&l!="undefined"){b=validateData(l);if(b){return}else{if(g.length>=1){g[0].set("operandValue",l)}else{g.set("operandValue",l)}}}else{showExtMsg(enterVaErrMsg);return}if(i==null||i=="undefined"||typeof(i)=="undefined"){conditionGridStore.add(g);conditionOrderIndex=conditionOrderIndex+1;clearCriteria()}else{if(isCalledfromUpdate){clearCriteria();isCalledfromUpdate=false;getUpdateBtnEle().style.display="none";getUpdateBtnEle().style.visibility="hidden";getAddBtnEle().style.display="inline";getAddBtnEle().style.visibility="visible"}}ConditionGrid.getView().refresh()}function confirmationOnDelete(){var a=Ext.create("Ext.window.MessageBox");a.baseCls="bmc-message";a.show({msg:CMDBConfirmDelete,width:300,buttons:Ext.MessageBox.YESNO,fn:function(b){if(b=="yes"){removeSLTQData()}},icon:Ext.MessageBox.WARNING})}function removeSLTQData(){var c=ConditionGrid.getSelectionModel().getSelection();if(c!=null&&c!="undefined"){ConditionGrid.store.remove(c);if(conditionOrderIndex>0){conditionOrderIndex=conditionOrderIndex-1}var a=ConditionGrid.store.getCount();for(var b=0;b<a;b++){var d=ConditionGrid.store.getAt(b);d.set("orderIndex",b+1)}ConditionGrid.getView().refresh();inputsEditor.setValue("");comparisonOperator.setValue("");logicalOperator.setValue("");getInputTxtEle().value="";assignVisibility("inline","none","none","none","none","none","none",null,1);setAddUpdateOnClick(null)}}function fetchConditionComboFieldLabel(){var b=inputsEditor.getValue();for(var a=0;a<inputsComboStore.data.length;a++){if(b==inputsComboStore.getAt(a).get("id")){return inputsComboStore.getAt(a)}}return""}function getPickListOptions(b){var f=new Array();var g="";for(var d=0;d<inputData.length;d++){var a=inputData[d];if(b==a.id){g=RFSplit(a.e,PE)}}for(var c=0;c<g.length;c++){var e=RFSplit(g[c],EF);f.push(e[0])}return f}function setPickListOptions(a){var c=Ext.getCmp("pickListFieldCombo");if(c!=null){var d=getPickListOptions(a);pickListArray=new Array();for(var b=0;b<d.length;b++){if(d[b]!=""){pickListArray[b]=[d[b],d[b]]}}pickListComboStore.removeAll();pickListComboStore.loadData(pickListArray);pickListComboBx.setVisible(true)}}function showExtMsg(a){errorStr=a;valueSetToastPoUp(a,"Error")}function validateData(b){var a=false;if(compTypeNo!=0){if(compTypeNo==4){if(isNaN(b)){a=true;showExtMsg(invalidNumberLabel)}}}return a}function setInputDataAndElementsOnRowClick(k){var n=ConditionGrid.store.getAt(k);var b=n.get("inputName");var a=n.get("inputId");var c=n.get("operandValue");var f=Ext.util.Format.htmlDecode(n.get("operatorValue"));var l=n.get("groupingOperator");var h=n.get("ResponseType");var m="";if(a!=null&&a!="undefined"){inputsEditor.setValue(a);var e=fetchConditionComboFieldLabel();var d=e.get("type");if(d!=null&&d.indexOf(":")>0){var j=d.split(":")[1];if(j!=null&&typeof(j)!="undefined"&&j!=""){selectedTextAreaLength=j}}for(var g=0;g<inputsComboStore.data.length;g++){if(a==inputsComboStore.getAt(g).get("id")){m=inputsComboStore.getAt(g).get("e")}}}setVisibilityData(a,m,b,h,c,f,l)}function openLookupRF(){var a="";var c=(screen.width-1000)/2;var b=parseInt((screen.height/2)-(600/2))-50;a="SearchAndLink?txt=selectlookupValues&parentName=SRM_RequestDefinition__c&childName="+popUpString+"&isLookUp=true&NewLookUpType=&filterId=active_custom&searchLookUpStr=&isCustomLookup=false&isSRD=true";window.open(a,"__blank","status = 1,height =600, width = 1000,left="+c+",top="+b+",resizable = 0,scrollbars=yes")}function clearCriteria(){if(compTypeNo=="1"||compTypeNo=="4"||compTypeNo=="5"){var c=getInputTxtEle();if(c!=null&&c!="undefined"){c.value=""}}else{if(compTypeNo=="2"){operandVal=booleanComboBx.setValue("")}else{if(compTypeNo=="3"){var b=getInputTextAreaEle();if(b!=null&&b!="undefined"){b.value=""}}else{if(compTypeNo=="6"){var d=getDateTimeInputEle();if(d!=null&&d!="undefined"){d.value=""}}else{if(compTypeNo=="7"){var a=getDateInputEle();if(a!=null&&a!="undefined"){a.value=""}}else{if(compTypeNo=="8"){operandVal=pickListComboBx.setValue("")}}}}}}inputsEditor.setValue("");comparisonOperator.setValue("");logicalOperator.setValue("")}function setReferenceToVal(b){if(b.indexOf(EF)>0){referenceId=b.split(EF)[0];referenceName=b.substring(referenceId.length+1,b.length)}referenceName=decodeVal(referenceName);var a=getInputTxtEle();if(a!=null&&typeof(a)!="undefined"){a.value=referenceName;var c=document.getElementById("referenceID");if(c!=null&&typeof(c)!="undefined"){c.value=referenceId}}}function decodeVal(a){a=a.replace("&gt;",">","g");a=a.replace("&lt;","<","g");a=a.replace("&quot;",'"',"g");a=a.replace("&amp;","&","g");return a}if(typeof(SDEDateFormat)=="undefined"||SDEDateFormat==null||SDEDateFormat==""){this.SDEDateFormat="m/d/Y h:i A"}ConditionDatePickerPopup=function(){};ConditionDatePickerPopup.prototype={dateFormat:SDEDateFormat,selectHandler:function(e,d){this.TextField.dom.value=Ext.Date.format(d,e.format);var a=this.TextField.dom.id;if(a.indexOf("inputDate")>0){var b=document.getElementById(a).value;var c=b.split(" ");cdateFormat=c[1];this.TextField.dom.value=c[0].replace(",","")}dataModifiedFlag=1;this.TextField=null;e.hide();e.winHandle.close()},Show:function(b){this.TextField=Ext.get(b);var g=new Ext.DatePicker({startDay:1,listeners:{select:this.selectHandler.bind(this)}});try{var c=Date.parseDate(this.TextField.dom.value,this.dateFormat);g.setValue(c)}catch(f){}var a=this.TextField.getRegion();var d=new Ext.Window({x:a.right-175,y:a.top-1,bodyStyle:"background-color:#FFFFFF;",cls:"RFAdminWindow whiteBackgroud",animCollapse:true,header:true,modal:true,autoHeight:true,width:200,layout:"fit",frame:false,closable:false,tools:[{id:"rfclose",handler:function(i,h,e){d.close()}}],closeAction:"destroy"});d.add(g);g.winHandle=d;d.show()}};var _datePicker=new ConditionDatePickerPopup();function showDateTimePicker(){var a=getDateTimeInputEle();_datePicker.Show(a)}function showDatePicker(){var a=getDateInputEle();_datePicker.Show(a)}function setConditionsData(){var c="";var b=0;while(conditionGridStore.data.length>b){if(conditionGridStore.data.length-1!=b&&conditionGridStore.getAt(b).get("groupingOperator")=="NONE"||conditionGridStore.data.length-1==b&&conditionGridStore.getAt(b).get("groupingOperator")!="NONE"){showExtMsg(conditionOperatorLabel);break}else{c=c+conditionGridStore.getAt(b).get("orderIndex")+getSeparatorByCustomSetting(PE)+conditionGridStore.getAt(b).get("inputId")+getSeparatorByCustomSetting(PE)+Ext.util.Format.htmlDecode(conditionGridStore.getAt(b).get("inputName"))+getSeparatorByCustomSetting(PE)+Ext.util.Format.htmlDecode(conditionGridStore.getAt(b).get("operatorValue"))+getSeparatorByCustomSetting(PE)+Ext.util.Format.htmlDecode(conditionGridStore.getAt(b).get("operandValue"))+getSeparatorByCustomSetting(PE)+conditionGridStore.getAt(b).get("ResponseType")+getSeparatorByCustomSetting(NONPRINT);if(conditionGridStore.data.length-1!=b&&conditionGridStore.getAt(b).get("groupingOperator")!="NONE"){c=c+conditionGridStore.getAt(b).get("groupingOperator")+getSeparatorByCustomSetting(NONPRINT)}}b++}var a=getInfixStrEle();a.value=c}function okBtnHandler(){setConditionsData();assignConditionData()}function setCondtionValue(){if(errorMsg==""||errorMsg=="undefined"){if(errorStr==""||errorStr=="undefined"){var a=new Array(2);a[0]=conditionValue;a[1]=postfixString;parent.setPopUpVar(a);parent.rfPopUpClose("rfModalVFPage")}}else{showError()}}function valueSetToastPoUp(a,c){var d=getElementValue("rfToastPopop");var b=getElementValue("mainContentToastPopup");var c=getElementValue("themeToast");var e=getElementValue("themeIconPopup");if(promptDom&&promptDom.style.display=="none"){promptDom.style.display="block";if(c.classList.contains("slds-theme_info")){c.classList.remove("slds-theme_info")}else{if(c.classList.contains("slds-theme_success")){c.classList.remove("slds-theme_success")}else{if(c.classList.contains("slds-theme_warning")){c.classList.remove("slds-theme_warning")}}}if(!c.classList.contains("slds-theme_error")){c.classList.add("slds-theme_error")}b.innerText=a}};