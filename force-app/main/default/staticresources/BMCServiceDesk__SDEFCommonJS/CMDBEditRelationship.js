var ciList,InstancesGrid,isSource=false,isDestination=true,searchstring="";var selectedClassID;var _ciRelEditValues=window.parent._ServerValues;var sortdirection="";var sortfield="";var pattern=/[a-zA-Z0-9]{15}|[a-zA-Z0-9]{18}/;var pagingBar={};var iPageSize=27;var sURL;var WinMsg;var removedInstances=[];var instanceListTable=document.getElementById("tableID");var singleFormHtml=RemedyForceHTMLProcessor.getElementHTML(instanceListTable);var contentBeforeSave="";var instanceListTable;var tableComponent;var sourceTableComponent;var destinationImageComponent;var selectedCountSpan;var clearALL;var relationshipNameField;var markasDeleteFieldComp;var isSaved=false;var selectedInstanceIds=[];function getRequiredElements(){instanceListTable=document.getElementById("tableID");tableComponent=document.getElementById("second_instance_table");sourceTableComponent=document.getElementById("first_instance_table");destinationImageComponent=document.getElementById("destinationImage");selectedCountSpan=document.getElementById("countValue");clearALL=document.getElementById("clearAll");relationshipNameField=document.getElementById(relationshipNameId);markasDeleteFieldComp=document.getElementById(markasDeleteField)}Ext.onReady(function(){windowloaddate=new Date();networklatencystart=windowloaddate.getTime();var c=networklatencystart-etime;data+=_ServerValues.NetwokLatencyLabel;data+=c;data+="<br>";Ext.QuickTips.init();ExtOnPageReady();data+=_ServerValues.PageLoadLabel;var e=new Date();var d=e.getTime();var b=windowloaddate.getTime();var a=(d-renderingstartitme);data+=a;enableButton()});function ReplaceAll(e,b,d){var c=e;var a=c.indexOf(b);while(a!=-1){c=c.replace(b,d);a=c.indexOf(b)}return c}function valselected(a){selectedList=[];showWaitMsgBar("relationship_editor");if(a.length>1){getSelectedInstances(a);disableFormInputs(true)}else{if(a.length==1){selectOtherCI(a,currentDir)}}dataModifiedFlag=1}function createInstanceTags(){RemedyForceHTMLProcessor.clearHTML(instanceListTable);destinationImageComponent.src=destinationImage;destinationImageComponent.style.display="inline";removedInstances=[];tableComponent.style.overflowY="auto";tableComponent.style.paddingTop="10px";tableComponent.style.height=sourceTableComponent.offsetHeight+"px";var d=tableComponent.offsetWidth;var f=instanceListTable.insertRow(0);var a=f.insertCell(0);a.className="tdStyle";var e="<b>"+_ServerValues.SelectedInstances+": <span id='countValue'>"+selectedList.length+"</span></b> <span id='clearAll' onclick='clearSelection()' class='removeIcon clearAll pointer-event-hand'><b>"+_ServerValues.ClearAll+" </b></span>";RemedyForceHTMLProcessor.parseHTML(a,e);for(var c=0;c<selectedList.length;c++){var f=instanceListTable.insertRow(-1);var a=f.insertCell(0);f.id=selectedList[c].Id+"_row";var b=d*0.92+"px";var g="<div class='clsInputTextBoxTD' style='width:"+b+"' > <div class='tags' onmouseover='mousehover(event,"+c+" )' id='"+selectedList[c].Id+"__innerDiv'><div id='"+selectedList[c].Id+"'  class='spanStyle' style='width:89%; min-width:220px;'>"+selectedList[c][Object.keys(tooltipFieldsLabel)[0]]+"</div> <div class='removeIcon spanStyle float-right pointer-event-hand rf-icon-cross' onclick='deleteRow(\""+f.id+"\")'/></div></div>";RemedyForceHTMLProcessor.parseHTML(a,g);tableComponent.style.width="89%"}changeClearAllPadding()}function selectCiToRelate(){if(selectedList.length>1&&removedInstances.length!=selectedList.length){GetMessageBox("bmc-message").show({title:_ServerValues.selecteCMDBInstanceLabel,msg:_ServerValues.ClearSelectionWarningMessage,width:400,buttons:Ext.Msg.YESNO,fn:function(e){if(e=="yes"){clearSelection();selectCiToRelate()}},icon:Ext.MessageBox.WARNING});return}var b=window.innerHeight*0.95;var a=window.innerWidth-300;console.log(b+" winWidth "+a);if(a<1000){a=1000}var d=parseInt((screen.availWidth/2)-(a/2));var c=parseInt((screen.availHeight/2)-(b/2));window.open("/apex/CMDBManager?isFromRelationship=true&InstanceID="+srcInstanceId,"lookup","status = 1,height ="+b+", width = "+a+",left= "+d+",top="+c+", resizable = yes,scrollbars=no")}function clearSelection(){RemedyForceHTMLProcessor.parseHTML(instanceListTable,singleFormHtml);tableComponent.style.overflow="hidden";tableComponent.style.paddingTop="0px";selectedList=[];disableFormInputs(false);destinationImageComponent.style.display="none";changeClearAllPadding()}function disableRemovalOfinstance(){clearALL.visibility="hidden";for(var b=0,a=document.querySelectorAll(".removeIcon");b<a.length;b++){a[b].style.visibility="hidden"}}function changeClearAllPadding(){if(!clearALL){clearALL=document.getElementById("clearAll")}if(clearALL){if(tableComponent.scrollHeight>tableComponent.clientHeight){clearALL.style.paddingRight="4%"}else{clearALL.style.paddingRight="8%"}}}function deleteRow(b){var c=document.getElementById(b);instanceListTable.deleteRow(c.rowIndex);removedInstances.push(b.split("_row")[0]);if(!selectedCountSpan){selectedCountSpan=document.getElementById("countValue")}var a=selectedList.length-removedInstances.length;RemedyForceHTMLProcessor.setText(selectedCountSpan,a);changeClearAllPadding();if(a==0){if(!clearALL){clearALL=document.getElementById("clearAll")}clearALL.visibility="hidden";clearSelection()}}function disableFormInputs(a){getRequiredElements();relationshipNameField.disabled=a;markasDeleteFieldComp.disabled=a;if(a){document.getElementById(expandImage).classList.add("pointer-event-none");relationshipNameField.value=_ServerValues.Auto_Generate;document.getElementById(required).style.display="none"}else{document.getElementById(expandImage).classList.remove("pointer-event-none");relationshipNameField.value="";relationshipNameField.style.color="";document.getElementById(required).style.display="inline"}}function MainPanelRender(){createControlMap();renderElementsByType();try{if(contentBeforeSave&&selectedList.length>1){isSaved=true;getRequiredElements();RemedyForceHTMLProcessor.parseHTML(document.getElementById("tableID"),contentBeforeSave);contentBeforeSave="";disableFormInputs(true);tableComponent.style.height=sourceTableComponent.offsetHeight+"px";tableComponent.style.overflowY="scroll";tableComponent.style.paddingTop="10px";if(_ServerValues.savestatus){disableRemovalOfinstance()}else{if(relationshipNameField.value==_ServerValues.Auto_Generate){relationshipNameField.value=""}}destinationImageComponent.src=destinationImage;destinationImageComponent.style.display="inline"}else{if(selectedList.length==1){selectedList=[]}}}catch(a){console.log(a)}}function onSaveComplete(){MainPanelRender();dirCombo=getDirectionCombo();ShowStatusMessage();var b;if(isStdForm){b=window.parent.parent.parent.relEditorPanel}else{b=window.parent.relEditorPanel}if(b!=null&&b!="undefined"){var a=b.title;var d='<button id="back_button" type="button" role="button" title="'+backLabel+'" onclick="CMDBManagerNamespace.instance.CloseFormPanel();"><span>&lt; '+backLabel+"</span></button>";var c='<span class="instance_editor_title" style="margin-left: 3px;">'+Ext.util.Format.htmlEncode(classNameTitle)+" / "+_ServerValues.CMDBRelationshipEditor+": "+relationshipName.replace(/</g,"&lt;")+"</span >";b.setTitle(d+c);a=b.title}}function ExtOnPageReady(){var a=[{xtype:"tbspacer",width:5},{scale:"medium",border:false,tooltipType:"title",tooltip:_ServerValues.Save,id:"saveId",baseCls:"bmc-btn-primary",disabledCls:"bmc-btn-primary-disabled",focusCls:"bmc-btn-primary-focus",overCls:"bmc-btn-primary-over",pressedCls:"bmc-btn-primary-pressed",text:_ServerValues.Save,listeners:{mouseover:function(){this.setIconCls("bmcSaveOn")},mouseout:function(){this.setIconCls("bmcSave")}},handler:function(){setDataModifiedFlag();selectedInstanceIds=selectedList?selectedList.map(function(g){return g.Id}):[];if(selectedList.length>0){if(removedInstances.length>0){for(var f=removedInstances.length-1;f>=0;f--){for(var e=selectedInstanceIds.length-1;e>=0;e--){if(removedInstances[f]==selectedInstanceIds[e]){selectedInstanceIds.splice(e,1);selectedList.splice(e,1);break}}}}}if(selectedInstanceIds.length>1){showWaitMsgBar("relationship_editor");CreateMultpleRelationship(selectedInstanceIds.join(","),currentDir);contentBeforeSave=RemedyForceHTMLProcessor.getElementHTML(instanceListTable)}else{if(selectedInstanceIds.length==1){if(window.parent!=null){showWaitMsgBar("relationship_editor")}CreateMultpleRelationship(selectedInstanceIds.join(","),currentDir)}else{var d=getrelationshipName().value;d=d.trim();if(d!=null&&d!=""){if(window.parent!=null){showWaitMsgBar("relationship_editor")}SaveClick(currentDir,"")}else{GetMessageBox("bmc-message").alert("",_ServerValues.requiredAllFieldBRActionPage)}}}}},{xtype:"tbspacer",width:5},"-",{xtype:"tbspacer",width:5},{scale:"medium",iconCls:"bmcCIExplorer",disabled:isNewRec,tooltipType:"title",tooltip:_ServerValues.LaunchCIExplorerLabel,id:"ciExplorerBtn",listeners:{disable:function(){this.setIconCls("bmcCIExplorer disablecss")},enable:function(){this.setIconCls("bmcCIExplorer")}},handler:function(){window.parent.ShowCIExplorer(srcInstanceId)}},"->"];if(userlocale=="iw"){a.reverse()}var b=new Ext.Toolbar({id:"toolBarId",cls:"toolSpCls",renderTo:"ToolBarTD",border:false,autoWidth:true,items:a});dirCombo=getDirectionCombo();MainPanelRender();try{window.parent.ActiveReleationInstanceReference=this}catch(c){}Ext.MessageBox.buttonText.ok=_ServerValues.ExtjsMessageOK;Ext.MessageBox.buttonText.yes=_ServerValues.ExtjsMessageYes;Ext.MessageBox.buttonText.no=_ServerValues.ExtjsMessageNo;Ext.MessageBox.buttonText.cancel=_ServerValues.ExtjsMessageCancel}function getDirectionCombo(){var a=new Ext.ux.IconCombo({id:"directionComboId",bodyStyle:"padding:10px",renderTo:"directionsPicklist",store:getDirectionComboStore(),xtype:"iconCombo",displayField:"dir_desc",valueField:"dir_fromto",iconClsField:"dir_css",triggerAction:"all",editable:false,width:"63%",triggerCls:"d-icon-triangle_down",cls:"textIndent4px",listeners:{afterrender:function(b){this.setValue("")},change:function(d,c,b){}}});return a}function getDirectionComboStore(){var a;if(userlocale=="iw"){if(currentDir=="lr"){a=Ext.create("Ext.data.Store",{fields:["dir_desc","dir_fromto","dir_css"],data:[{dir_desc:"",dir_fromto:"direction_rl",dir_css:"ux-direction-lr"},{dir_desc:"",dir_fromto:"direction_lr",dir_css:"ux-direction-rl"}]})}else{a=Ext.create("Ext.data.Store",{fields:["dir_desc","dir_fromto","dir_css"],data:[{dir_desc:"",dir_fromto:"direction_lr",dir_css:"ux-direction-rl"},{dir_desc:"",dir_fromto:"direction_rl",dir_css:"ux-direction-lr"}]})}}else{if(currentDir=="lr"){a=Ext.create("Ext.data.Store",{fields:["dir_desc","dir_fromto","dir_css"],data:[{dir_desc:"",dir_fromto:"direction_lr",dir_css:"ux-direction-lr"},{dir_desc:"",dir_fromto:"direction_rl",dir_css:"ux-direction-rl"}]})}else{a=Ext.create("Ext.data.Store",{fields:["dir_desc","dir_fromto","dir_css"],data:[{dir_desc:"",dir_fromto:"direction_rl",dir_css:"ux-direction-rl"},{dir_desc:"",dir_fromto:"direction_lr",dir_css:"ux-direction-lr"}]})}}return a}function changeArrowImage(c){if(c=="ux-direction-lr"){var b=getArrow_lrEle();if(b!=null&&b!="undefined"){b.style.visibility="visible";b.style.width="50px"}var a=getArrow_rlEle();if(a!=null&&a!="undefined"){a.style.visibility="hidden";a.style.width="0px"}currentDir="lr"}else{if(c=="ux-direction-rl"){var b=getArrow_lrEle();if(b!=null&&b!="undefined"){b.style.visibility="hidden";b.style.width="0px"}var a=getArrow_rlEle();if(a!=null&&a!="undefined"){a.style.visibility="visible";a.style.width="50px"}currentDir="rl"}}}function changeImageCombo(a){if(userlocale=="iw"){if(a=="Source-Destination"){changeArrowImage("ux-direction-rl");currentDir=="rl";dirCombo.destroy();dirCombo=getDirectionCombo()}else{if(a=="Destination-Source"){changeArrowImage("ux-direction-lr");currentDir=="lr";dirCombo.destroy();dirCombo=getDirectionCombo()}}}else{if(a=="Source-Destination"){changeArrowImage("ux-direction-lr");currentDir=="lr";dirCombo.destroy();dirCombo=getDirectionCombo()}else{if(a=="Destination-Source"){changeArrowImage("ux-direction-rl");currentDir=="rl";dirCombo.destroy();dirCombo=getDirectionCombo()}}}}var prevSel;function enableDisableSaveAndSelectInstBtn(){var a=Ext.getCmp("saveId");if(isAssetManagementEnabled&&isCIManagementEnabled){if(instanceType.toLowerCase()=="ci"){if(updateCI){a.setDisabled(false)}else{a.setDisabled(true)}}else{if(instanceType.toLowerCase()=="asset"){if(updateAsset){a.setDisabled(false)}else{a.setDisabled(true)}}else{if(instanceType.toLowerCase()=="ci / asset"){if(tabName.toLowerCase()=="ci"){if(updateCI){a.setDisabled(false)}else{a.setDisabled(true)}}else{if(tabName.toLowerCase()=="asset"){if(updateAsset){a.setDisabled(false)}else{a.setDisabled(true)}}else{if(updateCI&&updateAsset){a.setDisabled(false)}else{a.setDisabled(true)}}}}else{if(!isAssetManagementEnabled&&isCIManagementEnabled){if(updateCI){a.setDisabled(false)}else{a.setDisabled(true)}}else{if(isAssetManagementEnabled&&!isCIManagementEnabled){if(updateAsset){a.setDisabled(false)}else{a.setDisabled(true)}}}}}}}}function showWaitMsgBar(a){waitingMask=new Ext.LoadMask(document.getElementById(a),{floating:{shadow:false},msgCls:"d-loader-container",msg:'<ul class="d-loading"><li class="d-loading__stick d-loading__stick_1"></li><li class="d-loading__stick d-loading__stick_2"></li><li class="d-loading__stick d-loading__stick_3"></li><li class="d-loading__stick d-loading__stick_4"></li><li class="d-loading__stick d-loading__stick_5"></li><li class="d-loading__stick d-loading__stick_6"></li><li class="d-loading__stick d-loading__stick_7"></li><li class="d-loading__stick d-loading__stick_8"></li><li class="d-loading__stick d-loading__stick_9"></li><li class="d-loading__stick d-loading__stick_10"></li><li class="d-loading__stick d-loading__stick_11"></li><li class="d-loading__stick d-loading__stick_12"></li></ul><div>'+pleaseWaitMsg+"</div>"});if(typeof(waitingMask)!="undefined"&&waitingMask!=null&&waitingMask!=""){waitingMask.show()}}function hideWaitMsgBar(){if(typeof(waitingMask)!="undefined"&&waitingMask!=null&&waitingMask!=""){waitingMask.hide()}}function GetMessageBox(a){if(WinMsg==null){WinMsg=Ext.create("Ext.window.MessageBox")}WinMsg.baseCls=a;return WinMsg}function getTooltipHtml(a,e){var d="";var c="<table><tbody>";for(var b in tooltipFieldsLabel){if(isSaved){a=selectedInstanceIds.indexOf(e)}if(selectedList[a].hasOwnProperty(b)&&selectedList[a][b]){c+='<tr><td valign="top"><b>'+tooltipFieldsLabel[b]+'</b></td><td class="rfDPL-tooltip-content-td rfDPL-tooltip-content-anchor-tag-td longNameEllipsis">'+selectedList[a][b]+"</td></tr>"}}c+="</tbody></table>";d+=c;return d}function mousehover(c,a){var b=c.target;if(b.id){var d=b.id.split("_")[0];if(typeof userTooltip==="undefined"){userTooltip=Ext.create("Ext.tip.ToolTip",{target:b.id,anchor:"left",shadow:false,autoWidth:true,autoHide:true,baseCls:"rfDPL-tooltip-container",bodyCls:"rfDPL-tooltip-body",html:null})}else{userTooltip.setTarget(b.id)}userTooltip.update(getTooltipHtml(a,d));userTooltip.show()}};