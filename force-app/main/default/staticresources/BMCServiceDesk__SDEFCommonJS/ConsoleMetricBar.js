var cardDetails=[];var availableMetrics=[];var selectedMetric=[];var selectedCard;var visibleCards;var cellWidth;var activeListViewId;var activeCardId="";var selectedCards;var consoleMetricCardLoded=false;var refreshMetricBarTimer;var isCurrentTabIsForm=false;$("#metrics").hide();setTimeout(function(){showMetrics(true)},1000);attachEvent();function toggelLoader(){var a=document.getElementById("metrics");a.classList.toggle("disabledDiv");$("#metricBarLoader").toggleClass("inline-block")}function getAvailableMetricCards(){popUploader(true);Visualforce.remoting.Manager.invokeAction(getCardsTodisplay,true,function(a,d){if(d.status){availableMetrics=a;for(var c=0;c<selectedMetric.length;c++){var b=availableMetrics.map(function(f){return f.metricId}).indexOf(selectedMetric[c].metricId);if(b>-1){availableMetrics.splice(b,1)}}createSelectBox("availableCards",availableMetrics);createSelectBox("selectedCards",selectedMetric,visibleCards);setSelectable()}},{escape:false})}function updateCards(){$("#metricIcon").parent().css({"pointer-events":"none"});resetAutoRefreshWorkDay();if(consoleMetricCardLoded){toggelLoader()}Visualforce.remoting.Manager.invokeAction(getCardsTodisplay,false,function(l,a){if(a.status){$("#metricIcon").parent().css({"pointer-events":""});cardDetails=l;if(consoleMetricCardLoded){toggelLoader()}if(cardDetails.length==0){document.getElementById("tableID").style.display="none";document.getElementById("no-record-found").style.display="";$("#metrics").show();$("#metricIcon").removeClass("metric-icon");return}else{document.getElementById("tableID").style.display="";document.getElementById("no-record-found").style.display="none"}selectedMetric=l;var h=document.getElementById("tableID");RemedyForceHTMLProcessor.clearHTML(h);cellWidth=100/5;if(cardDetails.length>=5){cellWidth=100/cardDetails.length}var k=h.insertRow(0);k.setAttribute("id","matric-bar-row");for(var d=0;d<cardDetails.length;d++){var f=k.insertCell(d);f.setAttribute("class","matric-bar-cell");f.setAttribute("width",cellWidth+"%");f.setAttribute("data-id",cardDetails[d].metricId);var e=cardDetails[d].prefix=="IN/SR"?"IN":cardDetails[d].prefix;var b="";if(cardDetails[d].prefix=="IN/SR"){b='style="width: 40px !important;"'}var c='<div class="card" onkeydown="openOnEnter(event)" tabindex="0" id="'+cardDetails[d].metricId+'" name="cards" onclick="loadGrid(this,\''+cardDetails[d].listViewId+"','"+cardDetails[d].moduleId+'\')"><span class="drag-drop-Image"></span><span '+b+' class="object-Prefix '+e+'-prefix">'+cardDetails[d].prefix+'</span><div class="card-body"><div class="number" style="color:'+cardDetails[d].colorCode+'!important" >'+cardDetails[d].resultCount+'</div><div id="'+cardDetails[d].metricId+'__title" class="metricTitle"></div></div></div>';RemedyForceHTMLProcessor.parseHTML(f,c);var g=document.createTextNode(cardDetails[d].cardTitle);document.getElementById(cardDetails[d].metricId+"__title").appendChild(g);document.getElementById(cardDetails[d].metricId).setAttribute("title",cardDetails[d].cardTitle)}if(!consoleMetricCardLoded){showMetrics(true)}setActiveCard();$("#matric-bar-row").sortable({placeholder:"placeholder",revert:150,start:function(m,i){placeholderWidth=i.item.outerWidth();i.placeholder.width(placeholderWidth);$('<td class="placeholder-animator" onclick="setBackgroud()" data-width="'+placeholderWidth+'"></td>').insertAfter(i.placeholder);$(this).attr("dragging",true)},change:function(i,m){m.placeholder.stop().width(0).animate({width:m.item.outerWidth()},200);placeholderAnimatorwidth=parseInt($(".placeholder-animator").attr("data-width"));$(".placeholder-animator").stop().width(placeholderAnimatorwidth).animate({width:0},200,function(){$(this).remove();placeholderWidth=m.item.outerWidth();$('<td class="placeholder-animator" data-width="'+placeholderWidth+'"></td>').insertAfter(m.placeholder)})},stop:function(m,i){$(".placeholder-animator").remove();$(m.target).attr("dragging",false);getVisibleCards();if(visibleCards){Visualforce.remoting.Manager.invokeAction(saveSelectedMetricCards,visibleCards,function(n,o){if(o.status){}},{escape:false})}}});if(cardDetails.length>0&&cardDetails.length<5){var j=cardDetails.length;k=document.getElementById("matric-bar-row");while(j<5){var f=k.insertCell(d);f.setAttribute("class","matric-bar-cell");f.setAttribute("width",cellWidth+"%");j++}}}},{escape:false})}function setActiveCard(b,a,d){if(d){d=d.toString();if(d.startsWith("view")||d=="firstTab"){isCurrentTabIsForm=false;if(showMetricBar){$("#metrics").show();$("#metricIcon").removeClass("metric-icon")}}else{if(!d.startsWith("view")){isCurrentTabIsForm=true;if(!showMetricBarForForms){$("#metrics").hide();$("#metric-setting-popup").hide();$("#metricIcon").addClass("metric-icon")}}}}if(selectedCard&&b=="undefined"){selectedCard="";return}$(".active-card").toggleClass("active-card");if(b=="undefined"){activeCardId="";selectedCard="";activeListViewId="";return}if(a){a.classList.toggle("active-card");if(activeCardId==a.id){selectedCard=""}activeCardId=a.id;return}if(b){activeListViewId=b}if(activeCardId){$("#"+activeCardId).toggleClass("active-card");return}if(activeListViewId&&!consoleMetricCardLoded){consoleMetricCardLoded=true}for(var c=0;c<cardDetails.length;c++){if(cardDetails[c].listViewId==activeListViewId){$("#"+cardDetails[c].metricId).toggleClass("active-card");activeCardId=cardDetails[c].metricId;return}}}function openOnEnter(d){var c=d.which||d.keyCode;if(c==13||c==32){var a=d.target.id;if(a){for(var b=0;b<cardDetails.length;b++){if(cardDetails[b].metricId==a){loadGrid(d.target,cardDetails[b].listViewId,cardDetails[b].moduleId);return}}}}}function loadGrid(b,a,c){if($("#matric-bar-row").attr("dragging")=="true"){return}selectedCard=b;setActiveCard("",b);if(b){activeListViewId=a;openSelectedListView(c,false,a)}}function showMetrics(d){$("#metrics").removeClass("disabledDiv");var a="";var c=false;if(!d){if(isCurrentTabIsForm){a="ConsolePreferences__c";showMetricBarForForms=!showMetricBarForForms;c=showMetricBarForForms}else{a="showMetricBar__c";showMetricBar=!showMetricBar;c=showMetricBar}Visualforce.remoting.Manager.invokeAction(updateShowMetricBar,c,a,function(e,f){if(!e){console.log("error occured during save showMetricBar "+showMetricBar)}else{console.log("updated successful")}},{escape:false})}if(showMetricBarForForms&&isCurrentTabIsForm){showMetricBar=true}if(showMetricBar&&!document.getElementById("matric-bar-row")){updateCards();return}var b=showMetricBar;if(isCurrentTabIsForm){b=showMetricBarForForms}if(b){$("#metricIcon").removeClass("metric-icon");$("#metrics").show()}else{$("#metricIcon").addClass("metric-icon");$("#metrics").hide();$("#metric-setting-popup").hide()}}function cancelPopup(){$("#metric-setting-popup").hide();setBackgroundDisable()}function getVisibleCards(){visibleCards=[];$(".matric-bar-cell").each(function(a,b){if(b.getAttribute("data-id")){visibleCards.push(b.getAttribute("data-id"))}})}function toggleMetricSettingPopup(){getVisibleCards();setBackgroundDisable();$("#metric-setting-popup").toggle();if($("#metric-setting-popup").is(":visible")){getAvailableMetricCards()}}function popUploader(b){var c=document.getElementById("metricBarPopUpLoader");var a=document.getElementById("loaderDiv");if(c&&a){if(b){c.style.display="inline-block";a.style.display=""}else{c.style.display="none";a.style.display="none"}}}function createSelectBox(b,e,j){var g=document.getElementById(b);RemedyForceHTMLProcessor.clearHTML(g);var f=undefined;if(!j){j=e}else{f=e.map(function(i){return i.metricId})}for(var c=0;c<j.length;c++){var d=j[c];if(f){d=e[f.indexOf(j[c])]}if(d){var a=document.createElement("div");a.setAttribute("class","column-configurator__column");a.setAttribute("tabIndex","-1");a.setAttribute("title",d.cardTitle);a.setAttribute("id",d.metricId);a.ondblclick=function(){if(this.parentElement.id=="availableCards"){moveMetricCardRight("availableCards")}else{if(this.parentElement.id=="selectedCards"){moveMetricCardLeft("selectedCards")}}};var h=document.createTextNode(d.cardTitle);a.appendChild(h);g.appendChild(a)}}}function moveMetricCardRight(a){var c=$("#"+a).children(".ui-selected");var b=c.length;c=c.toggleClass("ui-selected");if($("#selectedCards").children().length+b<=8){$("#selectedCards").append(c)}}function moveMetricCardLeft(a){var b=$("#"+a).children(".ui-selected");b=b.toggleClass("ui-selected");$("#availableCards").append(b)}function setSelectable(){popUploader(false);$("#selectedCards div, #availableCards div").click(function(){var a=$(this)[0].parentElement.id;$("#"+a+" .ui-selected").toggleClass("ui-selected");$(this).toggleClass("ui-selected")})}function attachEvent(){if(!String.prototype.startsWith){String.prototype.startsWith=function(b,a){a=a||0;return this.indexOf(b,a)===a}}$("#moveTop").click(function(b){b.preventDefault();var a=$("#selectedCards");$("#selectedCards .ui-selected").each(function(d,e){if($(e).index()>0){var c=$(e).index();while(c>0){jQuery($(a).children().eq(c-1)).before(jQuery($(a).children().eq(c)));c=c-1}}})});$("#up").click(function(b){var a=$("#selectedCards");b.preventDefault();$("#selectedCards .ui-selected").each(function(d,e){if($(e).index()>0){var c=$(e).index()-1;jQuery($(a).children().eq(c)).before(jQuery($(a).children().eq(c+1)))}})});$("#down").click(function(f){f.preventDefault();var c=$("#selectedCards");var b=$(c).children().length;var g=$("#selectedCards .ui-selected");if(g.length>0){var d=g[0];if($(d).index()<b){var a=$(d).index()+1;jQuery($(c).children().eq(a)).after(jQuery($(c).children().eq(a-1)))}}});$("#moveBottom").click(function(f){f.preventDefault();var c=$("#selectedCards");var b=$(c).children().length;var g=$("#selectedCards .ui-selected");if(g.length>0){var d=g[0];if($(d).index()<b){var a=$(d).index();while(a<b){jQuery($(c).children().eq(a+1)).after(jQuery($(c).children().eq(a)));a=a+1}}}})}function setBackgroundDisable(){var c=document.getElementsByClassName("rf-tab-div");var b=document.getElementById("metrics");var a=document.getElementById("rf-ticker");if(c&&b&&a){c[0].classList.toggle("disabledDiv");b.classList.toggle("disabledDiv");a.classList.toggle("disabledDiv")}}function resetAutoRefreshWorkDay(){clearTimeout(refreshMetricBarTimer);var a=consoleMetricRefreshMinutes*1000*60;refreshMetricBarTimer=setTimeout(function(){updateCards()},a)}function saveSelectedCards(){selectedCards=[];popUploader(true);$("#selectedCards .column-configurator__column").each(function(a,b){if(b.getAttribute("id").length==18){selectedCards.push(b.getAttribute("id"))}});Visualforce.remoting.Manager.invokeAction(saveSelectedMetricCards,selectedCards,function(a,b){if(b.status){popUploader(false);cancelPopup();updateCards()}},{escape:false})};