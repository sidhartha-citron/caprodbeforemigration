var SLAId;var idset;var isCustomPage=true;var clickedOnce=false;var isAutocomplete=false;function handleChange(){if(this.id!="ServiceTargetsBtn"&&this.id!="GeneralInformationBtn"){if(!clickedOnce){clickedOnce=true;window.parent.registerChange(wid)}}}function handleResetChange(){if(clickedOnce){clickedOnce=false;window.parent.registerSave(wid)}}var NewBtnHandler=function(){openPage("SLAPage",SLAHeader,SLAHeader);activeAllWindowFlag=false;activeAllWindowFlag=false};var SaveBtnHandler=function(){var c=document.getElementById(SLA_DescriptionComponent).value.trim();var b=document.getElementById(SLA_TitleComponent).value.trim();if(c.length>32000){Ext.MessageBox.show({msg:labelSLADescription+": "+TextAreaOverflow,buttons:Ext.MessageBox.OK});return}Ext.getCmp("saveId").setDisabled(true);var a=Ext.getCmp("SLA_inactive__c").getValue();waitbox(0);if(csvAccountListparam!=""){save(a,csvAccountListparam)}else{save(a)}};var CopyBtnHandler=function(){callCopyPage();activeAllWindowFlag=false};var DeleteBtnHandler=function(){Ext.MessageBox.confirm(labelDelete,DeletedRecord,function(a){if(a==="yes"){deleteSLA()}})};var ResetBtnHandler=function(){resetSLA();firstTimeRenderFlag=0};function closeWindow(){window.parent.refreshList();window.parent.closeTab(wid)}function checkIDSet(){if(idset==null||idset==""){if(getIsDirect()==""){if(typeof(window.parent.returnListOfId)=="function"){idset=window.parent.returnListOfId()}}else{if(typeof(window.parent.parent.getIdArray)=="function"){idset=window.parent.parent.getIdArray()}window.parent.handleSave(getWID(),getID())}}}function PreviousBtnHandler(){if(document.getElementById("prevId").disabled!=true){var b="";var a=0;while(idset.length>a){if(b==""){b=idset[a]}else{b=b+","+idset[a]}a++}previousSLABtnHandler(b)}}function NextBtnHandler(){if(document.getElementById("nextId").disabled!=true){var b="";var a=0;while(idset.length>a){if(b==""){b=idset[a]}else{b=b+","+idset[a]}a++}nextSLABtnHandler(b)}}function buttonValidator(){SLAId=getSLAId();if(SLAId!=null&&SLAId!=""){if(getDeleteBtnFlag()){Ext.getCmp("deleteId").setDisabled(false);Ext.getCmp("deleteId").setIconClass("bmcDelete")}else{Ext.getCmp("deleteId").setDisabled(true);Ext.getCmp("deleteId").setIconClass("bmcDeleteDisable")}if(getRefreshBtnFlag()){Ext.getCmp("resetId").setDisabled(false)}else{Ext.getCmp("resetId").setDisabled(true)}if(getNewBtnFlag()){Ext.getCmp("newId").setDisabled(false);Ext.getCmp("newId").setIconClass("bmcNew");Ext.getCmp("copyId").setDisabled(false);Ext.getCmp("copyId").setIconClass("bmcCopy")}else{Ext.getCmp("newId").setDisabled(true);Ext.getCmp("newId").setIconClass("bmcNewDisable");Ext.getCmp("copyId").setDisabled(true);Ext.getCmp("copyId").setIconClass("bmcCopyDisable")}if(getSaveBtnFlag()){Ext.getCmp("saveId").setDisabled(false);Ext.getCmp("saveId").setIconClass("bmcSave")}else{Ext.getCmp("saveId").setDisabled(true);Ext.getCmp("saveId").setIconClass("bmcSaveDisable")}var a=document.getElementById("SIIframeID").style.display;if(cookieValue=="true"&&a=="none"){SIComp(iFrameSrc)}else{if(a=="none"){document.getElementById("onDemandSITableId").style.display="block";document.getElementById("noSIAvailTD").style.display="none";document.getElementById("linkSIAvailTD").style.display="block"}}}else{if(getNewBtnFlag()){Ext.getCmp("newId").setDisabled(false);Ext.getCmp("newId").setIconClass("bmcNew")}else{Ext.getCmp("newId").setDisabled(true);Ext.getCmp("newId").setIconClass("bmcNewDisable")}if(getSaveBtnFlag()){Ext.getCmp("saveId").setDisabled(false);Ext.getCmp("saveId").setIconClass("bmcSave")}else{Ext.getCmp("saveId").setDisabled(true);Ext.getCmp("saveId").setIconClass("bmcSaveDisable")}Ext.getCmp("resetId").setDisabled(true);Ext.getCmp("deleteId").setDisabled(true);Ext.getCmp("deleteId").setIconClass("bmcDeleteDisable");Ext.getCmp("copyId").setDisabled(true);Ext.getCmp("copyId").setIconClass("bmcCopyDisable")}}function renderGrid(){btnFlag=getSaveBtnFlag();ds=new Ext.data.Store({reader:new Ext.data.ArrayReader({},[{name:"Aggrement_Title"},{name:"RelatedSLARecordId"}])});cm=new Ext.grid.ColumnModel([{id:"Aggrement_Title_Id",header:labelAgreementTitle,dataIndex:"Aggrement_Title"}]);btnLink=new Ext.Toolbar({id:"RelatedSLAToolBarId",items:[{xtype:"box",id:"btnAdd",autoEl:{tag:"img",src:getSDFStylesResPath()+"/SDEFbuttons/btn_add.png",title:labelLinkSLA,name:"addBtn"},style:"cursor:pointer;padding-left:5px;padding-right:5px;",listeners:{render:function(a){a.getEl().on("click",function(){rowClickFlag=0;SLAId=getSLAId();if(SLAId!=null&&SLAId!=""&&btnFlag==true){openPopupRF("SearchPage?popupId=SLA&isLookup=true&isBlk=true&filterObjectId="+SLAId+"&filterClause="+escape("AgreementType__c = '"+selectedSLAAccodion+"'"),linkSLA)}})}}},{xtype:"box",id:"btnRemove",autoEl:{tag:"img",src:getSDFStylesResPath()+"/SDEFbuttons/btn_delete_disable.png",title:labelUnLinkSLA,name:"removeBtn"},style:"cursor:pointer;padding-right:5px;",listeners:{render:function(a){a.getEl().on("click",function(){SLAId=getSLAId();if(selectIdForDelete!=null&&selectIdForDelete!=""&&btnFlag==true&&SLAId!=null&&SLAId!=""){unlinkSLA(selectIdForDelete)}selectIdForDelete=""})}}}]});slaGrid=new Ext.grid.EditorGridPanel({id:"grid_id",store:ds,layout:"fit",autoScroll:true,cm:cm,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),anchorSize:"100%",frame:true,clicksToEdit:true,height:310,enableHdMenu:false,cls:"no-dirty-mark",stripeRows:true,viewConfig:{forceFit:true,scrollOffset:0}});slaGrid.getSelectionModel().on("selectionchange",function(b,d,c){var a=b.getSelected();if(typeof(a)!="undefined"){selectIdForDelete=a.data.RelatedSLARecordId}rowClickFlag=1;if(SLAId!=null&&SLAId!=""&&ds.data.length>0&&btnFlag==true){document.images.btnRemove.src=getSDFStylesResPath()+"/SDEFbuttons/btn_delete.png"}});mainPanel=new Ext.Panel({id:"maniPanelId",items:[btnLink,slaGrid]})}Ext.onReady(function(){Ext.QuickTips.init();if(Ext.isIE){relatedSLADivWidth=280}else{if(Ext.isSafari){relatedSLADivWidth=280}}document.getElementById(SLA_AccountNAmeComponent).readOnly=true;selectIdForDelete="";selectedSLAAccodion="service level agreement";getRelatedSLA(selectedSLAAccodion);setCleareAccountBtn();var b=Ext.extend(Ext.Panel,{renderTo:"btnToolbar",defaults:{bodyStyle:"border:0px;padding:0px;margin:0px;zoom:0px;"}});new b({id:"toolBarId",title:"",cls:"toolSpCls",bodyStyle:"border:0px;padding:0px;margin:0px;zoom:0px;",tbar:[{scale:"medium",iconCls:"bmcNew",tooltipType:"title",tooltip:labelNew,id:"newId",handler:NewBtnHandler}," ",{scale:"medium",iconCls:"bmcSave",tooltipType:"title",tooltip:labelSave,id:"saveId",handler:SaveBtnHandler}," ",{scale:"medium",iconCls:"bmcCopy",tooltipType:"title",tooltip:labelCopy,id:"copyId",handler:CopyBtnHandler}," ","-"," ",{scale:"medium",iconCls:"bmcDelete",tooltipType:"title",tooltip:labelDelete,id:"deleteId",handler:DeleteBtnHandler}," ",{scale:"medium",iconCls:"bmcRefreshDasboard",tooltipType:"title",tooltip:labelReset,id:"resetId",handler:ResetBtnHandler},new Ext.Toolbar.Fill(),{id:"SLA_inactive__c",xtype:"checkbox",width:93,color:"#004376",align:"top",checked:false,boxLabel:'<span class="checkboxLabelCls" style="'+inactiveLblStyle+'">'+labelInactive+"</span>"},{xtype:"box",id:"prevId",autoEl:{tag:"img",src:getSDFStylesResPath()+"/SDEFbuttons/b_previous.gif",title:labelPreviousRecord},cls:"cursorCls",listeners:{render:function(e){e.el.on("click",PreviousBtnHandler)}}},{xtype:"box",id:"nextId",autoEl:{tag:"img",src:getSDFStylesResPath()+"/SDEFbuttons/b_next.gif",title:labelNextRecord},cls:"cursorSpaceCls",listeners:{render:function(e){e.el.on("click",NextBtnHandler)}}}]});new Ext.ToolTip({target:"SLA_inactive__c",anchor:"left",html:labelTooltipSLAInactive});if(isInactiveTrue){Ext.getCmp("SLA_inactive__c").setDisabled(true)}document.getElementById("capsule").style.display="block";wid=getWID();buttonValidator();checkIDSet();handleElemEvent();updateInactive();var d=new Ext.Panel({layout:"border",height:Ext.isIE7?670:Ext.isIE?674:Ext.isSafari?695:680,border:false,id:"canvasPanelId",cls:"canvasPanelCls",items:[{xtype:"panel",layout:"fit",overflow:"auto",autoScroll:true,split:false,width:"auto",height:480,cls:"northPanelCls",region:"center",contentEl:Ext.isIE?"capsule":SLAFormComponent},{xtype:"panel",layout:"fit",overflow:"auto",border:false,id:"southPanelSI",autoScroll:true,split:true,collapsible:true,collapseMode:"mini",width:"auto",height:Ext.isIE7?200:Ext.isIE?210:215,minHeight:Ext.isIE?120:150,animCollapse:false,region:"south",listeners:{resize:function(h,k,g,f,j){if(typeof(g)=="number"){document.getElementById("detailsDivSI").style.height=g+"px"}var e=document.getElementById("SIIframeID").style.display;if(e!="none"){if(typeof(window.frames.SIIframeID.setSouthPanelHeight)=="function"){window.frames.SIIframeID.setSouthPanelHeight(g)}}},collapse:function(){this.setWidth("auto")}},contentEl:"detailsDivSI"}],listeners:{afterlayout:function(e){e.layout.south.miniSplitEl.dom.qtip=labelDragResizeClickCollapse;e.layout.south.getCollapsedEl();e.layout.south.miniCollapsedEl.dom.qtip=labelClickToExpand},single:true}});var a=new Ext.Viewport({layout:"anchor",width:"auto",id:"viewportId",border:false,cls:"viewportCanvasCls",items:[{anchor:"100%",layout:"fit",items:d}]});SLAId=getSLAId();if(SLAId==null||SLAId==""){Ext.getCmp("prevId").setDisabled(true);Ext.getCmp("nextId").setDisabled(true);if(document.getElementById("linkSIAvailTD")!=null){document.getElementById("linkSIAvailTD").style.display="none"}if(document.getElementById("noSIAvailTD")!=null){document.getElementById("noSIAvailTD").style.display="block"}}else{if(SLAId!=null){Ext.getCmp("prevId").setDisabled(false);Ext.getCmp("nextId").setDisabled(false);var c=displaySI(cookieName,iFrameSrc);if(!c){if(document.getElementById("noSIAvailTD")!=null){document.getElementById("noSIAvailTD").style.display="none"}if(document.getElementById("linkSIAvailTD")!=null){document.getElementById("linkSIAvailTD").style.display="block"}}}}renderAccList();setClearAccountToolTip()});function setClearAccountToolTip(){if(document.getElementById("clearAccountOn")!=null&&document.getElementById("clearAccountOn")!="undefined"&&document.getElementById("clearAccountOn")!=""){document.getElementById("clearAccountOn").title=labelClearAccountTooltip}if(document.getElementById("clearAccountOff")!=null&&document.getElementById("clearAccountOff")!="undefined"&&document.getElementById("clearAccountOff")!=""){document.getElementById("clearAccountOff").title=labelClearAccountTooltip}}function displayActiveTab(e){var a=new Array(2);a[0]={btnId:"GeneralInformationBtn",textAreaCompId:"SLA_GeneralInformationTab",textLabel:labelGeneralInformation};a[1]={btnId:"ServiceTargetsBtn",textAreaCompId:"SLA_ServiceTargetsTab",textLabel:labelServiceTargets};var d=e.id;if(d=="ServiceTargetsBtn"&&isQueueBasedTTEnabled&&newAgreementType!=existingAgreementType&&(newAgreementType=="Operational Level Agreement"||existingAgreementType=="Operational Level Agreement")&&newAgreementType!=""){var b;if(newAgreementType=="Operational Level Agreement"){b=labelSaveOLA.replace("{0}",OperationalTarget)}else{b=labelSaveOLA.replace("{0}",labelServiceTargets)}Ext.MessageBox.show({msg:b,buttons:Ext.MessageBox.OK,width:400})}else{for(var c=0;c<a.length;c++){if(d==a[c].btnId){document.getElementById(a[c].btnId).style.fontWeight="bold";document.getElementById(a[c].textAreaCompId).style.display="block"}else{document.getElementById(a[c].btnId).style.fontWeight="normal";document.getElementById(a[c].textAreaCompId).style.display="none"}}if(d=="ServiceTargetsBtn"&&firstTimeRenderFlag==0&&Ext.isIE8){if(document.getElementById("SLTframe")!=null){document.getElementById("SLTframe").contentWindow.location.reload()}firstTimeRenderFlag=1}}}function refreshparentList(){window.parent.needsRefresh=true}function SIComp(a){document.getElementById("SIIframeID").style.display="none";document.getElementById("SIIframeID").src=a;document.getElementById("onDemandSITableId").style.display="none";document.getElementById("SIIframeID").style.display=""}function writeCookie(){if(document.getElementById("configureSIId").checked){createSICookie(cookieName,"true");var a=displaySI(cookieName,iFrameSrc)}}function afterResetSI(){var b=getModuleName();var a=getParentWid();if(b!=null&&b!=""&&typeof(b)!="undefined"&&a!=null&&a!=""&&typeof(a)!="undefined"&&(errormsg==labelSavedSuccessfully||errormsg=="")){window.parent.registerSave(wid);window.parent.parent.refreshSupportingInformation(a,b)}}function resetSupportingInformation(){var a=document.getElementById("SIIframeID").style.display;if(isInactive){if(a!="none"){window.frames.SIIframeID.disableAll()}}else{if(a!="none"){window.frames.SIIframeID.enableAll()}}}function siControlBack(){var b=Ext.util.Cookies.get(cookieName);var a=document.getElementById("SIIframeID").style.display;if((b==null||b=="false")&&a=="none"){afterResetSI()}}function renderSIComponent(){if(cookieValue==true||cookieValue=="true"){SIComp(iFrameSrc)}else{removeSI(iFrameSrc)}}function confirmClose(a){Ext.Msg.show({title:window.parent.labelcloseWindow,msg:window.parent.labelcloseWindowLabel,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes"){a.pendingClose=true;a.close()}},icon:Ext.MessageBox.WARNING})}function setOnCompleteFunction(a){onCompleteFunction=a}function setCleareAccountBtn(){if(cleareAccountFieldFlag==true){document.getElementById("clearAccountOff").style.display="none";document.getElementById("clearAccountOn").style.display="inline"}else{document.getElementById("clearAccountOn").style.display="none";document.getElementById("clearAccountOff").style.display="inline"}}function datePickerPosition(d){var f=document.getElementById("datePicker");var e=d.clientY+10;var a="#datePicker{ top:"+e+"px !important; }";var g=document.getElementById("styles_js");if(g!=null){g.nodeValue=""}var c=document.createElement("style");c.setAttribute("type","text/css");c.setAttribute("id","styles_js");if(Ext.isIE){if(g!=null){g.styleSheet.cssText="";g.styleSheet.cssText=a}else{document.getElementsByTagName("head")[0].appendChild(c);c.styleSheet.cssText=a}}else{document.getElementsByTagName("head")[0].appendChild(c);var b=document.createTextNode(a);c.appendChild(b)}}function OpenHelpUrl(a){if(typeof(slaWikiUrl)!="undefined"&&slaWikiUrl!=null&&slaWikiUrl!=""&&isNewContextpage()){window.open(slaWikiUrl,false,"width="+screen.width+",height="+screen.height+",resizable = 1,scrollbars=yes,status=1,top=0,left=0",false)}else{OpenHelppage("MilestoneAction","module","form")}}function openAccountSelector(e,h){if(h){csvAccountListparam="AllAccounts";document.getElementById(SLA_AccountNAmeComponent).value=labelAllAccount;cleareAccountFieldFlag=true;setCleareAccountBtn()}else{if(e!=null){var g=e.data;listData=[];var f="";var d="";var c;var b="";for(i=0;i<g.length;i++){c=new Array(2);var a=e.getAt(i).get("display").length;b=e.getAt(i).get("display");b=Ext.util.Format.htmlDecode(b);if(a>=30){b=b.substring(0,25)+"..."}d=d+b;c[0]=e.getAt(i).get("Name");c[1]=e.getAt(i).get("elID");f=f+e.getAt(i).get("elID");if(i<g.length-1){f=f+",";d=d+"\n"}listData.push(c)}csvAccountListparam=f;document.getElementById(SLA_AccountNAmeComponent).value=d;listStore.removeAll();listStore.loadData(listData);cleareAccountFieldFlag=true;setCleareAccountBtn()}}}function initAccountList(){var a=new Ext.data.ArrayReader({},cols);listStore=new Ext.data.Store({reader:a,data:listData,sortInfo:{field:"Name",direction:"ASC"}})}function updateOLTTtabTitle(a){if(typeof(a.value)!=undefined&&a.value=="Operational Level Agreement"){document.getElementById("ServiceTargetsBtn").title=OperationalTarget;document.getElementById("ServiceTargetsBtn").value=OperationalTarget}else{document.getElementById("ServiceTargetsBtn").title=labelServiceTargets;document.getElementById("ServiceTargetsBtn").value=labelServiceTargets}}function onAgreementTypeChange(){SLAId=getSLAId();agreementTypePicklist=getAgreementType();if(SLAId&&isQueueBasedTTEnabled&&agreementTypePicklist&&agreementTypePicklist.value!=""){newAgreementType=agreementTypePicklist.value;if((newAgreementType=="Operational Level Agreement"||existingAgreementType=="Operational Level Agreement")&&newAgreementType!=existingAgreementType){Ext.Msg.show({msg:ConfirmAgreementTypeChange,buttons:Ext.Msg.YESNO,fn:function(a){if(a==="yes"){}if(a==="no"){if(agreementTypePicklist){agreementTypePicklist.value=existingAgreementType;newAgreementType=existingAgreementType;updateOLTTtabTitle(agreementTypePicklist)}}},width:430})}}};