var clickedOnce=false;Ext.onReady(function(){Ext.QuickTips.init();if(CustomActionPageComp.ComponentVars.isRecDeleted){Ext.Msg.alert(CustomAction.Labels.Information,CustomAction.Labels.DeletedRecord,function(){if((typeof(window.parent)!="undefined")&&(typeof(window.parent.popUpWindow)!="undefined")){window.parent.popUpWindow.close()}closeWindow()})}var i=function(u,v){activeAllWindowFlag=false;openPage("CustomActionPage",customActionHeader,customActionHeader)};var l=function(y,A){var z=document.getElementById(CustomActionPageComp.ComponentVars.radFCR8).checked;var v=Ext.getCmp("selectedListId").store;var w=v.data.length;var x=0;selectedValues="";while(w>x){var B=v.getAt(x);if(x==0){selectedValues=selectedValues+B.get("value")}else{selectedValues=selectedValues+","+B.get("value")}x++}if(w==0&&document.getElementById(CustomActionPageComp.ComponentVars.radFCR8).checked==true){selectedValues="everyone"}if(w==0&&document.getElementById(CustomActionPageComp.ComponentVars.radFCR8).checked==false){Ext.Msg.alert("",CustomAction.Labels.selectedProfileListEmpty)}else{chkBoxValue=Ext.getCmp("idInactive").getValue();waitbox(0);var u=createPramList();save(selectedValues,u,chkBoxValue)}};var a=function(u,v){activeAllWindowFlag=false;callCopyPage()};var j=function(v,w){var u=window.location.href;if(u.indexOf("&id=")==-1&&u.indexOf("?id=")==-1){u=u+"&id="+customActionId}window.location.replace(u)};var s=function(u,v){Ext.MessageBox.confirm(CustomAction.Labels.Delete,CustomAction.Labels.DeleteConfirmMessage,function(w){if(w==="yes"){deleteCustomAction()}})};var p=function(u,v){};var k=function(u,v){};var f=function(u,v){if(document.getElementById("nextId").disabled!=true){nextBtnHandler1()}};var e=function(u,v){if(document.getElementById("prevId").disabled!=true){previousBtnHandler1()}};var q=new Ext.Toolbar({title:"",renderTo:"btnToolbar",cls:"toolSpCls",items:[{scale:"medium",iconCls:"bmcNew",tooltipType:"title",tooltip:CustomAction.Labels.New,id:"newId",listeners:{mouseover:function(){this.setIconClass("bmcNewOn")},mouseout:function(){this.setIconClass("bmcNew")}},handler:i}," ",{scale:"medium",iconCls:"bmcSave",tooltipType:"title",id:"saveId",tooltip:CustomAction.Labels.Save,listeners:{mouseover:function(){this.setIconClass("bmcSaveOn")},mouseout:function(){this.setIconClass("bmcSave")}},handler:l}," ",{scale:"medium",tooltipType:"title",tooltip:CustomAction.Labels.Copy,iconCls:"bmcCopy",listeners:{mouseover:function(){this.setIconClass("bmcCopyOn")},mouseout:function(){this.setIconClass("bmcCopy")}},id:"copyId",handler:a}," ","-"," ",{scale:"medium",iconCls:"bmcDelete",tooltipType:"title",tooltip:CustomAction.Labels.Delete,id:"deleteId",listeners:{mouseover:function(){this.setIconClass("bmcDeleteOn")},mouseout:function(){this.setIconClass("bmcDelete")}},handler:s}," ",{scale:"medium",iconCls:"bmcRefreshDasboard",tooltipType:"title",tooltip:CustomAction.Labels.Reset,id:"resetId",handler:j},new Ext.Toolbar.Fill(),{id:"idInactive",xtype:"checkbox",width:"auto",align:"top",checked:false,boxLabel:CustomAction.Labels.Inactive,cls:"chkStyle",boxLabel:'<span class="checkboxLabelCls">'+CustomAction.Labels.Inactive+"</span>",listeners:{render:function(){Ext.QuickTips.register({target:this,dismissDelay:20000,text:CustomAction.Labels.Inactive})}}},{xtype:"box",id:"prevId",autoEl:{tag:"img",src:(getSDFStylesResPath()+"/SDEFbuttons/b_previous.gif"),title:CustomAction.Labels.PreviousRecord},cls:"cursorCls",listeners:{render:function(u){u.el.on("click",e)}}},{xtype:"box",id:"nextId",autoEl:{tag:"img",src:getSDFStylesResPath()+"/SDEFbuttons/b_next.gif",title:CustomAction.Labels.NextRecord},cls:"cursorSpaceCls",listeners:{render:function(u){u.el.on("click",f)}}}]});if(customActionId==null||customActionId==""){Ext.getCmp("deleteId").setDisabled(true);Ext.getCmp("deleteId").setIconClass("bmcDeleteDisable");Ext.getCmp("copyId").setDisabled(true);Ext.getCmp("resetId").setDisabled(true);Ext.getCmp("prevId").setDisabled(true);Ext.getCmp("nextId").setDisabled(true);document.getElementById(CustomActionPageComp.ComponentVars.ActionNameID).focus()}var b=new Array();showTable();var t=new Array();var h=new Array();var n=new Array();setData();ds=new Ext.data.ArrayStore({data:t,fields:["value","text"],sortInfo:{field:"text",direction:"ASC"}});ds1=new Ext.data.ArrayStore({data:h,fields:["value","text"],sortInfo:{field:"text",direction:"ASC"}});Ext.getCmp("idInactive").setValue(isIncInactive);var m=getSDFStylesResPath()+"/SDEFimages/";var c=getSDFStylesResPath()+"/SDEFbuttons/";var d=new Ext.Panel({id:"form",title:"",width:250,border:false,cls:"fontCls",renderTo:"itemselector",items:[{xtype:"itemselector",name:"itemselector",iconLeft:"b_darrow_L_new.gif",iconRight:"b_darrow_R_new.gif",drawUpIcon:false,drawDownIcon:false,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:false,drawBotIcon:false,fieldLabel:"",imagePath:c,multiselects:[{id:"profileListId",legend:false,width:107,height:400,store:ds1,displayField:"text",valueField:"value",listeners:{render:function(u){new Ext.ToolTip({target:u.el,renderTo:document.body,delegate:"dl",trackMouse:true,anchor:"right",listeners:{beforeshow:function(v){var w=u.view.getRecord(v.triggerElement);RemedyForceHTMLProcessor.clearHTML(v.body.dom);v.body.dom.appendChild(document.createTextNode(w.get("text")))}}})},afterrender:function(){setTimeout("toggleItemSelector()",1000)}}},{id:"selectedListId",width:107,legend:"",height:400,legend:false,store:ds,displayField:"text",valueField:"value",listeners:{render:function(u){new Ext.ToolTip({target:u.el,renderTo:document.body,delegate:"dl",trackMouse:true,anchor:"right",listeners:{beforeshow:function(v){var w=u.view.getRecord(v.triggerElement);if(w!=null&&w!="null"&&w!="undefined"){RemedyForceHTMLProcessor.clearHTML(v.body.dom);v.body.dom.appendChild(document.createTextNode(w.get("text")))}}}})}}}],listeners:{change:function(){if(ds.data.length==0){document.getElementById(CustomActionPageComp.ComponentVars.radFCR8).disabled=false;toggleItemSelector()}else{document.getElementById(CustomActionPageComp.ComponentVars.radFCR8).checked=false;document.getElementById(CustomActionPageComp.ComponentVars.radFCR8).disabled=true;Ext.getCmp("form").getEl().unmask()}}}}]});fetchModuleFieldStore();var r=Ext.getCmp("grid").getWidth();var g=document.getElementById("paramConstVal").clientWidth;var o=document.getElementById("paramConstVal").parentNode.clientWidth;combowidth=o*0.97;combowidth=Ext.isIE8?combowidth:Ext.isIE7?combowidth-10:combowidth;moduleFieldCombo=new Ext.form.ComboBox({id:"moduleFieldCombo",store:moduleFieldStore,width:combowidth,height:10,emptyText:CustomAction.Labels.SelectField,displayField:"lable",renderTo:"moduleFldsCombo",valueField:"apiName",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,tooltip:CustomAction.Labels.ModuleType,cls:"fontCls",listeners:{select:function(w,u,v){comboFldIndex=v}}});setData2();generatePreviewUrl();handleElemEvent()});function handleChange(){if(!clickedOnce){clickedOnce=true;window.parent.registerChange(wid2)}}function handleResetChange(){if(clickedOnce){clickedOnce=false;window.parent.registerSave(wid2)}}function closeWindow(){window.parent.refreshList();window.parent.closeTab(wid)}function urldecode(a){return decodeURIComponent((a+"").replace(/\+/g,"%20"))}function urlencode(a){return encodeURIComponent(a).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}function createPramList(){var b=Ext.getCmp("grid").store;var c=b.data.length;var e=0;var a="";while(c>e){var f=b.getAt(e);var d="";if(f.get("isDynamic")=="true"){d=urlencode(f.get("field"))+"=<"+urlencode(f.get("apiName"))+">"}else{d=urlencode(f.get("field"))+"="+urlencode(f.get("constValue"))}if(e==0){a=a+d}else{a=a+"&"+d}e++}return a}function enableValidation(){if(typeof(document.getElementById("txtBoxRd"))!=null&&document.getElementById("txtBoxRd").checked==true){document.getElementById("paramConstVal").disabled=false;Ext.getCmp("moduleFieldCombo").setValue("");Ext.getCmp("moduleFieldCombo").disable();defaultConstVal()}else{Ext.getCmp("moduleFieldCombo").enable();document.getElementById("paramConstVal").disabled=true;defaultConstVal();isEnterConst=1}}function generatePreviewUrl(){var b=0;var c="";var d;while(listDataGrid.length>b){d="";if(listDataGrid[b][3]=="true"){d=listDataGrid[b][0]+"=<"+listDataGrid[b][1]+">"}else{if(listDataGrid[b][3]=="false"){d=listDataGrid[b][0]+"="+listDataGrid[b][1]}}if(c==""){c=c+d}else{c=c+"&"+d}b++}var a=document.getElementById(CustomActionPageComp.ComponentVars.URLId).value;if(a!=null&&a!=""){if(a.indexOf("?")==-1){document.getElementById("previewText").value=a+"?"+c}else{if(a.lastIndexOf("?")==a.length-1){document.getElementById("previewText").value=a+c}else{document.getElementById("previewText").value=a+"&"+c}}}else{if(c!=""){document.getElementById("previewText").value="?"+c}else{document.getElementById("previewText").value=""}}}function isParamUnique(a,d){var b=a.data.length;var c=0;while(b>c){var e=a.getAt(c);if(e.get("field")==d){return false}c++}return true}function addParameter(){var a=Ext.getCmp("grid").store;var b=a.data.length;var c=document.getElementById("paramName").value;if(isfocus==0||(isEnterConst==0&&document.getElementById("txtBoxRd").checked==true)){if(isfocus==0){Ext.Msg.alert("",CustomAction.Labels.parameterNameEmpty);defaultPrameterName()}else{Ext.Msg.alert("",CustomAction.Labels.EmptyConstantValue);defaultConstVal()}}else{if(c!=null&&c.trim()!=""&&isParamUnique(a,c)){addRecordToDataGrid(b);generatePreviewUrl()}else{if(c.trim()==""){Ext.Msg.alert("",CustomAction.Labels.parameterNameEmpty)}else{Ext.Msg.alert("",CustomAction.Labels.parameterNameUnique)}}enableRdTxtPanel();isException=false}}function updateParameter(){var a=Ext.getCmp("grid").store;var b=a.data.length;var c=document.getElementById("paramName").value;if(isEnterConst==0){Ext.Msg.alert("",CustomAction.Labels.EmptyConstantValue);defaultConstVal();isException=true}else{if(pNameForUpdate!=c){if(c!=null&&c.trim()!=""&&isParamUnique(a,c)){addRecordToDataGrid(selectedRow);generatePreviewUrl()}else{if(c.trim()==""){Ext.Msg.alert("",CustomAction.Labels.parameterNameEmpty);isException=true}else{Ext.Msg.alert("",CustomAction.Labels.parameterNameUnique);isException=true}}}else{if(c==""){Ext.Msg.alert("",CustomAction.Labels.parameterNameEmpty);isException=true}else{addRecordToDataGrid(selectedRow);generatePreviewUrl()}}}enableRdTxtPanel();if(!isException){document.getElementById("okButtonId").style.display="inline";document.getElementById("updateButtonId").style.display="none";document.getElementById("removeButtonId").disabled=true}else{isException=false}}function addRecordToDataGrid(g){var a=Ext.getCmp("grid").store;var b=a.data.length;var c=Ext.getCmp("moduleFieldCombo").store;var e=document.getElementById("paramName").value;var f;if(b==g){selectedRow=b;listDataGrid[b]=new Array(4)}if(typeof(document.getElementById("comboRd"))!=null&&document.getElementById("comboRd").checked==true){if(Ext.getCmp("moduleFieldCombo").getValue()!=""){if(typeof(comboFldIndex)!="undefined"&&comboFldIndex!=-1){f=c.getAt(comboFldIndex);listDataGrid[selectedRow][0]=e;listDataGrid[selectedRow][1]=f.get("lable");listDataGrid[selectedRow][2]=f.get("apiName");listDataGrid[selectedRow][3]="true";setData()}else{listDataGrid[selectedRow][0]=e;setData()}}else{Ext.Msg.alert("",CustomAction.Labels.EmptyModuleFieldValue);isException=true}}else{var d=document.getElementById("paramConstVal").value;if(d!=null&&d.trim()!=""){f=c.getAt(comboFldIndex);listDataGrid[selectedRow][0]=e;listDataGrid[selectedRow][1]=d;listDataGrid[selectedRow][2]="";listDataGrid[selectedRow][3]="false";setData()}else{Ext.Msg.alert("",CustomAction.Labels.EmptyConstantValue);isException=true}}selectedRow=0}function removeParameter(){listDataGrid.splice(selectedRow,1);setData();generatePreviewUrl();document.getElementById("okButtonId").style.display="inline";document.getElementById("updateButtonId").style.display="none";document.getElementById("removeButtonId").disabled=true;enableRdTxtPanel()}function enableRdTxtPanel(){if(!isException){defaultPrameterName()}if(document.getElementById("comboRd").checked==true){Ext.getCmp("moduleFieldCombo").enable();moduleFieldCombo.setValue("");defaultConstVal();isEnterConst=1;document.getElementById("paramConstVal").disabled=true}else{document.getElementById("paramConstVal").disabled=false;defaultConstVal();moduleFieldCombo.setValue("");Ext.getCmp("moduleFieldCombo").disable()}}function callCopyPage(){window.parent.addTab("CustomActionPage?copyId="+customActionId,customActionHeader,customActionHeader)}function completeDelete(){if(errormsg==CustomAction.Labels.InsufficentDeletePrivilege){showError()}else{closeWindow()}}function onRowClkofParamGrid(a){pNameForUpdate=a.get("field");document.getElementById("paramName").style.color="#000000";document.getElementById("paramName").value=a.get("field");document.getElementById("okButtonId").style.display="none";document.getElementById("updateButtonId").style.display="inline";document.getElementById("updateButtonId").disabled=false;document.getElementById("removeButtonId").disabled=false;if(a.get("isDynamic")=="false"){document.getElementById("paramConstVal").style.color="#000000";document.getElementById("paramConstVal").value=a.get("constValue");document.getElementById("paramConstVal").disabled=false;document.getElementById("txtBoxRd").checked=true;isEnterConst=1;moduleFieldCombo.setValue("");moduleFieldCombo.disable()}else{moduleFieldCombo.enable();document.getElementById("paramConstVal").disabled=true;document.getElementById("comboRd").checked=true;defaultConstVal();isEnterConst=1;moduleFieldCombo.setValue(a.get("constValue"))}}function toggleItemSelector(){var a=document.getElementById(CustomActionPageComp.ComponentVars.radFCR8).checked;if(Ext.getCmp("form")!=null&&Ext.getCmp("profileListId")!=null&&Ext.getCmp("selectedListId")!=null){if(a){Ext.getCmp("form").getEl().mask()}else{Ext.getCmp("form").getEl().unmask()}}}function previousBtnHandler1(){var b="";var a=0;while(cusActionIdSet.length>a){if(b==""){b=cusActionIdSet[a]}else{b=b+","+cusActionIdSet[a]}a++}previousBtnHandler(b)}function nextBtnHandler1(){var b="";var a=0;while(cusActionIdSet.length>a){if(b==""){b=cusActionIdSet[a]}else{b=b+","+cusActionIdSet[a]}a++}nextBtnHandler(b)}function defaultPrameterName(){document.getElementById("paramName").style.color="#B5B8C8";document.getElementById("paramName").value=CustomAction.Labels.parameterName;isfocus=0}function defaultConstVal(){document.getElementById("paramConstVal").style.color="#B5B8C8";document.getElementById("paramConstVal").value=CustomAction.Labels.EnterConstant;isEnterConst=0};