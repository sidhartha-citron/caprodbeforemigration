function processDynamicFieldsDataForRTF(c,b){try{if(!dynamicFieldsMetaData[c]["oldValue"]||window.parent.iscalledAfterSave){dynamicFieldsMetaData[c]["oldValue"]=b}}catch(a){}}function processCheckBoxMap(a,b){checkboxMap.set(a,b)}function processDynamicFieldsData(e,b,a){try{var c=document.querySelector("#"+e+'_data .dynamicInputCls[id$="inputField"]');if(!c&&b=="picklist"){c=getElementForDependentPicklist(e)}if(c){dynamicFieldsMetaData[e]["oldValue"]=c.value}if(b=="reference"){var f=document.getElementById(a+"_lkid");if(f){dynamicFieldsMetaData[e]["oldValue_lkid"]=f.value}}}catch(d){}}function setFieldVisiblityOnLoad(i,d){var e=document.querySelector('div[data-fieldpath="'+dynamicFieldsMetaData[i]["fsName"]+'_pageBlockId"]');var f=false;try{var c=true;if(typeof(d)!="undefined"&&d!=null&&d!=""){if(d.toLowerCase().indexOf("and")>-1){d=d.replace(/AND/gi,"&&")}if(d.toLowerCase().indexOf("or")>-1){d=d.replace(/OR/gi,"||")}}else{d="true"}c=parseBooleanExpression(d);var h='table[data-fieldPath="'+i+'_sectionId"]';var a=document.querySelector('span[data-fieldpath="'+i+'_sectionId"]');if(!c){if(a){a.style.display="none"}if(e){f=checkIfAllFieldsHiddenInFieldSet(dynamicFieldsMetaData[i]["fsName"]);e.style.display=f?"none":"block"}if(hiddenFieldsList.indexOf(i)<0){hiddenFieldsList.push(i)}}else{if(e){e.style.display="block"}if(a){a.style.display="inline"}var g=hiddenFieldsList.indexOf(i);if(g>-1){hiddenFieldsList.splice(g,1)}}setFieldsRowVisiblity(a.parentElement.parentElement)}catch(b){}}function setFieldsRowVisiblity(d){var c=false;if(d&&d.cells){for(var b=0;b<d.cells.length;b++){var a=d.cells[b].querySelector('span[data-fieldpath$="_sectionId"]');if(a&&a.style.display!="none"){c=false;break}else{c=true}}}if(!c){d.style.visibility="visible"}else{d.style.visibility="collapse"}}function checkIfAllFieldsHiddenInFieldSet(d){var c=document.querySelectorAll('div[data-fieldpath="'+d+'_pageBlockId"] span[data-fieldpath$="_sectionId"]');var b=false;if(c&&c.length>0){for(var a=0,e=c.length;a<e;a++){if(c[a].style&&(c[a].style.display=="none")){b=true}else{b=false;break}}}return b}function dynamicFieldsHandlerForChange(b,a){if(a!="textfield"&&a!="string"&&a!="email"&&a!="phone"&&a!="url"&&a!="double"){dynamicFieldsHandler(b,a)}}function dynamicFieldsHandlerForKeyup(b,a){if(a!="lookup"&&a!="reference"){dynamicFieldsHandler(b,a)}}function dynamicFieldsHandler(o,k){try{if(isEnableDynamicFields){var l,e;if(layoutFldsCriteria[o]){l=layoutFldsCriteria[o].dependentOnMe;if(l&&l.length>0){for(var u=0,r=l.length;u<r;u++){var b=l[u];var p=new Object();if(dynamicFieldsMetaData[b]){p.type=dynamicFieldsMetaData[b]["ftype"];var v=false;if(typeof(layoutFldsCriteria[b].myConditions)!="undefined"&&layoutFldsCriteria[b].myConditions!=null&&layoutFldsCriteria[b].myConditions.length>0){var a=layoutFldsCriteria[b].myConditions;var d=layoutFldsCriteria[b].advancedRuleLogic;if(d!=""){v=true;d=" "+d+" "}if(a&&a.length>0){for(var t=0,s=a.length;t<s;t++){var w=new Object();var h;var q;if(dynamicFieldsMetaData[a[t].ControllingFieldName]){w.type=dynamicFieldsMetaData[a[t].ControllingFieldName]["ftype"]}if(w.type=="lookup"||w.type=="reference"){var f=document.querySelector("#"+a[t].ControllingFieldName+'_data [id$="inputField_lkid"]');if(f){w.lookupId=f.value}}h=document.querySelector("#"+a[t].ControllingFieldName+'_data .dynamicInputCls[id$="inputField"]');if(!h&&w.type=="picklist"){h=getElementForDependentPicklist(a[t].ControllingFieldName)}q=document.querySelector('span[data-fieldpath="'+a[t].ControllingFieldName+'_sectionId"]');w.Value="";if(h&&h.value){w.Value=h.value;w.checked=h.checked}else{if(h&&h.innerText){w.Value=h.innerText}else{if(!h&&w.type=="boolean"){w.Value=checkboxMap.get(a[t].ControllingFieldName);w.checked=checkboxMap.get(a[t].ControllingFieldName)}}}if(q&&(layoutFldsCriteria[a[t].ControllingFieldName].isAccessible===true)){w.isVisible=q.style.display=="none"?false:true}else{w.isVisible=false}e=evaluateSinglecondition(a[t],w);if(v){if(d.indexOf(" "+a[t].OrderIndex+" ")>-1){d=d.replace(" "+a[t].OrderIndex+" "," "+e+" ")}}else{if(a[t].LogicalOperator.toLowerCase()!="none"){d=d+e+" "+a[t].LogicalOperator+" "}else{d=d+e}}}}if(typeof(d)!="undefined"&&d!=null&&d!=""){if(d.toLowerCase().indexOf("and")>-1){d=d.replace(/AND/gi,"&&")}if(d.toLowerCase().indexOf("or")>-1){d=d.replace(/OR/gi,"||")}showHideField(b,parseBooleanExpression(d),dynamicFieldsMetaData[b]["fsName"]);var c=document.querySelector("#"+b+'_data .dynamicInputCls[id$="inputField"]');dynamicFieldsHandler(b)}}}}}}}}catch(g){}}function evaluateSinglecondition(l,c){var d=false;try{if(c&&c.type&&typeof c.Value!="undefined"){switch(c.type){case"url":case"phone":case"email":case"string":case"textfield":var s=l.Value;if(c.type=="phone"&&c.Value){c.Value=c.Value.replace(/[^0-9\.]+/g,"");s=s.replace(/[^0-9\.]+/g,"")}if(!c.isVisible){d=false}else{if(l.Operator=="LIKE"&&c.Value.toLowerCase().indexOf(s.toLowerCase())>-1){d=true}else{if(l.Operator=="NOT LIKE"&&c.Value.toLowerCase().indexOf(s.toLowerCase())==-1){d=true}else{if(l.Operator=="="&&c.Value.toLowerCase()==s.toLowerCase()){d=true}else{if(l.Operator=="!="&&c.Value.toLowerCase()!=s.toLowerCase()){d=true}}}}}break;case"reference":case"lookup":var e="";var r=l.Value;if(c.Value&&c.Value.toLowerCase()=="user"){var q=l.Value.split(String.fromCharCode(1092));if(q.length>1){r=q[1]}}else{if(l.Value.indexOf(String.fromCharCode(182)+String.fromCharCode(2365)+String.fromCharCode(1240)+String.fromCharCode(1092))>-1){var q=l.Value.split(String.fromCharCode(182)+String.fromCharCode(2365)+String.fromCharCode(1240)+String.fromCharCode(1092));if(q.length>1){r=q[1]}}}e=c.lookupId;if(typeof(e)=="undefined"||!c.isVisible){d=false}else{if(l.Operator=="="&&(e==r||r.indexOf(e)>-1)&&c.Value){d=true}else{if(l.Operator=="!="&&(!c.Value||(e!=r&&r.indexOf(e)==-1))){d=true}}}break;case"double":case"currency":case"percent":if(!c.isVisible){d=false}else{c.Value=c.Value.replace(/[^0-9\.]+/g,"");c.Value=parseFloat(c.Value);var p=parseFloat(l.Value.replace(/[^0-9\.]+/g,""));d=evaluateNumericAndDateFields(c,l,p)}break;case"date":var o=new Date(l.Value.split(" ")[0]);var n;var j;var g=c.Value.replace("a.m.","AM").replace("p.m.","PM").replace("午前","AM").replace("vorm.","AM").replace("午後","PM").replace("nachm.","PM");var f=stringToDateTime(g+" ",userDataMap.dateTimeFormat,userDataMap.dateFormat.indexOf("/")==-1?"-":"/");var k=new Date(moment(f,"YYYY-MM-DD HH:mm:ss"));if(o!==undefined&&o!=null){o.setHours(0);o.setMinutes(0);o.setSeconds(0)}if(c.Value!==undefined&&c.Value!=null&&c.Value!=""&&c.isVisible){n=new Date(moment(k,"YYYY-MM-DD HH:mm:ss"));if(c.type.toLowerCase()=="date"){c.Value=formatDate(n)}}if(k){c.yy=k.getFullYear();c.MM=k.getMonth()+1;c.dd=k.getDate()}d=evaluateNumericAndDateFields(c,l,o);break;case"datetime":case"date/time":if(typeof(c.Value)!="undefined"&&c.isVisible){var g=c.Value.replace("a.m.","AM").replace("p.m.","PM").replace("午前","AM").replace("vorm.","AM").replace("午後","PM").replace("nachm.","PM");var f=stringToDateTime(g,userDataMap.dateTimeFormat,userDataMap.dateFormat.indexOf("/")==-1?"-":"/");var k=new Date(moment(f,"YYYY-MM-DD HH:mm:ss"));var i=new Date();c.yy=k.getFullYear();c.MM=k.getMonth()+1;c.dd=k.getDate();c.HH=k.getHours();c.mm=k.getMinutes();var h=new Date(parseInt(l.Value,10)+(userDataMap.timeZoneOffSetMinutes+i.getTimezoneOffset())*60000);d=evaluateNumericAndDateFields(c,l,h)}break;case"picklist":var m=l.Value;if(!c.Value||!c.isVisible){d=false}else{if(false){if(l.Operator=="="){if(c.Value.toLowerCase()==m.toLowerCase()){d=true}}else{if(l.Operator=="!="&&c.Value!=h){var b=false;angular.forEach(c.Value,function(u,t){if(c.Value.toLowerCase()==m.toLowerCase()){b=true}return});d=!b}}}else{if(l.Operator=="="&&c.Value.toLowerCase()==m.toLowerCase()){d=true}else{if(l.Operator=="!="&&c.Value.toLowerCase()!=m.toLowerCase()){d=true}}}}break;case"boolean":case"checkbox":if(typeof(c.checked)=="undefined"||!c.isVisible){d=false}else{if(l.Operator=="="&&c.checked.toString().toLowerCase()==l.Value.toLowerCase()){d=true}else{if(l.Operator=="!="&&c.checked.toString().toLowerCase()!=l.Value.toLowerCase()){d=true}}}break}}}catch(a){}return d}function showHideField(f,a,h){var g=document.querySelector('div[data-fieldpath="'+h+'_pageBlockId"]');var c=false;try{var d=document.querySelector('span[data-fieldpath="'+f+'_sectionId"]');if(a){if(g&&g.style.display!="block"){g.style.display="block"}if(d){d.style.display="inline"}var b=hiddenFieldsList.indexOf(f);if(b>-1){hiddenFieldsList.splice(b,1)}}else{if(d){d.style.display="none"}if(g){c=checkIfAllFieldsHiddenInFieldSet(dynamicFieldsMetaData[f]["fsName"]);g.style.display=c?"none":"block"}if(hiddenFieldsList.indexOf(f)<0){hiddenFieldsList.push(f)}}setFieldsRowVisiblity(d.parentElement.parentElement)}catch(e){}}function evaluateNumericAndDateFields(c,g,d){var a=false;var f=c.Value;var e=d;if(g.Operator.indexOf("&gt;")!=-1){g.Operator=g.Operator.replace(/&gt;/gi,">")}else{if(g.Operator.indexOf("&lt;")!=-1){g.Operator=g.Operator.replace(/&lt;/gi,"<")}}var b=getThaiYearAdjustment();if(c.type=="date"||c.type=="date/time"||c.type=="datetime"){if(typeof(c.Value)!="undefined"&&c.Value!=null&&c.Value!=""){if(c.type=="date"){f=new Date(c.yy-b,c.MM-1,c.dd,0,0,0)}else{f=new Date(c.yy-b,c.MM-1,c.dd,c.HH,c.mm,0)}}if(c.Value!==null&&c.Value!==""&&(f instanceof Date)&&e){f.setSeconds(0);if(c.type=="date"){f.setHours(0);f.setMinutes(0)}f=f.getTime();e=e.getTime()}}if(!c.isVisible){a=false}else{if(g.Operator=="="&&f==e){a=true}else{if(g.Operator=="!="&&(f!=e||!f)){a=true}else{if(g.Operator==">"&&f&&f>d){a=true}else{if(g.Operator==">="&&f&&f>=d){a=true}else{if(g.Operator=="<"&&f&&f<d){a=true}else{if(g.Operator=="<="&&f&&f<=d){a=true}}}}}}}return a}function getThaiYearAdjustment(){var b=0;try{if(userDataMap.userLocale=="th_TH"||userDataMap.userLocale=="th"){b=543}}catch(a){return b}return b}function formatDate(b){var f=new Date(b);var e=""+(f.getMonth()+1);var a=""+f.getDate();var c=f.getFullYear();if(e.length<2){e="0"+e}if(a.length<2){a="0"+a}return[c,e,a].join("-")}function stringToDateTime(q,h,g){if(typeof(q)!="undefined"&&q!=null&&q!=""&&h){var l=h.substr(0,h.indexOf(" ")).toLowerCase();var i=h.substr(h.indexOf(" ")+1);var e=l.split(g);var p=q.substr(0,q.indexOf(" "));var k=q.substr(q.indexOf(" ")+1);var c=p.split(g);var f=e.indexOf("mm");var a=e.indexOf("dd");var b=e.indexOf("yyyy");var n=parseInt(c[f]);n-=1;var o=new Date(c[b].replace(",",""),n,c[a]);if(c[b].length==2){var d=new Date();var j=(d.getFullYear()).toString().substring(0,2);o=new Date(parseInt(j+c[b]),n,c[a])}var m=formatDate(o)+" "+k;return moment(m,"YYYY-MM-DD "+i).format("YYYY-MM-DD HH:mm:ss")}else{return q}}function setOldValuesForHiddenFields(){try{if(hiddenFieldsList&&hiddenFieldsList.length>0){var h="";for(var b=0;b<hiddenFieldsList.length;b++){h=hiddenFieldsList[b];if(dynamicFieldsMetaData){if(dynamicFieldsMetaData[hiddenFieldsList[b]]["ftype"]=="textarea"){var a=document.querySelector("#"+h+"_data iframe");if(a&&a.contentWindow){var f=a.contentWindow.document;f.open();f.write(dynamicFieldsMetaData[h]["oldValue"]+"");f.close()}else{var c=document.querySelector("#"+h+'_data .dynamicInputCls[id$="inputField"]');if(c){c.value=dynamicFieldsMetaData[h]["oldValue"]}}}else{if(dynamicFieldsMetaData[hiddenFieldsList[b]]["ftype"]=="reference"){if(h==orgNamespace+"FKImpact__c"||h==orgNamespace+"FKStatus__c"||h==orgNamespace+"FKUrgency__c"||h==orgNamespace+"FKClient__c"){setOldValueForStaticFields(h)}var c=document.querySelector("#"+h+'_data .dynamicInputCls[id$="inputField"]');if(c&&typeof(dynamicFieldsMetaData[h]["oldValue"])!="undefined"){c.value=dynamicFieldsMetaData[h]["oldValue"]}var e=document.getElementById(getHTMLInputID(h)+"_lkid");if(e&&dynamicFieldsMetaData[h]["oldValue_lkid"]){e.value=dynamicFieldsMetaData[h]["oldValue_lkid"]}var g=document.getElementById(getHTMLInputID(h)+"_lkold");if(g&&dynamicFieldsMetaData[h]["oldValue"]){g.value=dynamicFieldsMetaData[h]["oldValue"]}}else{var c=document.querySelector("#"+h+'_data .dynamicInputCls[id$="inputField"]');if(!c&&dynamicFieldsMetaData[h]["ftype"]=="picklist"){c=getElementForDependentPicklist(h)}if(c){c.value=dynamicFieldsMetaData[h]["oldValue"]}}}}}}}catch(d){}}function setOldValueForStaticFields(k){try{var i="";var f="";switch(k){case orgNamespace+"FKImpact__c":i=impactLookupId;f="impactSelectId";break;case orgNamespace+"FKStatus__c":i=statusLookupId;f="statusSelectId";break;case orgNamespace+"FKUrgency__c":i=urgencyLookupId;f="urgencySelectId";break;case orgNamespace+"FKClient__c":i=userId;break}var g=document.getElementById(i);var b=dynamicFieldsMetaData[k]["oldValue_lkid"];if(g&&b){if(g.value||b!="000000000000000"){g.value=b}var c=document.getElementById(f);var a=-1;var e;if(c&&c.options){for(var d=0;d<c.options.length;d++){e=c.options[d];if(e.value.indexOf(b)>-1){a=d;break}}if(a>-1){c.selectedIndex=a}}}}catch(h){console.log("error ",h)}}function reEvaluateDynamicFieldsConditions(a){if(a){for(var b in a){if(a.hasOwnProperty(b)){dynamicFieldsHandler(b,dynamicFieldsMetaData[b]?dynamicFieldsMetaData[b]["ftype"]:"")}}}}function getElementForDependentPicklist(a){return document.querySelector("#"+a+'_data [id$="inputField"]')};