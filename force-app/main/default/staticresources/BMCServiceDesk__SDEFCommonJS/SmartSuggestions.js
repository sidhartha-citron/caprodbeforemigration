var SelectedPanel;var fieldconfig={};var recordcount={};var contentheight={};var drawerIsExpanded=true;var selectedTemplate;var selectedBroadcast;var selectedKA;var suggestionWaitMsg;var RemoteActionCount=0;var moreRecords=new Object();var allRecords=new Object();var itemCount=1;var incChildCount;var incParentName;var incName;var selectedRows;var statusValue="";var mergeStatus="";var suggestionspanel={panelcolumns:[],create:function(c){var e=Ext.get(c+"GridPanel");if(!e){this.panelcolumns=[];var f=Ext.create("Ext.selection.CheckboxModel",{mode:"SIMPLE",renderer:function(m,j,h,n,l,k,g){if(h.data[orgNamespace+"state__c"]){j.tdCls="x-grid-cell-row-checker x-grid-cell-special";return'<div class="x-grid-row-checker">&nbsp;</div>'}else{j.tdCls="x-grid-cell-row-checker x-grid-cell-special disabledRowCls";j.style="opacity:0.3";j.componentCls="disabledRowCls";return'<div class="x-grid-row-checker">&nbsp;</div>'}}});var b={getRowClass:function(g,j,k,h){if(g.data[orgNamespace+"state__c"]){return""}else{return"disabledRowCls"}},stripeRows:false};var a=Ext.create("Ext.grid.Panel",{id:c+"GridPanel",store:this.CreateStore(c),columns:this.panelcolumns,dockedItems:this.CreateDocItems(c),listeners:this.GetListners(c),maxHeight:"194",cls:c+"cls ",width:this.getWidthOfPanel(),ui:"custom",header:false,forceFit:true,margin:"0 0 0 52",enableColumnHide:false,selModel:c=="INC"?f:null,renderTo:c+"grid",allowDeselect:true,viewConfig:c=="INC"?b:{stripeRows:false}});SelectedPanel=c+"GridPanel"}else{Ext.getCmp(c+"GridPanel").getSelectionModel().deselectAll();Ext.getCmp(c+"GridPanel").getView().refresh();if(navigator.userAgent.indexOf("Edge/")>0){Ext.getCmp(c+"GridPanel").setWidth(this.getWidthOfPanel())}Ext.getCmp(c+"GridPanel").show();SelectedPanel=c+"GridPanel";if(this.isNeedToLoadNewData(c)){this.beforePanelCreate(c);this.getpaneldata(c);if(c=="KA"){if(Ext.getCmp("CopyTextBtn")){Ext.getCmp("CopyTextBtn").disable()}if(Ext.getCmp("CopyLinkBtn")){Ext.getCmp("CopyLinkBtn").disable()}}if(c=="BR"&&Ext.getCmp("BroadcastApplyBtn")){Ext.getCmp("BroadcastApplyBtn").disable()}if(c=="TM"&&Ext.getCmp("TemplateApplyBtn")){Ext.getCmp("TemplateApplyBtn").disable()}}else{hideSuggestionWaitMsg()}}removeActiveIconCss();document.getElementById(c+"icon").className="SmartSuggestions-Sprite "+c+"iconActive";if(c=="INC"){var d=document.getElementById("INCmorelink").offsetWidth;Ext.getCmp("INCmore").setWidth(d+40)}},CreateDocItems:function(a){var b=[];if(a=="KA"){b=[{xtype:"toolbar",items:[{xtype:"tbspacer",width:5},{text:_ServerLabels.Copy_Text,tooltip:_ServerLabels.Copy_Text,id:"CopyTextBtn",disabled:"true",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",handler:function(e,f){pasteResolution("text")}},{xtype:"tbspacer",width:2},{text:_ServerLabels.Copy_Link,tooltip:_ServerLabels.Copy_Link,id:"CopyLinkBtn",disabled:"true",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",handler:function(e,f){pasteResolution("link")}},{xtype:"tbfill"},{xtype:"label",id:"KAmore",hidden:(recordcount.KA!=undefined&&recordcount.KA>parseInt(window.parent.parent.SuggestionsMetaData.minimumLimit))?false:true,html:'<div style="float:right; padding-right:10px;"><a href="#" id="KAmorelink" class="toplink" onClick="javascript:suggestionspanel.getSuggestionsData(\'KA\',\'true\');">'+_ServerLabels.ShowMore+"</a></div>"},{xtype:"tbspacer",}],height:33}]}if(a=="BR"){var d=lookupFilterIDMap[orgNamespace+"FKBroadcast__c"];b=[{xtype:"toolbar",items:[{xtype:"tbspacer",width:5},{text:_ServerLabels.Link,tooltip:_ServerLabels.Link,id:"BroadcastApplyBtn",disabled:"true",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",handler:function(f,g){lookupPick2("{!$Component.theForm}",d+"_lkid",d,selectedBroadcast.Id,Ext.String.htmlDecode(selectedBroadcast.Name),false);var e=Ext.getCmp("BRGridPanel").getSelectionModel().getLastSelected();Ext.getCmp("BRGridPanel").getSelectionModel().deselect(e);document.getElementById(e.data.Id).checked=false;disableButtons("BR")}},{xtype:"tbspacer",width:5},{xtype:"label",id:"brFldConfigError",hidden:d?true:false,text:_ServerLabels.broadcastFieldError},{xtype:"tbfill"},{xtype:"label",id:"BRmore",hidden:(recordcount.BR!=undefined&&recordcount.BR>parseInt(window.parent.parent.SuggestionsMetaData.minimumLimit))?false:true,html:'<div style="float:right; padding-right:10px;"><a href="#" id="BRmorelink" class="toplink" onClick="javascript:suggestionspanel.getSuggestionsData(\'BR\',\'true\');">'+_ServerLabels.ShowMore+"</a></div>"},{xtype:"tbspacer",}],height:33}]}if(a=="INC"){b=[{xtype:"toolbar",items:[{xtype:"tbspacer",width:5},{text:_ServerLabels.LinkAsParent,id:"LinkAsParentBtn",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",disabled:"true",handler:function(e,f){suggestionspanel.incidentsPanel.linkAsParentHandler()}},{xtype:"label",width:3},{text:_ServerLabels.LinkasChild,id:"LinkasChildBtn",disabled:"true",menu:{id:"LinkasChildMenu",cls:"menuColour",closeAction:"hide",items:[{xtype:"tbtext",text:_ServerLabels.Updatestatusoflinkedrecords,cls:"commonClsWithPaddingAndColour"},{xtype:"form",layout:{type:"hbox",align:"middle",pack:"start"},border:false,height:35,items:[{xtype:"textfield",frame:false,id:"statusLookUpId",name:"lookupvalue",cls:"statusLookUpCls",value:statusValue},{xtype:"box",margin:"0 10 0 0",autoEl:{tag:"div"},name:"statusLookUpBtn",id:"statusLookUpButtonId",cls:"lookupIcon statusLookUp",overCls:"lookupIconOn",listeners:{render:function(e){e.getEl().on("click",function(){var f="active_custom";var h="status_in";var g="SearchAndLink?txt=statusLookUpId-inputEl&frm=linkingPage:theForm&filterObjectId="+incidentId+"&parentName=Incident__c&childName=Status__c&isLookUp=Status__c&filterId="+f+"&addlFilterId="+h;popUpWindow=new Ext.Window({height:600,width:1000,x:10,y:5,id:"popUpWindow",modal:true,resizable:false,constrain:true,viewConfig:{forceFit:true},html:'<iframe frameborder="0" src ="/apex/'+g+'" style="width:100%;height:100%;border:none; overflow: hidden;"/>'});popUpWindow.show()})}}}]},{xtype:"form",layout:{type:"vbox",align:"start",pack:"center"},margins:"5 0 0 4",cls:"menuColour",border:false,height:35,items:[{xtype:"button",cls:"LinkAsChildBtnCls",text:_ServerLabels.Linkandupdatestatus,width:"150",handler:function(e,f){suggestionspanel.incidentsPanel.linkAsChildHandler()}}]}]}},{xtype:"label",id:"InfoIconContainer",width:30,hidden:true,html:'<div id="infoIcon" title=""><img style="height:17px;width:17px;margin-top:1px" src="'+sdefResourcePath+'/SDEFicons/AC_info_icon.png"/></div>'},{xtype:"label",id:"alternatePlaceForMsg",html:"",cls:"InfoMsgCls",width:620,hidden:true},{xtype:"tbfill"},{xtype:"label",id:"INCmore",hidden:(recordcount.INC!=undefined&&recordcount.INC>parseInt(window.parent.parent.SuggestionsMetaData.minimumLimit))?false:true,html:'<div style="float:right; padding-right:10px;"><a href="#" id="INCmorelink" class="toplink" onClick="javascript:suggestionspanel.getSuggestionsData(\'INC\',\'true\');">'+_ServerLabels.ShowMore+"</a></div>"},{xtype:"tbspacer",}],height:33,id:"INCToolbar"}]}if(a=="TM"){var c=lookupFilterIDMap[orgNamespace+"FKTemplate__c"];b=[{xtype:"toolbar",items:[{xtype:"tbspacer",width:5},{text:_ServerLabels.ApplyTemplate,tooltip:_ServerLabels.ApplyTemplate,id:"TemplateApplyBtn",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",disabled:"true",handler:function(e,g){if(overrideRecWithTemplateVal=="true"){var f=confirm(OverwriteWarning);if(f==false){return}}lookupPick2("{!$Component.theForm}",c+"_lkid",c,selectedTemplate.Id,Ext.String.htmlDecode(selectedTemplate.Name),false);applyTemplateToRecord(selectedTemplate.Id);isByTemplate=true}},{xtype:"tbspacer",width:5},{xtype:"label",id:"templateFldConfigError",hidden:c?true:false,text:_ServerLabels.templateFieldError},{xtype:"tbfill"},{xtype:"label",id:"TMmore",hidden:(recordcount.TM!=undefined&&recordcount.TM>parseInt(window.parent.parent.SuggestionsMetaData.minimumLimit))?false:true,html:'<div style="float:right; padding-right:10px;"><a href="#" class="toplink" id="TMmorelink" onClick="javascript:suggestionspanel.getSuggestionsData(\'TM\',\'true\');">'+_ServerLabels.ShowMore+"</a></div>"},{xtype:"tbspacer",}],height:33}]}return b},GetListners:function(a){var b={};if(a=="KA"){b={itemdblclick:function(f,c,g,d,h){openDetailPage(c.data.Id,"","KAStore")},selectionchange:function(f,d,c){if(d.length>0&&document.getElementById(d[0].data.Id)!=undefined){Ext.getCmp("CopyTextBtn").enable();Ext.getCmp("CopyLinkBtn").enable();document.getElementById(d[0].data.Id).checked=true;if(d[0]&&d[0].data){selectedKA=d[0].data}}},sortchange:function(){Ext.getCmp("CopyTextBtn").disable();Ext.getCmp("CopyLinkBtn").disable();var c=Ext.getCmp("KAGridPanel").getSelectionModel().getLastSelected();Ext.getCmp("KAGridPanel").getSelectionModel().deselect(c)}}}if(a=="BR"){b={itemdblclick:function(f,c,g,d,h){if(c.data.Id){openDetailPage(c.data.Id,c.data.Name,"BRStore")}},selectionchange:function(f,d,c){var g=lookupFilterIDMap[orgNamespace+"FKBroadcast__c"];if(d.length>0&&document.getElementById(d[0].data.Id)!=undefined&&g){Ext.getCmp("BroadcastApplyBtn").enable();document.getElementById(d[0].data.Id).checked=true;selectedBroadcast=d[0].data}},sortchange:function(){Ext.getCmp("BroadcastApplyBtn").disable();var c=Ext.getCmp("BRGridPanel").getSelectionModel().getLastSelected();Ext.getCmp("BRGridPanel").getSelectionModel().deselect(c)}}}if(a=="TM"){b={selectionchange:function(g,d,c){var f=lookupFilterIDMap[orgNamespace+"FKTemplate__c"];if(d.length>0&&document.getElementById(d[0].data.Id)!=undefined&&f){Ext.getCmp("TemplateApplyBtn").enable();document.getElementById(d[0].data.Id).checked=true;selectedTemplate=d[0].data}},sortchange:function(){Ext.getCmp("TemplateApplyBtn").disable();var c=Ext.getCmp("TMGridPanel").getSelectionModel().getLastSelected();Ext.getCmp("TMGridPanel").getSelectionModel().deselect(c)}}}if(a=="INC"){b={celldblclick:function(g,l,d,c,h,k,j,f){if(d&&d!=0&&c.data.Id){openDetailPage(c.data.Id,c.data.Name,"INCStore")}},sortchange:function(){Ext.getCmp(a+"GridPanel").getSelectionModel().deselectAll()},selectionchange:function(f,d,c){suggestionspanel.incidentsPanel.setBtnState(d);selectedRows=d;suggestionspanel.incidentsPanel.setHeaderChkbox()},itemclick:function(g,c,h,d,j,f){if(!c.data[orgNamespace+"state__c"]){suggestionspanel.incidentsPanel.setHeaderChkbox()}},beforeselect:function(d,c){if(c.data[orgNamespace+"state__c"]){return true}else{return false}},beforeitemmousedown:function(g,c,h,d,j,f){if(j.target.tagName=="A"||j.target.tagName=="IMG"){return false}}}}return b},CreateStore:function(a){return Ext.create("Ext.data.JsonStore",{storeId:a+"Store",model:this.CreateModel(a),data:this.getpaneldata(a),proxy:{type:"memory",reader:{type:"json"}}})},CreateModel:function(a){return Ext.define(a+"Model",{extend:"Ext.data.Model",fields:this.getfields(a)})},loaddata:function(d){var c=Ext.getCmp(SelectedPanel);var b=SelectedPanel.split("GridPanel")[0];if(c){if(c.store.getCount()>0){c.store.removeAll()}var a=Ext.getCmp(b+"more");if(a){if(recordcount[b]!=undefined&&recordcount[b]>parseInt(window.parent.parent.SuggestionsMetaData.minimumLimit)){a.show();document.getElementById(b+"morelink").className="toplink"}else{a.hide()}disableButtons(b)}if(d!=null){c.store.loadRawData(d)}hideSuggestionWaitMsg()}},isNewData:{},isNeedToLoadNewData:function(a){if(this.isNewData[a]!=undefined){return !this.isNewData[a]}return true},getpaneldata:function(a){var b=[];if(a=="KA"){this.getSuggestionsData(a,"false");this.isNewData[a]=true}if(a=="BR"){this.getSuggestionsData(a,"false");this.isNewData[a]=true}if(a=="TM"){this.getSuggestionsData(a,"false");this.isNewData[a]=true}if(a=="INC"){this.getSuggestionsData(a,"false");this.isNewData[a]=true}return b},getfields:function(c){var g=[];var b=["INC"+orgNamespace+"state__c","INC"+orgNamespace+"Incidents__r","INC"+orgNamespace+"FKIncident__c"];if(window.parent.parent.SuggestionsMetaData&&window.parent.parent.SuggestionsMetaData[c]){if(c=="INC"){this.pushcolumn(c,"Id",null,null,null,true)}else{this.pushcolumn(c,"Id",null,null,null,false)}var d;g.push("Id");var m=[];var h=[];if(window.parent.parent.SuggestionsMetaData[c]!=" "){var a=window.parent.parent.SuggestionsMetaData[c].split(String.fromCharCode(1087));if(userLanguage=="iw"){a.reverse()}var f,k,j,l;for(i=0;i<a.length;i++){f=a[i].split(String.fromCharCode(981));fieldapi=f[0];j=f[1];l=f[2];if(fieldapi.indexOf("__r.")>0){var e=fieldapi.split(".");m.push({name:fieldapi,outerProp:e[0],innerProp:e[1]})}g.push({name:fieldapi});if(l=="DATETIME"||l=="DATE"||l=="DATETIMECALCULATED"||l=="DATECALCULATED"){h.push({name:fieldapi,type:l})}if(fieldapi=="DefaultStatus"){mergeStatus=l;statusValue=j}else{if(b.indexOf(c+fieldapi)>-1){this.pushcolumn(c,fieldapi,j,l,true,true)}else{this.pushcolumn(c,fieldapi,j,l)}}}}fieldconfig[c]=({lookups:m,datefields:h})}return g},changeNameToLink:function(f,b,c,d,j,h,e){var g=e.ownerCt.columns[j].dataIndex;var a;if(g=="Name"){a=c.data.Id}else{if(g==orgNamespace+"FKIncident__r.Name"){a=c.data[orgNamespace+"FKIncident__c"]}}if(f&&a){return Ext.String.format("<a href=\"#\" style=\"color:black;\" onclick=\"openDetailPage('{1}','{0}','{2}')\">{0}</a>",f,a,c.store.storeId)}else{return""}},pushcolumn:function(d,h,b,e,g,c){var f=true;if(e){e=e.toUpperCase()}if(c){this.panelcolumns.push({hidden:true,dataIndex:h})}else{if(h&&h.toUpperCase()=="ID"){this.panelcolumns.push({header:"",width:25,maxWidth:35,sortable:false,dataIndex:"Id",align:"center",renderer:function(n,j,k,o,m,l){return'<input   id="'+n+'" onchange="setDefault('+o+",'KAgridtable');\" type=radio name=\""+d+'radio">'}})}else{if(e=="BOOLEAN"){var a=('<tpl for="."><p  class="checkbox_<tpl if="'+h+'==true">checked</tpl><tpl if="'+h+'==false">unchecked</tpl>" ></tpl>');this.panelcolumns.push({text:b,xtype:"templatecolumn",tpl:a,flex:1,tooltipType:"title",tooltip:b})}else{if(e&&e.indexOf("CALCULATED")>-1){if(e=="DATECALCULATED"){f=Ext.util.Format.dateRenderer(window.parent.parent.SuggestionsMetaData.ExtUserDateOnlyFormat)}else{if(e=="DATETIMECALCULATED"){f=Ext.util.Format.dateRenderer(window.parent.parent.SuggestionsMetaData.ExtUserDateFormat)}else{f=function(j){return Ext.String.htmlDecode(j)}}}this.panelcolumns.push({header:b,dataIndex:h,sortable:g,tooltip:b,tooltipType:"title",flex:1,renderer:f})}else{if(e=="URL"){this.panelcolumns.push({header:b,dataIndex:h,sortable:g,tooltip:b,tooltipType:"title",flex:1,renderer:function(j){if(j.slice(0,"http://".length)!="http://"&&j.slice(0,"https://".length)!="https://"){return'<a href="https://'+j+'" target="_blank">'+j+"</a>"}else{return'<a href="'+j+'" target="_blank">'+j+"</a>"}}})}else{if(e=="RTF"){this.panelcolumns.push({header:b,dataIndex:h,sortable:g,tooltip:b,tooltipType:"title",flex:1,renderer:function(j){return stripOffHTML(Ext.String.htmlDecode(j))}})}else{if(e=="DATETIME"||e=="DATE"){f=Ext.util.Format.dateRenderer((e=="DATETIME")?window.parent.parent.SuggestionsMetaData.ExtUserDateFormat:window.parent.parent.SuggestionsMetaData.ExtUserDateOnlyFormat)}if((d=="KA"||d=="BR"||d=="INC")&&(h=="Name"||h==orgNamespace+"FKIncident__r.Name")){this.panelcolumns.push({header:b,dataIndex:h,sortable:g,tooltipType:"title",tooltip:b,flex:1,renderer:this.changeNameToLink})}else{this.panelcolumns.push({header:b,dataIndex:h,sortable:g,tooltip:b,tooltipType:"title",flex:1,renderer:f})}}}}}}}},getSuggestionsData:function(b,a){if(a=="true"&&allRecords[b]!=undefined&&allRecords[b]!=""){toggleMoreRecords(b);return}Visualforce.remoting.Manager.invokeAction(getSuggestions,b,fieldListeners,{isMore:a,INC_MatchingFields:window.parent.parent.SuggestionsMetaData.INC_MatchingFields},function(c,d){if(d.status){Ext.getCmp(SelectedPanel).store.clearFilter();suggestionspanel.normalizeData(b,c);if(a=="true"){allRecords[b]=true;moreRecords[b]=true;toggleMoreLink(b)}}else{showMsg(d.message)}})},normalizeData:function(a,c){itemCount=1;var g;if((fieldconfig[a]&&fieldconfig[a].lookups||a=="INC")&&c!=null){var h=fieldconfig[a];for(var d=0;d<c.length;d++){if(h&&h.lookups&&h.lookups.length>0){for(var b=0;b<h.lookups.length;b++){var l=h.lookups[b];if(c[d][l.outerProp]==null){c[d][l.outerProp]={};c[d][l.outerProp][l.innerProp]=null}}}if(h&&h.datefields&&h.datefields.length>0){for(var b=0;b<h.datefields.length;b++){var f=h.datefields[b];if(typeof(c[d][f.name])!="undefined"&&c[d][f.name]!=null){var m;if(f.type=="DATE"||f.type=="DATECALCULATED"){m=new Date(c[d][f.name])}else{dt=new Date(c[d][f.name]);var n=dt.getTimezoneOffset();var e=dt.getTime();var k=e+(n*60000);m=new Date(k+parseFloat(window.parent.parent.SuggestionsMetaData.localOffset))}c[d][f.name]=Ext.Date.format(m,"c")}}}if(incidentId&&c[d].Id==incidentId){incName=c[d].Name;incParentName=c[d][orgNamespace+"FKIncident__r"]["Name"];incChildCount=c[d][orgNamespace+"Incidents__r"]&&c[d][orgNamespace+"Incidents__r"].length>0?c[d][orgNamespace+"Incidents__r"].length:0;suggestionspanel.incidentsPanel.setInfoMsg();g=d;suggestionspanel.incidentsPanel.setBtnState()}}}if(g||g==0){c.splice(g,1)}this.loaddata(c)},resetpanels:function(){this.isNewData={};if(drawerIsExpanded&&SelectedPanel!=undefined&&SelectedPanel!=""){this.create(SelectedPanel.split("GridPanel")[0])}else{hideSuggestionWaitMsg()}},beforePanelCreate:function(a){if(Ext.getCmp(SelectedPanel)){Ext.getCmp(SelectedPanel).store.clearFilter()}allRecords[a]="";moreRecords[a]=false;toggleMoreLink(a)},getWidthOfPanel:function(){return window.innerWidth-55},incidentsPanel:{setBtnState:function(d){var e=Ext.getCmp("LinkAsParentBtn");var c=Ext.getCmp("LinkasChildBtn");var b=false;if(e){if(d&&d.length==1&&incidentId&&!incParentName&&!incChildCount){e.setText(_ServerLabels.LinkAsParentLabel.replace("{0}",incName));e.enable();b=true}else{e.setText(_ServerLabels.LinkAsParent);e.disable()}}if(c){if(d&&d.length>=1&&incidentId&&!incParentName){c.enable();c.setText(_ServerLabels.LinkAsChildLabel.replace("{0}",incName));b=true}else{c.setText(_ServerLabels.LinkasChild);c.disable();Ext.getCmp("InfoIconContainer").alignTo("LinkasChildBtn","l-r");Ext.getCmp("alternatePlaceForMsg").alignTo("InfoIconContainer","l-r",[-10,1])}}if(e||c){var a=Ext.getCmp("INCToolbar").getWidth();document.getElementById("INCToolbar-targetEl").style.width=a;a=a-Ext.getCmp("LinkAsParentBtn").getWidth();a=a-Ext.getCmp("LinkasChildBtn").getWidth();a=a-document.getElementById("INCmorelink").offsetWidth-105;if(b){a=a-7}Ext.getCmp("alternatePlaceForMsg").setWidth(a)}},linkAsParentHandler:function(){if(selectedRows&&selectedRows.length==1){if(selectedRows[0].data[orgNamespace+"FKIncident__r.Name"]){var a=_ServerLabels.The+" "+selectedRows[0].data.Name+" "+_ServerLabels.LinkParentError;showMsg(a)}else{if(incidentId){showSuggestionWaitMsg();Visualforce.remoting.Manager.invokeAction(linkIncidents,[selectedRows[0].data.Id],incidentId,"PARENT",null,function(b,c){if(c.status){if(b!=null){b=JSON.parse(b);if(b.linkSuccessful==true){afterDrawerRender();clearMsgs()}else{hideSuggestionWaitMsg();showMsg(b.errorMsg)}}}else{showMsg(c.message);hideSuggestionWaitMsg()}},{escape:false})}}}},linkAsChildHandler:function(){Ext.getCmp("LinkasChildMenu").close();clearMsgs();if(selectedRows&&selectedRows.length>=1&&incidentId){var c="";var e=false;var b=[];for(i=0;i<selectedRows.length;i++){if(selectedRows[i].data[orgNamespace+"FKIncident__r.Name"]){e=true}if(selectedRows[i].data[orgNamespace+"Incidents__r"]){c+=selectedRows[i].data.Name+", "}b.push(selectedRows[i].data.Id)}c=c.substring(0,c.length-2);if(c){var d=_ServerLabels.ParentChildError+"<br/>"+c;showMsg(d)}else{if(e){var a=Ext.MessageBox;a.cls="reMergeConfBox";a.setHeight(120);a.confirm(_ServerLabels.LinkasChild,_ServerLabels.ReMergeValidationErrorMsg,function(f){if(f==="yes"){suggestionspanel.incidentsPanel.linkAsChild(b)}})}else{suggestionspanel.incidentsPanel.linkAsChild(b)}}}},linkAsChild:function(a){showSuggestionWaitMsg();Visualforce.remoting.Manager.invokeAction(linkIncidents,a,incidentId,"CHILD",{Status:mergeStatus},function(b,c){if(c.status){if(b!=null){b=JSON.parse(b);if(b.linkSuccessful==true){afterDrawerRender();clearMsgs()}else{hideSuggestionWaitMsg();showMsg(b.errorMsg)}}}else{showMsg(c.message);hideSuggestionWaitMsg()}},{escape:false})},setInfoMsg:function(){if(incParentName||incChildCount>0){Ext.getCmp("InfoIconContainer").show();var b="";if(incParentName){b=_ServerLabels.ParentMsg.replace("{0}",incName).replace("{1}",incParentName)}if(incChildCount>0){b+=_ServerLabels.ChildMsg.replace("{0}",incName).replace("{1}",incChildCount)}b=Ext.htmlEncode(b);var a='<span title="'+(Ext.isIE?b:suggestionspanel.incidentsPanel.wrapText(b))+'">'+b+"</span>";Ext.getCmp("alternatePlaceForMsg").show();Ext.getCmp("alternatePlaceForMsg").setText(a,false)}},setHeaderChkbox:function(){if(Ext.getCmp("INCGridPanel")){var a=Ext.getCmp("INCGridPanel").columns[0].el.id;var c=document.getElementById(a);if(c){var b=0;Ext.getCmp("INCGridPanel").getStore().each(function(d){if(d.data[orgNamespace+"state__c"]){b++}});if(selectedRows&&b&&selectedRows.length==b){c.className+=" x-grid-hd-checker-on"}else{c.className=c.className.replace("x-grid-hd-checker-on","")}}}},wrapText:function(d){var c="";var a=0;var b;if(d){for(b=0;b<d.split("").length;b++){c+=d[b];a++;if(d[b]==" "&&a>=50){c+="&#13;";a=0}}}return c}}};Ext.onReady(function(){var a=document.getElementById("suggestionscontent");if(a){suggestionWaitMsg=new Ext.LoadMask(document.getElementById("suggestionscontent"),{msgCls:"loadingtextcls",useMsg:false});calculateHeight();if(document.getElementById("formoutputpanel")){document.getElementById("formoutputpanel").style.height=contentheight["collapse-form"]}if(window.parent.parent.SuggestionsMetaData==undefined){getMetaData()}else{addListenersForIncidentMatching();createSSdrawer();afterDrawerRender()}}});function getMetaData(){Visualforce.remoting.Manager.invokeAction(getSuggestionsMetaData,function(a,b){if(b.status){if(a!=null){window.parent.parent.SuggestionsMetaData=a;addListenersForIncidentMatching();createSSdrawer();afterDrawerRender()}}else{showMsg(b.message);hideSuggestionWaitMsg()}},{escape:false})}function addListenersForIncidentMatching(){if(window.parent.parent.SuggestionsMetaData!=undefined){if(window.parent.parent.SuggestionsMetaData.INC_MatchingFields!=undefined&&window.parent.parent.SuggestionsMetaData.INC_MatchingFields!=""){var a=window.parent.parent.SuggestionsMetaData.INC_MatchingFields.split(",");for(var c=0;c<a.length;c++){var e=a[c];if(!checkForListeners(e)){var b=lookupFilterIDMap[e];if(b!=undefined){var d=document.getElementById(b).value;if(d==undefined){d=""}if(lookupFilterTypeMap[e]=="reference"){fieldListeners[e]=document.getElementById(b+"_lkid").value;fieldListeners[b+"_Name"]=d}else{fieldListeners[e]=d}addListenerforFields(e)}}}}}}function createSSdrawer(){var b=document.getElementById("nav-suggestion");var a=getCookie("RFConsole_SuggestionsExpanded");drawerIsExpanded=a;if((a!=null&&a=="true")&&(isNewIncident!="true"||oldIncidentId!="")){expandSuggestion();b.setAttribute("class","expand")}b.appendChild(createToggleIcon(a));if(window.parent.parent.SuggestionsMetaData.KA){b.appendChild(createliHTML("KA","KAicon_d",_ServerLabels.MobKnowledgeArticles))}if(window.parent.parent.SuggestionsMetaData.INC){b.appendChild(createliHTML("INC","INCicon_d",_ServerLabels.Navigator_Incidents))}if(window.parent.parent.SuggestionsMetaData.TM){b.appendChild(createliHTML("TM","TMicon_d",_ServerLabels.Navigator_Templates))}if(window.parent.parent.SuggestionsMetaData.BR){b.appendChild(createliHTML("BR","BRicon_d",_ServerLabels.Navigator_Broadcasts))}}function createToggleIcon(d){drawerIsExpanded=(d!=null&&d=="true")?true:false;var e=document.createElement("div");e.setAttribute("id","drawericon");e.setAttribute("title",SmartSuggestionsTooltip);e.setAttribute("class",(d!=null&&d=="true")?"toggledown":"toggleup");var c=document.createElement("a");c.setAttribute("id","drawer");c.setAttribute("onclick","TogglePanel(true)");c.appendChild(e);var b=document.createElement("li");b.className="toggleIconLI";b.appendChild(c);return b}function createliHTML(d,e,g){var h=document.createElement("div");h.setAttribute("id",d+"icon");h.setAttribute("class","SmartSuggestions-Sprite  "+e);h.setAttribute("title",g);var f=document.createElement("SPAN");f.setAttribute("id",d+"spanCount");f.className="countSpanIcon";if(GetIEVersion()>0){f.className+=" countSpanIconForIE"}var c=document.createElement("a");c.setAttribute("id",d+"link");c.setAttribute("onclick","openSuggestionsPanel('"+d+"');");c.setAttribute("class","disablecss");c.appendChild(h);h.appendChild(f);var b=document.createElement("li");b.appendChild(c);return b}function setCookie(a,c){var b=new Date();b.setYear(b.getFullYear()+10);document.cookie=a+"="+c+";expires="+b.toUTCString()+";SameSite=None;Secure"}function getCookie(a){var b=new RegExp(a+"=([^;]+)");var c=b.exec(document.cookie);return(c!=null)?unescape(c[1]):null}function openDetailPage(a,d,b){if(b=="KAStore"&&a!=undefined){var c="/apex/"+ns+"KM_ArticleView?id="+a+"&calledFromform=true&standardLayout=true&isSmart=true&incidentID="+incidentId;var h=650;var e=1024;var g=(window.parent&&window.parent.parent)?(window.parent.parent.isRFConsoleList==true)?(window.parent.screenTop(h)-20):0:0;var f=(window.parent&&window.parent.parent)?(window.parent.parent.isRFConsoleList==true)?window.parent.screenLeft(e):0:0;window.open(c,"_blank","status = 1, height ="+h+", width ="+e+",left="+f+",top="+g+", resizable = 1, scrollbars=no")}if(b=="BRStore"){if(window.parent&&window.parent.parent){if(window.parent.parent.isRFConsoleList==true){window.parent.parent.addTab(a,d,"Broadcasts__c")}}}if(b=="INCStore"){if(window.parent&&window.parent.parent){if(window.parent.parent.isRFConsoleList==true){window.parent.parent.addTab(a,d,"Incident__c")}}}}function TogglePanel(a){if(document.getElementById("nav-suggestion").className=="collapsible"&&((recordcount.KA!=undefined&&recordcount.KA>0)||(recordcount.BR!=undefined&&recordcount.BR>0)||(recordcount.INC!=undefined&&recordcount.INC>0)||(recordcount.TM!=undefined&&recordcount.TM>0))){expandSuggestion();drawerIsExpanded=true;openSelectedPanel()}else{if(document.getElementById("nav-suggestion").className=="expand"){collapseSuggestion();drawerIsExpanded=false}}if(a){setCookie("RFConsole_SuggestionsExpanded",(document.getElementById("nav-suggestion").className=="collapsible")?"false":"true")}}function openSuggestionsPanel(a){if(document.getElementById(a+"link").className=="disablecss"){return}if(a!=undefined&&SelectedPanel!=a+"GridPanel"){showSuggestionWaitMsg();hidePrePanel();if(!drawerIsExpanded){drawerIsExpanded=true;setCookie("RFConsole_SuggestionsExpanded","true")}if(SelectedPanel!=undefined&&SelectedPanel!=""){var b=document.getElementById(SelectedPanel.split("GridPanel")[0]+"link");if(b.className!="disablecss"){b.className=""}}removeActiveIconCss();document.getElementById(a+"icon").className="SmartSuggestions-Sprite "+a+"iconActive";if(document.getElementById("nav-suggestion").className=="collapsible"){expandSuggestion()}suggestionspanel.create(a);SelectedPanel=a+"GridPanel"}else{if(SelectedPanel==a+"GridPanel"&&document.getElementById("nav-suggestion").className=="collapsible"){showSuggestionWaitMsg();if(!drawerIsExpanded){drawerIsExpanded=true;setCookie("RFConsole_SuggestionsExpanded","true")}expandSuggestion();suggestionspanel.create(a);SelectedPanel=a+"GridPanel"}}}function hidePrePanel(a){var b=Ext.getCmp(SelectedPanel);if(b){b.hide()}if(a!=undefined&&a!=""){SelectedPanel=a+"GridPanel"}}function collapseSuggestion(){if(contentheight["collapse-form"]==undefined){calculateHeight()}document.getElementById("nav-suggestion").className="collapsible";hidePrePanel();if(document.getElementById("drawericon")){document.getElementById("drawericon").className="toggleup toggleupHoverCls"}if(document.getElementById("formoutputpanel")){document.getElementById("formoutputpanel").style.height=contentheight["collapse-form"]}if(document.getElementById("suggestionscontent")){document.getElementById("suggestionscontent").style.height=contentheight["collapse-SS"]}removeActiveCss();removeActiveIconCss()}function removeActiveCss(){var b=document.getElementById("BRlink");var c=document.getElementById("KAlink");var a=document.getElementById("TMlink");var d=document.getElementById("INClink");if(b&&b.className!="disablecss"){b.className=""}if(c&&c.className!="disablecss"){c.className=""}if(a&&a.className!="disablecss"){a.className=""}if(d&&d.className!="disablecss"){d.className=""}}function removeActiveIconCss(){var b=document.getElementById("BRicon");var c=document.getElementById("KAicon");var a=document.getElementById("TMicon");var d=document.getElementById("INCicon");if(b&&b.className.indexOf("Active")!=-1){b.className="SmartSuggestions-Sprite BRicon"}if(c&&c.className.indexOf("Active")!=-1){c.className="SmartSuggestions-Sprite KAicon"}if(a&&a.className.indexOf("Active")!=-1){a.className="SmartSuggestions-Sprite TMicon"}if(d&&d.className.indexOf("Active")!=-1){d.className="SmartSuggestions-Sprite INCicon"}}function expandSuggestion(){if(contentheight["collapse-form"]==undefined){calculateHeight()}if(document.getElementById("drawericon")){document.getElementById("drawericon").className="toggledown"}document.getElementById("nav-suggestion").className="expand";if(document.getElementById("suggestionscontent")){document.getElementById("suggestionscontent").style.height=contentheight["expand-SS"]}if(document.getElementById("formoutputpanel")){document.getElementById("formoutputpanel").style.height=contentheight["expand-form"]}if(window.parent!=undefined&&typeof window.parent.hidesmartview=="function"){window.parent.hidesmartview()}if(window.parent&&typeof window.parent.hideCISmartview=="function"){window.parent.hideCISmartview()}}function getcounts(a){showSuggestionWaitMsg();var b=orgNamespace+"incidentDescription__c";if(window.parent.parent.SuggestionsMetaData.BR){Visualforce.remoting.Manager.invokeAction(getSuggestionsCount,"BR",a,null,function(c,d){if(d.status){if(c!=null){changeIconState("BR",c);RemoteActionCount+=1;checkforPanelISselectdforExpendedview()}}else{console.log(d.message);showMsg(d.message);hideSuggestionWaitMsg()}},{escape:false})}if(window.parent.parent.SuggestionsMetaData.KA){Visualforce.remoting.Manager.invokeAction(getSuggestionsCount,"KA",a,null,function(c,d){if(d.status){if(c!=null){changeIconState("KA",c);RemoteActionCount+=1;checkforPanelISselectdforExpendedview()}}else{console.log(d.message);showMsg(d.message);hideSuggestionWaitMsg()}},{escape:false})}if(window.parent.parent.SuggestionsMetaData.INC){Visualforce.remoting.Manager.invokeAction(getSuggestionsCount,"INC",a,{INC_MatchingFields:window.parent.parent.SuggestionsMetaData.INC_MatchingFields},function(c,d){if(d.status){if(c!=null){changeIconState("INC",c);RemoteActionCount+=1;checkforPanelISselectdforExpendedview()}}else{console.log(d.message);showMsg(d.message);hideSuggestionWaitMsg()}},{escape:false})}if(window.parent.parent.SuggestionsMetaData.TM){if(applytemplateToExistingRecord!="false"||isNewIncident=="true"){Visualforce.remoting.Manager.invokeAction(getSuggestionsCount,"TM",a,null,function(c,d){if(d.status){if(c!=null){changeIconState("TM",c);RemoteActionCount+=1;checkforPanelISselectdforExpendedview()}}else{showMsg(d.message);console.log(d.message);hideSuggestionWaitMsg()}},{escape:false})}else{changeIconState("TM",0);RemoteActionCount+=1;checkforPanelISselectdforExpendedview()}}}function checkforPanelISselectdforExpendedview(){var a=document.getElementById("drawer");if(RemoteActionCount==SSobjectsCount()){suggestionspanel.isNewData={};openSelectedPanel();RemoteActionCount=0}}function openSelectedPanel(){if(drawerIsExpanded){if(SelectedPanel!=undefined&&SelectedPanel!=""&&recordcount[SelectedPanel.split("GridPanel")[0]]!=undefined&&recordcount[SelectedPanel.split("GridPanel")[0]]>0){expandSuggestion();suggestionspanel.resetpanels()}else{if(recordcount.KA!=undefined&&recordcount.KA>0){openSuggestionsPanel("KA")}else{if(recordcount.INC!=undefined&&recordcount.INC>0){openSuggestionsPanel("INC")}else{if(recordcount.TM!=undefined&&recordcount.TM>0){openSuggestionsPanel("TM")}else{if(recordcount.BR!=undefined&&recordcount.BR>0){openSuggestionsPanel("BR")}}}}}}else{hideSuggestionWaitMsg()}if(drawerIsExpanded&&(recordcount.KA==undefined||recordcount.KA<=0)&&(recordcount.BR==undefined||recordcount.BR<=0)&&(recordcount.INC==undefined||recordcount.INC<=0)&&(recordcount.TM==undefined||recordcount.TM<=0)){hidePrePanel();SelectedPanel="";collapseSuggestion();hideSuggestionWaitMsg()}if(drawer){if((recordcount.KA==undefined||recordcount.KA<=0)&&(recordcount.BR==undefined||recordcount.BR<=0)&&(recordcount.INC==undefined||recordcount.INC<=0)&&(recordcount.TM==undefined||recordcount.TM<=0)){drawer.setAttribute("style","cursor:default");removeDrawerColorIcon(drawer)}else{drawer.setAttribute("style","cursor:pointer");drawer.childNodes[0].className+=" "+drawer.childNodes[0].className+"HoverCls"}}}function removeDrawerColorIcon(b){var a=b.childNodes[0].className;if(a.indexOf("Hover")>0){a=a.replace("toggledownHoverCls","");b.childNodes[0].className=a.replace("toggleupHoverCls","")}}function SSobjectsCount(){var a=0;if(window.parent.parent.SuggestionsMetaData.KA){a+=1}if(window.parent.parent.SuggestionsMetaData.BR){a+=1}if(window.parent.parent.SuggestionsMetaData.TM){a+=1}if(window.parent.parent.SuggestionsMetaData.INC){a+=1}return a}function changeIconState(b,d){recordcount[b]=d;var c=document.getElementById(b+"link");var a=document.getElementById(b+"icon");var e=document.getElementById(b+"spanCount");if(d>0){if(c){c.removeAttribute("class")}if(e){e.textContent=d;e.style.visibility="visible"}if(a){a.className="SmartSuggestions-Sprite "+b+"icon"}}else{if(c){c.setAttribute("class","disablecss");if(a){a.className="SmartSuggestions-Sprite  "+b+"icon_d"}}if(e){e.style.visibility="hidden"}}}function calculateHeight(){var a=getPageHeight();contentheight["expand-SS"]=(a)?"194px":"30%";contentheight["collapse-SS"]=(a)?"35px":"5%";contentheight["expand-form"]=(a)?a-194+"px":"70%";contentheight["collapse-form"]=(a)?a-32+"px":"95%"}function getPageHeight(d){d=d||document;var b=d.body,c=d.documentElement;var a=Math.max(b.scrollHeight,b.offsetHeight,c.clientHeight,c.scrollHeight,c.offsetHeight);return a}function hideSuggestionWaitMsg(){if(suggestionWaitMsg!=""&&suggestionWaitMsg!="undefined"){suggestionWaitMsg.setVisible(false)}}function showSuggestionWaitMsg(){if(suggestionWaitMsg&&suggestionWaitMsg!=""){suggestionWaitMsg.setVisible(true)}}function pasteResolution(c){var b;if(lookupFilterIDMap[ns+"incidentResolution__c"]){b=document.getElementById(lookupFilterIDMap[ns+"incidentResolution__c"])}if(b&&((c=="link"&&window.parent.linkArticleIds.indexOf(selectedKA.Id)<0)||(c=="text"&&window.parent.textArticleIds.indexOf(selectedKA.Id)<0))){Visualforce.remoting.Manager.invokeAction(getResolution,selectedKA.Id,c,function(d,e){if(e.status){if(d){if(d!=""){d=d.replace(/<\s*br\/*>/gi,"\n");d=d.replace(/<\s*li*>/gi,"\n");d=d.replace(/<\s*ol*>/gi,"\n");d=d.replace(/<\s*ul*>/gi,"\n");d=d.replace(/<\s*div*>/gi,"\n");d=d.replace(/<\s*a.*href="(.*?)".*>(.*?)<\/a>/gi," $2 (Link->$1) ");d=d.replace(/<\s*\/*.+?>/ig," ");d=d.replace(/ {2,}/gi," ");d=d.replace(/\n+\s*/gi,"\n");if(c=="text"){d=htmlDecode(d)}var f=b.value;if(f){f+=" "+d}else{f=d}b.value=f;setTabUnsavedChanges()}}}else{showMsg(e.message)}},{escape:false})}if(c=="text"){window.parent.textArticleIds+=selectedKA.Id+";"}else{window.parent.linkArticleIds+=selectedKA.Id+";"}var a=Ext.getCmp("KAGridPanel").getSelectionModel().getLastSelected();Ext.getCmp("KAGridPanel").getSelectionModel().deselect(a);document.getElementById(a.data.Id).checked=false;disableButtons("KA")}function htmlDecode(a){var c="";try{c=RemedyForceHTMLProcessor.htmlDecoder(a)}catch(b){console.log("Error"+b.message)}return c}function RemoveReserveCharactersForSOSL(c){var b=new Array("?","&","|","!","{","}","[","]","(",")","^","~","*",":","\\",'"',"+","-","'");for(var a=0;a<b.length;a++){c=c.split(b[a]).join("")}return c}function disableAllIcons(){changeIconState("TM",0);changeIconState("BR",0);changeIconState("INC",0);changeIconState("KA",0)}function disableButtons(d){if(d=="KA"){var e=Ext.getCmp("CopyTextBtn");var c=Ext.getCmp("CopyLinkBtn");if(e){e.disable()}if(c){c.disable()}}else{if(d=="TM"){var a=Ext.getCmp("TemplateApplyBtn");if(a){a.disable()}}else{if(d=="BR"){var b=Ext.getCmp("BroadcastApplyBtn");if(b){b.disable()}}else{if(d=="INC"){suggestionspanel.incidentsPanel.setBtnState()}}}}}function afterDrawerRender(){var d=fieldListeners[orgNamespace+"FKCategory__c"]+"";var c=fieldListeners.CategoryName+"";var e=fieldListeners[orgNamespace+"incidentDescription__c"]+"";var b=fieldListeners[orgNamespace+"FKAccount__c"]+"";var a=fieldListeners[orgNamespace+"FKClient__c"]+"";if(doGetCounts(d,c,e,b,a,incidentId)){getcounts(fieldListeners)}else{document.getElementById("drawericon").setAttribute("class","toggleup")}}function Resizeform(){calculateHeight();if(drawerIsExpanded&&((recordcount.KA!=undefined&&recordcount.KA>0)||(recordcount.BR!=undefined&&recordcount.BR>0)||(recordcount.INC!=undefined&&recordcount.INC>0)||(recordcount.TM!=undefined&&recordcount.TM>0))){if(document.getElementById("suggestionscontent")){document.getElementById("suggestionscontent").style.height=contentheight["expand-SS"]}if(document.getElementById("formoutputpanel")){document.getElementById("formoutputpanel").style.height=contentheight["expand-form"]}}else{if(document.getElementById("formoutputpanel")){document.getElementById("formoutputpanel").style.height=contentheight["collapse-form"]}if(document.getElementById("suggestionscontent")){document.getElementById("suggestionscontent").style.height=contentheight["collapse-SS"]}}var a=Ext.getCmp(SelectedPanel);if(a){a.setSize(window.innerWidth-55,undefined)}}function toggleMoreLink(a){var b=document.getElementById(a+"morelink");if(b){if(moreRecords[a]){b.text=_ServerLabels.ShowLess}else{b.text=_ServerLabels.ShowMore}}(moreRecords[a])?moreRecords[a]=false:moreRecords[a]=true}function toggleMoreRecords(b){itemCount=1;Ext.getCmp(SelectedPanel).store.clearFilter();createFilter(b);toggleMoreLink(b);disableButtons(b);if(b!="INC"){var a=Ext.getCmp(b+"GridPanel").getSelectionModel().getLastSelected();Ext.getCmp(b+"GridPanel").getSelectionModel().deselect(a)}else{Ext.getCmp(b+"GridPanel").getSelectionModel().deselectAll()}}function createFilter(a){Ext.getCmp(SelectedPanel).store.filter([Ext.create("Ext.util.Filter",{filterFn:function(b){if(!moreRecords[a]){if(itemCount<=window.parent.parent.SuggestionsMetaData.minimumLimit){itemCount=itemCount+1;return b}}else{return b}}})])}function showMsg(a){isErrorMessage=true;isPageMessage=false;document.getElementById("messageSpace").className="message_space_off";document.getElementById("formoutputpanel").scrollTop=0;showPageMsg(a)}function clearMsgs(){var a=document.getElementById("jsscripterrorId");if(a){a.style.display="none"}document.getElementById("messageSpace").className="message_space_on"}function stripOffHTML(a){return a.replace(/(<([^>]+)>)/ig,"")}function GetIEVersion(){var b=window.navigator.userAgent;var a=b.indexOf("MSIE");if(a>0){return parseInt(b.substring(a+5,b.indexOf(".",a)))}else{if(!!navigator.userAgent.match(/Trident\/7\./)){return 11}else{return 0}}}window.onresize=Resizeform;