var toolbarItem,actionInfoArr,hideDevSummaryMenu=false,imagePath="",actionContext="",isFPUserValidated=false,ACFPLaunchWindowHeader="",reqContextId="",assemblyId="",renderedIn="",actionContextArr=["ConfigSummary","RemoteControl","FileSystem","Registry","Events","Processes","Services","PerformAudit","FileTransfer","Ping","Reboot","Shutdown","WakeUp"],listViewLabel="",selectedRowAssemlyId="",selectedrowCiId="",actionsFetchedFor="",fromStdLayout=false,selectCIerr="",noActionsAvail="",noDiscoveryActionsAvail="",acActionLabel="",acErrMsg="",deviceSummaryLabel="",objWindow=window.parent,msgStr="",firstclick=false;function getACMenu(){toolbarItem=new Ext.menu.Menu({id:"actionMenu",scale:"medium",iconCls:"acAction",items:[],listeners:{show:function(b){if(renderedIn==listViewLabel||renderedIn==instanceEditor){toolbarItem.removeAll(true);if(typeof(assemblyId)!="undefined"&&assemblyId!=null&&assemblyId!=""&&typeof(reqContextId)!="undefined"&&reqContextId!=null&&reqContextId!=""){if(assemblyId.indexOf("AC:CS:-")==0){if(isFPUserValidated){callGetActionsInfo(true)}else{var a=ACFPLaunchWindowHeader;if(isDiscoveryEnabled){a=RFDisclaunchWindowHeader}openPopupWithTitle("ACFPUserCredentialPage",callGetActionsInfo,a,Ext.isIE?242:228,530);popUpWindow.center()}}else{addNoActionsMenu()}}else{if((assemblyId==null||assemblyId=="")&&reqContextId!=""){addNoActionsMenu()}else{showAcErrMessage(selectCIerr)}}}}}});return toolbarItem}function callGetActionsInfo(a){if(a!=null&&a){isFPUserValidated=true;if(reqContextId!=actionsFetchedFor||(actionInfoArr!=null&&typeof(actionInfoArr)!="undefined"&&actionInfoArr.length==0)){waitbox(0);firstclick=true;getActionInfoJSON(assemblyId)}else{firstclick=false;setActionsState()}}}function addNoActionsMenu(){var a=noActionsAvail;if(isDiscoveryEnabled){a=noDiscoveryActionsAvail}var b=new Ext.menu.Item({id:"noAcActionsMenu",icon:imagePath+"/SDEFimages/_.GIF",disabled:true,text:a});toolbarItem.addItem(b)}function showAcErrMessage(a){Ext.MessageBox.show({width:300,title:errTitle,msg:a,buttons:Ext.MessageBox.OK})}function addACMenuItems(){var n="false";var f=0;f=getParentPageIndex();if(acVersion!=null&&acVersion!=""&&acVersion!="undefined"&&acVersion.toUpperCase()=="TRUE"&&f!=-1){n="true";var g="",h="";if(window.parent.truncatedName!=null&&window.parent.truncatedName!=""&&window.parent.truncatedName!="undefined"){h=window.parent.truncatedName}if(window.parent.strInstanceName!=null&&window.parent.strInstanceName!=""&&window.parent.strInstanceName!="undefined"){g=window.parent.strInstanceName}var j=DefaultMenuItem+g,m=DefaultMenuItem+h;var l=new Ext.menu.Item({id:"DefaultMenu",disabled:true,text:m,listeners:{render:function(){new Ext.ToolTip({target:"DefaultMenu",anchor:"left",html:j})}}});toolbarItem.addItem(l)}if(actionInfoArr!=null&&typeof(actionInfoArr)!="undefined"&&actionInfoArr.length!=0){for(var b=0;b<actionContextArr.length;b++){if(renderedIn==deviceSummaryLabel&&actionContextArr[b]=="ConfigSummary"&&n!="true"){continue}if((renderedIn==listViewLabel||renderedIn==instanceEditor)&&(actionContextArr[b]=="RemoteControl"||actionContextArr[b]=="FileSystem"||actionContextArr[b]=="PerformAudit"||actionContextArr[b]=="Ping")){toolbarItem.addSeparator()}else{if(renderedIn==deviceSummaryLabel&&(actionContextArr[b]=="FileSystem"||actionContextArr[b]=="PerformAudit"||actionContextArr[b]=="Ping")){toolbarItem.addSeparator()}}var l=new Ext.menu.Item({id:actionContextArr[b],icon:imagePath+"/SDEFimages/_.GIF",handler:function(){directConnectHandler(this)},listeners:{render:function(o){if(isDiscoveryEnabled){if(o.id!="ConfigSummary"&&DisableTabs&&o.disabled){var i=DisabledText;if(isAdminUser){i=i+" "+DiscoveryScannerCapability}new Ext.ToolTip({target:o.getEl(),anchor:"left",html:i})}}}}});toolbarItem.addItem(l)}}var k;var d=window.location.href;if(d.indexOf("apex/CMDBManager?")>0){k=""}else{k=String(window.parent)}var e=-1;if(typeof(k)!="undefined"&&k!=""){k=String(window.parent.location);e=k.indexOf("apex/AcActions")}if(n=="true"&&e!=-1){c=window.parent.incidentId;if(typeof(c)!="undefined"&&c!=""){var a,c;a=new Ext.menu.Item({id:"AdvAction",text:AdvActionLabel,listeners:{click:function(){var i=Ext.getCmp("AdvActionPanel");if(typeof(i)!="undefined"){i.expand()}},render:function(i){if(DisableTabs){i.setDisabled(true);new Ext.ToolTip({target:"AdvAction",anchor:"left",html:DisabledText})}else{if(typeof(showAdvanceTab)!="undefined"&&!showAdvanceTab){i.setDisabled(true)}else{i.setDisabled(false)}}}}});toolbarItem.addItem(a)}}}function setActionsState(){if(actionInfoArr!=null&&typeof(actionInfoArr)!="undefined"&&actionInfoArr.length!=0){addACMenuItems();if((renderedIn==listViewLabel||renderedIn==instanceEditor)&&acErrMsg==""){actionsFetchedFor=reqContextId}for(var d=0;d<actionInfoArr.length;d++){var g=actionInfoArr[d];var f=g.id;if(f=="File Trnasfer"){f="FileTransfer"}var c=g.isAvail;var b=g.label;var e=Ext.getCmp(f);if(e!=null&&typeof(e)!="undefined"&&e!="undefined"){if(c=="1"){e.setDisabled(false)}else{if(c=="0"){e.setDisabled(true)}}e.setText(b);if(DisableTabs&&e.disabled){var a=DisabledText;if(isAdminUser){a=a+" "+DiscoveryScannerCapability}new Ext.ToolTip({target:f,anchor:"left",html:a})}}}}if(renderedIn==instanceEditor&&firstclick){var h=Ext.getCmp("actionMenu");h.setPagePosition(h.getEl().lastXY[0]-120,h.getEl().lastXY[1])}}function ShowConfirmationMessageBox(a){if(a=="WakeUp"){msgStr=ACConfimMessageForWakeupDevice}else{if(a=="Reboot"){msgStr=ACConfimMessageForRebootDevice}else{if(a=="Shutdown"){msgStr=ACConfimMessageForShutdownDevice}}}if(msgStr!=""){Ext.MessageBox.show({msg:msgStr,width:300,buttons:Ext.MessageBox.YESNO,buttonText:{yes:LabelYes,no:LabelNo},fn:function(b){if(b=="yes"){waitbox(10000);directConnectDevice(a,assemblyId,selectedBEId)}}});msgStr=""}}function directConnectHandler(b){actionContext=b.id;if(isFPUserValidated){executeDirectConnectAction(true)}else{var a=ACFPLaunchWindowHeader;if(isDiscoveryEnabled){a=RFDisclaunchWindowHeader}openPopupWithTitle("ACFPUserCredentialPage",executeDirectConnectAction,a,Ext.isIE?240:228,530);popUpWindow.center()}}function executeDirectConnectAction(a){if(a!=null&&a){isFPUserValidated=true;if(acVersion!=null&&acVersion!=""&&acVersion!="undefined"&&acVersion.toUpperCase()=="TRUE"){var i=0;i=getParentPageIndex();var j=1198,e=659;var f=parseInt((screen.availWidth/2)-(j/2));var b=parseInt((screen.availHeight/2)-(e/2));if((actionContext=="Services")||(actionContext=="Events")||(actionContext=="Processes")||(actionContext=="Registry")||(actionContext=="ConfigSummary")){if(i==-1){if(fromStdLayout){reqContextId=LinkedCiId}window.open("/apex/AcActions?assemblyId="+assemblyId+"&actionContext="+actionContext+"&selectedBEId="+reqContextId,"","status = 1, height ="+e+",width ="+j+",left="+f+",top="+b+", resizable = 1, scrollbars=no")}else{objWindow.addActionTab(actionContext,assemblyId,selectedBEId)}}else{if((actionContext=="WakeUp")||(actionContext=="Reboot")||(actionContext=="Shutdown")){if(i==-1){ShowConfirmationMessageBox(actionContext)}else{objWindow.ShowConfirmationMessageBox(actionContext)}}else{if(actionContext=="RemoteControl"||actionContext=="FileSystem"||actionContext=="FileTransfer"){var g=actionContext;if(g=="RemoteControl"){g="rcd"}var c=typeof(window.parent)!="undefined"?String(window.parent.location):"";if(typeof(c)!="undefined"&&c!=null&&c!=""&&c.indexOf("apex/AcActions?")>-1){if(!makeAPICallsFromServer&&(isDiscoveryEnabled||(isACEnabled&&isACCertified))){objWindow.makeBCMActionAPIRequest(assemblyId,g,actionContext,null)}else{objWindow.getBinaryBCMConsole(assemblyId,g,"CMDBAction",actionContext,null)}}else{d=assemblyId;var k="AC:CS:-";if(d.indexOf(k)!=-1){d=d.substring(k.length,d.length)}if(!makeAPICallsFromServer&&(isDiscoveryEnabled||(isACEnabled&&isACCertified))){context="SessionId"}else{context="CMDBAction"}var h="";if((makeAPICallsFromServer)||(isACEnabled&&!isACCertified)){h=getCurrentMachinesOS()}getBinaryFileForBCMAction(d,g,context,h)}}else{if(actionContext=="PerformAudit"||actionContext=="Ping"){if(i==-1){directConnectDevice(actionContext,assemblyId,reqContextId)}else{objWindow.parentdirectConnectHandler(actionContext)}}}}}}else{if(actionContext=="ConfigSummary"){openPopupforAC("ACDeviceSummaryPage?assemblyId="+assemblyId+"&reqContextId="+reqContextId,null,deviceSummaryLabel,700,750);acpopUpWindow.center()}else{waitbox(10000);if(actionContext!="PerformAudit"){var g=actionContext;if(g=="RemoteControl"){g="rcd"}var d=assemblyId;var k="AC:CS:-";if(d.indexOf(k)!=-1){d=d.substring(k.length,d.length)}if(!makeAPICallsFromServer&&(isDiscoveryEnabled||(isACEnabled&&isACCertified))){context="SessionId"}else{context="CMDBAction"}var h="";if((makeAPICallsFromServer)||(isACEnabled&&!isACCertified)){h=getCurrentMachinesOS()}getBinaryFileForBCMAction(d,g,context,h)}else{directConnectDevice(actionContext,assemblyId,reqContextId)}}}}}function getParentPageIndex(){var b=window.location.href;if(b.indexOf("apex/CMDBManager?")>0){return -1}var c=window.parent.location;var a=-1;if(c!=null&&c!=""&&c!="undefined"){c=String(c);a=c.indexOf("apex/AcActions?")}return a}acActionHandler=function(a,b){objWindow.acActionHandler(a,b)};