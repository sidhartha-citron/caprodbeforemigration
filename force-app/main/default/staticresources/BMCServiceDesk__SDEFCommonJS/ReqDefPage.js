var g_loadTime=new Date(),startTime=new Date(),test="",durationError=0,serverTime="39",networklatencystart="",windowloaddate="";var respTypeTxt="text field",respTypeTxtArea="text area",respTypeTxtAreaRich="text area (rich)",respTypeCheckBox="check box",respTypeRadioBtn="radio button",respTypePicklist="picklist",respTypeNumber="number",respTypeDate="date",respTypeDateTime="date/time",respTypeLookup="lookup",respImpact="impact__c",respUrgency="urgency__c",respCategory="category__c";var daysSpinner,hoursSpinner,accLeftStore,accRightStore,leftStore,rightStore,idset,clickedOnce=false;var isCustomPage=true;var WinMsg;var isRichTextboxExist=false;var hideWaitMsgBar;var storeCurrentContents;var currentTooltipAvailable,currentTooltipSelected;var isClickedOnSave;var isEntitlementChanged=false;var processGrid,inputGrid,questionGrid,mappingGrid,processVarStore,processVarGrid,processOptions,objectFieldId,inputFieldId,availableMappingGrid,selectedMappingGrid;var questionStore,mappingStore;var processDataArray=[],inputDataArray=[],deletedMappings=[];var processDataStore,inputDataStore;var fulfillmentTabPanel;var reqDefId;var fulfillmentWinObj;var conditionWinObj;var selectedIndex;var descPopUpWindow;var descPopUpWindowUsrInstruction;var inputDataType="",inputDataTypeLabel;var currentFulfillmentStep=0;var typingTimer;var currentStep=0;var mappingTooltip,prefixPromptTooltip;var processId;var isEntitlementRefreshed=false;var isApexError=false;function hideDescPopup(a){if(a){descPopUpWindowUsrInstruction.hide()}else{descPopUpWindow.hide()}}function openRichTextPopup(l,d,m,a,c){onCompleteFunction=d;if(descPopUpWindow){var h=rfgetElementById("rtfDesc");var g;var e=h.contentWindow.rtfDescId;dociFrame=h.contentDocument;if(dociFrame){var n=dociFrame.getElementsByTagName("iframe");var f=n[0];if(f){doc=f.contentDocument;g=doc.getElementById(e+":textAreaDelegate_Description_Rich_Text__c_rta_body");if(!g){g=doc.getElementById(e+":textAreaDelegate_"+NAMESPACE_PREFIX+"Description_Rich_Text__c_rta_body")}RemedyForceHTMLProcessor.parseHTML(g,description_RichText)}}descPopUpWindow.show()}else{descPopUpWindow=new Ext.Window({height:a,width:c,title:m,frame:false,animate:true,modal:true,resizable:false,draggable:false,bodyStyle:"background:#FFFFFF;",cls:"RFAdminWindow whiteBackgroud",closable:false,html:'<iframe id="rtfDesc" frameborder="0" src ="/apex/'+l+'" style="width:100%;height:100%;border:none"/>',tools:[{id:"rfdescclose",qtip:(typeof(labelTooltipClose)!="undefined"&&labelTooltipClose!="undefined"&&labelTooltipClose!=null)?labelTooltipClose:"",handler:function b(q,o,p){descPopUpWindow.hide()}}]});descPopUpWindow.show()}}function openRichTextPopupUI(l,d,m,a,c){onCompleteFunction=d;if(descPopUpWindowUsrInstruction){var h=rfgetElementById("rtfUserInstruction");var g;var e=h.contentWindow.rtfUIId;dociFrame=h.contentDocument;if(dociFrame){var n=dociFrame.getElementsByTagName("iframe");var f=n[0];if(f){doc=f.contentDocument;g=doc.getElementById(e+":textAreaDelegate_User_Instructions_Rich_Text__c_rta_body");if(!g){g=doc.getElementById(e+":textAreaDelegate_"+NAMESPACE_PREFIX+"User_Instructions_Rich_Text__c_rta_body")}RemedyForceHTMLProcessor.parseHTML(g,userInstructions_RichText)}}descPopUpWindowUsrInstruction.show()}else{descPopUpWindowUsrInstruction=new Ext.Window({height:a,width:c,title:m,modal:true,resizable:false,draggable:false,frame:false,animate:true,bodyStyle:"padding: 10px; background:#FFFFFF;",cls:"RFAdminWindow whiteBackgroud",closable:false,html:'<iframe id="rtfUserInstruction" frameborder="0" src ="/apex/'+l+'" style="width:100%;height:100%;border:none"/>',tools:[{id:"rfclose",qtip:(typeof(labelTooltipClose)!="undefined"&&labelTooltipClose!="undefined"&&labelTooltipClose!=null)?labelTooltipClose:"",handler:function b(q,o,p){descPopUpWindowUsrInstruction.hide()}}]});descPopUpWindowUsrInstruction.show()}}function openRTFPopupWindow(d,a){if(!d){var b=0;if(window.innerWidth=="undefined"||window.innerWidth==undefined){b=document.documentElement.offsetWidth}else{b=window.innerWidth}if(b>1000){b=830}var e=(a)?"isUserInstruction=true":"isUserInstruction=false";var c;if(recordID!=""){c="ReqDefDescription?id="+recordID+"&"+e}else{c="ReqDefDescription?"+e}if(a){openRichTextPopupUI(c,setBusinessService,labelUserInstructions,620,b-24)}else{openRichTextPopup(c,setBusinessService,labelRichTextDescription,617,b-24)}}}var NewBtnHandler=function(){var a=rfgetElementById("newBtnId");if(a){var b=a.getAttribute("disabled");if(b!="true"){openPage("RequestDefPage",reqDefWindowHeader,reqDefWindowHeader)}}};function SaveBtnHandler(){var b=rfgetElementById("saveBtnId");if(b){var a=b.getAttribute("disabled");if(a!="true"){SaveBtnHandler(false)}}}function SaveBtnHandler(m){showLoadingMask();isApexError=false;var b=null;if(getRefDefDescriptionEle()!=null&&getRefDefDescriptionEle()!=""){b=getRefDefDescriptionEle().value;var d=b.length;if(!Ext.isIE&&b!=null){if(null!=b.match(/[^\n]*\n[^\n]*/gi)){d=d+b.match(/[^\n]*\n[^\n]*/gi).length}}}if(d<=32000){var g=getDaysTargetHiddenEle(),f=getHoursTargetHiddenEle();g.value=daysSpinner.getValue();f.value=hoursSpinner.getValue();assignEntitlementValues();var p="";if(isInputOrderChanged){var o=inputGrid.getStore();for(var h=0;h<o.getCount();h++){p=p+(p==""?"":",")+o.getAt(h).data.id}rfgetElementById(reqInputOrderCompId).value=p;isInputOrderChanged=false}var l=rfgetElementById("thePage:ReqDefForm:AllAccountsSS");var c=rfgetElementById("thePage:ReqDefForm:AllAccountCon");var n=rfgetElementById("accountRadioEveryOne_SS");var a=rfgetElementById("accountRadioEveryOne_Con");if(n&&n.checked){l.value=true}else{l.value=false}if(a&&a.checked){c.value=true}else{c.value=false}var q=[];if(mappingStore){mappingStore.clearFilter();for(i=0;i<mappingStore.data.items.length;i++){var e=mappingStore.data.items[i].data.mappings;for(j=0;j<e.length;j++){q.push(JSON.stringify(e[j]))}}applyFilterOnMappingStore()}if(m){saveandnext(LKfilterId,q.toString());isClickedOnSave=true;isEntitlementChanged=false}else{save(LKfilterId,q.toString());isClickedOnSave=true;isEntitlementChanged=false}}else{if(d>32000){Ext.create("Ext.window.MessageBox").show({msg:Description+": "+TextAreaOverflow,width:300,buttons:Ext.MessageBox.OK})}}}function closeMsgDiv(a){document.getElementById(a).setAttribute("style","display:none")}function assignEntitlementValues(){var a=Ext.getCmp("accountSelector").getValue();var d=0;var c="";while(a.length>d){c=c+a[d]+",";d++}var e=rfgetElementById("thePage:ReqDefForm:selectedAccounts");if(e){e.value=c}var b=Ext.getCmp("profileSelector").getValue();d=0;var f="";while(b.length>d){f=f+b[d]+",";d++}if(currentConfig=="RemedyforceConsole"){if(document.getElementById("thePage:ReqDefForm:profileOptionSelect_Con").value.toLowerCase()=="all"){document.getElementById("thePage:ReqDefForm:selectedConsoleProfiles").value="ALL"}else{document.getElementById("thePage:ReqDefForm:selectedConsoleProfiles").value=f}}else{if(document.getElementById("thePage:ReqDefForm:profileOptionSelect_SS").value.toLowerCase()=="all"){document.getElementById("thePage:ReqDefForm:selectedProfiles").value="ALL"}else{document.getElementById("thePage:ReqDefForm:selectedProfiles").value=f}}}function openCategoryPage(a){if(a!=null&&a!=""){if(a[0]!=null&&a[0]!=""){var b=a[3];var c=a[0];setCatData(b,c,"")}else{setCatData("","","")}}}function setCategoryfields(b,a){if(b&&a){setCatData(b,a,"")}}var CopyBtnHandler=function(){var a=document.getElementById("copyBtnId").getAttribute("aria-disabled");if(a!="true"){callCopyPage()}};var DeleteBtnHandler=function(){var a=document.getElementById("deleteBtnId").getAttribute("aria-disabled");if(a!="true"){showLightningPopup("modal",labelDelete,labelDeleteConfirm,labelNo,labelYes,"SRDForm","DeleteBtnHandler")}};function GetMessageBox(a){if(WinMsg==null){WinMsg=Ext.create("Ext.window.MessageBox")}WinMsg.baseCls=a;return WinMsg}var ResetBtnHandler=function(){showLoadingMask();var a=document.getElementById("resetBtnId").getAttribute("aria-disabled");if(a!="true"){resetReqDefObj();isEntitlementRefreshed=true;isEntitlementChanged=false}};var downloadBtnHandler=function(){getWatsonJson()};function downloadWatsonTemplate(){if(jsonStr){var b=JSON.parse(jsonStr);var a=new Blob([JSON.stringify(b,null,"\t")],{type:"text/json"});if(navigator.msSaveBlob){navigator.msSaveBlob(a,requestDefinitionName+".json")}else{var d=document.createElement("a");if(d.download!==undefined){var c=URL.createObjectURL(a);d.setAttribute("href",c);d.setAttribute("download",requestDefinitionName+".json");d.style.visibility="hidden";document.body.appendChild(d);d.click();document.body.removeChild(d)}}}}var selectedOption="";function resetProcessVariables(b){selectedOption=b;updateProcessVarAction(b);var a=Ext.getCmp("objectFieldId");document.getElementById("AddBtn").style.display="none";document.getElementById("inputField").style.display="none";document.getElementById("templateField").style.display="none";document.getElementById("divBorder").style.display="none";a.store.remove(a.getRawValue());a.reset();inputFieldId.reset();showLoadingMask()}function updateProcessOptions(){if(typeof(deletedProcessId)!="undefined"&&deletedProcessId!=null&&deletedProcessId!=""){if(deletedProcessId==selectedOption){resetProcessOption();if(processVarStore!=null&&typeof(processVarStore)!="undefined"){processVarStore.removeAll()}}}}function PreviousBtnHandler(){if(window.parent.changeArray[getWID()]!=null&&typeof(window.parent.changeArray[getWID()])!="undefined"&&window.parent.changeArray[getWID()]!=-1){checkLoseChanges(previousReqDefBtnHandler)}else{if(document.getElementById("prevBtnId").disabled!=true){previousReqDefBtnHandler();isEntitlementRefreshed=true;isEntitlementChanged=false}}}function NextBtnHandler(){if(window.parent.changeArray[getWID()]!=null&&typeof(window.parent.changeArray[getWID()])!="undefined"&&window.parent.changeArray[getWID()]!=-1){checkLoseChanges(nextReqDefBtnHandler)}else{if(document.getElementById("nextBtnId").disabled!=true){nextReqDefBtnHandler();isEntitlementRefreshed=true;isEntitlementChanged=false}}}function previousReqDefBtnHandler(){var b="";var a=0;while(idset.length>a){if(b==""){b=idset[a]}else{b=b+","+idset[a]}a++}previousReqDef(b);isEntitlementRefreshed=true;isEntitlementChanged=false}function nextReqDefBtnHandler(){var b="";var a=0;while(idset.length>a){if(b==""){b=idset[a]}else{b=b+","+idset[a]}a++}nextReqDef(b)}function checkIDSet(){if(idset==null||idset==""){if(getIsDirect()==""){if(typeof(window.parent.returnListOfId)=="function"){idset=window.parent.returnListOfId()}}else{if(typeof(window.parent.parent.getIdArray)=="function"){idset=window.parent.parent.getIdArray()}window.parent.handleSave(getWID(),getID())}}}function updateInputList(a){updateInputDataAction()}var inputIdOnDelete;var inputDeleteType;function delInputBtnHandler(c){var a=inputGrid.getSelectionModel().getSelection();if(a&&a.length>0){var b=inputGrid.getSelectionModel().getSelection()[0].data.id;inputDeleteType=c;inputIdOnDelete=b;showLightningPopup("modal","",labelInputDeleteConfirmMsg,labelNo,labelYes,"SRDForm","confirmationOnInputDelete")}}function buttonHandler(a,b){var c=document.getElementById("frameFulfillmentInput");if(isInputDetailDirty==true){GetMessageBox("bmc-message").confirm(labelWarningTitle,labelUnsavedFulfillmentInputWarning,function(d){if(d.toUpperCase()=="NO"){isInputDetailDirty=false;c.src=a;c.height=b+"px";c.classList.add("paddingLeftInputTab")}})}else{isInputDetailDirty=false;c.src=a;c.height=b+"px";c.classList.add("paddingLeftInputTab")}}function getInputFrameHeight(a){if(a&&(a.toLowerCase()=="picklist"||a.toLowerCase()=="radio button")){return 800}return 490}var addInputBtnHandler=function(){buttonHandler("/apex/FulfillmentInputDetailPage?requestId="+reDefId+"&isInputCreateable="+isInputCreateable,getInputFrameHeight(inputDataType))};var editInputBtnHandler=function(){var a=inputGrid.getSelectionModel().getSelection();if(a&&a.length>0){var b=a[0].data.id;inputDataType=a[0].data.Type;inputDataTypeLabel=a[0].data["Response Type"];nextPrevInputStep(2);buttonHandler("/apex/FulfillmentInputDetailPage?Id="+b+"&isInputUpdateable="+isInputUpdateable+"&isNewField=false&inputDataTypeLabel="+encodeURIComponent(inputDataTypeLabel),getInputFrameHeight(inputDataType))}};function copyInputBtnHandler(){var a=inputGrid.getSelectionModel().getSelection();if(a&&a.length>0){var b=a[0].data.id;inputDataType=a[0].data.Type;inputDataTypeLabel=a[0].data["Response Type"];nextPrevInputStep(2);buttonHandler("/apex/FulfillmentInputDetailPage?Id="+b+"&isCopy=true&isInputCreateable="+isInputCreateable+"inputDataTypeLabel="+encodeURIComponent(inputDataTypeLabel),getInputFrameHeight(inputDataType))}}function closeFulfillmentPopup(){fulfillmentWinObj.close()}function closeConditionPopup(){conditionWinObj.close()}var existingProcessBtnHandler_TS=function(a,b){var c=Ext.getCmp("newTemplateBtn");onCompleteFunction=addProcessTemplateAction;if(c.disabled==false){var d="SearchAndLink?txt=changelookupValues&parentName=SRM_RequestDefinition__c&childName=SYSTemplate__c&isLookUp=true&NewLookUpType=&filterId=temp_ta_active&searchLookUpStr=&isCustomLookup=false&isSRD=true&isPFT=true&lightningUI=true&modalType=rfModalVFPage";showLightningPopup("vfModalPage",labelProcessTemplatePopupTitle,d,500,900,"newFulfillmentTemplate","","","Task")}};var existingProcessBtnHandler_CR=function(a,b){onCompleteFunction=addProcessTemplateAction;var c=Ext.getCmp("newTemplateBtn");if(c.disabled==false){var d="SearchAndLink?txt=changelookupValues&parentName=SRM_RequestDefinition__c&childName=SYSTemplate__c&isLookUp=true&NewLookUpType=&filterId=temp_cr_active&searchLookUpStr=&isCustomLookup=false&isSRD=true&isPFT=true&lightningUI=true&modalType=rfModalVFPage";showLightningPopup("vfModalPage",labelProcessTemplatePopupTitle,d,500,900,"newFulfillmentTemplate","","","CR")}};function addProcessTemplate(a){addProcessTemplateAction(a)}var delProcesBtnHandler=function(a){processId=a;if(processId!=null&&processId!=""){showLightningPopup("modal",labelDelete,labelProcessDeleteConfirmMsg,labelNo,labelYes,"SRDForm","confirmationOnProcessDelete")}};function resetProcessOption(){selectedOption="";applyFilterOnMappingStore()}function deleteInputMapConfirm(){showLightningPopup("modal",labelDelete,labelDeleteConfirm,labelNo,labelYes,"SRDForm","DeleteMappingHandler")}function deleteInputMapHandler(b){if(b){removeInputMappingAction("","",b);showLoadingMask()}else{if(mappingGrid.getSelectionModel().selected){var a=mappingGrid.getSelectionModel().selected;removeInputMappingAction(a.items[0].data.processVarApiName,a.items[0].data.processId);mappingStore.remove(a.items[0]);mappingGrid.getView().refresh();showLoadingMask()}}}function reloadData(){}function setTaskTemplateOrder(){var a=450;var b=640;if(Ext.isSafari){a=500}var c="ChildTemplateHierarchy?reqDefId="+reDefId;showLightningPopup("vfModalPage",taskTemplateExecutionOrder,c,a,b,"executionOrder");onCompleteFunction=reloadData}function showProcessTable(){processDataStore=new Ext.data.ArrayStore({data:processDataArray,fields:["id","readOnly","name","description","templateFor"]});var a=new Ext.menu.Menu({shadow:false,autowidth:false,plain:true,showSeparator:false,baseCls:"rf-menu",items:[{text:labelTask,id:"New",disabled:false,handler:existingProcessBtnHandler_TS},{text:labelChangeRequest,id:"Exist",disabled:false,handler:existingProcessBtnHandler_CR}]});var b=false;if(/MSIE \d|Trident.*rv:/.test(navigator.userAgent)){b=true}var c={styleHtmlContent:true,styleHtmlCls:"processTemplateTbar",items:[{xtype:"label",text:labelFulfillmentProcessInfo},{xtype:"tbfill"},{tooltip:labelCreate,text:labelCreate,baseCls:b?"slds-button":"rf-slds-ext-button slds-button slds-button_neutral",iconCls:"rf-menu-arrow",iconAlign:"right",id:"newTemplateBtn",menu:a,tooltipType:"title",scale:"medium",disabled:(isProcessCreateable=="true"?false:true)},{xtype:"tbspacer",width:5},{tooltip:taskTemplateExecutionOrder,text:taskTemplateExecutionOrder,baseCls:"rf-slds-ext-button slds-button slds-button_neutral",iconCls:"rf-exec-order",iconAlign:"right",id:"exeOrderBtn",tooltipType:"title",scale:"medium",handler:setTaskTemplateOrder,disabled:false}]};processGrid=new Ext.grid.GridPanel({store:processDataStore,viewConfig:{columnLines:false,stripeRows:false,},autoScroll:true,columns:[{menuDisabled:true,header:labelProcessType,dataIndex:"templateFor",sortable:false,flex:0.8},{header:"ID",dataIndex:"id",hidden:true},{header:"readOnly",dataIndex:"readOnly",hidden:true},{menuDisabled:true,header:labelProcessNameHeader,dataIndex:"name",sortable:false,flex:2},{menuDisabled:true,header:labelProcessDescHeader,dataIndex:"description",sortable:false,flex:2},{menuDisabled:true,dataIndex:"id",sortable:false,width:50,renderer:function(f,g,d){var e="";if(isProcessDeleteable!="true"){e="disableDiv"}if(d.get("readOnly")=="true"||d.get("readOnly")==true){}else{if(isProcessDeleteable){return'<div class = "'+e+'" style="float:right;cursor: pointer;"><img id ="deleteProcessTemp" onclick="delProcesBtnHandler(\''+f+'\');" title="'+labelDelete+'" src="'+deleteIconPath+'" /></div>'}}return""}},],selModel:new Ext.selection.RowModel({mode:"SINGLE"}),renderTo:"processGrid",width:1020,height:225,tbar:c});processGrid.on("itemclick",function(g,d,h,o,n,f){if(d){if("deleteProcessTemp"!=n.target.id){resetProcessVariables(d.get("id"));updateMappingText(d.get("name"),d.get("templateFor"))}else{if(selectedOption&&processGrid&&processGrid.store){var l=processGrid.store.findRecord("id",selectedOption);if(l){var m=processGrid.store.indexOf(l);processGrid.getView().getSelectionModel().select(m);processGrid.getView().focusRow(m)}}else{if(reDefId!=null&&reDefId!=""&&processGrid.getView()!="undefined"&&processGrid.getView().getSelectionModel()!="undefined"){processGrid.getView().getSelectionModel().select(0);processGrid.getView().focusRow(0);selectedOption=processGrid.getSelectionModel().selected.items[0].data.id}}}}})}function selectDefaultFulfillmentProcess(){processGrid.getView().getSelectionModel().select(0);processGrid.getView().focusRow(0);var a=processGrid.getView().getSelectionModel().getSelection()[0];resetProcessVariables(a.get("id"));updateMappingText(a.get("name"),a.get("templateFor"))}function updateMappingText(a,b){RemedyForceHTMLProcessor.setText(document.getElementById("processTemplateName")," ("+RemedyForceHTMLProcessor.htmlDecoder(a)+")");RemedyForceHTMLProcessor.setText(document.getElementById("mappingInfo"),labelMappingInfo.replace("{OBJECTNAME}",b));mappingTooltip.update(labelMappingNote.replace("{OBJECTNAME}",b))}Ext.EventManager.onWindowResize(function(){if(processGrid!=undefined){processGrid.getView().refresh();selectDefaultFulfillmentProcess()}if(mappingGrid!=undefined){mappingGrid.getView().refresh()}});var previourMenuId;function toggleToolbarGridMenu(a){document.getElementById(a).classList.toggle("show");if(previourMenuId&&previourMenuId!=a&&document.getElementById(previourMenuId)){document.getElementById(previourMenuId).classList.remove("show")}previourMenuId=a}window.onclick=function(c){matches=c.target.matches?c.target.matches(".dropbtn"):c.target.msMatchesSelector(".dropbtn");if(!matches){var d=document.getElementsByClassName("dropdown-content");var b;for(b=0;b<d.length;b++){var a=d[b];if(a.classList.contains("show")){a.classList.remove("show")}}}};function showInputTable(){inputDataStore=new Ext.data.ArrayStore({data:inputDataArray,fields:["id","order","PromptQuestion","Response Type","Required","Hidden","Column","Type","Conditional","InvokeTemplate"]});inputGrid=new Ext.grid.GridPanel({store:inputDataStore,autoScroll:true,cls:"rf-grid",columns:[{header:"ID",dataIndex:"id",hidden:true,hideable:false},{header:"#",dataIndex:"order",sortable:false,hidden:true,hideable:false,menuDisabled:true},{header:labelInputPromptHeader,dataIndex:"PromptQuestion",sortable:false,menuDisabled:true,tdCls:"rf-draggable-row",flex:2,renderer:function(d,e,b){if(d){var c=b.get("Type");if(c!=null&&typeof(c)!="undefined"&&c=="header section"){d="<b>"+d+"</b>"}d='<a href="#" class="promptLinkClass" onclick="editInputBtnHandler();">'+d+"</a>"}return d}},{header:labelResponseTypeHeader,dataIndex:"Response Type",sortable:false,menuDisabled:true,flex:1},{header:labelRequiredHeader,dataIndex:"Required",sortable:false,menuDisabled:true,flex:0.5,renderer:function(c,d,b){if(c&&c.toLowerCase()=="*"){c='<img class="rf-check-small" src="'+getSDFStylesResPath()+'/SDEFimages/check.svg" />'}else{c=""}return c}},{header:labelHiddenHeader,dataIndex:"Hidden",sortable:false,menuDisabled:true,renderer:function(c,d,b){if(c&&c.toLowerCase()=="yes"){c='<img class="rf-check-small" src="'+getSDFStylesResPath()+'/SDEFimages/check.svg" />'}else{c=""}return c}},{header:labelColumnHeader,dataIndex:"Column",sortable:false,flex:0.5,menuDisabled:true},{header:"type",dataIndex:"Type",sortable:false,hidden:true,hideable:false},{text:labelConditionalHeader,dataIndex:"Conditional",flex:0.6,sortable:false,menuDisabled:true,renderer:function(c,d,b){if(c&&c.toLowerCase()=="yes"){c='<img class="rf-check-small" src="'+getSDFStylesResPath()+'/SDEFimages/check.svg" />'}else{c=""}return c}},{text:lableInvokeTemplateHeader,dataIndex:"InvokeTemplate",flex:0.75,sortable:false,menuDisabled:true,renderer:function(c,d,b){if(c&&c.toLowerCase()=="yes"){c='<img class="rf-check-small" src="'+getSDFStylesResPath()+'/SDEFimages/check.svg" />'}else{c=""}return c}},{menuDisabled:true,width:50,dataIndex:"id",hideable:false,sortable:false,renderer:function(e,f,b){var d=b.data.Type;var c=e;e='<div type="button" onclick="toggleToolbarGridMenu(\'myDropdown'+c+'\');return false;" class="menuBackgroundImage dropbtn slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-x-small" aria-haspopup="true" tabindex="0" title="'+labelMoreAction+'">          <svg class="slds-button__icon" aria-hidden="true">            <use xlink:href="'+URlDown+'"></use>          </svg>          <span class="slds-assistive-text">'+labelMoreAction+"</span>        </div>";if(isrequestDefUpdateble=="true"){e+='	<div id="myDropdown'+c+'" class="dropdown-content slds-dropdown__item">   	 <a href="javascript:void(0);" onclick="editInputBtnHandler();">			<span class="slds-truncate" >'+labelEdit+'</span>	 	 </a>    	 <a href="javascript:void(0);" onclick="delInputBtnHandler(\''+d+'\');">			<span class="slds-truncate" >'+labelDelete+"</span>	 	  </a>";if(d=="text area (rich)"){isRichTextboxExist=true;e+='    	 <a href="javascript:void(0);" class="disableDiv" onclick="copyInputBtnHandler();">			<span class="slds-truncate" >'+labelClone+"</span>	 	 </a>  		</div>"}else{e+='    	 <a href="javascript:void(0);" onclick="copyInputBtnHandler();">			<span class="slds-truncate" >'+labelClone+"</span>	 	 </a>  		</div>"}}else{e+='	<div id="myDropdown'+c+'" class="dropdown-content slds-dropdown__item">   	 <a href="javascript:void(0);" class="disableDiv" onclick="editInputBtnHandler();">			<span class="slds-truncate" >'+labelEdit+'</span>	 	 </a>    	 <a href="javascript:void(0);" class="disableDiv" onclick="delInputBtnHandler(\''+d+'\');">			<span class="slds-truncate" >'+labelDelete+'</span>	 	 </a>    	 <a href="javascript:void(0);" class="disableDiv" onclick="copyInputBtnHandler();">			<span class="slds-truncate" >'+labelClone+"</span>	 	 </a>  		</div>"}return e}}],selModel:new Ext.selection.RowModel({mode:"SINGLE"}),renderTo:"grid",viewConfig:{columnLines:false,stripeRows:false,forceFit:true,scrollOffset:0,plugins:{ptype:"gridviewdragdrop",dragGroup:"inputGridDDGroup",dropGroup:"inputGridDDGroup"},listeners:{beforedrop:function(b,c,d,l,g){var e=inputGrid.getSelectionModel().getSelection()[0];if(!e){return}var n=inputGrid.getStore();var f=n.indexOf(e);if(l=="before"){f--;if(f<0){return}}else{if(f>=n.getCount()){return}}isInputOrderChanged=true;var m=f;n.remove(e);n.insert(f,e);e.data.order=b+1;if(l=="before"){for(var h=(f+1);h<n.getCount();h++){n.getAt(h).data.order=(++f)+1}}else{for(var h=(f-1);h>=0;h--){n.getAt(h).data.order=(--f)+1}}inputGrid.getView().refresh();inputGrid.getSelectionModel().select(m,true);g.processDrop()}}},height:375,width:1020});if(/MSIE \d|Trident.*rv:/.test(navigator.userAgent)){setInputData()}inputGrid.on("itemdblclick",function(d,b,f,h,g,c){selectedIndex=h;if(isInputUpdateable=="true"){editInputBtnHandler()}validateUpDownButtons()});var a=function(c,e,d){var b=inputGrid.getSelectionModel().getSelection();validateUpDownButtons()};inputGrid.getSelectionModel().on("selectionchange",a)}function validateUpDownButtons(){var a=document.getElementById("upKey");var f=document.getElementById("downKey");var b=inputGrid.getSelectionModel().getSelection();if(b){var c=inputGrid.getStore();var d=c.indexOf(b[0]);var e=c.getCount();if(d>0&&d<(e-1)){a.classList.remove("disableDiv");a.classList.add("enableDiv");f.classList.remove("disableDiv");f.classList.add("enableDiv")}else{if(d==0){a.classList.remove("enableDiv");a.classList.add("disableDiv");if(d==e-1){f.classList.remove("enableDiv");f.classList.add("disableDiv")}else{f.classList.remove("disableDiv");f.classList.add("enableDiv")}}else{if(d==e-1){f.classList.remove("enableDiv");f.classList.add("disableDiv");a.classList.remove("disableDiv");a.classList.add("enableDiv")}}}}else{f.classList.remove("enableDiv");f.classList.add("disableDiv");a.classList.remove("enableDiv");a.classList.add("disableDiv")}}function setProcessDataStore(c){try{if(processDataStore!=null&&typeof(processDataStore)!="undefined"){processDataStore.removeAll();processDataStore.loadData(c)}if(selectedOption&&processGrid&&processGrid.store){var b=processGrid.store.findRecord("id",selectedOption);if(b){var d=processGrid.store.indexOf(b);processGrid.getView().getSelectionModel().select(d);processGrid.getView().focusRow(d)}}else{if(reDefId!=null&&reDefId!=""&&processGrid.getView()!="undefined"&&processGrid.getView().getSelectionModel()!="undefined"){processGrid.getView().getSelectionModel().select(0);processGrid.getView().focusRow(0);selectedOption=processGrid.getSelectionModel().selected.items[0].data.id}}enableDisableExeOrderBTN()}catch(a){}}function setInputDataStore(b){try{if(inputDataStore!=null&&typeof(inputDataStore)!="undefined"){inputDataStore.removeAll();inputDataStore.loadData(b);inputGrid.getView().refresh();hideLoadingMask()}}catch(a){}}var adjustDatePicker=function(a){$("#datePicker").appendTo($(a).parent())};function moveSelectedRow(e){var b=inputGrid.getSelectionModel().getSelection();if(!b||b.length<=0){return}var c=inputGrid.getStore();var d=c.indexOf(b[0]);if(e=="up"){d--;if(d<0){return}}else{d++;if(d>=c.getCount()){return}}isInputOrderChanged=true;var a=d;c.remove(b);c.insert(d,b);b[0].data.order=d+1;if(e=="btnUpId"){for(var f=(d+1);f<c.getCount();f++){c.getAt(f).data.order=(++d)+1}}else{for(var f=(d-1);f>=0;f--){c.getAt(f).data.order=(--d)+1}}inputGrid.getView().refresh();inputGrid.getSelectionModel().select(a,true)}function showQuestionTable(){questionStore=new Ext.data.ArrayStore({data:questionData,fields:["id","prompt","respType","respRefType","additionalInfo"]})}function showProcessVarTable(){processVarStore=new Ext.data.ArrayStore({data:processVarData,fields:["id","required","localname","dataType","refTo"]})}function setProcessOptionStore(b){if(processOptions!=null&&typeof(processOptions)!="undefined"){var a=processOptions.getStore();a.removeAll();a.loadData(b)}}function setQuestionDataStore(b){try{if(questionStore!=null&&typeof(questionStore)!="undefined"){questionStore.removeAll();questionStore.loadData(b)}if(typeof(inputFieldStore)!="undefined"&&inputFieldStore){inputFieldStore.removeAll();inputFieldStore.loadData(b)}}catch(a){}}function addNewFulfillmentMapping(){document.getElementById("AddBtn").style.display="block";document.getElementById("inputField").style.display="block";document.getElementById("templateField").style.display="block";document.getElementById("divBorder").style.display="block";document.getElementById("addMappingBtn").style.display="none";document.getElementById("cancelButton").style.display="block";var b=[];if(mappingStore&&mappingStore.data&&mappingStore.data.items){var a=Ext.getCmp("objectFieldId");for(i=0;i<mappingStore.data.items.length;i++){var c=mappingStore.data.items[i].data.processVarApiName;b[i]=mappingStore.data.items[i].data.processVarApiName}a.store.filterBy(function(d){if(b.indexOf(d.data.id)!=-1){return false}else{return true}});a.focus()}}function showMappingTable(){var a=new Ext.data.ArrayStore({fields:["id","required","localname","dataType","refTo"],data:processVarData});objectFieldId=new Ext.form.field.ComboBox({id:"objectFieldId",cls:"rf-combo",store:a,queryMode:"local",triggerAction:"all",renderTo:"templateField",valueField:"id",width:404,displayField:"localname",editable:false,listConfig:{getInnerTpl:function(c){var b;b='<tpl><tpl if="required == \'true\'">		 <span class="slds-form-element__label slds-form-element__legend"> {localname} ('+labelRequired+') </span></tpl><tpl if="required != \'true\'">     <span class="slds-form-element__label" title="{localname}"> {localname}</span></tpl></tpl>';return b}},listeners:{select:function(g,e,c){var f=e[0];var l=f.get("dataType").toLowerCase();var h=f.get("refTo").toLowerCase();var d=false;var b=false;if(inputFieldStore){inputFieldStore.clearFilter();inputFieldStore.filterBy(function(p){var m=p.data.respType;var o=p.data.respRefType;var n;if(l=="textarea"){b=true;d=true;n=true}else{if(l=="string"&&m!="Text Area (Rich)"&&m!="Text Area"){n=true;d=true;b=true}else{if((l=="datetime"||l=="date")&&(m=="Date"||m=="Date/Time")){n=true;b=true}else{if(l=="reference"&&m=="Lookup"&&o&&h.indexOf(o.toLowerCase())!=-1){n=true;b=true}else{if((l=="picklist"||l=="multipicklist")&&(m=="Picklist"||m=="Radio Button")){n=true;b=true}else{if(l=="boolean"&&m=="Check box"){n=true;b=true}else{if((l=="double"||l=="currency")&&m=="Number"){n=true;b=true}else{n=false}}}}}}}return n})}if(b&&inputFieldId){inputFieldId.setDisabled(false);delete inputFieldId.picker;inputFieldId.multiSelect=d;inputFieldId.reset()}else{if(inputFieldId){inputFieldId.setDisabled(true)}}}},emptyText:SelectField});inputFieldStore=new Ext.data.ArrayStore({data:questionData,fields:["id","prompt","respType","respRefType","additionalInfo"]});inputFieldId=new Ext.form.field.ComboBox({id:"inputFieldId",cls:"rf-combo",store:inputFieldStore,queryMode:"local",width:"99%",renderTo:"inputField",valueField:"id",displayField:"prompt",triggerAction:"all",editable:false,multiSelect:true,emptyText:labelRequestInputCaption,listConfig:{maxHeight:400,getInnerTpl:function(d){var b;var c=Ext.getCmp("inputFieldId").getValue();b='<tpl> <div class="slds-form-element" onclick = "toggleComboBoxCheckbox(\'{id}\')">  <div class="slds-form-element__control">    <div class="slds-checkbox"><tpl if="prompt == \''+c+'\'">      <input type="checkbox" name="{id}" id="{id}" value="{prompt:htmlEncode}" checked="{[ prompt == \''+c+"'?'true':'false' ]}\"/></tpl><tpl if=\"prompt != '"+c+'\'">      <input type="checkbox" name="ChkBoxGrp" id="{id}" value="{prompt:htmlEncode}"/></tpl>      <div class="slds-checkbox__label slds-truncate" for="{id}">        <span id="span{id}" class="slds-checkbox_faux"></span>		 <span class="slds-form-element__label" title="{prompt:htmlEncode}"> {prompt:htmlEncode} </span>      </div>    </div>  </div></div></tpl>';return b},listeners:{select:function(e,d){selectedValues=d.data.id;var b=document.querySelectorAll("#"+selectedValues);if(b&&b!=[]){for(i=0;i<b.length;i++){b[i].checked=true}}var c=rfgetElementById("AddBtn");if(c){c.classList.remove("disableDiv");c.classList.add("slds-button_icon-brand");c.classList.remove("slds-button_neutral")}},boxready:function(e,d,b,c){showHideCheckBoxInInputGrid(e)},beforeshow:function(c,b){showHideCheckBoxInInputGrid(c)}}}});mappingStore=new Ext.data.ArrayStore({data:mappingData,fields:["mappingId","processId","processVarApiName","processVarLabel","mappings","inputFieldLabel","objectFieldDataType",{name:"isMultiEdit",type:"boolean",defaultValue:false}]});mappingGrid=new Ext.grid.GridPanel({store:mappingStore,hideHeaders:true,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,listeners:{beforeedit:function(h,l,m){var p=mappingGrid.getSelectionModel().selected;var o=true;var c=p.items[0].data.objectFieldDataType.toLowerCase();var d=null;if(p.items[0].raw.objectFieldRefTo!=null){d=p.items[0].raw.objectFieldRefTo.toLowerCase()}if(inputFieldStore){inputFieldStore.clearFilter();inputFieldStore.filterBy(function(s){var e=s.data.respType;var r=s.data.respRefType;var q;if(c=="textarea"){isinputFieldPresent=true;isMultiSelect=true;q=true}else{if(c=="string"&&e!="Text Area (Rich)"&&e!="Text Area"){q=true;isMultiSelect=true;isinputFieldPresent=true}else{if((c=="datetime"||c=="date")&&(e=="Date"||e=="Date/Time")){q=true;isinputFieldPresent=true}else{if(c=="reference"&&e=="Lookup"&&r&&d.indexOf(r.toLowerCase())!=-1){q=true;isinputFieldPresent=true}else{if(c=="picklist"&&(e=="Picklist"||e=="Radio Button")){q=true;isinputFieldPresent=true}else{if(c=="boolean"&&e=="Check box"){q=true;isinputFieldPresent=true}else{if((c=="double"||c=="currency")&&e=="Number"){q=true;isinputFieldPresent=true}else{q=false}}}}}}}return q})}var b=p.items[0].data.mappings;if(p.items[0].data.isMultiEdit){o=false}else{var n=l.field;var f=l.grid.columns[l.colIdx].getEditor(l.record);var g=l.record.get("inputFieldLabel");f.setValue(g)}return o},edit:function(c,d,b){}}}),],autoScroll:true,columns:[{header:"",dataIndex:"mappingId",hidden:true},{header:"",dataIndex:"processId",hidden:true},{header:"",dataIndex:"processVarApiName",hidden:true},{header:labelProcessVariableCaption,menuDisabled:true,dataIndex:"processVarLabel",sortable:false,width:404,},{header:labelMappedInputs,menuDisabled:true,sortable:false,dataIndex:"inputFieldLabel",flex:1.5,tdCls:"rf-multi-map-link",editor:{xtype:"combobox",store:inputFieldStore,displayField:"prompt",valueField:"prompt",editable:false,cls:"rf-combo",queryMode:"local",listeners:{select:function(g,e,c){var f=mappingGrid.getSelectionModel().selected;var l=f.items[0].data.mappings;var d=mappingStore.findRecord("inputFieldLabel",g.getValue());var h=mappingStore.indexOf(d);if(f&&!f.items[0].data.isMultiEdit){var e=g.findRecord(g.valueField,g.getValue());if(e){l[0].inputLabel=e.data.prompt;l[0].inputId=e.data.id;f.items[0].data.mappings[0]=l[0];var b=mappingGrid.store.data.items;b[h]=f.items[0];isformDirty=true;handleChange()}}}}},renderer:function(l,c,f,g,n,m,h){var e=f.data.mappings;var d="";if(e){if(f.data.isMultiEdit){d='<span class="slds-truncate multi-mapping-container" id="multimap-'+f.data.mappingId+'">';var b=0;Ext.each(f.data.mappings,function(p,o){if(b>0){d+=", "}d+=Ext.String.htmlEncode(p.inputLabel);b++});d+='</span><a href="#" class="multiMapping" title="'+labelMapMoreInputs+'" onclick="editMappingHandler(\''+f.data.mappingId+"','mappingId');\">(<span class=\"multiMapping-symbol\">+</span>)<a>"}else{d=Ext.String.htmlEncode(f.data.inputFieldLabel)}}return d}},{menuDisabled:true,dataIndex:"mappingId",hideable:false,sortable:false,align:"right",width:50,renderer:function(c,d,b){var e;if(isMappingDeleteable!="true"){e="rf-disabled disableDiv"}content='<div type="button" onclick="toggleToolbarGridMenu(\'mapDropdown'+c+'\');return false;" class="menuBackgroundImage dropbtn slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-x-small" aria-haspopup="true" tabindex="0" title="'+labelMoreAction+'">          <svg class="slds-button__icon" aria-hidden="true">            <use xlink:href="'+URlDown+'"></use>          </svg>          <span class="slds-assistive-text">'+labelMoreAction+'</span>        </div>	 	<div id="mapDropdown'+c+'" class="dropdown-content slds-dropdown__item mapping-dropdown">   	 <a href="javascript:void(0);" onclick="editMappingHandler(\''+c+"','mappingId');\">			<span class=\"slds-truncate\" >"+labelEdit+'</span>	 	 </a>		<a class="'+e+'" href="javascript:void(0);" onclick="deleteInputMapConfirm();">			<span class="slds-truncate" >'+labelDelete+"</span>	 	 </a>  		</div>";return content}}],selModel:new Ext.selection.RowModel({mode:"SINGLE"}),renderTo:"mappingGrid",minHeight:Ext.isIE?240:250,width:1022});mappingGrid.on("viewready",function(d){var b=d.view;d.mon(b,{uievent:function(m,g,f,h,l,n){d.cellIndex=l;d.recordIndex=h}});d.tip=Ext.create("Ext.tip.ToolTip",{target:b.el,delegate:".multi-mapping-container",trackMouse:false,renderTo:Ext.getBody(),autoHide:false,floating:false,hidden:true,baseCls:"slds-popover slds-nubbin_bottom-left slds-popover_large",bodyCls:"slds-popover__body slds-p-around_none slds-popover_large",listeners:{beforeshow:function c(f){gridColumns=d.view.getGridColumns();if(f.triggerElement&&f.triggerElement.id!=""&&f.triggerElement.id.indexOf("multimap-")>-1){record=mappingStore.findRecord("mappingId",f.triggerElement.id.split("multimap-")[1]);var e=0;if(record&&record.data.mappings.length>1){tipText='<header class="slds-popover__header slds-p-around_small"><h2 class="slds-text-heading_small">'+record.data.mappings.length+"  "+Ext.String.htmlEncode(labelMappedInputs)+'</h2></header><div class="slds-popover__body slds-p-around_small"><div class="slds-text-longform rf-popover rf-scroll"><ul class="slds-m-left_none slds-p-left_medium">';Ext.each(record.data.mappings,function(h,g){tipText+='<li class="rf-listyle">'+Ext.String.htmlEncode(h.inputLabel)+"</li>";e++});tipText+="</ul></div></div>";f.update(tipText)}else{return false}}else{return false}}}});d.tip.hide()});mappingGrid.on("destroy",function(b){delete b.tip})}function toggleComboBoxCheckbox(b){var a=document.querySelectorAll("#"+b);if(a&&a!=[]){for(i=0;i<a.length;i++){if(a[i].checked){a[i].checked=false}else{a[i].checked=true}}}}function showHideCheckBoxInInputGrid(d){var a=d.store.data.items;if(a){for(i=0;i<a.length;i++){var c=a[i].data.id;var b=document.querySelectorAll("#span"+c);if(b&&b.length!=0){for(j=0;j<b.length;j++){if(inputFieldId.multiSelect!=true){b[j].style.display="none"}else{b[j].style.display="inline-block"}}}else{break}}}}function setProcessVarDataStore(b){if(processVarStore!=null&&typeof(processVarStore)!="undefined"){processVarStore.removeAll();processVarStore.loadData(b);if(objectFieldId!=null&&typeof(objectFieldId)!="undefined"){var a=objectFieldId.getStore();a.removeAll();a.loadData(b);document.getElementById("addMappingBtn").style.display="block";document.getElementById("cancelButton").style.display="none"}}}function cancelFulfillmentMapping(){hideAddInputRow();objectFieldId.reset();inputFieldId.reset()}function hideAddInputRow(){var a=document.getElementById("AddBtn");a.style.display="none";document.getElementById("inputField").style.display="none";document.getElementById("templateField").style.display="none";document.getElementById("divBorder").style.display="none";a.classList.add("disableDiv");a.classList.add("slds-button_neutral");a.classList.remove("slds-button_icon-brand");document.getElementById("addMappingBtn").style.display="block";document.getElementById("cancelButton").style.display="none"}function addFulfillmentMapping(){var c=Ext.getCmp("objectFieldId");var e=Ext.getCmp("inputFieldId");if(c.getValue()==null){msgbox(labelSelectProcessVarError,"",2);return false}var b=e.getValue();if(b&&b.length==0){msgbox(labelSelectInputError,"",2);return false}var a="";if(!(typeof(b)=="string")){for(var d=0;d<b.length;d++){a=a+(a.length>0?",":"")+b[d]}}else{a=b}addMappingAction(selectedOption,a,c.getValue(),"");hideAddInputRow();isformDirty=true;handleChange();c.store.remove(c.getRawValue());document.getElementById("inputField").firstChild.style.border="none";c.reset();e.reset();showLoadingMask()}function setInputMappingDataStore(d){if(mappingStore!=null&&typeof(mappingStore)!="undefined"){try{var l=[];mappingStore.clearFilter();for(c=0;c<d.length;c++){var f=mappingStore.findRecord("mappingId",d[c].mappingId);if(f!=null&&d[c].processId==f.data.processId){if(f.data.isMultiEdit){if(f.data.inputFieldLabel==d[c].inputFieldLabel){for(k=0;k<d[c].mappings.length;k++){var b=d[c].mappings[k];for(j=0;j<f.data.mappings.length;j++){if(b.inputId==f.data.mappings[j].inputId&&b.mappingId!=f.data.mappings[j].mappingId){f.data.mappings[j].mappingId=b.mappingId}}}d[c]=f.data}}else{if(f.data.inputFieldLabel!=d[c].inputFieldLabel){if(d[c].mappings[0].inputId==f.data.mappings[0].inputId&&d[c].mappings[0].mappingId!=f.data.mappings[0].mappingId){f.data.mappings[0].mappingId=d[c].mappings[0].mappingId}d[c]=f.data}}l.push(d[c].mappingId)}}if(mappingStore.data&&mappingStore.data.items){for(c=0;c<mappingStore.data.items.length;c++){var g=mappingStore.data.items[c];var a=g.data.mappingId;if(a!=null&&a!=""&&l.indexOf(a)==-1){if(g.data.mappings.length>0){d.push(g.data)}}}}}catch(h){}mappingStore.removeAll();mappingStore.loadData(d);applyFilterOnMappingStore()}if(d!=""){var e="";for(var c=0;c<d.length;c++){if(d[c]){if(d[c].processVarLabel&&d[c].processVarLabel.indexOf("Error: ")!=-1){e+='<li style="list-style:disc;">'+d[c].processVarLabel.split("Error: ")[1]+"</li>"}}}if(e!=""){e=labelMsgDeleteMapping+'<br/><ul class="slds-m-left_medium">'+e+"</ul>";showLightningPopup("prompt",labelError,e,"OK","","","","error",e)}}}function applyFilterOnMappingStore(){if(mappingStore!=null&&typeof(mappingStore)!="undefined"){mappingStore.filterBy(function(a,b){if(a.get("processId")==selectedOption){return true}else{return false}});if(mappingStore&&mappingStore.data&&mappingStore.data.items&&mappingStore.data.items.length>0){mappingGrid.getView().getSelectionModel().select(0);mappingGrid.getView().focusRow(0)}}}function senddata(){return data}var displayMessageBox=false;function msgbox(d,c,b){var a=Ext.MessageBox.INFO;if(c==null){c=""}if(b==3){a=Ext.MessageBox.QUESTION;if(c==""){c=labelQuestion}}else{if(b==2){a=Ext.MessageBox.WARNING;if(c==""){c=labelWarning}}else{if(b==1){a=Ext.MessageBox.ERROR;if(c==""){c=labelError}}}}if(c==""){c=labelInfo}showLightningPopup("prompt","Error",d,"OK","","","","error")}function loadLeftData(){isFisrtLoad=false;setPaginatorButton();tempAccLeftStore=new Ext.data.ArrayStore({data:accSearchData,fields:["value","text","display"],sorters:[{property:"display",direction:"ASC"}]});accLeftStore.removeAll();var a=tempAccLeftStore.getTotalCount();if(a==0){if(displayMessageBox==true){msgbox(labelNoRecord,"",2);resetSearch()}}else{for(var b=0;b<tempAccLeftStore.getTotalCount();b++){accLeftStore.add(tempAccLeftStore.getAt(b))}}Ext.getCmp("accountSelector").bindStore(accLeftStore);Ext.getCmp("accountSelector").setValue(accRightStoreData);displayMessageBox=false}function blurfun(){checkforsearch=false;if(document.getElementById("txtSrch").value.trim().length==0){checkforsearch=true}}function txtSearch(){var e;var f=document.getElementById("txtSrch").value;e=parseInt(f.length-1);if(f[e]=="*"){f=f.replace("*","");document.getElementById("txtSrch").value=f}blurfun();if(checkforsearch){if(f==labelSrch){msgbox(labelMinChar,"",2);return}checkforsearch=false}else{if(f==labelSrch){return}if(f.trim().length<2){msgbox(labelMinChar,"",2);return}}showLoadingMask();var c="";var g=0;var b=Ext.getCmp("accountSelector").getValue();while(b.length>g){c=c+b[g]+",";g++}displayMessageBox=true;var a=f;var d=a.length;getSearchAccounts(a,c);accRightStoreData=c;document.getElementById("lookupIcon").style.display="none";document.getElementById("crossIcon").style.display="inline"}function resetSearch(){var c="";var b="";var d=0;var a=Ext.getCmp("accountSelector").getValue();while(a.length>d){b=b+a[d]+",";d++}showLoadingMask();getSearchAccounts(c,b);accRightStoreData=b;document.getElementById("txtSrch").value="";document.getElementById("crossIcon").style.display="none";document.getElementById("lookupIcon").style.display="inline"}function PrevBtnHandler(){if(document.getElementById("accBtnPrevId").disabled!=true){showLoadingMask();var b="";var c=0;var a=Ext.getCmp("accountSelector").getValue();while(a.length>c){b=b+"'"+a[c]+"',";c++}prevAccounts(b);accRightStoreData=b}}function nextAccountBtn(){if(document.getElementById("accBtnNextId").disabled!=true){showLoadingMask();var b="";var c=0;var a=Ext.getCmp("accountSelector").getValue();while(a.length>c){b=b+"'"+a[c]+"',";c++}nextAccounts(b);accRightStoreData=b}}function refreshAccountsList(){var d;var e=document.getElementById("txtSrch").value;d=parseInt(e.length-1);if(e[d]=="*"){e=e.replace("*","");document.getElementById("txtSrch").value=e}if(2>e.length||e==labelSrch){return}var c="";var f=0;var b=Ext.getCmp("accountSelector").getValue();while(b.length>f){c=c+b[f]+",";f++}var a=e;getSearchAccounts(a,c);accRightStoreData=c}Ext.onReady(function(){changeSRDTitle();updateDateIcon();setTypeAheadForLookups();setTypeboxLabels();Ext.QuickTips.init();windowloaddate=new Date();networklatencystart=windowloaddate.getTime();var d=networklatencystart-etime;data+=RequestDefPage.Labels.PM_netwokLatency;data+=d;data+="<br>";daysSpinner=new Ext.form.field.Spinner({id:"daysSpinner",value:targetInDays,minValue:0,maxValue:99,width:70,maxLength:2,allowDecimals:false,autoCreate:{tag:"input",type:"text",autocomplete:"off",maxlength:"2"},renderTo:"days-ct",enableKeyEvents:true,listeners:{keydown:function(o,n){if(n.getKey()==109){n.stopEvent()}},keyup:function(o,n){validateSpinnerField(o,n)},spinup:function(){var n=this;var o=parseInt(n.getValue());if(o<99){n.setValue(o+1)}},spindown:function(){var n=this;val=parseInt(n.getValue());if(val>0){n.setValue((val-1))}}}});hoursSpinner=new Ext.form.field.Spinner({id:"hoursSpinner",value:targetInHours,minValue:0,maxValue:23,width:70,maxLength:2,allowDecimals:false,autoCreate:{tag:"input",type:"text",autocomplete:"off",maxlength:"2"},renderTo:"hours-ct",enableKeyEvents:true,listeners:{keydown:function(o,n){if(n.getKey()==109){n.stopEvent()}},keyup:function(o,n){validateSpinnerField(o,n)},spinup:function(){var n=this;var o=parseInt(n.getValue());if(o<23){n.setValue(o+1)}},spindown:function(){var n=this;val=parseInt(n.getValue());if(val>0){n.setValue((val-1))}}}});createLightningTooltip("ImageInfo",labelImageHelpText,300);createLightningTooltip("ApprvalRequiredInfo",labelApprovalHelpText,300);createLightningTooltip("OnlineInfo",labelOnlineHelpText,300);mappingTooltip=createLightningTooltip("mappingNote",labelMappingNote,300);prefixPromptTooltip=createLightningTooltip("prefixNote",labelPrefixPromptNote,300);createLightningTooltip("cmdbNote",labelCMDBNote,800);createLightningTooltip("AccountInfo",accountHeaderInfo,600);createLightningTooltip("mappingFieldNote",labelMappingInstructions,300);accLeftStore=new Ext.data.ArrayStore({data:accLeftStoreData,fields:["value","text","display"],sorters:[{property:"display",direction:"ASC"}]});accRightStore=accRightStoreData;leftStore=new Ext.data.ArrayStore({data:profileLeftStoreData,fields:["value","text"],sorters:[{property:"text",direction:"ASC"}]});if(profileRightStoreData&&profileRightStoreData.length>0){rightStore=profileRightStoreData}else{rightStore=permissionsetRightStoreData}storeCurrentContents=PROFILE_PREFIX;currentTooltipAvailable=AvailableProfile;currentTooltipSelected=SelectedProfile;var m=getSDFStylesResPath()+"/SDEFbuttons/";document.getElementById("ReqDef_EntitlementTab").style.display="block";Ext.require(["Ext.form.Panel","Ext.ux.form.MultiSelect","Ext.ux.form.ItemSelector"]);var l=new Ext.ux.form.ItemSelector({anchor:"100%",id:"accountSelector",height:176,width:577,store:accLeftStore,value:accRightStoreData,displayField:"display",valueField:"value",renderTo:"accountSelectorDiv",allowBlank:true,msgTarget:"side"});callToggleAccountSelector();var b=new Ext.ux.form.ItemSelector({anchor:"100%",id:"profileSelector",height:126,width:577,store:leftStore,value:rightStore,displayField:"text",valueField:"value",renderTo:"profileSelectorDiv",allowBlank:true,msgTarget:"side"});callEntitlementSelector();document.getElementById("ReqDef_EntitlementTab").style.display="none";setPaginatorButton();showInputTable();showProcessTable();showQuestionTable();showProcessVarTable();questionStore.loadData(questionData);setProcessVarDataStore(processVarData);processVarStore.loadData(processVarData);showMappingTable();checkIDSet();handleElemEvent();setProcessData();setInputData();setInputMappingData();showFulfillmentInputStepHeader(0);if(reDefId!=null&&reDefId!=""&&newTitle!=null&&newTitle!=""){window.parent.changeTitle(getWID(),newTitle,newTitle)}if(!JSON.parse(isChatbotConfigured)||isRequestDefCreatable=="false"||isrequestDefUpdateble=="false"){document.getElementById("downloadJsonBtn").style.display="none"}if(isInActive){document.getElementById("activateBtn").children[0].innerText=labelActivate}else{document.getElementById("activateBtn").children[0].innerText=labelDeactivate}if(reDefId==null||reDefId==""){if(isRequestDefCreatable=="false"){document.getElementById("newBtnId").setAttribute("disabled",true);document.getElementById("saveBtnId").setAttribute("disabled",true)}else{updateProgressBar(currentStep,labelGeneralInfoTabTitle)}document.getElementById("deleteBtnId").setAttribute("aria-disabled",true);document.getElementById("copyBtnId").setAttribute("aria-disabled",true);document.getElementById("resetBtnId").setAttribute("aria-disabled",true);document.getElementById("prevBtnId").disabled=true;document.getElementById("nextBtnId").disabled=true;var a=rfgetElementById("previousStep");if(a){a.setAttribute("disabled",true)}}else{if(isRequestDefCreatable=="false"){document.getElementById("newBtnId").setAttribute("disabled",true);document.getElementById("copyBtnId").setAttribute("aria-disabled",true)}if(isrequestDefUpdateble=="false"){document.getElementById("newBtnId").setAttribute("disabled",true);document.getElementById("saveBtnId").setAttribute("disabled",true);document.getElementById("copyBtnId").setAttribute("aria-disabled",true);document.getElementById("resetBtnId").setAttribute("aria-disabled",true);document.getElementById("activateBtn").setAttribute("aria-disabled",true);document.getElementById("addInputBtn").disabled=true}else{updateProgressBar(currentStep,labelGeneralInfoTabTitle)}if(isRequestDefDeletable=="false"){document.getElementById("deleteBtnId").setAttribute("aria-disabled",true)}}pageloadstartdate=0;pageloadstartdate=new Date();var f=pageloadstartdate.getTime();var e=windowloaddate.getTime();var h=(f-renderingstartitme);data+=RequestDefPage.Labels.PM_PageLoad;data+=h;buttonHandler("/apex/FulfillmentInputDetailPage?requestId="+reDefId+"&isInputCreateable="+isInputCreateable,getInputFrameHeight(inputDataType));setInactiveAndAttachmentChkBox();var g=Ext.DomQuery.select('tr[id="TabButtons"] input[type="button"]');if(g!=null){for(var c=0;c<g.length;c++){if(g[c].detachEvent){g[c].detachEvent("onfocus",handleChange)}else{if(g[c].removeEventListener){g[c].removeEventListener("click",handleChange)}}}}hideLoadingMask();window.addEventListener("click",function(o){var n=document.getElementById("toolbarMenu");if(!n.contains(o.target)){toggleToolbarMenu("hide",n)}})});function createLightningTooltip(c,a,b){return new Ext.ToolTip({target:c,floating:false,baseCls:"slds-popover slds-popover_tooltip slds-nubbin_bottom-left",bodyCls:"slds-popover__body",defaultAlign:"br-tl",html:a,dismissDelay:0,maxWidth:b})}function datePickerPosition(d){var f=document.getElementById("datePicker");var e=d.clientY+10;var a="#datePicker{ top:"+e+"px !important; }";var g=document.getElementById("styles_js");if(g!=null){g.nodeValue=""}var c=document.createElement("style");c.setAttribute("type","text/css");c.setAttribute("id","styles_js");if(Ext.isIE){if(g!=null){g.styleSheet.cssText="";g.styleSheet.cssText=a}else{document.getElementsByTagName("head")[0].appendChild(c);c.styleSheet.cssText=a}}else{document.getElementsByTagName("head")[0].appendChild(c);var b=document.createTextNode(a);c.appendChild(b)}}function displayActiveTab(e,c){var a=new Array(5);a[0]={btnId:"ReqDef_GeneralInfo",textAreaCompId:"ReqDef_GeneralInfoTab",textLabel:labelGeneralInfoTabTitle};a[1]={btnId:"ReqDef_Input",textAreaCompId:"ReqDef_InputTab",textLabel:labelInputTabTitle};a[2]={btnId:"ReqDef_Fulfillment",textAreaCompId:"ReqDef_FulfillmentTab",textLabel:labelFulfillmentTabTitle};a[3]={btnId:"ReqDef_Options",textAreaCompId:"ReqDef_OptionsTab",textLabel:LabelOptions};a[4]={btnId:"ReqDef_Entitlement",textAreaCompId:"ReqDef_EntitlementTab",textLabel:labelEntitlementTabTitle};var d;if(e!=undefined&&e!=null){d=e.id}else{d=a[currentStep+c].btnId}if(reDefId==""&&e!=undefined&&e!=null&&(d=="ReqDef_Input"||d=="ReqDef_Fulfillment")){return false}else{for(var b=0;b<a.length;b++){if(d==a[b].btnId){document.getElementById(a[b].btnId).className="slds-tabs_default__link anchorCls slds-is-active";document.getElementById(a[b].btnId).parentElement.className="slds-tabs_default__item slds-is-active";document.getElementById(a[b].btnId).style.fontWeight="bold";document.getElementById(a[b].textAreaCompId).style.display="block";if(d=="ReqDef_Fulfillment"){if(processGrid!=undefined){processGrid.getView().refresh();processGrid.updateLayout();selectDefaultFulfillmentProcess()}if(mappingGrid!=undefined){mappingGrid.getView().refresh()}}else{if(d=="ReqDef_Input"&&inputGrid){inputGrid.getView().refresh();inputGrid.updateLayout()}}updateProgressBar(b,a[b].textLabel);if(d!="ReqDef_Input"){enableMainFormButtonOnInput()}else{if(currentFulfillmentStep&&currentFulfillmentStep!=0){disableMainFormButtonOnInput()}}}else{if(typeof(document.getElementById(a[b].btnId)!="undefined")&&document.getElementById(a[b].btnId)!=null){document.getElementById(a[b].btnId).className="slds-tabs_default__link anchorCls";document.getElementById(a[b].btnId).parentElement.className="slds-tabs_default__item"}if(typeof(document.getElementById(a[b].textAreaCompId)!="undefined")&&document.getElementById(a[b].textAreaCompId)!=null){document.getElementById(a[b].textAreaCompId).style.display="none"}document.getElementById(a[b].btnId).style.fontWeight="normal";document.getElementById(a[b].textAreaCompId).style.display="none"}}}}function goToSRDStep(a){displayActiveTab(null,a)}function enableDisableExeOrderBTN(){var a=Ext.getCmp("exeOrderBtn");if(disableReorderBTN=="true"||disableReorderBTN==true){if(typeof(a)!="undefined"){a.disable()}}else{if(typeof(a)!="undefined"){a.enable()}}}function toggleAccountSelector(a){if(Ext.getCmp("accountSelector")!=null){if(a.toLowerCase()=="true"){Ext.getCmp("accountSelector").disable();Ext.getCmp("accountSelector").getEl().mask();if(document.getElementById("accountDiv")){document.getElementById("accountDiv").className="accountDivCSS"}if(document.getElementById("txtSrch")){document.getElementById("txtSrch").style.background="#ccc"}}else{Ext.getCmp("accountSelector").getEl().unmask();Ext.getCmp("accountSelector").enable();if(document.getElementById("accountDiv")){document.getElementById("accountDiv").classList.remove("accountDivCSS")}if(document.getElementById("txtSrch")){document.getElementById("txtSrch").style.background="white"}}}}var PreviousConfig="";var secondRun=false;var entitlementSelectedArea;function switchEntitlementConfiguration(b){var a=validateBeforeSwitch(currentConfig);if(a){renderEntitlementData(b);isEntitlementChanged=false}else{entitlementSelectedArea=b;document.getElementById("thePage:ReqDefForm:entitlementConfigOption").value=currentConfig;showLightningPopup("modal","",closeWindowLabelMsg,labelNo,labelYes,"SRDForm","renderEntitlementData")}return true}function setDirty(a){isformDirty=a;isInputDetailDirty=a;handleChange()}function performActionForSRD(b){if(b=="renderEntitlementData"){document.getElementById("thePage:ReqDefForm:entitlementConfigOption").value=entitlementSelectedArea;renderEntitlementData(entitlementSelectedArea);isEntitlementChanged=false}else{if(b=="confirmationOnInputDelete"){showLoadingMask();removeRequestInputAction(inputIdOnDelete);if(inputDeleteType=="text area (rich)"){isRichTextboxExist=false}}else{if(typeof b=="function"&&b==previousReqDefBtnHandler&&document.getElementById("prevBtnId").disabled!=true){previousReqDefBtnHandler();handleResetChange();isEntitlementRefreshed=true;isEntitlementChanged=false}else{if(typeof b=="function"&&b==nextReqDefBtnHandler&&document.getElementById("nextBtnId").disabled!=true){nextReqDefBtnHandler();handleResetChange();isEntitlementRefreshed=true;isEntitlementChanged=false}else{if(b=="fulfillmentInputCancelHandler"){setDirty(false);clearInputPage();nextPrevInputStep(-2)}else{if(b=="fulfillmentInputBackHandler&isNewField=true"){setDirty(false);nextPrevInputStep(-1)}else{if(b=="fulfillmentInputBackHandler&isNewField=false"){setDirty(false);nextPrevInputStep(-2)}else{if(b=="cloneFulfillmentInput"){document.getElementById("frameFulfillmentInput").contentWindow.copyData();isformDirty=false}else{if(b=="confirmationOnProcessDelete"){removeProcessAction(processId);if(processId==selectedOption){selectedOption="";if(processVarStore!=null&&typeof(processVarStore)!="undefined"){processVarStore.removeAll()}}showLoadingMask()}else{if(b=="inputCancelConfirmation"){if(isNewField=="true"){parent.nextPrevInputStep(-1)}else{parent.nextPrevInputStep(-2)}}else{if(b=="closeHandler"){var a=getWID();window.parent.closeTab(a)}else{if(b=="DeleteBtnHandler"){deleteReqDefObj()}else{if(b=="DeleteMappingHandler"){deleteInputMapHandler()}else{if(b=="confirmationHandler"){document.getElementById(CnfrmSaveChkBxId).checked=true;getSave()}else{document.getElementById("thePage:ReqDefForm:entitlementConfigOption").value=currentConfig;return false}}}}}}}}}}}}}}}function renderEntitlementData(b){PreviousConfig=currentConfig;currentConfig=b;var a=document.getElementById("txtSrch");if(a&&a.value&&a.value!=labelSrch){a.value=labelSrch}if(currentConfig=="RemedyforceConsole"&&PreviousConfig!=currentConfig){if(!secondRun){errorMsg="";changeConfiguration()}else{resetEntitlementData()}}else{if(currentConfig=="SelfService"&&PreviousConfig!=currentConfig){resetEntitlementData()}}}function validateBeforeSwitch(n){var a,d;var s,c;var h=document.getElementById("accountRadioEveryOne_SS");var r=document.getElementById("accountRadioSelected_SS");var f=document.getElementById("accountRadioEveryOne_Con");var m=document.getElementById("accountRadioSelected_Con");if(n=="SelfService"){a=allAccountInputOption.toLowerCase();if(h.checked){d="true"}else{d="false"}}else{a=console_allAccountInputOption.toLowerCase();if(f.checked){d="true"}else{d="false"}}if(a!=d){return false}if(n=="SelfService"){o=entitlementOptionSelected.toLowerCase();p=(document.getElementById("thePage:ReqDefForm:profileOptionSelect_SS").value).toString().toLowerCase()}else{o=console_entitlementOptionSelected.toLowerCase();p=(document.getElementById("thePage:ReqDefForm:profileOptionSelect_Con").value).toString().toLowerCase()}if(o!=p){return false}if(n=="RemedyforceConsole"){var e=document.getElementById("thePage:ReqDefForm:restrictSRAccess");if(e&&e.checked!=restrictCheckboxValue){return false}}var o,p;if(d!="true"){var l;l=accRightStore;if(n=="SelfService"){l=accRightStoreData;accRightStore=accRightStoreData}else{l=console_accRightStoreData;accRightStore=console_accRightStoreData}if(accRightStore.length!=l.length){return false}var q=0;var b=new Array();while(accRightStore.length>q){b.push(accRightStore[q]);q++}q=0;while(l.length>q){var u=l[q];if(b.indexOf(u)==-1){return false;break}q++}}if(p!="all"){var g;if(p==PERMISSIONSET_PREFIX.toLowerCase()){if(n=="SelfService"){rightStore=permissionsetRightStoreData;g=permissionsetRightStoreData}else{rightStore=console_permissionsetRightStoreData;g=console_permissionsetRightStoreData}}else{if(p==PROFILE_PREFIX.toLowerCase()){if(n=="SelfService"){rightStore=profileRightStoreData;g=profileRightStoreData}else{rightStore=console_profileRightStoreData;g=console_profileRightStoreData}}}if(rightStore.length!=g.length&&!isClickedOnSave){return false}isClickedOnSave=false;var q=0;var t=new Array();while(rightStore.length>q){t.push(rightStore[q]);q++}q=0;while(g.length>q){var u=g[q];if(t.indexOf(u)==-1){return false;break}q++}}if(isEntitlementChanged){return false}return true}function entitlementSelector(a){if(Ext.getCmp("profileSelector")!=null){if(a==ALL){Ext.getCmp("profileSelector").getEl().mask();Ext.getCmp("profileSelector").disable()}else{Ext.getCmp("profileSelector").getEl().unmask();Ext.getCmp("profileSelector").enable();if(a==PROFILE_PREFIX&&storeCurrentContents!=PROFILE_PREFIX){if(currentConfig=="RemedyforceConsole"){leftStore.loadData(console_profileLeftStoreData);Ext.getCmp("profileSelector").bindStore(leftStore);Ext.getCmp("profileSelector").setValue(console_profileRightStoreData)}else{leftStore.loadData(profileLeftStoreData);Ext.getCmp("profileSelector").bindStore(leftStore);Ext.getCmp("profileSelector").setValue(profileRightStoreData)}storeCurrentContents=PROFILE_PREFIX;currentTooltipAvailable=AvailableProfile;currentTooltipSelected=SelectedProfile;document.getElementById("thePage:ReqDefForm:available").innerText=document.getElementById("thePage:ReqDefForm:available").textContent=AvailableProfile;document.getElementById("thePage:ReqDefForm:selected").innerText=document.getElementById("thePage:ReqDefForm:selected").textContent=SelectedProfile}else{if(a==PERMISSIONSET_PREFIX&&storeCurrentContents!=PERMISSIONSET_PREFIX){if(currentConfig=="RemedyforceConsole"){leftStore.loadData(console_permissionsetLeftStoreData);Ext.getCmp("profileSelector").bindStore(leftStore);Ext.getCmp("profileSelector").setValue(console_permissionsetRightStoreData)}else{leftStore.loadData(permissionsetLeftStoreData);Ext.getCmp("profileSelector").bindStore(leftStore);Ext.getCmp("profileSelector").setValue(permissionsetRightStoreData)}storeCurrentContents=PERMISSIONSET_PREFIX;currentTooltipAvailable=AvailablePermissionSets;currentTooltipSelected=SelectedPermissionSets;document.getElementById("thePage:ReqDefForm:available").innerText=document.getElementById("thePage:ReqDefForm:available").textContent=AvailablePermissionSets;document.getElementById("thePage:ReqDefForm:selected").innerText=document.getElementById("thePage:ReqDefForm:selected").textContent=SelectedPermissionSets}}}}}function toggleReqDefActivation(){if(isrequestDefUpdateble=="true"){if(document.getElementById("activateBtn").children[0].innerText==labelActivate){document.getElementById("activateBtn").children[0].innerText=labelDeactivate}else{document.getElementById("activateBtn").children[0].innerText=labelActivate}hideLoadingMask()}}function setActivateDeactivateButton(){if(inactiveValue=="true"){document.getElementById("activateBtn").children[0].innerText=labelActivate}else{document.getElementById("activateBtn").children[0].innerText=labelDeactivate}if(!JSON.parse(isChatbotConfigured)||isRequestDefCreatable=="false"||isrequestDefUpdateble=="false"){document.getElementById("downloadJsonBtn").style.display="none"}else{document.getElementById("downloadJsonBtn").style.display=""}}function closeWindow(){if(isReqDefDeleted){showLightningPopup("toast",labelError,errormsg,"","","SRDForm","","error","");return}var a=getWID();window.parent.refreshList();window.parent.closeTab(a)}function setTurnaroundTime(){daysSpinner.setValue(getDaysTargetHiddenEle().value);hoursSpinner.setValue(getHoursTargetHiddenEle().value)}function setBtnState(){if(reDefId!=null&&reDefId!=""){document.getElementById("resetBtnId").setAttribute("aria-disabled",false);if(isRequestDefCreatable=="true"){document.getElementById("copyBtnId").setAttribute("aria-disabled",false)}if(isRequestDefDeletable=="true"){document.getElementById("deleteBtnId").setAttribute("aria-disabled",false)}var a=rfgetElementById("previousStep");if(a){a.disabled=false}if(currentStep==0){updateProgressBar(0,labelGeneralInfoTabTitle)}}}function handleChange(){if(!clickedOnce){clickedOnce=true;window.parent.registerChange(getWID())}}function handleResetChange(){if(clickedOnce){clickedOnce=false;window.parent.registerSave(getWID())}}function checkPermissions(){var a=document.getElementById("addMappingBtn");if(isMappingCreateable=="true"){a.disabled=false}else{a.disabled=true}}function ImgError(a){var b=a.parentNode;b.className="EnclosingDiv";a.onerror="";a.style.display="none";return true}function setExecutionOrder(b){var a=getExecOrderEle();if(a!=null){a.value=b}}function CreateNewTemplate(d){var c=Templatepage+"?standardLayout=true&id=&columnField=Name&direction=ASC&wid=2&isFromSRD=true";var a=650;var e=600;var g=(screen.width/2)-(a/2);var f=(screen.height/2)-(e/2);if(d=="RD"){var b=document.getElementById(INTemplateId).value;var l=document.getElementById(INTemplatename).value;if(b==null||b==""){showMessage(SelectIncidentTemplate)}else{c+="&TemplateFor=rd&incid="+encodeURIComponent(b)+"&incname="+encodeURIComponent(l);newWindow=window.open(c,CreateNewIncidentTemplate,"height="+e+",width="+a+",top="+f+", left="+g+",resizable=no,menubar=no,status=no,toolbar=no,scrollbars=no,location=0, directories=0,dependant=yes,dialog=yes,modal=yes,unadorned=yes");if(window.focus){newWindow.focus()}}}else{if(d="Incident"){c+="&TemplateFor=Incident";newWindow=window.open(c,CreateNewRequestDetailTemplate,"height="+e+",width="+a+",top="+f+", left="+g+",resizable=no,menubar=no,status=no,toolbar=no,scrollbars=no,location=0, directories=0,dependant=yes,dialog=yes,modal=yes,unadorned=yes");if(window.focus){newWindow.focus()}}}}function updatetSRtemplatevalues(a){if(a!=null&&a!=""){if(a[0]!=null&&a[0]!=""){document.getElementById(SRTemplatename).value=a[0];document.getElementById(SRTemplateId).value=a[1]}if(a[2]!=null&&a[2]!=""){document.getElementById(INTemplatename).value=a[2];document.getElementById(INTemplateId).value=a[3]}}}function updatetIncidenttemplatevalues(a){if(a!=null&&a!=""){if(a[0]!=null&&a[0]!=""){document.getElementById(INTemplatename).value=a[0];document.getElementById(INTemplateId).value=a[1]}}}function updateBusinessService(a){if(a!=null&&a!=""){if(a[0]!=null&&a[0]!=""){document.getElementById(businessServiceName).value=a[0];document.getElementById(businessServiceId).value=a[1]}}}function updateServiceOffering(a){if(a!=null&&a!=""){if(a[0]!=null&&a[0]!=""){document.getElementById(offeringName).value=a[0];document.getElementById(serviceOfferingId).value=a[1];document.getElementById(businessServiceName).value=a[2];document.getElementById(businessServiceId).value=a[3]}}}function OncompleteUpdateIncTemplate(a){var b=document.getElementById(SRTemplateId).value;setServiceRequestTemplate(b)}function createnewserviceoffering(d,e){var c="cmdbgenericpage?className=BMC_BusinessService&InstanceID=&wid=&assemblyId=&reqContextId=undefined&isStdForm=true&isFromSRD=true&CIType="+d;var a=1025;var b=500;if(d=="BusinessService"){if(serviceName==null||serviceName==""){showLightningPopup("vfModalPage",labelNewBusinessService,c,b,a);onCompleteFunction=e}else{showLightningPopup("vfModalPage",labelNewBusinessService,c,b,a)}}else{if(d="ServiceOffering"){if(serviceOfferingName==null||serviceOfferingName==""){showLightningPopup("vfModalPage",labelNewServiceOffering,c,b,a);onCompleteFunction=e}else{showLightningPopup("vfModalPage",labelNewBusinessService,c,b,a)}}}}function chkIncChanged(){var a=getIncValue();if(a!=INCValue){clearSRTemplate()}}function fetchDataForInc(b){var a=getIncValue();if(a!=null&&a!=""){isforIncidentTemplateLookup=true;showalldata(b,onCompleteSetIncident,escape("(templateFor__c='Incident')"))}}function hideShowRDInputGrid(){var a=document.getElementById("tdRDInput");var c=document.getElementById("tdInputs");var d=document.getElementById("divToggleView");var b=document.getElementById("tdToggleView");if(a.style.display=="none"){a.style.display="block";a.width="100%";c.width="70%";d.className="collapseRDInput";d.title=labelHideRDInputList;b.className="expandedTd";b.title=labelHideRDInputList}else{a.style.display="none";c.width="100%";d.className="expandRDInput";d.title=labelShowRDInputList;b.className="collapsedTd";b.title=labelShowRDInputList}}function hovertdToggleView(){var a=document.getElementById("divToggleView");a.className+="hover"}function mouseleavetdToggleView(){var a=document.getElementById("divToggleView");a.className=a.className.split("hover")[0]}function selectClickedRow(){if(selectedIndex&&selectedIndex!=null){inputGrid.getSelectionModel().select(selectedIndex)}}function setInactiveAndAttachmentChkBox(){var a=document.getElementById("thePage:ReqDefForm:reqDefAttachment").checked;if(!a){document.getElementById("thePage:ReqDefForm:reqDefAttachmentRequired").disabled=true}document.getElementById("thePage:ReqDefForm:chkPrefixPrompt").checked=prefixPromptValue}function FulfillmentCriteriaHandler(a,c){var b=Ext.getCmp("newTemplateBtn");if(b.disabled==false){openPopupWithTitleRD("FulfillmentInputLookupFilterPage?fulfillmentCriteria=true&requestId="+reDefId+"&LookupObj=BMC_BaseElement__c&LKfilterId="+LKfilterId,null,labelFulfillmentCriteria,524,895)}}function setRequestDefIconImageDisplay(a){var b=document.getElementById("thePage:ReqDefForm:Image_Id");if(!a&&b){b.style.display="none"}}function endsWith(b,a){return b.indexOf(a,b.length-a.length)!==-1}function nextPrevInputStep(e){if(validateFulfillmentInputStep(e)){var d=document.getElementsByClassName("fulfillment-input-step");var b=document.getElementsByClassName("fulfillment-input-step-header");var c=document.getElementById("inputHeader");if(c&&currentFulfillmentStep!=0){c.style.display="none";document.getElementById("userInstructionsTR").style.display="table-row";document.getElementById("mainSteps").style.display="inline-flex"}d[currentFulfillmentStep].style.display="none";b[currentFulfillmentStep].style.display="none";currentFulfillmentStep=currentFulfillmentStep+e;if(currentFulfillmentStep==0){enableMainFormButtonOnInput()}else{disableMainFormButtonOnInput()}if(currentFulfillmentStep==1){var a=rfgetElementById("divText Area (Rich)");if(isRichTextboxExist&&a&&a!=null){a.classList.add("disableDiv")}else{if(a&&a!=null&&a.classList.contains("disableDiv")){a.classList.remove("disableDiv")}}}showFulfillmentInputStep(currentFulfillmentStep);showFulfillmentInputStepHeader(currentFulfillmentStep);updateFulfillmentStep(currentFulfillmentStep)}}function validateFulfillmentInputStep(e){var c=true;if(currentFulfillmentStep==1&&e==1){var a=false;var d=document.getElementsByName("dataTypeInput");if(d){for(var b=0;b<d.length;b++){if(d[b].checked){a=true;inputDataType=d[b].id;inputDataTypeLabel=d[b].value;break}}}if(!a){c=false;document.getElementById("dataTypeSelectionError").style.display="block"}}return c}function showFulfillmentInputStep(c){var b=document.getElementsByClassName("fulfillment-input-step");b[c].style.display="block";if(c==1){var d=document.getElementsByName("dataTypeInput");if(d){for(var a=0;a<d.length;a++){d[a].checked=false}}}if(c==2){showLoadingMask();buttonHandler("/apex/FulfillmentInputDetailPage?requestId="+reDefId+"&isInputCreateable="+isInputCreateable+"&isNewField=true&inputDataType="+encodeURIComponent(inputDataType)+"&inputDataTypeLabel="+encodeURIComponent(inputDataTypeLabel),getInputFrameHeight(inputDataType))}}function showFulfillmentInputStepHeader(d){try{var c=document.getElementsByClassName("fulfillment-input-step-header");c[d].style.display="block";var b=document.getElementById("inputHeader");if(currentFulfillmentStep!=0&&b){b.style.display="block";document.getElementById("userInstructionsTR").style.display="none";document.getElementById("mainSteps").style.display="none"}}catch(a){}}function updateFulfillmentStep(b){if(inputGrid&&inputGrid.getView()&&b==0){inputGrid.getView().refresh()}var c=labelFulfillmentInputStep.replace("{0}",b).replace("{1}","2");var a;if(b==1){a=labelChooseDataType}else{if(b==2){a=labelRequestInputCreate}}if(b==0){document.getElementById("fulfillmentInputHeader").innerHTML="";document.getElementById("srdInputHeaderId").style.backgroundColor="white"}else{document.getElementById("fulfillmentInputHeader").innerHTML=RemedyForceHTMLProcessor.htmlDecoder(c+": "+a);document.getElementById("srdInputHeaderId").style.backgroundColor="#F3F2F2"}}function dataTypeSelection(){document.getElementById("dataTypeSelectionError").style.display="none"}function createFulfillmentInputJS(){var a=false;var c=document.getElementsByName("dataTypeInput");if(c){for(var b=0;b<c.length;b++){if(c[b].checked){a=true;inputDataType=c[b].id;inputDataTypeLabel=c[b].value;break}}}if(!a){document.getElementById("dataTypeSelectionError").style.display="block"}}function updateDateIcon(){try{var f=getElementsByClassName("dateInput");if(f.length>0){var a,h;var e;for(var c=0;c<f.length;c++){a=f[c];if(a.className.indexOf("dateOnlyInput")>-1){e=true}else{e=false}h=a.getElementsByClassName("dateFormat");for(var d=0;d<h.length;d++){if(h[d]!=null&&typeof(h[d])!="undefined"){var l=h[d].childNodes;if(l!=null&&typeof(l)!="undefined"&&l.length>0){if(l.length>=2&&l[1]!=null&&typeof(l[1])!="undefined"){var m=RemedyForceHTMLProcessor.getText(l[1]);RemedyForceHTMLProcessor.clearHTML(l[1]);l[1].title=labelInsert+": "+m;var g=document.createElement("SPAN");g.className="date-event-icon rfdplIconFontSize";g.id="DateIcon-Request_Definition"+Math.random();l[1].appendChild(g);l[1].style.textDecoration="none"}if(l.length>=3&&l[2]!=null&&typeof(l[2])!="undefined"){h[d].removeChild(l[2])}if(l.length>0&&l[0]!=null&&typeof(l[0])!="undefined"){h[d].removeChild(l[0])}}}}}}}catch(b){console.log(b)}}function openPopupWithTitleRD(h,d,l,a,c,f){if(l==null||l==""){l=""}if(a==null||a==""){a=570}if(c==null||c==""){c=670}onCompleteFunction=d;if(!f){f=false}var e=checkCustomPage();var m=h.split("?");var b=true;if(m[0].indexOf("MultiDocumentAttachmentPage")==-1){b=e.isFrame}var g="background-color:#FFFFFF;";popUpWindow=new Ext.Window({height:a,width:c,title:l,id:"popUpWindow",modal:true,resizable:false,draggable:false,bodyStyle:g,cls:"RFAdminWindow whiteBackgroud",frame:b,closable:false,html:'<iframe frameborder="0" name="iframeNameRequestDefinition" id="iframeIdRequestDefinition" src ="/apex/'+h+'" style="width:100%;height:100%;border:none"/>',tools:[{id:"lookupPerformance",handler:function(){var n="";for(var o=0;o<=3;o++){if(window.frames[o]!="undefined"){if(window.frames[o].document.getElementById("lookupdataval")!=null){n=window.frames[o].document.getElementById("lookupdataval").value}}if(n!=""){break}}var p=new Ext.QuickTip({target:"lookupPerformance",title:"",anchor:"right",width:200,shadow:"sides",bodyStyle:"font: 8pt Salesforce Sans,Arial,sans-serif; color:black;width:2%;border-color:black;",dismissDelay:1500000,html:n});p.show()},hidden:(f==false)?true:(f==true||f=="true")?false:true},{id:"winclose",handler:function(p,o,n){popUpWindow.close()}}]});popUpWindow.show();return popUpWindow}function showTextEditorRD(g,f,n,m,d,h,b,c,l){if(h==null||h=="undefined"){h=400}if(b==null||b=="undefined"){b=700}var a=new Ext.form.FormPanel({baseCls:"x-plain",labelWidth:55,layout:{type:"vbox",align:"stretch"},defaults:{xtype:"textfield"},items:[{xtype:"textarea",id:"formTextId",cls:"slds-textarea",style:{padding:"10px",},maxLength:32000,maxLengthText:TextAreaOverflow,hideLabel:true,border:false,enableKeyEvents:true,name:"msg",flex:1,listeners:{keyup:function(o,p){var q=o.getValue();if(q.length>n){o.setValue(q.substr(0,n))}}}}]});var e=new Ext.Window({title:f,id:"windowId",width:b,height:h,minWidth:300,minHeight:200,y:40,layout:"fit",modal:true,plain:true,draggable:false,cls:"RDTextEditorWindow whiteBackgroud",bodyStyle:"padding: 20px 10px 10px 10px; background:#FFFFFF;",buttonAlign:"right",items:a,defaultButton:"formTextId",shadow:false,closable:false,buttons:[{text:d,baseCls:"rf-slds-ext-button slds-button slds-button_neutral",handler:function(){e.close()}},{xtype:"tbspacer",width:5},{text:m,baseCls:"rf-slds-ext-button slds-button brand-button slds-button_brand slds-button_neutral",handler:function(){if(g!=null&&g!="undefined"){var o=document.getElementById(g);if(o){o.focus();o.value=Ext.getCmp("formTextId").getValue()}else{g.focus();g.value=Ext.getCmp("formTextId").getValue()}}else{if(l!=null&&l!="undefined"){l.focus();l.value=Ext.getCmp("formTextId").getValue()}}e.close()}},{xtype:"tbspacer",width:5}],tools:[{id:"winclose",handler:function(q,p,o){e.close()}}]});e.show();if(g!=null&&g!="undefined"){Ext.getCmp("formTextId").focus();Ext.getCmp("formTextId").setValue(document.getElementById(g).value)}else{if(l!=null&&l!="undefined"){Ext.getCmp("formTextId").focus();Ext.getCmp("formTextId").setValue(l.value)}}}function hideWaitMsgBar(){if(typeof(waitingMask)!="undefined"&&waitingMask!=null&&waitingMask!=""){waitingMask.hide()}}function showWaitMsgBar(){waitingMask=new Ext.LoadMask(document.getElementById("capsule"),{floating:{shadow:false},msgCls:"d-loader-container",msg:'<ul class="d-loading"><li class="d-loading__stick d-loading__stick_1"></li><li class="d-loading__stick d-loading__stick_2"></li><li class="d-loading__stick d-loading__stick_3"></li><li class="d-loading__stick d-loading__stick_4"></li><li class="d-loading__stick d-loading__stick_5"></li><li class="d-loading__stick d-loading__stick_6"></li><li class="d-loading__stick d-loading__stick_7"></li><li class="d-loading__stick d-loading__stick_8"></li><li class="d-loading__stick d-loading__stick_9"></li><li class="d-loading__stick d-loading__stick_10"></li><li class="d-loading__stick d-loading__stick_11"></li><li class="d-loading__stick d-loading__stick_12"></li></ul><div>'+pleaseWaitMsg+"</div>"});if(typeof(waitingMask)!="undefined"&&waitingMask!=null&&waitingMask!=""){waitingMask.show()}}function toggleToolbarMenu(b,a){if(b=="toggle"){if(a.classList.contains("slds-is-open")){a.classList.remove("slds-is-open")}else{a.classList.add("slds-is-open")}}else{if(b=="hide"){if(a.id=="toolbarMenu"){a.classList.remove("slds-is-open")}}}}function toggleSection(a){var b=document.getElementById("section-accordion-"+a);if(b.classList.contains("slds-is-open")){b.classList.remove("slds-is-open")}else{b.classList.add("slds-is-open")}}function openSRDLookup(e){var c,f,d,a=450,b=900;if(e=="Category"){if(!inProgress){f=labelSelectCategories;d=document.getElementById(categoryId).value;c="StdLayoutCategoryTree?txt={!$Component.ReqDefForm.Category__c_id_name}&popupId=incident&objectName=BMCServiceDesk__SRM_RequestDefinition__c&serviceRequest=true&state=true&searchLookUpStr="+encodeURIComponent(d)+"&filterId=active_custom&frm=catRDFrm&isCalledFromRD=true&lightningUI=true";b=600;showLightningPopup("vfModalPage",f,c+"&modalType=rfModalVFPage",a,b)}}else{if(e=="Service"){if(!inProgress){f=labelBusinessServicePopupTitle;d=document.getElementById(businessServiceName).value;c="SearchAndLink?txt=changelookupValues&parentName=SRM_RequestDefinition__c&childName=BMC_BusinessService__c&searchLookUpStr="+encodeURIComponent(d)+"&isLookUp=true&isCustomLookup=false&filterId=flat_service&addlFilterId=be_enddate&type=service&isSRD=true&isService=true&lightningUI=true";showLightningPopup("vfModalPage",f,c+"&modalType=rfModalVFPage",a,b)}}else{if(e=="Offering"){if(!inProgress){setofferingClausePanelData();f=labelBusinessServicePopupTitle;c=ServiceOfferingLink("serviceOffering");showLightningPopup("vfModalPage",f,c+"&lightningUI=true&modalType=rfModalVFPage",a,b)}}else{if(e=="INTemplate"){if(!inProgress){f=labelProcessTemplatePopupTitle;d=document.getElementById(INTemplatename).value;c="SearchAndLink?txt=changelookupValues&parentName=SRM_RequestDefinition__c&childName=SYSTemplate__c&isLookUp=true&NewLookUpType=&filterId=temp_in_active&searchLookUpStr="+encodeURIComponent(d)+"&isCustomLookup=false&isSRD=true&isInctemplate=true&lightningUI=true";showLightningPopup("vfModalPage",f,c+"&modalType=rfModalVFPage",a,b);onCompleteFunction=setIncidentTemplate}}else{if(e=="SRTemplate"){if(!inProgress){f=labelProcessTemplatePopupTitle;d=document.getElementById(SRTemplatename).value;c="SearchAndLink?txt=changelookupValues&parentName=SRM_RequestDefinition__c&childName=SYSTemplate__c&isLookUp=true&NewLookUpType=&filterId=temp_rd_active&searchLookUpStr="+encodeURIComponent(d)+"&isCustomLookup=false&isSRD=true&isReqtemplate=true&lightningUI=true";showLightningPopup("vfModalPage",f,c+"&modalType=rfModalVFPage&IncidentTemplateId="+encodeURIComponent(document.getElementById(INTemplateId).value),a,b);onCompleteFunction=setServiceRequestTemplate}}}}}}}function updateProgressBar(g,f){currentStep=g;RemedyForceHTMLProcessor.setText(document.getElementById("progressRingContent"),g+1);RemedyForceHTMLProcessor.setText(document.getElementById("currentStep"),f);var b;if(requestDefId==""){var h=g*20;b="M 1 0 A 1 1 0 "+Math.floor(h/50)+" 1 "+Math.cos(2*Math.PI*h/100)+" "+Math.sin(2*Math.PI*h/100)+" L 0 0"}else{b="M 1 0 A 1 1 0 1 1 1 -0.000628318 L 0 0"}var d=document.getElementById("rf-progressring");if(d){d.setAttribute("d",b)}var a=rfgetElementById("previousStep");var c=rfgetElementById("nextStep");var e=rfgetElementById("nextStepBtn");var l=rfgetElementById("nextStepSvg");if(l&&l.classList){l.classList.remove("slds-hide")}if(g==0){if(a&&a.classList){a.classList.add("slds-hidden");a.classList.remove("slds-visible")}if(c&&c.classList){c.classList.add("slds-visible");c.classList.remove("slds-hidden")}if(reDefId==""&&isRequestDefCreatable=="true"){if(e){e.innerText=labelSaveAndNext}if(c){c.title=labelSaveAndNext;c.setAttribute("onclick","SaveBtnHandler(true);")}}else{if(e){e.innerText=labelNextStep}if(c){c.title=labelNextStep;c.setAttribute("onclick","goToSRDStep(1);")}}}else{if(g==4){a.classList.add("slds-visible");a.classList.remove("slds-hidden");if(isrequestDefUpdateble=="true"){c.classList.add("slds-visible");c.classList.remove("slds-hidden");e.innerText=labelSave;l.classList.add("slds-hide");c.title=labelSave;c.setAttribute("onclick","SaveBtnHandler(false);")}else{c.classList.add("slds-hidden");c.classList.remove("slds-visible")}}else{a.classList.add("slds-visible");a.classList.remove("slds-hidden");c.classList.add("slds-visible");c.classList.remove("slds-hidden");e.innerText=labelNextStep;c.setAttribute("onclick","goToSRDStep(1);")}}}function setTypeAheadForLookups(){try{var b=getElementsByClassName("RFlookupClass");if(b.length>0){for(var d=0;d<b.length;d++){(function(c){var e=b[c];if(e.addEventListener){e.addEventListener("keyup",function(h){clearTimeout(typingTimer);var g=this;var f=event.target||event.srcElement;typingTimer=setTimeout(function(){updateTypeBoxOptions(f)},300,h,g)},"false")}else{if(e.attachEvent){e.attachEvent("onkeyup",function(h){clearTimeout(typingTimer);var g=this;var f=event.target||event.srcElement;typingTimer=setTimeout(function(){updateTypeBoxOptions(f)},300,h,g)})}}})(d)}}}catch(a){}}function changeSRDTitle(){var a=document.getElementById("existingSRDName");var b=document.getElementById("newSRDName");if(recordID!=""&&newTitle&&newTitle.length>0){b.classList.remove("slds-show");b.classList.add("slds-hide");a.classList.remove("slds-hide");a.classList.add("slds-show")}else{b.classList.remove("slds-hide");b.classList.add("slds-show");a.classList.remove("slds-show");a.classList.add("slds-hide")}}function setPaginatorButton(){var b=document.getElementById("accBtnPrevId");var a=document.getElementById("accBtnNextId");b.disabled=preFirstBtn;a.disabled=nextLastBtn;if(nextLastBtn){a.classList.remove("pagination-keys");a.classList.add("pagination-keys-Disabled")}else{a.classList.remove("pagination-keys-Disabled");a.classList.add("pagination-keys")}if(preFirstBtn){b.classList.remove("pagination-keys");b.classList.add("pagination-keys-Disabled")}else{b.classList.remove("pagination-keys-Disabled");b.classList.add("pagination-keys")}}function rfToggleTypebox(c,b,a){var e=document.getElementById("triggerDiv_"+c);var d=document.getElementById("triggerDiv_"+c);if(b){updateTypeBoxOptions(a);e.classList.add("slds-is-open")}else{setTimeout(function(){e.classList.remove("slds-is-open")},1000)}}function updateTypeBoxOptions(c){try{var h=c.getAttribute("rf-fieldapiname");var a=document.getElementById("rf-search_"+h);var g=document.getElementById("AddNew-"+h);var f="";if(h=="category"){f=labelFieldCategory}else{if(h=="service"){f=labelFieldService}else{if(h=="offering"){f=labelFieldOffering}else{if(h=="intemplate"){f=labelFieldINTemplate}else{if(h=="srtemplate"){f=labelFieldSRTemplate}}}}}var b="";if(c.value!=""&&c.value.length>1){b='"'+c.value+'"';g.classList.add("slds-hide")}else{g.classList.remove("slds-hide")}a.innerText=labelSearchLookup.replace("{0}",b).replace("{1}",f)}catch(d){}}function setTypeboxLabels(){var a=new Array(5);a[0]={field:"category",fieldlabel:labelFieldCategory};a[1]={field:"service",fieldlabel:labelFieldService};a[2]={field:"offering",fieldlabel:labelFieldOffering};a[3]={field:"intemplate",fieldlabel:labelFieldINTemplate};a[4]={field:"srtemplate",fieldlabel:labelFieldSRTemplate};for(i=0;i<a.length;i++){RemedyForceHTMLProcessor.setText(document.getElementById("rf-search_"+a[i].field),labelSearchLookup.replace("{0}","").replace("{1}",a[i].fieldlabel));RemedyForceHTMLProcessor.setText(document.getElementById("rf-addnewoption_"+a[i].field),labelCreateNewLookup.replace("{0}",a[i].fieldlabel))}}function showHelp(){var b=parent.window.frames.naviframe2;var d=b.location.pathname;var a=d.split("/");var c=a[a.length-1];c=c.toUpperCase();if(c=="SEARCHPAGE"||c=="REQUESTDEFPAGE"){wikiUrl=parent.wikiUrlForForm;if(wikiUrl!=null&&wikiUrl!=""&&wikiUrl!=undefined&&isNewContextpage()){window.open(wikiUrl,false,"width="+screen.width+",height="+screen.height+",resizable = 1,scrollbars=yes,status=1,top=0,left=0",false)}else{b.showFrameHelp("form")}}else{if(wikiUrl!=null&&wikiUrl!=""&&wikiUrl!=undefined&&isNewContextpage()){window.open(wikiUrl,false,"width="+screen.width+",height="+screen.height+",resizable = 1,scrollbars=yes,status=1,top=0,left=0",false)}else{b.OpenHelppage()}}}function clearInputPage(){var a=document.getElementById("frameFulfillmentInput");if(a){a.src=""}}function editMappingHandler(e,b){if(e){var d=mappingStore.findRecord(b,e);if(d){var a=d.data.objectFieldDataType;if(d.data.isMultiEdit){var c=labelMapInputToField+": "+Ext.String.htmlEncode(d.get("processVarLabel"));multiMappingEdit(e,c,d.data.mappings,b,a)}else{var f=mappingStore.indexOf(d);mappingGrid.plugins[0].startEditByPosition({row:f,column:4})}}}}function multiMappingEdit(h,m,f,e,n){var c=Ext.create("Ext.data.ArrayStore",{fields:["inputId","inputLabel","respType","respRefType","inputOrder"],data:questionData});var d="",l="";if(f){var b=[];for(i=0;i<f.length;i++){b[i]=f[i].inputId;if(d==""){d=f[i].processTemplateId}if(l==""){l=f[i].templateId}}c.clearFilter();c.filterBy(function(q,r){var o=q.data.respType;var p=q.data.respRefType;if(b.indexOf(q.data.inputId)!=-1){return false}else{if(n.toLowerCase()=="string"&&(q.data.respType=="Text Area (Rich)"||q.data.respType=="Text Area")){return false}else{return true}}})}availableMappingGrid=Ext.create("Ext.grid.Panel",{multiSelect:true,id:"firstGroup",cls:"rf-selectgrid",hideHeaders:true,width:325,height:325,viewConfig:{plugins:[{ptype:"gridviewdragdrop",dragGroup:"firstGridDDGroup",dropGroup:"secondGridDDGroup"}],listeners:{drop:function(o,p){Ext.Array.forEach(p.records,function(q){if(q.get("mappingId")!=""&&q.get("mappingId")!=null){deletedMappings.push(q.get("mappingId"))}isformDirty=true;handleChange()})}}},store:c,columns:[{text:"Id",hidden:true,sortable:true,dataIndex:"inputId"},{text:"Prompt",flex:1,sortable:true,tdCls:"rf-draggable-row",dataIndex:"inputLabel",renderer:function(s,p,o,r,t,q){s=Ext.util.Format.htmlEncode(s);p.tdAttr='data-qtip="'+Ext.util.Format.htmlEncode(s)+'"';return s}},{text:"Type",flex:0.5,hidden:true,sortable:true,dataIndex:"respType"},{text:"respRefType",flex:0.5,hidden:true,sortable:true,dataIndex:"respRefType"},{text:"additionalInfo",hidden:true,sortable:true,dataIndex:"inputOrder"}],margins:"0 0 0 0",title:labelAvailableInputs});var a=Ext.create("Ext.data.Store",{fields:["inputLabel","inputId","inputOrder","newOrder","mappingId","processTemplateId","templateId"],data:f});selectedMappingGrid=Ext.create("Ext.grid.Panel",{id:"secondGroup",hideHeaders:true,cls:"rf-selectgrid",width:325,height:325,viewConfig:{plugins:[{ptype:"gridviewdragdrop",dragGroup:"secondGridDDGroup",dropGroup:"firstGridDDGroup"},{ptype:"gridviewdragdrop",dragGroup:"secondGridDDGroup",dropGroup:"secondGridDDGroup"}],listeners:{drop:function(o,p){Ext.Array.forEach(p.records,function(q){if(q.get("respType")){q.set("mappingId","")}});isformDirty=true;handleChange()}}},store:a,columns:[{text:"Input/Prompt",flex:1,sortable:true,tdCls:"rf-draggable-row",dataIndex:"inputLabel",renderer:function(s,p,o,r,t,q){s=Ext.util.Format.htmlEncode(s);p.tdAttr='data-qtip="'+Ext.util.Format.htmlEncode(s)+'"';return s}},{text:"Type",flex:0.5,hidden:true,sortable:true,dataIndex:"inputId"},{text:"Order",flex:0.5,hidden:true,sortable:true,dataIndex:"inputOrder"},{text:"New Order",flex:0.5,hidden:true,sortable:true,dataIndex:"newOrder",renderer:function(q,r,o,s,p){return s+1}},{text:"MappingId",width:20,hidden:true,sortable:true,dataIndex:"mappingId"},{text:"ProcessId",width:20,hidden:true,sortable:true,dataIndex:"processTemplateId"},{text:"TemplateId",width:20,hidden:true,sortable:true,dataIndex:"templateId"}],margins:"0 0 0 0",title:labelMappedInputs});var g=new Ext.Window({title:m,id:"reorderMappingId",width:800,height:470,layout:{type:"hbox",pack:"start",align:"center"},modal:true,plain:true,draggable:false,cls:"RDTextEditorWindow whiteBackgroud",bodyStyle:"padding: 20px 15px 10px 15px; background:#FFFFFF;",buttonAlign:"right",items:[availableMappingGrid,{xtype:"container",width:40,margins:"100 10 0 10",layout:{type:"vbox",padding:5,pack:"start",align:"center"},defaults:{margins:"0 0 10 0"},items:[{xtype:"button",cls:"rf-selectlist-add rf-no-border",tooltip:labelAdd,handler:function(){moveMappingRow("add")}},{xtype:"button",cls:"rf-selectlist-remove rf-no-border",tooltip:labelRemove,handler:function(){moveMappingRow("remove")}}]},selectedMappingGrid,{xtype:"container",width:40,margins:"100 0 0 10",layout:{type:"vbox",pack:"start",align:"center"},defaults:{margins:"0 0 10 0"},items:[{xtype:"button",cls:"rf-selectlist-up rf-no-border",tooltip:labelUp,handler:function(){moveMappingRow("up")}},{xtype:"button",cls:"rf-selectlist-down rf-no-border",tooltip:labelDown,handler:function(){moveMappingRow("down")}}]},],shadow:false,closable:false,buttons:[{text:labelCancel,baseCls:"rf-slds-ext-button slds-button slds-button_neutral",handler:function(){deletedMappings=[];g.close()}},{xtype:"tbspacer",width:5},{text:labelOK,baseCls:"rf-slds-ext-button slds-button brand-button slds-button_brand slds-button_neutral",handler:function(){var p=mappingStore.findRecord(e,h);if(p){var r=new Array();var o="",q="";Ext.each(a.data.items,function(s,t){r.push({inputId:s.data.inputId,inputLabel:s.data.inputLabel,inputOrder:s.data.inputOrder,newOrder:t+1,processTemplateId:d,templateId:l,fieldName:p.get("processVarApiName"),mappingId:(s.data.mappingId!=null?s.data.mappingId:"")})});if(r.length>0){p.set("mappings",r);p.commit();mappingGrid.getView().refresh();if(deletedMappings.length>0){Ext.each(deletedMappings,function(s,t){q=q+(q.length>0?",":"")+s})}if(q!=""){deleteInputMapHandler(q)}deletedMappings=[];g.close()}else{GetMessageBox("bmc-message").show({title:labelError,msg:labelSelectInputError,width:300,buttons:Ext.Msg.OK})}}}},{xtype:"tbspacer",width:5}],tools:[{id:"winclose",handler:function(q,p,o){deletedMappings=[];g.close()}}]});g.show()}var isMappingOrderChanged=false;function moveMappingRow(g){if(g=="up"||g=="down"){var a=selectedMappingGrid,b=availableMappingGrid;var h=a.getStore();var e=a.getSelectionModel().getSelection();if(!e||e.length<=0){return}var f=h.indexOf(e[0]);if(g=="up"){f--;if(f<0){return}}else{if(g=="down"){f++;if(f>=h.getCount()){return}}}isMappingOrderChanged=true;var l=f;h.remove(e);h.insert(f,e);selectedMappingGrid.getView().refresh();selectedMappingGrid.getSelectionModel().select(l,true)}else{if(g=="add"){var e=availableMappingGrid.getSelectionModel().getSelection();if(!e||e.length<=0){return}var d=availableMappingGrid.getStore();var f=d.indexOf(e[0]);var h=selectedMappingGrid.getStore();var l=h.getCount();d.remove(e);for(var c=0;c<e.length;c++){e[c].data.inputOrder=-1;e[c].data.mappingId="";l++}h.add(e);selectedMappingGrid.getView().refresh();selectedMappingGrid.getSelectionModel().select(l-1,true)}else{if(g=="remove"){var e=selectedMappingGrid.getSelectionModel().getSelection();if(!e||e.length<=0){return}var d=selectedMappingGrid.getStore();var f=d.indexOf(e[0]);var h=availableMappingGrid.getStore();var l=h.getCount();d.remove(e);for(var c=0;c<e.length;c++){if(e[c].data.mappingId!=""&&e[c].data.mappingId!=null){deletedMappings.push(e[c].data.mappingId)}}h.add(e);availableMappingGrid.getView().refresh()}}}isformDirty=true;handleChange()}function rfgetElementById(a){return document.getElementById(a)}function performActionForSRDInput(b){var a=document.getElementById("frameFulfillmentInput");if(a){a.contentWindow.performActionForSRDInput(b)}}function disableMainFormButtonOnInput(){document.getElementById("prevBtnId").classList.add("disableDiv");document.getElementById("nextBtnId").classList.add("disableDiv");document.getElementById("saveBtnId").classList.add("disableDiv");document.getElementById("mainSteps").style.display="none"}function enableMainFormButtonOnInput(){document.getElementById("prevBtnId").classList.remove("disableDiv");document.getElementById("nextBtnId").classList.remove("disableDiv");document.getElementById("saveBtnId").classList.remove("disableDiv");document.getElementById("mainSteps").style.display="inline-flex"};