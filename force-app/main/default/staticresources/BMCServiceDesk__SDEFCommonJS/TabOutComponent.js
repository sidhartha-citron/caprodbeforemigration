var mainId,inProgress=false,eleToFocus,eleToFocusTabIndex,waitMsg="",condition="",onComplete,fieldName,lookupValues,fieldValue,twindownameflag,tempnames,objId,popupId,searchField,boolMultipleRecords,isBlackoutParam,checkFieldExists,targetSrc,isSLAOwnerLookup=false,isCustomField=false,taboutPageType,customId,customFieldIndex="",customVarId="",selectedCatId,isStaffLookUp=false,selectedClientId,objFld,formLayoutId="",objectName="";function getElementByTabIndexJS(a){var c;if(a!=null&&typeof(a)!="undefined"){var d=document.getElementsByTagName("*");for(var b=0;b<d.length;b++){if(d[b]!=null&&d[b].tabIndex==a){c=d[b];break}}}return c}function trim(b,a){return ltrim(rtrim(b,a),a)}function ltrim(b,a){a=a||"\\s";return b.replace(new RegExp("^["+a+"]+","g"),"")}function rtrim(b,a){a=a||"\\s";return b.replace(new RegExp("["+a+"]+$","g"),"")}function searchElementJS(){if(waitMsg!=null&&waitMsg!=""){waitMsg.hide()}if(typeof isCalledFromRD!="undefined"&&isCalledFromRD){hideLoadingMask()}var g;var r=document.getElementsByTagName("*");var c=null;var d=null;var D=r.length;var E=new Array(D);while(D!=0){c=r[D];if(c!=null){d=c.id;if(d.match("_id_")!=null){E.push(d)}}D--}if(checkFieldExists){if(typeof(remoteCallFlag)!=="undefined"&&objId=="User"&&!isCustomField){remoteCallFlag=false}if(!boolMultipleRecords){if(getStrnameiddEleId()!=null){var n="";setStrnameIdEleId(n)}if(tempnames.length>0){var s=tempnames.split(",");for(var C in s){var a=s[C];var h=a.toString();h=h.replace('"',"").replace('"',"").replace("[","").replace("]","");if(h.length>0){var y=h.split(":");var H="";var G="";if(y.constructor.toString().indexOf("Array")!=-1){if(typeof(y[0])=="string"){H=trim(y[0])}if(typeof(y[1])=="string"){G=trim(y[1])}}for(var B in E){if(typeof(E[B])=="string"){var m=null;if(typeof(IncidentPageComp)!="undefined"&&isStaffLookUp==true&&objId=="User"){m="OpenBy__c_id_"+H}else{m=objId+"_id_"+H+customVarId+customFieldIndex}if(!isCustomField){if(H=="IncidentAccountId"){m="Account_id_id"}if(H=="IncidentAccountName"){m="Account_id_name"}}if(typeof(isforIncidentTemplateLookup)!="undefined"&&isforIncidentTemplateLookup!=undefined&&isforIncidentTemplateLookup==true&&objId=="SYSTemplate__c"){if(H=="id"){m="SYSTemplate__c_id__inc_id"}if(H=="name"){m="SYSTemplate__c_id__inc_name"}}var q=E[B].substring((E[B].lastIndexOf(":")+1),(E[B].length));var k=E[B].split(":");if(k.length>1){k=k[1]}if(q==m){if(G=="null"){if(!(k=="organizationForm"&&m=="Account_id_name")){document.getElementById(E[B]).value=""}lookupValues[E[B]]=""}else{g=decodeURIComponent(G);while(g.indexOf("%space%")!=-1){g=g.replace("%space%"," ")}if(!isCustomField){if(H=="IncidentAccountId"||H=="IncidentAccountName"){while(g.indexOf("+")!=-1){g=g.replace("+"," ")}if(typeof(incAccountName)!="undefined"){incAccountName=g}}}if(!(k=="organizationForm"&&m=="Account_id_name")){document.getElementById(E[B]).value=g.trim();document.getElementById(E[B]).setAttribute("value",g.trim())}if(m=="User_id_id"){if(typeof(IncidentPageComp)!="undefined"&&IncidentPageComp.ComponentVars.TipUserID!=null&&typeof(IncidentPageComp.ComponentVars.TipUserID)!="undefined"){document.getElementById(IncidentPageComp.ComponentVars.TipUserID).value=g.trim()}}lookupValues[E[B]]=g.trim()}}}}}}}if(typeof(isforIncidentTemplateLookup)!="undefined"&&isforIncidentTemplateLookup!=undefined&&isforIncidentTemplateLookup==true){isforIncidentTemplateLookup=false}}else{if(taboutPageType!=null&&taboutPageType!=""&&typeof(taboutPageType)!="undefined"&&taboutPageType=="custom"){if(objId=="User"&&(isSLAOwnerLookup=="true"||condition.toLowerCase().indexOf("isstaffuser")!=-1)){openPopupRF("SearchPage?popupId=null&isBlk="+isBlackoutParam+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true&&filterClause=IsStaffUser__c=true&referenceObjectName="+objId,onCompPopulate)}else{if(objId.toLowerCase()=="account"&&condition.toLowerCase().indexOf("vendor")!=-1){openPopupRF("SearchPage?popupId=null&isBlk="+isBlackoutParam+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true&VENDORFlag=true&referenceObjectName="+objId,onCompPopulate)}else{if(objId.toLowerCase()=="account"&&condition.toLowerCase().indexOf("serviceprovider")!=-1){openPopupRF("SearchPage?popupId=null&isBlk="+isBlackoutParam+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true&SPFlag=true&referenceObjectName="+objId,onCompPopulate)}else{if(objId.toLowerCase()=="bmc_businessservice__c"){var A=condition.split("INSTANCEID");if(condition.toLowerCase().indexOf("subservicelookupinstanceid")!=-1){openPopupRF("SearchPage?moduleId=FKBUSINESSSERVICE__C&InstanceID="+A[1]+"&isLookup=true&popupId=null&moduleName=BMC_BUSINESSSERVICE__c&searchField="+searchField+"&fieldValue="+fieldValue,onCompPopulate)}else{openPopupRF("SearchPage?moduleId=FKBUSINESSSERVICE__C&InstanceID="+A[1]+"&isLookup=true&popupId=null&moduleName=BMC_BUSINESSSERVICE__c&searchField="+searchField+"&fieldValue="+fieldValue+"&filterClause="+condition,onCompPopulate)}}else{if(isFlattenedCmdb&&objId.toLowerCase()=="bmc_baseelement__c"){var f="",x="";if(objFld=="BMC_BaseElement__c_id_name__c"){f=escape("(serviceType__c != 'Offering') And (enddate__c = null or enddate__c >="+soqlDateClause+") AND MarkAsDeleted__c = false");x="BMC_BusinessService"}else{if(objFld=="BMC_BaseElement__c_id_name__c__xx_1"){f=escape("(serviceType__c = 'Offering') And (enddate__c = null or enddate__c >="+soqlDateClause+") AND MarkAsDeleted__c = false");x="BMC_BusinessService"}else{if(objFld=="BMC_BaseElement__c_id_name__x_3"){f=escape("MarkAsDeleted__c = false");x="BMC_BaseElement"}}}openPopupRF("SearchPage?popupId="+x+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true&isFilterObject=true&filterClause="+f+"&referenceObjectName="+objId,onCompPopulate)}else{if(objId=="SRM_RequestDefinition__c"){if(selectedClientId==null||selectedClientId=="undefined"||typeof(selectedClientId)=="undefined"){selectedClientId=""}if(selectedCatId==null||selectedCatId=="undefined"||typeof(selectedCatId)=="undefined"){selectedCatId=""}openPopupRF("SearchPage?popupId="+popupId+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true&filterClause="+condition+"&clientIdforSrm="+selectedClientId+"&catIdForSrd="+selectedCatId,onCompPopulate)}else{openPopupRF("SearchPage?popupId=null&isBlk="+isBlackoutParam+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true&referenceObjectName="+objId,onCompPopulate)}}}}}}if(targetSrc.getAttribute("isCalledFromTemplate")=="true"){targetSrc.isCalledFromTemplate="false";onCompPopulate(firstRecordId)}}else{if(targetSrc.getAttribute("isCalledFromTemplate")=="true"){targetSrc.isCalledFromTemplate="false";onCompPopulate(firstRecordId)}else{if(condition!=null&&condition!=""&&condition!="null"){if(condition.indexOf("IsActive")>0&&condition.indexOf("accountId")>0){var v=condition.split("accountId=");var b=v[1];openPopupRF("SearchPage?popupId="+popupId+"&isBlk="+isBlackoutParam+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true&filterClause=IsActive=true&accountId="+b+"&windownameflag="+twindownameflag,onCompPopulate)}else{if(popupId=="SRM_RequestDefinition"||popupId=="SRM_RequestDefinition__c"){if(selectedClientId==null||selectedClientId=="undefined"||typeof(selectedClientId)=="undefined"){selectedClientId=""}if(selectedCatId==null||selectedCatId=="undefined"||typeof(selectedCatId)=="undefined"){selectedCatId=""}openPopupRF("SearchPage?popupId="+popupId+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true&filterClause="+condition+"&clientIdforSrm="+selectedClientId+"&catIdForSrd="+selectedCatId,onCompPopulate)}else{var u=570;var w=670;if(popupId=="BMC_BaseElement"){w=800}if(isCalledFromRD){var t=targetSrc.getAttribute("id");var e=t.lastIndexOf(":")+1;var o=t.substring(e);var l,F,z,u=450,w=900;if(popupId=="Category"){F=labelSelectCategories;if(categoryId){z=document.getElementById(categoryId).value}l="StdLayoutCategoryTree?txt={!$Component.ReqDefForm.Category__c_id_name}&popupId=incident&objectName=BMCServiceDesk__SRM_RequestDefinition__c&serviceRequest=true&state=true&searchLookUpStr="+encodeURIComponent(z)+"&filterId=active_custom&frm=catRDFrm&isCalledFromRD=true&lightningUI=true";w=600;showLightningPopup("vfModalPage",F,l+"&modalType=rfModalVFPage",u,w)}else{if(popupId=="BMC_BaseElement"){if(o=="BMC_BaseElement__c_id_name__c__x_1"){setofferingClausePanelData();F=labelBusinessServicePopupTitle;l=ServiceOfferingLink("serviceOffering");showLightningPopup("vfModalPage",F,l+"&modalType=rfModalVFPage",u,w)}else{F=labelBusinessServicePopupTitle;if(businessServiceName){z=document.getElementById(businessServiceName).value}l="SearchAndLink?txt=changelookupValues&parentName=SRM_RequestDefinition__c&childName=BMC_BusinessService__c&searchLookUpStr="+encodeURIComponent(z)+"&isLookUp=true&isCustomLookup=false&filterId=flat_service&addlFilterId=be_enddate&type=service&isSRD=true&isService=true&lightningUI=true";showLightningPopup("vfModalPage",F,l+"&modalType=rfModalVFPage",u,w)}}else{if(popupId=="Template"){if(o=="SYSTemplate__c_id_name"){F=labelProcessTemplatePopupTitle;if(SRTemplatename){z=document.getElementById(SRTemplatename).value}var p=document.getElementById(INTemplateId).value;l="SearchAndLink?txt=changelookupValues&parentName=SRM_RequestDefinition__c&childName=SYSTemplate__c&isLookUp=true&NewLookUpType=&filterId=temp_rd_active&searchLookUpStr="+encodeURIComponent(z)+"&isCustomLookup=false&isSRD=true&isReqtemplate=true&lightningUI=true";showLightningPopup("vfModalPage",F,l+"&modalType=rfModalVFPage&IncidentTemplateId="+encodeURIComponent(p),u,w);onCompleteFunction=setServiceRequestTemplate}else{F=labelProcessTemplatePopupTitle;if(INTemplateId){z=document.getElementById(INTemplatename).value}l="SearchAndLink?txt=changelookupValues&parentName=SRM_RequestDefinition__c&childName=SYSTemplate__c&isLookUp=true&NewLookUpType=&filterId=temp_in_active&searchLookUpStr="+encodeURIComponent(z)+"&isCustomLookup=false&isSRD=true&isInctemplate=true&lightningUI=true";showLightningPopup("vfModalPage",F,l+"&modalType=rfModalVFPage",u,w);onCompleteFunction=setIncidentTemplate}}else{openPopupRF("SearchPage?popupId="+popupId+"&isBlk="+isBlackoutParam+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true&filterClause="+condition+"&windownameflag="+twindownameflag+"&objectName="+objectName+"&recType="+formLayoutId,onCompPopulate,u,w)}}}}else{openPopupRF("SearchPage?popupId="+popupId+"&isBlk="+isBlackoutParam+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true&filterClause="+condition+"&windownameflag="+twindownameflag+"&objectName="+objectName+"&recType="+formLayoutId,onCompPopulate,u,w)}}}}else{openPopupRF("SearchPage?popupId="+popupId+"&isBlk="+isBlackoutParam+"&searchField="+searchField+"&fieldValue="+fieldValue+"&isLookup=true",onCompPopulate)}}}}}else{document.getElementById(mainId).value="";document.getElementById(mainId).focus();checkValidityofRecord()}inProgress=false;eleToFocus=getElementByTabIndexJS(eleToFocusTabIndex);if(eleToFocus!=null&&typeof(eleToFocus)!="undefined"){if(twindownameflag!="urgencyflag"){eleToFocus.focus()}}if(typeof(checkSave)=="function"&&typeof(onComplete)!="function"){checkSave()}if(typeof(onComplete)=="function"){onComplete(lookupValues[mainId])}}function showTbData(g,i,k,n,h){if(h!=null&&h!=""){isBlackoutParam=h}if(n!=""&&n!=null){twindownameflag=n}isStaffLookUp=false;var b="";if(!inProgress){isCustomField=false;inProgress=true;getHiddenTextEle().focus();var l=g.target;if(l==null){l=g.srcElement}targetSrc=l;eleToFocusTabIndex=Number(l.getAttribute("tabindex"))+1;var f=l.value;mainId=l.id;var j=lookupValues[mainId];var e=false;if(mainId.indexOf("User_id_username")>0){var d=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;if(d.test(f)==false){e=true}}if(f!=j||e){var a=mainId.substring(0,mainId.lastIndexOf(":"));objFld=mainId.substring(mainId.lastIndexOf(":")+1);var c=objFld.split("_id_");var m=l.id;customVarId=customFieldIndex="";if(c[1].indexOf("__x_")>0){customId=objFld;customVarId="__x_";customFieldIndex=customId.substring((customId.lastIndexOf("_")+1),(customId.length));isCustomField=true;fieldName=c[1].split("__x_")[0]}else{if(c[1].indexOf("__xx_")>0){customId=objFld;customVarId="__xx_";customFieldIndex=customId.substring((customId.lastIndexOf("_")+1),(customId.length));isCustomField=true;fieldName=c[1].split("__xx_")[0]}else{if(c[1].indexOf("_inc_")==0){fieldName=c[1].split("_inc_")[1]}else{fieldName=c[1]}}}if(typeof(k)!="undefined"){condition=k;b=decodeURIComponent(condition)}onComplete=null;if(i!=null){onComplete=i}if(f!=null&&f!=""&&f.length>0){if(typeof(accountPopupFlag)!=="undefined"&&c[0]=="Account"&&!isCustomField){accountPopupFlag=true}setStrObjectIdEleVal(c[0]);if(typeof(IncidentPageComp)!="undefined"&&c[0]=="OpenBy__c"){setStrObjectIdEleVal("User");isStaffLookUp=true}if(b!=""&&b.indexOf("(templateFor__c='Incident')")!=-1&&typeof(isforIncidentTemplateLookup)!="undefined"&&isforIncidentTemplateLookup!=undefined){isforIncidentTemplateLookup=true}setStrFieldToSearchIdEleVal(fieldName);setStrValueIdEleVal(f);setWhereClauseIdEleVal(k);if(typeof(IncidentPageComp)!="undefined"&&IncidentPageComp.ComponentVars.CategoryID!=null&&typeof(IncidentPageComp.ComponentVars.CategoryID)!="undefined"&&IncidentPageComp.ComponentVars.CategoryID!="undefined"&&IncidentPageComp.ComponentVars.UserID!=null&&typeof(IncidentPageComp.ComponentVars.UserID)!="undefined"&&IncidentPageComp.ComponentVars.UserID!="undefined"&&c[0]=="SRM_RequestDefinition__c"){selectedCatId=document.getElementById(IncidentPageComp.ComponentVars.CategoryID).value;selectedClientId=document.getElementById(IncidentPageComp.ComponentVars.UserID).value;showdata(selectedClientId,selectedCatId)}else{showdata()}if(isCalledFromRD){showLoadingMask()}else{waitbox(0)}}else{condition="";if(typeof(accountPopupFlag)!=="undefined"&&c[0]=="Account"){accountPopupFlag=false}inProgress=false}}else{inProgress=false}}}function showalldata(c,d,b,a){showTbData(c,d,b,a,null)}function onCompPopulate(b){var a=getStrnameiddEleId();if(a!=null){a.value=b}waitbox(0);showdata()}function checkValidityofRecord(){if(isReqDefForm){showLightningPopup("modal","",TaboutComponent.Labels.NoRecordsFound,"","OK","SRDForm","")}else{msgBox=Ext.MessageBox.show({title:" ",width:190,msg:TaboutComponent.Labels.NoRecordsFound,buttons:Ext.MessageBox.OK})}}function initialiseTabComponent(a){if(typeof(MultiPageLayoutEnabled)!=="undefined"&&MultiPageLayoutEnabled=="true"){formLayoutId=a.layoutId;objectName=a.objectName}};