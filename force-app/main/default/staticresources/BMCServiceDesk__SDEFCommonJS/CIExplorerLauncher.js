var selectallrelations=[];var detailsTitle="";var isChildPanelCollapsed=true;var donotCheckUncheck=false;var donotSelectAll=false;var allValues=[];var filters=[];var selectedFilter="All";var displayRelationship=[];var cmdbTypeCounter=0;var layoutCounter=0;var relationshipCounter=0;var activeFilterID="";var activeFilterButtonID="";var classFilterValues=[];var relationFilterValues=[];var toolTipStringClassFilter="";var toolTipStringRelFilter="";var hideLineSeparator=!(isCIManagementEnabled&&isAssetManagementEnabled);Ext.fly(document.body).on("click",function(b){var a=Ext.fly(b.getTarget());if(activeFilterID){var c=a.findParent("div#"+activeFilterID);if(c){if(c.id!=activeFilterID){closeFilterPopup(activeFilterID)}}else{if(!(a&&a.dom&&a.dom.id&&a.dom.id.indexOf("filterButton")>-1)){closeFilterPopup(activeFilterID)}}}});function fillSelectRelArray(){var b;for(var a=0;a<reljson.length;a++){b=reljson[a][0];allValues.push(b);if(b!="Select All"){selectallrelations.push(b)}}}function setLoadDetails(b,a){detailsTitle=b;selectedInstanceID=a}function openPopupWithTitle(e,g,c,h,f,d){if(c==null){c=""}if(h==null||h==""){h=550}if(f==null||f==""){f=670}onCompleteFunction=g;var b=e.split("?");var a="background-color:#FFFFFF;";popUpWindow=new Ext.Window({height:h,width:f,title:c,x:10,y:5,modal:true,resizable:false,bodyStyle:a,constrain:true,viewConfig:{forceFit:true},html:'<iframe frameborder="0" src ="/apex/'+e+'" style="width:100%;height:100%;border:none"/>',});popUpWindow.show()}function openPopupDialog(d,f,c,g,e){if(c==null){c=""}if(g==null||g==""){g=550}if(e==null||e==""){e=670}onCompleteFunction=f;var b=d.split("?");var a="background-color:#FFFFFF;";popUpWindow=new Ext.Window({layout:"fit",height:g,width:e,title:c,frame:false,animate:true,cls:"CMDBWindow",bodyStyle:"padding-top: 25px; padding-bottom:5px; background:#FFFFFF;",style:"padding: 0; border-width: 0;background:#FFFFFF;",modal:true,resizable:false,border:false,ghost:false,closable:false,tools:[{type:"rfclose",handler:function(j,i,h){popUpWindow.close()}}],constrain:true,viewConfig:{forceFit:true},html:'<iframe frameborder="0" src ="/apex/'+d+'" style="width:100%;height:100%;border:none"/>',});popUpWindow.show()}function onRefresh(a){refreshDiagram()}function showSettings(){openPopupDialog("CIExplorerPage","",CiSettings,530,600);popUpWindow.center()}function reposNodes(){repositionNodes()}function getInfoPane(c){var b="";if(className!="BMC_BusinessService"){b=escape("Fkey__c != 'FKBusinessService__c'")}selectedInstanceID=c;var a="/apex/SIContainerPage?oid=&instID="+c+"&otype=BMC_BaseElement__c&wid=&isInactive=false&filterClause="+b+"&isCIExplorer=true&isModernUI=true";var d=document.getElementById("SIIframeID");if(d){d.style.display="none";d.src=a;d.style.display="block"}}function screenLeft(a){return parseInt((screen.availWidth/2)-(a/2))}function screenTop(a){return parseInt((screen.availHeight/2)-(a/2))}var ImpactAnalysisWindowHandler;var ImpactAnalysisHandlerFun=function(a,b){var c=950;var d=550;if(selectedInstanceID!=null&&typeof(selectedInstanceID)!="undefined"){ImpactAnalysisWindowHandler=window.open("/apex/ImpactAnalysis?parentId=&popupHeader=&isFromCILauncher=true&sourceCIElem="+selectedInstanceID,"ImpactAnalysis","status = 1,height =550,width =950,left="+screenLeft(c)+",top="+screenTop(d)+", resizable = 1,scrollbars=yes");if(ImpactAnalysisWindowHandler.focus){ImpactAnalysisWindowHandler.focus()}}};function openFilterPopup(){closeFilterPopup(activeFilterID);var b=document.getElementById("classFilterDiv");var c=document.getElementById("filterButton1");var a=parseInt(c.style.left);activeFilterID="classFilterDiv";activeFilterButtonID="filterButton1";a-=195;b.style.visibility="visible";b.style.left=a+"px";c.classList.remove("closeFilterPopup");c.classList.add("openFilterPopup")}function openFilterPopupRel(){closeFilterPopup(activeFilterID);var b=document.getElementById("relFilterDiv");var c=document.getElementById("filterButton2");var a=parseInt(c.style.left);activeFilterID="relFilterDiv";activeFilterButtonID="filterButton2";a-=195;c.classList.remove("closeFilterPopup");c.classList.add("openFilterPopup");b.style.visibility="visible";b.style.left=a+"px"}function displayTooltipAndFilterIconOnSelectionChange(){if(activeFilterButtonID){var a=document.getElementById(activeFilterButtonID);if(activeFilterButtonID=="filterButton2"){toolTipString=toolTipStringRelFilter}else{if(activeFilterButtonID=="filterButton1"){toolTipString=toolTipStringClassFilter}}a.title=toolTipString;if(toolTipString.indexOf(allClassesSelectedLabel)>-1||toolTipString.indexOf(allRelSelectedLabel)>-1){a.classList.remove("filterClassApplied");a.classList.add("filterClass")}else{a.classList.remove("filterClass");a.classList.add("filterClassApplied")}}}function closeFilterPopup(c){var a="";if(c){document.getElementById(c).style.visibility="hidden"}if(activeFilterButtonID){var b=document.getElementById(activeFilterButtonID);b.classList.remove("openFilterPopup");b.classList.add("closeFilterPopup")}}function addIntoRelationshipFlter(d,h){var g=JSON.parse(relationshipFIlterJSON);var b=d.srcElement.checked;var e="";var c=0;if(h=="Select All"){selectAllCheckBoxes("relFilterDiv",b);relationFilterValues=[];if(b){relationFilterValues=addAllElementsFromJSONToArray(relationshipFIlterJSON)}}else{var f=selectUnSelectCheckboxSelectAll("relFilterDiv",b);if(f){relationFilterValues=[];relationFilterValues=addAllElementsFromJSONToArray(relationshipFIlterJSON)}else{for(c=0;c<relationFilterValues.length;c++){if(relationFilterValues[c]==h){break}}if(c<relationFilterValues.length){relationFilterValues.splice(c,1)}else{if(c==relationFilterValues.length&&b){relationFilterValues.push(h)}}var a=relationFilterValues.indexOf("Select All");if(a>-1){relationFilterValues.splice(a,1)}}}if(relationFilterValues.indexOf("Select All")>-1){toolTipStringRelFilter=allRelSelectedLabel}else{toolTipStringRelFilter=relationFilterValues.join(" ")}displayTooltipAndFilterIconOnSelectionChange();filterRelationships(relationFilterValues.join("|"))}function addIntoClassFilter(d,g){var b=d.srcElement.checked;var e="";var c=0;if(g=="Select All"){selectAllCheckBoxes("classFilterDiv",b);classFilterValues=[];if(b){for(c=0;c<classTypes.length;c++){classFilterValues.push(classTypes[c])}}}else{var f=selectUnSelectCheckboxSelectAll("classFilterDiv",b);if(f){classFilterValues=[];for(c=0;c<classTypes.length;c++){classFilterValues.push(classTypes[c])}}else{for(c=0;c<classFilterValues.length;c++){if(classFilterValues[c]==g){break}}if(c<classFilterValues.length){classFilterValues.splice(c,1)}else{if(c==classFilterValues.length&&b){classFilterValues.push(g)}}var a=classFilterValues.indexOf(selectAllLabel);if(a>-1){classFilterValues.splice(a,1)}}}createClassFilterTooltip();displayTooltipAndFilterIconOnSelectionChange();filterOnClassType(classFilterValues.join("|"))}function addAllElementsFromJSONToArray(b){var d=JSON.parse(b);var c=[];var a=0;for(a=0;a<d.length;a++){if(d[a].value){c.push(d[a].value)}}return c}function selectAllCheckBoxes(a,d){var c=0;var b=document.getElementById(a).getElementsByTagName("INPUT");for(c=0;c<b.length;c++){var e=b[c];e.checked=d}}function selectUnSelectCheckboxSelectAll(a,d){var c=1;var b=document.getElementById(a).getElementsByTagName("INPUT");var e=b[0];if(d){for(c=1;c<b.length;c++){if(!b[c].checked){break}}if(c==b.length){b[0].checked=d;return true}}else{b[0].checked=d;return false}return false}function createClassFilterTooltip(){toolTipStringClassFilter="";var a=0;for(a=0;a<classFilterValues.length;a++){if(classFilterValues[a]!=selectAllLabel){toolTipStringClassFilter+=classNameWithClassId[classFilterValues[a]]+" "}else{toolTipStringClassFilter=allClassesSelectedLabel;break}}}function resizePanels(){var b={};b.width=Ext.getBody().getViewSize().width;b.height=Ext.getBody().getViewSize().height;var a=Ext.getCmp("mainPanel");a.setSize(b.width,b.height);document.getElementById("diagDiv").style.width=b.width+"px";document.getElementById("zoomerdiv").style.left=b.width*0.927+"px";document.getElementById("diagramdiv").style.width=(b.width-20)+"px";document.getElementById("diagramdiv").style.height=(b.height-90)+"px";if(isChildPanelCollapsed){resizepanelscollapse()}else{resizepanelsexpand()}}function resizepanelsexpand(){isChildPanelCollapsed=false;var a=document.getElementById("childPanel").style.height;childpanelheight=parseInt(a,10);document.getElementById("diagDiv").style.height=(Ext.getBody().getViewSize().height-(childpanelheight+65))+"px";document.getElementById("diagramdiv").style.height=(Ext.getBody().getViewSize().height-395)+"px"}function resizepanelscollapse(){isChildPanelCollapsed=true;document.getElementById("diagDiv").style.height="100%";document.getElementById("diagramdiv").style.height=(Ext.getBody().getViewSize().height-90)+"px"}function resize(){if(isChildPanelCollapsed){resizepanelscollapse()}else{resizepanelsexpand()}}function createCookie(){var a=new Date();var b=new Date(a.getTime()+365*24*60*60*1000);document.cookie="apex__"+userId+"CIExpFilter="+selectedFilter+";path=/;SameSite=None;Secure;expires="+b.toUTCString()}function setDefaultValuesToFilter(){var a=0;classFilterValues=[];selectAllCheckBoxes("relFilterDiv",true);selectAllCheckBoxes("classFilterDiv",true);relationFilterValues=addAllElementsFromJSONToArray(relationshipFIlterJSON);for(a=0;a<classTypes.length;a++){if(classFilterValues.indexOf(classTypes[a])==-1){classFilterValues.push(classTypes[a])}}createClassFilterTooltip();if(relationFilterValues.indexOf("Select All")>-1){toolTipStringRelFilter=allRelSelectedLabel}else{toolTipStringRelFilter=relationFilterValues.join(" ")}document.getElementById("filterButton1").title=toolTipStringClassFilter;document.getElementById("filterButton2").title=toolTipStringRelFilter}Ext.onReady(function(){documentOnReady();populateTitle();fillSelectRelArray();if(isCIManagementEnabled&&isAssetManagementEnabled){selectedFilter="All"}else{if(isAssetManagementEnabled){selectedFilter="Asset"}else{if(isCIManagementEnabled){selectedFilter="CI"}}}layouts=[["BT",labels.BorderedTree],["FL",labels.Fractal],["LL",labels.Layered],["SL",labels.Spring],["TL",labels.Tree]];filters=[["All",labels.All],["CI",labels.CMDB_TAB_CIs],["Asset",labels.CMDB_TAB_Assets]];var a=Ext.create("Ext.data.ArrayStore",{fields:["abbr","layout"],data:layouts});var g=Ext.create("Ext.form.field.ComboBox",{hideLabel:true,id:"combo",store:a,displayField:"layout",valueField:"abbr",typeAhead:true,editable:false,queryMode:"local",triggerAction:"all",triggerCls:"d-icon-triangle_down",selectOnFocus:true,width:135,listeners:{boxready:function(){this.setValue(this.getStore().getAt(2).get(this.valueField),true);this.fireEvent("select",this)},select:function(j,i){if(j.getValue()=="FL"||j.getValue()=="BT"){Ext.getCmp("reposition").disabled=true;Ext.getCmp("reposition").setIconCls("disablecss reposition")}else{Ext.getCmp("reposition").disabled=false;Ext.getCmp("reposition").setIconCls("reposition")}document.getElementById("combo").title=j.getRawValue();if(layoutCounter==0){layoutCounter++;return}applyLayout(j.getValue())}}});var f=Ext.create("Ext.data.ArrayStore",{fields:["id","reldisplay"],autoload:true,data:reljson});var e=Ext.create("Ext.form.field.ComboBox",{hideLabel:true,id:"comborel",store:f,displayField:"reldisplay",valueField:"id",editable:false,typeAhead:true,queryMode:"local",triggerAction:"all",multiSelect:true,autoSelect:false,triggerCls:"d-icon-triangle_down",selectOnFocus:true,width:250,listConfig:{maxHeight:400,getInnerTpl:function(){var i='<tpl if="id==\'Select All\'"> <span class="container"  ><input id="{id}" type="checkbox" checked="true" /> {reldisplay:htmlEncode} <span class="checkmark" /></span> <tpl else><span class="container" > <input id="{id}" type="checkbox" checked="true" /> {reldisplay:htmlEncode}<span class="checkmark" /></span></tpl>';return i}},listeners:{boxready:function(){donotCheckUncheck=true;this.setValue(allValues);donotCheckUncheck=false},change:function(x,p,l,w){var u=[];var n=[];var k=[];if(typeof p!=="undefined"&&p.length>0){for(var v=0;v<p.length;v++){u.push(p[v]);if(v==0){k.push(p[v])}else{k.push(" "+p[v])}}}if(typeof l!=="undefined"&&l.length>0){for(var v=0;v<l.length;v++){n.push(l[v])}}displayRelationship=[];var m=document.getElementsByTagName("input");if((typeof u!=="undefined")&&(u.length>0)&&(u.indexOf("Select All"))>-1){if((!donotSelectAll)&&(n.length!=allValues.length)){donotCheckUncheck=true;if(n.length>0){this.reset()}donotCheckUncheck=true;this.setValue(allValues);donotCheckUncheck=true;for(v=0;v<m.length;v++){if(m[v].type=="checkbox"){m[v].checked=true}}}}else{if((typeof n!=="undefined")&&(n.length>0)&&(n.indexOf("Select All"))>-1&&(!donotSelectAll)){donotCheckUncheck=true;this.reset();donotCheckUncheck=true;for(v=0;v<m.length;v++){if(m[v].type=="checkbox"){m[v].checked=false}}}}if(u!=null){var o;var t=false;for(var v=0;v<u.length;v++){o=u[v];if(o=="Select All"){t=true;break}if((u.indexOf("Select All")<=-1)&&(!donotCheckUncheck)){displayRelationship.push(u[v]);for(var s=0;s<m.length;s++){if(m[s].type=="checkbox"){if(m[s].id==o){m[s].checked=true}}}}}if(t){for(var v=0;v<selectallrelations.length;v++){displayRelationship[v]=selectallrelations[v]}}}if((typeof n!=="undefined")&&(n.length>0)&&(!donotCheckUncheck)){var r;for(var v=0;v<n.length;v++){r=n[v];if((u.length==0)||(u.indexOf(r)==-1)){if((n.indexOf("Select All")<=-1)){for(v=0;v<m.length;v++){if(m[v].type=="checkbox"){if(m[v].id==r){m[v].checked=false}}}}else{var q=[];for(v=0;v<m.length;v++){if(m[v].type=="checkbox"){donotSelectAll=true;donotCheckUncheck=true;if(m[v].id=="Select All"){m[v].checked=false;this.reset("Select All")}if(m[v].id==r&&r!="Select All"){m[v].checked=false}if(m[v].checked==true&&m[v].id!=r){q.push(m[v].id)}}}displayRelationship=[];for(var s=0;s<q.length;s++){displayRelationship[s]=q[s]}this.setValue(q)}}}}donotCheckUncheck=false;donotSelectAll=false;if(relationshipCounter==0){relationshipCounter++;return}filterRelationships(displayRelationship.join("|"))}}});var b=Ext.create("Ext.data.ArrayStore",{fields:["abr","filterval"],data:filters});var h=Ext.create("Ext.form.field.ComboBox",{hideLabel:true,id:"comboFilter",store:b,displayField:"filterval",valueField:"abr",typeAhead:true,editable:false,queryMode:"local",triggerAction:"all",triggerCls:"d-icon-triangle_down",selectOnFocus:true,width:135,listeners:{boxready:function(){var i=Ext.util.Cookies.get("apex__"+userId+"CIExpFilter");if(isCIManagementEnabled&&isAssetManagementEnabled&&i!=null&&i!="null"&&i!=""&&typeof i!="undefined"){selectedFilter=i;if(selectedFilter=="CI"){this.setValue(this.getStore().getAt(1).get(this.valueField),true)}else{if(selectedFilter=="Asset"){this.setValue(this.getStore().getAt(2).get(this.valueField),true)}else{this.setValue(this.getStore().getAt(0).get(this.valueField),true)}}}else{this.setValue(this.getStore().getAt(0).get(this.valueField),true)}this.fireEvent("select",this)},select:function(j,i){document.getElementById("comboFilter").title=j.getRawValue();selectedFilter=j.getValue();createCookie();if(cmdbTypeCounter==0){cmdbTypeCounter++;return}filterRelationships(relationFilterValues.join("|"))}}});var d=Ext.create("Ext.toolbar.Toolbar",{height:45,autoWidth:true,items:[{xtype:"tbspacer",width:3},{iconCls:"refresh",id:"refreshBtnId",scale:"medium",tooltipType:"title",tooltip:labels.Refresh,border:false,handler:onRefresh},{iconCls:"settings",id:"settingBtnId",tooltipType:"title",tooltip:labels.Settings,iconAlign:"top",scale:"medium",border:false,handler:showSettings},"-",{text:labels.Layout,xtype:"tbtext"},g,{xtype:"tbspacer",width:2},{id:"reposition",tooltipType:"title",tooltip:labels.Reposition,iconAlign:"top",scale:"medium",border:false,handler:reposNodes},"-",{text:labels.ShowClasses+":",xtype:"tbtext",id:"FilterLabel"},h,{xtype:"tbspacer",width:1},{xtype:"tbseparator",hidden:hideLineSeparator},{xtype:"tbspacer",width:5,hidden:hideLineSeparator},{text:labels.FilterByClasses,xtype:"tbtext",},{text:"",id:"filterButton1",xtype:"button",iconAlign:"top",disabled:false,baseCls:"filterClass",height:"38px",handler:openFilterPopup,top:"1px !important",},"-",{xtype:"tbspacer",width:5},{text:labels.RelDisplayed,xtype:"tbtext"},{text:"",id:"filterButton2",xtype:"button",iconAlign:"top",disabled:false,baseCls:"filterClass",height:"38px",handler:openFilterPopupRel,top:"1px !important",},"-",{xtype:"tbspacer",width:5},{text:labels.AnalyzeImpact,id:"impactAnalysis",xtype:"button",tooltipType:"title",tooltip:labels.AnalyzeImpact,iconAlign:"top",disabled:false,baseCls:"bmc-btn-primary",disabledCls:"bmc-btn-primary-disabled",focusCls:"bmc-btn-primary-focus",overCls:"bmc-btn-primary-over",pressedCls:"bmc-btn-primary-pressed",handler:ImpactAnalysisHandlerFun},"->",{xtype:"label",html:'<span class="d-icon-question_circle" title="'+labels.Help+'" id="helpConsoleList" onclick="window.open(wikiUrl);"></span>'}]});Ext.create("Ext.panel.Panel",{layout:{type:"vbox",align:"stretch",pack:"start",split:true,collapsible:true},id:"mainPanel",height:500,width:1100,items:[d,{xtype:"panel",layout:"fit",flex:0.3,border:false,contentEl:"diagDiv"},{xtype:"panel",id:"childPanel",layout:"fit",height:0,flex:0.35,html:'<iframe id= "SIIframeID" src="" scrolling="no" style="width:100%;height:100%;display:none;border: none"></iframe>',title:"",collapsible:true,collapseDirection:"bottom",animCollapse:false,headerPosition:"top",listeners:{resize:function(n,m,i,j,o,k){var l=document.getElementById("SIIframeID");l.src=l.src}}}],renderTo:"content-div"});var c=Ext.getCmp("childPanel");resizePanels();c.collapse();c.setTitle(detailsTitle);getInfoPane(selectedInstanceID);c.on("expand",resizepanelsexpand,this,{});c.on("collapse",resizepanelscollapse,this,{});c.on("resize",resize,this,{});if(!(isCIManagementEnabled&&isAssetManagementEnabled)){Ext.getCmp("comboFilter").hide();Ext.getCmp("FilterLabel").hide()}if(closeCMDBExp){closeCMDBExplorer()}setDefaultValuesToFilter();filterRelationships(relationFilterValues.join("|"));filterOnClassType(classFilterValues.join("|"))});Ext.EventManager.onWindowResize(function(){resizePanels()});function get_url_parameter(d){d=d.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+d+"=([^&#]*)";var b=new RegExp(c);var a=b.exec(window.location.href);if(a==null){return""}else{return a[1]}}function closeCMDBExplorer(){GetMessageBox("bmc-message").show({title:labels.title,msg:labels.NoRelExist,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO,fn:function(a){window.close()}})}function populateTitle(){if(get_url_parameter("stdForm")){document.title=labels.title}if(Ext.isIE8){if(document.getElementById("silverlightlink")!=null){document.getElementById("silverlightlink").href="https://go.microsoft.com/fwlink/?LinkID=149156&v=3.0.40624.0"}if(document.getElementById("silverlightimg")!=null){document.getElementById("silverlightimg").src="https://go.microsoft.com/fwlink/?LinkId=108181"}}};