Ext.require(["Ext.form.Panel","Ext.ux.form.MultiSelect"]);Ext.onReady(function(){Ext.MessageBox.buttonText.ok=okLbl;Ext.MessageBox.buttonText.yes=yesLbl;Ext.MessageBox.buttonText.no=noLbl;Ext.define("layoutNameModel",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"id",type:"string"}]});layoutnameStore=Ext.create("Ext.data.Store",{storeId:"layoutListstore",model:"layoutNameModel",data:ObjectLayouts});LayoutListGrid=Ext.create("Ext.grid.Panel",{store:Ext.data.StoreManager.lookup("layoutListstore"),id:"gridId",forceFit:true,columns:[{text:lblLayoutName,cls:"columnCls ListGridcls",menuDisabled:true,dataIndex:"name",renderer:function(value,metaData,record,rowIndex,colIndex,store,view){if(record.data.id==defaultLayoutName){var str='<div title="'+defaultLayoutTooltipLbl+'">'+value+"<div>";return str}else{return value}}}],height:200,cls:"ListGridcls",border:false,renderTo:"layoutListtoolbar"});var textvalue;LayoutListGrid.on("cellclick",function(iView,iCellEl,iColIdx,iRecord,iRowEl,iRowIdx,iEvent){var result=compareOldNewValue();if(result||isDataChanged=="true"){var dlg=Ext.MessageBox.confirm(lblLayout,warninMsgInRFLayoutPage,function(btn){if(btn==="yes"){onlayoutSelect(iRecord.data.id,iRecord.data.name)}else{var indexNo=layoutnameStore.find("id",selectedlayoutId);LayoutListGrid.getSelectionModel().select(indexNo,false)}});dlg.defaultButton=2;dlg.focus()}else{onlayoutSelect(iRecord.data.id,iRecord.data.name)}});var layoutNameLabel=new Ext.form.Label({id:"layoutnameLabel",text:lblLayoutName+":",cls:"padingTop5 "});var containerPanel=new Ext.Panel({border:false,layout:"column",renderTo:"layoutName",cls:"marginTop15 marginleft10",items:[layoutNameLabel,{xtype:"textfield",name:"layoutNameTXT",id:"layoutNameTXT",width:426,cls:"x-boundlist"}]});var layoutNameTEXT=Ext.getCmp("layoutNameTXT");layoutNameTEXT.focus();layoutNameTEXT.on("change",function(view,newValue,oldValue,eOpts){if(Ext.String.htmlDecode(textvalue)!=newValue){isDataChanged="true"}else{isDataChanged="false"}});var availableFieldSetlbl=new Ext.form.Label({id:"lblAvailableFieldSet",text:lblAvaliableFieldSet,cls:"ActionToolHeaderCls"});var selectedFieldSetlbl=new Ext.form.Label({id:"lblSelectedFieldSet",text:lblSelectedFieldSet,cls:"ActionToolHeaderCls"});var fieldSetslabelPanel=new Ext.Panel({id:"assignLayoutPanelId",border:false,cls:"marginTop5 marginleft10",layout:"column",renderTo:"fielsetlabels",items:[{width:275,border:false,items:[availableFieldSetlbl]},{width:180,border:false,items:[selectedFieldSetlbl]}]});LytPnlheader=new Ext.form.Label({id:"LytPnlheader",text:lblNewLayout,renderTo:"newEditLtHeader"});dataStore=Ext.create("Ext.data.ArrayStore",{fields:["value","text"],sortInfo:{field:"value",direction:"ASC"}});setAvailableData();setSelectedData();eval(hiddenSelectedStore);itemSel=new Ext.ux.form.ItemSelector({anchor:"100%",id:"itemSelector",height:200,width:500,store:dataStore,displayField:"text",valueField:"value",value:selctedFieledSet,buttons:["top","up","down","bottom"],allowBlank:true,msgTarget:"side"});var isForm=Ext.widget("form",{width:550,border:false,renderTo:"editlayout",cls:"marginTop10",items:[itemSel]});Ext.getCmp("gridId").getEl().addKeyMap({eventName:"keyup",binding:[{key:[Ext.EventObject.UP,Ext.EventObject.DOWN],fn:function(){idValue=Ext.getCmp("gridId").getSelectionModel().selected.items[0].raw.id;nameValue=Ext.getCmp("gridId").getSelectionModel().selected.items[0].raw.name;if((idValue!=""&&nameValue!="")||(idValue!="undefined"&&nameValue!="undefined")||(idValue!=null&&nameValue!=null)){onlayoutSelect(idValue,nameValue)}}}]});function waitbox(timeout){if(parseInt(timeout)>0){setTimeout("waitMsg.hide()",timeout)}waitMsg=new Ext.Window({height:100,width:200,resizable:false,closable:false,header:false,frame:false,modal:true,shadow:false,baseCls:"waitboxCls",items:[{xtype:"panel",height:100,width:200,border:false,bodyStyle:"background-color:transparent;border:none;",html:'<div align="center"><img src="'+tabOutImg+'"/></div>'}]});waitMsg.show()}var dynRenderingDiv=document.getElementById("layoutDynamicRendering");if((Objectname=="SelfService"||Objectname=="SR"||Objectname=="Incident")&&typeof(dynRenderingDiv)!="undefined"&&dynRenderingDiv!=null){dynRenderingDiv.setAttribute("style","display:block;");var dynRenderingChbx=document.getElementById("enableDynamincRendering");dynRenderingChbx.checked=isDynamicRenderingEnabled;enableDisableTheLink(dynRenderingChbx)}setDynamicRenderingCheckboxDisable(true)});function saveLayout(){var a=Ext.getCmp("layoutNameTXT").getValue().trim();if(a==null||a==""){showMessage(lblEnterNameMsg);return null}var b=itemSel.getValue();var d=String(b).split(",");if(b.length>10){showMessage(ValidationErrorMsgOnLayoutFieldSet);return}if(b==null||b==""||b.size<0){showMessage(lblSelectFieldsetMsg);return null}if(a.length>80){showMessage(nameLengthValidationLbl);return null}document.getElementById("saveButton").disabled=true;var c=String(b);save(a,c,selectedlayoutId,isDynamicRenderingEnabled);isDataChanged="false";setDynamicRenderingCheckboxDisable(false)}function enableSaveBtn(){document.getElementById("saveButton").disabled=false}function reloadItemSelector(){setAvailableData();itemSel.bindStore(dataStore);setSelectedData();eval(hiddenSelectedStore);if(selctedFieledSet!="undefined"){var fieldSetString=String(selctedFieledSet);var itemselValues=fieldSetString.split(",");Ext.getCmp("itemSelector").setValue(itemselValues)}else{Ext.getCmp("itemSelector").setValue()}Ext.getCmp("layoutNameTXT").setValue(Ext.String.htmlDecode(selectedLayoutName));var dynRenderingDiv=document.getElementById("layoutDynamicRendering");var dynRenderingChbx=document.getElementById("enableDynamincRendering");var LayouytNm=Ext.getCmp("layoutNameTXT").getValue().trim();if((Objectname=="SelfService"||Objectname=="SR"||Objectname=="Incident")&&typeof(dynRenderingDiv)!="undefined"&&dynRenderingDiv!=null){dynRenderingDiv.setAttribute("style","display:block;");if(isDynamicRenderingEnabled&&LayouytNm!=null&&LayouytNm!=""){if(typeof(dynRenderingChbx)!="undefined"&&dynRenderingChbx!=null){dynRenderingChbx.checked=true}}else{if(typeof(dynRenderingChbx)!="undefined"&&dynRenderingChbx!=null){dynRenderingChbx.checked=false}}enableDisableTheLink(dynRenderingChbx)}}function getSelectedValues(){selectedValuesTobeSaved="";var a=Object.getOwnPropertyNames(itemSel.getValue());for(var b in a){if(!isNaN(b)&&(typeof itemSel.getValue()[b]!="undefined")){selectedValuesTobeSaved+=itemSel.getValue()[b]+""}}return selectedValuesTobeSaved}function compareOldNewValue(){setSelectedData();eval(hiddenSelectedStore);getselecteItemselectot=itemSel.getValue();if(String(getselecteItemselectot).trim()!=String(selctedFieledSet).trim()){return true}else{if(selectedIdForCancel!=null&&selectedIdForCancel!=""&&Ext.getCmp("layoutNameTXT").getValue()!=Ext.String.htmlDecode(LayoutListGrid.getStore().getById(selectedIdForCancel).data.name.replace(/&nbsp;/g," "))){return true}else{return false}}}function newLayout(c){if(c){selectedIdForCancel=""}var a=compareOldNewValue();selectedIdForCancel="";if(a||isDataChanged=="true"){var d=Ext.MessageBox.confirm(lblLayout,warninMsgInRFLayoutPage,function(f){if(f==="yes"){selectedLayoutName="";var g=Ext.getCmp("layoutNameTXT");g.setValue("");g.setDisabled(false);selectedlayoutId="";LytPnlheader.setText(lblNewLayout);Ext.getCmp("layoutNameTXT").focus();reLoadFieldSet(selectedlayoutId);changeButtonStyle();isDataChanged="false"}});d.defaultButton=2;d.focus()}else{var e=document.getElementById("enableDynamincRendering");if((Objectname=="SelfService"||Objectname=="SR"||Objectname=="Incident")&&e){e.checked=false}selectedLayoutName="";var b=Ext.getCmp("layoutNameTXT");b.setValue("");b.setDisabled(false);selectedlayoutId="";LytPnlheader.setText(lblNewLayout);Ext.getCmp("layoutNameTXT").focus();reLoadFieldSet(selectedlayoutId);changeButtonStyle();isDataChanged="false"}setDynamicRenderingCheckboxDisable(true)}function cancelBtnHandler(){cancelButtonFunction(selectedlayoutId)}function cancelButtonFunction(b){var a=compareOldNewValue();if(a||isDataChanged=="true"){var c=Ext.MessageBox.confirm(lblLayout,warninMsgInRFLayoutPage,function(e){if(e==="yes"){reLoadFieldSet(b);var d=Ext.getCmp("layoutNameTXT");d.focus()}});c.defaultButton=2;c.focus()}}function deleteLayout(){if(selectedlayoutId==null||selectedlayoutId==""){showMessage(lblEnterNameMsg);return null}var a=Ext.MessageBox.confirm(lblLayout,lblConfirmDelete,function(b){if(b=="yes"){checkValidationDelete(selectedlayoutId)}});a.defaultButton=2;a.focus()}function showMessage(a){Ext.MessageBox.show({id:"commonmsgbox",title:lblLayout,msg:a,buttons:Ext.MessageBox.OK})}function createConfirmationBox(a){var b=Ext.MessageBox.confirm(lblLayout,a,function(c){if(c==="yes"){layoutDelete(selectedlayoutId)}else{reLoadFieldSet("")}});b.defaultButton=2;b.focus()}function showConfirmationBox(){switch(errormsg){case"Confirmation Box":createConfirmationBox(lblDeletionValidation);break;case"Multiple Layouts - Layout Delete Confirmation":createConfirmationBox(lblConfirmMultiLayoutDelete);break;case"Multiple Layouts - Default Layout Validation Error":Ext.Msg.baseCls="bmc-message";Ext.Msg.show({msg:defaultCheckLayoutMsg,title:lblLayout,cls:"rf-msg-cls",minWidth:300,minHeight:100,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR});break;default:if(selectedlayoutId!="0"){layoutDelete(selectedlayoutId)}}}function onlayoutSelect(b,a){selectedlayoutId=b;selectedIdForCancel=b;lblNametxt=Ext.getCmp("layoutNameTXT");a=a.replace(/&nbsp;/g," ");Ext.getCmp("layoutNameTXT").setValue(Ext.String.htmlDecode(a));textvalue=a;selectedLayoutName=a;if(selectedlayoutId==defaultLayoutName){document.getElementById("delButton").disabled=true;document.getElementById("delButton").style.color="grey"}else{document.getElementById("delButton").disabled=false;document.getElementById("delButton").style.color="black"}reLoadFieldSet(selectedlayoutId);LytPnlheader.setText(lblEditLayout);isDataChanged="false";setDynamicRenderingCheckboxDisable(false)}document.getElementById("delButton").disabled=true;document.getElementById("delButton").style.color="#808080";document.getElementById("newButton").style.color="black";function changeButtonStyle(){var a=LayoutListGrid.getSelectionModel();if(a!=null&&a!=""&&a!=undefined){a.deselectAll()}if(delButton!=null&&delButton!=""&&delButton!=undefined){delButton.disabled=true;delButton.style.color="grey"}}function TemplatePopup(){var c="ManagePage?manageId=Templates&paramId=ConsoleLayout&LayoutId="+selectedlayoutId+"&ModuleName="+Objectname;var d=assignTemplates+" "+selectedLayoutName;var a=530;var b=514;openPopupWithTitle(c,null,d,b,a)}function CategoryPopup(){var c="ManagePage?manageId=Categories&paramId=ConsoleLayout&LayoutId="+selectedlayoutId+"&ModuleName="+Objectname;var d=assignCategory+" "+selectedLayoutName;var a=550;var b=584;openPopupWithTitle(c,null,d,b,a)}function StatusPopup(){var c="ManagePage?manageId=Status&paramId=ConsoleLayout&LayoutId="+selectedlayoutId+"&ModuleName="+Objectname;var d=assignStatus+" "+selectedLayoutName;var a=530;var b=530;openPopupWithTitle(c,null,d,b,a)}function openPopupWithTitle(b,d,a,e,c){onCompleteFunction=d;logInWindow=new Ext.create("Ext.window.Window",{height:e,width:c,title:a,x:10,y:5,modal:true,resizable:false,bodyStyle:"background-color:#FFFFFF;",constrain:true,viewConfig:{forceFit:true},cls:"",frame:true,html:'<iframe frameborder="0" src ="/apex/'+b+'" style="width:100%;height:100%;border:none"/>'});logInWindow.show();logInWindow.center()}function enableDisableTheLink(d){var e=Ext.getCmp("gridId");var b=Ext.getCmp("layoutNameTXT").getValue().trim();if(e.getSelectionModel().hasSelection()){var f=e.getSelectionModel().getSelection()[0];var a=e.getSelectionModel().getSelection()[0].data.id}var c=document.getElementById("condtionsPageLink");if((typeof(a)!="undefined"&&a!=null&&a!="")||(b!=null&&b!="")){if(typeof(c)!="undefined"&&c!=null){if(typeof(d)!="undefined"&&d!=null&&d.checked){c.setAttribute("class","enabledLink");isDynamicRenderingEnabled=true}else{c.setAttribute("class","disabledLink");isDynamicRenderingEnabled=false}}}else{c.setAttribute("class","disabledLink");isDynamicRenderingEnabled=false}}function openConditionsPage(b){if(b&&b.getAttribute("class")!="disabledLink"){if(typeof(isDynamicRenderingEnabledDB)!="undefined"&&isDynamicRenderingEnabledDB!=null&&isDynamicRenderingEnabled!=isDynamicRenderingEnabledDB){var f=Ext.MessageBox.confirm(lblLayout,warninMsgInRFLayoutPage,function(j){if(j==="yes"){var i=Ext.getCmp("gridId");if(i.getSelectionModel().hasSelection()){var k=i.getSelectionModel().getSelection()[0];var g=i.getSelectionModel().getSelection()[0].data.id;var h=i.getSelectionModel().getSelection()[0].data.name}if(typeof(g)!="undefined"&&g!=null&&g!=""){parent.addNewTab("SSLayoutConditionsPage"+g,Conditionslbl+": "+h,"AdminSSLayoutConditions?layoutName="+g+"&Objectname="+Objectname,"false","666"+g,"false")}}});f.defaultButton=2;f.focus()}else{var d=Ext.getCmp("gridId");if(d.getSelectionModel().hasSelection()){var e=d.getSelectionModel().getSelection()[0];var a=d.getSelectionModel().getSelection()[0].data.id;var c=d.getSelectionModel().getSelection()[0].data.name}if(typeof(a)!="undefined"&&a!=null&&a!=""){parent.addNewTab("SSLayoutConditionsPage"+a,Conditionslbl+": "+c,"AdminSSLayoutConditions?layoutName="+a+"&Objectname="+Objectname,"false","666"+a,"false")}}}}function setDynamicRenderingCheckboxDisable(a){var b=document.getElementById("enableDynamincRendering");if(b){b.disabled=a}};