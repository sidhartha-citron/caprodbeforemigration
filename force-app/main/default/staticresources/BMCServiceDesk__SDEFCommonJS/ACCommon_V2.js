var toolbarItem,actionInfoArr,hideDevSummaryMenu=false,imagePath="",actionContext="",isFPUserValidated=false,ACFPLaunchWindowHeader="",reqContextId="",assemblyId="",renderedIn="",actionContextArr=["ConfigSummary","RemoteControl","FileSystem","Registry","Events","Processes","Services","PerformAudit","FileTransfer","Ping","Reboot","Shutdown","WakeUp"],listViewLabel="",selectedRowAssemlyId="",selectedrowCiId="",actionsFetchedFor="",fromStdLayout=false,selectCIerr="",noActionsAvail="",noDiscoveryActionsAvail="",acActionLabel="",acErrMsg="",deviceSummaryLabel="",objWindow=window.parent,msgStr="",firstclick=false;function getACMenu(){toolbarItem=new Ext.menu.Menu({id:"actionMenu",autoWidth:true,baseCls:"bmc-menu",showSeparator:false,plain:true,items:[{}],listeners:{show:function(b){if(renderedIn==listViewLabel||renderedIn==instanceEditor){toolbarItem.removeAll(true);if(typeof(assemblyId)!="undefined"&&assemblyId!=null&&assemblyId!=""&&typeof(reqContextId)!="undefined"&&reqContextId!=null&&reqContextId!=""){if(assemblyId.indexOf("AC:CS:-")==0){if(isFPUserValidated){callGetActionsInfo(true)}else{var a=ACFPLaunchWindowHeader;if(isDiscoveryEnabled){a=RFDisclaunchWindowHeader}openACPopupWithTitle("ACFPUserCredentialPage",callGetActionsInfo,a,Ext.isIE?242:228,530);popUpWindow.center()}}else{addNoActionsMenu()}}else{if((assemblyId==null||assemblyId=="")&&reqContextId!=""){addNoActionsMenu()}else{showAcErrMessage(selectCIerr)}}}}}});return toolbarItem}function callGetActionsInfo(a){if(a!=null&&a){isFPUserValidated=true;if(reqContextId!=actionsFetchedFor||(actionInfoArr!=null&&typeof(actionInfoArr)!="undefined"&&actionInfoArr.length==0)){showWaitMsgBar();firstclick=true;getActionInfoJSON(assemblyId)}else{firstclick=false;setActionsState()}}}function addNoActionsMenu(){var a=noActionsAvail;if(isDiscoveryEnabled){a=noDiscoveryActionsAvail}var b=new Ext.menu.Item({id:"noAcActionsMenu",icon:imagePath+"/SDEFimages/_.GIF",baseCls:"bmc-menu-item",overCls:"bmc-menu-item-over",disabled:true,text:a});toolbarItem.add(b)}function showAcErrMessage(b){var a=Ext.create("Ext.window.MessageBox");a.baseCls="bmc-notiltle-msg";a.show({width:300,title:errTitle,msg:b,icon:Ext.Msg.ERROR,buttons:Ext.MessageBox.OK})}function addACMenuItems(){var n="false";var f=0;f=getParentPageIndex();if(acVersion!=null&&acVersion!=""&&acVersion!="undefined"&&acVersion.toUpperCase()=="TRUE"&&f!=-1){n="true";var g="",h="";if(window.parent.truncatedName!=null&&window.parent.truncatedName!=""&&window.parent.truncatedName!="undefined"){h=window.parent.truncatedName}if(window.parent.strInstanceName!=null&&window.parent.strInstanceName!=""&&window.parent.strInstanceName!="undefined"){g=window.parent.strInstanceName}var j=DefaultMenuItem+g,m=DefaultMenuItem+h;var l=new Ext.menu.Item({id:"DefaultMenu",disabled:true,baseCls:"bmc-menu-item",overCls:"bmc-menu-item-over",text:m,listeners:{render:function(){new Ext.ToolTip({target:"DefaultMenu",anchor:"left",html:j})}}});toolbarItem.add(l)}if(actionInfoArr!=null&&typeof(actionInfoArr)!="undefined"&&actionInfoArr.length!=0){for(var b=0;b<actionContextArr.length;b++){if(renderedIn==deviceSummaryLabel&&actionContextArr[b]=="ConfigSummary"&&n!="true"){continue}if((renderedIn==listViewLabel||renderedIn==instanceEditor)&&(actionContextArr[b]=="RemoteControl"||actionContextArr[b]=="FileSystem"||actionContextArr[b]=="PerformAudit"||actionContextArr[b]=="Ping")){toolbarItem.add(new Ext.menu.Separator())}else{if(renderedIn==deviceSummaryLabel&&(actionContextArr[b]=="FileSystem"||actionContextArr[b]=="PerformAudit"||actionContextArr[b]=="Ping")){toolbarItem.add(new Ext.menu.Separator())}}var l=new Ext.menu.Item({id:actionContextArr[b],icon:imagePath+"/SDEFimages/_.GIF",baseCls:"bmc-menu-item",overCls:"bmc-menu-item-over",handler:function(){directConnectHandler(this)},listeners:{render:function(o){if(isDiscoveryEnabled){if(o.id!="ConfigSummary"&&DisableTabs&&o.disabled){var i=DisabledText;if(isAdminUser){i=i+" "+DiscoveryScannerCapability}new Ext.ToolTip({target:o.getEl(),anchor:"left",html:i})}}}}});toolbarItem.add(l)}}var k;var d=window.location.href;if(d.indexOf("apex/CMDBManager?")>0){k=""}else{k=String(window.parent)}var e=-1;if(typeof(k)!="undefined"&&k!=""){k=String(window.parent.location);e=k.indexOf("apex/AcActions")}if(n=="true"&&e!=-1){c=window.parent.incidentId;if(typeof(c)!="undefined"&&c!=""){var a,c;a=new Ext.menu.Item({id:"AdvAction",text:AdvActionLabel,listeners:{click:function(){var i=Ext.getCmp("AdvActionPanel");if(typeof(i)!="undefined"){i.expand()}},render:function(i){if(DisableTabs){i.setDisabled(true);new Ext.ToolTip({target:"AdvAction",anchor:"left",html:DisabledText})}else{if(typeof(showAdvanceTab)!="undefined"&&!showAdvanceTab){i.setDisabled(true)}else{i.setDisabled(false)}}}}});toolbarItem.add(a)}}}function setActionsState(){if(actionInfoArr!=null&&typeof(actionInfoArr)!="undefined"&&actionInfoArr.length!=0){addACMenuItems();if((renderedIn==listViewLabel||renderedIn==instanceEditor)&&acErrMsg==""){actionsFetchedFor=reqContextId}for(var d=0;d<actionInfoArr.length;d++){var g=actionInfoArr[d];var f=g.id;if(f=="File Trnasfer"){f="FileTransfer"}var c=g.isAvail;var b=g.label;var e=Ext.getCmp(f);if(e!=null&&typeof(e)!="undefined"&&e!="undefined"){if(c=="1"){e.setDisabled(false)}else{if(c=="0"){e.setDisabled(true)}}e.setText(b);if(DisableTabs&&e.disabled){var a=DisabledText;if(isAdminUser){a=a+" "+DiscoveryScannerCapability}new Ext.ToolTip({target:f,anchor:"left",html:a})}}}}if(renderedIn==instanceEditor&&firstclick){var h=Ext.getCmp("actionMenu");h.setPagePosition(h.getEl().lastXY[0]-120,h.getEl().lastXY[1])}}function ShowConfirmationMessageBox(b){if(b=="WakeUp"){msgStr=ACConfimMessageForWakeupDevice}else{if(b=="Reboot"){msgStr=ACConfimMessageForRebootDevice}else{if(b=="Shutdown"){msgStr=ACConfimMessageForShutdownDevice}}}if(msgStr!=""){var a=Ext.create("Ext.window.MessageBox");a.baseCls="bmc-message";a.show({msg:msgStr,width:300,title:strMessage,buttons:Ext.MessageBox.YESNO,buttonText:{yes:LabelYes,no:LabelNo},icon:Ext.Msg.WARNING,fn:function(c){if(c=="yes"){showWaitMsgBar();directConnectDevice(b,assemblyId,selectedBEId)}}});msgStr=""}}var ajaxPreRequisiteDone=false;function prerequisiteForAPIRequest(){$.ajaxTransport("+binary",function(a,c,b){if(window.FormData&&((a.dataType&&(a.dataType=="binary"))||(a.data&&((window.ArrayBuffer&&a.data instanceof ArrayBuffer)||(window.Blob&&a.data instanceof Blob))))){return{send:function(e,n){var o=new XMLHttpRequest(),d=a.url,k=a.type,f=a.async||true,l=a.responseType||"blob",j=a.data||null,h=a.username||null,m=a.password||null;o.addEventListener("load",function(){var i={};i[a.dataType]=o.response;n(o.status,o.statusText,i,o.getAllResponseHeaders())});o.open(k,d,f,h,m);for(var g in e){o.setRequestHeader(g,e[g])}o.responseType=l;o.send(j);ajaxPreRequisiteDone=true},abort:function(){b.abort()}}}})}function makeBCMActionAPIRequest(){if(!ajaxPreRequisiteDone){prerequisiteForAPIRequest()}var a=baseURL+"/ws/1/console/webstart";var b="";if(isManualOSSelectionEnabled&&osCookieVal&&osCookieVal!="undefined"){if(osCookieVal.toLowerCase()=="windows32"||osCookieVal.toLowerCase()=="windows64"){b="windows"}else{if(osCookieVal.toLowerCase()=="linux32"||osCookieVal.toLowerCase()=="linux64"){b="linux"}else{if(osCookieVal.toLowerCase()=="macos"){b="macos"}}}}if(b&&b!=""){a=a+"?os="+b}var c={type:"GET",url:a,responseType:"arraybuffer",dataType:"binary",processData:false,beforeSend:function(d){d.setRequestHeader("Session-Id",BCMBinaryResponse)},error:function(e,f,d){alert("Error : "+d);hideWaitMsg();hideWaitMsgBar()},success:function(i,h,n){var j=document.createElement("a");var e=n.getResponseHeader("content-disposition");var d="";if(e&&e.indexOf("attachment")!==-1){var f=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var k=f.exec(e);if(k!=null&&k[1]){d=k[1].replace(/['"]/g,"")}}var l=new Blob([i],{type:"application/octet-stream"});const g=window.URL.createObjectURL(l);var m=document.createElement("a");m.href=g;m.download=d;document.body.appendChild(m);m.click();document.body.removeChild(m);hideWaitMsg();hideWaitMsgBar()}};$.ajax(c)}function BCMBinaryOnComplete(){if(BCMBinaryResponse.indexOf("ERROR:404")!=-1){directConnectDevice(actionContext,assemblyId,reqContextId)}else{if(BCMBinaryResponse.indexOf("ERROR:")!=-1){this.GetMessageBox("bmc-message").show({title:_ServerValues.WarningTitle,msg:BCMBinaryResponse,width:300,closable:true,buttons:Ext.MessageBox.OK,fn:function(c,d,a){if(c=="ok"){}},icon:Ext.MessageBox.WARNING});hideWaitMsg();hideWaitMsgBar()}else{if(context.toLowerCase()!="sessionid"){var b=document.createElement("a");b.href="/sfc/servlet.shepherd/version/download/"+BCMBinaryResponse;document.body.appendChild(b);b.click();document.body.removeChild(b);hideWaitMsg();hideWaitMsgBar()}else{makeBCMActionAPIRequest()}}}}function directConnectHandler(b){actionContext=b.id;if(isFPUserValidated){executeDirectConnectAction(true)}else{var a=ACFPLaunchWindowHeader;if(isDiscoveryEnabled){a=RFDisclaunchWindowHeader}openACPopupWithTitle("ACFPUserCredentialPage",executeDirectConnectAction,a,Ext.isIE?240:228,530);popUpWindow.center()}}function getCurrentMachinesOS(){var b="";var a=window.navigator.platform.toLowerCase();if(a.indexOf("mac")>-1){b="macos"}else{if(a.indexOf("win")>-1){b="windows"}else{if(a.indexOf("linux")>-1){b="linux"}}}return b}function executeDirectConnectAction(a){if(a!=null&&a){isFPUserValidated=true;if(acVersion!=null&&acVersion!=""&&acVersion!="undefined"&&acVersion.toUpperCase()=="TRUE"){var g=0;g=getParentPageIndex();var h=1198,c=659;var e=parseInt((screen.availWidth/2)-(h/2));var b=parseInt((screen.availHeight/2)-(c/2));if((actionContext=="Services")||(actionContext=="Events")||(actionContext=="Processes")||(actionContext=="Registry")||(actionContext=="ConfigSummary")){if(g==-1){if(fromStdLayout){reqContextId=LinkedCiId}window.open("/apex/AcActions?assemblyId="+assemblyId+"&actionContext="+actionContext+"&selectedBEId="+reqContextId,"","status = 1, height ="+c+",width ="+h+",left="+e+",top="+b+", resizable = 1, scrollbars=no")}else{objWindow.addActionTab(actionContext,assemblyId,selectedBEId)}}else{if((actionContext=="WakeUp")||(actionContext=="Reboot")||(actionContext=="Shutdown")){if(g==-1){ShowConfirmationMessageBox(actionContext)}else{objWindow.ShowConfirmationMessageBox(actionContext)}}else{if(actionContext=="RemoteControl"||actionContext=="FileSystem"||actionContext=="FileTransfer"){if(g==-1){showWaitMsgBar();if(actionContext=="RemoteControl"){d="rcd"}else{if(actionContext=="FileSystem"){d="FileSystem"}else{d="FileTransfer"}}deviceId=assemblyId;var i="AC:CS:-";if(deviceId.indexOf(i)!=-1){deviceId=deviceId.substring(i.length,deviceId.length)}if(!makeAPICallsFromServer&&(isDiscoveryEnabled||(isACEnabled&&isACCertified))){context="SessionId"}else{context="CMDBAction"}var f="";if((makeAPICallsFromServer)||(isACEnabled&&!isACCertified)){f=getCurrentMachinesOS()}if(actionContext=="RemoteControl"){Visualforce.remoting.Manager.invokeAction(_RemotingActions.getWebConsoleUrl,assemblyId,actionContext,reqContextId,null,function(j,k){if(typeof j!=="object"){var j=JSON.parse(j)}if(j&&!j.acErrorCode&&j.responseBody&&j.responseBody!=""){var l=1000;var m=600;window.open(encodeURI(j.responseBody),"_blank","status = 1,height ="+m+",width ="+l+",left="+setScreenLeft(l)+",top="+setScreenTop(m)+", resizable = yes, scrollbars=yes");hideWaitMsg();hideWaitMsgBar()}else{getBinaryFileForBCMAction(deviceId,d,context,f,reqContextId)}},{escape:false})}else{getBinaryFileForBCMAction(deviceId,d,context,f,reqContextId)}}else{objWindow.parentdirectConnectHandler(actionContext)}}else{if(actionContext=="PerformAudit"||actionContext=="Ping"){if(g==-1){showWaitMsgBar();directConnectDevice(actionContext,assemblyId,reqContextId)}else{objWindow.parentdirectConnectHandler(actionContext)}}}}}}else{if(actionContext=="ConfigSummary"){openPopupforACFromExt4("ACDeviceSummaryPage?assemblyId="+assemblyId+"&reqContextId="+reqContextId,null,deviceSummaryLabel,700,750);acpopUpWindow.center()}else{showWaitMsgBar(1000);if(actionContext!="PerformAudit"){var d=actionContext;if(d=="RemoteControl"){d="rcd"}deviceId=assemblyId;var i="AC:CS:-";if(deviceId.indexOf(i)!=-1){deviceId=deviceId.substring(i.length,deviceId.length)}if(!makeAPICallsFromServer&&(isDiscoveryEnabled||(isACEnabled&&isACCertified))){context="SessionId"}else{context="CMDBAction"}var f="";if((makeAPICallsFromServer)||(isACEnabled&&!isACCertified)){f=getCurrentMachinesOS()}getBinaryFileForBCMAction(deviceId,d,context,f,reqContextId)}else{directConnectDevice(actionContext,assemblyId,reqContextId)}}}}}function getParentPageIndex(){var b=window.location.href;if(b.indexOf("apex/CMDBManager?")>0){return -1}var c=window.parent.location;var a=-1;if(c!=null&&c!=""&&c!="undefined"){c=String(c);a=c.indexOf("apex/AcActions?")}return a}acActionHandler=function(a,b){objWindow.acActionHandler(a,b)};function openACPopupWithTitle(c,e,a,f,d,b){onCompleteFunction=e;popUpWindow=new Ext.Window({layout:"fit",height:f,width:d,title:a,x:10,y:5,modal:true,resizable:false,bodyStyle:"background:#FFFFFF;",style:"padding: 0; border-width: 0;background:#FFFFFF;",constrain:true,viewConfig:{forceFit:true},cls:"LoginWindow",frame:true,animate:true,closable:false,html:'<iframe frameborder="0" name="iframeNameRequestDefinition" id="iframeIdRequestDefinition" src ="/apex/'+c+'" style="width:100%;height:100%;border:none"/>',tools:[{type:"rfclose",handler:function(i,h,g){popUpWindow.close()}}]});popUpWindow.show();return popUpWindow};