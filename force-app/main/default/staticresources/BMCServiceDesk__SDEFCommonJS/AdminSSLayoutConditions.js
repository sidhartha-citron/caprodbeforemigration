var selectedFldsArr=[];var logInWindow;var waitMask;var WinMsg;Ext.onReady(function(){var g=[{id:"Titlebar",baseCls:"",text:Conditionslbl+": "+layoutlabel,},"->",{text:"",tooltipType:"title",tooltip:helpLbl,iconCls:"d-icon-question_circle helpIconCls",overCls:"",pressedCls:"",focusCls:"",handler:function(){window.open(wikiUrl,false,"width="+screen.width+",height="+screen.height+",resizable=1,scrollbars=yes,status=1,top=0,left=0",false)}}];if(userLanguage=="iw"){g=g.reverse()}var c=Ext.create("Ext.toolbar.Toolbar",{title:"",cls:"mnuBarCls",id:"mnuBarId",renderTo:"tbar",height:30,items:g});var i=["->",{tooltipType:"title",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-small-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-small-pressed",scale:"medium",disabled:saveEnabled?false:true,id:"clearAllId",text:clearAllLbl,tooltip:clearAllLbl,handler:function(){var n=Ext.getCmp("mainFldGridId").getStore().getRange();for(var m=0;m<n.length;m++){var k=n[m].data.apiName;var l=document.getElementById(k+"Chbx");if(typeof(l)!="undefined"&&l!=null&&l.checked){l.checked=false;showDisplayIfLink(l,k)}}}},{xtype:"tbspacer",width:5},{tooltipType:"title",baseCls:"bmc-btn-primary",disabledCls:"bmc-btn-primary-disabled",focusCls:"bmc-btn-primary-focus",overCls:"bmc-btn-primary-over",pressedCls:"bmc-btn-primary-pressed",scale:"medium",disabled:saveEnabled?false:true,id:"saveId",text:saveToolTip,tooltip:saveToolTip,handler:function(){showLoadingMask();var y=Ext.getCmp("mainFldGridId").getStore().getRange();var C={};if(typeof(fldVSCondsMapJSON)!="undefined"&&fldVSCondsMapJSON!=null&&fldVSCondsMapJSON!=""){C=JSON.parse(fldVSCondsMapJSON)}var p={};var B={};for(var w=0;w<y.length;w++){var s=y[w].data.apiName;var z=y[w].data.recId;var x=y[w].data.fldType;var u=[];var n=y[w].data.advLogic;var A="false";var q=document.getElementById(s+"Chbx");var k=false;if(typeof(q)!="undefined"&&q!=null&&q.checked){k=true;A="true"}if(k&&(typeof(fldsAndCondtions)=="undefined"||fldsAndCondtions==null||!(s in fldsAndCondtions)||typeof(fldsAndCondtions[s])=="undefined"||fldsAndCondtions[s]==null)&&(typeof(C)=="undefined"||C==null||!(s in C)||typeof(C[s])=="undefined"||C[s]==null)){hideLoadingMask();showMessageBox(MinimumOneConditionRequired.replace("{0}","<b>"+y[w].data.fldLabel+"</b>"));return}if(k&&typeof(fldsAndCondtions[s])!="undefined"&&fldsAndCondtions[s]!=null){var o=fldsAndCondtions[s].Conditions;n=fldsAndCondtions[s].AdvRuleLogic;if(typeof(o)!="undefined"&&o!=null&&o.length>0){for(var v=0;v<o.length;v++){var t=o[v][7];var r={};r.OrderIndex=o[v][0];r.Operator=o[v][2];if(t.indexOf("reference")>-1){r.Operand=o[v][3]+EF+o[v][4]}else{r.Operand=o[v][3]}r.GroupingOperator=o[v][5];r.FieldInfo=o[v][6];r.FldType=t;u.push(r)}}}else{if(k&&typeof(C)!="undefined"&&C!=null&&typeof(C[s])!="undefined"&&C[s]!=null){var o=C[s];if(typeof(o)!="undefined"&&o!=null&&o.length>0){for(var v=0;v<o.length;v++){var t=o[v][7];var r={};r.OrderIndex=o[v][0];r.Operator=o[v][2];if(t.indexOf("reference")>-1){r.Operand=o[v][3]+EF+o[v][4]}else{r.Operand=o[v][3]}r.GroupingOperator=o[v][5];r.FieldInfo=o[v][6];r.FldType=t;u.push(r)}}}}if(k){p[s]={fldType:x,advLogic:n,dynDispEnabled:A}}if(typeof(u)!=null&&u!=null&&u.length>0){B[s]=u}}if(typeof(p)!="undefined"&&p!=null){var l=JSON.stringify(p);var m=JSON.stringify(B);saveFldsAndConditions(l,m)}}}];if(userLanguage=="iw"){i=i.reverse()}var c=Ext.create("Ext.toolbar.Toolbar",{title:"",id:"bottomBarId",renderTo:"bbar",width:200,height:30,items:i});var f=Ext.create("Ext.data.Store",{storeId:"fldStore",fields:["recId","apiName","DBRequired","fldLabel","dispfldType","fldType","advLogic","dynamicDisplay"]});var b=(ObjectName=="SelfService")?true:false;var e=[{text:"Record Id",dataIndex:"recId",hidden:true,sortable:false,menuDisabled:true,flex:1,height:30},{text:"Field Name",dataIndex:"apiName",hidden:true,sortable:false,menuDisabled:true,flex:1,height:30},{text:"DBRequired",dataIndex:"DBRequired",hidden:true,sortable:false,menuDisabled:true,flex:1,height:30},{text:FieldLabel,dataIndex:"fldLabel",hidden:false,sortable:b,menuDisabled:true,flex:0.2,renderer:function(m,l,k){if(m){if(k.data.DBRequired=="false"){m=Ext.String.htmlEncode(m)}else{m=Ext.String.htmlEncode(m)+'<span class = "isRequired">('+requiredLbl+")</span>"}}return m},height:30},{text:FieldType,dataIndex:"dispfldType",hidden:false,sortable:b,menuDisabled:true,flex:0.2,height:30},{text:FieldType,dataIndex:"fldType",hidden:true,sortable:b,menuDisabled:true,flex:1,height:30},{text:"Advanced Rule Logic",dataIndex:"advLogic",hidden:true,sortable:false,menuDisabled:true,flex:1,height:30},{text:dynamicDisplayLabel,dataIndex:"dynamicDisplay",hidden:false,sortable:false,menuDisabled:true,flex:0.6,height:30}];if(userLanguage=="iw"){e=e.reverse()}var j=Ext.getBody().getViewSize().height-130;var a=new Ext.grid.GridPanel({id:"mainFldGridId",store:f,columns:e,renderTo:"mainFieldsGridDivId",enableHdMenu:false,enableColumnResize:true,enableColumnMove:false,height:j,border:true,forceFit:true,tpl:'<tpl for="."><div class="x-boundlist-item">{[fm.htmlEncode(values.fldLabel)]}</div></tpl>',viewConfig:{forceFit:true,scrollOffset:0,focusRow:Ext.emptyFn},listeners:{cellclick:function(l,o,m,n){var k=l.getStore().getAt(o);var k=l.getStore().getAt(o)}}});var h=document.getElementById("mainFldGridId-body");if(userLanguage=="iw"&&h!=null&&h!=undefined){h.dir="ltr"}if(typeof(errorMsg)!="undefined"&&errorMsg!=null&&errorMsg!=""){showMessageBox(errorMsg)}else{if(typeof(fldData)!="undefined"&&fldData!=null&&fldData!=""){var d=JSON.parse(fldData);f.loadData(d)}}});function showDisplayIfLink(a,c){if(typeof(a)!="undefined"&&a!=null){var d=document.getElementById(c+"LinkDiv");var b=document.getElementById(c+"wrngIcon");if(typeof(d)!="undefined"&&d!=null){if(a.checked){d.setAttribute("style","display: block;");if(typeof(b)!="undefined"&&b!=null){b.setAttribute("style","display: block;")}selectedFldsArr.push(c);if(!saveEnabled){Ext.getCmp("saveId").enable();Ext.getCmp("clearAllId").enable()}}else{selectedFldsArr.splice(selectedFldsArr.indexOf(c),1);if(!saveEnabled&&selectedFldsArr.length<1){Ext.getCmp("saveId").disable();Ext.getCmp("clearAllId").disable()}d.setAttribute("style","display: none;");if(typeof(b)!="undefined"&&b!=null){b.setAttribute("style",'display: none;"')}}}}}function openCondPopup(a){var f=Ext.getCmp("mainFldGridId");var l=f.getSelectionModel();var g=l.getSelection();var k=f.getStore().indexOf(g[0]);var b=g[0].data.apiName;var c=Ext.util.Format.htmlEncode(g[0].data.fldLabel);var i="SSLayoutFldConditionsPage?layoutName="+layoutName+"&dynamicDispFor="+b+"&ObjectName="+ObjectName+"&selectedRowIndex="+encodeURI(k);var e=FieldConditions+" "+c;var j=850;var d=500;openPopupWithTitletemp(i,null,e,d,j)}function openPopupWithTitletemp(b,d,a,e,c){onCompleteFunction=d;logInWindow=new Ext.Window({height:e,width:c,title:a,x:10,y:5,modal:true,resizable:false,constrain:true,ghost:false,viewConfig:{forceFit:true},bodyStyle:"padding-top: 25px; padding-bottom:5px; background:#FFFFFF;",style:"padding: 0; border-width: 0;background:#FFFFFF;",closable:false,border:false,tools:[{type:"rfclose",handler:function(h,g,f){logInWindow.close()}}],cls:"RFAdminWindow",frame:true,html:'<iframe frameborder="0" src ="/apex/'+b+'" style="width:100%;height:100%;border:none"/>'});logInWindow.show();logInWindow.setPosition(300,100)}function receiveConditionsJSON(g,b,f){fldsAndCondtions[f]={Conditions:g,AdvRuleLogic:b};var d=document.getElementById(f+"condsCntDiv");if(d.hasChildNodes()){while(d.hasChildNodes()){d.removeChild(d.lastChild)}var a=noOfCondsLbl.replace("{0}",g.length);var c=document.createElement("label");var e=document.createTextNode(a);c.appendChild(e);d.appendChild(c)}}function saveComplete(){if(typeof(errorMsg)!="undefined"&&errorMsg!=null&&errorMsg!=""){hideLoadingMask();showMessageBox(errorMsg)}else{reloadGrid()}}function reloadComplete(){if(typeof(errorMsg)!="undefined"&&errorMsg!=null&&errorMsg!=""){hideLoadingMask();showMessageBox(errorMsg)}else{if(!saveEnabled){Ext.getCmp("saveId").disable();Ext.getCmp("clearAllId").disable()}if(typeof(fldData)!="undefined"&&fldData!=null&&fldData!=""){var b=JSON.parse(fldData);var a=Ext.getCmp("mainFldGridId");if(typeof(a)!="undefined"&&a!=null){var c=a.getStore();if(typeof(c)!="undefined"&&c!=null){c.loadData(b)}}}hideLoadingMask();ShowInlineSaveMessage("-580")}}function showLoadingMask(){waitMask=new Ext.LoadMask(Ext.getBody(),{floating:{shadow:false},msgCls:"d-loader-container",msg:'<ul class="d-loading"><li class="d-loading__stick d-loading__stick_1"></li><li class="d-loading__stick d-loading__stick_2"></li><li class="d-loading__stick d-loading__stick_3"></li><li class="d-loading__stick d-loading__stick_4"></li><li class="d-loading__stick d-loading__stick_5"></li><li class="d-loading__stick d-loading__stick_6"></li><li class="d-loading__stick d-loading__stick_7"></li><li class="d-loading__stick d-loading__stick_8"></li><li class="d-loading__stick d-loading__stick_9"></li><li class="d-loading__stick d-loading__stick_10"></li><li class="d-loading__stick d-loading__stick_11"></li><li class="d-loading__stick d-loading__stick_12"></li></ul><div>'+pleaseWaitLbl+"</div>"});if(typeof(waitMask)!="undefined"&&waitMask!=null&&waitMask!=""){waitMask.show()}}function hideLoadingMask(){if(typeof(waitMask)!="undefined"&&waitMask!=null&&waitMask!=""){waitMask.hide()}}function showMessageBox(a){if(WinMsg==null){WinMsg=Ext.create("Ext.window.MessageBox")}WinMsg.baseCls="bmc-message";WinMsg.show({title:"",msg:a,minWidth:300,minHeight:110,buttons:Ext.Msg.OK,})}function setSizeOnWindowResize(){try{var a=Ext.getBody().getViewSize().height-130;var c=Ext.getCmp("mainFldGridId");if(c){c.setHeight(a)}}catch(b){console.log(b)}}Ext.EventManager.onWindowResize(function(){setSizeOnWindowResize()});