var chatForClient=false;var chatInstanceId="";var chatLastMsgId=0;var hasAgentReply;var myChatMsgPrefix='<span class="myChatMsgPrefix">'+_ChatUserName+"</span>: ";var chatStatus="";var interval;var clientName="";var staffName="";var assignedDate="";var initChatMsg="";var ChatTitle="";var SettingPreChat="";var SettingDefaultCat="";var OptionString="";var PreChatData=new Array();var ChatCategories=new Array();var createDM1,createDM2,createDivA,createDivB,createDivC;var lastMsgSender="";var displayUserNamePrefix=true;var blinking=false;var clientRefreshing=false;var hasChatStarted=false;var RFCHATMESSAGES={};RFCHATMESSAGES.AttachmentIdentifier="CHAT_ATTACHMENT";RFCHATMESSAGES.DeletedAttachmentIdentifier="CHAT_ATTACHMENT_DELETED";RFCHATMESSAGES.ChatSuccess="CHAT_SUCCESS";RFCHATMESSAGES.ChatEnd="CHAT_END";var minimizeFlag=false;function chat(c,b,a){chatForClient=b;ChatTitle=c;hasAgentReply=true;clientRefreshing=a;if(chatForClient&&!clientRefreshing){checkPreChatSetting()}else{createChatBox(c)}}function checkPreChatSetting(){Visualforce.remoting.Manager.invokeAction(_ChatRemotingActions.checkPreChatSetting,function(a,b){if(b.type!="exception"){SettingPreChat=a[1];SettingDefaultCat=a[2];keyMap=JSON.parse(a[0]);if(SettingPreChat=="true"){PreparePreChatData()}else{createChatBox(ChatTitle)}}},{escape:false})}function PreparePreChatData(){if(keyMap!=null&&keyMap.length>0){for(var a=0;a<keyMap.length;a++){ChatCategories[a]=new Array(2);ChatCategories[a][0]=keyMap[a].Name;ChatCategories[a][1]=keyMap[a].Id}}removeAllChildOfChatWindow();createPreChatForm(ChatTitle)}function createPreChatForm(o,k){var g=document.getElementById("chatWindow");var q="chatboxhead";g.style.display="none";if(g){if(chatForClient==true){q="chatThemeHeader"}var a=document.createElement("a");a.setAttribute("title",closeLabel);a.setAttribute("href","javascript:void(0)");a.setAttribute("onclick","showConfirmBox();");a.setAttribute("class","chat_endchaticon");var l=document.createElement("div");l.setAttribute("class","chatboxoptions");l.setAttribute("id","chatboxoptions");l.appendChild(a);var n=document.createElement("div");n.setAttribute("class","chatboxtitle");n.setAttribute("id","chatboxtitle");var j=document.createTextNode(ChatTitle);n.appendChild(j);n.appendChild(a);createDM1=document.createElement("div");if(typeof(chatForSS3)!="undefined"&&chatForSS3){createDM1.setAttribute("class","chatThemeHeader Branding-Title_bar-background_color Branding-Title_bar-Top_border_color")}else{createDM1.setAttribute("class","chatThemeHeader")}createDM1.appendChild(n);var t=document.createElement("br");createDM2=document.createElement("div");createDM2.setAttribute("class","chatboxcontent");createDM2.setAttribute("id","chatboxcontent");var e=document.createElement("label");e.setAttribute("class","preChatLabel");var f=document.createTextNode(SelectCategory);e.appendChild(f);var h=document.createElement("select");h.setAttribute("id","SetCat");h.setAttribute("class","selectclass");h.setAttribute("title",SelectCategoryToolTip);var p=document.getElementById("SetCat");for(var s=0;s<ChatCategories.length;s++){var m=document.createElement("option");m.text=ChatCategories[s][0];m.value=ChatCategories[s][1];h.appendChild(m)}if(SettingDefaultCat=="true"){var m=document.createElement("option");m.text=noneoftheaboveOption;m.value="";h.appendChild(m)}var c=document.createElement("label");c.setAttribute("class","preChatLabel");var d=document.createTextNode(EnterQuery);c.appendChild(d);c.appendChild(document.createTextNode(" *"));var v=document.createElement("textarea");v.setAttribute("class","msgboxtextarea");v.setAttribute("id","chatboxtextarea");v.setAttribute("maxlength","255");v.setAttribute("rows","3");v.setAttribute("title",DescribeYourIssueToolTip);var r=document.createElement("div");r.setAttribute("style","text-align:center");var u=document.createElement("button");u.setAttribute("class","SubmitBtnClass");u.setAttribute("id","SubmitId");u.setAttribute("onclick","SubmitPreChatData();");var b=document.createTextNode(startChat);u.appendChild(b);r.appendChild(u);createDM2.appendChild(document.createElement("br"));createDM2.appendChild(e);createDM2.appendChild(document.createElement("br"));createDM2.appendChild(h);createDM2.appendChild(document.createElement("br"));createDM2.appendChild(document.createElement("br"));createDM2.appendChild(c);createDM2.appendChild(document.createElement("br"));createDM2.appendChild(v);createDM2.appendChild(document.createElement("br"));createDM2.appendChild(document.createElement("br"));createDM2.appendChild(r);g.appendChild(createDM1);g.appendChild(createDM2);g.style.display="block";g.style.height="270px";g.style.right="20px";displayChatHeader(false)}}function SubmitPreChatData(){var a=document.getElementById("chatboxtextarea").value;if(ValidateChatMessage(a)){var d="";var c=document.getElementById("SetCat").value;for(var b=0;b<ChatCategories.length;b++){if(c==ChatCategories[b][1]){d=ChatCategories[b][0];break}}PreChatData[0]=c;PreChatData[1]=d;PreChatData[2]=a;var e=document.getElementById("chatWindow");createChatBox(ChatTitle)}else{alert(EnterQuery)}}function ValidateChatMessage(a){if(a!=null&&a!="undefined"&&a!=""){var b=a;b.replace(/\n/g,"");if((b.trim()).length==0){return false}return true}else{return false}}function createChatBox(s,l){var e=document.getElementById("chatWindow");e.style.display="none";e.style.height="";removeAllChildOfChatWindow();if(e){if(chatForClient==true){e.style.right="20px";var b=document.createElement("a");b.setAttribute("title",closeLabel);b.setAttribute("href","javascript:void(0)");b.setAttribute("onclick","showConfirmBox();");b.setAttribute("class","chat_endchaticon");var n=document.createElement("div");n.setAttribute("class","chatboxtitle");n.setAttribute("id","chatboxtitle");var h=document.createTextNode(ChatTitle);n.appendChild(h);n.appendChild(b);createDivA=document.createElement("div");if(typeof(chatForSS3)!="undefined"&&chatForSS3){createDivA.setAttribute("class","chatThemeHeader Branding-Title_bar-background_color Branding-Title_bar-Top_border_color")}else{createDivA.setAttribute("class","chatThemeHeader")}createDivA.appendChild(n);createDivB=document.createElement("div");createDivB.setAttribute("class","chatboxcontent");createDivB.setAttribute("id","chatboxcontent");var t=document.createElement("textarea");t.setAttribute("class","chatboxtextarea");t.setAttribute("id","chatboxtextarea");t.setAttribute("onkeydown","javascript:return checkChatBoxInputKey(event,this,ChatTitle);");t.setAttribute("onclick","stopblinkColor();");t.setAttribute("maxlength","255");t.setAttribute("rows","3");t.setAttribute("placeholder",textPlaceholder);var p=document.createElement("img");p.setAttribute("src",attachmentImg);p.setAttribute("title",AttachIconTooltip);p.setAttribute("class","attachmentImgCls");p.setAttribute("onclick","addChatAttachments();");p.setAttribute("id","attachmentIconId");p.disabled=false;var q=document.createElement("div");q.setAttribute("class","chatboxinput");q.setAttribute("id","chatboxinput");q.appendChild(t);q.appendChild(p);e.appendChild(createDivA);e.appendChild(createDivB);e.appendChild(q)}else{e.style.right="257px";var o=document.createElement("div");o.setAttribute("class","endchatinfo");o.setAttribute("id","chat_endchattext");var j=document.createTextNode(endChatMsg);o.appendChild(j);var m=document.createElement("div");m.setAttribute("class","endchatdiv");m.setAttribute("id","chat_enndchatdiv");var g=document.createElement("button");g.setAttribute("class","createIncidentBtn");g.setAttribute("id","chat_inccreate");g.setAttribute("onclick","createIncident();");var c=document.createTextNode(endChatCreateIncidentMsg);g.appendChild(c);var u=document.createElement("div");u.setAttribute("style","text-align:center");var d=document.createElement("button");d.setAttribute("class","linkIncidentBtn");d.setAttribute("id","chat_inclink");d.setAttribute("onclick","linkIncident();");var c=document.createTextNode(endChatLinkIncident);d.appendChild(c);u.appendChild(g);u.appendChild(d);var f=document.createElement("div");f.setAttribute("class","chatoptions");f.setAttribute("id","chat_options");f.setAttribute("style","display:none;");f.appendChild(o);f.appendChild(m);f.appendChild(u);var a=document.createElement("a");a.setAttribute("title",closeLabel);a.setAttribute("id","chat_endchat");a.setAttribute("class","chat_endchaticon");a.setAttribute("onclick","toggleChatOptionDisplay();");var b=document.createElement("a");b.setAttribute("title","Minimize");b.setAttribute("class","minimize-icon");b.setAttribute("id","minimize-icon");b.setAttribute("onclick","minimizeWindow();");var k=document.createElement("div");k.setAttribute("class","chatboxtitle");k.setAttribute("id","chatboxtitle");k.setAttribute("onclick","changeWindowStatus();");var h=document.createTextNode(ChatTitle);k.appendChild(h);k.appendChild(a);k.appendChild(b);var x=document.createElement("div");x.setAttribute("class","chatboxhead");x.appendChild(k);x.appendChild(f);var w=document.createElement("div");w.setAttribute("class","chatboxcontent");w.setAttribute("id","chatboxcontent");var r=document.createElement("textarea");r.setAttribute("class","chatboxtextarea");r.setAttribute("id","chatboxtextarea");r.setAttribute("onkeydown","javascript:return checkChatBoxInputKey(event,this,ChatTitle);");r.setAttribute("onclick","stopblinkColor();");r.setAttribute("maxlength","255");r.setAttribute("rows","3");r.setAttribute("placeholder",textPlaceholder);var v=document.createElement("div");v.setAttribute("class","chatboxinput");v.setAttribute("id","chatboxinput");v.appendChild(r);e.appendChild(x);e.appendChild(w);e.appendChild(v)}e.style.display="block"}if(chatForClient&&!clientRefreshing){displayChatHeader(false);initiateChat(PreChatData)}else{if(!chatForClient){blinkColor();initChatMsg=clientStartedMessage.replace("{0}",clientName);addNotification(initChatMsg)}else{if(chatForClient&&clientRefreshing){displayChatHeader(false);removeChildNodesOfMainDiv();addChatMessage(staffName,assignedDate,"usermsgprefix","usermsgprefix");createMessageDivforChat(defaultChatMessage,false)}}}}function createMessageDivforChat(e,d){var c=document.getElementById("chatboxcontent");var a=document.createElement("div");if(d){a.style.paddingBottom="5px"}else{a.className="chatmsg"}var b=document.createTextNode(e);a.appendChild(b);c.appendChild(a);c.scrollTop=c.scrollHeight}function removeChildNodesOfMainDiv(){var a=document.getElementById("chatboxcontent");if(a.hasChildNodes()){while(a.hasChildNodes()){a.removeChild(a.lastChild)}}}function removeAllChildOfChatWindow(){var a=document.getElementById("chatWindow");while(a.hasChildNodes()){a.removeChild(a.lastChild)}a.style.display="none"}function sendMessage(a){if(chatLastMsgId==-1){chatLastMsgId=0}Visualforce.remoting.Manager.invokeAction(_ChatRemotingActions.sendMessage,a,chatInstanceId,function(c,e){if(e.status){if(c!=""&&c!=null){var d=c.split(String.fromCharCode(1087));if(d[0]!=RFCHATMESSAGES.ChatSuccess){if(d[0]==RFCHATMESSAGES.ChatEnd){addNotification(chatEndedMsg);if(chatForClient){var b=document.getElementById("chatboxtextarea");b.disabled=true}}}else{if(hasAgentReply){addChatMessage(_ChatUserName,d[1],"myChatMsgPrefix","myChatMsgPrefix");hasAgentReply=false}createMessageDivforChat(a,true)}}}else{if(e.type==="exception"){}}},{escape:false})}function checkChatBoxInputKey(b,a,c){if(b.keyCode!=null){if(blinking){stopblinkColor()}}if(b.keyCode==13&&b.shiftKey==0){message=a.value;a.value="";a.focus();if(message!=""){sendMessage(message);lastMsgSender=_ChatUserId}return false}}var closeButtonClicked=false;function toggleChatOptionDisplay(){var a=document.getElementById("chat_options");if(a!=null&&a!=undefined&&a!="undefined"){if(a.style.display=="none"){displayChatOptions(true)}else{displayChatOptions(false)}}closeButtonClicked=true}var minimizeButtonClicked=false;function minimizeWindow(a){var d=document.getElementById("chatboxcontent");d.style.display="none";var c=document.getElementById("chatboxtextarea");c.style.display="none";var b=document.getElementById("chatboxinput");b.style.display="none";if(a){minimizeButtonClicked=false}else{minimizeButtonClicked=true}}function changeWindowStatus(){if(minimizeButtonClicked){minimizeButtonClicked=false;return}if(closeButtonClicked){closeButtonClicked=false;return}var c=document.getElementById("chatboxcontent");var b=document.getElementById("chatboxtextarea");var a=document.getElementById("chatboxinput");if(minimizeFlag){c.style.display="none";b.style.display="none";a.style.display="none"}else{c.style.display="block";b.style.display="block";a.style.display="block"}minimizeFlag=!minimizeFlag}function displayChatOptions(c){var e=document.getElementById("chat_options");var d=document.getElementById("chatboxcontent");var b=document.getElementById("chatboxtextarea");var a=document.getElementById("chatboxinput");if(e!=null&&e!=undefined&&e!="undefined"&&d!=null&&d!=undefined&&d!="undefined"){if(c==true){e.style.display="block";d.style.height="235px";b.style.display="block";a.style.display="block"}else{e.style.display="none";d.style.height="300px"}}}function createIncident(){lastMsgSender="";displayChatOptions(false);ChatAction_Remote(chatInstanceId,false);chatLastMsgId=0;removeAllChildOfChatWindow()}function linkIncident(){openPopupForIncident()}function showConfirmBox(){if(!chatForClient){displayChatOptions(true)}else{if(chatInstanceId!=""&&hasChatStarted){Ext.MessageBox.show({title:closeLabel,msg:closeConfirmationMsg,buttonText:{yes:yesMsg,no:noMsg},fn:function(a){if(a==="yes"){document.getElementById("chatWindow").style.display="none";stopPolling();if(chatInstanceId!=""){ChatActionClient_Remote(chatInstanceId)}}}})}else{if(chatInstanceId!=""&&!hasChatStarted){document.getElementById("chatWindow").style.display="none";ChatActionClient_Remote(chatInstanceId)}else{displayChatHeader(true);removeAllChildOfChatWindow()}}}}function stopPolling(){if(interval){clearInterval(interval)}}function displayChatHeader(a){if(a==true){document.getElementById("startChat").style.display="block"}else{document.getElementById("startChat").style.display="none"}}function getMessage(){Visualforce.remoting.Manager.invokeAction(_ChatRemotingActions.pollMessages,chatInstanceId,chatLastMsgId,function(a,c){if(c.status){if(a!=""&&a!=null){if(a.length>=2){chatStatus=a[2];if(chatStatus!=""&&chatStatus==RFCHATMESSAGES.ChatEnd){endChat()}else{if(a[0]!=""){if(!blinking){blinkColor()}var b=a[0].replace(/\\/g,"\\\\");displayChatMessages(JSON.parse(b));hasAgentReply=true}}chatLastMsgId=a[1]}}}else{if(c.type==="exception"){}}},{escape:false})}function displayChatMessages(m){strMsg="";var f=false;var r=new Array();var b="usermsgprefix";if(m.length>0){for(i=0;i<m.length;i++){if(m[i].Message__c.indexOf(RFCHATMESSAGES.AttachmentIdentifier)!=-1||m[i].Message__c.indexOf(RFCHATMESSAGES.DeletedAttachmentIdentifier)!=-1){r.push(i)}}}for(index=0;index<m.length;index++){if(CheckArrayContains(r,index)){var j=m[index].Message__c.split(":: ");if(chatForClient){addChatMessage(_ChatUserName,m[index].CreatedDate,"myChatMsgPrefix",b)}else{addChatMessage(clientName,m[index].CreatedDate,"usermsgprefix",b)}addAttachmentNotification(j);displayUserNamePrefix=true}else{if(m[index].Message__c==chatEndedMsg){endChat();break}else{var s=document.createElement("div");b=(_ChatUserId==m[index].FKSender__c)?"myChatMsgPrefix":"usermsgprefix";if(lastMsgSender!=m[index].FKSender__c||lastMsgSender==""){displayUserNamePrefix=true}if(displayUserNamePrefix){addChatMessage(m[index].Sender_Name,m[index].CreatedDate,b,b);displayUserNamePrefix=false;lastMsgSender=m[index].FKSender__c}var g=false;var c=document.getElementById("chatboxcontent");var d=urlify(m[index].Message__c);d=d.replace(/\\&quot;/g,'"');d=d.replace(/\\'/g,"'");d=d.replace(/&lt;/g,"<");d=d.replace(/&gt;/g,">");d=d.replace(/&amp;/g,"&");d=d.replace(/\\n\r?/g,String.fromCharCode(172));var k=document.createElement("div");k.style.paddingBottom="5px";var e=document.createElement("span");e.style.color="red";var q=document.createTextNode(" x");e.appendChild(q);if(d.indexOf("<a")!=-1&&d.indexOf("</a>")!=-1){g=true;var p=document.createElement("a");d=d.substring(d.indexOf('">')+2,d.indexOf("</a>"));p.setAttribute("href",d);p.setAttribute("target","_blank");s=document.createTextNode(d);p.appendChild(s);if(chatStatus=="offline"||chatStatus=="away"){p.appendChild(e)}k.appendChild(p)}else{var o=d.split(String.fromCharCode(172));var a;var l;var h;d="";for(var n=0;n<o.length;n++){a=o[n];if(typeof a!="undefined"){l=document.createTextNode(a)}h=document.createElement("br");if(typeof l!="undefined"&&typeof h!="undefined"&&typeof s!="undefined"){s.appendChild(l);if(o.length==n+1&&(chatStatus=="offline"||chatStatus=="away")){s.appendChild(e)}s.appendChild(h)}}k.appendChild(s)}c.appendChild(k);c.scrollTop=c.scrollHeight}}}}function endChat(){addNotification(chatEndedMsg);stopPolling();disableAttachmentArea();hasChatStarted=false}function initiateChat(c){chatWindow.style.display="block";chatWindow.style.height="270px";var b=document.getElementById("chatboxcontent");removeChildNodesOfMainDiv();var d=document.createElement("div");d.setAttribute("class","waitingMsg");d.appendChild(document.createTextNode(waitMsg));b.appendChild(d);var a=document.getElementById("chatboxtextarea");a.disabled=true;hasChatStarted=false;c[3]=chatInstanceId;Visualforce.remoting.Manager.invokeAction(_ChatRemotingActions.initiateChat,c,function(e,h){if(h.status){if(e!=""&&e!=null){var k=e.split(String.fromCharCode(1087));chatData=JSON.parse(k[0]);chatInstanceId=chatData.Id;chatLastMsgId=0;if(chatData.FKStaff__c!=null&&chatData.FKStaff__c!=""&&chatData.FKStaff__c!="undefined"&&chatData.FKStaff__r.Name!="undefined"&&chatData.FKStaff__r.Name!=null){a.disabled=false;hasChatStarted=true;chatWindow.style.height="";var g=document.getElementById("chatboxcontent");removeChildNodesOfMainDiv();addChatMessage(chatData.FKStaff__r.Name,k[1],"usermsgprefix","usermsgprefix");createMessageDivforChat(defaultChatMessage,false);if(chatInstanceId!=undefined&&chatInstanceId!=""){interval=setInterval(getMessage,5000)}if(c!=null&&c.length>1&&c[2]!=""&&c[2]!=null&&SettingPreChat=="true"){lastMsgSender=_ChatUserId;addChatMessage(_ChatUserName,k[1],"myChatMsgPrefix","myChatMsgPrefix");createMessageDivforChat(c[2],false);hasAgentReply=false}}else{g=document.getElementById("chatboxcontent");removeChildNodesOfMainDiv();var f=document.createElement("div");f.setAttribute("class","waitingMsg");f.appendChild(document.createTextNode(noAgentsAvailableMsg));var j=document.createElement("button");j.appendChild(document.createTextNode(TryAgain));j.setAttribute("id","TryId");j.setAttribute("class","Try");j.setAttribute("onclick","SetValueForTryAgain();");g.appendChild(f);g.appendChild(j)}}}else{if(h.type==="exception"){console.log(h.message)}}},{escape:false})}function SetValueForTryAgain(){if(SettingPreChat=="true"){initiateChat(PreChatData)}else{PreChatData[0]="";PreChatData[1]="";PreChatData[2]="";initiateChat(PreChatData)}}function addChatMessage(m,f,b,j){var d=document.getElementById("chatboxcontent");var c=document.createElement("div");c.className="chatmsg";var a=document.createElement("table");a.setAttribute("width","100%");a.setAttribute("border","0");a.setAttribute("cellpadding","0px");a.setAttribute("cellspacing","0px");a.style.marginBottom="-5px";a.style.marginTop="8px";var l=document.createElement("tr");var g=document.createElement("td");g.setAttribute("width","80%");g.className=b;var h=document.createTextNode(m);var e=document.createElement("td");e.setAttribute("width","20%");e.setAttribute("align","right");e.style.paddingRight="1px";e.className=j;var k=document.createTextNode(f);e.appendChild(k);g.appendChild(h);l.appendChild(g);l.appendChild(e);a.appendChild(l);c.appendChild(a);d.appendChild(c);d.scrollTop=d.scrollHeight}function addNotification(d){var a=document.getElementById("chatboxcontent");if(a!=null&&a!="undefined"){var c=document.createElement("div");if(chatForClient){c.setAttribute("class","chatmsg notificationDivSS")}else{c.setAttribute("class","chatmsg notificationDiv")}var b=document.createElement("span");b.setAttribute("class","notification");b.appendChild(document.createTextNode(d));c.appendChild(b);a.appendChild(c);a.scrollTop=a.scrollHeight}}function addAttachmentNotification(e){var a=document.getElementById("chatboxcontent");var c=document.createElement("div");if(chatForClient){c.setAttribute("class","chatmsg notificationDivSS")}else{c.setAttribute("class","chatmsg notificationDiv")}var b=document.createElement("span");b.setAttribute("class","notification");if(e[0]!=null&&e[0]!=undefined&&e[0]!=""&&e[0]==RFCHATMESSAGES.AttachmentIdentifier){b.appendChild(document.createTextNode(attachmentAddedMsg))}else{b.appendChild(document.createTextNode(attachmentDeletedMsg));b.appendChild(document.createElement("br"));b.appendChild(document.createTextNode(e[2]))}c.appendChild(b);c.appendChild(document.createElement("br"));if(e[0]!=null&&e[0]!=undefined&&e[0]!=""&&e[0]==RFCHATMESSAGES.AttachmentIdentifier){if(e[1]!=null&&e[1]!=undefined&&e[1]!=""&&e[2]!=null&&e[2]!=undefined&&e[1]!=""){var d=e[1];var f=document.createElement("a");f.setAttribute("class","attachmentUrlCls");f.setAttribute("target","_blank");if(d.substring(0,3)=="069"){f.setAttribute("href","/"+d)}else{f.setAttribute("href","/servlet/servlet.FileDownload?file="+d)}f.appendChild(document.createTextNode(e[2]));c.appendChild(f)}}a.appendChild(c);a.scrollTop=a.scrollHeight}function addChatAttachments(){if(document.getElementById("attachmentIconId").disabled==false){var c=parseInt((screen.availWidth/2)-(670/2));var a=parseInt((screen.availHeight/2)-(480/2));var b=window.open(ChatAttachmentPage+"?parentId="+chatInstanceId+"&isChatAttachment=true","ChatAttachments","status=1,height=450,width=950,left="+c+",top="+a+",resizable=0,scrollbars=no");b.focus()}}function urlify(d){var b=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim;d=d.replace(b,'<a target="_blank" href="$&">$&</a>');var c=/(^|[^\/])(www\.[\S]+(\b|$))/gim;d=d.replace(c,'$1<a target="_blank" href="http://$2">$2</a>');var a=/\w+@[a-zA-Z_]+?(?:\.[a-zA-Z]{2,6})+/gim;d=d.replace(a,'<a href="mailto:$&">$&</a>');return d}function CheckArrayContains(b,c){var a=false;for(var d=0;d<b.length;d++){if(b[d]==c){a=true;break}}return a}function ChatActionClient_Remote(a){Visualforce.remoting.Manager.invokeAction(_ChatRemotingActions.ChatAction,a,true,function(b,c){if(c.status){if(b!=""){chatInstanceId="";displayChatHeader(true);removeAllChildOfChatWindow()}}},{escape:true})}var timeout;function blinkColor(){var a=document.getElementById("chatboxtitle");if(a!=null&&typeof(a)!="undefined"){a.style.opacity=0.25;timeout=setTimeout("setblinkColor()",500);blinking=true}}function setblinkColor(){var a=document.getElementById("chatboxtitle");if(a!=null&&typeof(a)!="undefined"){a.style.opacity=1;timeout=setTimeout("blinkColor()",500);blinking=true}}function stopblinkColor(){var a=document.getElementById("chatboxtitle");if(a!=null&&typeof(a)!="undefined"){a.style.opacity=1;clearTimeout(timeout);blinking=false}}function disableAttachmentArea(){var a=document.getElementById("chatboxtextarea");if(a!=null){a.setAttribute("class","chatboxtextareaForDisabledDiv");a.disabled=true}var c=document.getElementById("attachmentIconId");if(c!=null){c.disabled=true;c.setAttribute("src",disabledattachmentImg);c.setAttribute("class","attachmentImgClsForDisabledDiv");c.setAttribute("title","")}var b=document.getElementById("chatboxinput");if(b!=null&&typeof(b)!="undefined"){b.setAttribute("class","chatboxinputForDisabledDiv")}};