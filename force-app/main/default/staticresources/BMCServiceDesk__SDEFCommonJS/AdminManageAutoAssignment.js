var qStore;var qPanel;var staffStore,staffGridPanel,businessHrsCheckbox,selectBusinessHrsCombo;var selectedQueueId,isConfigChanged=false;Ext.require(["Ext.ux.CheckColumn"]);function handleStaffAssignmentSelection(a){autoStaffAssignmentEventVal=a}Ext.onReady(function(){Ext.tip.QuickTipManager.init();Ext.apply(Ext.tip.QuickTipManager.getQuickTip(),{maxWidth:500,trackMouse:true});Ext.define("qModel",{extend:"Ext.data.Model",fields:[{name:"qId",type:"string"},{name:"qName",type:"string"}]});qStore=Ext.create("Ext.data.Store",{id:"qStoreId",model:"qModel",data:qlist,autoLoad:false});var c=new Ext.Panel({id:"mainToolbarPanelId",border:false,tbar:[{scale:"medium",iconCls:"saveCls",tooltipType:"title",tooltip:saveLbl,id:"saveBtn",handler:saveConfigHandler}],autoWidth:true,renderTo:"toolbarDiv"});qGridPanel=Ext.create("Ext.grid.Panel",{id:"qGridPanelId",renderTo:"qDiv",border:false,store:qStore,emptyText:noRecordsFoundLbl,autoScroll:true,height:515,width:280,cls:"gridPanelCls",forceFit:true,columns:[{id:"qName",text:queueLbl,dataIndex:"qName",cls:"columnCls",menuDisabled:true,}],listeners:{viewready:function(f){var d=f.view;f.mon(d,{uievent:function(k,h,g,i,j,l){f.cellIndex=j;f.recordIndex=i}});f.tip=Ext.create("Ext.tip.ToolTip",{target:d.el,delegate:".x-grid-cell",trackMouse:true,renderTo:Ext.getBody(),listeners:{beforeshow:function e(g){if(!Ext.isEmpty(f.cellIndex)&&f.cellIndex!==-1){header=f.headerCt.getGridColumns()[f.cellIndex];g.update(f.getStore().getAt(f.recordIndex).get(header.dataIndex))}}}})}}});qStore.loadData(qlist);if(!isNoQueueFound){qGridPanel.on("cellclick",function(e,f,k,d,h,j,i){staffStore.clearFilter();if(isConfigChanged){var g=Ext.Msg.show({title:staffAutoAssignmentLbl,msg:navigationWarningLbl,buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.WARNING,fn:function(l){if(l=="yes"){isConfigChanged=false;queueSelectionHandler(e,f,k,d,h,j,i)}else{var m=qGridPanel.store.findExact("qId",selectedQueueId);Ext.getCmp("qGridPanelId").getSelectionModel().select(m);return}}})}else{queueSelectionHandler(e,f,k,d,h,j,i)}});businessHrsCheckbox=new Ext.form.Checkbox({id:"businessHrsCheckboxId",cls:"checkboxClass",boxLabel:staffByBusinessHourLbl,checked:false,height:30});var b=new Ext.data.ArrayStore({id:"businessHrsStoreId",fields:[{name:"bHrsId",type:"string"},{name:"bHrsName",type:"string"},{name:"isDefault",type:"boolean"},{name:"tooltip",type:"string"}],data:bHrsList});selectBusinessHrsCombo=new Ext.form.ComboBox({id:"selectBusinessHrsComboId",fieldLabel:filterbyBHlbl,labelStyle:"width:135px",selectOnFocus:true,editable:false,triggerAction:"all",store:b,autoWidth:true,valueField:"bHrsId",displayField:"bHrsName",mode:"local",listConfig:{overflowX:"hidden",style:"white-space:nowrap",getInnerTpl:function(){return'<div data-qtip="{tooltip}" data->{bHrsName}</div>'}},listeners:{select:function(e,d){staffStore.clearFilter();if(d[0].get("bHrsName")=="--"+alllbl+"--"){staffStore.clearFilter()}else{staffStore.filterBy(function(f,g){if(d[0].get("isDefault")==true){if(f.get("bHrsId").indexOf(d[0].get("bHrsId"))>-1||f.get("bHrsId")==""){return true}}else{if(f.get("bHrsId").indexOf(d[0].get("bHrsId"))>-1){return true}}})}}}});var a=new Ext.Panel({id:"bHrsPanelId",border:false,bodyStyle:"margin-bottom: 10px;",items:[businessHrsCheckbox,selectBusinessHrsCombo],width:450,renderTo:"bHrsDiv"});staffStore=Ext.create("Ext.data.Store",{storeId:"staffStoreId",fields:[{name:"autoAssign",type:"boolean"},{name:"staffId",type:"string"},{name:"staffName",type:"string"},{name:"bHrsName",type:"string"},{name:"bHrsId",type:"string"}],data:staffList});staffGridPanel=Ext.create("Ext.grid.Panel",{id:"staffGridPanelId",store:staffStore,border:false,emptyText:noRecordsFoundLbl,columns:[{xtype:"checkcolumn",sortable:false,text:'<input type="checkbox" id="selectAllChkBoxId" onclick="allAutoAssignHandler(this)" onchange="allAutoAssignHandler(this)"> '+autoAssignmentLbl,dataIndex:"autoAssign",width:90,cls:"columnCls",menuDisabled:true,listeners:{checkchange:function(h,i,g,f){isConfigChanged=true;var e=true;for(var d=0;d<staffStore.count();d++){if(!staffStore.getAt(d).get("autoAssign")){e=false;break}}document.getElementById("selectAllChkBoxId").checked=e}}},{text:staffLbl,dataIndex:"staffName",flex:1,cls:"columnCls",menuDisabled:true,sortable:true},{text:businessHrsLbl,dataIndex:"bHrsName",flex:1,cls:"columnCls",menuDisabled:true,sortable:true}],height:415,width:450,cls:"gridPanelCls",renderTo:"staffDiv",listeners:{viewready:function(f){var d=f.view;f.mon(d,{uievent:function(k,h,g,i,j,l){f.cellIndex=j;f.recordIndex=i}});f.tip=Ext.create("Ext.tip.ToolTip",{target:d.el,delegate:".x-grid-cell",trackMouse:true,renderTo:"staffDiv",maxWidth:500,listeners:{beforeshow:function e(g){if(f.cellIndex===0){return false}else{if(!Ext.isEmpty(f.cellIndex)&&f.cellIndex!==-1){header=f.headerCt.getGridColumns()[f.cellIndex];g.update(f.getStore().getAt(f.recordIndex).get(header.dataIndex))}}}}})}}});setElementValue(document.getElementById("headerLblId"),headerNoteLbl);setElementValue(document.getElementById("noteLblId"),("*"+noteLbl));Ext.getCmp("qGridPanelId").getSelectionModel().select(0);selectedQueueId=qStore.getAt(0).get("qId");setElementValue(document.getElementById("selectedQueueLblId"),(queueLbl+": "+RemedyForceHTMLProcessor.htmlDecoder(qStore.getAt(0).get("qName"))));populateStaffList(selectedQueueId);Ext.getCmp("selectBusinessHrsComboId").select("--"+alllbl+"--")}});function queueSelectionHandler(b,c,g,a,d,f,e){selectedQueueId=a.data.qId;setElementValue(document.getElementById("selectedQueueLblId"),(queueLbl+": "+RemedyForceHTMLProcessor.htmlDecoder(a.data.qName)));Ext.getCmp("selectBusinessHrsComboId").select("--"+alllbl+"--");document.getElementById("selectAllChkBoxId").checked=false;populateStaffList(selectedQueueId)}function refreshStaffList(a){document.getElementById("selectAllChkBoxId").disabled=isNoStaffFound;businessHrsCheckbox.setDisabled(isNoStaffFound);businessHrsCheckbox.setValue(a);Ext.getCmp("selectBusinessHrsComboId").setDisabled(isNoStaffFound);staffStore.removeAll(true);staffStore.loadData(staffList);staffGridPanel.getView().refresh()}function allAutoAssignHandler(b){isConfigChanged=true;for(var a=0;a<staffStore.count();a++){staffStore.getAt(a).set("autoAssign",b.checked)}}function saveConfigHandler(){var a="";var d="[";var c;var e=new Object();if(staffStore){staffStore.clearFilter();Ext.getCmp("selectBusinessHrsComboId").select("--"+alllbl+"--");for(var b=0;b<staffStore.count();b++){d+='{"autoAssign":'+staffStore.getAt(b).get("autoAssign")+', "staffId":"'+staffStore.getAt(b).get("staffId")+'", "staffName":"'+staffStore.getAt(b).get("staffName")+'", "bHrsName":"'+staffStore.getAt(b).get("bHrsName")+'"},';if(staffStore.getAt(b).get("autoAssign")==true){a+=staffStore.getAt(b).get("staffId")+","}}if(d&&d.length>1){d=d.substring(0,d.length-1)+"]";staffList=JSON.parse(d)}}a=a.substring(0,a.length-1);if(Ext.getCmp("businessHrsCheckboxId")){e=Ext.getCmp("businessHrsCheckboxId")}else{e.checked=false}saveConfig(selectedQueueId,a,e.checked,autoStaffAssignmentEventVal)}function afterSave(){isConfigChanged=false;if(staffStore){staffStore.removeAll(true);staffStore.loadData(staffList)}if(staffGridPanel){staffGridPanel.getView().refresh()}showMessage(savedSuccessfullyLbl)}function showMessage(a){Ext.MessageBox.show({id:"commonMsgBoxId",title:staffAutoAssignmentLbl,cls:"rf-msg-cls",minWidth:300,minHeight:100,msg:a,buttons:Ext.MessageBox.OK})}function setElementValue(b,a){if(b!=null&&typeof(b)!="undefined"){if(b.textContent!=undefined){b.textContent=a}else{if(b.innerText!=undefined){b.innerText=a}}}};