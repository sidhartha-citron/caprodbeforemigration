var WinMsg;var autoCatJobDiv;var startBtnId;var lastUploadedFileCatId;var autoClassificationConfidenceScoreForCategory;var ConfigDetailDiv;var savebtnId;var fileStatusSpan;var trainStatusMsgId;var autoClassificationInnovationSuiteURL;var autoClassificationUsername;var autoClassificationPassword;var isFirstUpload=false;Ext.onReady(function(){if(document.getElementById(autoClassificationISURL).value==""){isFirstUpload=true}autoClassificationConfidenceScoreForCategory=document.getElementById("autofillScoreSlider");autoClassificationSuggestedScoreForCategory=document.getElementById("suggestedScoreSlider");ConfigDetailDiv=document.getElementById("ConfigDetailDiv");autoCatJobDiv=document.getElementById("autoCatJobDiv");savebtnId=document.getElementById("savebtnId");fileStatusSpan=document.getElementById("fileStatusSpan");trainStatusMsgId=document.getElementById("trainStatusMsgId");startBtnId=document.getElementById("startBtnId");if(!isAutoCategorizationEnable){if(savebtnId&&ConfigDetailDiv){savebtnId.disabled=true;savebtnId.setAttribute("class","d-button_primary d-button_primary_disabled");ConfigDetailDiv.setAttribute("style","opacity:0.5; pointer-events:none;")}if(autoCatJobDiv&&startBtnId){autoCatJobDiv.setAttribute("style","opacity:0.5; pointer-events:none;");startBtnId.setAttribute("class","d-button_primary d-button_primary_disabled")}toggleUploadFileSection(isAutoCategorizationEnable)}else{ConfigDetailDiv.setAttribute("style","opacity:1; pointer-events:all;");toggleUploadFileSection(isAutoCategorizationEnable)}setDataSplitValue();refreshTrainingStatus()});function openHelpPage(){if(wikiUrl){window.open(wikiUrl,false,"width="+screen.width+",height="+screen.height+",resizable = 1,scrollbars=no,status=1,top=0,left=0",false)}}function saveConfiguration(){if(isAutoCategorizationEnable){autoClassificationInnovationSuiteURL=document.getElementById(autoClassificationISURL);autoClassificationUsername=document.getElementById(autoClassificationISUsername);autoClassificationPassword=document.getElementById(autoClassificationISPassword);var c=false;if(autoClassificationInnovationSuiteURL.value==""||autoClassificationUsername.value==""||autoClassificationPassword.value==""){c=true;ShowInlineSaveMessage(true,requiredFieldMsg);return}if(autoClassificationInnovationSuiteURL&&autoClassificationInnovationSuiteURL.value!=""){var d=validateURL(autoClassificationInnovationSuiteURL.value);if(!d){ShowInlineSaveMessage(true,ValidInnovationSuiteURL);return}}if(c&&enableDisableBtn.value==DisableAutoCategorizationLbl){ShowInlineSaveMessage(c,errorMsg);return}}window.parent.createRemoteSiteSetting("Innovation_Suite_Remote_Site_URL",autoClassificationInnovationSuiteURL.value,"Remote site created by BMC Helix Remedyforce for Auto Categorization",sessionId,sfHost);var a=autofillScoreSlider.value;var b=suggestedScoreSlider.value;if(enableDisableBtn.value==EnableAutoCategorizationLbl){save(false,a,b)}else{save(true,a,b)}setDataSplitValue()}function CloseSavePopUp(){clearTimeout(ChangeVisibilityVar);document.getElementById("SaveMessageDiv").setAttribute("style","visibility: hidden; display:none")}function ShowInlineSaveMessage(f,e){if(isFirstUpload&&!f){isFirstUpload=false}var a=document.getElementById("jsscripterrorId");if(a){if(!f||(f&&!isAutoCategorizationEnable)){a.setAttribute("style","display:none;");var d=document.getElementById("SaveMessageDiv");if(d!=null&&d!="undefined"){var i,b,g;i=window.innerWidth;if(i!=null&&i!="undefined"){g=parseInt((i/2)-200)}d.setAttribute("style","visibility: visible; display:table;position: absolute;margin-top: 5px;left: "+g+"px; z-index:2;");ChangeVisibilityVar=setTimeout(function(){CloseSavePopUp()},3000)}if(!isAutoCategorizationEnable){savebtnId.disabled=true;savebtnId.setAttribute("class","d-button_primary d-button_primary_disabled");ConfigDetailDiv.setAttribute("style","opacity:0.5; pointer-events:none;");autoCatJobDiv=document.getElementById("autoCatJobDiv");startBtnId=document.getElementById("startBtnId");if(autoCatJobDiv&&startBtnId){startBtnId.setAttribute("class","d-button_primary d-button_primary_disabled");autoCatJobDiv.setAttribute("style","opacity:0.5; pointer-events:none;")}}else{autoCatJobDiv.setAttribute("style","opacity:1; pointer-events:all;")}toggleUploadFileSection(isAutoCategorizationEnable)}if(f&&isAutoCategorizationEnable){a.setAttribute("style","display:block; margin-top :5px !important; margin-bottom : 5px !important;");var h=document.getElementById("errorDescId");var c;if(e&&e!=""){c=document.createTextNode(e)}else{c=document.createTextNode(requiredFieldMsg)}if(h&&!h.hasChildNodes()){h.appendChild(c)}else{h.replaceChild(c,h.firstChild)}}else{toggleUploadFileSection(isAutoCategorizationEnable)}}}function toggleConfigSection(a){if(a==EnableAutoCategorizationLbl){rerenderConfigPanel(false);if(!isFirstUpload){saveConfiguration()}else{ConfigDetailDiv.setAttribute("style","opacity:0.5; pointer-events:none;")}}else{rerenderConfigPanel(true);savebtnId.disabled=false;savebtnId.setAttribute("class","d-button_primary");ConfigDetailDiv.setAttribute("style","opacity:1; pointer-events:all;")}}function toggleUploadFileSection(a){var c=document.getElementById("uploadTrainingFileDiv");var b=document.getElementById("inputFileHtml");if(c&&b){b.disabled=!a;if(!a){c.setAttribute("style","opacity:0.5; pointer-events:none;")}else{c.setAttribute("style","opacity:1; pointer-events:all;")}}}function toggleUploadBtn(){var a=document.getElementById("inputFileHtml");var b=document.getElementById("uploadbtnId");if((typeof(a)!="undefined")&&(typeof(a.value)!="undefined")&&(a.value!="")){b.setAttribute("class","d-button_primary")}else{b.setAttribute("class","d-button_primary d-button_primary_disabled")}}function validateFile(c){var b=true;var a;var e;var d;if(c!=null&&c!=undefined){a=c.size;e=c.name;d=c.name.split(".")[c.name.split(".").length-1];if(d.toLowerCase()!="csv"||a<=5){GetMessageBox("bmc-message").show({title:Error,msg:UploadValidFile,width:300,closable:true,buttons:Ext.MessageBox.OK,fn:function(g,h,f){if(g=="ok"){document.getElementById("inputFileHtml").value="";toggleUploadBtn()}},icon:Ext.MessageBox.ERROR});b=false}}else{b=false}return b}function AddAttachment(){var a=true;var c=document.getElementById("inputFileHtml");var b;if((typeof(c)!="undefined")&&(typeof(c.value)!="undefined")){b=c.files[0];a=validateFile(b)}else{a=false}if(!a){return false}saveTrainingDataConfig(document.getElementById(localeSelector).value,document.getElementById("dataSplitId").value);client.createBlob("ContentVersion",{Origin:"C",PathOnClient:b.name,Title:b.name},b.name,"VersionData",b,function(e){var j=sforce.connection.query("select id, VersionData, Title,ContentSize,ContentModifiedById,ContentModifiedDate, ContentDocumentId from ContentVersion WHERE Id ='"+e.id+"' limit 1");records=j.getArray("records");var g=records[0].ContentDocumentId;var d=records[0].ContentSize;var i=records[0].Title;var h=records[0].ContentModifiedDate;var f=records[0].ContentModifiedById+"";saveContentDocumentId(g);c.value="";toggleUploadBtn();displayStatus("Training")},function(f,d,e){Ext.Msg.show({msg:((d)?d:fileUploadFailed),minWidth:300,height:"auto",buttons:Ext.MessageBox.OK,cls:"textAlignCenter"})})}function openAttchment(a){window.open("/sfc/servlet.shepherd/version/download/"+a)}function displayStatus(d){var c="";fileStatusSpan=document.getElementById("fileStatusSpan");trainStatusMsgId=document.getElementById("trainStatusMsgId");if(d=="Training"){c=TrainingLbl}else{if(d=="Completed"){c=CompletedLbl}else{if(d.indexOf("Failed")!==-1){c=d}}}var f=fileStatusSpan.childNodes;while(f.length>0){fileStatusSpan.removeChild(f[0])}var e=document.createTextNode(c);fileStatusSpan.appendChild(e);var b=document.createElement("span");var a=document.getElementById("inputFileHtml");if(d=="Training"){b.setAttribute("class","rf-inline-loading");fileStatusSpan.style.color="green";a.setAttribute("disabled","true")}else{if(d=="Completed"){b.setAttribute("class","d-icon-check");fileStatusSpan.style.color="green";a.disabled=false}else{if(d.indexOf("Failed")!==-1){fileStatusSpan.style.color="red";a.disabled=false}}}fileStatusSpan.appendChild(b);fileStatusSpan.style.visibility="visible";if(d=="Training"){trainStatusMsgId.style.display="block"}else{trainStatusMsgId.style.display="none"}}function downloadISDataFiles(a){if(a){Visualforce.remoting.Manager.invokeAction(_RemotingActions.getFileBodyToDownload,a,function(j,c){if(c.status){if(j){var f=htmlDecode(j.fileName);var h=htmlDecode(j.fileBody);var i="\ufeff";var e="utf-8";var d=new Blob([i+h],{type:"text/csv;charset="+e+";"});if(navigator.msSaveBlob){navigator.msSaveBlob(d,f)}else{var g=document.createElement("a");if(g.download!==undefined){var b=URL.createObjectURL(d);g.setAttribute("href",b);g.setAttribute("download",f);g.style.visibility="hidden";document.body.appendChild(g);g.click();document.body.removeChild(g)}}}}})}}function htmlDecode(b){var a=document.createElement("textarea");a.innerHTML=b;return a.value}function changeDataSplitIE(b){var a=false||!!document.documentMode;if(a){changeDataSplit(b)}}function changeDataSplit(a){TrainingData.innerHTML=a.value;TestData.innerHTML=100-a.value}function setAutofillScoreIE(b){var a=false||!!document.documentMode;if(a){setAutofillScore(b)}}function setAutofillScore(a){autofillScoreValue.innerText=a.value}function setSuggestedScoreIE(b){var a=false||!!document.documentMode;if(a){setSuggestedScore(b)}}function setSuggestedScore(a){suggestedScoreValue.innerText=a.value}function toggleButton(a){if(a.value==EnableAutoCategorizationLbl){a.value=DisableAutoCategorizationLbl;toggleConfigSection(a.value)}else{GetMessageBox("bmc-message").confirm(DisableAutoCategorizationLbl,DisableAutoCategorizationConfirmationLbl,function(b){if(b==="no"){return}else{if(b==="yes"){a.value=EnableAutoCategorizationLbl;toggleConfigSection(a.value)}}},this)}}function setDataSplitValue(){var c=document.getElementById("dataSplitId");var b=document.getElementById("TrainingData");var a=document.getElementById("TestData");if(c&&b&&a){b.textContent=c.value;a.textContent=100-c.value}}function validateURL(a){var c=true;if(a&&a.trim()!=""){var b=new RegExp("^(http|https)://");if(!b.test(a)){c=false}}else{c=false}return c}function GetMessageBox(a){if(WinMsg==null){WinMsg=Ext.create("Ext.window.MessageBox")}WinMsg.baseCls=a;return WinMsg};