var regKeyStore,treePanel,newKeyWin,selectedRecord,selectedNode,keyNameVal,newNodeId,newKeyWindow,selectedValRecord,valueName,valueType,valueData,newValWin,isEditOp,selRowIndex=0,msgDlg,strFields=["name","type","data"],strColumns=[{text:nameLbl,dataIndex:"name",flex:1,menuDisabled:true},{text:typeLbl,dataIndex:"type",flex:1,menuDisabled:true},{text:dataLbl,dataIndex:"data",flex:2,menuDisabled:true}];var strLabel="String (REG_SZ)",binLbl="Binary (REG_BINARY)",dwordLbl="DWORD (REG_DWORD)";function createNewKeywin(){var a=new Ext.FormPanel({id:"newKeyForm",frame:false,border:false,bodyStyle:"padding:15px 15px 0",layout:"anchor",defaults:{anchor:"100%"},defaultType:"textfield",autoHeight:true,autWidth:true,items:[{id:"newKeyField",fieldLabel:ACRegistryKeyName,name:"keyName",enableKeyEvents:true,value:keyNameVal},{xtype:"tbspacer",height:"10px"}]});newKeyWindow=Ext.create("Ext.window.Window",{title:ACRegistryNewKey,autoHeight:true,width:400,layout:"fit",closeAction:"hide",modal:true,cls:"CMDBWindow",bodyStyle:"padding-top: 25px; padding-bottom:5px; background:#FFFFFF;",style:"padding: 0; border-width: 0;background:#FFFFFF;",resizable:false,items:[a],border:false,constrain:true,viewConfig:{forceFit:true},closable:false,tools:[{type:"rfclose",handler:function(d,c,b){newKeyWin.close()}}],bbar:["->",{xtype:"button",text:Cancel,scale:"medium",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",handler:function(){newKeyWin.close()}},{xtype:"button",text:ExtjsMessageOK,minWidth:30,scale:"medium",baseCls:"bmc-btn-primary",disabledCls:"bmc-btn-primary-disabled",focusCls:"bmc-btn-primary-focus",overCls:"bmc-btn-primary-over",pressedCls:"bmc-btn-primary-pressed",handler:function(){keyNameVal=Ext.getCmp("newKeyField").getValue();if(keyNameVal==""){showMsgWithParam(ACEnterKeyName)}else{createNewKey()}}}]});return newKeyWindow}function createNewKey(){if(selectedRecord!=null&&selectedRecord!="undefined"&&selectedRecord!=""){var a=selectedRecord.get("id");newNodeId=a+"//"+keyNameVal;startWaitMask();createNewRegKey(newNodeId);keyNameVal="";Ext.getCmp("newKeyField").setValue("");newKeyWindow.close()}else{showMsgWithParam(ACSelectNodeMsg)}}Ext.define("ValueType",{extend:"Ext.data.Model",fields:[{type:"string",name:"label"},{type:"string",name:"value"}]});var newValTypeStore=Ext.create("Ext.data.Store",{model:"ValueType",data:[{label:strLabel,value:"REG_SZ"},{label:binLbl,value:"REG_BINARY"},{label:dwordLbl,value:"REG_DWORD"}]});function createNewValWin(){var d=Ext.create("Ext.form.TextField",{id:"newValNameField",fieldLabel:ACRegistryValueName,name:"valueName",disabled:isEditOp,labelStyle:"opacity:1"});if(isEditOp){d.setValue(valueName)}var a=Ext.create("Ext.form.field.ComboBox",{id:"newValTypeField",fieldLabel:Type,displayField:"label",store:newValTypeStore,forceSelection:true,queryMode:"local",triggerCls:"d-icon-triangle_down",valueField:"value",value:"REG_SZ",listeners:{change:function(h,f){var e=Ext.getCmp("newValValueField");var g=document.getElementById("newValValueField-inputEl");var i;if(g){i=g.getAttribute("placeholder")}if(e){if(f=="REG_BINARY"){e.regex=/^[a-fA-F0-9]+$/;if(i){g.setAttribute("placeholder","")}}else{if(f=="REG_SZ"){if(i){g.setAttribute("placeholder","")}}else{if(f=="REG_DWORD"){e.regex=/^(0x)[a-fA-F0-9]{1,8}$/;e.emptyText="0x00000000";e.applyEmptyText()}}}}}}});var b=Ext.create("Ext.form.TextField",{id:"newValValueField",fieldLabel:dataLbl,name:"valueData",invalidText:"",msgTarget:"none"});var c=new Ext.FormPanel({id:"newValForm",frame:false,border:false,bodyStyle:"padding:15px 15px 0",layout:"anchor",defaults:{anchor:"100%"},defaultType:"textfield",autoHeight:true,autWidth:true,items:[d,a,b,{xtype:"tbspacer",height:"10px"}]});newValWin=Ext.create("Ext.window.Window",{title:ACRegistryNewValue,autoHeight:true,width:400,layout:"fit",closeAction:"destroy",modal:"true",resizable:false,items:[c],cls:"CMDBWindow",bodyStyle:"padding-top: 25px; padding-bottom:5px; background:#FFFFFF;",style:"padding: 0; border-width: 0;background:#FFFFFF;",border:false,constrain:true,viewConfig:{forceFit:true},closable:false,tools:[{type:"rfclose",handler:function(g,f,e){newValWin.close()}}],bbar:["->",{xtype:"button",text:Cancel,scale:"medium",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",handler:function(){newValWin.close()}},{xtype:"button",text:ExtjsMessageOK,id:"saveValBtn",minWidth:30,scale:"medium",baseCls:"bmc-btn-primary",disabledCls:"bmc-btn-primary-disabled",focusCls:"bmc-btn-primary-focus",overCls:"bmc-btn-primary-over",pressedCls:"bmc-btn-primary-pressed",handler:function(){valueName=Ext.getCmp("newValNameField").getValue();valueType=Ext.getCmp("newValTypeField").getValue();valueData=Ext.getCmp("newValValueField").getValue();if(valueName==""||valueData==""||valueType==""){showMsgWithParam(ACEmptyparameters)}else{if(!isEditOp){var f;gridVar.getStore().each(function(g){if(g&&g.get("name")==valueName){f=g}});if(f){gridVar.getStore().remove(f)}}if(valueType=="REG_SZ"){createOrEditValue(valueName,valueType,valueData)}else{if(Ext.getCmp("newValValueField").regex.test(valueData)){createOrEditValue(valueName,valueType,valueData)}else{var e=Ext.MessageBox.show({title:ErrorTitle,msg:InvalidValue,width:350,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}}}}}]});if(isEditOp){newValWin.setTitle(ACRegistryEditValue)}else{newValWin.setTitle(ACRegistryNewValue)}newValWin.show()}function createOrEditValue(b,d,a){var c=selectedRecord.get("id");createNewRegVal(c,b,d,a);startWaitMask();newValWin.close()}function addregValInGrid(){if(!isEditOp){gridVar.getStore().add({name:valueName,type:valueType,data:valueData})}else{if(selectedValRecord){selectedValRecord[0].set("type",valueType);selectedValRecord[0].set("data",valueData)}}}function refreshSelectedNode(){selectedRecord.removeAll(false);regKeyStore.load({node:selectedRecord})}var newKeyBtn={tooltipType:"title",tooltip:ACRegistryNewKey,id:"newKeyBtn",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",scale:"medium",text:ACRegistryNewKey,handler:function(){if(!selectedRecord){showMsgWithParam(ACSelectNodeMsg)}else{if(!newKeyWin){newKeyWin=createNewKeywin();newKeyWin.show()}else{newKeyWin.show()}}}};function deleteBtnHandler(a){if(a=="yes"){if(!selectedRecord){showMsgWithParam(ACSelectNodeMsg)}else{startWaitMask();var b=selectedRecord.get("id");deleteRegKey(b)}}}var delKeyBtn={tooltipType:"title",tooltip:ACDeleteRegistryKey,id:"delKeyBtn",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",scale:"medium",text:ACDeleteRegistryKey,handler:function(){selectedNode=getSelectedKeyNode();if(!selectedNode){showMsgWithParam(ACSelectNodeMsg)}else{if(typeof(WinMsg)=="undefined"||WinMsg==null){WinMsg=Ext.create("Ext.window.MessageBox")}WinMsg.baseCls="bmc-message";WinMsg.show({title:ACDeleteRegistryKey,msg:ACDeleteKeyConfirmationMsg,buttons:Ext.MessageBox.YESNO,fn:deleteBtnHandler,icon:Ext.MessageBox.INFO});WinMsg.defaultButton=2}}};var newValBtn={tooltipType:"title",tooltip:ACRegistryNewValue,id:"newValBtn",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",scale:"medium",text:ACRegistryNewValue,handler:function(){if(!selectedRecord){showMsgWithParam(ACSelectNodeMsg)}else{isEditOp=false;createNewValWin()}}};var editValBtn={tooltipType:"title",tooltip:ACRegistryEditValue,id:"editValBtn",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",scale:"medium",text:ACRegistryEditValue,handler:function(){if(!selectedRecord){showMsgWithParam(ACSelectNodeMsg)}else{selectedValRecord=getSelectedValrecord();if(selectedValRecord){var a=selectedValRecord[0].get("name");if(a==DefaultRegName){showMsgWithParam(EditDelRegValNotAllowed)}else{valueName=selectedValRecord[0].get("name");isEditOp=true;createNewValWin()}}else{showMsgWithParam(ACSelectValueToEditMsg)}}}};function delValBtnHandler(b){if(b=="yes"){if(gridVar){var a=selectedValRecord[0].get("name");if(a){var c=selectedRecord.get("id");deleteRegVal(c,a);startWaitMask()}}}}var delValBtn={tooltipType:"title",tooltip:ACDeleteRegistryValue,id:"delValBtn",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",scale:"medium",text:ACDeleteRegistryValue,handler:function(){if(!selectedRecord){showMsgWithParam(ACSelectNodeMsg)}else{selectedValRecord=getSelectedValrecord();if(!selectedValRecord){showMsgWithParam(ACSelectValueMsg)}else{var a=selectedValRecord[0].get("name");if(a==DefaultRegName){showMsgWithParam(EditDelRegValNotAllowed)}else{if(typeof(WinMsg)=="undefined"||WinMsg==null){WinMsg=Ext.create("Ext.window.MessageBox")}WinMsg.baseCls="bmc-message";WinMsg.show({title:ACDeleteRegistryValue,msg:ACDeleteValueConfirmationMsg,buttons:Ext.MessageBox.YESNO,fn:delValBtnHandler,icon:Ext.MessageBox.INFO});WinMsg.defaultButton=2}}}}};Ext.onReady(function(){ACtabPanel();addTbSpacer();tb.add(newKeyBtn);addTbSpacer();tb.add(newValBtn);addTbSpacer();tb.add(editValBtn);addTbSpacer();tb.add(delKeyBtn);addTbSpacer();tb.add(delValBtn);addRightTools();startWaitMask();createRegKeyTree();Ext.create("Ext.container.Viewport",{layout:"border",items:[tb,treePanel,gridVar,AdvActionPanel]})});function createRegKeyTree(){regKeyStore=Ext.create("Ext.data.TreeStore",{proxy:{type:"ajax",url:page_ACDeviceRegistryJSON+"&assemblyId="+assemblyId+"&actionContext=Registry"},root:{text:compLbl,id:"root",expanded:true},listeners:{load:function(b,d,a,e,c){stopWaitMask()},beforeload:function(b,a,c){startWaitMask()}}});treePanel=Ext.create("Ext.tree.Panel",{id:"regTreePanel",title:ACRegistry,region:"west",store:regKeyStore,rootVisible:true,width:300,padding:0,resizable:true,useArrows:true,animCollapse:true,listeners:{itemclick:function(c,b,f,d,a,e){selectedRecord=b},afteritemexpand:function(d,a,c,b){if(a!=null&&a!=undefined){this.getSelectionModel().select(a)}selectedNode=d},itemexpand:function(b,a){},beforeload:function(c,a,b){},itemcollapse:function(b,a){startWaitMask()},afteritemcollapse:function(d,a,c,b){stopWaitMask()},select:function(d,a,b,c){selectedRecord=a;selectedNode=d.getSelection();startWaitMask();getRegKeyValues(selectedRecord.get("id"))},load:function(d,g,c,f,h){stopWaitMask();var i=d.getRootNode().childNodes;if(i.length!=0){var a=i[0];var e=a.data.id;if(e=="errorNodeId"){var b=a.data.text;showMsgWithParam(b)}else{if(e=="authFailed"){openAuthDialog();node.removeAll(true)}}}}}})}function removeRegKeyNode(){selectedNode=getSelectedKeyNode();if(selectedNode){var a=selectedNode.parentNode;selectedNode.remove(true);regKeyStore.sync();gridVar.getStore().removeAll(false);regKeyStore.load({node:a})}}function getSelectedKeyNode(){if(treePanel.getSelectionModel().hasSelection()){var a=treePanel.getSelectionModel().getSelection();if(a){return a[0]}}}function removeRegVal(){gridVar.getStore().remove(selectedValRecord);selectedValRecord=null}function gridRowClickEvent(b,a){selectedValRecord=getSelectedValrecord()}function getSelectedValrecord(){if(gridVar.getSelectionModel().hasSelection()){var a=gridVar.getSelectionModel().getSelection();return a}};