var initialRecordState="";var lastModifiedByLocking="";var problemName=ProblemConsolePage.Labels.New;var LabelNew=ProblemConsolePage.Labels.New_Problem;var tabName=ProblemConsolePage.Labels.ProblemRecordPrefix+":"+ProblemConsolePage.Labels.New;var recordState="";var isRecordLock="";var categoryId="";var status="";var desc="";var ServiceTargetStatus="";var isDeleted=false;var selectedCategoryId="";var disableActionBtn=false;var isNeedToRefreshProblem=false;var isNeedToRefreshRelatedList=false;var isNeedToRefreshSmartView=false;var isFocusOnProblemForm=true;var isFocusOnRelatedList=false;var isFocusOnSmartView=false;var isNewProblemForm=false;var isNewRecordLock=false;var saveFromQuickClose=false;var isNeedToRefreshProblemList=false;var waitMsgBar="";var isProblemFormFrameLoaded=true;var isProblemRelatedListFrameLoaded=true;var isProblemSmartViewFrameLoaded=false;var clickedOnce=false;var isSaveForSingleConsole=true;var isSAVE=false;var screenWidth=671;var screenHeight=400;var ServiceTargetsBtnHandlerWindow;var SconsoletabName="";var isOptionalItemsAdded=false;var createKABtnHandler;var knowledgeSearchBtnHandler;var CIExplorerBtnHandler;var ServiceTargetsBtnHandler;var ProblemManifestBtnHandler;var cloneBtnHandler;var CloseBtnHandler;var ReopenBtnHandler;var addNoteHandler;var sendEmailBtnHandler;var newActionHandler;var viewActionHistoryBtnHandler;var submitforapprovalHandler;function screenLeft(a){return parseInt((screen.availWidth/2)-(a/2))}function screenTop(b){if(Ext.isChrome){var a=parseInt((screen.availHeight/2)-(screenHeight/2));return(a-25)}else{return parseInt((screen.availHeight/2)-(screenHeight/2))}}var left=screenLeft();var top=screenTop();var functionArray=new Array();function setProblemData(a){functionArray[0]=a}function saveProblem(a){functionArray[1]=a}function assignRFLookupFilter(a){functionArray[2]=a}function getLookupFilterQuery(a){return functionArray[2](a)}function reopenProblem(){if(verifyChange()){handleSave()}Visualforce.remoting.Manager.invokeAction(_RemotingActions.reopenProblem,recordId,function(a,b){if(b.type==="exception"){Ext.Msg.baseCls="bmc-notiltle-msg";Ext.Msg.show({msg:b.message,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR});stopWaitMsgBar()}else{stopWaitMsgBar();if(isFocusOnProblemForm){loadProblemDetail(recordId)}if(isFocusOnRelatedList){loadProblemDetail(recordId);loadProblemRelatedList(recordId)}isNeedToRefreshRelatedList=true;isNeedToRefreshProblemList=true;isNeedToRefreshSmartView=true}},{escape:true})}function LoadHandlerForActionItem(){cloneBtnHandler=function(f,g){var h=window.location.hash=!!window.MSInputMethodContext;if(Ext.isIE||h){hideMenu()}if(isServiceCloudConsole=="true"){sforce.console.openPrimaryTab(null,problemConsole+"&record_id="+recordId+"&isCloneRequest=true&isServiceCloudConsole=true&ran="+new Date().getTime(),true,ProblemConsolePage.Labels.New);return false}else{if(isRFConsoleDetailForm=="true"){window.parent.addTab(recordId,"","Problem__c",true)}else{if(verifyChange()){var i=cloneBtnHandler;showCloseWarning(i,null)}else{isCloneRequest="true";startWaitMsgBar();loadProblemDetail(recordId)}}}};var b;CloseBtnHandler=function(g,h){if(verifyChange()){Ext.Msg.defaultButton=1;Ext.Msg.baseCls="bmc-notiltle-msg";Ext.Msg.show({msg:ProblemConsolePage.Labels.closeConfirmMsg,buttons:Ext.Msg.OK,buttonText:{ok:ProblemConsolePage.Labels.ServiceTargetsOK},icon:Ext.MessageBox.INFO})}else{screenHeight=400;screenWidth=871;var j=new Object;j.startWaitMsgBar=startWaitMsgBar;j.isNeedToRefreshRelatedList=isNeedToRefreshRelatedList;j.loadProblemDetail=loadProblemDetail;j.isNeedToRefreshProblemList=isNeedToRefreshProblemList;j.startWaitMsgBar=startWaitMsgBar;j.refreshProblem=refreshProblem;var f="dialogWidth:"+screenWidth+"px;dialogHeight:"+screenHeight+"px;status;resizable;scrollbars:no;center:yes;dialogLeft:"+screenLeft(screenWidth)+"px;;dialogTop:"+screenTop(screenHeight)+"px;";var i=window.location.hash=!!window.MSInputMethodContext;if(!b||b.closed){if(window.showModalDialog&&(Ext.isIE||i)){b=window.showModalDialog("/apex/CloseProblemPage?Id="+recordId+"&calledFrom=rfconsole&isLookup=true",j,f)}else{f="width="+screenWidth+",height="+screenHeight+",status,resizable,scrollbars=yes,left="+screenLeft(screenWidth)+",top="+screenTop(screenHeight);b=window.open("/apex/CloseProblemPage?Id="+recordId+"&calledFrom=rfconsole&isLookup=true","_blank",f)}}if(b!=""&&typeof(b)!="undefined"&&b.focus){b.focus()}}};ReopenBtnHandler=function(f,g){startWaitMsgBar();reopenProblem()};var a;addNoteHandler=function(f,g){if(!a||a.closed){a=window.open("/apex/stdlayoutproblemaddnotepage?id="+recordId+"&fromconsole=true","addNote","width=600,height=400,resizable = 0,scrollbars=no,status=1,top=350,left=350")}if(a.focus){a.focus()}};var d;sendEmailBtnHandler=function(g,h){screenHeight=700;screenWidth=900;left=screenLeft(screenWidth);top=screenTop(screenHeight);var f="dialogWidth:"+screenWidth+"px;dialogHeight:"+screenHeight+"px;status;resizable;scrollbars:no;center:yes;dialogLeft:"+screenLeft(screenWidth)+"px;;dialogTop:"+screenTop(screenHeight)+"px;";if(!d||d.closed){if(window.showModalDialog&&Ext.isIE){var i=new Object;i.isFocusOnRelatedList=isFocusOnRelatedList;i.loadProblemRelatedList=loadProblemRelatedList;i.startWaitMsgBar=startWaitMsgBar;i.setIsNeedToRefreshRelatedList=setIsNeedToRefreshRelatedList;d=window.showModalDialog("/apex/ComposeEmailPage?enableSelfClosing=false&recordId="+recordId+"&isNew=true&objectName=Problem__c&isConsolePage=true&popupHeader="+problemName,i,f)}else{f="width="+screenWidth+",height="+screenHeight+",status,resizable,scrollbars=no,left="+screenLeft(screenWidth)+",top="+screenTop(screenHeight);d=window.open("/apex/ComposeEmailPage?enableSelfClosing=false&recordId="+recordId+"&isNew=true&objectName=Problem__c&isConsolePage=true&popupHeader="+problemName,"_blank",f)}}if(d!=""&&typeof(d)!="undefined"&&d.focus){d.focus()}};var c;newActionHandler=function(f,g){c=window.open("/apex/searchPage?popupId=Action&isLookup=true&objectType=Problem_History__c&isCalledFromConsole=true&enableSelfClosing=false&standardLayout=true&parentId="+recordId+"&filterClause=appliesToProblem__c%3Dtrue%20and%20system__c%3Dfalse","newAction","status = 1,height ="+screenHeight+",width ="+screenWidth+",left="+screenLeft(screenWidth)+",top="+screenTop(screenHeight)+", resizable = 0,scrollbars=no");if(c.focus){c.focus()}};var e;viewActionHistoryBtnHandler=function(f,g){screenWidth=671;screenHeight=400;c=window.open("/apex/ViewAllActions?ObjectId="+recordId+"&recordState="+recordState+"&objectName=Problem&recordName="+problemName,"actionHistory","status = 1,height ="+screenHeight+",width ="+screenWidth+",left="+screenLeft(screenWidth)+",top="+screenTop(screenHeight)+", resizable = 0,scrollbars=yes");if(c.focus){c.focus()}}}var openInVar="";var customActionJsonString="";var urlStringVar="";var custionActionObj="";function customActionHandler(a){openInVar=a.openIn;custionActionObj=a;getCustomActionURL(a.id)}function openUrl(){if(openInVar.indexOf("Remedyforce")!=-1){window.parent.parent.addNewTab(custionActionObj.id,customActionHeaderLabel,"NavigatorPage?title="+custionActionObj.encodedText+"&isCustomActionLink=true&target="+urlStringVar)}else{if(openInVar.toLowerCase().indexOf("window")!=-1){var a="resizable=1,scrollbars=1,fullscreen=1,toolbar=1,menubar=1,location=1,height="+screen.height+",width="+screen.width+",top = 0,left = 0";window.open(urlStringVar,"",a)}else{window.open(urlStringVar)}}}function getCustomActionURL(customId){var incId=recordId;eval(orgNamespace).JSRemoteActions.getCustomActionURL("Problem",incId,customId,function(result,event){if(event.status){if(result!=""&&result!=null){urlStringVar=result;openUrl()}}else{if(event.type==="exception"){Ext.Msg.alert("",event.message)}}},{escape:false})}function getDetailViewActionMenu(){if(ActionMenuItem=="-"){ActionMenuItem=""}var a=false;if(recordId==null||recordId==""){a=true}return Ext.create("Ext.menu.Menu",{id:"mainMenu",baseCls:"bmc-menu",shadow:false,items:ActionMenuItem,listeners:{mouseleave:{element:"el",delay:5000,fn:function(){this.hide()}}}})}var ProblemRelatedListBtnhandler;function getDetailVeiwToolBar(){var e=function(f,g){if(isRFConsoleDetailForm=="true"){window.parent.addTab(null,"","Problem__c")}else{if(isServiceCloudConsole=="true"){sforce.console.openPrimaryTab(null,problemConsole+"&record_id=&isServiceCloudConsole=true&ran="+new Date().getTime(),true,ProblemConsolePage.Labels.New);return false}else{if(verifyChange()){var h=e;showCloseWarning(h)}else{startWaitMsgBar();loadProblemDetail(null);disableActionMenuItems(true)}}}};var b=function(f,h){startWaitMsgBar();Ext.getCmp("ProblemFormBtnId").toggle(true);Ext.getCmp("actionButton").setDisabled(false);Ext.getCmp("agentToolsBtnId").setDisabled(false);if(isRecordLock&&isRecordLock.indexOf("true")>-1){Ext.getCmp("saveId").setDisabled(true)}else{if(_ServerVariables.ObjectMetadata.isUpdateable){Ext.getCmp("saveId").setDisabled(false)}}var i=document.getElementById("problemRelatedListFrameId");hideDiv(i);var g=document.getElementById("problemDetailsFrameId");if(g.src==""||isNeedToRefreshProblem==true){loadProblemDetail(recordId)}else{showDiv(g);if(isActivityFeedEnabled==true){showActivityFeed()}if(isCISidebarEnabled==true){showRelatedCI()}if(isProblemFormFrameLoaded){stopWaitMsgBar()}resizeProblemDetailsFrameForIEEDGE()}};ProblemRelatedListBtnhandler=function(g,h){Ext.getCmp("ProblemReleatedListBtnId").toggle(true);Ext.getCmp("actionButton").setDisabled(false);Ext.getCmp("agentToolsBtnId").setDisabled(false);if(isRecordLock&&isRecordLock.indexOf("true")>-1){Ext.getCmp("saveId").setDisabled(true)}else{if(_ServerVariables.ObjectMetadata.isUpdateable){Ext.getCmp("saveId").setDisabled(false)}}startWaitMsgBar();var j=document.getElementById("problemDetailsFrameId");hideDiv(j);hideActivityFeed();hideRelatedCI();var i=document.getElementById("problemSmartViewFrameId");hideDiv(i);var f=document.getElementById("problemRelatedListFrameId");if(f.src==""||isNeedToRefreshRelatedList==true){loadProblemRelatedList(recordId)}else{showDiv(f);if(isProblemRelatedListFrameLoaded){stopWaitMsgBar()}}};var a=function(f,g){Ext.getCmp("ProblemSmartViewBtnId").toggle(true);Ext.getCmp("actionButton").setDisabled(true);Ext.getCmp("agentToolsBtnId").setDisabled(true);Ext.getCmp("saveId").setDisabled(true);var h=document.getElementById("problemDetailsFrameId");hideDiv(h);hideActivityFeed();hideRelatedCI();var i=document.getElementById("problemRelatedListFrameId");hideDiv(i);if(hasActivityFeedPermission!=undefined){if(hasActivityFeedPermission==true){loadContentsInSmartViews()}else{showSmartViewsError(isLoggedInUserAdmin)}stopWaitMsgBar()}else{checkSmartViewAccess(false)}};var c=function(f,h){functionArray[1]();if(isRFConsoleDetailForm){isSaveForSingleConsole=true;isSAVE=true}Ext.getCmp("ProblemFormBtnId").toggle(true);var g=document.getElementById("problemDetailsFrameId");showDiv(g)};var d=function(g,h){if(verifyChange()){var f=d;showCloseWarning(f)}else{startWaitMsgBar();if(isFocusOnProblemForm){loadProblemDetail(recordId)}else{if(isFocusOnRelatedList){loadProblemRelatedList(recordId)}else{if(isFocusOnSmartView){loadProblemSmartView(recordId)}else{loadProblemDetail(null)}}}}};return Ext.create("Ext.toolbar.Toolbar",{id:"detailViewToolbarId",items:[{xtype:"tbspacer",width:5},{id:"newId",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",text:ProblemConsolePage.Labels.New,tooltip:returnLabel(ProblemConsolePage.Labels.New,"N"),disabled:!_ServerVariables.ObjectMetadata.isCreateable,handler:e},{xtype:"tbspacer",width:5},{id:"refreshId",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",text:ProblemConsolePage.Labels.Undo,tooltip:ProblemConsolePage.Labels.Undo_Consolebtn_Tooltip,handler:d},{xtype:"tbspacer",width:5},{id:"saveId",baseCls:"bmc-btn-primary",disabledCls:"bmc-btn-primary-disabled",focusCls:"bmc-btn-primary-focus",overCls:"bmc-btn-primary-over",pressedCls:"bmc-btn-primary-pressed",text:ProblemConsolePage.Labels.Save,tooltip:returnLabel(ProblemConsolePage.Labels.Save,"S"),disabled:!_ServerVariables.ObjectMetadata.isUpdateable,handler:c},{xtype:"tbspacer",width:5},"-",{id:"actionButton",baseCls:"bmc-btn-dropdown",disabledCls:"bmc-btn-dropdown-disabled",focusCls:"focus",overCls:"over",pressedCls:"pressed",text:ProblemConsolePage.Labels.Actions,tooltip:returnLabel(ProblemConsolePage.Labels.Actions,"A"),menu:getDetailViewActionMenu()},{id:"agentToolsBtnId",baseCls:"bmc-btn-dropdown",disabledCls:"bmc-btn-dropdown-disabled",focusCls:"bmc-btn-dropdown-focus",overCls:"bmc-btn-dropdown-over",pressedCls:"bmc-btn-dropdown-pressed",text:ProblemConsolePage.Labels.AgentTools,tooltip:returnLabel(ProblemConsolePage.Labels.AgentTools,"T"),menu:getProblemAgentToolsBtnMenu()},{id:"ProblemFormBtnGroupId",xtype:"buttongroup",columns:3,border:false,frame:false,items:[{id:"ProblemFormBtnId",cls:(!isRFConsoleDetailForm||parent.hideSmartViewbtn())?"bmc-togglebar-left-btn-smart-view-disable":"bmc-togglebar-left-btn",baseCls:"bmc-togglebar-btn-base",disabledCls:"bmc-togglebar-btn-disabled",focusCls:"bmc-togglebar-btn-focus",overCls:"bmc-togglebar-btn-over",pressedCls:"pressed",text:ProblemConsolePage.Labels.ProblemForm,tooltip:ProblemConsolePage.Labels.ProblemForm,enableToggle:true,pressed:true,disabled:((recordId==null||recordId==""||recordId=="new")?true:false),toggleGroup:"problemBtnGroup",handler:b,listeners:{toggle:{fn:function(f,g){if(g){isFocusOnProblemForm=true}else{isFocusOnProblemForm=false}}}}},{id:"ProblemReleatedListBtnId",cls:(!isRFConsoleDetailForm||parent.hideSmartViewbtn())?"bmc-togglebar-right-btn":"bmc-togglebar-center-btn",baseCls:"bmc-togglebar-btn-base",disabledCls:"bmc-togglebar-btn-disabled",focusCls:"bmc-togglebar-btn-focus",overCls:"bmc-togglebar-btn-over",pressedCls:"pressed",text:ProblemConsolePage.Labels.RelatedLists,tooltip:ProblemConsolePage.Labels.RelatedLists,enableToggle:true,disabled:((recordId==null||recordId==""||recordId=="new")?true:false),toggleGroup:"problemBtnGroup",handler:ProblemRelatedListBtnhandler,listeners:{toggle:{fn:function(f,g){if(g){isFocusOnRelatedList=true}else{isFocusOnRelatedList=false}}}}},{id:"ProblemSmartViewBtnId",cls:"bmc-togglebar-right-btn",baseCls:"bmc-togglebar-btn-base",disabledCls:"bmc-togglebar-btn-disabled",focusCls:"bmc-togglebar-btn-focus",overCls:"bmc-togglebar-btn-over",pressedCls:"pressed",text:ProblemConsolePage.Labels.SmartView,tooltip:ProblemConsolePage.Labels.SmartView,enableToggle:true,disabled:((recordId==null||recordId==""||recordId=="new"||isCloneRequest=="true")?true:false),toggleGroup:"problemBtnGroup",handler:a,hidden:(!isRFConsoleDetailForm||parent.hideSmartViewbtn()),listeners:{toggle:{fn:function(f,g){if(g){isFocusOnSmartView=true}else{isFocusOnSmartView=false}f.doComponentLayout()}}}}]},{xtype:"tbfill"},{id:"LockRecord",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",text:ProblemConsolePage.Labels.LockRecord,tooltip:_ServerLabels.LockRecordToolTip,hidden:true,disabled:!_ServerVariables.ObjectMetadata.isUpdateable},{id:"UnlockRecord",baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",text:ProblemConsolePage.Labels.UnlockRecord,tooltip:_ServerLabels.UnlockRecordToolTip,hidden:true,disabled:!_ServerVariables.ObjectMetadata.isUpdateable},{xtype:"tbspacer",width:5},{id:"LockRecordIcon",xtype:"label",hidden:true,cls:"d-icon-lock lock-color lock-icon",autoEl:{title:ProblemConsolePage.Labels.LockedRecord}},{id:"LockRecordLbl",xtype:"label",text:ProblemConsolePage.Labels.Locked,hidden:true,cls:"recordLockText"},{id:"UnlockRecordIcon",xtype:"label",hidden:true,cls:"d-icon-lock_open lock-icon",autoEl:{title:ProblemConsolePage.Labels.UnlockedRecord}},{xtype:"tbspacer",width:0},{xtype:"tbseparator",id:"helpIconSeparator"},{xtype:"tbspacer",width:0},{xtype:"label",html:'<a href="#" onclick="OpenHelppage(\'Detail\');" title="'+_ServerLabels.Help+'" class="d-icon-question_circle help-icon"></a>'},{xtype:"tbspacer",width:10}]})}function getDetailViewPanel(){var a=Ext.create("Ext.Panel",{id:"detailViewChildPanelId",cls:"detail-view-position-fixed",border:false,hidden:(recordId==""),width:"100%",anchor:"0 0",layout:{type:"anchor"},tbar:getDetailVeiwToolBar(),items:[Ext.create("Ext.Panel",{border:false,anchor:"0 0",width:"100%",contentEl:"DetailFormDiv"})]});waitMsgBar=new Ext.LoadMask(a,{floating:{shadow:false},msgCls:"d-loader-container",msg:'<ul class="d-loading"><li class="d-loading__stick d-loading__stick_1"></li><li class="d-loading__stick d-loading__stick_2"></li><li class="d-loading__stick d-loading__stick_3"></li><li class="d-loading__stick d-loading__stick_4"></li><li class="d-loading__stick d-loading__stick_5"></li><li class="d-loading__stick d-loading__stick_6"></li><li class="d-loading__stick d-loading__stick_7"></li><li class="d-loading__stick d-loading__stick_8"></li><li class="d-loading__stick d-loading__stick_9"></li><li class="d-loading__stick d-loading__stick_10"></li><li class="d-loading__stick d-loading__stick_11"></li><li class="d-loading__stick d-loading__stick_12"></li></ul><div>'+_ServerLabels.PleaseWaitMsg+"</div>"});return a}function LoadRecord(a){if(verifyChange()){var b=LoadRecordFunc;showCloseWarning(b,a)}else{LoadRecordFunc(a)}}function LoadRecordFunc(a){console.log("Loading record...");console.log(a);recordId=a;startWaitMsgBar();if(recordId==null||recordId==""){loadProblemDetail(null)}else{isNeedToRefreshRelatedList=true;loadProblemDetail(a)}}function showDiv(a){a.style.display="block";a.style.height="100%";a.style.width="100%";var c=/chrome/i.test(navigator.userAgent);if(c){var b=a.clientHeight+2;b=(b/a.clientHeight)*100;a.style.height=b+"%"}}function hideDiv(a){a.style.display="none";a.style.height="0px";a.style.width="0px"}function LoadHandlerForAgentItem(){var e;var a;var b;var c;ProblemManifestBtnHandler=function(f,g){screenWidth=1100;screenHeight=650;windowFeatures="status = 1,height = "+screenHeight+", width = "+screenWidth+",left="+screenLeft(screenWidth)+",top="+screenTop(screenHeight)+", resizable = 1,scrollbars=yes";c=window.open("/apex/ReleaseManifest?id="+recordId+"&stdForm=true&objectName=problem__c","Manifest",windowFeatures);if(c.focus){c.focus()}};ServiceTargetsBtnHandler=function(f,g){screenHeight=400;screenWidth=1087;var h="FKProblem__c='"+recordId+"'";b=window.open("/apex/SearchPage?popupId=ProblemServiceTarget&isLookup=true&filterClause="+escape(h)+"&standardLayout=true&iscalledFromConsole=true&popupFor=ServiceTargets&popupHeader="+problemName,"ServiceTarget","status = 1,height ="+screenHeight+", width ="+screenWidth+",left="+screenLeft(screenWidth)+",top="+screenTop(screenHeight)+", resizable = 0,scrollbars=no");if(b.focus){b.focus()}};var d;CIExplorerBtnHandler=function(g,h){screenWidth=1200;screenHeight=650;var f="width="+screenWidth+",height="+screenHeight+",status,resizable,scrollbars=no,left="+screenLeft(screenWidth)+",top="+screenTop(screenHeight);d=window.open("/apex/CIExplorerLauncher?Module=Problem__c&RecordSequence="+recordId+"&id="+recordId+"&stdForm=true&isCalledFromConsole=true","PRCIExplorer",f);if(d.focus){d.focus()}};knowledgeSearchBtnHandler=function(f,g){screenHeight=400;screenWidth=671;a=window.open("/apex/KnowledgeSearch?enableSelfClosing=false&calledFromForm=true&standardLayout=true&isCalledFromConsole=true&objectName=Problems&search="+encodeURIComponent(desc)+"&KMproblemID="+recordId+"&isServiceCloudConsole="+isServiceCloudConsole+"&isRFConsoleDetailForm="+isRFConsoleDetailForm,"KnowledgeSearch","status = 1, height ="+screenHeight+", width ="+screenWidth+",left="+screenLeft(screenWidth)+",top="+screenTop(screenHeight)+", resizable = 1, scrollbars=no");if(a.focus){a.focus()}};createKABtnHandler=function(f,g){screenHeight=170;screenWidth=475;createKABtnHandlerWindow=window.open("/apex/CreateKnowledgePage?isCalledFromConsole=true&problemid="+recordId,"CreateKnowledgeArticle","status = 1, height ="+screenHeight+", width ="+screenWidth+",left="+screenLeft(screenWidth)+",top="+screenTop(screenHeight)+", resizable = 1, scrollbars=no");if(createKABtnHandlerWindow.focus){createKABtnHandlerWindow.focus()}}}function getProblemAgentToolsBtnMenu(){var a=false;if(recordId==null||recordId==""){a=true}return Ext.create("Ext.menu.Menu",{id:"AgentToolsMenu",shadow:false,baseCls:"bmc-menu",items:AgentMenuItem,listeners:{mouseleave:{element:"el",delay:5000,fn:function(){this.hide()}}}})}function loadProblemRelatedList(d){isProblemRelatedListFrameLoaded=false;isFocusOnProblemForm=false;isFocusOnRelatedList=true;var c=document.getElementById("problemDetailsFrameId");hideDiv(c);hideActivityFeed();hideRelatedCI();var b=document.getElementById("problemSmartViewFrameId");hideDiv(b);var a=document.getElementById("problemRelatedListFrameId");a.src="/apex/consoleProblemRelatedList?id="+d+"&isdtp=vw&obj=Problem__c";addOnLoadEvent(a,afterProblemRelatedListFrameLoad);showDiv(a)}function loadProblemSmartView(b){isFocusOnForm=false;isFocusOnRelatedList=false;isFocusOnSmartView=true;var a=document.getElementById("problemDetailsFrameId");hideDiv(a);hideActivityFeed();hideRelatedCI();var d=document.getElementById("problemRelatedListFrameId");hideDiv(d);var c=document.getElementById("problemSmartViewFrameId");if(typeof((c)!="undefined"&&c.src=="")){c.src="/apex/DeepView?id="+b+"&isEmbeddedMode=true";addOnLoadEvent(c,afterProblemSmartViewFrameLoad)}showDiv(c)}function refreshProblem(){handleSave();if(isFocusOnProblemForm){loadProblemDetail(recordId);isNeedToRefreshRelatedList=true}else{loadProblemRelatedList(recordId);isNeedToRefreshProblem=true;refreshProblemFormTimeOut()}}function loadProblemDetail(c){isProblemFormFrameLoaded=false;isFocusOnProblemForm=true;isFocusOnRelatedList=false;var d=document.getElementById("problemRelatedListFrameId");hideDiv(d);var b=document.getElementById("problemDetailsFrameId");if(c==null||c==""||isCloneRequest=="true"){isNewProblemForm=true;isNewRecordLock=true;if(isCloneRequest=="true"){isCloneRequest="false";b.src="/apex/ConsoleProblemDetail?oldProblemId="+c;clickedOnce=true;handleChange()}else{b.src="/apex/ConsoleProblemDetail?clientId="+_ServerVariables.PageParams.clientid}}else{isNewProblemForm=false;b.src="/apex/ConsoleProblemDetail?id="+c}addOnLoadEvent(b,afterProblemDetailFrameLoad);if(isNewProblemForm){Ext.getCmp("helpIconSeparator").hide();Ext.getCmp("detailViewToolbarId").doLayout()}else{addOptionalToolbarItems();Ext.getCmp("helpIconSeparator").show();Ext.getCmp("detailViewToolbarId").doLayout()}showDiv(b);var a=Ext.getCmp("detailViewChildPanelId");a.show();if(isActivityFeedEnabled==true&&isNewProblemForm!=true&&isCloneRequest!="true"&&isFocusOnProblemForm==true){displayActivityFeed=true}if(isCISidebarEnabled==true&&isNewProblemForm!=true&&isCloneRequest!="true"&&isFocusOnProblemForm==true){displayCISidebar=true}}function afterProblemDetailFrameLoad(){if(isNewProblemForm){afterNewFormLoad()}else{afterDetailFormLoad()}isNeedToRefreshProblem=false;isProblemFormFrameLoaded=true;if(isDeleted){disableDetailFormButtons()}isDeleted=false;resizeProblemDetailsFrameForIEEDGE()}function resizeProblemDetailsFrameForIEEDGE(){if(checkIsIEBrowser()||(/Edge\/\d./i.test(navigator.userAgent))){document.getElementById("problemDetailsFrameId").style.position="fixed";document.getElementById("problemDetailsFrameId").style.height="92%"}}function afterProblemRelatedListFrameLoad(){stopWaitMsgBar();isProblemRelatedListFrameLoaded=true}function afterProblemSmartViewFrameLoad(){var a=document.getElementById("problemSmartViewFrameId");if(a&&a.src!=""){stopWaitMsgBar()}isProblemSmartViewFrameLoaded=true}function afterNewFormLoad(){removeProblemData();AttRefGeneratorId="";Ext.getCmp("saveId").setDisabled(false);Ext.getCmp("refreshId").setDisabled(false);if(Ext.getCmp("viewActionHistoryId")!=undefined&&Ext.getCmp("viewActionHistoryId")!=null){Ext.getCmp("viewActionHistoryId").setDisabled(true)}disableActionMenuItems(true);disableAgentMenuItems(true);if(isServiceCloudConsole=="true"){sforce.console.setTabTitle(LabelNew)}Ext.getCmp("ProblemFormBtnId").toggle(false);Ext.getCmp("ProblemReleatedListBtnId").toggle(false);Ext.getCmp("ProblemFormBtnId").setDisabled(true);Ext.getCmp("ProblemReleatedListBtnId").setDisabled(true);isNewProblemForm=false;stopWaitMsgBar()}function afterDetailFormLoad(){if(functionArray[0]!="undefined"&&functionArray[0]!=null&&functionArray[0]!="null"&&functionArray[0]!=""){var j=functionArray[0]();var g=recordId;if(isRFConsoleDetailForm&&isSaveForSingleConsole){window.parent.changeTabTitle(tabId,window.parent.SingleConsolePage.Labels.ProblemRecordPrefix+j.Name);isSaveForSingleConsole=false;window.parent.updateDirtyFlag(tabId,false);if(g==null||g==""){window.parent.changeTabItemId(j.Id,tabId)}}if(g==null||g==""){enableCustomActions()}getProblemData(j);Ext.getCmp("refreshId").setDisabled(false);if(Ext.getCmp("viewActionHistoryId")!=undefined&&Ext.getCmp("viewActionHistoryId")!=null){Ext.getCmp("viewActionHistoryId").setDisabled(false)}if(isServiceCloudConsole=="true"){tabSuffix=ProblemConsolePage.Labels.ProblemRecordPrefix;sforce.console.setTabTitle(tabSuffix+j.Name);SconsoletabName=j.Name;sforce.console.getFocusedPrimaryTabId(addSConsoleTabComplete)}var i=Ext.getCmp("ProblemStatusId");if(i){i.update(j.Stage__c)}if(isFocusOnProblemForm){Ext.getCmp("ProblemFormBtnId").toggle(true)}if(_ServerVariables.ObjectMetadata.isUpdateable){Ext.getCmp("saveId").setDisabled(false)}else{Ext.getCmp("saveId").setDisabled(true)}if(isFocusOnSmartView){Ext.getCmp("saveId").setDisabled(true)}Ext.getCmp("ProblemFormBtnId").setDisabled(false);Ext.getCmp("ProblemReleatedListBtnId").setDisabled(false);var o=Ext.getCmp("closeButtonId");var h=Ext.getCmp("reopenButtonId");var l=Ext.getCmp("cloneButtonId");var f=Ext.getCmp("addNoteId");var d=Ext.getCmp("emailId");var m=Ext.getCmp("printId");var c=Ext.getCmp("printPDFId");var e=Ext.getCmp("knowledgeSearchButtonId");var n=Ext.getCmp("createKnowledgeArticleButtonId");var k=Ext.getCmp("CiExplorerButtonId");var a=Ext.getCmp("ProblemManifestButtonId");var p=Ext.getCmp("newActionId");var b=Ext.getCmp("Submitforapproval");if(recordState=="true"){if(_ServerVariables.ObjectMetadata.isUpdateable){if(o!=undefined&&o!=null){o.setDisabled(false)}if(d!=undefined&&d!=null){d.setDisabled(false)}if(p!=undefined&&p!=null){p.setDisabled(false)}checkApprovalstatus();if(typeof(recordLock)!="undefined"&&recordLock!=null&&recordLock!="Off"){if(!isSAVE||(isSAVE&&initialRecordState=="true")){if(typeof(isRecordLock)!="undefined"&&isRecordLock!=null&&isRecordLock.indexOf("false")>-1){if(recordLock=="Explicit"){if(isRecordLock.indexOf("##")>-1){recordLockedIcons("")}else{recordUnlockedIcons()}}else{if(recordLock=="Implicit"){getRecordLockedValue("recordLock")}}}else{enableRecordReadModeMsg(isRecordLock)}}isSAVE=false}}else{if(o!=undefined&&o!=null){o.setDisabled(true)}if(d!=undefined&&d!=null){d.setDisabled(true)}if(p!=undefined&&p!=null){p.setDisabled(true)}}if(h!=undefined&&h!=null){h.setDisabled(true)}if(f){if(_ServerVariables.ObjectMetadata.isUpdateable||_ServerVariables.ObjectMetadata.isCreateable){f.setDisabled(false)}else{f.setDisabled(true)}}if(e!=undefined&&e!=null){e.setDisabled(false)}if(a!=undefined&&a!=null){a.setDisabled(false)}}else{disableAllrecordLockIcons();if(o!=undefined&&o!=null){o.setDisabled(true)}if(f!=undefined&&f!=null){f.setDisabled(true)}if(d!=undefined&&d!=null){d.setDisabled(true)}if(b!=undefined&&b!=null){b.setDisabled(true)}if(_ServerVariables.ObjectMetadata.isUpdateable){if(h!=undefined&&h!=null){h.setDisabled(false)}}else{if(h!=undefined&&h!=null){h.setDisabled(true)}}if(e!=undefined&&e!=null){e.setDisabled(true)}if(p!=undefined&&p!=null){p.setDisabled(true)}}if(m!=undefined&&m!=null){m.setDisabled(false)}if(c!=undefined&&c!=null){c.setDisabled(false)}if(n!=undefined&&n!=null){n.setDisabled(false)}if(k!=undefined&&k!=null){k.setDisabled(false)}if(ChangeServiceTargetButtonState!=undefined&&ChangeServiceTargetButtonState!=null){ChangeServiceTargetButtonState(ServiceTargetStatus)}refreshProblemListTimeOut();refreshProblemRelatedListTimeOut();if(_ServerVariables.ObjectMetadata.isCreateable){if(l!=undefined&&l!=null){l.setDisabled(false)}}else{if(l!=undefined&&l!=null){l.setDisabled(true)}}}stopWaitMsgBar()}function refreshProblemListTimeOut(){if(isNeedToRefreshProblemList&&isServiceCloudConsole!="true"){isNeedToRefreshProblemList=false;if(isRFConsoleDetailForm=="true"&&typeof(window.parent)!="undefined"&&typeof(window.parent)!=undefined){setTimeout(function(){window.parent.refreshListView("Problem__c")},2000)}else{setTimeout(function(){doRefresh()},2000)}}}function refreshProblemRelatedListTimeOut(){if(isNeedToRefreshRelatedList){var a=isFocusOnFormTab();setTimeout(function(){isNeedToRefreshRelatedList=false;isProblemRelatedListFrameLoaded=false;var b=document.getElementById("problemRelatedListFrameId");b.src="/apex/consoleProblemRelatedList?id="+recordId+"&isdtp=vw&obj=Problem__c";addOnLoadEvent(b,afterProblemRelatedListFrameLoad);if(isActivityFeedEnabled==true){loadContentsInActivityFeed(a)}if(isCISidebarEnabled==true&&recordId){loadContentsInRelatedCIs(a)}},2000)}}function getProblemData(a){recordId=a.Id;problemName=a.Name;recordState=a.state__c;categoryId=a.FKCategory__c;status=a.Stage__c;desc=a.Problem_Description__c;if(desc!=null&&desc!=""&&desc.length>500){desc=desc.substring(0,500)}ServiceTargetStatus=a.ServiceTargetStatus;isRecordLock=a.isRecordLock}function pasteResolution(a,b){Visualforce.remoting.Manager.invokeAction(_RemotingActions.pasteResolution,recordId,a,function(c,d){if(d.type==="exception"){alert(d.message)}else{refreshProblem()}},{escape:true})}function removeProblemData(){recordId=null;problemName=ProblemConsolePage.Labels.New;recordState="";categoryId="";status="";ServiceTargetStatus=""}function ChangeServiceTargetButtonState(a){var c=Ext.getCmp("servicetargets");var b=Ext.getCmp("ServiceTargetsButtonId");if(typeof(b!="undefined")&&b!=null){if(a==""){b.setDisabled(true)}else{b.setDisabled(false)}}if(typeof(c!="undefined")&&c!=null){if(a==""){c.disable()}else{c.enable()}}}function changeServiceTargetIcons(b,a){b.replaceCls("serviceTargetsEmpty","serviceTargetsDisable");b.replaceCls("serviceTargetsEnable","serviceTargetsDisable");b.replaceCls("serviceTargetsWarning","serviceTargetsDisable");b.replaceCls("serviceTargetsMissed","serviceTargetsDisable");if(a==ProblemConsolePage.Labels.ServiceTargetsOK){b.replaceCls("serviceTargetsDisable","serviceTargetsEnable")}else{if(a==ProblemConsolePage.Labels.ServiceTargetsMissed){b.replaceCls("serviceTargetsDisable","serviceTargetsMissed")}else{if(a==ProblemConsolePage.Labels.ServiceTargetsWarning){b.replaceCls("serviceTargetsDisable","serviceTargetsWarning")}}}if(isNewProblemForm){b.replaceCls("serviceTargetsDisable","serviceTargetsEmpty")}else{b.dom.title=ProblemConsolePage.Labels.ServiceTargets}}function handleServiceTargets(){screenHeight=400;screenWidth=1087;var a="FKProblem__c='"+recordId+"'";if(!ServiceTargetsBtnHandlerWindow||ServiceTargetsBtnHandlerWindow.closed){ServiceTargetsBtnHandlerWindow=window.open("/apex/SearchPage?popupId=ProblemServiceTarget&isLookup=true&filterClause="+escape(a)+"&standardLayout=true&iscalledFromConsole=true&popupFor=ServiceTargets&popupHeader="+problemName,"ServiceTarget","status = 1,height ="+screenHeight+", width ="+screenWidth+",left="+screenLeft(screenWidth)+",top="+screenTop(screenHeight)+", resizable = 0,scrollbars=no")}if(ServiceTargetsBtnHandlerWindow.focus){ServiceTargetsBtnHandlerWindow.focus()}}function startWaitMsgBar(){if(waitMsgBar!=""){waitMsgBar.setVisible(true)}}function setIsNeedToRefreshRelatedList(a){isNeedToRefreshRelatedList=a}function stopWaitMsgBar(){if(waitMsgBar!=""&&waitMsgBar.isVisible()){waitMsgBar.setVisible(false)}}function disableDetailFormButtons(){Ext.getCmp("saveId").setDisabled(true);Ext.getCmp("refreshId").setDisabled(true);disableActionMenuBtn(true);Ext.getCmp("ProblemFormBtnId").setDisabled(true);Ext.getCmp("ProblemReleatedListBtnId").setDisabled(true);Ext.getCmp("ProblemSmartViewBtnId").setDisabled(true);Ext.getCmp("agentToolsBtnId").setDisabled(true);Ext.getCmp("actionButton").setDisabled(true)}function ProblemConsolePageinReadMode(){Ext.getCmp("saveId").setDisabled(true);if(Ext.getCmp("reopenButtonId")!=undefined&&Ext.getCmp("reopenButtonId")!=null){Ext.getCmp("reopenButtonId").setDisabled(true)}if(Ext.getCmp("closeButtonId")!=undefined&&Ext.getCmp("closeButtonId")!=null){Ext.getCmp("closeButtonId").setDisabled(true)}if(Ext.getCmp("Submitforapproval")!=undefined&&Ext.getCmp("Submitforapproval")!=null){Ext.getCmp("Submitforapproval").setDisabled(true)}}function RTFEnabledPage(){if(isRTFEnabledProblemPage=="true"){return true}else{return false}}function afterSaveSucceed(){if(!isDeleted){isNeedToRefreshProblemList=true;isNeedToRefreshRelatedList=true;addOptionalToolbarItems();afterProblemDetailFrameLoad()}else{isNeedToRefreshProblemList=true;refreshProblemListTimeOut()}if(isActivityFeedEnabled==true){displayActivityFeed=true}if(isCISidebarEnabled==true){displayCISidebar=true}Ext.getCmp("ProblemSmartViewBtnId").setDisabled(false);clickedOnce=false;if(isServiceCloudConsole=="true"){sforce.console.setTabUnsavedChanges(false)}Ext.getCmp("helpIconSeparator").show();Ext.getCmp("detailViewToolbarId").doLayout()}function hideMenu(){var b=Ext.getCmp("mainMenu");if(b!="undefined"&&b!=null&&b!=""){Ext.getCmp("mainMenu").hide()}var a=Ext.getCmp("AgentToolsMenu");if(a!="undefined"&&a!=null&&a!=""){Ext.getCmp("AgentToolsMenu").hide()}}function disableActionMenuBtn(a){if(disableActionBtn){Ext.getCmp("actionButton").setDisabled(true)}else{Ext.getCmp("actionButton").setDisabled(a)}}function refreshRelatedLists(){isNeedToRefreshRelatedList=true;refreshProblemRelatedListTimeOut()}function disableAgentMenuItems(a){if(Ext.getCmp("knowledgeSearchButtonId")!=undefined&&Ext.getCmp("knowledgeSearchButtonId")!=null){Ext.getCmp("knowledgeSearchButtonId").setDisabled(a)}if(Ext.getCmp("createKnowledgeArticleButtonId")!=undefined&&Ext.getCmp("createKnowledgeArticleButtonId")!=null){Ext.getCmp("createKnowledgeArticleButtonId").setDisabled(a)}if(Ext.getCmp("CiExplorerButtonId")!=undefined&&Ext.getCmp("CiExplorerButtonId")!=null){Ext.getCmp("CiExplorerButtonId").setDisabled(a)}if(Ext.getCmp("ServiceTargetsButtonId")!=undefined&&Ext.getCmp("ServiceTargetsButtonId")!=null){Ext.getCmp("ServiceTargetsButtonId").setDisabled(a)}if(Ext.getCmp("ProblemManifestButtonId")!=undefined&&Ext.getCmp("ProblemManifestButtonId")!=null){Ext.getCmp("ProblemManifestButtonId").setDisabled(a)}}function disableActionMenuItems(a){if(Ext.getCmp("addNoteId")!=undefined&&Ext.getCmp("addNoteId")!=null){Ext.getCmp("addNoteId").setDisabled(a)}if(Ext.getCmp("emailId")!=undefined&&Ext.getCmp("emailId")!=null){Ext.getCmp("emailId").setDisabled(a)}if(Ext.getCmp("reopenButtonId")!=undefined&&Ext.getCmp("reopenButtonId")!=null){Ext.getCmp("reopenButtonId").setDisabled(a)}if(Ext.getCmp("closeButtonId")!=undefined&&Ext.getCmp("closeButtonId")!=null){Ext.getCmp("closeButtonId").setDisabled(a)}if(Ext.getCmp("cloneButtonId")!=undefined&&Ext.getCmp("cloneButtonId")!=null){Ext.getCmp("cloneButtonId").setDisabled(a)}if(Ext.getCmp("printId")!=undefined&&Ext.getCmp("printId")!=null){Ext.getCmp("printId").setDisabled(a)}if(Ext.getCmp("printPDFId")!=undefined&&Ext.getCmp("printPDFId")!=null){Ext.getCmp("printPDFId").setDisabled(a)}if(Ext.getCmp("newActionId")!=undefined&&Ext.getCmp("newActionId")!=null){Ext.getCmp("newActionId").setDisabled(a)}if(Ext.getCmp("Submitforapproval")!=undefined&&Ext.getCmp("Submitforapproval")!=null){Ext.getCmp("Submitforapproval").setDisabled(a)}}function setTabUnsavedChanges(){if(isServiceCloudConsole=="true"){sforce.console.setTabUnsavedChanges(true)}}document.onkeydown=function(g){var c,a,d;d=0;if(isRFConsoleDetailForm=="true"){c=window.parent;d=window.parent.count}a=window.self;var f=document.getElementById("problemDetailsFrameId");var b="";if(f.src==""){b="ListViewNewButton"}else{if((typeof(f)!="undefined"&&f!=null)&&f.src!=""){b="newId"}}if(!window.isRFHotkeysDisabled){handleShortcuts(g,c,a,d,isRFConsoleDetailForm,b)}};function addSConsoleTab(c,b){try{SconsoletabName=b;sforce.console.openPrimaryTab(null,c,true," ",addSConsoleTabComplete)}catch(a){}}function addSConsoleTabComplete(a){try{console.log("result.success=="+a.success);if(a.success==true){var c=new Date();c.setYear(c.getFullYear()+10);document.cookie=SconsoletabName+"="+a.id+";expires="+c.toUTCString()+";path=/;SameSite=None;Secure"}else{if(Ext.util.Cookies.get(SconsoletabName)!=null){sforce.console.focusPrimaryTabById(Ext.util.Cookies.get(SconsoletabName))}}}catch(b){}}function refreshProblemFormTimeOut(){if(isNeedToRefreshProblem){var a=isFocusOnFormTab();setTimeout(function(){isNeedToRefreshProblem=false;var b=document.getElementById("problemDetailsFrameId");b.src="/apex/ConsoleProblemDetail?id="+recordId;if(isActivityFeedEnabled==true){loadContentsInActivityFeed(a)}if(isCISidebarEnabled==true&&recordId!=null){loadContentsInRelatedCIs(a)}},2000)}}function enableCustomActions(){var b=Ext.getCmp("mainMenu").items;if(b!="undefined"&&b!=null&&b!=""){for(var d=0;d<b.length;d++){var a=b.items[d];if(a.id!="undefined"&&a.openIn!="undefined"&&typeof(a.openIn)!="undefined"){Ext.getCmp(a.id).setDisabled(false)}}}var c=Ext.getCmp("AgentToolsMenu").items;if(c!="undefined"&&c!=null&&c!=""){for(var d=0;d<c.length;d++){var a=c.items[d];if(a.id!="undefined"&&a.openIn!="undefined"&&typeof(a.openIn)!="undefined"){Ext.getCmp(a.id).setDisabled(false)}}}}function loadContentsInActivityFeed(a){if(isCalledFromActivityFeed!=true){activityFeedRefreshStarted();var b=document.getElementById("problemSmartViewSidebarFrameId");if(typeof b!="undefined"&&b!=null){b.src="/apex/DeepView?id="+recordId+"&showSidebarOnly=true&moduleName=Problem__c"}}isCalledFromActivityFeed=false;if(a){enableActivityFeed()}}function loadContentsInRelatedCIs(a){if(isBaseElementAccessible==true&&isServicesAndCISliderEnabled==true){RelatedCIRefreshStarted();var b=document.getElementById("relatedCISmartViewSidebarFrameId");if(typeof b!="undefined"&&b!=null){b.src="/apex/CIAssetSlideIn?id="+recordId+"&objName=Problem__c"}if(a){enableRelatedCI()}}}function addOptionalToolbarItems(){if(!isOptionalItemsAdded){var a=Ext.getCmp("detailViewToolbarId");var b=0;a.insert(++b,{xtype:"label",id:"ProblemStatusId",cls:"recordStage",text:status});a.insert(++b,{xtype:"tbspacer",width:5});a.insert(++b,"-");a.insert(++b,{xtype:"label",autoEl:{tag:"label",width:"25px",title:(recordId==null||recordId==""||recordId=="new")?"":ProblemConsolePage.Labels.ServiceTargets},cls:"serviceTargetsEmpty",border:false,id:"servicetargets",disabled:(ServiceTargetStatus==""),listeners:{disable:function(d){changeServiceTargetIcons(d.getEl(),ServiceTargetStatus)},enable:function(d){changeServiceTargetIcons(d.getEl(),ServiceTargetStatus)},render:function(d){d.getEl().on({click:function(c){if(ServiceTargetStatus!=""){handleServiceTargets()}},scope:d})}}});a.insert(++b,"-");a.insert(++b,{xtype:"tbspacer",width:5});isOptionalItemsAdded=true}}function loadContentsInSmartViews(){var a=document.getElementById("problemSmartViewFrameId");showDiv(a);if(typeof((a)!="undefined"&&a.src=="")||isNeedToRefreshSmartView==true){startWaitMsgBar();loadProblemSmartView(recordId)}else{showDiv(smartViewFrameId)}stopWaitMsgBar()}function addOnLoadEvent(b,a){if(b.addEventListener){b.addEventListener("load",a)}else{if(b.attachEvent){b.attachEvent("onload",a)}}};