var SelectedFieldsGrid,RecordTypeOptions,saveBtntoolbar;Ext.onReady(function(){Ext.require(["Ext.data.*","Ext.grid.*"]);getWaitbox();Ext.define("RecordTypeDataModel",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"label",type:"string"}]});RecordTypeOptionsStore=Ext.create("Ext.data.Store",{model:"RecordTypeDataModel",sorters:[{property:"label",direction:"ASC"}],data:RecordTypeOptionsData});RecordTypeOptions=new Ext.form.ComboBox({store:RecordTypeOptionsStore,queryMode:"local",displayField:"label",valueField:"name",value:selectedRecordType,listeners:{select:function(c,a,b){showWaitbox();if(a!=null&&a[0].data!=null){ChangeGridData(a[0].data.name)}}},id:"RecordTypeOptions",renderTo:"RecordTypesCombo"});Ext.define("LeftPanelModel",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"label",type:"string"}]});KAfieldsStore=Ext.create("Ext.data.Store",{model:"LeftPanelModel",sorters:[{property:"label",direction:"ASC"}],data:KaFieldsData});KAFieldsGrid=new Ext.grid.Panel({store:KAfieldsStore,overflowX:"hidden",overflowY:"auto",multiSelect:true,columns:[{text:"Name",dataIndex:"name",hidden:true},{text:fields,dataIndex:"label",sortable:false,width:"100%",menuDisabled:true}],listeners:{itemclick:function(b,a,f,c,g,d){if(a!=null&&a.data!=null){RecordId=a.data.name;RecordName=a.data.label}}},width:350,height:210,renderTo:"KAfieldsGrid"});Ext.define("RightPanelModel",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"label",type:"string"},{name:"isResolutionField",type:"boolean"}]});Ext.require(["Ext.data.*","Ext.grid.*"]);SelectedfieldsStore=Ext.create("Ext.data.Store",{model:"RightPanelModel",data:SelectFieldsData});SelectedFieldsGrid=new Ext.grid.Panel({store:SelectedfieldsStore,overflowX:"hidden",overflowY:"auto",multiSelect:true,columns:[{text:"Name",dataIndex:"name",hidden:true},{text:fields,dataIndex:"label",sortable:false,width:"60%",menuDisabled:true},{text:resValue,dataIndex:"isResolutionField",checkOnly:true,flex:0.2,sortable:false,menuDisabled:true,draggable:false,resizable:false,tooltip:resValueTooltip,tooltipType:"title",renderer:function(e,f,a,c){if(a!=null){var d=SelectedFieldsGrid.getSelectionModel().getSelection();RowIndex=c;if(a.dirty){AlreadySelected=[];Checked=RowIndex;ctrlSelectWhenChecked=RowIndex}var b="'"+a.get("name")+"'";c="'"+c+"'";if(e==true){return'<center><input onclick="updateIsRes(false,'+b+","+c+');"  type="checkbox" checked /></center>'}else{return'<center><input onclick="updateIsRes(true,'+b+","+c+');" type="checkbox" /></center>'}}}}],listeners:{itemclick:function(b,a,h,c,j,f){Checked="";var g=SelectedFieldsGrid.getSelectionModel().getSelection();if(j.type=="click"&&j.ctrlKey==false){AlreadySelected=[];Indexes=[]}if(ctrlSelectWhenChecked!=""){Indexes[0]=ctrlSelectWhenChecked}if(AlreadySelected.length!=0){if(ctrlSelectWhenChecked!=""){Indexes[0]=ctrlSelectWhenChecked}Indexes=Indexes.concat(AlreadySelected)}if(a!=null&&a.data!=null){RecordId=a.data.name;RecordName=a.data.label;ResolutionValue=a.data.isResolutionField}RowIndex=c;for(var d=0;d<g.length;d++){if(Indexes[d]==null){Indexes[d]=RowIndex}}}},viewConfig:{markDirty:false},width:350,height:210,renderTo:"SelectedFieldsGrid"});saveBtntoolbar=Ext.create("Ext.toolbar.Toolbar",{border:false,height:40,margins:"0 0 0 -7",autoWidth:true,renderTo:"divTB",cls:"configureTrCls",items:[{scale:"medium",iconCls:"saveIcon",tooltipType:"title",tooltip:save,id:"saveBtn",handler:saveBtnHandler},"->",{xtype:"label",html:'<a href="#" onclick="OpenHelppage();"><img title="'+helpLabel+'" height="17" width="17" id="helpIcon" src="'+SDEFStylesPATH+'/SDEFbuttons/b_console_help.png"></a>'},{xtype:"tbspacer",width:15}]});SetIcon();document.getElementById(FormId).style.display="block";saveBtntoolbar.doLayout()});function OpenHelppage(){var a="helpfile.htm";if(wikiUrl!=null&&wikiUrl!=undefined&&wikiUrl!=""){window.open(wikiUrl,false,"width="+screen.width+",height="+screen.height+",resizable = 1,scrollbars=yes,status=1,top=0,left=0",false)}else{window.open(helpResource+"/"+a,false,"width="+screen.width+",height="+screen.height+",resizable = 1,scrollbars=no,status=1,top=0,left=0",false)}}function saveBtnHandler(){var d=false;if(SelectFieldsData!=null&&SelectFieldsData!=""){for(var a=0;a<SelectFieldsData.length;a++){if("true"===SelectFieldsData[a].isResolutionField||true===SelectFieldsData[a].isResolutionField){d=true;break}}if(d){showWaitbox();if(document.getElementById("customIconID").checked==true&&(Icon_id=="DEFAULT_ICON"||Icon_id=="")){Icon_id="DEFAULT_ICON";setDefaultIcon()}var c=Ext.JSON.encode(SelectFieldsData);c=c+NPRINT+"Icon_id:"+Icon_id;var b=RecordTypeOptions.getValue();if(Saved_Icon=="DEFAULT_ICON"||Saved_Icon==""||Saved_Icon==Icon_id){Saved_Icon=""}saveData(c,b,Saved_Icon)}else{showErrorMessage(ResErrorMsg)}}else{showErrorMessage(errorMsg)}}function updateIsRes(e,d,c){if(SelectedfieldsStore!=null){d=SelectedfieldsStore.getAt(c)}if(typeof(d)!=null&&typeof(d)!=""&&typeof(d)!="undefined"){d.set("isResolutionField",e)}if(SelectFieldsData!=null){SelectFieldsData[c].isResolutionField=e}var a=SelectedFieldsGrid.getSelectionModel();var b=SelectedFieldsGrid.getSelectionModel().selected;a.select(parseInt(c));RowIndex=c;if(Ext.IE){grid.getView().refresh()}}function moveNext(){var c=KAFieldsGrid.getSelectionModel().getSelection();var d=true;for(var b=0;b<c.length;b++){KAfieldsStore.remove(c[b])}for(var b=0;b<c.length;b++){for(var a=0;a<KaFieldsData.length;a++){if(c[b].data.name==KaFieldsData[a].name){KaFieldsData.splice(a,1);break}}}KAFieldsGrid.getView().refresh();for(var b=0;b<c.length;b++){if(c[b].data.name!=""){var d=false}}if(!d){if(SelectedFieldsGrid.store.findExact("name",RecordId)==-1){for(var b=0;b<c.length;b++){SelectFieldsData.push({name:c[b].data.name,label:c[b].data.label,isResolutionField:false,})}if(SelectedfieldsStore!=null&&SelectedfieldsStore!="undefined"&&SelectFieldsData!=null){SelectedFieldsGrid.store.loadData(SelectFieldsData)}SelectedFieldsGrid.getView().refresh()}}for(var b=0;b<c.length;b++){c[b].data.name=""}}function movePrevious(){var c=SelectedFieldsGrid.getSelectionModel().getSelection();var d=true;for(var b=0;b<c.length;b++){SelectedfieldsStore.remove(c[b])}for(var b=0;b<c.length;b++){for(var a=0;a<SelectFieldsData.length;a++){if(c[b].data.name==SelectFieldsData[a].name){SelectFieldsData.splice(a,1);break}}}SelectedFieldsGrid.getView().refresh();for(var b=0;b<c.length;b++){if(c[b].data.name!=""){d=false}}if(!d){if(KAFieldsGrid.store.findExact("name",RecordId)==-1){for(var b=0;b<c.length;b++){KaFieldsData.push({name:c[b].data.name,label:c[b].data.label,})}if(KAfieldsStore!=null&&KAfieldsStore!="undefined"&&KaFieldsData!=null){KAFieldsGrid.store.loadData(KaFieldsData)}KAFieldsGrid.getView().refresh()}}for(var b=0;b<c.length;b++){c[b].data.name=""}}function moveSelectedRow(h){ctrlSelectWhenChecked="";var g=SelectedFieldsGrid.getSelectionModel().getSelection();if(Checked!==""){Indexes=[];Indexes[0]=Checked}var b=SelectedFieldsGrid.getSelectionModel().hasSelection();if(!b){return}for(var f=0;f<g.length;f++){resolutionField[f]=g[f].data.isResolutionField}if(g.length==AlreadySelected.length&&AlreadySelected.length!=0){for(var f=0;f<AlreadySelected.length;f++){Indexes[f]=AlreadySelected[f]}}var e=RowIndex;var b=SelectedfieldsStore.getAt(e);var d=SelectedfieldsStore.getCount();var a=SelectedFieldsGrid.getSelectionModel();if(h=="up"){for(var f=0;f<Indexes.length;f++){Indexes[f]--;if(Indexes[f]<0){return}}for(var f=0;f<Indexes.length;f++){RowIndex--}}else{if(h=="down"){for(var f=0;f<Indexes.length;f++){Indexes[f]++;if(Indexes[f]>=d){return}}for(var f=0;f<Indexes.length;f++){RowIndex++}}}for(var f=0;f<g.length;f++){SelectedfieldsStore.remove(g[f])}for(var f=0;f<g.length;f++){for(var c=0;c<SelectFieldsData.length;c++){if(g[f].data.name==SelectFieldsData[c].name){SelectFieldsData.splice(c,1);break}}}Indexes.sort();for(var f=0;f<Indexes.length;f++){SelectFieldsData.splice(Indexes[f],0,{name:g[f].data.name,label:g[f].data.label,isResolutionField:resolutionField[f],})}if(SelectedfieldsStore!=null&&SelectedfieldsStore!="undefined"&&SelectFieldsData!=null){SelectedFieldsGrid.store.loadData(SelectFieldsData)}AlreadySelected=[];for(var f=0;f<Indexes.length;f++){a.select(Indexes[f],true);AlreadySelected[f]=Indexes[f]}Indexes=[];Checked="";SelectedFieldsGrid.getView().refresh()}function getWaitbox(){var a=new Ext.LoadMask(Ext.getBody(),{msg:PleaseWait,id:"waitMsggId"})}function showWaitbox(){if(Ext.getCmp("waitMsggId")!=null){Ext.getCmp("waitMsggId").show()}}function hideWaitbox(){if(Ext.getCmp("waitMsggId")!=null){Ext.getCmp("waitMsggId").hide()}}function showSaveMessage(){Ext.MessageBox.show({id:"SaveMsgbox",minWidth:300,msg:SaveMsg,buttons:Ext.MessageBox.OK})}function showErrorMessage(a){Ext.MessageBox.show({id:"ErrorMsgbox",minWidth:300,msg:a,buttons:Ext.MessageBox.OK})}function enableBrowse(){if(folderId!=""){document.getElementById("browseIconId").disabled=false}var a=document.getElementById(recordType_id);a.src=img_trans;a.className="";if(Icon_X!=""&&Icon_X!="DEFAULT_ICON"){getImageID(Icon_X)}}function disableBrowse(){Icon_id="DEFAULT_ICON";setDefaultIcon()}function setDefaultIcon(){document.getElementById("defaultIconID").checked=true;document.getElementById("browseIconId").disabled=true;var b=RecordTypeOptions.getValue();var a=document.getElementById(recordType_id);a.src=img_trans;if(b=="FAQ¬"+OrgNamespace){a.className="KMFAQ"}else{if(b=="How_To¬"+OrgNamespace){a.className="KMHowTo"}else{if(b=="Known_Error¬"+OrgNamespace){a.className="KMKMKnownError"}else{if(b=="Problem_Solution¬"+OrgNamespace){a.className="KMProblemSolution"}else{a.className="KMCustomRT"}}}}}var popUpWindow;function openImagePopup(){if(document.getElementById("customIconID").disabled==false&&folderId!=""){var a="DocPage?folderId="+folderId;popUpWindow=new Ext.Window({height:232,width:470,title:AddImage,x:10,y:5,modal:true,resizable:false,bodyStyle:"background-color:#FFFFFF;",constrain:true,viewConfig:{forceFit:true},frame:true,html:'<iframe frameborder="0" src ="/apex/'+a+'" style="width:100%;height:100%;border:none"/>'});popUpWindow.show()}}function closePopup(){if(popUpWindow!=null&&popUpWindow!=undefined){popUpWindow.close()}}function changeIconTypeSelection(){if(Icon_id=="DEFAULT_ICON"||Icon_id==""){setDefaultIcon()}else{getImageID(Icon_id);document.getElementById("customIconID").checked=true;document.getElementById("browseIconId").disabled=false}};