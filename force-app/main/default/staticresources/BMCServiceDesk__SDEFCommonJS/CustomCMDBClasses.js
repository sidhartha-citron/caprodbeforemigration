var sprClsTree="";var winReference;var applySTStr="";var EF="Ñ„";var clickedOnce=false;var changeDone=false;var waitMask="";var popUpString="";var warningIcon=Ext.MessageBox.WARNING;var ruleOrderIndex=1;var ruleGridStore;var ruleGrid;var fieldListStore;var fieldSelComboBox;var operatorComboBoxStore;var selectedRecord;var associatedRuleStore;var warningIcon=Ext.MessageBox.WARNING;var operatorSelComboBox;var logOpeStore;var ruleGrpingBooleanSelComboBox;var assetClassGridSelectedRec=-1;var updateButton=document.getElementById("updateRuleButtonId");var updateRecordIndex;var rowIndex=-1;var pickListComboStore;var pickListComboBx;var booleanComboStore;var booleanComboBx;var compTypeNo=0;var selectedTextAreaLength=0;var selectedLabel;var relatedRecordGrid;var RBAComp="Rule Based Asset";var temporaryArray;var addFilterComp;var clearFilterComp;var ruleLogicComp;function getSprCls(){var a=document.getElementById("sprClsTree");if(a.hasChildNodes()){while(a.hasChildNodes()){a.removeChild(a.lastChild)}}if(Ext.getCmp("filterLogic").getValue()){Ext.getCmp("filterLogic").setValue("")}var b=document.getElementById(sprClsFld).value;sprClsTree="";if(b!=null&&b!=""){Visualforce.remoting.Manager.invokeAction(_CMDBclsRemotingActions.getSprCls,b,function(c,g){if(g.status){if(c!=""&&c!=null&&c!=invldSprClsErrMsg){var f=c.split(String.fromCharCode(1087));var e=JSON.parse(f[0]);for(i=(e.length-1);i>=0;i--){sprClsTree=sprClsTree+e[i];if(i>0){sprClsTree=sprClsTree+"-->"}}if(f[1]!=""&&f[1]!=null){jsSprClsName=f[1]}var h=document.createElement("label");var d=document.createTextNode(sprClsTree);h.appendChild(d);a.appendChild(h)}else{document.getElementById(sprClsFld).value="";var h=document.createElement("label");h.setAttribute("class","sprClsErrorMsgCss");var d=document.createTextNode(c);h.appendChild(d);a.appendChild(h)}}},{escape:false})}}function openPopupDialog(d,f,c,g,e){if(c==null||c==""){c=""}if(g==null||g==""){g=550}if(e==null||e==""){e=670}onCompleteFunction=f;var b=d.split("?");var a="background-color:#FFFFFF;";popUpWindow=new Ext.Window({height:g,width:e,title:c,x:10,y:5,modal:true,resizable:false,bodyStyle:a,constrain:true,viewConfig:{forceFit:true},html:'<iframe frameborder="0" src ="/apex/'+d+'" style="width:100%;height:100%;border:none"/>',});popUpWindow.show()}function openObjectPage(a){if(winReference!=null){winReference.close();winReference=null}if(a=="CustomFields"){winReference=window.open("/"+objId+"?setupid=CustomObjects#"+objId+"_CustomFieldRelatedList_target","C"+objId)}else{if(a=="FieldSets"){winReference=window.open("/"+objId+"?setupid=CustomObjects#FieldSetList_target","C"+objId)}}winReference.focus();return false}function saveAllow(){showMessage(errorImageMsg)}function showMngAttr(){if(CMDBClassTypeCombo!=""&&typeof(CMDBClassTypeCombo)!="undefined"&&CMDBClassTypeCombo=="Rule Based Asset"){document.getElementById("customOptions").style.display="none"}else{if(cId!=null&&cId!=""){document.getElementById("customOptions").setAttribute("class","linkdiv")}}}function setBrowseButtonCheck(a){if(a=="browsebtn1"){browse1checked="true"}else{if(a=="browsebtn2"){browse1checked="false"}}}function showRulesData(){}function openQualLookup(){if(popUpString=="BMC BaseElement"){popUpString="BMC_BaseElement"}else{if(popUpString=="User"||popUpString=="Group"){openPopup("SearchPage?popupId=Client&isQueurorUser=true&isLookup=true&idNameForPopUp=true",setReferenceToVal,450,600,true)}else{if(popUpString=="SYSTemplate__c"){openPopup("SearchPage?popupId=SYSTemplate__c&isLookup=true&idNameForPopUp=true&referenceObjectName=SYSTemplate__c&filterClause="+escape("templateFor__c='Incident'"),setReferenceToVal,450,600,true)}else{if(popUpString=="BMC_BaseElement__c"){if(ciLookup==Namespace.toLowerCase()+"fkbusinessservice__c"||ciLookup==Namespace.toLowerCase()+"fkserviceoffering__c"){if(ciLookup==Namespace.toLowerCase()+"fkbusinessservice__c"){OfferingClause=escape("(serviceType__c != 'Offering') AND (MarkAsDeleted__c = false)")}else{if(ciLookup==Namespace.toLowerCase()+"fkserviceoffering__c"){OfferingClause=escape("(serviceType__c = 'Offering') AND (MarkAsDeleted__c = false)")}}openPopup("SearchPage?popupId=BMC_BusinessService__c&isLookup=true&idNameForPopUp=true&referenceObjectName=BMC_BusinessService__c&filterClause="+OfferingClause,setReferenceToVal,450,600,true)}else{if(ciLookup==Namespace.toLowerCase()+"fklocation__c"){OfferingClause=escape("(Class__c = 'BMC_PhysicalLocation')");openPopup("SearchPage?popupId=BMC_BaseElement__c&isLookup=true&idNameForPopUp=true&referenceObjectName=BMC_BaseElement__c&filterClause="+OfferingClause,setReferenceToVal,450,600,true)}else{OfferingClause=escape("(MarkAsDeleted__c = false)");openPopup("SearchPage?popupId=BMC_BaseElement__c&isLookup=true&idNameForPopUp=true&referenceObjectName=BMC_BaseElement__c&filterClause="+OfferingClause,setReferenceToVal,450,600,true)}}}else{openPopup("SearchPage?popupId="+popUpString+"&isLookup=true&idNameForPopUp=true&referenceObjectName="+popUpString,setReferenceToVal,450,600,true)}}}}}function setReferenceToVal(b){if(b.indexOf(EF)>0){referenceId=b.split(EF)[0];referenceName=b.split(EF)[1]}referenceName=Ext.util.Format.htmlDecode(referenceName);var a=getInputTxtEle();if(a!=null&&typeof(a)!="undefined"){a.value=referenceName;var c=document.getElementById("referenceID");if(c!=null&&typeof(c)!="undefined"){c.value=referenceId}}}Ext.onReady(function(){if(CMDBClassTypeCombo==""||typeof(CMDBClassTypeCombo)=="undefined"){CMDBClassTypeCombo=CI}createRuleGrid();var c=Ext.create("Ext.data.Store",{fields:["value","name"],data:[{value:"CI",name:CI},{value:"Asset",name:Asset},{value:"Rule Based Asset",name:RuleBasedAsset},{value:"CI and Asset",name:CIandAsset}],listeners:{load:function(h,g,k,j){if(!isCIManagementEnabled){h.removeAt(3);h.removeAt(0)}}}});var b={items:[{id:"newInputBtn",tooltipType:"title",scale:"medium",iconCls:"bmcNewSLT",handler:addInputBtnHandler,tooltip:newToolTip},{id:"editInputBtn",tooltipType:"title",scale:"medium",iconCls:"bmcEditSLTDisable",handler:editInputBtnHandler,disabled:false,tooltip:editToolTip},{id:"delInputBtn",tooltipType:"title",scale:"medium",iconCls:"bmcDeleteSLTDisable",handler:delInputBtnHandler,disabled:false,tooltip:deleteToolTip}]};var e=Ext.create("Ext.form.ComboBox",{id:"classType",store:c,queryMode:"local",hiddenName:"classTypeCombo",displayField:"name",valueField:"value",value:CMDBClassTypeCombo,forceSelection:true,selectOnFocus:true,width:195,cls:"ClsTypeCSS",renderTo:CMDBclassType,listeners:{afterrender:function(h,g){if(CMDBClassTypeCombo=="Rule Based Asset"){h.setDisabled(true)}},select:function(l,h,j){var g=CMDBClassTypeCombo;CMDBClassTypeCombo=h[0].get(l.valueField);if(!nCls){var k="";if(CMDBClassTypeCombo=="Rule Based Asset"){k=CanNotChangeClassTypeToRBA}else{if(g=="CI"&&associatedRuleStore!=""&&typeof(associatedRuleStore)!="undefined"&&associatedRuleStore.data.length>0){k=CanNotChangeClassTypeErrorMsg}}if(k!=""&&typeof(k)!="undefined"){showMessage(k);if(g!=""&&typeof(g)!="undefined"){CMDBClassTypeCombo=g;Ext.getCmp("classType").setValue(g)}}}if(isAssetManagementEnabled==true){a()}else{document.getElementById("showrules").style.display="none"}},change:function(l,k,g,j){if(k=="Rule Based Asset"){var h=document.getElementById(sprClsId);if(sprClsId&&h){h.value=""}h=document.getElementById("sprClsTree");if(h){RemedyForceHTMLProcessor.clearHTML(h)}h=document.getElementById(ruleClsFld);if(ruleClsFld&&h){h.value=""}}}}});if(CMDBClassTypeCombo=="undefined"||CMDBClassTypeCombo==""||CMDBClassTypeCombo==null){Ext.getCmp("classType").setValue("CI")}if(isAssetManagementEnabled==true){a()}else{document.getElementById("showrules").style.display="none"}associatedRuleStore=Ext.create("Ext.data.ArrayStore",{storeId:"associatedRules",sorters:{property:"name",direction:"ASC"},fields:["name","rule","id","IsCustom"],data:ruleGridData});function a(){var g=document.getElementById(AbsIpFldRef);if(CMDBClassTypeCombo==null||CMDBClassTypeCombo==""||typeof(CMDBClassTypeCombo)=="undefined"){CMDBClassTypeCombo="Asset"}if(CMDBClassTypeCombo=="Asset"){document.getElementById("showrules").style.display="none";document.getElementById("RuleSectionDiv").style.display="none";if(g!=null){g.disabled=false}}else{if(CMDBClassTypeCombo=="CI"){if(!nCls){document.getElementById("showrules").style.display="block"}document.getElementById("RuleSectionDiv").style.display="none";if(g!=null){g.disabled=false}}else{if(CMDBClassTypeCombo=="Rule Based Asset"){document.getElementById("showrules").style.display="none";document.getElementById("RuleSectionDiv").style.display="block";if(g!=null){g.disabled=true;g.checked=false}}else{if(CMDBClassTypeCombo=="CI and Asset"){document.getElementById("showrules").style.display="none";document.getElementById("RuleSectionDiv").style.display="none";if(g!=null){g.disabled=false}}}}}}function f(l,j,g,m,k,h){return'<a onclick="showRulesData()">'+l+"</a>"}relatedRecordGrid=new Ext.grid.GridPanel({store:associatedRuleStore,stripeRows:true,id:"ruleGridLayout",enableHdMenu:false,border:false,layout:"fit",tbar:b,forceFit:true,autoWidth:true,scroll:"vertical",columns:[{header:AssetClass,dataIndex:"name",flex:1,renderer:f,menuDisabled:true},{header:Rule,dataIndex:"rule",flex:1,menuDisabled:true},{header:"IsCustom",dataIndex:"IsCustom",flex:1,menuDisabled:true,hidden:true},{dataIndex:"id",hidden:true}],viewConfig:{emptyText:MsgNoRecordFoundSearchPage,deferEmptyText:false,margin:"0 0 0 10"},height:160,renderTo:"linkedRules",listeners:{itemclick:function(k,h,m,j,o){assetClassGridSelectedRec=j;var l=k.getSelectionModel().getSelection();if(l.length>0){var g=Ext.getCmp("delInputBtn");var n=Ext.getCmp("editInputBtn");if(h.data.IsCustom=="true"){g.setDisabled(false);g.setIconCls("bmcDeleteSLT")}else{g.setDisabled(true);g.setIconCls("bmcDeleteSLTDisable")}n.setDisabled(false);n.setIconCls("bmcEditSLT")}}}});var d=Ext.create("Ext.toolbar.Toolbar",{title:"",cls:"mnuBarCls",id:"mnuBarId",renderTo:"tbar",items:[{scale:"medium",iconCls:"bmcNew",tooltipType:"title",tooltip:newToolTip,scope:this,id:"newId",handler:function(){window.parent.addTab("CustomCMDBClasses",headerWinTab,headerWinTab)}},{scale:"medium",iconCls:"bmcSave",cls:"leftAllign30",tooltipType:"title",id:"saveId",scope:this,tooltip:saveToolTip,handler:function(){if(setClassName()){if(checkForEncryptedOrDeletedField()){showLoadingMask(saveMaskMsg);CIandSubclassCheck()}}}},{scale:"medium",iconCls:"bmcDeleteDisable",cls:"leftAllign62",disabled:true,tooltipType:"title",tooltip:deleteToolTip,scope:this,id:"deleteId",handler:function(){Ext.Msg.show({title:deleteToolTip,msg:delCnfrmMsg,minWidth:300,maxWidth:360,minHeight:110,buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.WARNING,fn:function(g){if(g=="yes"){if(custCls){if(cId!=""&&classID!=""){showLoadingMask(delMaskMsg);Visualforce.remoting.Manager.invokeAction(_CMDBclsRemotingActions.delCls,classID,cId,function(h,j){hideLoadingMask();if(j.status){if(h=="Delete Successful"){window.parent.refreshList();window.parent.closeTab(wid)}else{showMessage(h)}}},{escape:false})}}else{showMessage(delOOTBClsMsg)}}}})}},{scale:"medium",cls:"activateBtnCls",text:getLblofActivateBtn("lbl"),tooltipType:"title",tooltip:getLblofActivateBtn("tltp"),scope:this,hidden:true,id:"activateBtnId",handler:function(){showLoadingMask(statusMaskMsg);activateDeactivateClass()}}]});showInfoIcon();if(nCls==false){showHideActivateAndSyncBtn()}disableSprClsBtnForRBACls();enableDelBtn();handleElemEvent();setInitialRadioChecked();setTooltip();sprClsFldAppearenceHandler();showMngAttr();if((nCls==false)&&(custCls==true)&&(fldSetRecReq==true)){dispFieldSetRec()}if(!(nCls==false)){Ext.getCmp("newInputBtn").setDisabled(true);populateRuleClassData(initSuperClassId+EF+initSprCls)}if(CMDBClassTypeCombo=="Rule Based Asset"){loadDataToGrids()}if(isAssetManagementEnabled==true){a()}else{document.getElementById("showrules").style.display="none"}if(nCls||isAbstractClass){document.getElementById("showrules").style.display="none"}else{disableRuleGrid()}});function checkForEncryptedOrDeletedField(){fieldSelComboBox.reset();var a=ruleGridStore.data.length;for(var b=0;b<a;b++){var c=ruleGridStore.getAt(b);if(fieldListStore.find("label",c.get("operandFieldLabel").trim())<=-1){Ext.MessageBox.alert(lblInvalidCondition,lblQVEncryptionError);return false}}return true}var delInputBtnHandler=function(){if(assetClassGridSelectedRec!=-1){var a=associatedRuleStore.getAt(assetClassGridSelectedRec).get("id");if(a!=null&&a!=""){Ext.MessageBox.confirm(labelDelete,labelInputDeleteConfirmMsg,function(b){if(b==="yes"){showLoadingMask(delMaskMsg);Visualforce.remoting.Manager.invokeAction(_CMDBclsRemotingActions.delCls,"",a,function(c,d){hideLoadingMask();if(d.status){if(c=="Delete Successful"){window.parent.refreshList();relatedRecordGrid.getStore().remove(associatedRuleStore.getAt(assetClassGridSelectedRec));assetClassGridSelectedRec=-1}else{showMessage(c)}}},{escape:false})}})}}};var editInputBtnHandler=function(){if(assetClassGridSelectedRec!=-1){var a=associatedRuleStore.getAt(assetClassGridSelectedRec).get("id");if(a){window.parent.addTab("CustomCMDBClasses?id="+a,associatedRuleStore.getAt(assetClassGridSelectedRec).get("name"),associatedRuleStore.getAt(assetClassGridSelectedRec).get("name"))}assetClassGridSelectedRec=-1}};var addInputBtnHandler=function(){var a;if(typeof(ClsName)!="undefined"&&ClsName!=""){a="CustomCMDBClasses?FromRelatedRec=true&ClassName="+ClsName}else{a="CustomCMDBClasses?FromRelatedRec=true"}window.parent.addTab(a,headerWinTab,headerWinTab)};function getLblofActivateBtn(a){if(a=="lbl"){if(activateVar==false){return activateLbl}else{return deactivateLbl}}else{if(a=="tltp"){if(activateVar==false){return ActBtnToolTipLbl}else{return DeactBtnToolTipLbl}}}}function checkForRuleChange(){var a=Ext.getCmp("activateBtnId");a.setText(getLblofActivateBtn("lbl"));a.setTooltip(getLblofActivateBtn("tltp"))}function showHideActivateAndSyncBtn(){var a=Ext.getCmp("classType");if(clsId!=""&&clsId!=null&&a.value==RBAComp){var b=Ext.getCmp("activateBtnId");b.setVisible(true)}}function ActivationDeactivationComplete(){hideLoadingMask();if(activateVar==true&&exceptionWhileAorD=="activated"){disableRuleGrid();Ext.getCmp("activateBtnId").setText(deactivateLbl);Ext.getCmp("activateBtnId").setTooltip(DeactBtnToolTipLbl);Ext.Msg.show({msg:((isEncryptedFieldPresent!=null&&typeof(isEncryptedFieldPresent)!="undefined"&&isEncryptedFieldPresent)?criteriaHasEncryptedFieldsLbl:ActivateSuccessLbl),buttons:((isEncryptedFieldPresent!=null&&typeof(isEncryptedFieldPresent)!="undefined"&&isEncryptedFieldPresent)?Ext.Msg.OK:Ext.Msg.YESNO),minWidth:360,maxWidth:420,minHeight:110,fn:function(a){if(a=="yes"){showLoadingMask(statusMaskMsg);executeRulesFunc()}}})}else{if(activateVar==false&&exceptionWhileAorD=="deactivated"){enableRuleGrid();Ext.getCmp("activateBtnId").setText(activateLbl);Ext.getCmp("activateBtnId").setTooltip(ActBtnToolTipLbl);Ext.Msg.show({msg:deactivateSuccessLbl,buttons:Ext.Msg.OK,minWidth:360,maxWidth:420,minHeight:110})}else{showMessage(exceptionWhileAorD)}}}function syncStarted(){hideLoadingMask();Ext.Msg.show({msg:syncStartedLbl,buttons:Ext.Msg.OK,minWidth:360,maxWidth:420,minHeight:110})}function setTooltip(){if(document.getElementById(AbsIpFldRef)!=null&&AbsIpFldRef!=""&&AbsIpFldRef!=null){document.getElementById(AbsIpFldRef).setAttribute("title",absTooltip)}if(document.getElementById(expCbFldRef)!=null&&expCbFldRef!=""&&expCbFldRef!=null){document.getElementById(expCbFldRef).setAttribute("title",expTooltip)}if(document.getElementById(RuleOnClsFld)!=null&&RuleOnClsFld!=""&&RuleOnClsFld!=null){document.getElementById(RuleOnClsFld).setAttribute("title",RuleOnClsTooltip)}if(document.getElementById("file-info-icon")!=null&&typeof(document.getElementById("file-info-icon")!="undefined")){var a=infoIconTooltip.replace(/{LINEBREAK}/g,"\r\n");document.getElementById("file-info-icon").setAttribute("title",a)}}function sprClsFldAppearenceHandler(){var a=document.getElementById(sprClsFld);if(ootbCls==false&&a!=null&&a!=""){a.setAttribute("class","sprClsFld")}else{a.setAttribute("class","inpFld")}}function enableDelBtn(){if(custCls&&!nCls){Ext.getCmp("deleteId").setDisabled(false);Ext.getCmp("deleteId").setIconCls("bmcDelete")}}function addRuleQData(){addUpdateRuleQData()}function addUpdateRuleQData(k){var b="";var d=fetchRuleComboFieldLabel();if(d!=null&&d!=""&&d!="undefined"){var g=d.get("label");if(g!=null&&g!=""&&g!="undefined"){var a=d.get("type");if(a!=null&&a.indexOf(":")>0){a=a.split(":")[0]}}}else{showExtMsg(SelectFieldErrMsg);return}var f=operatorSelComboBox.getValue();if(f==null||f==""){showExtMsg(SelectCmpOpMsg);return}var j=None;var n;if(compTypeNo=="1"||compTypeNo=="10"||compTypeNo=="11"||compTypeNo=="7"||compTypeNo=="8"||compTypeNo=="9"||compTypeNo=="5"){var m=getInputTxtEle();if(m!=null&&m!="undefined"){n=m.value}}else{if(compTypeNo=="2"){n=booleanComboBx.getValue()}else{if(compTypeNo=="3"){var l=getInputTextAreaEle();if(l!=null&&l!="undefined"){n=l.value}}else{if(compTypeNo=="4"){n=pickListComboBx.getValue()}else{if(compTypeNo=="12"){n=getDateTimeInputEle().value}else{if(compTypeNo=="13"){n=getDateInputEle().value}}}}}}var c;if(n!=null&&n!=""&&n!="undefined"){c=validateData(n);if(c){return}}else{showExtMsg(EnterValMsg);return}b=document.getElementById("referenceID").value;if(k==null||k=="undefined"||typeof(k)=="undefined"){ruleGridStore.add(new CriteriaModel({orderIndex:ruleOrderIndex,operandFieldLabel:g,operatorValue:f,operandValue:n,groupingOperator:j,operatorFieldAPIName:d.get("id"),operandFieldType:a,ruleId:"",lookupFieldID:b}));ruleOrderIndex=ruleOrderIndex+1;clearRuleCriteria()}else{k.set("operandValue",n);k.set("lookupFieldID",b)}var h=ruleGridStore.data.length-1;if(ruleGridStore!=null&&ruleGridStore!="undefined"&&ruleGridStore.data.length>1){var e=Ext.getCmp("ruleGridId").store.getAt(h-1);e.set("groupingOperator",AND)}document.getElementById("ruleGridDiv").style.visibility="visible";ruleGrid.getView().refresh()}function validateData(e){var c=false;if(compTypeNo!=0){if(compTypeNo==7){if(isNaN(e)){c=true;Ext.MessageBox.show({width:250,msg:"Invalid Number : "+e,buttons:Ext.MessageBox.OK})}}else{if(compTypeNo==8){var a=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!e.match(a)){c=true;Ext.MessageBox.show({width:250,msg:"Invalid Email address : "+e,buttons:Ext.MessageBox.OK})}}else{if(compTypeNo==9){if(isNaN(e)||e<0||e>100){c=true;Ext.MessageBox.show({width:250,msg:"Invalid Percent : "+e,buttons:Ext.MessageBox.OK})}}else{if(compTypeNo==11){var b=/^-?\d+(\.\d+)?$/;if(!e.match(b)){c=true;Ext.MessageBox.show({width:250,msg:"Invalid Currency :  "+e,buttons:Ext.MessageBox.OK})}}else{if(compTypeNo==10){var d=/^[-]?\d*?\d*$/;if(!e.match(d)){c=true;Ext.MessageBox.show({width:250,msg:"Invalid Phone : "+e,buttons:Ext.MessageBox.OK})}}}}}}}return c}function fetchRuleComboFieldLabel(){var b=fieldSelComboBox.getValue();for(var a=0;a<fieldListStore.data.length;a++){if(b==fieldListStore.getAt(a).get("id")){return fieldListStore.getAt(a)}}return""}function clearRuleCriteria(){if(compTypeNo=="1"||compTypeNo=="10"||compTypeNo=="11"||compTypeNo=="7"||compTypeNo=="8"||compTypeNo=="9"||compTypeNo=="5"){var e=getInputTxtEle();if(e!=null&&e!="undefined"){e.value=""}}else{if(compTypeNo=="2"){operandVal=booleanComboBx.setValue("")}else{if(compTypeNo=="3"){var d=getInputTextAreaEle();if(d!=null&&d!="undefined"){d.value=""}}else{if(compTypeNo=="4"){operandVal=pickListComboBx.setValue("")}else{if(compTypeNo=="12"){var f=getDateTimeInputEle();if(f!=null&&f!="undefined"){f.value=""}}else{if(compTypeNo=="13"){var a=getDateInputEle();if(a!=null&&a!="undefined"){a.value=""}}else{if(compTypeNo=="6"){var b=getInputTxtEle();if(b!=null&&typeof(b)!="undefined"){b.value="";var c=document.getElementById("referenceID");if(c!=null&&typeof(c)!="undefined"){c.value=""}}}}}}}}}fieldSelComboBox.setValue("");operatorSelComboBox.setValue("")}function setConditionsData(){var b="";var c=0;while(ruleGridStore.data.length>c){var d="";if(ruleGridStore.getAt(c).get("operandFieldType").indexOf("reference")>-1){d=ruleGridStore.getAt(c).get("operandValue")+DZHE+ruleGridStore.getAt(c).get("lookupFieldID")}else{d=ruleGridStore.getAt(c).get("operandValue")}b=b+ruleGridStore.getAt(c).get("orderIndex")+nonPrint+ruleGridStore.getAt(c).get("operatorFieldAPIName")+nonPrint+ruleGridStore.getAt(c).get("operatorValue")+nonPrint+d+nonPrint+ruleGridStore.getAt(c).get("operandFieldType")+nonPrint+ruleGridStore.getAt(c).get("groupingOperator")+nonPrint+ruleGridStore.getAt(c).get("ruleId")+PE;c++}var a=getApplySTStrEle();a.value=b}function setVisibilityOnClick(b,c,f,a,e,d){ciLookup=b;var g=fldData.length;selectedApiName=b;selectedLabel=c;if(f.indexOf(":")>0){selectedTextAreaLength=f.split(":")[1];f=f.split(":")[0]}else{if(f.indexOf(EF)>0){popUpString=f.split(EF)[1];f=f.split(EF)[0]}}if(f=="text"){assignVisibility("inline","none","none","none","none","none","none",null,1,a)}else{if(f=="phone"){assignVisibility("inline","none","none","none","none","none","none",null,10,a)}else{if(f=="currency"){assignVisibility("inline","none","none","none","none","none","none",null,11,a)}else{if(f=="percent"){assignVisibility("inline","none","none","none","none","none","none",null,9,a)}else{if(f=="email"){assignVisibility("inline","none","none","none","none","none","none",null,8,a)}else{if(f=="number"){assignVisibility("inline","none","none","none","none","none","none",null,7,a)}else{if(f=="boolean"){assignVisibility("none","none","none","inline","none","none","none",null,2,a)}else{if(f=="textarea"){assignVisibility("none","inline","none","none","none","none","none",null,3,a)}else{if(f=="picklist"){setPickListOptions(selectedApiName);assignVisibility("none","none","none","none","inline","none","none",null,4,a)}else{if(f=="reference"){assignVisibility("inline","none","inline","none","none","none","none",b,5,a)}else{if(f=="reference1"){assignVisibility("inline","none","inline1","none","none","none","none",b,6,a)}else{if(f=="datetime"){assignVisibility("none","none","none","none","none","inline","none",null,12,a)}else{if(f=="date"){assignVisibility("none","none","none","none","none","none","inline",null,13,a)}}}}}}}}}}}}}setAddUpdateOnClick(a)}function saveClsMethod(){try{if(isAdvRulePresent){var a=Ext.getCmp("filterLogic").getValue();a=a.replace(/[)]/g," ) ");a=a.replace(/[(]/g," ( ");a=a.replace(/  +/g," ").trim();Ext.getCmp("filterLogic").setValue(a);ruleGridStore=Ext.getCmp("ruleGridId").store;var c=isValidLogicalStatement(a);if(c){var b=checkValidLogic();if(b){hideLoadingMask();Ext.MessageBox.show({msg:FilterLogicAddCriteriaValidation,width:310,buttons:Ext.Msg.YESNO,fn:function(e){if(e=="yes"){showLoadingMask(saveMaskMsg);saveCall()}},icon:Ext.MessageBox.WARNING});return false}else{saveCall()}}else{return false}}else{saveCall()}}catch(d){hideLoadingMask();console.log("Error Occured In save: "+d)}}function saveCall(){var c="";var e=Ext.getCmp("classType").getValue();c=document.getElementById(sprClsFld).value;var b=document.getElementById(clsNameFld).value;var d=false;var a=true;setConditionsData();if(document.getElementById(AbsIpFldRef)!=null&&AbsIpFldRef!=""&&AbsIpFldRef!=null){d=document.getElementById(AbsIpFldRef).checked}if(document.getElementById(expCbFldRef)!=null&&expCbFldRef!=""&&expCbFldRef!=null){a=document.getElementById(expCbFldRef).checked}if((c.toLowerCase()!=b.toLowerCase())&&(jsSprClsName.toLowerCase()!=b.toLowerCase())){if((c==null||c==""||b==null||b=="")&&notBE){hideLoadingMask();showMessage(reqFldMsg)}else{if(nCls==false&&custCls==true&&(initSprCls.toLowerCase()!=jsSprClsName.toLowerCase())&&(subClsCheck==true||CIcheck==true)){hideLoadingMask();showMessage(sprClsWrng);document.getElementById(sprClsFld).value=sprClsLbl;var f=document.getElementById("sprClsTree");if(f.hasChildNodes()){while(f.hasChildNodes()){f.removeChild(f.lastChild)}}jsSprClsName=initSprCls}else{if(nCls==false&&custCls==true&&(initClsNm.toLowerCase()!=b.toLowerCase())&&(subClsCheck==true||CIcheck==true)){hideLoadingMask();showMessage(clsNameWrng)}else{if(nCls==false&&custCls==true&&initAbsVal!=d&&CIcheck==true){hideLoadingMask();showMessage(abtractWrng)}else{hideLoadingMask();if(nCls==false&&a==false&&subClsCheck&&isAssetManagementEnabled&&isCIManagementEnabled&&hasActiveRBACls){showMessage(CannotHideCIClsMsg)}else{if(nCls==false&&a==false&&CIcheck){Ext.Msg.show({title:"",msg:hideWrng,minWidth:300,maxWidth:360,minHeight:110,buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.WARNING,fn:function(h){if(h=="yes"){showLoadingMask(saveMaskMsg);saveCls(jsSprClsName,Ext.getCmp("classType").getValue(),null)}}})}else{if(e==RBAComp&&isAdvRulePresent){var g=Ext.getCmp("filterLogic").getValue();saveCls(jsSprClsName,Ext.getCmp("classType").getValue(),g)}else{saveCls(jsSprClsName,Ext.getCmp("classType").getValue(),null)}}}}}}}}else{hideLoadingMask();document.getElementById(sprClsFld).value=sprClsLbl;var f=document.getElementById("sprClsTree");if(f.hasChildNodes()){while(f.hasChildNodes()){f.removeChild(f.lastChild)}}jsSprClsName=initSprCls;showMessage(sprNClsNameSameErr)}}function openSprClsLookup(){var a=Ext.getCmp("classType");if(a!=null&&typeof(a)!="undefined"&&a.value==RBAComp){openPopupTitle("SearchPage?popupId=CMDB_Class&isLookup=true&idNameForPopUp=true&sprclslookup=RBA",onCompl,600,840,"superclasslookup")}else{openPopupTitle("SearchPage?popupId=CMDB_Class&isLookup=true&idNameForPopUp=true",onCompl,600,840,"superclasslookup")}}function populateRuleClassData(a){var c=a.split(EF);var b=document.getElementById(sprClsFld);if(b!=null&&typeof(b)!="undefined"){document.getElementById(ruleClsFld).value=b.value}if(c[0]!=null&&c[0]!=""){document.getElementById(hiddenRuleClsId).value=c[0];ruleClassName=c[0]}Ext.getCmp("ruleGridId").getStore().removeAll(false);ruleOrderIndex=1;populateFields(ruleClassName)}function saveComplete(){hideLoadingMask();if(saveAllowed){if(excep==""){if(CMDBClassTypeCombo=="CI"&&isAssetManagementEnabled==true){Ext.getCmp("newInputBtn").setDisabled(false);document.getElementById("showrules").style.display="block";Ext.getCmp("ruleGridLayout").getView().refresh()}Ext.Msg.show({title:"",msg:getSaveMsg(),minWidth:300,maxWidth:360,minHeight:110,buttons:Ext.Msg.OK,});if(flgtf){nCls=false;document.getElementById(clsNameFld).setAttribute("disabled",true);enableDelBtn();flgtf=false}window.parent.refreshList();handleResetChange();showHideActivateAndSyncBtn();var a=Ext.getCmp("classType");if(a!=null&&typeof(a)!="undefined"&&a.value==RBAComp){checkForRuleChange();a.setDisabled(true)}else{if(a!=null&&typeof(a)!="undefined"&&a.value!=RBAComp){var b=document.getElementById("file-info-icon");if(b!=null&&typeof(b)!="undefined"){b.style.display="block"}}}if(document.getElementById(clsLabelFldRef).value.trim()==""){window.parent.changeTitle(wid,document.getElementById(clsNameFld).value,defTabHeader)}else{window.parent.changeTitle(wid,document.getElementById(clsLabelFldRef).value,defTabHeader)}if(fldSetRecReq==true){dispFieldSetRec()}}else{if(excep==dupLblErrMsg){document.getElementById(clsLabelFldRef).value=""}showMessage(excep);excep=""}}clearRuleCriteria();showMngAttr();disableSprClsBtnForRBACls()}function onCompl(a){var b=a.split(EF);if(b[1]!=null&&b[1]!=""){document.getElementById(sprClsFld).value=Ext.util.Format.htmlDecode(b[1]);populateRuleClassData(a)}getSprCls();window.close()}function handleChange(a){if(a!=null){if(!clickedOnce){clickedOnce=true;changeDone=true;window.parent.registerChange(wid)}}}function handleResetChange(){if(clickedOnce){clickedOnce=false;changeDone=false;window.parent.registerSave(wid)}}function showLoadingMask(a){waitMask=new Ext.LoadMask(Ext.getBody(),{msg:a});if(waitMask!=null&&waitMask!=""&&typeof(waitMask)!="undefined"){waitMask.show()}}function hideLoadingMask(){if(waitMask!=null&&waitMask!=""&&typeof(waitMask)!="undefined"){waitMask.hide()}}function showMessage(a){Ext.Msg.show({msg:a,buttons:Ext.Msg.OK,minWidth:300,maxWidth:360,minHeight:110,icon:warningIcon})}function clsLblCheckFunc(){if(clsLabelVal==""||clsLabelVal==null){return false}else{return true}}function enableDisableClsLblFld(){if(Ext.getCmp("chckbox").getValue()){var a=document.getElementById("clsLblDiv");a.setAttribute("class","clslblen");if(clsLabelVal==""||clsLabelVal==null){document.getElementById(clsLabelFldRef).value=document.getElementById(clsNameFldRef).value}else{document.getElementById(clsLabelFldRef).value=clsLabelVal}}else{var a=document.getElementById("clsLblDiv");a.setAttribute("class","clslbldis");document.getElementById(clsLabelFldRef).value=clsLabelVal}}function setClassLabel(){if((document.getElementById(clsLabelFldRef).value).trim()==""){document.getElementById(clsLabelFldRef).value=document.getElementById(clsNameFld).value}}function dispFieldSetRec(){var k;if(rmtSiteSetReq==false){document.getElementById("fldSetRecForActiveLinks").setAttribute("class","clslblen");k=document.getElementById("fieldSetRecWithLink")}else{document.getElementById("fldSetRecForNonActiveLinks").setAttribute("class","clslblen");k=document.getElementById("fieldSetRecWithoutLink")}if(k.hasChildNodes()){while(k.hasChildNodes()){k.removeChild(k.lastChild)}}var e;if(document.getElementById(clsLabelFldRef).value.trim()!=""){e=document.getElementById(clsLabelFldRef).value}else{e=document.getElementById(clsNameFld).value}var q=document.getElementById(clsNameFld).value;var l=lblForFldSetLbl+" ";var n=e;var a=lblForFldSetName+" ";var p=q;var f=document.createElement("label");f.setAttribute("class","fontArialForFldSetRec");var m=document.createTextNode(l);f.appendChild(m);var d=document.createElement("label");d.setAttribute("class","fontArial");var j=document.createTextNode(n);d.appendChild(j);var o=document.createElement("br");var c=document.createElement("label");c.setAttribute("class","fontArialForFldSetRec");var h=document.createTextNode(a);c.appendChild(h);var b=document.createElement("label");b.setAttribute("class","fontArial");var g=document.createTextNode(p);b.appendChild(g);k.appendChild(f);k.appendChild(d);k.appendChild(o);k.appendChild(c);k.appendChild(b)}function executeRulesFunc(){if(CMDBClassTypeVal!=null&&CMDBClassTypeVal!=""&&typeof(CMDBClassTypeVal)!="undefined"&&RuleClassVal!=null&&RuleClassVal!=""&&typeof(RuleClassVal)!="undefined"){executeRule()}}function loadDataToGrids(){if(listData.length==0){document.getElementById("ruleGridDiv").style.visibility="hidden"}else{document.getElementById("ruleGridDiv").style.visibility="visible"}ruleGridStore.loadData(listData);ruleOrderIndex=listData.length+1;clearFilterComp=Ext.getCmp("clearFilter");ruleLogicComp=Ext.getCmp("filterLogic");addFilterComp=Ext.getCmp("addFilter");if(isAdvRulePresent){toggleAdd(true)}else{toggleClear()}}function setVisibilityData(b,c,f,a,e,d){ciLookup=b;isInList=false;var h=fldData.length;selectedApiName=b;selectedLabel=c;var g=0;if(isInList==false){if(f.indexOf(":")>0){selectedTextAreaLength=f.split(":")[1];f=f.split(":")[0]}else{if(f.indexOf(EF)>0){popUpString=f.split(EF)[1];f=f.split(EF)[0]}}if(f=="text"){assignVisibility("inline","none","none","none","none","none","none",null,1,a)}else{if(f=="phone"){assignVisibility("inline","none","none","none","none","none","none",null,10,a)}else{if(f=="currency"){assignVisibility("inline","none","none","none","none","none","none",null,11,a)}else{if(f=="percent"){assignVisibility("inline","none","none","none","none","none","none",null,9,a)}else{if(f=="email"){assignVisibility("inline","none","none","none","none","none","none",null,8,a)}else{if(f=="number"){assignVisibility("inline","none","none","none","none","none","none",null,7,a)}else{if(f=="boolean"){assignVisibility("none","none","none","inline","none","none","none",null,2,a)}else{if(f=="textarea"){assignVisibility("none","inline","none","none","none","none","none",null,3,a)}else{if(f=="picklist"){setPickListOptions(selectedApiName);assignVisibility("none","none","none","none","inline","none","none",null,4,a)}else{if(f=="reference"){assignVisibility("inline","none","inline","none","none","none","none",b,5,a)}else{if(f=="reference1"){assignVisibility("inline","none","inline1","none","none","none","none",b,6,a)}else{if(f=="datetime"){assignVisibility("none","none","none","none","none","inline","none",null,12,a)}else{if(f=="date"){assignVisibility("none","none","none","none","none","none","inline",null,13,a)}}}}}}}}}}}}}setAddUpdateOnClick(a)}operatorSelComboBox.setValue("=");if(e!=null&&e!="undefined"){operatorSelComboBox.setValue(e)}}function setComparisonOperatorStore(a){if(a.indexOf(":")>0){a=a.split(":")[0]}else{if(a.indexOf(EF)>0){a=a.split(EF)[0]}}if(a=="reference"){operatorSelComboBox.store.loadData(operatorComboBoxStore.reference)}else{if(a=="datetime"){operatorSelComboBox.store.loadData(operatorComboBoxStore.dateTime)}else{if(a=="date"){operatorSelComboBox.store.loadData(operatorComboBoxStore.dateTime)}else{if(a=="textarea"){operatorSelComboBox.store.loadData(operatorComboBoxStore.textArea)}else{if(a=="text"){operatorSelComboBox.store.loadData(operatorComboBoxStore.text)}else{if(a=="phone"){operatorSelComboBox.store.loadData(operatorComboBoxStore.phone)}else{if(a=="currency"){operatorSelComboBox.store.loadData(operatorComboBoxStore.currency)}else{if(a=="percent"){operatorSelComboBox.store.loadData(operatorComboBoxStore.percent)}else{if(a=="number"){operatorSelComboBox.store.loadData(operatorComboBoxStore.number)}else{if(a=="boolean"){operatorSelComboBox.store.loadData(operatorComboBoxStore.booleanVar)}else{if(a=="email"){operatorSelComboBox.store.loadData(operatorComboBoxStore.email)}else{if(a=="picklist"){operatorSelComboBox.store.loadData(operatorComboBoxStore.picklist)}}}}}}}}}}}}operatorSelComboBox.reset()}function setAddUpdateOnClick(a){if(a!=null&&a!="undefined"){getUpdateBtnEle().style.display="inline";getUpdateBtnEle().style.visibility="visible";getAddBtnEle().style.display="none";getAddBtnEle().style.visibility="hidden";getRemoveBtnEle().disabled=false;getRemoveBtnEle().src=getSDFStylesResPath()+"/SDEFbuttons/b_remove.png"}else{getUpdateBtnEle().style.display="none";getUpdateBtnEle().style.visibility="hidden";getAddBtnEle().style.display="inline";getAddBtnEle().style.visibility="visible";getRemoveBtnEle().disabled=true;getRemoveBtnEle().src=getSDFStylesResPath()+"/SDEFbuttons/b_remove_disabled.png"}}function assignVisibility(h,q,n,l,d,b,r,c,m,g){var e=getInputTxtEle();var e=getInputTxtEle();var s=getInputTextAreaEle();var f=getDateTimeInputEle();var k=getDateTimePickerImg();var o=getDateInputEle();var p=getDatePickerImg();var t=getLookupEle();var a=Ext.getCmp("booleanFieldCombo");var j=document.getElementById("inputTxtAreaButtonEle");var u=Ext.getCmp("pickListFieldCombo");if(e!=null&&typeof(e)!="undefined"){e.style.display=h;if(h=="inline"&&g!=null&&g!="undefined"){e.value=g}else{e.value=""}e.disabled=false}if(s!=null&&typeof(s)!="undefined"){s.style.display=q;if(j!=null&&typeof(j)!="undefined"){if(q=="inline"){j.style.display="block"}else{j.style.display="none"}if(q=="inline"&&g!=null&&g!="undefined"){s.value=g}else{s.value=""}}}if(f!=null&&typeof(f)!="undefined"){f.style.display=b;if(k!=null&&typeof(k)!="undefined"){k.style.display=b}if(b=="inline"&&g!=null&&g!="undefined"){f.value=g}else{f.value=""}}if(o!=null&&typeof(o)!="undefined"){o.style.display=r;if(p!=null&&typeof(p)!="undefined"){p.style.display=r}if(r=="inline"&&g!=null&&g!="undefined"){o.value=g}else{o.value=""}}if(a!=null&&typeof(a)!="undefined"){if(l=="inline"){a.setVisible(true)}else{a.hide()}if(l=="inline"&&g!=null&&g!="undefined"){a.setValue(g)}else{a.value=""}}if(u!=null&&typeof(u)!="undefined"){if(d=="inline"){u.setVisible(true)}else{u.hide();u.reset()}if(d=="inline"&&g!=null&&g!="undefined"){setPickListOptions(selectedApiName);u.setValue(g)}else{u.value=""}}if(n=="inline"){if(t!=null&&typeof(t)!="undefined"){t.disabled=false;t.style.visibility="visible";t.style.display="inline"}if(g!=null&&g!="undefined"){e.disabled=g}e.disabled=true;popUpEnable=true}else{if(t!=null&&typeof(t)!="undefined"){t.style.visibility="hidden";t.style.display="none";t.disabled=true}}if(n=="inline1"){t.style.display="none";e.disabled=true;e.value="";popUpEnable=true}compTypeNo=m}function setRuleLogicValue(b){if(b){ruleLogicComp.setValue(filterLogic)}else{var a="";var c=Ext.getCmp("ruleGridId").store.data.length;for(i=1;i<=c;i++){a+=i+" AND "}a=a.substring(0,a.lastIndexOf(" AND "));ruleLogicComp.setValue(a)}}function toggleAdd(a){var b=addFilterComp.up("grid").columns[4];clearFilterComp.show();ruleLogicComp.show();Ext.getCmp("exampleText").show();addFilterComp.hide();b.hide();setRuleLogicValue(a);isAdvRulePresent=true}function toggleClear(){var a=clearFilterComp.up("grid").columns[4];ruleLogicComp.hide();Ext.getCmp("exampleText").hide();clearFilterComp.hide();addFilterComp.show();a.show();isAdvRulePresent=false}function createRuleGrid(){Ext.define("CriteriaModel",{extend:"Ext.data.Model",fields:[{name:"orderIndex",type:"string"},{name:"operandFieldLabel",type:"string"},{name:"operatorValue",type:"string"},{name:"operandValue",type:"string"},{name:"groupingOperator",type:"string"},{name:"operatorFieldAPIName",type:"string",hidden:true},{name:"operandFieldType",type:"string",hidden:true},{name:"ruleId",type:"string",hidden:true},{name:"lookupFieldID",type:"string",hidden:true}]});ruleGridStore=Ext.create("Ext.data.Store",{model:"CriteriaModel"});ruleGrid=new Ext.grid.GridPanel({id:"ruleGridId",cls:"ruleGrid",store:ruleGridStore,dockedItems:[{xtype:"toolbar",dock:"bottom",minHeight:40,items:[{xtype:"component",html:'<a href="" class="clsCmdLink" onclick="toggleAdd(false);return false">'+addAdvancedRuleLogic+"</a>",id:"addFilter"},{xtype:"component",html:'<a href="" class="clsCmdLink" onclick="toggleClear();return false">'+clearAdvancedRuleLogic+"</a>",id:"clearFilter"},{xtype:"textfield",fieldLabel:"",name:"filterLogic",id:"filterLogic",value:filterLogic,fieldStyle:"margin: 8px !important;text-transform: uppercase; ",cls:"Filter-logic-input"},{xtype:"component",html:example+": (1 AND 2) OR 3 ",id:"exampleText"}]}],columns:[{dataIndex:"orderIndex",text:OrderIndex,sortable:false,flex:1.5},{dataIndex:"operandFieldLabel",text:operandField,sortable:false,flex:3,renderer:"htmlEncode"},{dataIndex:"operatorValue",text:Operator,sortable:false,flex:1,renderer:"htmlEncode"},{dataIndex:"operandValue",text:Operand,sortable:false,flex:3,renderer:"htmlEncode"},{dataIndex:"groupingOperator",text:LogicalOperator,sortable:false,flex:1.5},{dataIndex:"operatorFieldAPIName",hidden:true},{dataIndex:"operandFieldType",hidden:true},{dataIndex:"ruleId",hidden:true},{dataIndex:"lookupFieldID",hidden:true}],columnLines:true,enableColumnHide:false,enableColumnResize:true,enableColumnMove:false,forceFit:true,layout:"fit",scroll:"vertical",border:true,stripeRows:true,shrinkWrap:true,minHeight:100,viewConfig:{forceFit:true,scrollOffset:0,emptyText:'<div class="x-grid-empty">'+MsgNoRecordFoundSearchPage+"</div>",deferEmptyText:false,margin:"0 0 0 10"},listeners:{itemclick:function(a,h,p,l,m){rowIndex=l;var o=Ext.getCmp("ruleGridId").store.getAt(rowIndex);var b=o.get("operandFieldLabel");var q=o.get("operatorFieldAPIName");var c=o.get("operandValue");var g=o.get("operatorValue");var n=o.get("groupingOperator");var j=o.get("operandFieldType");if(typeof(j)!="undefined"&&j!=""&&j.indexOf("reference")>-1){document.getElementById("referenceID").value=o.get("lookupFieldID")}else{document.getElementById("referenceID").value=""}if(q!=null&&q!="undefined"){fieldSelComboBox.reset();fieldSelComboBox.setValue(q);var f=fetchQualificationComboFieldLabel();if(f!=""){var d=f.get("type");if(d!=null&&d.indexOf(":")>0){var k=d.split(":")[1];if(k!=null&&typeof(k)!="undefined"&&k!=""){selectedTextAreaLength=k}}}}setVisibilityData(q,b,j,c,g,n);if(fieldListStore.find("label",h.get("operandFieldLabel").trim())<=-1){fieldSelComboBox.reset();Ext.getCmp("operatorSelComboBox").reset();openCriteriaDeleteMessage()}}}});ruleGrid.render("ruleGridDiv");loadDataToGrids();fieldListStore=new Ext.data.JsonStore({id:"fieldsStore",fields:["id","type","label","e"],data:fldData,proxy:new Ext.data.MemoryProxy(fldData),sortInfo:{field:"label",direction:"ASC"}});fieldSelComboBox=Ext.create("Ext.form.field.ComboBox",{id:"fieldSelComboBox",store:fieldListStore,queryMode:"local",displayField:"label",valueField:"id",renderTo:"ruleFieldSelDiv",listConfig:{minWidth:195},editable:true,width:210,height:13,typeAhead:true,emptyText:"<"+CIExpField+">",listeners:{select:function(d,c,b){var a=c[0].get("type");if(a.indexOf(":")>0){a=a.split(":")[0]}else{if(a.indexOf(EF)>0){a=a.split(EF)[0]}}apiName=c[0].get("id");label=c[0].get("label");type=c[0].get("type");rowIndex=-1;setVisibilityData(apiName,label,type)}}});operatorComboBoxStore=new Object();operatorComboBoxStore.text=[["=","="]];operatorComboBoxStore.phone=[["=","="]];operatorComboBoxStore.currency=[["=","="]];operatorComboBoxStore.percent=[["=","="]];operatorComboBoxStore.number=[["=","="]];operatorComboBoxStore.booleanVar=[["=","="]];operatorComboBoxStore.email=[["=","="]];operatorComboBoxStore.reference=[["=","="]];operatorComboBoxStore.dateTime=[["=","="]];operatorComboBoxStore.textArea=[["=","="]];operatorComboBoxStore.picklist=[["=","="]];operatorSelComboBox=Ext.create("Ext.form.ComboBox",{id:"operatorSelComboBox",store:operatorComboBoxStore.text,queryMode:"local",renderTo:"ruleOperatorSelDiv",valueField:"comOpeValue",displayField:"comOpeName",editable:false,width:120,listWidth:120,height:13,proxy:new Ext.data.MemoryProxy(operatorComboBoxStore),emptyText:"<"+Operator+">"});pickListComboStore=Ext.create("Ext.data.ArrayStore",{id:"pickListFieldStore",data:[["SERVER","Server"],["DESKTOP","Desktop"],["LAPTOP","Laptop"]],fields:["id","val"],sortInfo:{field:"val",direction:"ASC"}});pickListComboBx=Ext.create("Ext.form.ComboBox",{id:"pickListFieldCombo",store:pickListComboStore,queryMode:"local",valueField:"id",displayField:"val",selectOnFocus:true,editable:false,renderTo:"picklistCombo",hidden:true,width:150,listWidth:150});booleanComboStore=Ext.create("Ext.data.ArrayStore",{id:"booleanFieldStore",data:[["true","True"],["false","False"]],fields:["id","val"],sortInfo:{field:"val",direction:"ASC"}});booleanComboBx=Ext.create("Ext.form.ComboBox",{id:"booleanFieldCombo",store:booleanComboStore,queryMode:"local",valueField:"id",displayField:"val",selectOnFocus:true,editable:false,renderTo:"booleanCombo",hidden:true,width:150,listWidth:150})}if(typeof(SDEDateFormat)=="undefined"||SDEDateFormat==null||SDEDateFormat==""){this.SDEDateFormat=userDateTimeFormat}FilterDatePickerPopup=function(){};FilterDatePickerPopup.prototype={dateFormat:SDEDateFormat,Show:function(c){var a=Ext.get(c);var b=a.getRegion();var d=Ext.create("Ext.window.Window",{height:230,width:280,x:b.right-255,y:b.top-235,layout:"fit",items:{xtype:"datepicker",handler:function(j,h){a.dom.value=Ext.Date.format(h,SDEDateFormat);var e=a.dom.id;if(e.indexOf("inputDate")>0){var f=document.getElementById(e).value;var g=f.split(" ");a.dom.value=g[0].replace(",","")}dataModifiedFlag=1;a=null;d.close()}}}).show()}};var _datePicker=new FilterDatePickerPopup();function showDateTimePicker(){var a=getDateTimeInputEle();_datePicker.Show(a)}function showDatePicker(){var a=getDateInputEle();_datePicker.Show(a)}function setComparisonOperatorStore(a){if(a.indexOf(":")>0){a=a.split(":")[0]}else{if(a.indexOf(EF)>0){a=a.split(EF)[0]}}if(a=="reference"){operatorSelComboBox.store.loadData(operatorComboBoxStore.reference)}else{if(a=="datetime"){operatorSelComboBox.store.loadData(operatorComboBoxStore.dateTime)}else{if(a=="date"){operatorSelComboBox.store.loadData(operatorComboBoxStore.dateTime)}else{if(a=="textarea"){operatorSelComboBox.store.loadData(operatorComboBoxStore.textArea)}else{if(a=="text"){operatorSelComboBox.store.loadData(operatorComboBoxStore.text)}else{if(a=="phone"){operatorSelComboBox.store.loadData(operatorComboBoxStore.phone)}else{if(a=="currency"){operatorSelComboBox.store.loadData(operatorComboBoxStore.currency)}else{if(a=="percent"){operatorSelComboBox.store.loadData(operatorComboBoxStore.percent)}else{if(a=="number"){operatorSelComboBox.store.loadData(operatorComboBoxStore.number)}else{if(a=="boolean"){operatorSelComboBox.store.loadData(operatorComboBoxStore.booleanVar)}else{if(a=="email"){operatorSelComboBox.store.loadData(operatorComboBoxStore.email)}else{if(a=="picklist"){operatorSelComboBox.store.loadData(operatorComboBoxStore.picklist)}}}}}}}}}}}}operatorSelComboBox.reset()}function setPickListOptions(b){var c=Ext.getCmp("pickListFieldCombo");if(c!=null){var d=getPickListOptions(b);pickListArray=new Array();for(var a=0;a<d.length;a++){if(d[a]!=""){pickListArray[a]=[d[a],d[a]]}}pickListComboBx.store.removeAll();pickListComboBx.store.loadData(pickListArray);pickListComboBx.setValue("");pickListComboBx.setVisible(true)}}function getPickListOptions(b){for(var c=0;c<fldData.length;c++){var a=fldData[c];var f=a.e.split(EF);var d=f[0];if(d==b){var e=f[1].split(DZHE);return e}}return null}function showExtMsg(a){Ext.MessageBox.show({width:250,msg:a,buttons:Ext.MessageBox.OK})}var removeFromGrid=false;function openCriteriaDeleteMessage(){Ext.Msg.show({title:lblInvalidCondition,msg:lblErrorMsgEncryptedFldInCondition,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR,fn:function(a){if(a=="ok"){removeFromGrid=true;removeRuleData()}}})}function removeRuleData(){if(!(getRemoveBtnEle().src.indexOf("b_remove_disabled")>-1)||removeFromGrid){removeFromGrid=false;var a=Ext.getCmp("ruleGridId").getStore().getAt(rowIndex);if(rowIndex!=-1){Ext.getCmp("ruleGridId").getStore().remove(a)}for(var b=0;b<ruleGridStore.data.length;b++){var c=Ext.getCmp("ruleGridId").store.getAt(b);c.set("orderIndex",b+1);c.set("groupingOperator",AND);if(b==ruleGridStore.data.length-1){c.set("groupingOperator",None)}}ruleOrderIndex=ruleGridStore.data.length+1;rowIndex=-1;getRemoveBtnEle().src=getSDFStylesResPath()+"/SDEFbuttons/b_remove_disabled.png";getRemoveBtnEle().disabled=true;fieldSelComboBox.setValue("");pickListComboStore.removeAll();pickListComboBx.setValue("");getInputTxtEle().value="";assignVisibility("inline","none","none","none","none","none","none",null,1);setAddUpdateOnClick(null);document.getElementById("referenceID").value=""}}function upadateRuleData(){var a;if(updateRecordIndex!=null&&updateRecordIndex!=undefined&&updateRecordIndex>-1){a=Ext.getCmp("ruleGridId").store.getAt(updateRecordIndex)}else{a=Ext.getCmp("ruleGridId").store.getAt(rowIndex)}addUpdateRuleQData(a);setAddUpdateOnClick(null);Ext.getCmp("ruleGridId").getSelectionModel().clearSelections();clearRuleCriteria();updateRecordIndex=-1}function fetchQualificationComboFieldLabel(){var b=fieldSelComboBox.getValue();for(var a=0;a<fieldListStore.data.length;a++){if(b==fieldListStore.getAt(a).get("id")){return fieldListStore.getAt(a)}}return""}function disableSprClsBtnForRBACls(){var c=document.getElementById(sprClsFld);var b=document.getElementById(sprClsBtnRef);var a=Ext.getCmp("classType");if(typeof(c)!="undefined"&&typeof(b)!="undefined"&&!nCls&&!ootbCls&&clsId!=null&&clsId!=""&&a.value==RBAComp){b.style.display="none";c.disabled=true}}function showInfoIcon(){var a=Ext.getCmp("classType");var b=document.getElementById("file-info-icon");if(a!=null&&typeof(a)!="undefined"&&b!=null&&typeof(b)!="undefined"){if(nCls||a.value==RBAComp){b.style.display="none"}}}function disableRuleGrid(){var c=Ext.getCmp("ruleGridId");var a=Ext.getCmp("classType");var d=getAddBtnEle();var e=getUpdateBtnEle();var b=getRemoveBtnEle();if(!nCls&&a!=null&&typeof(a)!="undefined"&&a.value==RBAComp&&activateVar){if(c!=null&&typeof(c)!="undefined"){c.setDisabled(true)}if(d!=null&&typeof(d)!="undefined"){d.style.visibility="hidden"}if(e!=null&&typeof(e)!="undefined"){e.style.visibility="hidden"}if(b!=null&&typeof(b)!="undefined"){b.style.visibility="hidden"}enableDisableinputFields("disable")}}function enableRuleGrid(){var c=Ext.getCmp("ruleGridId");var a=Ext.getCmp("classType");var d=getAddBtnEle();var e=getUpdateBtnEle();var b=getRemoveBtnEle();if(a!=null&&typeof(a)!="undefined"&&a.value==RBAComp&&!(activateVar)){if(c!=null&&typeof(c)!="undefined"){c.setDisabled(false)}if(d!=null&&typeof(d)!="undefined"){d.style.visibility="visible"}if(e!=null&&typeof(e)!="undefined"){e.style.visibility="visible"}if(b!=null&&typeof(b)!="undefined"){b.style.visibility="visible"}enableDisableinputFields("enable")}}function enableDisableinputFields(h){var j=Ext.getCmp("fieldSelComboBox");var a=Ext.getCmp("operatorSelComboBox");var g=getInputTxtEle();var m=getInputTextAreaEle();var l=getDateTimeInputEle();var b=getDateTimePickerImg();var c=getDateInputEle();var d=getDatePickerImg();var f=getLookupEle();var k=Ext.getCmp("pickListFieldCombo");var e=Ext.getCmp("booleanFieldCombo");if(h=="disable"){if(j!=null&&typeof(j)!="undefined"){j.setDisabled(true)}if(a!=null&&typeof(a)!="undefined"){a.setDisabled(true)}if(g!=null&&typeof(g)!="undefined"){g.disabled=true}if(m!=null&&typeof(m)!="undefined"){m.disabled=true}if(l!=null&&typeof(l)!="undefined"){l.disabled=true}if(b!=null&&typeof(b)!="undefined"){b.disabled=true}if(c!=null&&typeof(c)!="undefined"){c.disabled=true}if(d!=null&&typeof(d)!="undefined"){d.disabled=true}if(f!=null&&typeof(f)!="undefined"){f.disabled=true}if(k!=null&&typeof(k)!="undefined"){k.setDisabled(true)}if(e!=null&&typeof(e)!="undefined"){e.setDisabled(true)}}else{if(h=="enable"){if(j!=null&&typeof(j)!="undefined"){j.setDisabled(false)}if(a!=null&&typeof(a)!="undefined"){a.setDisabled(false)}if(g!=null&&typeof(g)!="undefined"){g.disabled=false}if(m!=null&&typeof(m)!="undefined"){m.disabled=false}if(l!=null&&typeof(l)!="undefined"){l.disabled=false}if(b!=null&&typeof(b)!="undefined"){b.disabled=false}if(c!=null&&typeof(c)!="undefined"){c.disabled=false}if(d!=null&&typeof(d)!="undefined"){d.disabled=false}if(f!=null&&typeof(f)!="undefined"){f.disabled=false}if(k!=null&&typeof(k)!="undefined"){k.setDisabled(false)}if(e!=null&&typeof(e)!="undefined"){e.setDisabled(false)}}}}function getSaveMsg(){var a=Ext.getCmp("classType");if(!nCls&&a!=null&&typeof(a)!="undefined"&&a.value==RBAComp&&!(activateVar)){return RBASaveMsg}else{return saveSucfulMsg}}function openCLS(){try{if(window.parent&&window.parent.parent){var b=window.parent.parent;b.addNewTab(b.mainArray[181][0],b.mainArray[181][2],b.mainArray[181][3])}}catch(a){}};