var WinMsg;var WinDt;var WinErrMsg;Ext.onReady(function(){showLoadingMask();fieldsEditor=new Ext.form.field.ComboBox({id:"fieldsCombo",store:fieldsComboStore,queryMode:"local",valueField:"id",displayField:"label",renderTo:"extFieldList",editable:true,listWidth:225,width:225,height:13,emptyText:labelField,triggerCls:"d-icon-triangle_down",typeAhead:true,forceSelection:true,tpl:'<tpl for="."><div class="x-boundlist-item">{[fm.htmlEncode(values.label)]}</div></tpl>',pickerOffset:(userLanguage=="iw")?[-17,0]:[0,0],listeners:{select:function(j,h,f){comparisonOperator.store.removeAll();var c=h[0].data.type;if(c.indexOf(":")>0){c=c.split(":")[0]}else{if(c.indexOf(EF)>0){c=c.split(EF)[0]}}var d=h[0].data.id;var e=h[0].data.label;var g=h[0].data.type;setComparisonOperatorStore(c);setAddUpdateOnClick(null);setVisibilityData(d,e,g)}},beforeBlur:Ext.emptyFn});var b=[{dataIndex:"orderIndex",text:servicetargetOrder,hidden:false,sortable:false,width:115,renderer:"htmlEncode",menuDisabled:true,height:30},{dataIndex:"operandFieldLabel",text:InputNameLabel,hidden:false,sortable:false,width:200,renderer:"htmlEncode",menuDisabled:true,height:30},{dataIndex:"operatorValue",text:labelOperator,hidden:false,sortable:false,width:100,renderer:"htmlEncode",menuDisabled:true,height:30},{dataIndex:"operandValue",text:operandValue,hidden:false,sortable:false,width:225,renderer:"htmlEncode",menuDisabled:true,height:30},{dataIndex:"additionalValue",text:"AdditionalValue",hidden:true,sortable:false,width:225,menuDisabled:true,height:30},{dataIndex:"groupingOperator",text:labelLogicalOperator,hidden:false,sortable:false,width:175,renderer:"htmlEncode",menuDisabled:true,height:30},{dataIndex:"operatorFieldAPIName",hidden:true,menuDisabled:true,height:30},{dataIndex:"operandFieldType",hidden:true,menuDisabled:true,height:30},{dataIndex:"condId",hidden:true,menuDisabled:true,height:30}];if(userLanguage=="iw"){b=b.reverse()}ConditionGrid=new Ext.grid.GridPanel({id:"ConditionCriteriaGrid",store:ConditionGridStore,columns:b,enableColumnResize:true,enableColumnMove:false,width:817,height:300,border:true,viewConfig:{forceFit:true,scrollOffset:0,stripeRows:false,getRowClass:function(c){return fieldsEditor.store.data.containsKey(c.data.operatorFieldAPIName)?"":"not-in-fldset-row"}},renderTo:"ConditionGridDiv",listeners:{select:function(e,c,f,d){if(fieldsEditor.store.data.containsKey(c.data.operatorFieldAPIName)){setInputDataAndElementsOnRowClick(f)}else{if(WinErrMsg==null){WinErrMsg=Ext.create("Ext.window.MessageBox")}WinErrMsg.baseCls="bmc-message";WinErrMsg.show({width:250,msg:fieldNotInFieldSet,buttons:Ext.MessageBox.YESNO,fn:function(g){if(g=="yes"){removeSLTQData()}},icon:Ext.MessageBox.WARNING})}}}});loadDataToGrids();comparisonOperator=new Ext.form.ComboBox({id:"compareOpCombo",store:compStore.text,queryMode:"local",triggerAction:"all",renderTo:"compareOpDiv",valueField:"comOpeValue",displayField:"comOpeName",editable:false,width:105,listWidth:105,height:13,triggerCls:"d-icon-triangle_down",pickerOffset:(userLanguage=="iw")?[-17,0]:[0,0],emptyText:labelOperator});logOpeStore=new Ext.data.Store({id:"logOpeStore",data:[{logOpeValue:"AND",logOpeName:labelAND},{logOpeValue:"OR",logOpeName:labelOR},{logOpeValue:"NONE",logOpeName:labelNONE}],fields:["logOpeValue","logOpeName"]});logicalOperator=new Ext.form.ComboBox({id:"logicalOperatorCombo",store:logOpeStore,queryMode:"local",valueField:"logOpeValue",displayField:"logOpeName",triggerCls:"d-icon-triangle_down",renderTo:"condLogicalOperatorCombo",editable:false,width:103,listWidth:120,height:13,tpl:'<tpl for="."><div class="x-boundlist-item">{[Ext.util.Format.htmlEncode(values.logOpeName)]}</div></tpl>',emptyText:labelLogicalOperator,pickerOffset:(userLanguage=="iw")?[-17,0]:[0,0]});logicalOperator.setValue("AND");pickListComboBx=new Ext.form.ComboBox({id:"pickListFieldCombo",store:pickListComboStore,queryMode:"local",triggerAction:"all",triggerCls:"d-icon-triangle_down",valueField:"id",displayField:"val",selectOnFocus:true,editable:false,renderTo:"picklistCombo",hidden:true,width:148,listWidth:165,tpl:'<tpl for="."><div class="x-boundlist-item">{[Ext.util.Format.htmlEncode(values.val)]}</div></tpl>',pickerOffset:(userLanguage=="iw")?[-17,0]:[0,0]});booleanComboStore=new Ext.data.ArrayStore({id:"booleanFieldStore",data:booleanArray,fields:["id","val"]});booleanComboBx=new Ext.form.ComboBox({id:"booleanFieldCombo",store:booleanComboStore,mode:"local",triggerAction:"all",triggerCls:"d-icon-triangle_down",valueField:"id",displayField:"val",selectOnFocus:true,editable:false,renderTo:"booleanCombo",hidden:true,width:148,listWidth:165,pickerOffset:(userLanguage=="iw")?[-17,0]:[0,0]});var a=document.getElementById("ConditionCriteriaGrid-body");if(userLanguage=="iw"&&a!=null&&a!=undefined){a.dir="ltr"}hideLoadingMask()});var compStore=new Object();compStore.text=[["=","="],["!=","!="],["LIKE","LIKE"],["NOT LIKE","NOT LIKE"]];compStore.URL=[["=","="],["!=","!="]];compStore.phone=[["=","="],["!=","!="]];compStore.currency=[[">",">"],[">=",">="],["=","="],["!=","!="],["<","<"],["<=","<="]];compStore.percent=[[">",">"],[">=",">="],["=","="],["!=","!="],["<","<"],["<=","<="]];compStore.number=[[">",">"],[">=",">="],["=","="],["!=","!="],["<","<"],["<=","<="]];compStore.booleanVar=[["=","="],["!=","!="]];compStore.email=[["=","="],["!=","!="],["LIKE","LIKE"],["NOT LIKE","NOT LIKE"]];compStore.reference=[["=","="],["!=","!="]];compStore.dateTime=[[">",">"],[">=",">="],["=","="],["!=","!="],["<","<"],["<=","<="]];compStore.textArea=[["LIKE","LIKE"],["NOT LIKE","NOT LIKE"]];compStore.picklist=[["=","="],["!=","!="]];var fieldsComboStore=new Ext.data.JsonStore({id:"fieldsStore",data:fldData,proxy:new Ext.data.MemoryProxy(fldData),fields:["id","type","label","e"],sortInfo:{field:"label",direction:"ASC"}});var ConditionGridStore=Ext.create("Ext.data.Store",{storeId:"condsStore",fields:["orderIndex","operandFieldLabel","operatorValue","operandValue","additionalValue","groupingOperator","operatorFieldAPIName","operandFieldType","condId"]});pickListComboStore=new Ext.data.ArrayStore({id:"pickListFieldStore",data:pickListArray,fields:["id","val"],sortInfo:{field:"val",direction:"ASC"}});var TextField;CondtnDatePickerPopup=function(){};CondtnDatePickerPopup.prototype={dateFormat:SDEDateFormat,selectHandler:function(e,d){TextField.dom.value=Ext.Date.format(d,e.format);var a=TextField.dom.id;if(a.indexOf("inputDate")>0){var b=document.getElementById(a).value;var c=b.split(" ");cdateFormat=c[1];TextField.dom.value=c[0].replace(",","")}dataModifiedFlag=1;TextField=null;e.hide();e.winHandle.close()},Show:function(c){TextField=Ext.get(c);var h=new Ext.DatePicker({startDay:1,listeners:{select:this.selectHandler}});try{var d=Date.parseDate(TextField.dom.value,this.dateFormat);h.setValue(d)}catch(g){}var a=TextField.getRegion();var b=0;var f=new Ext.Window({x:a.right-150,y:a.top-5,cls:"RFAdminWindow",animCollapse:true,header:false,modal:true,resizable:false,style:"padding: 0; border-width: 0;",autoWidth:true,layout:"fit",frame:false});f.add(h);h.winHandle=f;f.show();f._checkCloseClick=function(l){try{var j=l.getPageX(),n=l.getPageY(),k=this.getBox();if(j<k.x||j>k.x+k.width||n<k.y||n>k.y+k.height){if(this.rendered){this.mun(Ext.getBody(),"click",this._checkCloseClick,this);this.close()}}}catch(m){}};setTimeout(function(){f.mon(Ext.getBody(),"click",f._checkCloseClick,f)},500)}};var _datePicker=new CondtnDatePickerPopup();function loadDataToGrids(){console.log("------loadDataToGrids------");var f=window.parent.fldVSCondsMapJSON;var e;if(typeof(f)!="undefined"&&f!=null&&f!=""){e=JSON.parse(f)}var a=window.parent.fldsAndCondtions;if(typeof(a)!="undefined"&&a!=null&&typeof(a[dynamicDispFor])!="undefined"&&a[dynamicDispFor]!=null){var d=a[dynamicDispFor].Conditions;console.log(d);ConditionGridStore.loadData(d);ConditionOrderIndex=d.length+1;if(typeof(a[dynamicDispFor].AdvRuleLogic)!="undefined"&&a[dynamicDispFor].AdvRuleLogic!=null&&a[dynamicDispFor].AdvRuleLogic!=""){filterLogic=a[dynamicDispFor].AdvRuleLogic;toggleAdd(true)}}else{if(typeof(e)!="undefined"&&e!=null&&(dynamicDispFor in e)&&typeof(e[dynamicDispFor])!="undefined"&&e[dynamicDispFor]!=null){var b=e[dynamicDispFor];console.log(b);ConditionGridStore.loadData(b);ConditionOrderIndex=b.length+1;var c=advRuleVal;if(typeof(c)!="undefined"&&c!=null&&c!=""){filterLogic=c;toggleAdd(true)}}}}function setComparisonOperatorStore(a){if(a.indexOf(":")>0){a=a.split(":")[0]}else{if(a.indexOf(EF)>0){a=a.split(EF)[0]}}if(a=="reference"){comparisonOperator.store.loadData(compStore.reference)}else{if(a=="datetime"){comparisonOperator.store.loadData(compStore.dateTime)}else{if(a=="date"){comparisonOperator.store.loadData(compStore.dateTime)}else{if(a=="textarea"){comparisonOperator.store.loadData(compStore.textArea)}else{if(a=="text"){comparisonOperator.store.loadData(compStore.text)}else{if(a=="URL"){comparisonOperator.store.loadData(compStore.URL)}else{if(a=="phone"){comparisonOperator.store.loadData(compStore.phone)}else{if(a=="currency"){comparisonOperator.store.loadData(compStore.currency)}else{if(a=="percent"){comparisonOperator.store.loadData(compStore.percent)}else{if(a=="number"){comparisonOperator.store.loadData(compStore.number)}else{if(a=="boolean"){comparisonOperator.store.loadData(compStore.booleanVar)}else{if(a=="email"){comparisonOperator.store.loadData(compStore.email)}else{if(a=="picklist"){comparisonOperator.store.loadData(compStore.picklist)}}}}}}}}}}}}}comparisonOperator.reset()}function setAddUpdateOnClick(a){if(a!=null&&a!="undefined"){getUpdateBtnEle().style.display="inline";getUpdateBtnEle().style.visibility="visible";getUpdateBtnEle().disabled=false;getAddBtnEle().style.display="none";getAddBtnEle().style.visibility="hidden";getRemoveBtnEle().disabled=false;getRemoveBtnEle().src=getSDFStylesResPath()+"/SDEFbuttons/b_remove.png"}else{getUpdateBtnEle().style.display="none";getUpdateBtnEle().style.visibility="hidden";getAddBtnEle().style.display="inline";getAddBtnEle().style.visibility="visible";getRemoveBtnEle().disabled=true;getRemoveBtnEle().src=getSDFStylesResPath()+"/SDEFbuttons/b_remove_disabled.png"}}function setVisibilityData(b,c,f,a,e,d){isInList=false;var g=fldData.length;selectedApiName=b;selectedLabel=c;if(isInList==false){if(f.indexOf(":")>0){selectedTextAreaLength=f.split(":")[1];f=f.split(":")[0]}else{if(f.indexOf(EF)>0){popUpString=f.split(EF)[1];f=f.split(EF)[0]}}if(f=="text"){assignVisibility("inline","none","none","none","none","none","none",null,1,a)}else{if(f=="phone"){assignVisibility("inline","none","none","none","none","none","none",null,10,a)}else{if(f=="currency"){assignVisibility("inline","none","none","none","none","none","none",null,11,a)}else{if(f=="percent"){assignVisibility("inline","none","none","none","none","none","none",null,9,a)}else{if(f=="email"){assignVisibility("inline","none","none","none","none","none","none",null,8,a)}else{if(f=="number"||f=="double"){assignVisibility("inline","none","none","none","none","none","none",null,7,a)}else{if(f=="boolean"){assignVisibility("none","none","none","inline","none","none","none",null,2,a)}else{if(f=="textarea"){assignVisibility("none","inline","none","none","none","none","none",null,3,a)}else{if(f=="picklist"){setPickListOptions(selectedApiName);assignVisibility("none","none","none","none","inline","none","none",null,4,a)}else{if(f=="reference"){assignVisibility("inline","none","inline","none","none","none","none",b,5,a)}else{if(f=="reference1"){assignVisibility("inline","none","inline1","none","none","none","none",b,6,a)}else{if(f=="datetime"){assignVisibility("none","none","none","none","none","inline","none",null,12,a)}else{if(f=="date"){assignVisibility("none","none","none","none","none","none","inline",null,13,a)}else{if(f=="URL"){assignVisibility("inline","none","none","none","none","none","none",null,14,a)}}}}}}}}}}}}}}setAddUpdateOnClick(a)}setComparisonOperatorStore(f);if(e!=null&&e!="undefined"){comparisonOperator.setValue(e)}if(d!=null&&d!="undefined"){logicalOperator.setValue(d)}}function assignVisibility(h,q,n,l,d,b,r,c,m,g){var e=getInputTxtEle();var s=getInputTextAreaEle();var f=getDateTimeInputEle();var k=getDateTimePickerImg();var o=getDateInputEle();var p=getDatePickerImg();var t=getLookupEle();var a=Ext.getCmp("booleanFieldCombo");var j=document.getElementById("inputTxtAreaButtonEle");var u=Ext.getCmp("pickListFieldCombo");if(e!=null&&typeof(e)!="undefined"){e.style.display=h;if(h=="inline"&&g!=null&&g!="undefined"){e.value=g}else{e.value=""}e.disabled=false}if(s!=null&&typeof(s)!="undefined"){s.style.display=q;if(j!=null&&typeof(j)!="undefined"){if(q=="inline"){j.style.display="block"}else{j.style.display="none"}if(q=="inline"&&g!=null&&g!="undefined"){s.value=g}else{s.value=""}}}if(f!=null&&typeof(f)!="undefined"){f.style.display=b;if(k!=null&&typeof(k)!="undefined"){k.style.display=b}if(b=="inline"&&g!=null&&g!="undefined"){f.value=g}else{f.value=""}}if(o!=null&&typeof(o)!="undefined"){o.style.display=r;if(p!=null&&typeof(p)!="undefined"){p.style.display=r}if(r=="inline"&&g!=null&&g!="undefined"){o.value=g}else{o.value=""}}if(a!=null&&typeof(a)!="undefined"){if(l=="inline"){a.setVisible(true)}else{a.hide()}if(l=="inline"&&g!=null&&g!="undefined"){a.setValue(g)}else{a.value=""}}if(u!=null&&typeof(u)!="undefined"){if(d=="inline"){u.setVisible(true)}else{u.hide();u.reset()}if(d=="inline"&&g!=null&&g!="undefined"){setPickListOptions(selectedApiName);u.setValue(g)}else{u.value=""}}if(n=="inline"){if(t!=null&&typeof(t)!="undefined"){t.disabled=false;t.style.visibility="visible";t.style.display="inline"}if(g!=null&&g!="undefined"){e.disabled=g}e.disabled=true;popUpEnable=true}else{if(t!=null&&typeof(t)!="undefined"){t.style.visibility="hidden";t.style.display="none";t.disabled=true}}if(n=="inline1"){t.style.display="none";e.disabled=true;e.value="";popUpEnable=true}compTypeNo=m}function toggleAdd(a){if(userLanguage=="iw"){ConditionGrid.down("headercontainer").getGridColumns()[5].setWidth(400);ConditionGrid.down("headercontainer").getGridColumns()[3].setVisible(false)}else{ConditionGrid.down("headercontainer").getGridColumns()[3].setWidth(400);ConditionGrid.down("headercontainer").getGridColumns()[5].setVisible(false)}ConditionGrid.getView().refresh();if(window.parent.logInWindow){window.parent.logInWindow.setHeight(550)}document.getElementById("clearFilter").style.display="block";document.getElementById("filterLogic").style.display="block";document.getElementById("addFilter").style.display="none";document.getElementById("condButtonTD").style.display="none";setRuleLogicValue(a);isAdvRulePresent=true}function toggleClear(){var a=ConditionGrid.columns;if(userLanguage=="iw"){ConditionGrid.down("headercontainer").getGridColumns()[3].setVisible(true);ConditionGrid.down("headercontainer").getGridColumns()[5].setWidth(225)}else{ConditionGrid.down("headercontainer").getGridColumns()[5].setVisible(true);ConditionGrid.down("headercontainer").getGridColumns()[3].setWidth(225)}ConditionGrid.getView().refresh();if(window.parent.logInWindow){window.parent.logInWindow.setHeight(500)}document.getElementById("clearFilter").style.display="none";document.getElementById("filterLogic").style.display="none";document.getElementById("addFilter").style.display="inline";document.getElementById("condButtonTD").style.display="";document.getElementById("filterLogic").value="";isAdvRulePresent=false}function opencondLookup(){var a="Incident__c";var c;if(selectedApiName){c=selectedApiName.replace(orgNamespace,"").toLowerCase()}if(popUpString=="BMC BaseElement"){popUpString="BMC_BaseElement"}else{if(popUpString=="User"||popUpString=="Group"){if(c=="fkopenby__c"||c=="fkstaff__c"){window.parent.openPopupRF("SearchPage?popupId=User&isLookup=true&idNameForPopUp=true&filterClause=IsStaffUser__c=true&isFromSLT=true",setReferenceToVal,450,600,true)}else{if(c=="fkclient__c"||c=="fkinitiator__c"){window.parent.openPopupRF("SearchPage?popupId=Client&isLookup=true&idNameForPopUp=true&isFromSLT=true",setReferenceToVal,450,600,true)}else{if(strEnableQueueAndUserAssignment==true){window.parent.openPopupRF("SearchPage?popupId=Queue&popupFor=QueueAssignment&isQueurorUser=true&queueFor="+moduleName+"&isOnlyQueueList=false&isLookup=true&idNameForPopUp=true&isFromSLT=true",setReferenceToVal,450,600,true)}else{window.parent.openPopupRF("SearchPage?popupId=Client&isQueurorUser=true&isLookup=true&queueFor="+moduleName+"&filterClause=IsStaffUser__c=true&idNameForPopUp=true&isFromSLT=true",setReferenceToVal,450,600,true)}}}}else{if(popUpString=="SYSTemplate__c"){if(a=="Incident__c"){window.parent.openPopupRF("SearchPage?popupId=SYSTemplate__c&isLookup=true&idNameForPopUp=true&referenceObjectName=SYSTemplate__c&filterClause="+escape("templateFor__c='Incident'"),setReferenceToVal,450,600,true)}}else{if(popUpString=="BMC_BaseElement__c"){var b="";if(c=="fkbusinessservice__c"){b+=b=escape("(serviceType__c != 'Offering')");window.parent.openPopupRF("SearchPage?popupId=BMC_BusinessService__c&isLookup=true&idNameForPopUp=true&referenceObjectName=BMC_BusinessService__c&filterClause="+b,setReferenceToVal,450,600,true)}else{if(c=="fkserviceoffering__c"){if(window.parent.getServiceId!=null&&typeof(window.parent.getServiceId)=="function"){fkService=window.parent.getServiceId();if(fkService!=null&&fkService!=""){b=escape("(FKBusinessService__c ='"+fkService+"')")}}if(b!=""){b+=b=escape(" and (serviceType__c = 'Offering')")}else{b+=b=escape(" (serviceType__c = 'Offering')")}window.parent.openPopupRF("SearchPage?popupId=BMC_BusinessService__c&isLookup=true&idNameForPopUp=true&referenceObjectName=BMC_BusinessService__c&filterClause="+b,setReferenceToVal,450,600,true)}else{if(c=="fkbmc_baseelement__c"){window.parent.openPopupRF("SearchPage?popupId=BMC_BaseElement__c&isLookup=true&idNameForPopUp=true&referenceObjectName=BMC_BaseElement__c",setReferenceToVal,450,600,true)}else{window.parent.openPopupRF("SearchPage?popupId=BMC_BaseElement__c&isLookup=true&idNameForPopUp=true&referenceObjectName=BMC_BaseElement__c",setReferenceToVal,450,600,true)}}}}else{if(popUpString=="ConsoleLayoutDetail__c"){if(a=="Incident__c"){window.parent.openPopupRF("SearchPage?popupId="+popUpString+"&isLookup=true&idNameForPopUp=true&referenceObjectName="+popUpString+"&templateFor=Incident",setReferenceToVal,450,650,true)}}else{window.parent.openPopupRF("SearchPage?popupId="+popUpString+"&isLookup=true&idNameForPopUp=true&referenceObjectName="+popUpString,setReferenceToVal,450,650,true)}}}}}}function setRuleLogicValue(b){if(b){document.getElementById("filterLogic").value=filterLogic}else{var a="";var c=Ext.getCmp("ConditionCriteriaGrid").store.data.length;for(i=1;i<=c;i++){a+=i+" AND "}a=a.substring(0,a.lastIndexOf(" AND "));document.getElementById("filterLogic").value=a}}function setReferenceToVal(b){if(b.indexOf(old_EF)>0){referenceId=b.split(old_EF)[0];referenceName=b.split(old_EF)[1]}referenceName=decodeVal(referenceName);var a=getInputTxtEle();if(a!=null&&typeof(a)!="undefined"){a.value=referenceName;var c=document.getElementById("referenceID");if(c!=null&&typeof(c)!="undefined"){c.value=referenceId}}}function decodeVal(a){a=RemedyForceHTMLProcessor.htmlDecoder(a);return a}function getPickListOptions(b){for(var c=0;c<fldData.length;c++){var a=fldData[c];var f=a.e.split(EF);var d=f[0];if(d==b){var e=f[1].split(DZHE);return e}}return null}function setPickListOptions(b){var c=Ext.getCmp("pickListFieldCombo");if(c!=null){var d=getPickListOptions(b);pickListArray=new Array();for(var a=0;a<d.length;a++){if(d[a]!=""){pickListArray[a]=[d[a],d[a]]}}pickListComboStore.removeAll();pickListComboStore.loadData(pickListArray);pickListComboBx.setVisible(true)}}function addSLTQData(){addUpdateSLTQData()}function addUpdateSLTQData(l){Ext.define("condRec",{extend:"Ext.data.Model",fields:["orderIndex","operandFieldLabel","operatorFieldAPIName","operatorValue","operandValue","groupingOperator","operandFieldType"],});var a;var j=false;if(l==null||l=="undefined"||typeof(l)=="undefined"){a=Ext.create("condRec");a.set("orderIndex",ConditionOrderIndex);j=true}else{a=l}var d=fetchConditionComboFieldLabel();if(d!=null&&d!=""&&d!="undefined"){var h=d.get("label");if(h!=null&&h!=""&&h!="undefined"){a.set("operandFieldLabel",h);a.set("operatorFieldAPIName",d.get("id"));var b=d.get("type");if(b!=null&&b.indexOf(":")>0){b=b.split(":")[0]}a.set("operandFieldType",b)}}else{showExtMsg(SSLayoutCondtnsPage.Labels.SelectFieldErrMsg);return}var g=comparisonOperator.getValue();if(g!=null&&g!=""&&g!="undefined"){a.set("operatorValue",g)}else{showExtMsg(SSLayoutCondtnsPage.Labels.SelectCmpOpMsg);return}var k=(isAdvRulePresent)?"AND":logicalOperator.getValue();if(k!=null&&k!=""&&k!="undefined"){if(j&&ConditionOrderIndex>1&&ConditionGridStore.getAt(ConditionOrderIndex-2).get("groupingOperator")=="NONE"){ConditionGridStore.getAt(ConditionOrderIndex-2).set("groupingOperator","AND")}a.set("groupingOperator",k)}else{showExtMsg(SSLayoutCondtnsPage.Labels.SelectLogOpMsg);return}var o;var f;if(compTypeNo=="1"||compTypeNo=="10"||compTypeNo=="11"||compTypeNo=="7"||compTypeNo=="8"||compTypeNo=="9"||compTypeNo=="5"||compTypeNo=="14"){var n=getInputTxtEle();if(n!=null&&n!="undefined"){o=n.value}var e=document.getElementById("referenceID");if(e!=null&&typeof(e)!="undefined"){f=e.value;e.value=""}}else{if(compTypeNo=="2"){o=booleanComboBx.getValue()}else{if(compTypeNo=="3"){var m=getInputTextAreaEle();if(m!=null&&m!="undefined"){o=m.value}}else{if(compTypeNo=="4"){o=pickListComboBx.getValue()}else{if(compTypeNo=="12"){o=getDateTimeInputEle().value}else{if(compTypeNo=="13"){o=getDateInputEle().value}}}}}}var c;if(o!=null&&o!=""&&o!="undefined"){c=validateData(o);if(c){return}else{a.set("operandValue",o);a.set("additionalValue",f)}}else{showExtMsg(SSLayoutCondtnsPage.Labels.EnterValMsg);return}if(l==null||l=="undefined"||typeof(l)=="undefined"){if(j){a.commit()}ConditionGridStore.add(a);ConditionOrderIndex=ConditionOrderIndex+1;clearConditionCriteria()}ConditionGrid.getView().refresh();if(ConditionGrid.store.data.length>0){document.getElementById("AdvancedFilterSec").style.display=""}}function fetchConditionComboFieldLabel(){var b=fieldsEditor.getValue();for(var a=0;a<fieldsComboStore.data.length;a++){if(b==fieldsComboStore.getAt(a).get("id")){return fieldsComboStore.getAt(a)}}return""}function removeSLTQData(){var d=ConditionGrid.getSelectionModel().getSelection()[0];if(d!=null&&d!="undefined"){ConditionGrid.store.remove(d);ConditionOrderIndex=ConditionOrderIndex-1;var a=ConditionGrid.store.getCount();for(var b=0;b<a;b++){var e=ConditionGrid.store.getAt(b);e.set("orderIndex",b+1)}getRemoveBtnEle().src=getSDFStylesResPath()+"/SDEFbuttons/b_remove_disabled.png";getRemoveBtnEle().disabled=true;fieldsEditor.setValue("");comparisonOperator.setValue("");logicalOperator.setValue("AND");pickListComboStore.removeAll();pickListComboBx.setValue("");getInputTxtEle().value="";var c=document.getElementById("referenceID");if(c!=null&&typeof(c)!="undefined"){c.value=""}assignVisibility("inline","none","none","none","none","none","none",null,1);setAddUpdateOnClick(null)}}function clearConditionCriteria(){if(compTypeNo=="1"||compTypeNo=="10"||compTypeNo=="11"||compTypeNo=="7"||compTypeNo=="8"||compTypeNo=="9"||compTypeNo=="5"||compTypeNo=="14"){var e=getInputTxtEle();if(e!=null&&e!="undefined"){e.value=""}}else{if(compTypeNo=="2"){operandVal=booleanComboBx.setValue("")}else{if(compTypeNo=="3"){var d=getInputTextAreaEle();if(d!=null&&d!="undefined"){d.value=""}}else{if(compTypeNo=="4"){operandVal=pickListComboBx.setValue("")}else{if(compTypeNo=="12"){var f=getDateTimeInputEle();if(f!=null&&f!="undefined"){f.value=""}}else{if(compTypeNo=="13"){var a=getDateInputEle();if(a!=null&&a!="undefined"){a.value=""}}else{if(compTypeNo=="6"){var b=getInputTxtEle();if(b!=null&&typeof(b)!="undefined"){b.value="";var c=document.getElementById("referenceID");if(c!=null&&typeof(c)!="undefined"){c.value=""}}}}}}}}}fieldsEditor.setValue("");comparisonOperator.setValue("");logicalOperator.setValue("AND")}function validateData(f){var c=false;if(compTypeNo!=0){if(compTypeNo==7){if(isNaN(f)){c=true;showExtMsg(invalidNumberErrorLbl)}}else{if(compTypeNo==8){var a=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!f.match(a)){c=true;showExtMsg(invalidEmailErrorLbl)}}else{if(compTypeNo==9){if(isNaN(f)||f<0||f>100){c=true;showExtMsg(invalidPercentErrorLbl)}}else{if(compTypeNo==11){var b=/^-?\d+(\.\d+)?$/;if(!f.match(b)){c=true;showExtMsg(invalidCurrencyErrorLbl)}}else{if(compTypeNo==10){var d=/^[-]?\d*?\d*$/;if(!f.match(d)){c=true;showExtMsg(invalidPhoneErrorLbl)}}else{if(compTypeNo==14){var e=httpIntranetUrlCheck(f);if(!e){c=true;showExtMsg(invalidURLErrorLbl)}}}}}}}}return c}function showExtMsg(a){if(WinMsg==null){WinMsg=Ext.create("Ext.window.MessageBox")}WinMsg.baseCls="bmc-message";WinMsg.show({width:250,msg:a,buttons:Ext.MessageBox.OK})}function setInputDataAndElementsOnRowClick(h){var k=ConditionGrid.store.getAt(h);var a=k.get("operandFieldLabel");var l=k.get("operatorFieldAPIName");var b=k.get("operandValue");var e=k.get("operatorValue");var j=k.get("groupingOperator");var f=k.get("operandFieldType");if(document.getElementById("referenceID")){document.getElementById("referenceID").value=k.get("additionalValue")}if(l!=null&&l!="undefined"){fieldsEditor.setValue(l);var d=fetchConditionComboFieldLabel();var c=d.get("type");if(c!=null&&c.indexOf(":")>0){var g=c.split(":")[1];if(g!=null&&typeof(g)!="undefined"&&g!=""){selectedTextAreaLength=g}}}setVisibilityData(l,a,c,b,e,j)}function upadateSLTQData(){var a=ConditionGrid.getSelectionModel().getSelection()[0];addUpdateSLTQData(a);setAddUpdateOnClick(null);ConditionGrid.getSelectionModel().clearSelections();clearConditionCriteria()}function closePopup(){window.parent.logInWindow.close()}function okBtnHandler(){showLoadingMask();if(validateCriteria()){hideLoadingMask();return}setCriteriaGridData()}function setCriteriaGridData(){var b=Ext.getCmp("ConditionCriteriaGrid");var g=b.getStore().getRange();var e=[];if(typeof(g)!="undefined"&&g!=null&&g.length>0){for(var c=0;c<g.length;c++){if(isAdvRulePresent){if(g.length-1==c){g[c].set("groupingOperator","NONE")}else{g[c].set("groupingOperator","AND")}}var f=[];f.push(g[c].data.orderIndex.toString());f.push(g[c].data.operandFieldLabel);f.push(g[c].data.operatorValue);f.push(g[c].data.operandValue);f.push(g[c].data.additionalValue);f.push(g[c].data.groupingOperator);f.push(g[c].data.operatorFieldAPIName);f.push(g[c].data.operandFieldType);f.push(g[c].data.condId);e.push(f)}}var d=document.getElementById("filterLogic");var a="";if(typeof(d)!="undefined"&&d!=null&&typeof(d.value)!="undefined"&&d.value!=null&&d.value!=""){a=d.value}window.parent.receiveConditionsJSON(e,a,dynamicDispFor);window.parent.logInWindow.close()}function showTextEditor(e,d,b,f,a){var g=new Ext.form.TextArea({id:"formTextId",fieldLabel:"Message text",hideLabel:true,border:false,enableKeyEvents:true,name:"msg",flex:1,listeners:{keyup:function(h,j){var k=h.getValue();if(k.length>b){h.setValue(k.substr(0,b))}}}});var c=new Ext.Window({title:d,id:"windowId",width:500,height:200,layout:"fit",modal:true,plain:true,cls:"RFAdminWindow",buttonAlign:"left",items:[g],defaultType:"textarea",bodyStyle:"padding: 30px 20px 30px 20px; background:#FFFFFF;",style:"padding: 0; border-width: 0;background:#FFFFFF;",defaultButton:"formTextId",shadow:false,border:false,closable:false,ghost:false,tools:[{type:"rfclose",handler:function(k,j,h){c.close()}}],dockedItems:[{xtype:"toolbar",height:40,cls:"rf-toolbar",dock:"bottom",items:["->",{text:a,cls:"bmc-btn-small",handler:function(){c.close()}},{text:f,cls:"bmc-btn-primary okstyle",handler:function(){if(e!=null&&e!="undefined"){document.getElementById(e).focus();document.getElementById(e).value=Ext.getCmp("formTextId").getValue()}c.close()}}]}]});c.show();if(e!=null&&e!="undefined"){Ext.getCmp("formTextId").focus();Ext.getCmp("formTextId").setValue(document.getElementById(e).value)}}function showMessage(a){showExtMsg(a)}function showLoadingMask(){waitMask=new Ext.LoadMask(Ext.getBody(),{floating:{shadow:false},msgCls:"d-loader-container",msg:'<ul class="d-loading"><li class="d-loading__stick d-loading__stick_1"></li><li class="d-loading__stick d-loading__stick_2"></li><li class="d-loading__stick d-loading__stick_3"></li><li class="d-loading__stick d-loading__stick_4"></li><li class="d-loading__stick d-loading__stick_5"></li><li class="d-loading__stick d-loading__stick_6"></li><li class="d-loading__stick d-loading__stick_7"></li><li class="d-loading__stick d-loading__stick_8"></li><li class="d-loading__stick d-loading__stick_9"></li><li class="d-loading__stick d-loading__stick_10"></li><li class="d-loading__stick d-loading__stick_11"></li><li class="d-loading__stick d-loading__stick_12"></li></ul><div>'+pleaseWaitLbl+"</div>"});if(typeof(waitMask)!="undefined"&&waitMask!=null&&waitMask!=""){waitMask.show()}}function hideLoadingMask(){if(typeof(waitMask)!="undefined"&&waitMask!=null&&waitMask!=""){waitMask.hide()}}function validateCriteria(){if(ConditionGridStore.data.length==0){showExtMsg(ValidateCriteriaMandatorylbl);return true}if(!isAdvRulePresent&&gridHasDupesNONE(ConditionGrid)){showExtMsg(ValidateLogicalOperatorNotMultiNone);return true}if(!isAdvRulePresent){var b=ConditionGrid.getStore().getAt(ConditionGridStore.data.length-1);if(b!=null&&b!=""&&typeof(b)!="undefined"){var e=b.get("groupingOperator");if(e!="NONE"){ConditionGridStore.getAt(ConditionGridStore.data.length-1).set("groupingOperator","NONE")}}}if(isAdvRulePresent){var a=document.getElementById("filterLogic").value;a=a.replace(/[)]/g," ) ");a=a.replace(/[(]/g," ( ");a=a.replace(/  +/g," ").trim();document.getElementById("filterLogic").value=a;ruleGridStore=Ext.getCmp("ConditionCriteriaGrid").store;var d=isValidLogicalStatement(a);if(d){var c=checkValidLogic();if(c){hideLoadingMask();if(WinErrMsg==null){WinErrMsg=Ext.create("Ext.window.MessageBox")}WinErrMsg.baseCls="bmc-message";WinErrMsg.show({width:250,msg:FilterLogicAddCriteriaValidation,buttons:Ext.MessageBox.YESNO,fn:function(f){if(f=="yes"){setCriteriaGridData()}},icon:Ext.MessageBox.WARNING});return true}else{return false}}else{hideLoadingMask();showExtMsg(FilterLogicValidation);return true}}return false}function gridHasDupesNONE(f){var c=f.store;var b=f.id;var e,d,h;h=c.data.length;for(e=0;e<h;e++){for(d=e+1;d<h;d++){var a=c.getAt(e);var g=c.getAt(d);if(f.id=="ConditionCriteriaGrid"){if(a.get("groupingOperator")==g.get("groupingOperator")&&a.get("groupingOperator")=="NONE"){return true}}}}return false};