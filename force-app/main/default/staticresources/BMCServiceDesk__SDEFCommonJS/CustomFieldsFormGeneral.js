if(typeof(SDEDateFormat)=="undefined"||SDEDateFormat==null||SDEDateFormat==""){this.SDEDateFormat="m/d/Y h:i A"}Date.useStrict=true;var dataModifiedFlag=0;var cdateFormat="";function getDataModifiedFlag(){return dataModifiedFlag}function setDataModifiedFlag(){dataModifiedFlag=0}CMDBDatePickerPopup=function(){};CMDBDatePickerPopup.prototype={dateFormat:SDEDateFormat,selectHandler:function(e,d){this.TextField.dom.value=d.format(e.format);var a=this.TextField.dom.id;if(a.indexOf("custominputDate")>0){var b=document.getElementById(a).value;var c=b.split(" ");cdateFormat=c[1];this.TextField.dom.value=c[0]}dataModifiedFlag=1;this.TextField=null;e.hide();e.winHandle.close()},Show:function(b){this.TextField=Ext.get(b);var g=new Ext.DatePicker({startDay:1,listeners:{select:this.selectHandler.createDelegate(this)}});try{var c=Date.parseDate(this.TextField.dom.value,this.dateFormat);g.setValue(c)}catch(f){}var a=this.TextField.getRegion();var d=new Ext.Window({x:a.right-180,y:a.top-110,cls:"CMDBWindow",animCollapse:true,header:true,modal:true,autoHeight:true,width:177,layout:"fit",frame:false,closable:false});d.add(g);g.winHandle=d;d.show()}};var _datePicker=new CMDBDatePickerPopup();function CMDBControl(){this.DisplayName=null;this.ApiName=null;this.DisplayType=null;this.UniqueID=null;this.Element=null;this.Readonly=false;this.Required=false;this.IsExpandImage=false;this.IsDatePickerImage=false;this.IsLabel=false;this.Validate=true;this.MaxLength=null;this.ForControl=null}var __CMDBControlMap;var __EXPAND_IMG_PREFIX="EIMG";var __DATEPICK_IMG_PREFIX="DPCK";var __FIELD_LABEL_PREFIX="FLBL";function ValidateForm(){Date.useStrict=true;var o=null;var a=null;var d=null;var m=true;var j=false;for(var f=0;f<__CMDBControlMap.length;f++){a=__CMDBControlMap.item(f);o=a.Element;if(a.Validate&&a.Required&&a.Element.value.trim()==""){Ext.Msg.alert("",CustomFieldrequiredFieldMsg);m=false;if(!m){return m}}if(a.Validate&&!a.Readonly&&a.DisplayType=="EMAIL"){if(a.Element.value.trim()!=""){var c=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;var b=a.Element.value.trim();if(!c.test(b)){var h=__CMDBControlMap.item(__FIELD_LABEL_PREFIX+a.UniqueID).Element.innerHTML;Ext.Msg.alert("",CustomFieldInvalidEmail+" "+h);m=false}if(!m){return m}}}if(a.Validate&&!a.Readonly&&(a.DisplayType=="CURRENCY"||a.DisplayType=="PERCENT"||a.DisplayType=="PHONE"||a.DisplayType=="DOUBLE"||a.DisplayType=="NUMBER")){if(a.Element.value.trim()!=""){var l=/^-?\d+(\.\d+)?$/;var n=a.Element.value.trim();if(!n.match(l)){var h=__CMDBControlMap.item(__FIELD_LABEL_PREFIX+a.UniqueID).Element.innerHTML;if(a.DisplayType=="DOUBLE"){a.DisplayType="NUMBER"}Ext.Msg.alert("",CustomFieldCorrectValueErrorMsg+" "+h);m=false}if(a.DisplayType=="PHONE"){var g=/^[-]?\d*?\d*$/;if(!(a.Element.value.match(g))){m=false;Ext.Msg.alert("",CustomFieldCorrectValueErrorMsg+" "+__CMDBControlMap.item(__FIELD_LABEL_PREFIX+a.UniqueID).Element.innerHTML)}}if(!m){return m}}}if(a.Validate&&!a.Readonly&&a.DisplayType=="DATETIME"){try{}catch(k){m=false}if(!m){var h=__CMDBControlMap.item(__FIELD_LABEL_PREFIX+a.UniqueID).Element.innerHTML;Ext.Msg.alert("",CustomFieldCMDBDateError+" "+h);return m}}}return m}function LimitText(b,a){if(b.value.length>a){b.value=b.value.substring(0,a)}}function ShowStatusMessage(){if(_ServerValues.savestatus==true){Ext.MessageBox.alert("","_ServerValues.SuccessSaveMsg")}else{Ext.MessageBox.alert("","_ServerValues.savestatusMessage")}}function createControlMap(){__CMDBControlMap=new Ext.util.MixedCollection();var a=document.getElementsByTagName("*");var m=null;var f="";var l="";var j=null;for(var d=0;d<a.length;d++){l="";j=null;m=a[d];f=m.className;if(f.indexOf("CMDBControl")>=0){l=f.substring(f.indexOf("[(")+2,f.lastIndexOf(")]"));j=l.split(":");var b=new CMDBControl();b.Element=m;b.UniqueID=null;for(var c=0;c<j.length;c++){var h=j[c].split("=");switch(h[0]){case"ApiFieldName":b.ApiName=h[1];break;case"DisplayType":b.DisplayType=h[1];break;case"UniqueID":b.UniqueID=h[1];break;case"GroupName":b.GroupName=h[1];break;case"Readonly":b.Readonly=(h[1]=="true");break;case"MaxLength":try{b.MaxLength=parseInt(h[1])}catch(g){}if(b.MaxLength<=0){b.MaxLength=null}break;case"Required":b.Required=(h[1]=="true");break;default:break}}if(b.UniqueID==null||b.UniqueID.trim()==""){b.UniqueID=m.id}if(f.indexOf("CMDB_ExpandImage")>=0){b.IsExpandImage=true;b.ForControl=__CMDBControlMap.item(b.UniqueID);b.UniqueID=__EXPAND_IMG_PREFIX+b.UniqueID;b.Validate=false}if(f.indexOf("CMDB_DatePickerImage")>=0){b.IsDatePickerImage=true;b.ForControl=__CMDBControlMap.item(b.UniqueID);b.UniqueID=__DATEPICK_IMG_PREFIX+b.UniqueID;b.Validate=false}if(f.indexOf("CMDB_FieldLabel")>=0){b.IsFieldLabel=true;b.ForControl=__CMDBControlMap.item(b.UniqueID);b.UniqueID=__FIELD_LABEL_PREFIX+b.UniqueID;b.Validate=false}__CMDBControlMap.add(b.UniqueID,b)}}}function renderElementsByType(){var f=null;var e=null;var d=null;var h=null;var b=null;var a=false;for(var c=0;c<__CMDBControlMap.length;c++){e=__CMDBControlMap.item(c);f=e.Element;h=Ext.get(f);Ext.get(f).on("change",function(){dataModifiedFlag=1});if(e.IsExpandImage){var b=Ext.get(f.id);b.on("click",function(){showExpansionWindow(this)},e);continue}if(e.IsDatePickerImage){var b=Ext.get(f.id);b.on("click",function(){_datePicker.Show(this.ForControl.Element.id)},e);continue}var g={applyTo:f};g.width=200;switch(e.Element.tagName.toUpperCase()){case"INPUT":d=e.Element.type.toUpperCase();if(d=="CHECKBOX"){if(e.Readonly){e.Element.disabled=true}}else{if(e.Readonly){e.Element.readOnly=true;e.Element.className+=" InputVirtualReadOnly"}}switch(e.DisplayType.toUpperCase()){case"STRING":break;case"DATETIME":if(!e.Readonly){}break;case"BOOLEAN":break;default:break}break;case"SELECT":if(e.Readonly){e.Element.disabled=true}break;case"TEXTAREA":e.Element.readOnly=e.Readonly;if(e.MaxLength!=null){applyTextAreaLengthLimit(e)}break;default:break}if(!a&&!e.IsExpandImage&&!e.IsDatePickerImage&&!e.Readonly&&!e.IsFieldLabel){a=true}}}function showExpansionWindow(f){var e=null;var b=__CMDBControlMap.item(__FIELD_LABEL_PREFIX+f.ForControl.UniqueID).Element.innerHTML;var d=f.ForControl.Element.value;var c=Ext.get(f.ForControl.Element).getX();var a=Ext.get(f.ForControl.Element).getY();var g={value:d,readOnly:f.ForControl.Readonly,cls:"InputVirtualReadOnly"};if(f.ForControl.MaxLength!=null){g.maxLength=f.ForControl.MaxLength}var h=new Ext.form.TextArea(g);e=new Ext.Window({layout:"fit",title:b,width:400,height:200,frame:false,animate:true,cls:"CMDBWindow",modal:true,bodyStyle:"padding: 10px; background:#FFFFFF;",defaultType:"textarea",items:[h],buttons:[{text:_ServerValues.OKLabel,handler:function(){var j=h.getValue();var i=f.ForControl.MaxLength;if(i!=null){if(i&&j.length>i){j=j.substr(0,i)}}f.ForControl.Element.value=j;if(d!=f.ForControl.Element.value){dataModifiedFlag=1}e.close()}},{text:_ServerValues.CancelLabel,handler:function(){e.close()}}]});e.show()}function applyTextAreaLengthLimit(b){var a=b.Element;a.maxLength=b.MaxLength;a.onkeydown=function(c){return doKeyPress(a,c)};a.onpaste=function(){return doPaste(a)};a.onkeyup=function(){return doKeyUp(a)};a.onblur=function(){return doKeyUp(a)}}var detect=navigator.userAgent.toLowerCase();function doKeyPress(d,b){var a=d.maxLength;var c=window.event?event.keyCode:b.which;if((c==32)||(c==13)||(c>47)){if(a&&(d.value.length>a-1)){if(window.event){window.event.returnValue=null}else{b.cancelDefault;return false}}}}function doKeyUp(b){var a=b.maxLength;if(a&&b.value.length>a){b.value=b.value.substr(0,a)}}function doPaste(f){var b=f.maxLength;if(b){if((window.event)&&(detect.indexOf("safari")+1==0)){var d=f.document.selection.createRange();var c=b-f.value.length+d.text.length;try{var a=window.clipboardData.getData("Text").substr(0,c);d.text=a}catch(e){}if(window.event){window.event.returnValue=null}else{f.value=f.value.substr(0,b);return false}}}};