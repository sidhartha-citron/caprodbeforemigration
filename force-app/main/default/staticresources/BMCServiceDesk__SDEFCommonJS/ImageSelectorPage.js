var grid;var startOffset=0;var endOffset;GridState={PageSize:0,TotalPages:0,CurrentPage:1,TotalRecords:0,Start:0,End:0};Ext.onReady(function(){Ext.QuickTips.init();if(!result){noRecordsFoundMsg("show")}addImagesInGrid();var b=[{id:"Id",header:labelId,sortable:false,dataIndex:"Id",hidden:true,renderer:applyCursorCss,menuDisabled:true},{header:labelDocName,flex:2,sortable:true,dataIndex:"Name",menuDisabled:true,renderer:rerenderDocName},{header:labelDescription,flex:2,sortable:false,dataIndex:"Description",renderer:applyCursorCss,menuDisabled:true},{header:labelBodyLength,flex:1,sortable:false,dataIndex:"FileSize",renderer:applyCursorCss,menuDisabled:true},{header:labelCreatedDate,autoWidth:true,sortable:false,dataIndex:"CreatedDate",renderer:rerenderDate,menuDisabled:true},{header:labelType,flex:1,sortable:false,dataIndex:"Type",renderer:applyCursorCss,menuDisabled:true},{header:labelImage,autoWidth:true,sortable:false,dataIndex:"Image",renderer:applyCursorCss,menuDisabled:true}];var a=[{name:"Id",type:"string"},{name:"Name",type:"string"},{name:"Description",type:"string"},{name:"BodyLength",type:"string"},{name:"Type",type:"string"},{name:"Image",type:"string"},{name:"FileSize",type:"string"},{name:"CreatedDate",type:"string"}];Ext.define("Documents",{extend:"Ext.data.Model",fields:a});gridStore=new Ext.data.Store({pageSize:50,model:"Documents",data:result,proxy:{type:"memory",reader:{idProperty:"Id",type:"json"},enablePaging:true}});GridState.PageSize=gridStore.pageSize;GridState.TotalRecords=result.length;GridState.TotalPages=Math.ceil(GridState.TotalRecords/GridState.PageSize);GridState.CurrentPage=1;GridState.Start=(GridState.CurrentPage*GridState.PageSize)-(GridState.PageSize-1);GridState.End=GridState.CurrentPage*GridState.PageSize;if(GridState.End>GridState.TotalRecords){GridState.End=GridState.TotalRecords}pagingBar=getPagingToolbar();if(GridState.TotalRecords>9999){pagingBar.displayMsg=labelRecords+" "+GridState.Start+" - "+GridState.End+" "+labelOf+" "+GridState.TotalRecords+"+ "}else{pagingBar.displayMsg=labelRecords+" "+GridState.Start+" - "+GridState.End+" "+labelOf+" "+GridState.TotalRecords}grid=new Ext.grid.GridPanel({store:gridStore,border:false,id:"maindatagrid",cls:"CommonGrid",columns:b,height:425,width:805,enableHdMenu:false,viewConfig:{forceFit:true,columnLines:false,stripeRows:false},selModel:new Ext.selection.RowModel({singleSelect:true}),bbar:pagingBar,renderTo:"grid"});pagingBar.moveFirst()});function applyCursorCss(c,b,a){b.style="line-height: 23px; font-size: 13px; font-family: Salesforce Sans,Arial,sans-serif; padding-top: 5px;";return c}function rerenderDocName(c,b,a){b.style="line-height: 23px; cursor: pointer; font-size: 13px; font-family: Salesforce Sans,Arial,sans-serif; padding-top: 5px;";if(c){c='<a href="#" onclick="setImageId();">'+htmlEscape(c)+"</a>"}return c}function rerenderDate(c,b,a){b.style="line-height: 23px; cursor: pointer; font-size: 13px; font-family: Salesforce Sans,Arial,sans-serif; padding-top: 5px;";if(c){c=c.split("T")[0]}return c}function getPagingToolbar(){var a=new Ext.PagingToolbar({id:"pagingToolbarId",dock:"bottom",cls:"border1px padding5px",doRefresh:applyRefresh,displayInfo:true,emptyMsg:labelNoRecordFoundMsg,inputItemWidth:23,moveNext:moveNext,movePrevious:movePrevious,moveFirst:moveFirst,moveLast:moveLast,listeners:{beforechange:function(e,c,b){var d=a.child("#inputItem").getActionEl().dom.value;if(d>GridState.TotalPages){d=GridState.TotalPages}if(d<=0){d=1}GridState.CurrentPage=parseInt(d);goToPage()}},getPageData:function(){var b={currentPage:GridState.CurrentPage,pageCount:GridState.TotalPages,total:GridState.TotalRecords};return b}});a.bindStore(gridStore,false);a.child("#first").setWidth(15);a.child("#prev").setWidth(15);a.child("#next").setWidth(15);a.child("#last").setWidth(15);a.child("#refresh").setWidth(30);return a}function setImageId(){var a=grid.getSelectionModel().getSelection();if(a&&a.length>0){var b=a[0].data.Id;window.parent.getImageID(b)}}function addImagesInGrid(){if(result){var b=result.length;if(b>0){for(var a=0;a<b;a++){var c=result[a];c.Image='<img height="20px" width="20px" src="'+getSFDocumentURL(c.Id)+'"/>';c.FileSize=getReadableSize(c.BodyLength)}}}}function htmlEscape(a){if(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}else{return""}}function moveFirst(){GridState.CurrentPage=1;endOffset=GridState.PageSize-1;startOffset=0;loadGridData(startOffset,endOffset)}function movePrevious(){GridState.CurrentPage-=1;endOffset=(GridState.CurrentPage*GridState.PageSize)-1;startOffset=(endOffset-GridState.PageSize)+1;if(startOffset<0){startOffset=0}loadGridData(startOffset,endOffset)}function moveNext(){startOffset=endOffset+1;GridState.CurrentPage+=1;if(GridState.CurrentPage<GridState.TotalPages){endOffset+=GridState.PageSize}else{if((GridState.TotalRecords%GridState.PageSize)==0){endOffset+=GridState.PageSize}else{endOffset+=GridState.TotalRecords%GridState.PageSize}}loadGridData(startOffset,endOffset)}function moveLast(){startOffset=(GridState.TotalPages-1)*GridState.PageSize;endOffset=GridState.TotalRecords-1;GridState.CurrentPage=GridState.TotalPages;loadGridData(startOffset,endOffset)}function goToPage(){if(GridState.CurrentPage==1){startOffset=0;endOffset=GridState.PageSize-1}else{if(GridState.CurrentPage==GridState.TotalPages){startOffset=(GridState.TotalPages-1)*GridState.PageSize;endOffset=GridState.TotalRecords-1}else{endOffset=(GridState.CurrentPage*GridState.PageSize)-1;startOffset=(endOffset-GridState.PageSize)+1}}loadGridData(startOffset,endOffset)}function loadGridData(a,c){var b=[];if(result.length<=c){c=result.length-1}for(var d=a;d<c+1;d++){b.push(result[d])}grid.store.loadData(b);refreshPGBar()}function refreshPGBar(){GridState.Start=(GridState.CurrentPage*GridState.PageSize)-(GridState.PageSize-1);GridState.End=GridState.CurrentPage*GridState.PageSize;if(GridState.End>GridState.TotalRecords){GridState.End=GridState.TotalRecords}if(GridState.TotalRecords>9999){pagingBar.displayMsg=labelRecords+" "+GridState.Start+" - "+GridState.End+" "+labelOf+" "+GridState.TotalRecords+"+ "}else{pagingBar.displayMsg=labelRecords+" "+GridState.Start+" - "+GridState.End+" "+labelOf+" "+GridState.TotalRecords}pagingBar.onLoad()}function searchOnKeyPress(b){var c;if(window.event){c=b.keyCode||b.which||b.charCode}var a=document.getElementById("searchField");var d=document.getElementById("clearLink");if(a&&d){if(a.value.length>0){d.style.visibility="visible"}else{d.style.visibility="hidden";clearText()}}if(c==13){if(a.value.length>1){document.getElementById("errorMessage").style.display="none";searchDoc(a.value)}else{document.getElementById("errorMessage").style.display="block";return true}}return false}function clearText(){document.getElementById("searchField").value="";document.getElementById("clearLink").style.visibility="hidden";applyRefresh()}function searchImage(){var b=Ext.getCmp("maindatagrid");var a=document.getElementById("searchField").value;if(a.length>1){searchDoc(a);document.getElementById("errorMessage").style.display="none"}else{document.getElementById("errorMessage").style.display="block"}}function setData(){GridState.PageSize=gridStore.pageSize;GridState.CurrentPage=1;GridState.TotalRecords=result.length;GridState.TotalPages=Math.ceil(GridState.TotalRecords/GridState.PageSize);GridState.Start=(GridState.CurrentPage*GridState.PageSize)-(GridState.PageSize-1);GridState.End=GridState.CurrentPage*GridState.PageSize;if(GridState.End>GridState.TotalRecords){GridState.End=GridState.TotalRecords}pagingBar.moveFirst()}function loadSearchData(){if(searchResult&&searchResult.length>0){if(document.getElementById("noRecordFound").style.display=="block"){noRecordsFoundMsg("hide")}result=searchResult;addImagesInGrid();startOffset=0;setData()}else{noRecordsFoundMsg("show")}}function noRecordsFoundMsg(a){if(a=="show"){document.getElementById("noRecordFound").style.display="block";document.getElementById("grid").style.display="none"}if(a=="hide"){document.getElementById("noRecordFound").style.display="none";document.getElementById("grid").style.display="block"}}function applyRefresh(){location.reload()};