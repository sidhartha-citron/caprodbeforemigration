if(typeof(console)=="undefined"||console==null){console={log:function(){}}}var state_dropdown_store=Ext.create("Ext.data.SimpleStore",{fields:["value","label"],data:[["Detected",labels.Detected],["Investigating",labels.Investigating],["Ignored",labels.Ignored],["Resolved",labels.Resolved]]});function addLocalOffset(b){if(typeof(b)!="undefined"&&b!=null){var d=Ext.Date.parse(b,"c");if(typeof(d)!="undefined"&&d!=null){var f=d.getTimezoneOffset();var e=d.getTime();var c=e+(f*60000);var a=new Date(c+serverLocalOffset);b=Ext.Date.format(a,"time");return b}}}function getInitialRecords(b){var a=null;var g=null;console.log("The initial records list"+JSON.stringify(b));for(var e=0;e<b.length;e++){g=b[e];var f=g.colliding_change;var c=f.start_date;var d=f.end_date;f.start_date=addLocalOffset(c);f.end_date=addLocalOffset(d)}console.log("The final records list"+JSON.stringify(b));return b}function OpenHelppage(){if(wikiUrl!=null&&typeof(wikiUrl)!="undefined"&&isNewContextpage()&&wikiUrl!=""){window.open(wikiUrl,false,"width="+screen.width+",height="+screen.height+",resizable = 1,scrollbars=yes,status=1,top=0,left=0",false)}else{window.open(helpResource+"/"+filename+".htm",false,"width="+screen.width+",height="+screen.height+",resizable = 1,scrollbars=no,status=1,top=0,left=0",false)}}Ext.onReady(function(){Ext.QuickTips.init();var g={};var a=true;getInitialRecords(collisions);console.log("The final colliding list"+JSON.stringify(collisions));if(typeof(selected_states)!="undefined"&&selected_states!=null&&selected_states.trim()!=""){var e=selected_states.toLowerCase().trim().split(",");for(var d=0;d<e.length;d++){g[e[d]]=true}a=false}var h=600;var b=[{name:"state",type:"string"},{name:"colliding_change.name",type:"string"},{name:"colliding_change.start_date",type:"date",dateFormat:"time"},{name:"colliding_change.end_date",type:"date",dateFormat:"time"},{name:"ci.name",type:"string"}];Ext.define("CollisionModel",{extend:"Ext.data.Model",fields:b});ListViewStore=Ext.create("Ext.data.JsonStore",{model:"CollisionModel",data:collisions,sorters:[{property:"colliding_change.name",direction:"ASC",}],proxy:{type:"memory",reader:{idProperty:"Id",type:"json"}}});var c={height:35,padding:"0 0 0 15px",items:[{xtype:"label",text:labels.IncludeCollisionState+": ",cls:"class_bold_tbar_label"},{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"tbspacer"},{boxLabel:labels.Detected,name:"collision_check",id:"id_detected",checked:(g.detected||a),xtype:"checkboxfield"},{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"tbspacer"},{boxLabel:labels.Investigating,name:"collision_check",id:"id_investigating",checked:(g.investigating||a),xtype:"checkboxfield"},{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"tbspacer"},{boxLabel:labels.Ignored,name:"collision_check",id:"id_ignored",checked:(g.ignored||a),xtype:"checkboxfield"},{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"tbspacer"},{boxLabel:labels.Resolved,name:"collision_check",id:"id_resolved",checked:(g.resolved||a),xtype:"checkboxfield"},{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"button",id:"detectButton",text:labels.DetectCollisions,tooltip:labels.DetectCollisionsTooltip,handler:function(){CollisionsPanel.showWaitMask();var k=changeCollisionsPageURL+"&CurrentChangeID="+current_change_id;var i="";if(Ext.getCmp("id_detected").getValue()){i+="detected,"}if(Ext.getCmp("id_ignored").getValue()){i+="ignored,"}if(Ext.getCmp("id_investigating").getValue()){i+="investigating,"}if(Ext.getCmp("id_resolved").getValue()){i+="resolved,"}k+="&States="+i;window.location.href=k}},"->",{xtype:"label",html:'<a href="#" onclick="OpenHelppage();"><img title="'+labels.Help+'" height="17" width="17" id="helpCollisionList" src="'+imageHelp+'/SDEFbuttons/b_console_help.png"></a>'}]};var j={height:35,items:[{xtype:"button",id:"saveButton",cls:"btn-footer",disabled:true,text:labels.Save,handler:function(){var m=ListViewStore.data.items;var k=[];k.push({root:current_change_id});for(var l=0;l<m.length;l++){k.push({id:m[l].data.id,state:m[l].data.state+"#"+m[l].raw.colliding_change.name})}SaveData(k);Ext.getCmp("saveButton").disable()}},{xtype:"button",id:"closeButton",cls:"btn-footer",text:labels.Close,handler:function(){window.close()}},{xtype:"tbspacer"}]};var f=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1});ListViewGrid=Ext.create("Ext.grid.Panel",{id:"listViewGridPanelId",stripeRows:true,height:h,store:ListViewStore,autoScroll:true,viewConfig:{deferEmptyText:false,emptyText:labels.NoRecordFoundMsg},columns:[{header:labels.CollisionState,dataIndex:"state",sortable:true,field:{xtype:"combobox",editable:false,typeAhead:true,triggerAction:"all",selectOnTab:true,store:state_dropdown_store,displayField:"label",valueField:"value",lazyRender:true,listClass:"x-combo-list-small",listeners:{change:function(l,i,k){Ext.getCmp("saveButton").enable()}}},renderer:function(p,k,n,r,l,q,i){var o;var m=state_dropdown_store.findRecord("value",p);if(m!=null&&m!="undefined"&&m!=""){o=m.get("label")}return'<span class="collision_state_col">'+o+'<i class="edit_state_icon">&nbsp;</i></span>'}},{header:labels.CollidingChangeNo,dataIndex:"colliding_change.name",sortable:true},{header:labels.ScheduledStart,type:"date",dataIndex:"colliding_change.start_date",renderer:Ext.util.Format.dateRenderer(ExtJSUserDateFormat),sortable:false},{header:labels.ScheduledEnd,type:"date",dataIndex:"colliding_change.end_date",renderer:Ext.util.Format.dateRenderer(ExtJSUserDateFormat),sortable:false},{header:labels.ConfigurationItem,dataIndex:"ci.name",sortable:false,renderer:function(l,k,i){var m;m=i.get("ci.name");k.tdAttr='title="'+Ext.util.Format.htmlEncode(Ext.util.Format.ellipsis(m,800))+'"';return Ext.util.Format.htmlEncode(l)}}],enableColumnHide:false,autoExpandColumn:"ci.name",region:"center",plugins:[f],forceFit:true});ChangeDetailsPanel=Ext.create("Ext.Panel",{id:"change_details_panel",region:"west",contentEl:"change_details_div"});CollisionsPanel=Ext.create("Ext.Panel",{id:"collisions_panel",layout:"border",buttonAlign:"left",tbar:c,fbar:j,height:h,items:[ChangeDetailsPanel,ListViewGrid],renderTo:"grid-div"});Ext.EventManager.onWindowResize(function(){var k=Ext.getBody().getViewSize().width;var i=Ext.getBody().getViewSize().height;CollisionsPanel.setSize(k,i)});CollisionsPanel.waitMask=new Ext.LoadMask(CollisionsPanel,{msg:labels.WaitMaskMsg});CollisionsPanel.showWaitMask=function(){this.waitMask.show()};CollisionsPanel.hideWaitMask=function(){this.waitMask.hide()}});function SaveData(a){CollisionsPanel.showWaitMask();Visualforce.remoting.Manager.invokeAction(SaveData_Remote,a,function(b,c){console.log(b);CollisionsPanel.hideWaitMask();if(typeof(b.ExceptionMessage)!="undefined"||b.ExceptionMessage!=null){Ext.Msg.show({msg:b.ExceptionMessage,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}else{Ext.Msg.show({title:labels.CollisionDetection,msg:labels.SavedSuccessfully,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})}},{escape:true})};