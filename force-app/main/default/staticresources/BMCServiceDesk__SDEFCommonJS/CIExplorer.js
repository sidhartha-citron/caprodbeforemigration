var Diagram=MindFusion.Diagramming.Diagram;var Behavior=MindFusion.Diagramming.Behavior;var Events=MindFusion.Diagramming.Events;var DiagramLink=MindFusion.Diagramming.DiagramLink;var ShapeNode=MindFusion.Diagramming.ShapeNode;var LayeredLayout=MindFusion.Graphs.LayeredLayout;var FractalLayout=MindFusion.Graphs.FractalLayout;var TreeLayout=MindFusion.Graphs.TreeLayout;var SpringLayout=MindFusion.Graphs.SpringLayout;var BorderedTreeLayout=MindFusion.Graphs.BorderedTreeLayout;var TreeLayoutLinkType=MindFusion.Graphs.TreeLayoutLinkType;var DoNothingBehavior=MindFusion.Diagramming.DoNothingBehavior;var SelectOnlyBehavior=MindFusion.Diagramming.SelectOnlyBehavior;var LinkNodesBehavior=MindFusion.Diagramming.LinkNodesBehavior;var AbstractionLayer=MindFusion.AbstractionLayer;var Font=MindFusion.Drawing.Font;var Rect=MindFusion.Drawing.Rect;var Text=MindFusion.Drawing.Text;var isRefresh=false;var layoutDirection=0;var buildDiagramCount=0;var initialNodes;var initialEdges;var expandedNodes;var expandedEdges;var filterQuery;var filterClass;var displayNodes=[];var displayEdges=[];var collNodeIds=[];var collEdgeIds=[];var collEdges=[];var diagram=null;var nodeMap={};var nodeCITypeMap={};var classNameWithClassId=new Object();var classTypeSet=new Set();var WinMsg;function clone(b){if(null==b||"object"!=typeof b){return b}var c=Object.create(b);for(var a in b){if(b.hasOwnProperty(a)){c[a]=b[a]}}return c}var CINode=function(a){AbstractionLayer.initializeBase(CINode,this,[a])};CINode.prototype={updateCanvasElements:function(b){AbstractionLayer.callBaseMethod(CINode,this,"updateCanvasElements");if(this.nodeImage){this.nodeImage.setBounds(new Rect(this.bounds.x+this.bounds.width/2-4,this.bounds.y+1,8,8));this.graphicsContainer.content.push(this.nodeImage)}var a=Font.copy(this.getEffectiveFont());var c=new Rect(this.bounds.x,this.bounds.y+10,this.bounds.width,this.bounds.height-10);this.text.font=new Font("Tahoma",2.8,false,false);this.text.setBounds(c,0)},loadNodeImage:function(){this.nodeImage.loaded=true;if(this.parent){this.invalidate()}},getNodeImageLocation:function(){return this.nodeImageLocation},setNodeImageLocation:function(a){if(this.nodeImageLocation!=a){this.nodeImageLocation=a;if(a){this.nodeImage=new MindFusion.Drawing.Image(new Rect(this.bounds.x+this.bounds.width/2-4,this.bounds.y+1,8,8));AbstractionLayer.addHandlers(this.nodeImage.image,{load:AbstractionLayer.createDelegate(this,this.loadNodeImage)});this.nodeImage.image.src=a}}},getUID:function(){return this.UID},setUID:function(a){if(this.UID!==a){this.UID=a}},getName:function(){return this.Name},setName:function(a){if(this.Name!==a){this.Name=a}},getInstType:function(){return this.instType},setInstType:function(a){if(this.instType!==a){this.instType=a}},getNodeID:function(){return this.ID},setNodeID:function(a){if(this.ID!==a){this.ID=a}},getNodeType:function(){return this.nodeType},setNodeType:function(a){if(this.nodeType!==a){this.nodeType=a}},getNodeCIClassType:function(){return this.nodeCIClassType},setNodeCIClassType:function(a){if(this.nodeCIClassType!==a){this.nodeCIClassType=a}}};function documentOnReady(){AbstractionLayer.registerClass(CINode,"CINode",MindFusion.Diagramming.ShapeNode);diagram=Diagram.create($("#diagram")[0]);diagram.addEventListener(Events.nodeClicked,onNodeClicked);diagram.setLicenseLocation(licenseLocation);diagram.addEventListener(Events.nodeDoubleClicked,onNodeDblClicked);diagram.addEventListener(Events.clicked,onDiagramClicked);diagram.setCustomNodeType(CINode);diagram.setBehavior(Behavior.SelectOnly);SelectOnlyBehavior.prototype.setMouseCursor=function(e){var f=this.diagram.getNodeAt(e);return f?"pointer":"default"};diagram.setDelKeyAction(MindFusion.Diagramming.DelKeyAction.None);diagram.setAutoResize(MindFusion.Diagramming.AutoResize.AllDirections);diagram.setLinkHeadShapeSize(2);diagram.handleBrush="#FF9999";diagram.setShadowsStyle(MindFusion.Diagramming.ShadowsStyle.None);diagram.selection.allowMultipleSelection=false;var d=launchAttributesCI;var c=JSON.parse(d);initialNodes=expandedNodes=c.nodes;initialEdges=expandedEdges=c.edges;nodeMap={};for(var a=0;a<expandedNodes.length;a++){nodeMap[expandedNodes[a].uid]=expandedNodes[a].instType;nodeCITypeMap[expandedNodes[a].uid]=expandedNodes[a].ciType;if(expandedNodes[a].ciType){classTypeSet.add(expandedNodes[a].ciType);classNameWithClassId[expandedNodes[a].ciType]=expandedNodes[a].ciClassName}}createClassFilterUI();displayDateTime("BuildDiagram() start from document onready ");buildDiagram(expandedNodes,expandedEdges);var b=MindFusion.Controls.ZoomControl.create($("#zoomer")[0]);b.setTarget(diagram)}var htmlFilterDiv="";function createClassFilterHTML(d){var b=0;var c="";var a="";for(b=0;b<classTypes.length;b++){c=classNameWithClassId[classTypes[b]];if(c&&c.length>20){a=c.slice(0,20)+"..."}else{a=c}if(classTypes[b]!=selectAllLabel){htmlFilterDiv+='<label class="rf-filter-checkbox tooltip" title="'+c+'">'+a+'<input type="checkbox" value="'+classTypes[b]+'" onchange="addIntoClassFilter(event,\''+classTypes[b]+'\')"/><span class="rf-checkmark"></span></label>'}}}function addIntoClassTypesForSorting(a){if(classTypes.indexOf(a)==-1){classTypes.push(a)}}function createClassFilterUI(){var a=0;htmlFilterDiv='<label class="rf-filter-checkbox">'+selectAllLabel+'<input type="checkbox" value="'+selectAllLabel+'" onchange="addIntoClassFilter(event,\'Select All\')"/><span class="rf-checkmark"></span></label>';classTypeSet.forEach(addIntoClassTypesForSorting);classTypes.sort();createClassFilterHTML();filterDivHTML=RemedyForceHTMLProcessor.htmlDecoder(htmlFilterDiv);filterDiv=document.getElementById("filterDiv");RemedyForceHTMLProcessor.parseHTML(filterDiv,filterDivHTML)}function reloadCheckboxDiv(d){var a=document.getElementById("classFilterDiv").getElementsByTagName("INPUT");var b=0;var c=0;for(b=0;b<a.length;b++){for(c=0;c<d.length;c++){if(a[b].value==d[c]){a[b].checked=true;break}}}}function filterOnClassType(a){filterClass=a;displayNodes=[];displayEdges=[];collNodeIds=[];collEdgeIds=[];collEdges=[];var b=[];b.push(initialNodes[0].uid);collNodeIds.push(initialNodes[0].uid);refactorNodesToDisplay(b,expandedEdges);setDisplayProps();diagram.clearAll();displayDateTime("BuildDiagram() start from class filter");buildDiagram(displayNodes,displayEdges)}function filterRelationships(a){filterQuery=a;displayNodes=[];displayEdges=[];collNodeIds=[];collEdgeIds=[];collEdges=[];var b=[];b.push(initialNodes[0].uid);collNodeIds.push(initialNodes[0].uid);refactorNodesToDisplay(b,expandedEdges);setDisplayProps();diagram.clearAll();displayDateTime("BuildDiagram() start from filter relation ");buildDiagram(displayNodes,displayEdges)}function buildGraphData(){var e=JSON.stringify(launchAttributesCI);var d=jQuery.parseJSON(e);var c=[];var b=[];$.each(d.nodes,function(g){var h=d.nodes[g];if(typeof(getDiagramNodeByUID(h.uid))!="undefined"){return true}c.push(h);expandedNodes.push(h);if(!classTypeSet.has(h.ciType)){classTypeSet.add(h.ciType);classNameWithClassId[h.ciType]=h.ciClassName;if(filterClass.indexOf(h.ciType)==-1){classFilterValues.push(h.ciType)}}});createClassFilterUI();createClassFilterTooltip();reloadCheckboxDiv(classFilterValues);filterClass=classFilterValues.join("|");$.each(d.nodes,function(h){var l=d.nodes[h].uid;var g=d.nodes[h].ciType;$.each(d.edges,function(m){var n=d.edges[m];var o=false;for(h=0;h<expandedEdges.length;h++){if(n.leftNodeId==expandedEdges[h].leftNodeId&&n.rightNodeId==expandedEdges[h].rightNodeId){o=true;nodeCITypeMap[l]=g;break}}if(o==false){b.push(n);expandedEdges.push(n)}})});if(c.length==0&&b.length==0){GetMessageBox("bmc-message").show({title:"",msg:labels.AllCIRelDisplayed,minWidth:300,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});return}if(filterQuery!=null&&typeof(filterQuery)!="undefined"){displayNodes=[];displayEdges=[];collNodeIds=[];collEdgeIds=[];collEdges=[];var a=[];var f=getDiagramNodeByID(selectedInstanceID).getUID();a.push(f);collNodeIds.push(f);refactorNodesToDisplay(a,b);collNodeIds.splice(0,1);if(collNodeIds.length==0){GetMessageBox("bmc-message").show({title:"",msg:labels.AllCIRelDisplayed,minWidth:300,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});return}if(c.length!=0){setDisplayProps()}else{displayEdges=collEdges}buildDiagram(displayNodes,displayEdges)}else{buildDiagram(c,b)}}var nodeSelectedObject=(function selectedNodeInDiagram(){var a;return{setSelectedNode:function(b){a=b},getSelectedNode:function(){return a}}})();function refreshDiagram(){diagram.clearAll();isRefresh=true;var a=Ext.getCmp("combo");a.reset();a.setValue(a.getStore().getAt(2).get(a.valueField),true);layoutDirection=0;diagram.clearAll();invokeServerRequest("genroot",recordSeq,moduleSeq)}function refreshInfoPan(){var a=nodeSelectedObject.getSelectedNode();if((a!=null)&&(a!=undefined)){var b=labels.Instance+': <a href="#" id="CIExplorerInstTitleLink" onclick=showPopup("bmc_baseelement__c","'+a.getNodeID()+'","ciexplorer");>'+a.getName()+"</a>";setLoadDetails(b,a.getNodeID());Ext.getCmp("childPanel").setTitle(b);getInfoPane(a.getNodeID());Ext.getCmp("impactAnalysis").enable()}}function repositionNodes(){layoutDirection++;if(layoutDirection==4){layoutDirection=0}applyLayout(Ext.getCmp("combo").getValue())}var listHiddenNode=[];function buildDiagram(c,b){var e=new Rect(0,0,32,10);listHiddenNode=[];$.each(c,function(p){node=c[p];if(filterClass&&new RegExp("^("+filterClass.toUpperCase()+")$").test(node.ciType.toUpperCase())||node.ciType==""){var m=new CINode(diagram);m.setTransparent(true);m.setBounds(e);var t=resourceURL+"/images/ci/";var q=/[a-zA-Z0-9]{15}|[a-zA-Z0-9]{18}/;var n="CI";if(node.uid.indexOf("_")>0){n=node.uid.substring(0,node.uid.indexOf("_"));m.setNodeType(n);t=generatePath(n)}var r=node.label;if(n!="CI"&&n!="service"){if(n=="Incident"){if(node.isServiceRequest=="true"){r=labels.ServiceRequestPrefix+node.label}else{r=labels.IncidentRecordPrefix+node.label}}else{r=genLabelPrefix(n)+" "+node.label}m.setLocked(true)}else{if(isAssetManagementEnabled&&isCIManagementEnabled){if(r.indexOf("\n")>0){r=r.replace("\n","("+node.instType+")\n")}else{r=r+"("+node.instType+")"}}}var h=m.bounds.clone();var o=new Font("Tahoma",2.8,false,false);var s=m.parent.measureString(r,o,h);h.height=h.height+s.height+2;m.setBounds(h,true,true);var g=node.image;if(selectedFilter!=null){if((selectedFilter=="Asset"||selectedFilter=="All")&&node.instType=="CI / Asset"){if(node.assetruleclassimage.indexOf("null_32")!=-1||node.assetruleclassimage==""){g=node.image}else{g=node.assetruleclassimage}}}if((g.length==15||g.length==18)&&q.test(g)){t=window.opener.getSFDocumentURL(g)}m.setText(r);m.setNodeImageLocation(t+g);m.setTooltip(getCIToolTip(node));m.setUID(node.uid);m.setName(Ext.util.Format.htmlEncode(node.name));m.setInstType(node.instType);m.setNodeID(node.id);diagram.setCustomNodeType(CINode);diagram.addItem(m);m.setNodeCIClassType(node.ciClassName)}else{var m=new CINode(diagram);m.setUID(node.uid);m.setNodeID(node.id);diagram.setCustomNodeType(CINode);m.setTransparent(true);var l=clone(e);l.width=1;l.height=1;m.setBounds(l);m.setText("   ");diagram.addItem(m);listHiddenNode.push(node.ciType.toUpperCase());m.setNodeCIClassType(node.ciClassName)}});displayDateTime("Node filter completion ");$.each(b,function(h){link=b[h];var n=nodeCITypeMap[link.leftNodeId];var g=nodeCITypeMap[link.rightNodeId];if(diagram&&(filterQuery&&new RegExp("^("+filterQuery.toUpperCase()+")$").test(link.relationType.toUpperCase())||link.relationType=="")&&(n&&filterClass&&filterClass.indexOf(n)>-1||n=="")&&!(listHiddenNode.indexOf(n)>-1)&&(g&&filterClass&&filterClass.indexOf(g)>-1||g=="")&&!(listHiddenNode.indexOf(g)>-1)){var l=diagram.getFactory().createDiagramLink(getDiagramNodeByUID(link.leftNodeId),getDiagramNodeByUID(link.rightNodeId));l.setShape(1);var m=link.fillColor;if(link.fillColor.indexOf("#")==-1){m="#"+m}l.setStroke(m);var o=MindFusion.Drawing.DashStyle.Solid;if(link.type=="Dotted"){o=MindFusion.Drawing.DashStyle.Dot}l.setStrokeDashStyle(o);if(link.arrowStyle=="RightToLeft"||link.arrowStyle=="LeftToRight"){l.setHeadShape("Alternative");l.setHeadBrush(m)}else{l.setHeadShape("")}l.setBaseShape("");l.setLocked(true);l.setStrokeThickness(link.lineWeight)}else{var l=diagram.getFactory().createDiagramLink(getDiagramNodeByUID(link.leftNodeId),getDiagramNodeByUID(link.rightNodeId));var o=MindFusion.Drawing.DashStyle.Solid;l.setStrokeDashStyle(o);l.setStroke("#FFFFFF");l.setBaseShape("");l.setLocked(true);l.setStrokeThickness(0)}});displayDateTime("Link filter completion ");if(buildDiagramCount!=0){if(typeof(Ext.getCmp("combo"))=="undefined"){applyLayout("LL")}else{applyLayout(Ext.getCmp("combo").getValue())}}else{buildDiagramCount++}displayDateTime("Apply layout end");if(diagram&&diagram.activeItem==null){var a;if(c[0].ciType){a=getDiagramNodeByUID(c[0].uid);a.Name=c[0].name;a.setSelected(true);nodeSelectedObject.setSelectedNode(a)}else{if(c[1]){a=getDiagramNodeByUID(c[1].uid);a.Name=c[1].name;a.setSelected(true);nodeSelectedObject.setSelectedNode(a)}}if(diagram.getNodes().length>0&&nodeSelectedObject.setSelectedNode(a)){if(getDiagramNodeByUID(c[0].uid)){var d=getDiagramNodeByUID(c[0].uid).getNodeType();if(d!="CI"&&d!="service"){if(diagram.getNodes().length>1){a=getDiagramNodeByUID(c[1].uid);a.setSelected(true)}}else{a=getDiagramNodeByUID(c[0].uid);a.setSelected(true)}}}if(a){var f=labels.Instance+': <a href="#" id="CIExplorerInstTitleLink" onclick=showPopup("bmc_baseelement__c","'+a.getNodeID()+'","ciexplorer");>'+a.getName()+"</a>";setLoadDetails(f,a.getNodeID());if(nodeMap[a.UID]){getInfoPane(a.getNodeID())}}}displayDateTime("BuildDiagram() ends ")}function displayDateTime(c){var a=new Date();var b=a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+":"+a.getMilliseconds();console.log(c+" at : ",b)}function getDiagramNodeByUID(a){var b;for(i=0;i<diagram.getNodes().length;i++){if(diagram.nodes[i].getUID()==a){b=diagram.nodes[i];break}}return b}function getDiagramNodeByID(b){var a;for(i=0;i<diagram.getNodes().length;i++){if(diagram.nodes[i].getNodeID()==b){a=diagram.nodes[i];break}}return a}function generatePath(a){var b=resourceURL+"/images/ci/";if(a=="CI"){b=resourceURL+"/images/ci/"}else{if(a=="service"){b=resourceURL+"/images/service/"}else{b=resourceURL+"/images/others/"}}return b}function setDisplayProps(){for(j=0;j<collNodeIds.length;j++){for(i=0;i<expandedNodes.length;i++){if(collNodeIds[j]==expandedNodes[i].uid){displayNodes.push(expandedNodes[i]);break}}}displayEdges=collEdges}function applyLayout(b){displayDateTime("Applylayout() start");var d=new LayeredLayout();if(b==null||typeof(b)=="undefined"){b="LL"}if(b=="LL"){d=new LayeredLayout();d.nodeDistance=10;d.layerDistance=10;d.direction=layoutDirection;d.siftingRounds=6}else{if(b=="FL"){d=new FractalLayout();d.root=diagram.nodes[0]}else{if(b=="BT"){d=new BorderedTreeLayout();d.direction=layoutDirection;d.nodeDistance=10;d.levelDistance=10}else{if(b=="SL"){d=new SpringLayout();d.iterations=100;d.nodeDistance=10}else{if(b=="TL"){d=new TreeLayout();d.root=diagram.nodes[0];d.direction=layoutDirection;d.levelDistance=10;d.nodeDistance=10;d.keepRootPosition=true}}}}}displayDateTime("Diagram.Arrange() method start");diagram.arrange(d);displayDateTime("Diagram.Arrange() method end");diagram.resizeToFitItems();var e=diagram.getContentBounds();var a=diagram.getViewport();if(e.width<a.width){var c=diagram.getBounds();c.x=e.center().x-a.width/2;c.width=a.width;diagram.setBounds(c)}diagram.zoomToRect(a)}function onNodeClicked(d,b){var f=b.getNode();var a=f.getNodeType();if(a=="CI"||a=="service"){var g=labels.Instance+': <a href="#" id="CIExplorerInstTitleLink" onclick=showPopup("bmc_baseelement__c","'+f.getNodeID()+'","ciexplorer");>'+f.getName()+"</a>";Ext.getCmp("childPanel").setTitle(g);getInfoPane(f.getNodeID());Ext.getCmp("impactAnalysis").enable()}else{Ext.getCmp("impactAnalysis").disable()}var e=f.nodeCIClassType.toLowerCase();var c;if(window.opener){c=window.opener.parent}if(e&&c&&c.isCMDBClassPermissionsEnable&&c.classAccessMap&&!c.classAccessMap[e].Permissions.isAccessible){document.getElementById("childPanel").style.display="none"}else{document.getElementById("childPanel").style.display="block"}}function onNodeDblClicked(c,b){var d=b.getNode();var a=d.getNodeType();if(a=="CI"){invokeServerRequest("showCIrel",d.getNodeID(),"")}else{if(a=="service"){invokeServerRequest("showModuleLinkToCI",d.getNodeID(),"")}}}function onDiagramClicked(b,a){Ext.getCmp("impactAnalysis").disable()}function onResponse(a){if(a!=null){launchAttributesCI=jQuery.parseJSON(JSON.stringify(a));if(!isRefresh){buildGraphData()}else{var d=JSON.stringify(launchAttributesCI);var c=jQuery.parseJSON(d);initialNodes=expandedNodes=c.nodes;initialEdges=expandedEdges=c.edges;nodeMap={};classTypeSet=new Set();classTypes=[selectAllLabel];for(var b=0;b<expandedNodes.length;b++){nodeMap[expandedNodes[b].uid]=expandedNodes[b].instType;nodeCITypeMap[expandedNodes[b].uid]=expandedNodes[b].ciType;classNameWithClassId[expandedNodes[b].ciType]=expandedNodes[b].ciClassName;classTypeSet.add(expandedNodes[b].ciType)}createClassFilterUI();setDefaultValuesToFilter();filterClass=classFilterValues.join("|");filterQuery=relationFilterValues.join("|");buildDiagram(expandedNodes,expandedEdges);isRefresh=false}}}function onFailure(a){}function refactorNodesToDisplay(b,a){var c=[];var d=selectedFilter;if(b==null||b.length==0){return}$.each(b,function(e){var f=b[e];$.each(a,function(g){var h=a[g];if(filterClass){if(h.leftNodeId==f){if(d=="All"||nodeMap[h.rightNodeId].indexOf(d)>-1||nodeMap[h.rightNodeId]==""){if($.inArray(h.rightNodeId,collNodeIds)==-1){c.push(h.rightNodeId);collNodeIds.push(h.rightNodeId)}if($.inArray(h.relationName,collEdgeIds)==-1||(h.relationName==""&&$.inArray(h,collEdges)==-1)){collEdgeIds.push(h.relationName);collEdges.push(h)}}}else{if(h.rightNodeId==f){if(d=="All"||nodeMap[h.leftNodeId].indexOf(d)>-1||nodeMap[h.leftNodeId]==""){if($.inArray(h.leftNodeId,collNodeIds)==-1){c.push(h.leftNodeId);collNodeIds.push(h.leftNodeId)}if($.inArray(h.relationName,collEdgeIds)==-1||(h.relationName==""&&$.inArray(h,collEdges)==-1)){collEdgeIds.push(h.relationName);collEdges.push(h)}}}}}})});refactorNodesToDisplay(c,a)}function getCIToolTip(d){var b,c="";if(typeof(d.hoverText)==="undefined"){c="</span>"+genLabelPrefix(d.type.replace(/__c/g,""))+" "+Ext.util.Format.htmlEncode(d.name)+"</span>"}else{b=d.hoverText.split("1s2a3m4i5r");var a=(d.image.indexOf("_Error")!=-1);var e="";if(a){e='<div class="ci_impacted_ttip"><i class="ci_impacted">&nbsp;</i>'+labels.Impacted+"</div>";if(d.type!="CI"||d.type!="service"){c='<table class="ttipTable" cellpadding=2 cellspacing=5 border=0><tr><td class="ttipHeader1" align="center" colspan="3" style="white-space:normal;">'+Ext.util.Format.htmlEncode(d.name)+e+"</td></tr>"}else{c='<table class="ttipTable" cellpadding=2 cellspacing=5 border=0><tr><td class="ttipHeader1" width="25%">'+genLabelPrefix(d.type.replace(/__c/g,""))+'</td><td class="ttipHeader1" style="white-space:normal;">'+Ext.util.Format.htmlEncode(d.name)+e+"</td></tr>"}}else{if(d.type!="CI"||d.type!="service"){c='<table class="ttipTable" cellpadding=2 cellspacing=5 border=0><tr><td class="ttipHeader1" align="center" colspan="3" style="white-space:normal;">'+Ext.util.Format.htmlEncode(d.name)+"</td></tr>"}else{c='<table class="ttipTable" cellpadding=2 cellspacing=5 border=0><tr><td class="ttipHeader1" width="27%">'+genLabelPrefix(d.type.replace(/__c/g,""))+'</td><td class="ttipHeader1" style="white-space:normal;">'+Ext.util.Format.htmlEncode(d.name)+"</td></tr>"}}if(b!=null){$.each(b,function(g){arrTooltipField=b[g];var h=arrTooltipField.split(":");if(h!=null&&h.length>=2){if(h.length==2){c+='<tr><td class="ttipHeader2" colspan="1">'+h[0]+':</td><td class="ttipLabel" colspan="2">'+Ext.util.Format.htmlEncode(h[1])+"</td></tr>"}else{var f="";for(k=1;k<h.length;k++){f+=h[k];if(k!=(h.length-1)){f+=":"}}c+='<tr><td class="ttipHeader2" colspan="1">'+h[0]+':</td><td class="ttipLabel" colspan="2">'+Ext.util.Format.htmlEncode(f)+"</td></tr>"}}})}c+="</table>"}return c}function onZoomIn(){var b=$find("diagram");var d=1.5;var a=b.getViewport();var e=a.center();if(!b.getVirtualScroll()){b.setZoomFactorPivot(b.zoomFactor*d,e)}else{a.x=e.x-(e.x-a.x)/d;a.y=e.y-(e.y-a.y)/d;a.width/=d;a.height/=d;b.zoomToRect(a)}}function genLabelPrefix(a){var b="";switch(a){case"Incident":b=labels.Incident;break;case"Task":b=labels.Task;break;case"Change_Request":b=labels.Change;break;case"Problem":b=labels.Problem;break;case"Release":b=labels.Release;break}return b}var originalWrapLine=MindFusion.Drawing.Text.wrapLine;MindFusion.Drawing.Text.wrapLine=function(b,l,h,m){originalWrapLine.apply(this,[b,l,h,m]);for(var e=0;e<m.length;e++){var n=m[e];var g=b.measureText(n).width;if(g>h){var f=1;var a="";do{a=n.substring(0,f);g=b.measureText(a).width;f++}while(g<h);var d=n.substring(f-1);m[e]=a;if(d!=""){m.splice(e+1,0,d)}}}};var HandleUtils=MindFusion.Diagramming.HandleUtils;var originalDrawHandles=HandleUtils.drawSquareHandles;HandleUtils.drawSquareHandles=function(a,b){if(a.setLineDash){a.setLineDash([])}originalDrawHandles.apply(null,[a,b])};function GetMessageBox(a){if(WinMsg==null){WinMsg=Ext.create("Ext.window.MessageBox")}WinMsg.baseCls=a;return WinMsg};