function clearHTML(a){while(a.hasChildNodes()){a.removeChild(a.lastChild)}return a}function getTextContent(a){if(Ext.isIE||Ext.isChrome){return a.innerText}else{if(Ext.isGecko){return getMozillaTextContent(a,false)}else{return a.textContent}}}function getMozillaTextContent(c,d){var a=new Array();if(c){if(c.nodeValue){var e=c.nodeValue;if(e.replace(/\s/g,"")!=""){a.push(e)}}else{if(c.nodeName=="BR"){a.push("\r\n")}}}for(var b=0;b<c.childNodes.length;b++){a=a.concat(getMozillaTextContent(c.childNodes[b],false))}if(d){return a}else{return a.join("")}}function parseHTML(a,b){if(b==undefined||b==null){return}try{var h=new DOMParser();var c=h.parseFromString(b,"text/html");if(c.parseError){throw Error("Error in parsed HTML")}var f=c.body.childNodes;if(f.length>0){RemedyForceHTMLProcessor.clearHTML(a);for(var d=0;d<f.length;d++){a.appendChild(recursiveElements(f[d],a))}}}catch(g){a.innerHTML=b}}function OpenHelpUrl(a){if(typeof(wikiUrl)!="undefined"&&wikiUrl!=null&&wikiUrl!=""&&isNewContextpage()){window.open(wikiUrl)}else{if(objectName.toLowerCase()==INCIDENT.toLowerCase()){OpenHelppage("EmailConversation","module","form")}else{if(objectName.toLowerCase()==TASK.toLowerCase()){OpenHelppage("EmailConversationTask","module","form")}else{if(objectName.toLowerCase()==PROBLEM.toLowerCase()){OpenHelppage("EmailConversationProblem","module","form")}else{if(objectName.toLowerCase()==CHANGE_REQUEST.toLowerCase()){OpenHelppage("EmailConversationChange","module","form")}}}}}}function getUrlParameter(d){d=d.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+d+"=([^&#]*)";var b=new RegExp(c);var a=b.exec(window.location.href);if(a==null){return""}else{return a[1]}}function getStaffLinkCookie(){var a=Ext.util.Cookies.get(cookieName+"staffLink");if(a==""||a==null){return true}return a}function getClientLinkCookie(){var a=Ext.util.Cookies.get(cookieName+"clientLink");if(a==""||a==null){return true}return a}function getTextFormatCookie(){var b=Ext.util.Cookies.get("TextFormatEmailCovo");if(!b){var a=new Date();a.setYear(a.getFullYear()+10);document.cookie="TextFormatEmailCovo=true;expires="+a.toUTCString()+";path=/;SameSite=None;Secure";return true}return JSON.parse(b)}var errormsg;var attachment_Ids;var save_attachments_flag;var attachmentParentId;var copyInciFlds=false;var NONE="none";var INCIDENT="Incident__c";var CHANGE_REQUEST="Change_Request__c";var TASK="Task__c";var PROBLEM="Problem__c";var emailTemplSelected=false;var body="";var isResetEnabled=false;var bStaffLink=getStaffLinkCookie();var bClientLink=getClientLinkCookie();var bActionClicked=false;var selListVal;var attachmentPopupInstance=undefined;var bClientURLExist=(sClientURL.trim().length>0)?true:false;var oldAttattachFileId="";var StaffLinkClickHandler=function(c,b){if(bActionClicked==true){bStaffLink=c.checked;var a=new Date();a.setYear(a.getFullYear()+10);document.cookie=cookieName+"staffLink="+bStaffLink+";expires="+a.toUTCString()+";path=/;SameSite=None;Secure";if(bStaffLink==true){InsertLink(false)}}};var ClientLinkClickHandler=function(c,b){if(bActionClicked==true){bClientLink=c.checked;var a=new Date();a.setYear(a.getFullYear()+10);document.cookie=cookieName+"clientLink="+bClientLink+";expires="+a.toUTCString()+";path=/;SameSite=None;Secure";if(bClientLink==true){InsertLink(false)}}};function enableDisableActionbutton(){if(objectName.toLowerCase()==INCIDENT.toLowerCase()||objectName.toLowerCase()==CHANGE_REQUEST.toLowerCase()||objectName.toLowerCase()==TASK.toLowerCase()||objectName.toLowerCase()==PROBLEM.toLowerCase()){if(isNew=="true"){Ext.getCmp("btnActions").setDisabled(false)}else{Ext.getCmp("btnActions").setDisabled(true)}}else{Ext.getCmp("btnActions").setDisabled(true)}}function buttonValidator(){var f=document.getElementById(bodyId);var c=document.getElementById(ccId);var b=document.getElementById(bccId);var e=document.getElementById(chkBxId);var d=document.getElementById(subjId);var a=document.getElementById(emailTmplId);if(isSendEnabled=="true"&&hasEditAccess){Ext.getCmp("replyId").setDisabled(true);Ext.getCmp("replyId").setIconClass("bmcReplyEmailDisable");Ext.getCmp("replyAllId").setDisabled(true);Ext.getCmp("replyAllId").setIconClass("bmcReplyAllEmailDisable");Ext.getCmp("resetId").setDisabled(false);Ext.getCmp("resetId").setIconClass("bmcReset");Ext.getCmp("attachId").setDisabled(false);Ext.getCmp("attachId").setIconClass("bmcAttachFile");Ext.getCmp("sendmailId").setDisabled(false);Ext.getCmp("sendmailId").setIconClass("bmcSendEmail");if(objectName.toLowerCase()==INCIDENT.toLowerCase()||objectName.toLowerCase()==CHANGE_REQUEST.toLowerCase()||objectName.toLowerCase()==TASK.toLowerCase()||objectName.toLowerCase()==PROBLEM.toLowerCase()){Ext.getCmp("btnActions").setDisabled(false)}else{Ext.getCmp("btnActions").setDisabled(true)}document.getElementById("ccLookupBtn").disabled=false;if(f!=null&&typeof(f)!="undefined"){f.className="clsMailInputTextArea";f.readOnly=false;f.onfocus=function(){}}disableRichText(false);if(c!=null&&typeof(c)!="undefined"){c.className="clsInputTextArea";c.readOnly=false;c.onfocus=function(){}}if(b!=null&&typeof(b)!="undefined"){document.getElementById("bccLookupBtn").disabled=false;b.className="clsInputTextArea";b.readOnly=false;b.onfocus=function(){}}if(isNew=="false"){var d=document.getElementById(subjId);if(d!=null&&typeof(d)!="undefined"){d.className="clsIdInputTextBox";d.readOnly=false;d.onfocus=function(){}}}}else{Ext.getCmp("sendmailId").setDisabled(true);Ext.getCmp("sendmailId").setIconClass("bmcSendEmailDisable");Ext.getCmp("replyId").setDisabled(false);Ext.getCmp("replyId").setIconClass("bmcReplyEmail");Ext.getCmp("replyAllId").setDisabled(false);Ext.getCmp("replyAllId").setIconClass("bmcReplyAllEmail");Ext.getCmp("resetId").setDisabled(true);Ext.getCmp("resetId").setIconClass("bmcResetDisable");Ext.getCmp("attachId").setDisabled(true);Ext.getCmp("attachId").setIconClass("bmcAttachFileDisabled");Ext.getCmp("btnActions").setDisabled(true);document.getElementById("ccLookupBtn").disabled=true;if(f!=null&&typeof(f)!="undefined"){f.className="clsMailInputTextAreaDisabled";f.readOnly=true}disableRichText(true);if(c!=null&&typeof(c)!="undefined"){c.className="clsInputTextAreaReadOnlyBrownBackground";c.readOnly=true}if(b!=null&&typeof(b)!="undefined"){b.className="clsInputTextAreaReadOnlyBrownBackground";b.readOnly=true;document.getElementById("bccLookupBtn").disabled=true}if(e!=null&&typeof(e)!="undefined"){e.disabled=true}var a=document.getElementById(emailTmplId);if(a!=null&&typeof(a)!="undefined"){a.className="clsDisabledComboBox";a.disabled=true}if(!hasEditAccess){Ext.getCmp("replyId").setDisabled(true);Ext.getCmp("replyId").setIconClass("bmcReplyEmailDisable");Ext.getCmp("replyAllId").setDisabled(true);Ext.getCmp("replyAllId").setIconClass("bmcReplyAllEmailDisable");Ext.getCmp("textFormatBtn").setDisabled(true);if(d!=null&&typeof(d)!="undefined"){d.readOnly=true;d.className="clsInputTextDisabled"}disableFromField()}}enableDisableToField();enableDiableEmailTemplate()}function callToOpenPopup(){if(clientSearchPageFlag=="true"){attachmentPopupInstance=openPopupWithTitle("ClientSearchPage?str=",setUserToEmail,labelSelectClients,Ext.isIE7?480:477,Ext.isIE7?665:675)}else{attachmentPopupInstance=openPopUpToSelectUser("TO")}}function callCCOpenPopup(){if(clientSearchPageFlag=="true"){attachmentPopupInstance=openPopupWithTitle("ClientSearchPage?str=",setUserEmail,labelSelectClients,Ext.isIE7?480:477,Ext.isIE7?665:675)}else{attachmentPopupInstance=openPopUpToSelectUser("CC")}}function callBCCOpenPopup(){if(clientSearchPageFlag=="true"){attachmentPopupInstance=openPopupWithTitle("ClientSearchPage?str=",setBccUserEmail,labelSelectClients,Ext.isIE7?480:477,Ext.isIE7?665:675)}else{attachmentPopupInstance=openPopUpToSelectUser("BCC")}}function openPopUpToSelectUser(b){var c=parseInt((screen.availWidth/2)-(670/2));var a=parseInt((screen.availHeight/2)-(480/2));var d=window.open("/apex/"+nameSpacePrefix+"SearchAndLink?txt=customLookup&parentName=Incident__c&childName=User&isCreateNewClientAllowed=false&isNewIncident=false&filterId=active_standard&fromEmailPage=true&addressType="+b,"UserListPopUp","status = 1,height =480, width = 671,left= "+c+",top="+a+", resizable = yes,scrollbars=no");return d}function setValueAsEmailAddress(b,c){var a;if(c=="TO"){a=document.getElementById(toAddrId)}else{if(c=="CC"){a=document.getElementById(ccId)}else{if(c=="BCC"){a=document.getElementById(bccId)}}}if(a&&b){a.value+=" "+b+";"}}function enableDisableSendAttach(a){Ext.getCmp("sendmailId").setDisabled(a);Ext.getCmp("sendmailId").setIconClass(a==true?"bmcSendEmailDisable":"bmcSendEmail");Ext.getCmp("attachId").setDisabled(a);Ext.getCmp("attachId").setIconClass(a==true?"bmcAttachFileDisabled":"bmcAttachFile")}function SetMailBodyText(){var c=getRichComponent();if(c){c=clearHTML(c);if(prevContentHolder!=null){c.appendChild(prevContentHolder.cloneNode(true))}var b=document.getElementById(bodyId);b.value=getTextContent(c)}InsertLink(false);showAttachmentCompo(false);var a=document.getElementById(rmvChkBxId);if(a!=null&&typeof(a)!="undefined"){a.checked=false}}var isEmailTemplateChangedEvent=false;var tempEmailBody="";function enableDisbaleEmailBody(e){var g=document.getElementById(bodyId);var a=document.getElementById(ccId);var d=document.getElementById(chkBxId);var b=document.getElementById(subjId);isEmailTemplateChangedEvent=true;selListVal=e;if(e==NONE){emailTemplSelected=false;emailTemplId=emailTemplateId="";Ext.getCmp("attachId").setDisabled(false);Ext.getCmp("attachId").setIconClass("bmcAttachFile");if(oldAttattachFileId!=""){document.getElementById(attachFileId).value=oldAttattachFileId}if(objectName.toLowerCase()==CHANGE_REQUEST.toLowerCase()||objectName.toLowerCase()==TASK.toLowerCase()||objectName.toLowerCase()==PROBLEM.toLowerCase()){Ext.getCmp("btnActions").setDisabled(false)}if(!isRBEnabled){if(g!=null&&typeof(g)!="undefined"){g.className="clsMailInputTextArea";g.readOnly=false;g.title=LabelEmailBodyLabel;if(tempEmailBody){g.value=tempEmailBody}InsertLink(false)}}else{switchToRichText();var f=getRichComponent();if(tempEmailBody){f=clearHTML(f);f.appendChild(retainBreakLine(tempEmailBody,false));InsertLink(false)}}if(isResetEnabled==true){Ext.getCmp("resetId").setDisabled(false);Ext.getCmp("resetId").setIconClass("bmcReset")}isResetEnabled=false;if(b!=null&&typeof(b)!="undefined"){b.readOnly=false;b.className="clsInputTextEnabled";if(b.value==""){if(isNew=="true"){b.value=labelSubject}else{b.value="Re: "+labelSubject+" "+labelRefUID}}}if(d!=null&&typeof(d)!="undefined"){d.disabled=false}var c=document.getElementById("lnPreviewEmailtemplate");c.classList.remove("clsNormalBlueFont");c.classList.add("disabled")}else{emailTemplSelected=true;if(isRBEnabled){var f=getRichComponent();switchToPlainText()}emailTemplId=emailTemplateId=e;if(Ext.getCmp("resetId").disabled==false){isResetEnabled=true;Ext.getCmp("resetId").setDisabled(true);Ext.getCmp("resetId").setIconClass("bmcResetDisable")}if(objectName.toLowerCase()==CHANGE_REQUEST.toLowerCase()||objectName.toLowerCase()==TASK.toLowerCase()||objectName.toLowerCase()==PROBLEM.toLowerCase()){Ext.getCmp("btnActions").setDisabled(true)}if(EnableEmailBody!=null&&!EnableEmailBody){if(g!=null&&typeof(g)!="undefined"){g.className="clsMailInputTextAreaDisabled";g.readOnly=true;g.value=""}if(d!=null&&typeof(d)!="undefined"){d.disabled=true}}else{if(g!=null&&typeof(g)!="undefined"){g.readOnly=false;if(!isRBEnabled){tempEmailBody=g.value}g.value="";g.placeholder=LabelAddInfoEmptyText;g.title=LabelEmailAddInfoTooltip}if(d!=null&&typeof(d)!="undefined"){d.disabled=false}}if(b!=null&&typeof(b)!="undefined"){b.readOnly=true;b.className="clsInputTextDisabled"}if(propEnableEmailTemplatePreview=="true"){var c=document.getElementById("lnPreviewEmailtemplate");c.classList.remove("disabled");c.classList.add("clsNormalBlueFont")}}enableDiableEmailTemplate();isEmailTemplateChangedEvent=false}var previewpopup="Preview";function ShowEmailTemplatePreview(){var d=(screen.width/2)-(400);var c=(screen.height/2)-(250);var a;if(window.showModalDiaslog){var b="dialogWidth:"+800+"px;dialogHeight:"+500+"px;status;resizable;scrollbars:yes;center:yes;dialogLeft:"+d+"px;;dialogTop:"+c+"px;";previewpopup=window.showModalDialog("/"+emailTemplId+"?related_to_id="+getUrlParameter("recordId")+"&isdtp=vw#ep",this,b)}else{a=window.open("/"+emailTemplId+"?related_to_id="+getUrlParameter("recordId")+"&isdtp=vw#ep",previewpopup,"scrollbars=yes,toolbar=0,status=0,width=800,height=500, top="+c+", left="+d);if(a.focus){a.focus()}}}function getCheckBoxVal(a){copyInciFlds=a.checked}function setLabelsToolTips(){var a="";var d=document.getElementById(copyFieldLblId);var b=document.getElementById(bodyId);var c=document.getElementById(chkBxId);var e=getRichComponent();if(objectName.toLowerCase()==INCIDENT.toLowerCase()){a=labelInciCopyField;if(c!=null&&typeof(c)!="undefined"){c.title=labelInciCopyFldsToolTip}if(b!=null&&typeof(b)!="undefined"){b.title=labelInciBodyToolTip}if(e!=null&&typeof(e)!="undefined"){e.title=labelInciBodyToolTip}}else{if(objectName.toLowerCase()==CHANGE_REQUEST.toLowerCase()){a=labelChngCopyFlds;if(c!=null&&typeof(c)!="undefined"){c.title=labelChngCopyFldsToolTip}if(b!=null&&typeof(b)!="undefined"){b.title=labelChngBodyToolTip}if(e!=null&&typeof(e)!="undefined"){e.title=labelChngBodyToolTip}}else{if(objectName.toLowerCase()==TASK.toLowerCase()){a=labelTaskCopyFlds;if(c!=null&&typeof(c)!="undefined"){c.title=labelTaskCopyFldsToolTip}if(b!=null&&typeof(b)!="undefined"){b.title=labelTaskBodyToolTip}if(e!=null&&typeof(e)!="undefined"){e.title=labelTaskBodyToolTip}}else{if(objectName.toLowerCase()==PROBLEM.toLowerCase()){a=labelProblemCopyFlds;if(c!=null&&typeof(c)!="undefined"){c.title=labelProblemCopyFldsToolTip}if(b!=null&&typeof(b)!="undefined"){b.title=labelProblemBodyToolTip}if(e!=null&&typeof(e)!="undefined"){e.title=labelProblemBodyToolTip}}}}}if(d!=null&&typeof(d)!="undefined"&&RemedyForceHTMLProcessor.getText(d).trim()==""){d.appendChild(document.createTextNode(a))}}function getEmailIdCount(d){var a=0;var b=d.split(";");if(b.length>0){var c=0;for(;c<b.length;c++){if(b[c]!=null&&b[c].trim().length>0){if(propEnableEmailConvTempl=="true"&&emailTemplId!=""&&emailTemplId!=NONE&&!validateEmailEmailPage(b[c].trim())){Ext.Msg.show({msg:labelInvalidEmail+" "+htmlEntities(b[c].trim()),buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});return -1}a++}}}return a}function htmlEntities(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function validateEmailEmailPage(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function ValidateEmailIdsLimit(){var f=false;var b=false;var h=100;var d=25;var g=25;var a=document.getElementById(toAddrId);if(a!=null&&typeof(a)!="undefined"){if(a.value!=null&&a.value!="undefined"){if(a.value.trim().length<=0){f=true}else{var j=getEmailIdCount(a.value);if(j<0){return false}else{if(j==0){f=true}else{if(j>h){Ext.Msg.show({msg:labelMaxToAddr,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});return false}}}}}}var e=document.getElementById(ccId);if(e!=null&&typeof(e)!="undefined"){if(e.value!=null&&e.value!="undefined"){if(e.value.trim().length<=0){b=true}else{var j=getEmailIdCount(e.value);if(j==-1){return false}else{if(j==0){b=true}else{if(j>d){Ext.Msg.show({msg:labelMaxCCAddr,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});return false}}}}}}var c=document.getElementById(bccId);if(c!=null&&typeof(c)!="undefined"&&c.value!=null&&c.value!="undefined"&&c.value.trim().length>0){var j=getEmailIdCount(c.value);if(j==-1){return false}else{if(j>g){Ext.Msg.show({msg:labelMaxBCCAddr,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});return false}}}if(f&&b){Ext.Msg.show({msg:labelNoEmailAddr,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});return false}return true}function getEmailBodyComponent(){if(isRBEnabled&&!emailTemplSelected){return richBodyComponent}else{return document.getElementById(bodyId)}}var doc;var win;var richBodyComponent;var isRBEnabled=false;var prevContentHolder="";var isOnload=false;var richTextHandler=function(a,b){if(isOnload||!isRBEnabled){switchToRichText()}};var plainTextHandler=function(a,b){if(isOnload||isRBEnabled){if(isOnload){switchToPlainText();isOnload=false}else{Ext.Msg.show({msg:textFormatWarningMsg,buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.WARNING,fn:function(c){if(c=="yes"){switchToPlainText()}}})}}};var waitMask;Ext.onReady(function(){Ext.QuickTips.init();selListVal=NONE;waitMask=new Ext.LoadMask(Ext.getBody(),{msg:waitMsg});if(isNew=="true"){var l=getTextFormatCookie();if(l){isRBEnabled=true}else{isRBEnabled=false}}else{isRBEnabled=true}var p=function(v,w){if(!ValidateEmailIdsLimit()){return}var x=document.getElementById(subjId);if(x!=null&&typeof(x)!="undefined"){if(propEnableEmailConvTempl=="true"&&emailTemplId!=""&&emailTemplId!=NONE){sendMailTemplate(Ext.isIE,emailTemplateId,save_attachments_flag,attachmentParentId)}else{var u=document.getElementById(bodyId);var y=getRichComponent();if(!isRBEnabled){if(u!=null&&typeof(u)!="undefined"){var t=u.value;var s=t.length;if(s>120000){u.value=t.substring(0,120000)}if(y){y=clearHTML(y);y.appendChild(retainBreakLine(Ext.util.Format.htmlEncode(u.value),false))}}}else{if(y!=null&&typeof(y)!="undefined"){if(getTextContent(y).length>120000){if(Ext.isIE){y.innerText=getTextContent(y).substring(0,120000)}else{y.textContent=getTextContent(y).substring(0,120000)}}u.value=retainBreakLine(getTextContent(y),true)}}sendMail(Ext.isIE,save_attachments_flag,isRBEnabled,attachmentParentId)}}enableDisableSendAttach(true);if(Ext.getCmp("resetId").disabled==false){isResetEnabled=true;Ext.getCmp("resetId").setDisabled(true);Ext.getCmp("resetId").setIconClass("bmcResetDisable")}};var b=function(s,t){Ext.getCmp("resetId").setDisabled(true);Ext.getCmp("resetId").setIconClass("bmcResetDisable");enableDisableSendAttach(true);reset()};var g=function(s,t){bActionClicked=true};var r=function(s,t){OpenHelpUrl()};var n=function(s,t){var u=464;var v=460;if(Ext.isIE7){u=485}else{if(Ext.isIE){u=468}}if(attachment_Ids!=null&&attachment_Ids!=""){attachmentPopupInstance=openPopupWithTitle(multiDocumentAttachmentPageURL+"&objectName="+objectName+"&recordId="+recordId+"&isNew=true&consolidatedAttachments="+attachment_Ids+"&save_attachments_flag="+save_attachments_flag+"&standardLayout="+standardLayout+"&isConsolePage="+isConsolePage+"&attachmentParentId="+attachmentParentId,attachFilesOnCompleteIn,labelAddAttachment,u,v,false)}else{attachmentPopupInstance=openPopupWithTitle(multiDocumentAttachmentPageURL+"&objectName="+objectName+"&recordId="+recordId+"&isNew=true&standardLayout="+standardLayout+"&isConsolePage="+isConsolePage,attachFilesOnCompleteIn,labelAddAttachment,u,v,false)}};var e=function(t,v){var u=getUrlParameter("objectName");var s=getUrlParameter("recordId");if(isConsolePage=="true"){if(u.indexOf("Incident")>-1){window.parent.loadIncidentRelatedList(s)}else{if(u.indexOf("Task")>-1){window.parent.loadTaskRelatedList(s)}else{if(u.indexOf("Problem")>-1){window.parent.loadProblemRelatedList(s)}else{if(u.indexOf("Change")>-1){window.parent.loadChangeRelatedList(s)}}}}return}if(getUrlParameter("isCalledFromConsole")=="true"){if(u.indexOf("Incident")>-1){window.location.href="/apex/consoleIncidentRelatedList?id="+s}if(u.indexOf("Task")>-1){window.location.href="/apex/consoleTaskRelatedList?id="+s}if(u.indexOf("Change_Request")>-1){window.location.href="/apex/ConsoleChangeRelatedlist?id="+s}if(u.indexOf("Problem")>-1){window.location.href="/apex/ConsoleProblemRelatedlist?id="+s}}else{window.location.href="/"+s}};var o=new Ext.Toolbar({title:"",cls:"toolSpCls",renderTo:"btnToolbar",bodyStyle:"border:0px;padding:0px;margin:0px;zoom:0px;",items:[" ",{scale:"medium",id:"sendmailId",tooltipType:"title",tooltip:labelSend,iconCls:"bmcSendEmail",handler:p}," ",{scale:"medium",id:"replyId",tooltipType:"title",tooltip:labelReply,iconCls:"bmcReplyEmail",handler:replyBtnHandler}," ",{scale:"medium",id:"replyAllId",tooltipType:"title",tooltip:labelReplyAll,iconCls:"bmcReplyAllEmail",handler:replyAllBtnHandler}," ",{scale:"medium",id:"attachId",iconCls:"bmcAttachFile",tooltipType:"title",tooltip:labelAttachFile,handler:n}," ",{scale:"medium",id:"resetId",iconCls:"bmcReset",tooltipType:"title",tooltip:labelReset,handler:b}," ",{scale:"medium",id:"btnActions",iconCls:"bmcAction1",tooltipType:"title",tooltip:labelActions,menu:new Ext.menu.Menu({autoWidth:true,showSeparator:false,plain:true,items:[{xtype:"checkbox",id:"StaffLink",text:labelStaffLink,boxLabel:labelStaffLink,checked:(bStaffLink=="true"||bStaffLink==true)?true:false,autoWidth:true,handler:StaffLinkClickHandler},{xtype:"checkbox",id:"ClientLink",text:labelClientLink,boxLabel:labelClientLink,checked:(bClientLink=="true"||bClientLink==true)?true:false,autoWidth:true,hidden:(bClientURLExist=="true"||bClientURLExist==true)?false:true,handler:ClientLinkClickHandler}]}),handler:g,listeners:{disable:function(){this.setIconClass("bmcAction")},enable:function(){this.setIconClass("bmcAction1")}}}," ",{scale:"medium",id:"textFormatBtn",tooltipType:"title",tooltip:richTextLabel,menu:new Ext.menu.Menu({autoWidth:true,showSeparator:false,plain:true,items:[{id:"plainText",text:plainTextLabel,handler:plainTextHandler},{id:"richText",text:richTextLabel,handler:richTextHandler}]})},"->",{scale:"medium",id:"helpId",iconCls:"bmcSendEmailHelp",tooltipType:"title",tooltip:labelTooltipHelp,handler:r}," ",{scale:"medium",id:"ClosemailId",iconCls:"bmcEmailClose",hidden:(getUrlParameter("isNew")=="false")?false:true,tooltipType:"title",tooltip:labelTooltipClose,handler:e}]});if(standardLayout=="true"||isConsolePage=="true"){Ext.get("helpId").show()}else{Ext.get("helpId").hide()}enableDisableActionbutton();if(isNew=="true"){Ext.getCmp("replyId").setDisabled(true);Ext.getCmp("replyAllId").setDisabled(true);Ext.getCmp("replyId").setIconClass("bmcReplyEmailDisable");Ext.getCmp("replyAllId").setIconClass("bmcReplyAllEmailDisable");Ext.getCmp("resetId").setDisabled(true);Ext.getCmp("resetId").setIconClass("bmcResetDisable");var a=document.getElementById(attachFileId);if(a!=null&&typeof(a)!="undefined"){if(a.value.trim()==""){showAttachmentCompo(false)}}enableDisableToField();enableDiableEmailTemplate()}else{Ext.getCmp("sendmailId").setDisabled(true);Ext.getCmp("sendmailId").setIconClass("bmcSendEmailDisable");Ext.getCmp("resetId").setDisabled(true);Ext.getCmp("resetId").setIconClass("bmcResetDisable");Ext.getCmp("attachId").setDisabled(true);Ext.getCmp("attachId").setIconClass("bmcAttachFileDisabled");Ext.getCmp("textFormatBtn").setDisabled(true);var d=document.getElementById(subjId);if(d!=null&&typeof(d)!="undefined"){d.className="clsIdInputTextBoxReadOnly";d.onfocus=function(){this.blur()};d.readOnly=true}var q=document.getElementById(bodyId);if(q!=null&&typeof(q)!="undefined"){q.className="clsMailInputTextAreaDisabled";q.readOnly=true}var k=document.getElementById(ccId);if(k!=null&&typeof(k)!="undefined"){k.className="clsInputTextAreaReadOnlyBrownBackground";k.onfocus=function(){this.blur()};k.readOnly=true}document.getElementById("ccLookupBtn").disabled=true;var f=document.getElementById(bccId);if(f!=null&&typeof(f)!="undefined"){f.className="clsInputTextAreaReadOnlyBrownBackground";f.onfocus=function(){this.blur()};f.readOnly=true;document.getElementById("bccLookupBtn").disabled=true;if(f.value.trim()==""){showBCCCompo(false)}}var a=document.getElementById(attachFileId);if(a!=null&&typeof(a)!="undefined"){if(a.value.trim()==""){showAttachmentCompo(false)}}var j=document.getElementById(chkBxId);if(j!=null&&typeof(j)!="undefined"){j.disabled=true}var h=document.getElementById(emailTmplId);if(h!=null&&typeof(h)!="undefined"){h.className="clsDisabledComboBox";h.disabled=true}if(isSendEnabled=="true"){enableDisableToField()}else{var c=document.getElementById(toAddrId);if(c!=null&&typeof(c)!="undefined"){c.onfocus=function(){this.blur()};c.className="clsInputTextAreaReadOnlyBrownBackground";c.readOnly=true}document.getElementById("toLookupBtn").disabled=true}}var m=new Ext.data.ArrayStore({fields:[{name:"name"},{name:"label"}]});m.loadData(inciFields);this.contextMenu=new Ext.menu.Menu({items:[new Ext.grid.GridPanel({store:m,columns:[{id:"name",header:"Name",dataIndex:"name",hidden:true,hideable:false},{id:"label",header:getHeader(),sortable:false,width:200,dataIndex:"label"}],stripeRows:true,autoExpandColumn:"label",height:200,width:250,closable:true,enableCtxMenu:false,enableColLock:false,enableColumnMove:false,enableColumnResize:false,listeners:{rowclick:function(u,x,v){v.stopEvent();var s=u.getSelectionModel();var t=s.getSelected();fetchObjectFieldData(t.get("name"));if(EnableEmailBody){var w=document.getElementById(bodyId)}Ext.get("fieldMenu").hide()},rowcontextmenu:function(t,s,u){u.stopEvent()},headercontextmenu:function(s,t,u){u.stopEvent()}}})],id:"fieldMenu",width:255});AttachContextMenu();delayFuncForRichText();if(!hasEditAccess){Ext.Msg.show({msg:labelStdInsufficentOperationPrivilege,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});buttonValidator()}});var delayCounter=0;function switchToPlainText(){var a=document.getElementById(bodyId);var b=document.getElementById("RichBodyDiv");var d=getRichComponent();if(isEmailTemplateChangedEvent||!emailTemplSelected){a.style.display="block";a.placeholder="";b.style.display="none";b.style.visibility="hidden"}if(isEmailTemplateChangedEvent){return}if(!emailTemplSelected){if(!isOnload){if(d){a.value=retainBreakLine(getTextContent(d),true)}}else{isOnload=false}}else{tempEmailBody=retainBreakLine(getTextContent(d),true)}isRBEnabled=false;Ext.getCmp("richText").setIconClass("");Ext.getCmp("plainText").setIconClass("sprite sprite-menu_item_selection_dot");Ext.getCmp("textFormatBtn").setText(plainTextLabel);enableDiableEmailTemplate();enableDisableRmvCheckbox();var c=new Date();c.setYear(c.getFullYear()+10);document.cookie="TextFormatEmailCovo=false;expires="+c.toUTCString()+";path=/;SameSite=None;Secure"}function switchToRichText(){var b=document.getElementById(bodyId);var a=document.getElementById("RichBodyDiv");var e=getRichComponent();if(isEmailTemplateChangedEvent||!emailTemplSelected){b.style.display="none";a.style.display="block";a.style.visibility="visible"}if(isEmailTemplateChangedEvent){return}if(!isOnload){isRBEnabled=true;var c=b.value;if(emailTemplSelected){c=tempEmailBody}if(e){e=clearHTML(e);e.appendChild(retainBreakLine(Ext.util.Format.htmlEncode(c),false));tempEmailBody=""}if(!emailTemplSelected){InsertLink(false)}enableDisableRmvCheckbox();var d=new Date();d.setYear(d.getFullYear()+10);document.cookie="TextFormatEmailCovo=true;expires="+d.toUTCString()+";path=/;SameSite=None;Secure"}else{isOnload=false}Ext.getCmp("plainText").setIconClass("");Ext.getCmp("richText").setIconClass("sprite sprite-menu_item_selection_dot");Ext.getCmp("textFormatBtn").setText(richTextLabel)}function showBCCCompo(a){var c=document.getElementById("bccTR");var b=document.getElementById("bccTRFiller");if(c!=null&&typeof(c)!="undefined"&&b!=null&&typeof(b)!="undefined"){if(a){c.style.display="";b.style.display=""}else{c.style.display="none";b.style.display="none"}}}function showAttachmentCompo(b){var c=document.getElementById("attTR");var a=document.getElementById("attTRFiller");if(c!=null&&typeof(c)!="undefined"&&a!=null&&typeof(a)!="undefined"){if(b){c.style.display="";a.style.display=""}else{c.style.display="none";a.style.display="none"}}}function retainBreakLine(b,a){if(a){return b}else{var c=document.createElement("div");b=b.replace(/\r?\n|\r/g,"<br>");parseHTML(c,b);return c}}function delayFuncForRichText(){var c=document.getElementsByTagName("iframe");for(i=0;i<c.length;i++){var a=c[i];if(a!=null&&typeof(a)!="undefined"){if(checkIsIEEleBrowser()){doc=a.contentDocument;win=a.contentWindow}else{if(Ext.isIE){doc=a.contentWindow.document;win=a.contentWindow}else{doc=a.contentDocument;win=a.contentWindow}}if(doc!=null&&typeof(doc)!="undefined"&&win!=null&&typeof(win)!="undefined"){richBodyComponent=doc.getElementById(richBodyId+":textAreaDelegate_RichTextNote__c_rta_body");if(richBodyComponent==null||typeof(richBodyComponent)=="undefined"){richBodyComponent=doc.getElementById(richBodyId+":textAreaDelegate_"+nameSpacePrefix+"RichTextNote__c_rta_body")}}if(richBodyComponent!=null&&typeof(richBodyComponent)!="undefined"){break}}}if(richBodyComponent==null||typeof(richBodyComponent)=="undefined"){delayCounter++;if(delayCounter>50){Ext.Msg.show({msg:accessibilityModeMsg,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING,fn:function(e){if(e=="ok"){switchToPlainText()}}});Ext.getCmp("textFormatBtn").setText(plainTextLabel);Ext.getCmp("richText").disable();setLabelsToolTips();InsertLink(true);return}setTimeout(delayFuncForRichText,200)}else{if(isNew=="false"){if(IsPlainText=="true"){var d=getRichComponent();if(d){d=clearHTML(d);d.appendChild(retainBreakLine(document.getElementById(bodyId).value,false))}}disableRichText(true)}else{InsertLink(true)}if(!hasEditAccess){disableRichText(true)}setLabelsToolTips();var b=new Ext.data.ArrayStore({fields:[{name:"name"},{name:"label"}]});b.loadData(inciFields);win.contextMenu=new Ext.menu.Menu({items:[new Ext.grid.GridPanel({store:b,columns:[{id:"name",header:"Name",dataIndex:"name",hidden:true,hideable:false},{id:"label",header:getHeader(),sortable:false,width:200,dataIndex:"label"}],stripeRows:true,autoExpandColumn:"label",height:200,width:250,closable:true,enableCtxMenu:false,enableColLock:false,enableColumnMove:false,enableColumnResize:false,listeners:{rowclick:function(h,l,j){j.stopEvent();var f=h.getSelectionModel();var g=f.getSelected();fetchObjectFieldData(g.get("name"));if(EnableEmailBody){if(doc!=null&&typeof(doc)!="undefined"&&win!=null&&typeof(win)!="undefined"){var k=doc.getElementById(richBodyId+":textAreaDelegate_RichTextNote__c_rta_body")}}Ext.get("fieldMenuRTF").hide()},rowcontextmenu:function(g,f,h){h.stopEvent()},headercontextmenu:function(f,g,h){h.stopEvent()}}})],id:"fieldMenuRTF",width:255});AttachContextMenuRich();if(isRBEnabled){isOnload=true;richTextHandler()}else{isOnload=true;plainTextHandler()}}}function disableRichText(a){var c=getRichComponent();if(a){if(c){c.setAttribute("contentEditable",false);c.setAttribute("background-color","#D4D0C8")}var b=document.getElementById("cke_1_top");if(b!=null&&b!="undefined"){b.style.display="none"}}else{if(c){c.setAttribute("contentEditable",true);c.setAttribute("background-color","#D4D0C8")}var b=document.getElementById("cke_1_top");if(b!=null&&b!="undefined"){b.style.display="block"}}}function getHeader(){var a="";if(objectName.toLowerCase()==INCIDENT.toLowerCase()){a=labelContextMenuIncident}else{if(objectName.toLowerCase()==CHANGE_REQUEST.toLowerCase()){a=labelContextMenuChange}else{if(objectName.toLowerCase()==TASK.toLowerCase()){a=labelContextMenuTask}else{if(objectName.toLowerCase()==PROBLEM.toLowerCase()){a=labelContextMenuProblem}}}}return a}function AttachContextMenu(){var a=Ext.get(bodyId);if(typeof(a)!="undefined"&&a!=null){a.on("contextmenu",function(f){if(copyInciFlds==true){var g=Ext.get(bodyId);var c=g.getHeight();var b=g.getWidth();var d=f.getXY();if(d[1]>c){d[1]=d[1]-205}if((d[0]+255)>b){d[0]=d[0]-255}this.contextMenu.showAt(d);f.stopEvent()}},this)}}function AttachContextMenuRich(){var b=getRichComponent();var a=Ext.get(b);if(typeof(a)!="undefined"&&a!=null){a.on("contextmenu",function(g){if(copyInciFlds==true){var h=Ext.get("RichBodyDiv");var d=h.getHeight()-42;var c=h.getWidth();var f=g.getXY();if((f[0]+275)>c){f[0]=f[0]-255}else{f[0]+=30}if((f[1]+225)>d){f[1]=d-80}else{f[1]+=250}win.contextMenu.showAt(f);g.stopEvent()}},win)}}function InsertDataAtCursor(e,a){e=e==undefined?"":e;if(e){if(a=="DATETIME"){e=new Date(e);e=Ext.util.Format.date(e,dateTimeFormatStr)}else{if(a=="DATE"){e=new Date(e);e=Ext.util.Format.date(e,dateFormatStr)}}}if(!isRBEnabled||emailTemplSelected){var g=document.getElementById(bodyId);if(g!=null&&typeof(g)!="undefined"&&g.value!=null&&typeof(g.value)!="undefined"){if(Ext.isIE){if(document.selection){g.focus();sel=document.selection.createRange();if(a=="RICHTEXT"){var f=getRichComponent();if(f){f=clearHTML(f);parseHTML(f,e);e=f.innerText||f.textContent}}sel.text=e}}else{if(a=="RICHTEXT"){var f=getRichComponent();if(f){f=clearHTML(f);parseHTML(f,e);e=f.innerText||f.textContent}}var d=g.selectionStart;var c=g.selectionEnd;if(d!=null&&typeof(d)!="undefined"&&c!=null&&typeof(c)!="undefined"){g.focus();g.value=g.value.substring(0,d)+e+g.value.substring(c,g.value.length);g.setSelectionRange(c+e.length,c+e.length)}}}}else{if(Ext.isIE){if(document.selection.createRange){var b=document.selection.createRange();if(b.offsetLeft!=0&&b.offsetTop>=10000){b.text=e}}}else{if(win.getSelection){sel=win.getSelection();if(sel.rangeCount){b=sel.getRangeAt(0);b.deleteContents();if(a=="RICHTEXT"){b.insertNode(b.createContextualFragment(e))}else{b.insertNode(doc.createTextNode(e))}}}}}}function enableDisableToField(){var a=document.getElementById(toAddrId);if(propEnableEmailConvToFld=="true"&&hasEditAccess){if(a!=null&&typeof(a)!="undefined"){a.onfocus=function(){};a.className="clsInputTextArea";a.readOnly=false}document.getElementById("toLookupBtn").disabled=false;document.getElementById("toLookupBtn").style.display=""}else{if(a!=null&&typeof(a)!="undefined"){a.onfocus=function(){this.blur()};a.className="clsInputTextAreaReadOnlyBrownBackground";a.readOnly=true}document.getElementById("toLookupBtn").disabled=true;document.getElementById("toLookupBtn").style.display="none"}}function enableDiableEmailTemplate(){var a=document.getElementById(emailTmplId);if(a!=null&&typeof(a)!="undefined"){if(!hasEditAccess){a.value=NONE;emailTemplSelected=false;emailTemplId=emailTemplateId="";a.disabled=true;a.className="clsDisabledComboBox"}else{if(propEnableEmailConvTempl=="true"){a.disabled=false;a.className="clsComboBox"}else{a.disabled=true;a.className="clsDisabledComboBox"}}}}function disableFromField(){var a=document.getElementById(fromAddrId);if(typeof a!="undefined"&&a){if(!hasEditAccess){a.className="clsDisabledComboBox";a.disabled=true}}}function attachFilesOnCompleteIn(a){if(a!=null&&a!=""&&a!="null"){attachment_Ids=a;fetchAttachmentListJS(a);showAttachmentCompo(true)}else{attachment_Ids="";document.getElementById(attachFileId).value="";showAttachmentCompo(false)}}function setFlagForSaveAttachments(a){save_attachments_flag=a}function setAttachmentReferanceGenerator(a){attachmentParentId=a}function afterSendEmail(){createCookie();enableDisableSendAttach(false);if(isResetEnabled==true){Ext.getCmp("resetId").setDisabled(false);Ext.getCmp("resetId").setIconClass("bmcReset")}isResetEnabled=false;if(errormsg=="Send Successfully"){var c=getUrlParameter("objectName");if(standardLayout=="true"){if(getUrlParameter("stdform")){Ext.getCmp("sendmailId").setDisabled(true);Ext.getCmp("sendmailId").setIconClass("bmcSendEmailDisable");Ext.getCmp("attachId").setDisabled(true);Ext.getCmp("attachId").setIconClass("bmcAttachFileDisabled");if(getUrlParameter("isCalledFromConsole")=="true"){if(c.indexOf("Incident")>-1){window.location.href="/apex/consoleIncidentRelatedList?id="+getUrlParameter("recordId")}if(c.indexOf("Task")>-1){window.location.href="/apex/consoleTaskRelatedList?id="+getUrlParameter("recordId")}if(c.indexOf("Change_Request")>-1){window.location.href="/apex/ConsoleChangeRelatedlist?id="+getUrlParameter("recordId")}if(c.indexOf("Problem")>-1){window.location.href="/apex/ConsoleProblemRelatedlist?id="+getUrlParameter("recordId")}}else{window.location.href="/"+recordId}}else{if(getUrlParameter("isCalledFromConsole")=="true"){if(c.indexOf("Incident")>-1){window.opener.location.href="/apex/consoleIncidentRelatedList?id="+getUrlParameter("recordId")+"&isdtp=vw"}if(c.indexOf("Task")>-1){window.opener.location.href="/apex/consoleTaskRelatedList?id="+getUrlParameter("recordId")+"&isdtp=vw"}if(c.indexOf("Change_Request")>-1){window.opener.location.href="/apex/ConsoleChangeRelatedlist?id="+getUrlParameter("recordId")+"&isdtp=vw"}if(c.indexOf("Problem")>-1){window.opener.location.href="/apex/ConsoleProblemRelatedlist?id="+getUrlParameter("recordId")+"&isdtp=vw"}}else{window.opener.location.href="/"+recordId}window.close()}}else{if(isConsolePage=="true"){var b=window.dialogArguments;if((b==undefined||b==null)&&(window.parent!==undefined&&window.parent.startWaitMsgBar!==undefined)){window.parent.startWaitMsgBar();if(c.indexOf("Incident")>-1){window.parent.loadIncidentRelatedList(recordId)}else{if(c.indexOf("Task")>-1){window.parent.loadTaskRelatedList(recordId)}else{if(c.indexOf("Problem")>-1){window.parent.loadProblemRelatedList(recordId)}else{if(c.indexOf("Change")>-1){window.parent.loadChangeRelatedList(recordId)}}}}}if(typeof(window.opener)!="undefined"&&window.opener!="undefined"&&window.opener!=null){if(window.opener.isFocusOnRelatedList){window.opener.startWaitMsgBar();if(c.indexOf("Incident")>-1){window.opener.loadIncidentRelatedList(recordId)}else{if(c.indexOf("Task")>-1){window.opener.loadTaskRelatedList(recordId)}else{if(c.indexOf("Problem")>-1){window.opener.loadProblemRelatedList(recordId)}else{if(c.indexOf("Change")>-1){window.opener.loadChangeRelatedList(recordId)}}}}}else{window.opener.isNeedToRefreshRelatedList=true}}else{if(b!=null&&(typeof(window.opener)=="undefined"||window.opener=="undefined")&&Ext.isIE){if(b.isFocusOnRelatedList){b.startWaitMsgBar();if(c.indexOf("Incident")>-1){b.loadIncidentRelatedList(recordId)}else{if(c.indexOf("Task")>-1){b.loadTaskRelatedList(recordId)}else{if(c.indexOf("Problem")>-1){b.loadProblemRelatedList(recordId)}else{if(c.indexOf("Change")>-1){b.loadChangeRelatedList(recordId)}}}}}else{b.setIsNeedToRefreshRelatedList(true)}}}window.close()}else{window.parent.setPopUpVar(recordId);window.parent.closePopup()}}}else{showError();var a=document.getElementById(emailTmplId);if(a!=null&&typeof(a)!="undefined"&&a.value!=NONE&&a.value.length>0){Ext.getCmp("resetId").setDisabled(true);Ext.getCmp("resetId").setIconClass("bmcResetDisable");isResetEnabled=true;Ext.getCmp("attachId").setDisabled(true);Ext.getCmp("attachId").setIconClass("bmcAttachFileDisabled")}else{Ext.getCmp("resetId").setDisabled(false);Ext.getCmp("resetId").setIconClass("bmcReset");isResetEnabled=false}}}function replyBtnHandler(){Ext.getCmp("replyId").setDisabled(true);Ext.getCmp("replyId").setIconClass("bmcReplyEmailDisable");replyMailRemoteJS(false,Ext.isIE)}function replyAllBtnHandler(){Ext.getCmp("replyAllId").setDisabled(true);Ext.getCmp("replyAllId").setIconClass("bmcReplyAllEmailDisable");replyMailRemoteJS(true,Ext.isIE)}function createCookie(){var a=new Date();a.setYear(a.getFullYear()+10);if(objectName.toLowerCase()==INCIDENT.toLowerCase()){document.cookie=cookieName+"staffLink="+bStaffLink+";expires="+a.toUTCString()+";path=/;SameSite=None;Secure";document.cookie=cookieName+"clientLink="+bClientLink+";expires="+a.toUTCString()+";path=/;SameSite=None;Secure"}if((standardLayout=="true"||isConsolePage=="true")&&(objectName.toLowerCase()==CHANGE_REQUEST.toLowerCase()||objectName.toLowerCase()==TASK.toLowerCase()||objectName.toLowerCase()==PROBLEM.toLowerCase())){document.cookie=cookieName+"staffLink="+bStaffLink+";expires="+a.toUTCString()+";path=/;SameSite=None;Secure"}}function recursiveElements(d,b){if(d==undefined||d==null){return b}var a=0;if(d.childNodes){a=d.childNodes.length}if(a==0){b.appendChild(d.cloneNode(true));return b}for(var c=0;c<a;c++){if(d.childNodes[c].hasChildNodes()){var e=clearHTML(d.childNodes[c].cloneNode(true));b.appendChild(recursiveElements(d.childNodes[c],e))}else{b.appendChild(d.childNodes[c].cloneNode(true))}}return b}function editTextNode(e){var m=document.createElement("div");if(e==undefined||e==null){return m}var h=0;if(e.childNodes){h=e.childNodes.length}if(h==0){m.appendChild(e.cloneNode(true));return m}for(var g=0;g<h;g++){if(e.childNodes[g].hasChildNodes()){m.appendChild(editTextNode(e.childNodes[g]))}else{if(e.childNodes[g].nodeType==e.TEXT_NODE){var n=false;var b=false;var o;if(sStaffURL&&e.childNodes[g].textContent.indexOf(sStaffURL)>-1){n=true;o=sStaffURL}else{if(StaffLightningURL&&e.childNodes[g].textContent.indexOf(StaffLightningURL)>-1){b=true;o=StaffLightningURL}}if(n||b){var c=document.createElement("div");var k=e.childNodes[g].textContent.split(o);for(var f=0;f<k.length;f++){c.appendChild(document.createTextNode(k[f]));if(f!=k.length-1){var l=document.createElement("a");var d=document.createTextNode(o);l.appendChild(d);l.href=o;c.appendChild(l)}}bSURLExistinBody=true;m.appendChild(c)}else{if(e.childNodes[g].textContent.indexOf(sClientURL)>-1){var c=document.createElement("div");var k=e.childNodes[g].textContent.split(sClientURL);for(var f=0;f<k.length;f++){c.appendChild(document.createTextNode(k[f]));if(f!=k.length-1){var l=document.createElement("a");var d=document.createTextNode(sClientURL);l.appendChild(d);l.href=sClientURL;c.appendChild(l)}}bCURLExistinBody=true;m.appendChild(c)}else{m.appendChild(e.childNodes[g].cloneNode(true))}}}else{m.appendChild(e.childNodes[g].cloneNode(true))}}}return m}var bCURLExistinBody=false;var bSURLExistinBody=false;function InsertLink(g){var c=!(StaffLightningURL&&sStaffURL)?true:false;if(objectName.toLowerCase()==INCIDENT.toLowerCase()){var h=getEmailBodyComponent();if(h!=null&&typeof(h)!="undefined"){bSURLExistinBody=false;bCURLExistinBody=false;if(g==false){if(!isRBEnabled||emailTemplSelected){if((sStaffURL&&h.value.indexOf(sStaffURL)>-1)||(StaffLightningURL&&h.value.indexOf(StaffLightningURL)>-1)){bSURLExistinBody=true}if(h.value.indexOf(sClientURL)>-1){bCURLExistinBody=true}}else{var f=h.cloneNode(true);h=clearHTML(h);h.appendChild(editTextNode(f.firstChild))}}if((bStaffLink=="true"||bStaffLink==true)&&(bSURLExistinBody==false)){if(!isRBEnabled||emailTemplSelected){if(StaffLightningURL){var e=(c)?labelLinkRemedyforceUser:RecordLinkLightningLabel;h.value=h.value+"\r\n"+e+" "+StaffLightningURL}if(sStaffURL){var e=(c)?labelLinkRemedyforceUser:RecordLinkClassicLabel;h.value=h.value+"\r\n"+e+" "+sStaffURL}}else{if(StaffLightningURL){h.appendChild(document.createElement("br"));var e=(c)?labelLinkRemedyforceUser:RecordLinkLightningLabel;h.appendChild(document.createTextNode(e+" "));var b=document.createElement("a");var d=document.createTextNode(StaffLightningURL);b.appendChild(d);b.href=StaffLightningURL;h.appendChild(b)}if(sStaffURL){h.appendChild(document.createElement("br"));var e=(c)?labelLinkRemedyforceUser:RecordLinkClassicLabel;h.appendChild(document.createTextNode(e+" "));var b=document.createElement("a");var d=document.createTextNode(sStaffURL);b.appendChild(d);b.href=sStaffURL;h.appendChild(b)}}}if((bClientURLExist=="true"||bClientURLExist==true)&&(bClientLink=="true"||bClientLink==true)&&(bCURLExistinBody==false)){if(!isRBEnabled||emailTemplSelected){h.value=h.value+"\r\n"+labelLinkSelfServiceClient+" "+sClientURL}else{h.appendChild(document.createElement("br"));h.appendChild(document.createTextNode(labelLinkSelfServiceClient+" "));var b=document.createElement("a");var d=document.createTextNode(sClientURL);b.appendChild(d);b.href=sClientURL;h.appendChild(b)}}}}if(objectName.toLowerCase()==CHANGE_REQUEST.toLowerCase()||objectName.toLowerCase()==TASK.toLowerCase()||objectName.toLowerCase()==PROBLEM.toLowerCase()){var h=getEmailBodyComponent();if(h!=null&&typeof(h)!="undefined"){bSURLExistinBody=false;if(g==false){if(!isRBEnabled||emailTemplSelected){if((sStaffURL&&h.value.indexOf(sStaffURL)>-1)||(StaffLightningURL&&h.value.indexOf(StaffLightningURL)>-1)){bSURLExistinBody=true}}else{if((sStaffURL&&getTextContent(h).indexOf(sStaffURL)>-1)||(StaffLightningURL&&getTextContent(h).indexOf(StaffLightningURL)>-1)){bSURLExistinBody=true}}}if((bStaffLink=="true"||bStaffLink==true)&&(bSURLExistinBody==false)){if(!isRBEnabled||emailTemplSelected){if(StaffLightningURL){var e=(c)?labelLinkRemedyforceUser:RecordLinkLightningLabel;h.value=h.value+"\r\n"+e+" "+StaffLightningURL}if(sStaffURL){var e=(c)?labelLinkRemedyforceUser:RecordLinkClassicLabel;h.value=h.value+"\r\n"+e+" "+sStaffURL}}else{if(StaffLightningURL){h.appendChild(document.createElement("br"));var e=(c)?labelLinkRemedyforceUser:RecordLinkLightningLabel;h.appendChild(document.createTextNode(e+" "));var b=document.createElement("a");var d=document.createTextNode(StaffLightningURL);b.appendChild(d);b.href=StaffLightningURL;h.appendChild(b)}if(sStaffURL){h.appendChild(document.createElement("br"));var e=(c)?labelLinkRemedyforceUser:RecordLinkClassicLabel;h.appendChild(document.createTextNode(e+" "));var b=document.createElement("a");var d=document.createTextNode(sStaffURL);b.appendChild(d);b.href=sStaffURL;h.appendChild(b)}}}}}}var nodeFound=false;function removePreviousMails(d,b){if(d==undefined||d==null){return b}if(d.nodeName="DIV"&&d.getAttribute("id")=="divHR"){nodeFound=true;return b}var a=0;if(d.childNodes){a=d.childNodes.length}if(a==0){b.appendChild(d.cloneNode(true));return}if(!nodeFound){for(var c=0;c<a;c++){if(d.childNodes[c].hasChildNodes()){var e=clearHTML(d.childNodes[c].cloneNode(true));b.appendChild(removePreviousMails(d.childNodes[c],e))}else{if(!nodeFound){b.appendChild(d.childNodes[c].cloneNode(true))}}}}return b}function removeOriginalContent(c){var b=document.getElementById(bodyId);var d=getRichComponent();if(c.checked){nodeFound=false;var a=d.cloneNode(true);d=clearHTML(d);removePreviousMails(a,d)}else{if(!d.firstChild){d.appendChild(document.createElement("br"));d.appendChild(document.createElement("br"));d.appendChild(document.createElement("br"));d.appendChild(document.createElement("br"));d.appendChild(prevContentHolder.cloneNode(true))}else{d.appendChild(prevContentHolder.cloneNode(true))}}}function enableDisableRmvCheckbox(){if(isRBEnabled&&isNew=="false"){var b=document.getElementById(rmvChkBxId);if(b!=null&&typeof(b)!="undefined"){b.style.display="block"}var a=document.getElementById(rmvChkBxLabelId);if(a!=null&&typeof(a)!="undefined"){a.style.display="block"}}else{var b=document.getElementById(rmvChkBxId);if(b!=null&&typeof(b)!="undefined"){b.style.display="none"}var a=document.getElementById(rmvChkBxLabelId);if(a!=null&&typeof(a)!="undefined"){a.style.display="none"}}}function getRichComponent(){var c;if(richBodyComponent==null||typeof(richBodyComponent)=="undefined"){var b=document.getElementsByTagName("iframe");var a=b[0];if(a!=null&&typeof(a)!="undefined"){if(checkIsIEEleBrowser()){doc=a.contentDocument;win=a.contentWindow}else{if(Ext.isIE){doc=a.contentWindow.document;win=a.contentWindow}else{doc=a.contentDocument;win=a.contentWindow}}richBodyComponent=doc.getElementById(richBodyId+":textAreaDelegate_RichTextNote__c_rta_body");if(richBodyComponent==null||typeof(richBodyComponent)=="undefined"){richBodyComponent=doc.getElementById(richBodyId+":textAreaDelegate_"+nameSpacePrefix+"RichTextNote__c_rta_body")}}}else{c=richBodyComponent}return c}function replyMailRemoteJS(b,a){Visualforce.remoting.Manager.invokeAction(_RemotingActions.replyMailRemote,emailTemplId,propEnableEmailConvTempl,emailTmplConv,objectName,toAddress,fromAddress,ccAddress,subject,historyRecordJSON,emailParentRecordJSON,b,a,function(o,c){if(c.type==="exception"){alert(c.message)}else{isSendEnabled="true";Ext.getCmp("textFormatBtn").setDisabled(false);buttonValidator();setLabelsToolTips();var f=document.getElementById(toAddrId);if(f!=null&&typeof(f)!="undefined"){f.value=o.toAddress}var l=document.getElementById(ccId);if(l!=null&&typeof(l)!="undefined"){l.value=o.ccAddress}showBCCCompo(true);var h=document.getElementById(subjId);if(h!=null&&typeof(h)!="undefined"){h.value=o.subject}var m=document.getElementById(bodyId);enableDisableRmvCheckbox();var e=getRichComponent();if(e!=null&&typeof(e)!="undefined"){var n=document.createElement("div");n.setAttribute("id","divHR");var j=document.createElement("strong");j.appendChild(document.createElement("em"));var d=document.createElement("em");d.appendChild(j);n.appendChild(d);var g='<div id="divHR"><hr><em><strong><em></em></strong></em></div>';if(o.mailBody.trim().length>0||o.isPlainText=="false"){e=clearHTML(e);parseHTML(e,g+o.mailBody)}else{if(o.isPlainText=="true"&&o.plainbody!=null){e=clearHTML(e);e.appendChild(n);e.appendChild(retainBreakLine(o.plainbody,false))}}prevContentHolder=e.cloneNode(true);e.insertBefore(document.createElement("br"),e.firstChild);e.insertBefore(document.createElement("br"),e.firstChild);e.insertBefore(document.createElement("br"),e.firstChild);e.insertBefore(document.createElement("br"),e.firstChild)}var k=document.getElementById(chkBxId);if(k!=null&&typeof(k)!="undefined"){k.disabled=false}disableRichText(false)}},{escape:false})}function checkIsIEEleBrowser(){var b=window.navigator.userAgent;var a=b.indexOf("MSIE ");if(a>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)){return true}else{return false}}function closePopupForLightningNow(){if(attachmentPopupInstance!=null&&attachmentPopupInstance!=undefined){attachmentPopupInstance.close()}}function showWaitMask(){waitMask.show()}function hideWaitMask(){waitMask.hide()};