var store,gridData=[],grid,store2,image,listData=[],i=0,selectedRecord,isIncImgClicked,isImgClicked;function callNewPage(a){window.parent.addNewTab("BroadcastsPage",BroadcastWidget.Labels.NavigatorBroadcast,"NavigatorPage?title="+labelBroadcastWindowHeaderSearchPage+"&target=BroadcastsPage?id="+a+"%26columnField=Name%26direction=ASC")}Ext.onReady(function(){Ext.QuickTips.init();showTable();setData()});function showTable(){store=new Ext.data.ArrayStore({fields:[{name:"Image"},{name:"Id"},{name:"isFollow"},{name:"createInc"},{name:"ab"}],data:gridData});var a=false;if(!showSubmitIncIcon||isFromSS!="true"||isfromconsole=="true"){a=true}if(isPortalUser=="true"){fieldColumns=[{header:"Priority",renderer:renderIcon,width:isfromconsole=="true"?50:30,height:2,sortable:isfromconsole=="true"?false:true,dataIndex:"Image"},{header:"Message",id:"Description",width:230,height:2,sortable:isfromconsole=="true"?false:true,dataIndex:"Id"},{header:"CreateInc",renderer:renderIncIcon,width:50,height:2,sortable:false,dataIndex:"createInc",hidden:a,id:"createIncId"}]}else{fieldColumns=[{header:"Priority",renderer:renderIcon,width:isfromconsole=="true"?50:30,height:isfromconsole=="true"?14:2,sortable:isfromconsole=="true"?false:true,dataIndex:"Image"},{header:"Message",id:"Description",width:230,height:2,sortable:isfromconsole=="true"?false:true,dataIndex:"Id"},{header:"Follow",renderer:renderFollow,width:50,height:2,sortable:isfromconsole=="true"?false:true,dataIndex:"isFollow",id:"followId"},{header:"CreateInc",renderer:renderIncIcon,width:50,height:2,sortable:false,dataIndex:"createInc",hidden:a,id:"createIncId"}]}grid=new Ext.grid.GridPanel({renderTo:"extGridPanel",id:"grid",store:store,columns:fieldColumns,stripeRows:isfromconsole=="true"?false:true,autoExpandColumn:"Description",enableHdMenu:false,layout:"fit",stateful:true,selModel:selModel,height:isfromconsole=="true"?290:119,header:false,stateId:"grid",cls:"brdcastGridCls",columnLines:isfromconsole=="true"?true:false,viewConfig:{forceFit:true,scrollOffset:0,emptyText:NoRecordsFound,deferEmptyText:false},autoFitColumns:true,listeners:{headerclick:function(b,c,d){if(c=="0"){handleColumnClick(c+"")}},Keydown:function(n){var j=document.activeElement;var f=j.className;var o=this.getSelectionModel().getSelected();var q=o.get("ab");if(Ext.EventObject.getKey()==9){handleRowClick(q);if(j.childNodes&&j.childNodes[0]){var h=j.childNodes[0].childNodes[0];if(h&&typeof(h.getAttribute)!="undefined"){var p=h.getAttribute("rowIndex");grid.getSelectionModel().selectRow(p,true);grid.getView().focusRow(p)}}}else{if(Ext.EventObject.getKey()==38||Ext.EventObject.getKey()==40){handleRowClick(q);if(j.childNodes&&j.childNodes[0]){var h=j.childNodes[0].childNodes[0];if(h&&typeof(h.getAttribute)!="undefined"){var p=h.getAttribute("rowIndex");grid.getSelectionModel().selectRow(p,true);grid.getView().focusRow(p);var b=document.getElementsByClassName("x-grid3-col x-grid3-cell x-grid3-td-1 x-grid3-cell-first ");var d=b[p]}if(d!=null){d.focus()}}}else{if(f.indexOf("createIncId")!=-1){if(Ext.EventObject.getKey()==13||Ext.EventObject.getKey()==32){var h=j.childNodes[0].childNodes[0];var p=h.getAttribute("rowIndex");var o=grid.store.getAt(p);var m=o.get("ab");createIncForBrd(m)}}else{if(f.indexOf("followId")!=-1){if(Ext.EventObject.getKey()==13||Ext.EventObject.getKey()==32){var h=j.childNodes[0].childNodes[0];var p=h.getAttribute("rowIndex");var g=grid.store.getAt(p);var l=g.get("isFollow");var c=g.get("ab");if(l=="true"){g.set("isFollow","false");g.commit();handleRowClickWithFollow(c,false)}else{g.set("isFollow","true");g.commit();handleRowClickWithFollow(c,true)}var b=document.getElementsByClassName("x-grid3-col x-grid3-cell x-grid3-td-followId ");var d=b[p];if(d!=null){d.focus()}}}}}}},rowClick:function(b,h,d){var f=b.store.getAt(h);selectedRecord=b.store.getAt(h);var g=f.get("ab");if(isPortalUser=="true"){if(isIncImgClicked){createIncForBrd(g)}else{handleRowClick(g)}isIncImgClicked=false}else{if(isImgClicked==true){var c=f.get("isFollow");if(c=="true"){f.set("isFollow","false");f.commit();handleRowClickWithFollow(g,false)}else{f.set("isFollow","true");f.commit();handleRowClickWithFollow(g,true)}isImgClicked=false}else{if(isIncImgClicked){createIncForBrd(g)}else{handleRowClick(g)}isIncImgClicked=false}}},rowDblClick:function(b,g,c){var d=b.store.getAt(g);var f=d.get("ab");if(isfromRFconsole=="true"){window.parent.addTab(f,"Broadcast","Broadcasts__c",false);window.parent.broadcastWindow.close()}else{if(isfromRFconsole=="false"){window.open("/apex/RemedyforceConsole?record_id="+f+"&objectName=Broadcasts__c")}}if(isFromSS!="true"){callNewPage(f)}},afterrender:function(){grid.getSelectionModel().selectRow(0,true);if(grid.getStore().getCount()>0){grid.getView().focusRow(0);var b=document.querySelectorAll(".x-grid3-cell-inner.x-grid3-col-1");b[0].tabindex="-1";var d=document.querySelectorAll(".clsImageA");d[0].tabindex="-1";var c=document.querySelectorAll(".x-grid3-col.x-grid3-cell.x-grid3-td-1.x-grid3-cell-first");var e=c[0];if(e!=null){e.focus()}}},delay:1000}});RTLHandling()}document.onkeydown=function(a){a=a||window.event;if(typeof(a)=="undefined"||a=="null"){return}k=a.which||a.charCode||a.keyCode;if(k==27){window.parent.closeBroadcast()}};var selModel=new Ext.grid.RowSelectionModel({singleSelect:true});function setDataJS(a){if(store!=null&&typeof(store)!="undefined"){store.removeAll();store.loadData(a);if(isfromconsole=="true"&&store.getCount()==0){grid.getView().el.select(".x-grid3-header").setStyle("display","none")}}}function createIncForBrd(a){if(window.parent.openIncidentTab){window.parent.openIncidentTab(null,"brdcstId="+a);window.parent.broadcastWindow.close()}}function unFollowRecord(){isImgClicked=true}function followRecord(){isImgClicked=true}function enableIncIcon(){isIncImgClicked=true}function disableIncIcon(a){isIncImgClicked=false;Ext.Msg.show({msg:SSIfIncidentAlreadyCreatedForBrd,buttons:Ext.Msg.YESNO,fn:function(b){if(b=="yes"){createIncForBrd(a)}},icon:Ext.MessageBox.WARNING})}function changeImages(){if(errormsg!=null&&errormsg!=""){var a=selectedRecord.get("isFollow");if(a=="true"){selectedRecord.set("isFollow","false");selectedRecord.commit()}else{selectedRecord.set("isFollow","true");selectedRecord.commit()}}}function showError(){if(errormsg!=null&&errormsg!=""){Ext.MessageBox.show({title:"",msg:errormsg,width:300,buttons:Ext.MessageBox.OK})}}function renderFollow(e,c,a,f,d,b){var e=e.trim();if(e=="true"){return'<span class="clsImageA" rowIndex="'+f+'" columnIndex="'+d+'" ><label class="unfollowCls" onclick="unFollowRecord();" title="'+unFollow+'" onmouseover="showCloseImage(this);" onmouseout="hideCloseImage(this);" > </span>'}else{return'<span class="clsImageA" rowIndex="'+f+'" columnIndex="'+d+'"><label class="followCls" title="'+follow+'" onclick="followRecord();" > </span>'}}function showCloseImage(a){a.className="unfollowHoverCls";a.title=unFollow}function hideCloseImage(a){a.className="unfollowCls"}function renderIncIcon(d,e,b,g,f,c){var d=d.trim();var a=b.get("ab");if(d=="true"){return'<span class="clsImageA" rowIndex="'+g+'" columnIndex="'+f+'" ><label  class="createIncIconCls2" onclick="disableIncIcon(\''+a+'\');" title="'+submitTktLbl+'"> </span>'}else{return'<span class="clsImageA" rowIndex="'+g+'" columnIndex="'+f+'" ><label  class="createIncIconCls1" onclick="enableIncIcon();" title="'+submitTktLbl+'"> </span>'}}var incident_ids="";function getIncidentIdsTOBroadcast(){if(islinktobroadcast){var b;if(calledFromConsoleListViewPage=="true"){var c=parent.parent.frames;for(var a=0;a<c.length;a++){try{if(c[a].name=="consolelistviewframe"&&c[a].objectNameParam=="Incident__c"&&c[a].isServiceRequest+""==isServiceRequest){b=c[a].window.ListViewGrid.getSelectionModel().getSelection();break}}catch(d){console.log(d)}}}else{b=parent.window.ListViewGrid.getSelectionModel().getSelection()}if(b.length>0){for(var a=0;a<b.length;a++){incident_ids+=b[a].data.Id+","}}passincidentidstocontroller(incident_ids)}}function showMask(){var b=document.getElementById("overlay");b.style.display="block";var a=document.getElementById("divmsg");a.style.display="block"}function hideMask(){var b=document.getElementById("overlay");b.style.display="none";var a=document.getElementById("divmsg");a.style.display="none"}function focusFirstRow(){if(Ext.EventObject.getKey()==9){grid.getSelectionModel().selectRow(0,true);grid.getView().focusRow(0);var a=document.getElementsByClassName("x-grid3-cell-inner x-grid3-col-1");a[0].tabindex="-1";var c=document.getElementsByClassName("clsImageA");c[0].tabindex="-1";var b=document.getElementsByClassName("x-grid3-col x-grid3-cell x-grid3-td-1 x-grid3-cell-first ");var d=b[0];if(d!=null){d.focus()}}}function RTLHandling(){if(isfromconsole=="true"&&window.parent.userLanguage=="iw"){var b=document.getElementById("grid");if(b){b.dir="rtl"}var a=document.getElementById("BRDetails");if(a){a.dir="rtl"}}};