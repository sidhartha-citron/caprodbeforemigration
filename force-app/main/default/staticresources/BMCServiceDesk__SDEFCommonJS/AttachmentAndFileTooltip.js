var attachmentTooltip,attTooltipData,alreadySelectedRecordId="",LoadingTip,onClickTooltipCheck=false;function hideLoadingTip(){if(LoadingTip){window.setTimeout(function(){LoadingTip.hide()},500)}}function showAttachmentTooltip(b,c,e,a,d){if(e){if(typeof attachmentTooltip==="undefined"){attachmentTooltip=Ext.create("Ext.tip.ToolTip",{target:b.id,anchor:"left",shadow:false,autoHide:false,cls:"rf-attachment-tip",html:null});attachmentTooltip.on("show",function(){var g;attachmentTooltip.getEl().on("mouseout",function(){g=window.setTimeout(function(){attachmentTooltip.hide()},500)});attachmentTooltip.getEl().on("mouseover",function(){window.clearTimeout(g)});Ext.get(attachmentTooltip.target).on("mouseover",function(){window.clearTimeout(g)});Ext.get(attachmentTooltip.target).on("wheel",function(){attachmentTooltip.hide()});Ext.get(attachmentTooltip.target).on("mouseout",function(){g=window.setTimeout(function(){attachmentTooltip.hide()},500)})})}else{attachmentTooltip.setTarget(b.id)}showLoadingOnToolTip(b,c,e);if(e===alreadySelectedRecordId){LoadingTip.hide();attachmentTooltip.update(getAttTooltipHtml(attTooltipData,e,a),true,hideLoadingTip);attachmentTooltip.show()}else{LoadingTip.show();alreadySelectedRecordId=e;var f={};f.query_limit=5;f.IsBubble=true;callRemoteAction(_RemotingActions.getAttachmentBubbleInfo,e,_ServerVariables.ObjectName,f,function(g,h){LoadingTip.hide();if(h.status){if(g!=""&&g!=null){attTooltipData=g;attachmentTooltip.update(getAttTooltipHtml(attTooltipData,e,a),true,hideLoadingTip);if(!onClickTooltipCheck){attachmentTooltip.show()}onClickTooltipCheck=false}}else{if(h.type==="exception"){alert(h.message)}}},{escape:true})}}return false}function getAttTooltipHtml(j,f,h){var a=j.attchments;var k=j.totalcount;var d=AttachmentsSectionHeader.replace("{0}",h).replace("{1}",a.length).replace("{2}",k);if(k>0){contentHtml='<div> <div class="rf-att-hd" ><span class="rf-att-floatleft">'+d+'</span><a class="rf-att-hd-link"  href="#" onclick="return OpenAttachmentWindow(\''+f+"','"+h+"');\">"+seeAllLbl+"</a></div>"}else{contentHtml='<div> <div class="rf-att-hd" ><span class="rf-att-floatleft">'+d+"</span></div>"}contentHtml+='<table style="background:#ffffff;" width="100%" >';for(var b=0;b<a.length;b++){var c=a[b];var e=Ext.util.Format.ellipsis(c.Name,100);contentHtml+='<tr class="rf-att-row"> <td valign="top" class="rf-att-col"><div class="rf-att-col-div"><span  class="'+getFileGenericIconClass(c.Name)+' rf-att-type-icon" ></span><div class="rf-att-desc"><div class="rf-att-des-div" title="'+c.Name+'">';if(c.isFile){contentHtml+='<a class="rf-att-a" target="_blank" href=/'+c.contentDocumentId+"><span>"+e+"</span></a>"}else{contentHtml+='<a class="rf-att-a" target="_blank" href=/servlet/servlet.FileDownload?file='+c.Id+"><span>"+e+"</span></a>"}var g=c.BodyLength/1024;if(g){g=g.toFixed(2)}contentHtml+=' <span class="rf-att-size" > | '+g+" "+KBlbl+" </span>";contentHtml+=' </div><div class="rf-att-author" >'+c.CreatedDate+" | <span>"+c.CreatedByName+"</span></div>";contentHtml+=" </div></div></td></tr>"}contentHtml+='</table><div style="height:10px;" /></div>';return contentHtml}function showLoadingOnToolTip(a,b,d){var c='<div  class="rf-inline-loading" />';if(typeof LoadingTip==="undefined"){LoadingTip=Ext.create("Ext.tip.ToolTip",{target:a.id,anchor:"left",shadow:false,autoHide:false,cls:"rf-att-tip-load",html:c});LoadingTip.on("show",function(){var e;LoadingTip.getEl().on("mouseout",function(){e=window.setTimeout(function(){LoadingTip.hide()},500)});LoadingTip.getEl().on("mouseover",function(){window.clearTimeout(e)});Ext.get(LoadingTip.target).on("mouseover",function(){window.clearTimeout(e)});Ext.get(LoadingTip.target).on("wheel",function(){LoadingTip.hide()});Ext.get(LoadingTip.target).on("mouseout",function(){e=window.setTimeout(function(){LoadingTip.hide()},500)})})}else{LoadingTip.setTarget(a.id)}}function OpenAttachmentWindow(c,f){var e=950;var h=450;var g=parseInt((screen.availWidth/2)-(e/2));var b=parseInt((screen.availHeight/2)-(h/2));if(c=="null"||c==null){c=""}var a="status = 1,height = "+h+", width = "+e+",left="+g+",top="+b+", resizable = 1,scrollbars=yes";var d=window.open("/apex/StaffAttachment?parentId="+c,"attachment",a);if(d.focus){d.focus()}}function getFileGenericIconClass(b){var a=b.split(".").pop(),f=["xls","xlsx","doc","docx","pdf","csv","txt"],e=["jpg","jpeg","png","gif","tif","tiff","bmp"],c="d-icon-paperclip_square";var d={xls:"xls",xlsx:"xls",doc:"word",docx:"word",pdf:"pdf",csv:"xls",txt:"txt"};a=a.toLowerCase();if(f.indexOf(a)>=0){c="d-icon-"+d[a]+"_square"}else{if(e.indexOf(a)>=0){c="d-icon-image_square"}}return c};