Ext.onReady(function(){Ext.QuickTips.init();masterObjectFieldList=new Ext.data.Store({autoDestroy:true,fields:[{name:"objectApi"},{name:"fieldStore"}]});masterObjectFieldRecord=Ext.data.Record.create([{name:"objectApi"},{name:"fieldStore"}]);eval(strTempKS);KSSstore=new Ext.data.ArrayStore({fields:[{name:"ID"},{name:"ObjectName"},{name:"FieldName"},{name:"IsSearchField"},{name:"DisplayOrder"},{name:"Solution"}]});KSSstore.loadData(arrKsSettings);var uniqueObjectList=KSSstore.collect("ObjectName",false,true);fetchFieldListForObject(uniqueObjectList,true)});function renderFieldCombo(c){var a=masterObjectFieldList.find("objectApi",c);if(a>=0){var b=masterObjectFieldList.getAt(a);Ext.getCmp("FieldNameCombo_id").bindStore(b.get("fieldStore"),true);lastObjectSelected=c}firstRecordFlag=false}function restOfTheRendering(l){var h=new Ext.data.ArrayStore({id:"objectStore",fields:[{name:"apiName"},{name:"objectLabel"}]});h.loadData(l);h.sort("objectLabel");var j=new Ext.form.ComboBox({id:"ObjectNameCombo_id",typeAhead:true,triggerAction:"all",mode:"local",store:h,valueField:"apiName",displayField:"objectLabel",editable:false,autoLoad:true,selectOnFocus:true});Ext.util.Format.objectComboRenderer=function(q){return function(s){var r=q.findRecord(q.valueField,s);return r?r.get(q.displayField):q.valueNotFoundText}};j.on("select",function(t,r,s){k.enable();var q=[];q.push(t.value);fetchFieldListForObject(q,false);var v=b.getSelectionModel().getSelections();var u=v[0];u.set("FieldName","")});var k=new Ext.form.ComboBox({id:"FieldNameCombo_id",typeAhead:true,mode:"local",triggerAction:"all",lastQuery:"",clearFilterOnReset:true,valueField:"api",displayField:"dn",selectOnFocus:true,editable:false,autoLoad:true,selectOnFocus:true,tpl:'<tpl for="."><div class="x-combo-list-item">{[Ext.util.Format.htmlEncode(values.dn)]}</div></tpl>'});k.on("focus",function(s){var v=b.getSelectionModel().getSelections();var u=v[0];var q=masterObjectFieldList.find("objectApi",u.get("ObjectName"));s.enable();if(q>=0){var t=masterObjectFieldList.getAt(q);t.get("fieldStore").clearFilter();t.get("fieldStore").filterBy(function r(w){for(var x=0;x<KSSstore.data.length;x++){if(u.get("ObjectName")==KSSstore.getAt(x).get("ObjectName")){if((w.get("api")==KSSstore.getAt(x).get("FieldName"))&&(u.get("FieldName")!=KSSstore.getAt(x).get("FieldName"))){return false}}}return true});s.bindStore(t.get("fieldStore"),true);s.clearValue();s.setValue(u.get("FieldName"))}else{s.disable()}});k.on("blur",function(q){q.getStore().clearFilter()});Ext.util.Format.fieldComboRenderer=function(q){return function(v,u,s){var t=masterObjectFieldList.find("objectApi",s.data.ObjectName);if(t>=0){if(lastObjectSelected!=s.data.ObjectName){var w=masterObjectFieldList.getAt(t);q.bindStore(w.get("fieldStore"),true)}var r=q.findRecord(q.valueField,v);lastObjectSelected=s.data.ObjectName;return r?Ext.util.Format.htmlEncode(r.get(q.displayField)):q.valueNotFoundText}}};function p(r){var q=document.images.btnRemove;if(r){q.src=SDEFPath+"/SDEFbuttons/b_remove.png";q.style.cursor="pointer";q.setAttribute("isBtnDisabled",false)}else{q.src=SDEFPath+"/SDEFbuttons/b_remove_disabled.png";q.style.cursor="default";q.setAttribute("isBtnDisabled",true)}}function d(r){var q=document.images.btnMoveUp;if(r){q.src=SDEFPath+"/SDEFbuttons/b_control_up.png";q.style.cursor="pointer";q.setAttribute("isBtnDisabled",false)}else{q.src=SDEFPath+"/SDEFbuttons/b_control_up_disable.png";q.style.cursor="default";q.setAttribute("isBtnDisabled",true)}}function o(r){var q=document.images.btnMoveDown;if(r){q.src=SDEFPath+"/SDEFbuttons/b_control_down.png";q.style.cursor="pointer";q.setAttribute("isBtnDisabled",false)}else{q.src=SDEFPath+"/SDEFbuttons/b_control_down_disable.png";q.style.cursor="default";q.setAttribute("isBtnDisabled",true)}}var g=new Ext.grid.CheckboxSelectionModel({listeners:{selectionchange:function(x){p(false);d(false);o(false);var r=Ext.ComponentMgr.get("grid_id");var w=r.getSelectionModel().getSelected();var s=r.getStore().indexOf(w);if(x.getCount()==1){if(s==0){o(true)}if(s==(KSSstore.data.length-1)){d(true)}if(s!=0&&s!=(KSSstore.data.length-1)){o(true);d(true)}}if(x.getCount()>0){if((w.get("FieldName")=="Company"&&w.get("ObjectName")=="Lead")||(w.get("ObjectName")=="Contact"&&w.get("FieldName")=="AccountId")||(w.get("ObjectName")=="User"&&w.get("FieldName")=="AccountId")){p(false)}else{p(true)}}var t=Ext.getCmp("grid_id").store.getRange().length;var v=this.selections.items.length;if(v==t){var q=Ext.getCmp("grid_id").getView();var u=Ext.fly(q.innerHd).child(".x-grid3-hd-checker");u.addClass("x-grid3-hd-checker-on")}},rowdeselect:function(u,t,r){var q=Ext.getCmp("grid_id").getView();var s=Ext.fly(q.innerHd).child(".x-grid3-hd-checker");s.removeClass("x-grid3-hd-checker-on")}}});var e=new Ext.grid.CheckColumn({header:"Solution",dataIndex:"Solution",width:55,hidden:true});var n=new Ext.grid.ColumnModel([g,{id:"ID",header:"ID",dataIndex:"ID",hidden:true},{header:lblDataSource,dataIndex:"ObjectName",tooltip:lblTipDataSource,editor:j,renderer:Ext.util.Format.objectComboRenderer(j)},{header:lblDataField,dataIndex:"FieldName",tooltip:lblTipDataField,editor:k,renderer:Ext.util.Format.fieldComboRenderer(k)},{header:"issearchable",dataIndex:"IsSearchField",value:true,hidden:true},{header:"displayorder",dataIndex:"DisplayOrder",value:"0",hidden:true}]);KSSstore.clearFilter();KSSstore.filter("IsSearchField",false);var c=new Ext.Panel({layout:"fit",autoHeight:true,contentEl:"display__fields_div",border:false});var i=new Ext.Toolbar({id:"ks_settings_toolbar",renderTo:"toolbar",items:[{xtype:"box",id:"btnAdd",autoEl:{tag:"img",src:SDEFPath+"/SDEFbuttons/b_add.png",title:lblAdd,name:"addBtn"},style:"cursor:pointer;padding-left:5px;padding-right:5px;",listeners:{render:function(q){q.getEl().on("click",function(){if(KSSstore.data.length!=0){var t=KSSstore.getAt(KSSstore.data.length-1).get("FieldName");if(t==""){Ext.MessageBox.show({width:250,title:lblGlobalSearchTitle,msg:lblValidatorMsg,buttons:Ext.MessageBox.OK});var w=Ext.getCmp("saveId");w.enable();if(!enablesavebtn){Ext.getCmp("saveId").setDisabled(true)}return}}var s="";if(KSSstore.data.length!=0){s=KSSstore.getAt(KSSstore.data.length-1).get("ObjectName")}else{s=h.getAt(0).get("apiName");firstRecordFlag=true}var x=b.getStore().getCount();var u=b.getStore().recordType;var v=new u({ID:"",ObjectName:s,FieldName:"",IsSearchField:false,displayorder:0,Solution:false});var w=Ext.getCmp("saveId");w.enable();if(!enablesavebtn){Ext.getCmp("saveId").setDisabled(true)}b.stopEditing();KSSstore.insert(x,v);b.startEditing(x,2);var r=[];r.push(s);fetchFieldListForObject(r,false)});q.getEl().on("mouseover",function(){document.images.btnAdd.src=SDEFPath+"/SDEFbuttons/b_add_mouseover.png"});q.getEl().on("mouseout",function(){document.images.btnAdd.src=SDEFPath+"/SDEFbuttons/b_add.png"})}}},{xtype:"box",id:"btnRemove",autoEl:{tag:"img",src:SDEFPath+"/SDEFbuttons/b_remove_disabled.png",title:lblRemove,name:"removeBtn"},style:"cursor:default;padding-right:5px;",listeners:{render:function(q){q.getEl().on("load",function(){if(document.images.btnRemove.getAttribute("isBtnDisabled")==null){document.images.btnRemove.setAttribute("isBtnDisabled",true)}});q.getEl().on("click",function(){deleteSelectedRow(b)});q.getEl().on("mouseover",function(){if(document.images.btnRemove.getAttribute("isBtnDisabled")=="false"){document.images.btnRemove.src=SDEFPath+"/SDEFbuttons/b_remove_mouseover.png"}});q.getEl().on("mouseout",function(){if(document.images.btnRemove.getAttribute("isBtnDisabled")=="false"){document.images.btnRemove.src=SDEFPath+"/SDEFbuttons/b_remove.png"}})}}},{xtype:"box",id:"btnMoveUp",autoEl:{tag:"img",src:SDEFPath+"/SDEFbuttons/b_control_up_disable.png",title:lblUp,name:"btnMoveUp"},style:"cursor:default;padding-left:5px;",listeners:{render:function(q){q.getEl().on("load",function(){if(document.images.btnMoveUp.getAttribute("isBtnDisabled")==null){document.images.btnMoveUp.setAttribute("isBtnDisabled",true)}});q.getEl().on("click",function(){moveSelectedRow(b,-1)});q.getEl().on("mouseover",function(){if(document.images.btnMoveUp.getAttribute("isBtnDisabled")=="false"){document.images.btnMoveUp.src=SDEFPath+"/SDEFbuttons/b_control_up_mouseover.png"}});q.getEl().on("mouseout",function(){if(document.images.btnMoveUp.getAttribute("isBtnDisabled")=="false"){document.images.btnMoveUp.src=SDEFPath+"/SDEFbuttons/b_control_up.png"}})}}},{xtype:"box",id:"btnMoveDown",autoEl:{tag:"img",src:SDEFPath+"/SDEFbuttons/b_control_down_disable.png",title:lblDown,name:"btnMoveDown"},style:"cursor:default;padding-right:5px;",listeners:{render:function(q){q.getEl().on("load",function(){if(document.images.btnMoveDown.getAttribute("isBtnDisabled")==null){document.images.btnMoveDown.setAttribute("isBtnDisabled",true)}});q.getEl().on("click",function(){moveSelectedRow(b,1)});q.getEl().on("mouseover",function(){if(document.images.btnMoveDown.getAttribute("isBtnDisabled")=="false"){document.images.btnMoveDown.src=SDEFPath+"/SDEFbuttons/b_control_down_mouseover.png"}});q.getEl().on("mouseout",function(){if(document.images.btnMoveDown.getAttribute("isBtnDisabled")=="false"){document.images.btnMoveDown.src=SDEFPath+"/SDEFbuttons/b_control_down.png"}})}}}]});var b=new Ext.grid.EditorGridPanel({store:KSSstore,cm:n,sm:g,id:"grid_id",layout:"fit",sortable:false,enableHdMenu:false,stripeRows:false,autoExpandColumn:true,autoHeight:true,height:350,plugins:e,clicksToEdit:true,border:false,viewConfig:{forceFit:true,scrollOffset:20,onAdd:function(s,q,r){this.constructor.prototype.onAdd.apply(this,arguments);this.grid.getSelectionModel().selectRow(r);this.focusRow(r)}}});var m=new Ext.Panel({renderTo:"ksgrid",layout:"fit",items:[b]});Ext.EventManager.onWindowResize(m.doLayout,m);Ext.EventManager.onWindowResize(function(){b.startEditing(0,0)});var a=new Ext.Panel({id:"toolBarId",renderTo:"kssavetoolbar",cls:"toolSpCls",tbar:[{scale:"medium",iconCls:"bmcSave",tooltipType:"title",tooltip:lblSave,id:"saveId",listeners:{mouseover:function(){this.setIconClass("bmcSaveOn")},mouseout:function(){this.setIconClass("bmcSave")}},handler:savehandler}]});var f=Ext.getCmp("saveId");f.enable();if(!enablesavebtn){Ext.getCmp("saveId").setDisabled(true)}}var savehandler=function(d,f){var e=Ext.getCmp("saveId");e.disable();var a=1;var b="";for(var c=0;c<KSSstore.data.length;c++){if(KSSstore.getAt(c).get("FieldName")==""&&KSSstore.getAt(c).get("ObjectName")!=""){Ext.MessageBox.show({width:250,title:lblGlobalSearchTitle,msg:lblEmptyValidationMsg,buttons:Ext.MessageBox.OK});var e=Ext.getCmp("saveId");e.enable();if(!enablesavebtn){Ext.getCmp("saveId").setDisabled(true)}return}else{if(KSSstore.getAt(c).get("FieldName")!=""&&KSSstore.getAt(c).get("ObjectName")!=""){b+=String.format("{0},{1},{2},{3},{4};",KSSstore.getAt(c).get("ObjectName"),KSSstore.getAt(c).get("FieldName"),KSSstore.getAt(c).get("IsSearchField"),KSSstore.getAt(c).get("Solution"),a);a++}}}jsSaveKSSettings(b)};function deleteSelectedRow(e){var b=e.getSelectionModel().getSelections();if(!b){return}for(var d=b.length;d>=0;d--){var a=b[d];var c=e.getStore().indexOf(b);if(a!=null){if((a.get("ObjectName")=="Lead"&&a.get("FieldName")=="Company")||(a.get("ObjectName")=="Contact"&&a.get("FieldName")=="AccountId")||(a.get("ObjectName")=="User"&&a.get("FieldName")=="AccountId")){Ext.MessageBox.show({width:250,title:lblGlobalSearchTitle,msg:lblCannotDeleteMsg,buttons:Ext.MessageBox.OK})}else{if(a!=null){e.getStore().remove(a)}}}}}function moveSelectedRow(c,d){var a=c.getSelectionModel().getSelected();if(!a){return}var b=c.getStore().indexOf(a);if(d<0){b--;if(b<0){return}}else{b++;if(b>=c.getStore().getCount()){return}}c.getStore().remove(a);c.getStore().insert(b,a);c.getSelectionModel().selectRow(b,true)}function fetchFieldListForObject(objList,isOnload){Visualforce.remoting.Manager.invokeAction(_RemotingActions.GetData,objList,function(result,event){for(var i=0;i<result.length;i++){var sData=[];if(Ext.isIE8){sData=eval("("+result[i].json+")")}else{sData=JSON.parse(result[i].json)}var objectName=result[i].object;var jStore=new Ext.data.JsonStore({fields:[{name:"api"},{name:"dn",sortType:Ext.data.SortTypes.asUCString}],data:sData,sortInfo:{field:"dn",direction:"ASC"}});var objectRec=new masterObjectFieldRecord({objectApi:objectName,fieldStore:jStore});if(masterObjectFieldList.find("objectApi",objectName)<0){masterObjectFieldList.add(objectRec)}if(isOnload){doRestOfTheRendering();isOnload=false}renderFieldCombo(objectName)}if(result.length==0){doRestOfTheRendering();isOnload=false}},{escape:false})}function saveDone(a){if(a=="success"){Ext.MessageBox.show({width:250,title:lblGlobalSearchTitle,msg:lblSaveSucessfully,buttons:Ext.MessageBox.OK})}else{Ext.MessageBox.show({width:250,title:lblGlobalSearchTitle,msg:lblSaveError+a,buttons:Ext.MessageBox.OK})}var b=Ext.getCmp("saveId");b.enable();if(!enablesavebtn){Ext.getCmp("saveId").setDisabled(true)}}function onclickGetArticleDisable(){document.getElementById("searchBtn").disabled=true;document.getElementById("searchBtn").className="AddButtonOff"}function onclickGetArticleEnable(){document.getElementById("searchBtn").disabled=false;document.getElementById("searchBtn").className="AddButton"}function ManageArticlePopup(){var c="ManageArticleTypes";var a=820;var b=550;openPopupWithTitle(c,null,lblManageArticle,b,a)};