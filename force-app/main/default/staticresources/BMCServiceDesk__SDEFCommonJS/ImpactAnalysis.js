var impactedCiStore;var linkedCiStore;var ImpactPanelPageSize=Ext.util.Cookies.get("ImpactPanelPageSize")?parseInt(Ext.util.Cookies.get("ImpactPanelPageSize")):10;var CiPanelPageSize=Ext.util.Cookies.get("CiPanelPageSize")?parseInt(Ext.util.Cookies.get("CiPanelPageSize")):10;function OpenHelppage(){if(wikiUrl!=null&&typeof(wikiUrl)!="undefined"&&isNewContextpage()&&wikiUrl!=""){window.open(wikiUrl,false,"width="+screen.width+",height="+screen.height+",resizable = 1,scrollbars=yes,status=1,top=0,left=0",false)}else{window.open(helpResource+"/"+filename+".htm",false,"width="+screen.width+",height="+screen.height+",resizable = 1,scrollbars=no,status=1,top=0,left=0",false)}}Ext.onReady(function(){fetchImpactedCIs()});function renderTopGrid(){getFieldsAndColumns();var a=getInitialRecords(linkedCi);normalizeReferenceData(a);Ext.define("CiModel",{extend:"Ext.data.Model",fields:fields});linkedCiStore=Ext.create("Ext.data.JsonStore",{model:"CiModel",data:a,proxy:{type:"memory",reader:{type:"json"}}});Ext.define("Pagingtop",{extend:"Ext.PagingToolbar",handleRefresh:Ext.emptyFn,doRefresh:function(){cipanelfirst()},moveNext:function(){cipanelnext()},moveLast:function(){cipanellast()},movePrevious:function(){cipanelprevious()},moveFirst:function(){cipanelfirst()},getPageData:function(){return{total:linkedCIcount,currentPage:cipanelcurrentPage,pageCount:cipaneltotalPages,fromRecord:cipanelfromRec,toRecord:cipaneltoRec}},displayMsg:labels.Records+" {0} - {1} "+labels.LabelOf+" {2}"});var c=Ext.create("Pagingtop",{id:"CiPanelPagingbar",store:linkedCiStore,dock:"bottom",padding:"0 0 0 10",displayInfo:true,emptyMsg:labels.NoRecordFoundMsg,refreshText:labels.PageRefresh,nextText:labels.PageNext,firstText:labels.PageFirst,lastText:labels.PageLast,prevText:labels.PagePrevious,beforePageText:labels.Page,afterPageText:labels.Of,inputItemWidth:40,cls:"PagingToolbarClass",listeners:{beforechange:function(h,f,e){var d=c.getPageData();var g=parseInt(c.child("#inputItem").getActionEl().dom.value);if(g>d.pageCount){g=d.pageCount}else{if(g<=0){g=1}}cipanelsetCurrentPage(CiPanelPageSize,g);return false},afterrender:function(d){d.items.get(2).el.setStyle("margin","0px 15px 0px 5px");d.items.get(6).el.setStyle("margin","0px 5px 0px 15px");d.child("#first").el.setStyle("margin-right","15px");d.child("#last").el.setStyle("margin-left","15px")}}});c.child("#first").setIconCls("d-icon-angles_left");c.child("#prev").setIconCls("d-icon-angle_left");c.child("#next").setIconCls("d-icon-angle_right");c.child("#last").setIconCls("d-icon-angles_right");c.child("#refresh").setIconCls("d-icon-restart");c.child("#first").setWidth(15);c.child("#prev").setWidth(15);c.child("#next").setWidth(15);c.child("#last").setWidth(15);c.child("#refresh").setWidth(30);c.child("#refresh").addCls("bmc-btn-refresh");c.setLoading(false,[]);var b=Ext.create("Ext.grid.Panel",{alias:"widget.cipanel",name:"cipanel",id:"cipanelId",columnLines:false,height:250,singleSelect:true,border:true,forceFit:true,stripeRows:true,store:linkedCiStore,renderTo:"gridSpace",columns:columns,listeners:{cellclick:function(k,l,i,g,m,j,h){Ext.getCmp("analyzeImpactButton").enable();Ext.getCmp("ciExplorerButton").enable();if(Ext.getCmp("impactpanelId")){var d=Ext.getCmp("impactpanelId").getSelectionModel(),f=d.getSelection();if(f!=""){d.deselectAll()}}}},dockedItems:[{xtype:"toolbar",dock:"top",height:40,items:[{xtype:"button",id:"analyzeImpactButton",text:labels.AnalyzeImpact,tooltipType:"title",tooltip:labels.AnalyzeImpact,disabled:true,baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",handler:function(){var e=Ext.getCmp("cipanelId").getSelectionModel(),d=e.getSelection();if(d!=""){val=Ext.String.htmlDecode(d[0].get("Name"));getImpactedCIs(val)}}},{xtype:"tbspacer",width:15},{xtype:"button",id:"ciExplorerButton",text:labels.CMDBLaunchCIExplorer,tooltipType:"title",tooltip:labels.CMDBLaunchCIExplorer,disabled:true,baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",handler:function(){flag=1;var d=Ext.getCmp("cipanelId").getSelectionModel().getSelection();if(d!=""){val=d[0].get("Id");getSelectedRecId(val)}else{if(Ext.getCmp("impactpanelId")){d=Ext.getCmp("impactpanelId").getSelectionModel().getSelection();if(d!=""){val=d[0].get("Id");getSelectedRecId(val)}}}}},{xtype:"tbspacer",width:15},{xtype:"button",id:"attachToCRButton",text:labels.AttachimpactedCIstochangerequest,tooltipType:"title",tooltip:labels.AttachimpactedCIstochangerequest,disabled:true,baseCls:"bmc-btn-small",disabledCls:"bmc-btn-disabled",focusCls:"bmc-btn-focus",overCls:"bmc-btn-over",pressedCls:"bmc-btn-pressed",handler:function(){if(Ext.getCmp("impactpanelId")){attachCSVToCR()}}},"->",{xtype:"label",html:'<a href="#" onclick="OpenHelppage();"><span style="font-size: 16px;cursor:pointer" title="'+labels.Help+'" id="helpImpactAnalysisList" class="d-icon-question_circle"></a>'}]},c]});b.child("[dock=bottom]").add(["->",{text:labels.RecordsPerPage,xtype:"label"},Ext.create("Ext.form.ComboBox",{store:Ext.create("Ext.data.Store",{fields:["value","label"],data:[{value:10,label:"10"},{value:25,label:"25"},{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"}]}),queryMode:"local",displayField:"label",valueField:"value",margin:"4 15 4 8",editable:false,forceSelection:true,typeAhead:true,width:60,listeners:{afterrender:function(){var d=Ext.util.Cookies.get("CiPanelPageSize");if(d){this.setValue(parseInt(d))}else{this.setValue(CiPanelPageSize)}cipanelsetCurrentPage(CiPanelPageSize,1)},change:function(i,h,e,g){if(typeof(e)!="undefined"&&e!=null){var d=new Date();var f=new Date(d.getTime()+365*24*60*60*1000);document.cookie="CiPanelPageSize="+h+";path=/;SameSite=None;Secure;expires="+f;CiPanelPageSize=h;CiPanelcurrentPage=1;cipanelsetCurrentPage(CiPanelPageSize,CiPanelcurrentPage)}}}})])}Ext.EventManager.onWindowResize(function(){resizePanels()});function resizePanels(){var b={};var a;var d;var c;b.width=Ext.getBody().getViewSize().width;b.height=Ext.getBody().getViewSize().height;gridtop=Ext.getCmp("cipanelId");if(typeof(gridtop)!="undefined"){a=(b.height-40)*0.298;d=((a-82)/23.25);gridtop.setSize(b.width-30,a)}gridbottom=Ext.getCmp("impactpanelId");if(isFromCILauncher){if(typeof(gridbottom)!="undefined"){a=(b.height)-35;heightgrid2=a;c=((a-81)/15);gridbottom.setSize(b.width-30,a)}}else{if(typeof(gridbottom)!="undefined"){a=(b.height-40)*0.657;heightgrid2=a;c=((a-81)/21);gridbottom.setSize(b.width-30,a)}}changePageSizes(d,c)}function disableButtons(){var b=Ext.getCmp("cipanelId").getSelectionModel(),a=b.getSelection();if(a.length==0){if(Ext.getCmp("impactpanelId")){b=Ext.getCmp("impactpanelId").getSelectionModel(),a=b.getSelection();if(a.length==0){Ext.getCmp("analyzeImpactButton").disable();Ext.getCmp("ciExplorerButton").disable()}}else{Ext.getCmp("analyzeImpactButton").disable();Ext.getCmp("ciExplorerButton").disable()}}}function normalizeReferenceData(c){var b=[];for(var g=0;g<ColumnsOrderedList.length;g++){var e=ColumnsOrderedList[g];if(e.indexOf(".")!=-1){var a=e.split(".");b.push({name:e,outerProp:a[0],innerProp:a[1]})}}for(var g=0;g<c.length;g++){for(var d=0;d<b.length;d++){var f=b[d];if(c[g][f.outerProp]==null){c[g][f.outerProp]={};c[g][f.outerProp][f.innerProp]=null}}}}function getInitialRecords(d){var m=null;var e=null;for(var f=0;f<d.length;f++){e=d[f];var l=false;for(var c in InitColumns){l=false;m=InitColumns[c];var b=e[c];if(m.type.toLowerCase()=="date"||m.type.toLowerCase()=="datetime"){if(typeof(b)!="undefined"&&b!=null){var a=Ext.Date.parse(b,"c");if(typeof(a)!="undefined"&&a!=null){var k=a.getTimezoneOffset();var g=a.getTime();var h=g+(k*60000);var j=new Date(h+offset);e[c]=Ext.Date.format(j,"time")}}}if(typeof(b)!="undefined"&&b!=null&&b!=""){e[c]=Ext.String.htmlEncode(e[c])}}}return d}function getFieldsAndColumns(){for(var e=0;e<ColumnsOrderedList.length;e++){var d=ColumnsOrderedList[e];var a=InitColumns[d];var c=a.type.toLowerCase().trim();if(c=="date"||c=="datetime"){fields.push({type:"date",dateFormat:"time",name:d});columns.push({header:Ext.util.Format.htmlEncode(a.label),type:"date",flex:1,renderer:Ext.util.Format.dateRenderer(ExtUserDateFormat),sortable:false,dataIndex:d})}else{if(c=="boolean"){fields.push(d);var b=('<tpl for="."><img  src="'+imageHelp+'/SDEFicons/checkbox_<tpl if="'+d+'==true">checked</tpl><tpl if="'+d+'==false">unchecked</tpl>.gif" ></tpl>');columns.push({text:Ext.util.Format.htmlEncode(a.label),xtype:"templatecolumn",tpl:b,flex:1})}else{if(d=="Name"||d=="name"){fields.push(d);columns.push({header:Ext.util.Format.htmlEncode(a.label),flex:1,dataIndex:d,sortable:true,tooltipType:"title",tooltip:Ext.util.Format.htmlEncode(a.label),renderer:function(g,h,f){return Ext.String.format('<a href="/apex/'+namespace+"CMDBManager?cmdbRecordId="+f.data.Id+'" target="_blank">{0}</a>',g)}})}else{if(d.indexOf("Class__c")>-1){fields.push(d);columns.push({header:Ext.util.Format.htmlEncode(a.label),flex:1,dataIndex:d,sortable:false,hidden:true,tooltipType:"title",tooltip:Ext.util.Format.htmlEncode(a.label)})}else{fields.push(d);columns.push({header:Ext.util.Format.htmlEncode(a.label),flex:1,dataIndex:d,sortable:false,tooltipType:"title",tooltip:Ext.util.Format.htmlEncode(a.label)})}}}}}fields.push("Id")}function populateImpactedCiList(){var a=275;if(isFromCILauncher){getFieldsAndColumns();a=525}var b=getInitialRecords(impactedCi);normalizeReferenceData(b);Ext.define("ImpactModel",{extend:"Ext.data.Model",fields:fields});impactedCiStore=Ext.create("Ext.data.JsonStore",{model:"ImpactModel",data:b,sorters:[{property:"Name",direction:"ASC",}],sortOnLoad:false,proxy:{type:"memory",reader:{type:"json"}}});if(!isFromCILauncher){if(impactedCiStore.getCount()!=0){Ext.getCmp("attachToCRButton").enable()}else{Ext.getCmp("attachToCRButton").disable()}}Ext.define("Pagingbottom",{extend:"Ext.PagingToolbar",handleRefresh:Ext.emptyFn,doRefresh:function(){first()},moveNext:function(){next()},moveLast:function(){last()},movePrevious:function(){previous()},moveFirst:function(){first()},getPageData:function(){return{total:totalRecords,currentPage:currentPage,pageCount:totalPages,fromRecord:fromRec,toRecord:toRec}},displayMsg:labels.Records+" {0} - {1} "+labels.LabelOf+" {2}"});var d=Ext.create("Pagingbottom",{store:impactedCiStore,dock:"bottom",padding:"0 0 0 10",displayInfo:true,emptyMsg:labels.NoRecordFoundMsg,refreshText:labels.PageRefresh,nextText:labels.PageNext,firstText:labels.PageFirst,lastText:labels.PageLast,prevText:labels.PagePrevious,beforePageText:labels.Page,afterPageText:labels.Of,inputItemWidth:40,cls:"PagingToolbarClass",listeners:{beforechange:function(i,g,f){var e=d.getPageData();var h=parseInt(d.child("#inputItem").getActionEl().dom.value);if(h>e.pageCount){h=e.pageCount}else{if(h<=0){h=1}}impactpanelsetCurrentPage(ImpactPanelPageSize,h);return false},afterrender:function(e){e.items.get(2).el.setStyle("margin","0px 15px 0px 5px");e.items.get(6).el.setStyle("margin","0px 5px 0px 15px");e.child("#first").el.setStyle("margin-right","15px");e.child("#last").el.setStyle("margin-left","15px")}}});d.child("#first").setIconCls("d-icon-angles_left");d.child("#prev").setIconCls("d-icon-angle_left");d.child("#next").setIconCls("d-icon-angle_right");d.child("#last").setIconCls("d-icon-angles_right");d.child("#refresh").setIconCls("d-icon-restart");d.child("#first").setWidth(15);d.child("#prev").setWidth(15);d.child("#next").setWidth(15);d.child("#last").setWidth(15);d.child("#refresh").setWidth(30);d.child("#refresh").addCls("bmc-btn-refresh");d.setLoading(false,[]);var c=Ext.create("Ext.grid.Panel",{alias:"widget.impactpanel",name:"impactpanel",id:"impactpanelId",columnLines:false,height:a,singleSelect:false,border:true,forceFit:true,stripeRows:true,store:impactedCiStore,renderTo:"ImpactGridSpace",viewConfig:{deferEmptyText:false,emptyText:'<div style="margin-top: 13%;  margin-left: 45%;">'+labels.NoRecordFoundMsg+"</div>"},tbar:[{xtype:"tbspacer"},{xtype:"radiogroup",width:650,id:"checkbox",columns:[150,150],fieldLabel:labels.Show,labelAlign:"left",labelWidth:30,listeners:{change:function(e,j,h,i){var g=j.show;var f=h.show;if(typeof(g)!="undefined"&&typeof(f)!="undefined"){if(g=="Business Services Only"){checkFilter(1)}else{if(g=="All Configuration Items"){checkFilter(0)}}}}},items:[{xtype:"radiofield",name:"show",width:250,padding:"0 0 0 15",checked:true,boxLabel:labels.CIsAndAssets,inputValue:"All Configuration Items"},{xtype:"radiofield",name:"show",width:350,boxLabel:labels.BusinessServicesOnly,inputValue:"Business Services Only"}]}],columns:columns,listeners:{sortchange:function(f,g,h,e){sort(ImpactPanelPageSize)},cellclick:function(l,m,j,h,n,k,i){if(!isFromCILauncher){Ext.getCmp("ciExplorerButton").enable();var f=Ext.getCmp("cipanelId").getSelectionModel(),g=f.getSelection();if(g!=""){f.deselectAll()}}}},dockedItems:[d]});c.child("[dock=bottom]").add(["->",{text:labels.RecordsPerPage,xtype:"label"},Ext.create("Ext.form.ComboBox",{store:Ext.create("Ext.data.Store",{fields:["value","label"],data:[{value:10,label:"10"},{value:25,label:"25"},{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"}]}),queryMode:"local",displayField:"label",valueField:"value",margin:"4 15 4 8",editable:false,forceSelection:true,typeAhead:true,width:60,listeners:{afterrender:function(){var e=Ext.util.Cookies.get("ImpactPanelPageSize");if(e){this.setValue(parseInt(e))}else{this.setValue(ImpactPanelPageSize)}},change:function(j,i,f,h){if(typeof(f)!="undefined"&&f!=null){var e=new Date();var g=new Date(e.getTime()+365*24*60*60*1000);document.cookie="ImpactPanelPageSize="+i+";path=/;SameSite=None;Secure;expires="+g;ImpactPanelPageSize=i;currentPage=1;impactpanelsetCurrentPage(ImpactPanelPageSize,currentPage)}}}})])}function loadDataGrid1(){finallinkedCIs=getInitialRecords(linkedCi);normalizeReferenceData(finallinkedCIs);linkedCiStore.loadRawData(finallinkedCIs);disableButtons()}function loadDataGrid2(){finalrecords=getInitialRecords(impactedCi);normalizeReferenceData(finalrecords);impactedCiStore.loadRawData(finalrecords);disableButtons()}function attachmentSuccessful(){var a=excMessage;if(typeof(a)=="undefined"||a==null||a==""){a=labels.ImpactedCIsAttachmentMessage}GetMessageBox("bmc-message").show({title:impactAnalysis,msg:a,buttons:Ext.Msg.OK});window.opener.refreshRelatedLists()}function GetMessageBox(a){if(typeof(WinMsg)=="undefined"||WinMsg==null){WinMsg=Ext.create("Ext.window.MessageBox")}WinMsg.baseCls=a;return WinMsg};