var lookupFieldStore,selectFieldStore,FilerListViewStore,filterId,CriteriaViewStore,criteriaGrid,comparisonOperator,pickListArray=[],pickListComboStore,pickListComboBx,booleanComboStore,booleanComboBx,booleanArray=[{id:"True",val:LookupFilter.Labels.labelTrue},{id:"False",val:LookupFilter.Labels.labelFalse}],popUpString="",onCompleteFunction,popUpWindow,lookupFieldCombo,ciFilter,selectFieldCombo,fieldValueStore,selectedTextAreaLength,apiName,label,type,isNew,isDeleted,picklistStr,OfferingClause,lookupId,CancelFlag,tempArray=[],waitMsg;var isIE11=window.location.hash=!!window.MSInputMethodContext;Ext.onReady(function(){createCriteriaGrid();if(CriteriaGridData!=null&&CriteriaGridData!=""&&typeof(CriteriaGridData)!="undefined"){isnew=false}else{isnew=true}FilterTypeObj=getFilterTypeObj();if(FilterTypeObj!=null){FilterTypeObj.remove(0)}buildCriteriaCondtions();getWaitbox();document.getElementById(formId).style.display="";document.getElementById("AddBtnId").disabled=true;criteriaGrid.doComponentLayout();changeSaveBtnStatus();hideLoadingMask()});function afterSave(){isNew=false;isDeleted=false}function reloadCriteriaGrid(){if(msgStr==SavedSuccessfully){var a=document.getElementById("DelCriteriaBtnId");a.setAttribute("disabled","disabled");setAddUpdateOnClick(false);clearCriteriaFields();CriteriaViewStore.loadData(CriteriaGridData);FilterTypeObj=getFilterTypeObj();if(FilterTypeObj!=null){FilterTypeObj.remove(0)}}}function encoderecord(b,a){return Ext.util.Format.htmlEncode(b)}function createCriteriaGrid(){Ext.define("CriteriaModel",{extend:"Ext.data.Model",fields:[{name:"Id",type:"string"},{name:"Criterion",type:"string"},{name:"fieldName",type:"string"},{name:"fieldAPIName",type:"string"},{name:"Operator",type:"string"},{name:"FieldValue",type:"string"},{name:"value",type:"string"},{name:"valueAPI",type:"string"},{name:"valueDataType",type:"string"}]});CriteriaViewStore=Ext.create("Ext.data.Store",{model:"CriteriaModel",data:CriteriaGridData,proxy:{type:"memory",reader:{idProperty:"Id",type:"json",root:"attributes"}}});var a=Ext.create("Ext.data.Store",{fields:["abbr","name","toolTip"],data:[{abbr:"clientCI",name:clientCI,toolTip:clientCIToolTip},{abbr:"clientAccount",name:clientAccount,toolTip:clientAccountToolTip},{abbr:"allCI",name:allCI,toolTip:allCIToolTip}]});ciFilter=Ext.create("Ext.form.field.ComboBox",{id:"ciFilter",store:a,queryMode:"local",valueField:"abbr",displayField:"name",typeAhead:true,mode:"local",emptyText:"",renderTo:"ciFilterInputField",selectOnFocus:true,multiSelect:true,value:ciFilterValArr,editable:false,triggerAction:"all",width:220,listConfig:{maxHeight:400,getInnerTpl:function(e){var c;var d=Ext.getCmp("ciFilter").getValue();c='<tpl> <div class="slds-form-element" onclick = "toggleComboBoxCheckbox(\'{abbr}\')">  <div class="slds-form-element__control">    <div class="slds-checkbox">      <input type="checkbox" name="ChkBoxGrp" id="{abbr}" value="{name:htmlEncode}"  title="{toolTip:htmlEncode}" {[loadCIFilterDefaultValues(values.abbr)]} />      <div class="slds-checkbox__label slds-truncate" for="{abbr}">        <span id="span{abbr}" class="slds-checkbox_faux"></span>		 <span class="slds-form-element__label"  title="{name:htmlEncode}"  title="{toolTip:htmlEncode}"> {name:htmlEncode} </span>      </div>    </div>  </div></div></tpl>';return c},listeners:{select:function(e,d){selectedValues=d.data.abbr;var c=document.querySelectorAll("#"+selectedValues);if(c&&c!=[]){for(i=0;i<c.length;i++){c[i].checked=true;checkUncheckCIFilter(selectedValues,c[i],true)}}},boxready:function(f,e,c,d){b(f)},beforeshow:function(d,c){b(d)}}}});function b(f){var c=f.store.data.items;if(c){for(i=0;i<c.length;i++){var e=c[i].data.id;var d=document.querySelectorAll("#span"+e);if(d&&d.length!=0){for(j=0;j<d.length;j++){if(ciFilter.multiSelect!=true){d[j].style.display="none"}else{d[j].style.display="inline-block"}}}else{break}}}}criteriaGrid=Ext.create("Ext.grid.Panel",{id:"criteriaGrid",renderTo:"criteriaGrid",width:"99.9%",height:Ext.isIE?300:isIE11?300:307,stripeRows:true,forceFit:true,border:false,store:CriteriaViewStore,autoScroll:true,queryMode:"local",columns:[{id:"1",width:1,text:"Id",hidden:true,menuDisabled:true,dataIndex:"Id",sortable:false},{id:"criterionId",flex:0.1,renderer:"htmlEncode",text:LookupFilter.Labels.Criterion,menuDisabled:true,dataIndex:"Criterion",sortable:false},{id:"fieldnameId",flex:0.3,renderer:"htmlEncode",text:fulfillmentCriteria=="true"?BEObjLabel+": "+LookupFilter.Labels.FieldName:LookupFilter.Labels.FieldName,menuDisabled:true,dataIndex:"fieldName",sortable:false},{id:"fieldAPINameId",flex:0.3,renderer:"htmlEncode",text:LookupFilter.Labels.FieldName,menuDisabled:true,dataIndex:"fieldAPIName",hidden:true,sortable:false},{id:"operatorId",flex:0.125,renderer:"htmlEncode",text:LookupFilter.Labels.Operator,menuDisabled:true,dataIndex:"Operator",sortable:false},{id:"fieldValueId",flex:0.125,text:LookupFilter.Labels.Operator,menuDisabled:true,dataIndex:"FieldValue",hidden:true,sortable:false},{id:"opvalueId",flex:0.3,text:LookupFilter.Labels.operandValue,menuDisabled:true,dataIndex:"value",renderer:"htmlEncode",sortable:false},{id:"opvalueAPIId",flex:0.3,renderer:"htmlEncode",text:LookupFilter.Labels.operandValue,menuDisabled:true,dataIndex:"valueAPI",hidden:true,sortable:false},{id:"opvalueDataTypeId",flex:0.3,renderer:"htmlEncode",text:LookupFilter.Labels.operandValue,menuDisabled:true,dataIndex:"valueDataType",hidden:true,sortable:false}],listeners:{itemclick:function(d,c,e,h,g){lookupFieldCombo.reset();if(lookupFieldStore.find("label",c.get("fieldName").trim())<=-1){Ext.getCmp("compareOpCombo").reset();selectFieldCombo.reset();openCriteriaDeleteMessage();setAddUpdateOnClick(false)}else{var f=document.getElementById("DelCriteriaBtnId");f.removeAttribute("disabled");populateCriteriaFields(c);setAddUpdateOnClick(true)}}}})}function buildCriteriaCondtions(){lookupFieldStore=Ext.create("Ext.data.Store",{id:"lookupFieldStore",data:fieldStr,fields:["id","type","label","e"],sorters:[{property:"label",direction:"ASC"}]});lookupFieldCombo=Ext.create("Ext.form.field.ComboBox",{id:"lookupFieldCombo",store:lookupFieldStore,queryMode:"local",valueField:"id",displayField:"label",renderTo:"lookupFieldCombo",typeAhead:true,width:270,emptyText:LookupFilter.Labels.FilterFor,matchFieldWidth:false,listConfig:{width:270},tpl:'<tpl for="."><div class="x-boundlist-item">{label:htmlEncode}</div></tpl>',listeners:{select:function(e,c,b){comparisonOperator.store.removeAll();var a=c[0].get("type");if(a.indexOf(":")>0){a=a.split(":")[0]}else{if(a.indexOf(EF)>0){a=a.split(EF)[0]}}apiName=c[0].get("id");label=c[0].get("label");type=c[0].get("type");setAddBtnStatus();setComparisonOperatorStore(a);var d="";if(fulfillmentCriteria=="true"){d=fieldValueOperator.getValue()}if(d=="Value"||d==""){setVisibilityData(apiName,label,type)}if(type=="picklist"){showWaitbox();getPicklistValues(apiName)}}}});if(fulfillmentCriteria=="true"){selectFieldStore=Ext.create("Ext.data.Store",{id:"selectFieldStore",data:ConsolefieldStr,fields:["id","type",{name:"label",convert:encoderecord},"e"],sorters:{property:"label",direction:"ASC"}});selectFieldCombo=Ext.create("Ext.form.field.ComboBox",{id:"selectFieldCombo",store:selectFieldStore,queryMode:"local",triggerAction:"all",valueField:"id",displayField:"label",selectOnFocus:true,renderTo:"selectFieldCombo",editable:false,width:215,listWidth:200,height:22,matchFieldWidth:false,emptyText:LookupFilter.Labels.Console,getDisplayValue:function(){if(this.displayTplData!=null&&this.displayTplData.length>0){this.displayTplData[0].label=Ext.String.htmlDecode(this.displayTplData[0].label);return this.displayTplData[0].label}},listConfig:{width:215},listeners:{select:function(c,b,a){setAddBtnStatus()}}});fieldValueStore=Ext.create("Ext.data.Store",{id:"fieldValueStore",data:[{fieldValue:"Field",fieldName:LookupFilter.Labels.labelField},{fieldValue:"Value",fieldName:LookupFilter.Labels.labelValue}],fields:["fieldValue","fieldName"]});fieldValueOperator=Ext.create("Ext.form.field.ComboBox",{id:"fieldValueCombo",store:fieldValueStore,queryMode:"local",triggerAction:"all",valueField:"fieldValue",displayField:"fieldName",selectOnFocus:true,renderTo:"fieldValueCombo",typeAhead:true,typeAheadDelay:5,editable:true,width:65,listWidth:120,height:13,listConfig:{minWidth:65},listeners:{select:function(e,c,b){var a=e.getValue();if(a=="Field"){Ext.getCmp("selectFieldCombo").show();pickListComboBx.setVisible(false);setVisibilityData("none","none","none")}else{Ext.getCmp("selectFieldCombo").hide();if(apiName!=null&&typeof(apiName)!="undefined"&&label!=null&&typeof(label)!="undefined"&&type!=null&&typeof(type)!="undefined"){setVisibilityData(apiName,label,type);if(type=="picklist"){pickListComboBx.setVisible(true)}document.getElementById("AddBtnId").disabled=false}else{var d=getInputTxtEle();if(d!=null&&d!="undefined"){d.style.display="inline"}}}}}});fieldValueOperator.setValue(fieldValueOperator.store.getAt(0).get("fieldName"));if(fieldValueOperator.store.getAt(0).get("fieldValue")=="Field"){Ext.getCmp("selectFieldCombo").show()}else{Ext.getCmp("selectFieldCombo").hide()}}compStore.text=[["=","="],["!=","!="],["LIKE","LIKE"],["NOT LIKE","NOT LIKE"]];compStore.phone=[["=","="],["!=","!="]];compStore.currency=[["=","="],["!=","!="],[">",">"],[">=",">="],["<","<"],["<=","<="]];compStore.percent=[[">",">"],[">=",">="],["=","="],["!=","!="],["<","<"],["<=","<="]];compStore.number=[[">",">"],[">=",">="],["=","="],["!=","!="],["<","<"],["<=","<="]];compStore.booleanVar=[["=","="],["!=","!="]];compStore.email=[["=","="],["!=","!="],["LIKE","LIKE"],["NOT LIKE","NOT LIKE"]];compStore.reference=[["=","="],["!=","!="]];compStore.dateTime=[[">",">"],[">=",">="],["=","="],["!=","!="],["<","<"],["<=","<="]];compStore.textArea=[["LIKE","LIKE"],["NOT LIKE","NOT LIKE"]];compStore.picklist=[["=","="],["!=","!="]];comparisonOperator=Ext.create("Ext.form.field.ComboBox",{id:"compareOpCombo",store:compStore.text,queryMode:"local",renderTo:"compareOpDiv",valueField:"comOpeValue",displayField:"comOpeName",editable:false,width:120,listWidth:85,height:13,emptyText:labelOperator,listeners:{select:function(c,b,a){setAddBtnStatus()}}});booleanComboStore=Ext.create("Ext.data.Store",{id:"booleanFieldStore",data:booleanArray,fields:["id","val"]});booleanComboBx=Ext.create("Ext.form.field.ComboBox",{id:"booleanFieldCombo",store:booleanComboStore,queryMode:"local",triggerAction:"all",valueField:"id",displayField:"val",value:"True",selectOnFocus:true,editable:false,renderTo:"booleanCombo",hidden:true,width:165,listWidth:165});pickListComboStore=Ext.create("Ext.data.Store",{id:"pickListFieldStore",data:pickListArray,fields:["id","val"],sorters:{property:"val",direction:"ASC"}});pickListComboBx=Ext.create("Ext.form.field.ComboBox",{id:"pickListFieldCombo",store:pickListComboStore,queryMode:"local",valueField:"id",displayField:"val",editable:false,renderTo:"picklistCombo",tpl:'<tpl for="." ><li role="option" class="x-boundlist-item">{val:htmlEncode}</li></tpl>',hidden:true,width:165,listWidth:165})}function populateCriteriaFields(a){lookupFieldCombo.reset();lookupFieldCombo.setValue(a.get("fieldAPIName"));if(fulfillmentCriteria=="true"){fieldValueOperator.setValue(a.get("FieldValue"))}apiName=a.get("fieldAPIName");label=a.get("fieldName");type=a.get("valueDataType");if(type.indexOf(":")>0){selectedTextAreaLength=type.split(":")[1];type=type.split(":")[0]}else{if(type.indexOf(EF)>0){popUpString=type.split(EF)[1];type=type.split(EF)[0]}}setComparisonOperatorStore(type);comparisonOperator.setValue(a.get("Operator"));if(fulfillmentCriteria=="true"&&a.get("FieldValue")=="Field"){Ext.getCmp("selectFieldCombo").show();selectFieldCombo.setValue(a.get("valueAPI"));setVisibilityData("none","none","none")}else{if(fulfillmentCriteria=="true"){Ext.getCmp("selectFieldCombo").hide()}elementVal=Ext.util.Format.htmlDecode(a.get("value"));opVal=a.get("Operator");if(type=="picklist"){showWaitbox();elementVal=a.get("valueAPI");tempArray=[apiName,label,type,elementVal,opVal];getPicklistValues(apiName)}else{setVisibilityData(apiName,label,type,elementVal,opVal)}}}function upadateCriteriaGrid(){var a=criteriaGrid.getView().getSelectionModel().getSelection()[0];addUpdateCriteriaGrid(a)}function setAddUpdateOnClick(a){var d=document.getElementById("AddBtnId");var c=document.getElementById("UpdateBtnId");var b=document.getElementById("DelCriteriaBtnId");if(a){c.style.display="inline";c.style.visibility="visible";d.style.display="none";d.style.visibility="hidden";b.removeAttribute("disabled")}else{c.style.display="none";c.style.visibility="hidden";d.style.display="inline";d.style.visibility="visible";b.setAttribute("disabled","disabled")}}function addUpdateCriteriaGrid(e){var m=CriteriaViewStore.data.length;var n=lookupFieldCombo.getValue();var f="Value";var b=lookupFieldCombo.getRawValue();if(fulfillmentCriteria=="true"){f=fieldValueOperator.getValue()}var o,c;if(n==null||n==""||typeof(n)=="undefined"){showExtMsg(LookupFilter.Labels.SelectFieldErrMsg);return}var g=comparisonOperator.getValue();if(g==null||g==""||typeof(g)=="undefined"){showExtMsg(LookupFilter.Labels.SelectCompOpMessage);return}var k,l,h,a;if(fulfillmentCriteria=="true"&&f=="Field"){k=selectFieldCombo.getValue();if(k==null||k==""||typeof(k)=="undefined"){showExtMsg(LookupFilter.Labels.EnterValMsg);return}l=selectFieldCombo.getRawValue();h=selectFieldCombo.findRecordByValue(k);a=h.get("type");o=lookupFieldCombo.findRecordByValue(n);c=o.get("type");if(a!=c){if(c=="text"||(a=="text"&&c=="textarea")||(a=="textarea"&&c=="text")){}else{if((a=="datetime"&&c=="date")||(a=="date"&&c=="datetime")){if(a=="datetime"&&c=="date"){a=c}}else{if((a.indexOf("reference")!=-1)&&c.indexOf("reference")==-1){a=a.substring(0,9)}else{if((c.indexOf("reference")!=-1)&&a.indexOf("reference")==-1){c=c.substring(0,9)}}var q=LookupFilter.Labels.CompatibleErrorMsg;var s=a.substr(0,1).toUpperCase()+a.substr(1);q=q.replace("{0}",s);q=q.replace("{1}",c);showExtMsg(q);return}}}}else{h=lookupFieldCombo.findRecordByValue(n);a=h.get("type");if(a.indexOf(":")>0){a=a.split(":")[0]}else{if(a.indexOf(EF)>0){a=a.split(EF)[0]}}if(a=="text"||a=="phone"||a=="currency"||a=="email"||a=="percent"||a=="number"||a=="reference"){var r=getInputTxtEle();if(r!=null&&r!="undefined"){k=l=r.value}if(a=="reference"){var d=document.getElementById("referenceID");if(d!=null&&d!="undefined"){refId=d.value;if(refId!=null&&refId!=""){k=refId}else{if(e!=null&&e!=""&&e!="undefined"){k=e.get("valueAPI")}}}}}else{if(a=="reference"){l=booleanComboBx.getValue();k=booleanComboBx.getRawValue()}else{if(a=="boolean"){l=booleanComboBx.getValue();k=booleanComboBx.getRawValue()}else{if(a.indexOf("textarea")!=-1){var p=getInputTextAreaEle();if(p!=null&&p!="undefined"){k=l=p.value}}else{if(a=="picklist"){l=pickListComboBx.getRawValue();k=pickListComboBx.getValue()}else{if(a=="datetime"){k=l=getDateTimeInputEle().value}else{if(a=="date"){k=l=getDateInputEle().value}}}}}}}}if(a.indexOf("reference")!=-1&&c=="text"){dataType=c}else{dataType=a}if(e==null||e=="undefined"||typeof(e)=="undefined"){CriteriaViewStore.add(new CriteriaModel({Id:"newId",Criterion:m+1,fieldName:b,fieldAPIName:n,Operator:g,FieldValue:f,value:Ext.util.Format.htmlDecode(l),valueAPI:k,valueDataType:dataType}));clearCriteriaFields();CancelFlag=true;setLogicalStatement()}else{e.set("fieldName",b);e.set("fieldAPIName",n);e.set("Operator",g);e.set("FieldValue",f);e.set("value",Ext.util.Format.htmlDecode(l));e.set("valueAPI",k);e.set("valueDataType",dataType);e.commit();CancelFlag=true;clearCriteriaFields()}setAddUpdateOnClick(false);criteriaGrid.getSelectionModel().clearSelections();document.getElementById("AddBtnId").disabled=true;changeSaveBtnStatus()}if(typeof(SDEDateFormat)=="undefined"||SDEDateFormat==null||SDEDateFormat==""){this.SDEDateFormat="m/d/Y h:i A"}FilterDatePickerPopup=function(){};FilterDatePickerPopup.prototype={dateFormat:SDEDateFormat,Show:function(c){var a=Ext.get(c);var h=new Ext.DatePicker({startDay:1,listeners:{select:function(n,m){a.dom.value=Ext.Date.format(m,SDEDateFormat);var e=a.dom.id;if(e.indexOf("inputDate")>0){var k=document.getElementById(e).value;var l=k.split(" ");a.dom.value=l[0].replace(",","")}dataModifiedFlag=1;a=null;f.close()}}});try{var d=Date.parseDate(this.TextField.dom.value,this.dateFormat);h.setValue(d)}catch(g){}var b=a.getRegion();var f=new Ext.Window({x:b.right-175,y:b.top-1,bodyStyle:"background-color:#FFFFFF;",cls:"RFAdminWindow whiteBackgroud",animCollapse:true,modal:true,autoHeight:true,width:200,layout:"fit",frame:false,closable:false,tools:[{id:"rfclose",handler:function(l,k,e){f.close()}}],closeAction:"destroy"});f.add(h);h.winHandle=f;f.show()}};var _datePicker=new FilterDatePickerPopup();function setCriteriaID(a){if(msgStr==SavedSuccessfully){if(fulfillmentCriteria=="true"){parent.LKfilterId=filterObjId;var b=parent.document.getElementById("PopupLink");if(typeof(b.innerText)!="undefined"){b.innerText=LookupFilter.Labels.LabelEdit}else{b.textContent=LookupFilter.Labels.LabelEdit}if(typeof(parent.document)!="undefined"&&parent.document!=null){parent.document.getElementById("CriteriaText").value=QueryCondition;parent.document.getElementById("DeleteLink").style.display="inline-block";parent.document.getElementById("CriteriaText").style.width="83.5%"}}else{window.parent.setLookupCriteriaID(filterObjId,filterObjName)}}}function deleteFromCriteriaGrid(){var a=LookupFilter.Labels.DeleteConfirmMessage;var b=Ext.create("Ext.window.MessageBox");b.baseCls="bmc-message";b.show({msg:a,width:300,buttons:Ext.MessageBox.YESNO,fn:function(c){if(c=="yes"){deleteCriteria()}},icon:Ext.MessageBox.WARNING})}function deleteCriteria(){var c=criteriaGrid.getView().getSelectionModel().getSelection()[0];if(c){CriteriaViewStore.remove(c)}var a=CriteriaViewStore.data.length;for(var b=0;b<a;b++){var e=CriteriaViewStore.getAt(b);e.set("Criterion",b+1);e.commit()}var d=document.getElementById("DelCriteriaBtnId");d.setAttribute("disabled","disabled");setAddUpdateOnClick(false);clearCriteriaFields();CancelFlag=true;isDeleted=true;setLogicalStatement()}function openCriteriaDeleteMessage(){Ext.Msg.show({title:LookupFilter.Labels.lblInvalidCondition,msg:LookupFilter.Labels.lblErrorMsgEncryptedFldInCondition,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR,fn:function(a){if(a=="ok"){deleteCriteria()}}})}function closePopupRF(){if(popUpWindow!=null&&popUpWindow!=undefined){popUpWindow.close()}}function openQualLookup(){var e="";var g=(screen.width-1000)/2;var f=parseInt((screen.height/2)-(600/2))-50;if(popUpString=="BMC BaseElement"){popUpString="BMC_BaseElement"}else{if(popUpString=="User"||popUpString=="Group"){e="SearchAndLink?txt=selectlookupValues&parentName=SRM_RequestDefinition__c&filterId=active_user&childName="+popUpString+"&isLookUp=true&NewLookUpType=&searchLookUpStr=&isCustomLookup=false&isSRD=true&lightningUI=true"}else{if(popUpString=="SYSTemplate__c"){var a=LookupObj;if(a!=null&&typeof(a)!="undefined"){var d=(a=="Incident__c"?"temp_in":(a=="Change_Request__c"?"temp_cr":(a=="Task__c"?"temp_ta":"")));if(d){e="SearchAndLink?txt=selectlookupValues&parentName=SRM_RequestDefinition__c&childName="+popUpString+"&isLookUp=true&NewLookUpType=&filterId=active_custom&addlFilterId="+d+"&searchLookUpStr=&isCustomLookup=false&isSRD=true&lightningUI=true"}}}else{if(popUpString=="BMC_BaseElement__c"){var c=lookupFieldCombo.getValue();var b=lookupFieldCombo.findRecordByValue(c);if(b!=null&&typeof(b)!="undefined"){selectedValueId=b.get("id")}if(selectedValueId=="FKLocation__c"){e="SearchAndLink?txt=selectlookupValues&parentName=SRM_RequestDefinition__c&childName="+popUpString+"&isLookUp=true&NewLookUpType=&filterId=active_custom&addlFilterId=bmc_location&searchLookUpStr=&isCustomLookup=false&isSRD=true&lightningUI=true"}else{e="SearchAndLink?txt=selectlookupValues&parentName=SRM_RequestDefinition__c&childName="+popUpString+"&isLookUp=true&NewLookUpType=&filterId=active_custom&searchLookUpStr=&isCustomLookup=false&isSRD=true&lightningUI=true"}}else{if(popUpString=="BMC_BusinessService__c"){e="SearchAndLink?txt=selectlookupValues&parentName=SRM_RequestDefinition__c&childName="+popUpString+"&isLookUp=true&NewLookUpType=&filterId=active_custom&searchLookUpStr=&isCustomLookup=false&isSRD=true&lightningUI=true&isSRDServiceLookup=true"}else{if(popUpString=="BMC_ServiceOffering__c"){OfferingClause=escape("(serviceType__c = 'Offering')");e="SearchAndLink?txt=selectlookupValues&parentName=SRM_RequestDefinition__c&childName=BMC_BusinessService__c&isLookUp=true&NewLookUpType=&filterId=active_custom&searchLookUpStr=&isCustomLookup=false&isSRD=true&lightningUI=true&addlFilterId=flat_offering&isSRDServiceLookup=true"}else{if(popUpString=="ConsoleLayoutDetail__c"){var a=LookupObj;if(a!=null&&typeof(a)!="undefined"){var d=(a=="Incident__c"?"console_in":(a=="Change_Request__c"?"console_cr":(a=="Task__c"?"console_ta":"")));if(d){e="SearchAndLink?txt=selectlookupValues&parentName=SRM_RequestDefinition__c&childName="+popUpString+"&isLookUp=true&NewLookUpType=&filterId=active_custom&addlFilterId="+d+"&searchLookUpStr=&isCustomLookup=false&isSRD=true&lightningUI=true"}}}else{if(popUpString=="Contact"){e="SearchAndLink?txt=selectlookupValues&parentName=SRM_RequestDefinition__c&childName="+popUpString+"&isLookUp=true&NewLookUpType=&searchLookUpStr=&isCustomLookup=false&isSRD=true&lightningUI=true"}else{e="SearchAndLink?txt=selectlookupValues&parentName=SRM_RequestDefinition__c&childName="+popUpString+"&isLookUp=true&NewLookUpType=&filterId=active_custom&searchLookUpStr=&isCustomLookup=false&isSRD=true&lightningUI=true"}}}}}}}}if(e){window.open(e,"__blank","status = 1,height =600, width = 1000,left="+g+",top="+f+",resizable = 0,scrollbars=yes")}}function setPopUpVar(a){if(a!=null&&a!=""&&onCompleteFunction!=null){onCompleteFunction(a)}}function openPopup(c,d,a,b){return openPopupTitle(c,d,a,b,"")}function openPopupTitle(d,e,a,c,b){onCompleteFunction=e;if(a!=null&&c!=null){popUpWindow=Ext.create("Ext.Window",{height:a,width:c,x:10,y:5,modal:true,resizable:false,constrain:true,viewConfig:{forceFit:true},html:'<iframe frameborder="0" src ="/apex/'+d+'" style="width:100%;height:100%;border:none"/>'});popUpWindow.show()}else{popUpWindow=Ext.create("Ext.Window",{height:550,width:670,x:10,y:5,modal:true,resizable:false,constrain:true,viewConfig:{forceFit:true},html:'<iframe frameborder="0" src ="/apex/'+d+'" style="width:100%;height:100%;border:none"/>',tools:[{id:"lookuppm",handler:function(){if(window.frames[0].document.getElementById("lookupdataval").value){var f=window.frames[0].document.getElementById("lookupdataval").value}var g=new Ext.QuickTip({target:this,title:"",anchor:"right",width:200,shadow:"sides",bodyStyle:"font: 8pt Tahoma, Verdana, Arial; color:black;width:2%;border-color:black;",dismissDelay:1500000,html:f});g.show()}}]});popUpWindow.show()}}function setReferenceToVal(b){if(b.indexOf(EF)>0){referenceId=b.split(EF)[0];referenceName=b.split(EF)[1]}referenceName=decodeVal(referenceName);var a=getInputTxtEle();if(a!=null&&typeof(a)!="undefined"){a.value=referenceName;var c=document.getElementById("referenceID");if(c!=null&&typeof(c)!="undefined"){c.value=referenceId}}}function decodeVal(a){a=a.replace("&gt;",">","g");a=a.replace("&lt;","<","g");a=a.replace("&quot;",'"',"g");a=a.replace("&amp;","&","g");return a}function clearCriteriaFields(){lookupFieldCombo.setValue("");comparisonOperator.setValue("");if(fulfillmentCriteria=="true"){fieldValueOperator.setValue(fieldValueOperator.store.getAt(0).get("fieldName"));selectFieldCombo.setValue("");Ext.getCmp("selectFieldCombo").show()}Ext.getCmp("criteriaGrid").getSelectionModel().deselectAll();var a=document.getElementById("referenceID");if(a!=null&&a!="undefined"){a.value=null}if(fulfillmentCriteria=="true"){setVisibilityData("none","none","none")}else{setVisibilityData("none","none","text")}}function setCancelFlagAfterSave(){if(msgStr==SavedSuccessfully){CancelFlag=false}}function showExtMsg(b){var a;if(b){a=b}else{a=msgStr}if(a==SavedSuccessfully){valueSetToastPoUp(a,"success")}else{valueSetToastPoUp(a,"error")}}function getPickListOptions(a){var b=picklistStr.split(DZHE);return b}function setPickListOptions(c){var d=Ext.getCmp("pickListFieldCombo");if(d!=null){var e=getPickListOptions(c);pickListArray=[];for(var b=0;b<e.length;b++){if(e[b]!=""){var a=e[b].split(EF);pickListArray.push({id:a[1],val:a[0]})}}pickListComboStore.loadData(pickListArray);pickListComboBx.setValue(pickListComboStore.first().get("id"));if(tempArray!=null&&tempArray.length>0){setVisibilityData(tempArray[0],tempArray[1],tempArray[2],tempArray[3],tempArray[4]);tempArray=[]}}}function getWaitbox(){waitMsg=new Ext.LoadMask(Ext.getBody(),{msg:LookupFilter.Labels.PleaseWait,id:"waitMsggId"})}function showWaitbox(){showLoadingMask()}function hideWaitbox(){hideLoadingMask()}function setCriteriaGridData(){var a="";var d=0;while(CriteriaViewStore.data.length>d){if(fulfillmentCriteria=="true"){a=a+CriteriaViewStore.getAt(d).get("Criterion")+nonPrint+CriteriaViewStore.getAt(d).get("fieldAPIName")+nonPrint+CriteriaViewStore.getAt(d).get("Operator")+nonPrint+CriteriaViewStore.getAt(d).get("FieldValue")+nonPrint+CriteriaViewStore.getAt(d).get("value")+nonPrint+CriteriaViewStore.getAt(d).get("valueAPI")+nonPrint+CriteriaViewStore.getAt(d).get("valueDataType")+nonPrint+CriteriaViewStore.getAt(d).get("Id")+PE_NEW}else{a=a+CriteriaViewStore.getAt(d).get("Criterion")+nonPrint+CriteriaViewStore.getAt(d).get("fieldAPIName")+nonPrint+CriteriaViewStore.getAt(d).get("Operator")+nonPrint+"value"+nonPrint+CriteriaViewStore.getAt(d).get("value")+nonPrint+CriteriaViewStore.getAt(d).get("valueAPI")+nonPrint+CriteriaViewStore.getAt(d).get("valueDataType")+nonPrint+CriteriaViewStore.getAt(d).get("Id")+PE_NEW}d++}var b=getCriteriaGridStrEle();b.value=a;var c=getCIFilterSelectEle();c.value=Ext.getCmp("ciFilter").getValue()}function isValidLogicalStatement(c){temporaryArray=[];temporaryArray=c.match(/(-?\d[\d\.\*]*)/g);if(temporaryArray!=null&&temporaryArray.length>0){for(i=0;i<temporaryArray.length;i++){if(temporaryArray[i]>CriteriaViewStore.data.length||temporaryArray[i]<=0){hideWaitbox();showExtMsg(LookupFilter.Labels.FilterLogicValidation);return false}}}if(c!=null&&c.trim().length==1&&parseInt(c.trim())==1){return true}var a=/\(\s*[+-]?\d+(?:(?:\s+AND\s+[+-]?\d+)+|(?:\s+OR\s+[+-]?\d+)+)\s*\)/ig;var b=/^\s*[+-]?\d+(?:(?:\s+AND\s+[+-]?\d+)+|(?:\s+OR\s+[+-]?\d+)+)\s*$/ig;while(c.search(a)!==-1){c=c.replace(a,"0")}if(c.search(b)===0){return true}else{hideWaitbox();showExtMsg(LookupFilter.Labels.FilterLogicValidation)}return false}function setLogicalStatement(){var b=criteriaGrid.store;var f=b.data.length;var a=" ";for(var d=0;d<f;d++){var e=CriteriaViewStore.getAt(d);var c=e.get("Criterion");if(d!=f-1){a=a+c+" AND "}else{a=a+c}if(a.length>255){CriteriaViewStore.remove(e);showExtMsg(LookupFilter.Labels.FilterLogicLimitExceeded);return}}getFilterLogicObj().value=a}function checkValidLogic(){var b=temporaryArray.toString();for(i=0;i<CriteriaViewStore.data.length;i++){var c=CriteriaViewStore.getAt(i);var a=c.get("Criterion");if(b.indexOf(a)==-1){return true}}return false}function checkForEncryptedOrDeletedField(){lookupFieldCombo.reset();var a=CriteriaViewStore.data.length;for(var b=0;b<a;b++){var c=CriteriaViewStore.getAt(b);if(lookupFieldStore.find("label",c.get("fieldName").trim())<=-1){hideWaitbox();Ext.MessageBox.alert(LookupFilter.Labels.lblInvalidCondition,LookupFilter.Labels.lblQVEncryptionError);return false}}return true}function callSave(){if(!checkForEncryptedOrDeletedField()){return}setCriteriaGridData();var c=getFilterLogicObj();var b=isValidLogicalStatement(c.value);if(b){var a=checkValidLogic();if(a){Ext.MessageBox.show({msg:LookupFilter.Labels.FilterLogicAddCriteriaValidation,width:310,buttons:Ext.Msg.YESNO,fn:function(d){if(d=="yes"){checkIfLkfIsUsed()}},icon:Ext.MessageBox.WARNING})}else{if(isDeleted&&(temporaryArray.length==CriteriaViewStore.data.length)){Ext.MessageBox.show({msg:LookupFilter.Labels.FilterLogicModifyCriteriaValidation,width:310,buttons:Ext.Msg.YESNO,fn:function(d){if(d=="yes"){checkIfLkfIsUsed()}else{isDeleted=false}},icon:Ext.MessageBox.WARNING})}else{checkIfLkfIsUsed()}}}changeSaveBtnStatus()}function checkIfLkfIsUsed(){if(isLkfUsed&&LKfilterId!=""){showSaveConfirmation()}else{showWaitbox();save()}}function showSaveConfirmation(){var e=Ext.create("Ext.form.Radio",{boxLabel:LookupFilter.Labels.changeFilterOption,name:"saveOption",inputValue:"change",id:"radio1",checked:true});var d=Ext.create("Ext.form.Radio",{boxLabel:LookupFilter.Labels.createNewfilterOption,name:"saveOption",inputValue:"createNew",id:"radio2"});var b=Ext.create("Ext.form.TextField",{id:"lkfNameField",fieldLabel:"",emptyText:LookupFilter.Labels.filtername,name:"lkfNameField",value:"",listeners:{focus:function(g,f){g.emptyText=[""];g.applyEmptyText()}},style:{paddingLeft:"15px"}});var c=new Ext.FormPanel({id:"optionsForm",frame:false,border:false,bodyStyle:"padding:15px 15px 0",layout:"anchor",defaults:{anchor:"100%"},autoHeight:true,autWidth:true,items:[e,d,b,{xtype:"tbspacer",height:"10px"}]});var a=Ext.create("Ext.window.Window",{title:LookupFilter.Labels.saveAs,autoHeight:true,width:400,layout:"fit",modal:"true",resizable:false,items:[c],dockedItems:[{xtype:"toolbar",dock:"bottom",style:{paddingLeft:"10px",backgroundColor:"#DEE0E0",},items:[{xtype:"button",cls:"rf-btn",text:ExtjsMessageOK,minWidth:30,handler:function(){if(Ext.getCmp("radio1").getValue()){showWaitbox();save();a.close()}else{if(Ext.getCmp("radio2").getValue()){if(b&&b.getValue()!=""){clearIDsForFilterCriteria();var f=getFilterNameEle();f.value=b.getValue();showWaitbox();setCriteriaGridData();save("true");a.close()}else{showExtMsg(LookupFilter.Labels.filterNameRequired)}}}}},{xtype:"button",text:Cancel,cls:"rf-btn",style:{marginLeft:"2px",},handler:function(){a.close()}}]}]});a.show();a.center()}function setComparisonOperatorStore(a){if(a.indexOf(":")>0){a=a.split(":")[0]}else{if(a.indexOf(EF)>0){a=a.split(EF)[0]}}if(a=="reference"){comparisonOperator.store.loadData(compStore.reference)}else{if(a=="datetime"){comparisonOperator.store.loadData(compStore.dateTime)}else{if(a=="date"){comparisonOperator.store.loadData(compStore.dateTime)}else{if(a=="textarea"){comparisonOperator.store.loadData(compStore.textArea)}else{if(a=="text"){comparisonOperator.store.loadData(compStore.text)}else{if(a=="phone"){comparisonOperator.store.loadData(compStore.phone)}else{if(a=="currency"){comparisonOperator.store.loadData(compStore.currency)}else{if(a=="percent"){comparisonOperator.store.loadData(compStore.percent)}else{if(a=="number"){comparisonOperator.store.loadData(compStore.number)}else{if(a=="boolean"){comparisonOperator.store.loadData(compStore.booleanVar)}else{if(a=="email"){comparisonOperator.store.loadData(compStore.email)}else{if(a=="picklist"){comparisonOperator.store.loadData(compStore.picklist)}}}}}}}}}}}}comparisonOperator.reset()}function setVisibilityData(b,c,e,a,d){isInList=false;var f=fieldStr.length;selectedApiName=b;selectedLabel=c;if(isInList==false){if(e.indexOf(":")>0){selectedTextAreaLength=e.split(":")[1];e=e.split(":")[0]}else{if(e.indexOf(EF)>0){popUpString=e.split(EF)[1];if(b=="FKBusinessService__c"){popUpString="BMC_BusinessService__c"}else{if(b=="FKServiceOffering__c"){popUpString="BMC_ServiceOffering__c"}}e=e.split(EF)[0]}}if(e=="text"){assignVisibility("inline","none","none","none","none","none","none",null,1,a)}else{if(e=="phone"){assignVisibility("inline","none","none","none","none","none","none",null,10,a)}else{if(e=="currency"){assignVisibility("inline","none","none","none","none","none","none",null,11,a)}else{if(e=="percent"){assignVisibility("inline","none","none","none","none","none","none",null,9,a)}else{if(e=="email"){assignVisibility("inline","none","none","none","none","none","none",null,8,a)}else{if(e=="number"){assignVisibility("inline","none","none","none","none","none","none",null,7,a)}else{if(e=="boolean"){assignVisibility("none","none","none","inline","none","none","none",null,2,a)}else{if(e=="textarea"){assignVisibility("none","inline","none","none","none","none","none",null,3,a)}else{if(e=="picklist"){assignVisibility("none","none","none","none","inline","none","none",null,4,a)}else{if(e=="reference"){assignVisibility("inline","none","inline","none","none","none","none",b,5,a)}else{if(e=="reference1"){assignVisibility("inline","none","inline1","none","none","none","none",b,6,a)}else{if(e=="datetime"){assignVisibility("none","none","none","none","none","inline-block","none",null,12,a)}else{if(e=="date"){assignVisibility("none","none","none","none","none","none","inline-block",null,13,a)}else{if(e=="none"){assignVisibility("none","none","none","none","none","none","none",null,13,a)}}}}}}}}}}}}}}}if(d!=null&&d!="undefined"){comparisonOperator.setValue(d)}}function assignVisibility(h,r,o,m,d,b,s,c,n,g){var e=getInputTxtEle();var t=getInputTextAreaEle();var f=getDateTimeInputEle();var l=getDateTimePickerImg();var p=getDateInputEle();var q=getDatePickerImg();var u=getLookupEle();var a=Ext.getCmp("booleanFieldCombo");var k=document.getElementById("inputTxtAreaButtonEle");var v=Ext.getCmp("pickListFieldCombo");if(e!=null&&typeof(e)!="undefined"){e.style.display=h;if(h=="inline"&&g!=null&&g!="undefined"){e.value=g}else{e.value=""}e.disabled=false}if(t!=null&&typeof(t)!="undefined"){t.style.display=r;if(k!=null&&typeof(k)!="undefined"){if(r=="inline"){k.style.display="inline-block"}else{k.style.display="none"}if(r=="inline"&&g!=null&&g!="undefined"){t.value=g}else{t.value=""}}}if(f!=null&&typeof(f)!="undefined"){f.style.display=b;if(l!=null&&typeof(l)!="undefined"){l.style.display=b}if(b=="inline-block"&&g!=null&&g!="undefined"){f.value=g}else{f.value=""}}if(p!=null&&typeof(p)!="undefined"){p.style.display=s;if(q!=null&&typeof(q)!="undefined"){q.style.display=s}if(s=="inline-block"&&g!=null&&g!="undefined"){p.value=g}else{p.value=""}}if(a!=null&&typeof(a)!="undefined"){if(m=="inline"){a.setVisible(true)}else{a.hide()}if(m=="inline"&&g!=null&&g!=""&&g!="undefined"){a.setValue(g)}}if(v!=null&&typeof(v)!="undefined"){if(d=="inline"){v.setVisible(true)}else{v.hide();v.reset()}if(d=="inline"&&g!=null&&g!=""&&g!="undefined"){v.setValue(g)}}if(o=="inline"){if(u!=null&&typeof(u)!="undefined"){u.disabled=false;u.style.visibility="visible";u.style.display="inline"}if(g!=null&&g!="undefined"){e.disabled=g}e.disabled=true;popUpEnable=true}else{if(u!=null&&typeof(u)!="undefined"){u.style.visibility="hidden";u.style.display="none";u.disabled=true}}if(o=="inline1"){u.style.display="none";e.disabled=true;e.value="";popUpEnable=true}compTypeNo=n}function callCancel(){if(CancelFlag==true){Ext.MessageBox.show({title:LookupFilter.Labels.Cancel,msg:LookupFilter.Labels.CloseWindowLabel,width:310,buttons:Ext.Msg.OKCANCEL,fn:cancelHandler,icon:Ext.MessageBox.WARNING,closable:true,draggable:false,shadow:false,bodyBorder:false});CancelFlag=false}else{if(fulfillmentCriteria=="true"){parent.popUpWindow.close()}else{parent.rfPopUpClose("rfModalVFPage")}}return false}var cancelHandler=function(a,b){if(a==="ok"){if(fulfillmentCriteria=="true"){parent.popUpWindow.close()}else{parent.rfPopUpClose("rfModalVFPage")}}return};function isDataChanged(){CancelFlag=true}function clearIDsForFilterCriteria(){CriteriaViewStore.each(function(a){a.set("Id","newId")})}function setAddBtnStatus(){var a=lookupFieldCombo.getValue();var b=comparisonOperator.getValue();var e="";if(fulfillmentCriteria=="true"){e=fieldValueOperator.getValue()}var d=true;if(e=="Field"){var c=selectFieldCombo.getValue();if(a!=""&&a!=null&&b!=""&&b!=null&&c!=""&&c!=null){d=false}}else{if(a!=""&&a!=null&&b!=""&&b!=null){d=false}}document.getElementById("AddBtnId").disabled=d}function changeSaveBtnStatus(){var a=document.getElementById("SaveBtnId");if(CriteriaViewStore.data.length>0){a.disabled=false}else{a.disabled=true}}function valueSetToastPoUp(a,e){var d=getElementValue("rfToastPopop");var c=getElementValue("mainContentToastPopup");var b=getElementValue("themeToastPopup");var f=getElementValue("themeIconPopup");if(d&&d.style.display=="none"){d.style.display="block";if(b&&f&&e=="success"){if(b.classList.contains("slds-theme_info")){b.classList.remove("slds-theme_info")}else{if(b.classList.contains("slds-theme_error")){b.classList.remove("slds-theme_error")}else{if(b.classList.contains("slds-theme_warning")){b.classList.remove("slds-theme_warning")}}}if(!b.classList.contains("slds-theme_success")){b.classList.add("slds-theme_success");f.classList.add("sucessIcon")}}if(b&&f&&e=="error"){if(b.classList.contains("slds-theme_info")){b.classList.remove("slds-theme_info")}else{if(b.classList.contains("slds-theme_success")){b.classList.remove("slds-theme_success")}else{if(b.classList.contains("slds-theme_warning")){b.classList.remove("slds-theme_warning")}}}if(!b.classList.contains("slds-theme_error")){b.classList.add("slds-theme_error");f.classList.add("errorIcon")}}c.innerText=a;setTimeout(function(){rfPopUpClose("rfToastPopop")},3000)}}function rfPopUpClose(a){var b=document.getElementById(a);if(b&&b.style.display=="block"){b.style.display="none"}};