var root;var tree;var OpRuleTreePopUpWindow;var height=490;var width=700;var forAcAction;var selectedNode;var CancleButton;var OkButton;var tabOutImg;var WinMsg;var isPopupFromAcAction,selectedDevice;var closePopUpWindow=function(a,b){OpRuleTreePopUpWindow.close()};function initParentPageDetails(){var b=String(window.parent.parent);if(typeof(b)!="undefined"&&b!=""){b=window.parent.parent.location.pathname;var a=b.indexOf("apex/AcActions");if(a!=-1){isPopupFromAcAction=true}}}function handleOpRulesFromAcAction(b,a,c){selectedDevice=window.parent.parent.cntxAssemblyId;if(selectedDevice!=null&&selectedDevice!=""&&selectedDevice.indexOf("AC:CS:-")==0){window.parent.startWaitMask();applyAction(b,a,c,selectedDevice)}else{window.parent.msgStr=window.parent.AcInvalidDeviceMsg;window.parent.ShowMessageBox()}}function hideWaitMsg(){if(typeof(waitMsg)!="undefined"&&waitMsg!=null&&waitMsg!=""){waitMsg.hide()}}function waitbox(a){if(parseInt(a)>0){setTimeout("waitMsg.hide()",a)}waitMsg=new Ext.LoadMask(Ext.getBody(),{floating:{shadow:false},msgCls:"d-loader-container",msg:'<ul class="d-loading"><li class="d-loading__stick d-loading__stick_1"></li><li class="d-loading__stick d-loading__stick_2"></li><li class="d-loading__stick d-loading__stick_3"></li><li class="d-loading__stick d-loading__stick_4"></li><li class="d-loading__stick d-loading__stick_5"></li><li class="d-loading__stick d-loading__stick_6"></li><li class="d-loading__stick d-loading__stick_7"></li><li class="d-loading__stick d-loading__stick_8"></li><li class="d-loading__stick d-loading__stick_9"></li><li class="d-loading__stick d-loading__stick_10"></li><li class="d-loading__stick d-loading__stick_11"></li><li class="d-loading__stick d-loading__stick_12"></li></ul><div>'+pleasewait+"</div>"});if(typeof(waitMsg)!="undefined"&&waitMsg!=null&&waitMsg!=""){waitMsg.show()}}function openOpRuleLookup(){root=Ext.create("Ext.data.TreeStore",{proxy:{type:"ajax",url:page_CMDBJsonGenerator+"?type=getAssetCoreOpRules"},root:{id:"0",expanded:true,},listeners:{load:function(c,h,b,g,e){if(h.hasChildNodes()==true){for(var d=0;d<h.childNodes.length;d++){if(h.childNodes[d].raw.error==true){var f=h.childNodes[d].raw.text;h.childNodes[d].remove(true);GetMessageBox("bmc-message").show({msg:f,buttons:Ext.MessageBox.OK,fn:closePopUpWindow,title:errTitle})}}}},beforeload:function(c,b,d){}}});var a=height-80;if(typeof(window.parent)!="undefined"&&window.parent.Ext.getCmp("AdvActionPanel")){a=window.parent.Ext.getCmp("AdvActionPanel").getHeight()-60}tree=new Ext.tree.TreePanel({id:"OpRuleTree",store:root,useArrows:true,autoScroll:true,animate:true,containerScroll:true,border:false,rootVisible:false,height:a,animCollapse:true,listeners:{beforeload:function(){if(isPopupFromAcAction){var b=window.parent.location.pathname;var c=b.indexOf("apex/ACDeviceSummaryPage");if(c==-1){this.setSize("auto",window.parent.AdvActionPanel.getHeight()-73)}else{this.setSize("auto",window.parent.ORPanelHeight-100)}}},afterrender:function(b){},itemdblclick:function(h,i,d,b,g,c){if(i.data.leaf){selectedNode=i;var f=selectedNode.raw.text;if(selectedNode.raw.notes!=null&&selectedNode.raw.notes!=""){f+=":"+selectedNode.raw.notes}if(isPopupFromAcAction){handleOpRulesFromAcAction(selectedNode.raw.id,selectedNode.raw.approval,f)}else{waitbox(0);applyAction(selectedNode.raw.id,selectedNode.raw.approval,f)}}},itemclick:function(g,h,d,b,f,c){if(h.data.leaf){selectedNode=h}else{selectedNode=null}}}});OkButton=new Ext.Button({id:"OkBtn",text:okBtnLabel,xtype:"tbbutton",cls:"windowBtnCls",handler:function(){if(selectedNode!=null&&selectedNode!="undefined"){if(selectedNode!=null&&typeof(selectedNode)!="undefined"){var b=selectedNode.raw.text;if(selectedNode.raw.notes!=null&&selectedNode.raw.notes!=""){b+=":"+selectedNode.raw.notes}if(isPopupFromAcAction){handleOpRulesFromAcAction(selectedNode.raw.id,selectedNode.raw.approval,b)}else{waitbox(0);applyAction(selectedNode.raw.id,selectedNode.raw.approval,b)}}}else{if(isPopupFromAcAction){window.parent.msgStr=selectORError;window.parent.ShowMessageBox()}else{GetMessageBox("bmc-message").show({msg:selectORError,buttons:Ext.MessageBox.OK})}}}});CancleButton=new Ext.Button({id:"CancleBtn",text:cancelBtnLabel,xtype:"tbbutton",cls:"windowBtnCls",handler:function(){if(isPopupFromAcAction){window.parent.AdvActionPanel.collapse()}else{window.close()}}})}function showORWindow(){openOpRuleLookup();OpRuleTreePopUpWindow=new Ext.Window({title:label_SelectOpRule,height:height,width:width,x:10,y:5,modal:true,resizable:true,constrain:true,viewConfig:{forceFit:true},items:tree,buttonAlign:"right",cls:"TextEditorWindowCls",buttons:[OkButton,CancleButton]});OpRuleTreePopUpWindow.show();tree.getRootNode().expand();return false}function stopWaitMask(){window.parent.stopWaitMask()}function resizetree(){var a=window.parent.parent.Ext.getBody().getViewSize().height;tree.setSize("auto",a-135)}if(window.parent.parent.setTreePanelHeight!=undefined){window.parent.parent.setTreePanelHeight(resizetree)}function GetMessageBox(a){if(WinMsg==null){WinMsg=Ext.create("Ext.window.MessageBox")}WinMsg.baseCls=a;return WinMsg};