Ext.ns("Ext.ux.form");Ext.define("Ext.ux.form.ItemSelector",{extend:"Ext.ux.form.MultiSelect",alias:["widget.itemselectorfield","widget.itemselector"],alternateClassName:["Ext.ux.ItemSelector"],requires:["Ext.button.Button","Ext.ux.form.MultiSelect"],hideNavIcons:false,buttons:["add","remove"],buttonsText:{top:"Move to Top",up:"Move Up",add:"Add to Selected",remove:"Remove from Selected",down:"Move Down",bottom:"Move to Bottom"},layout:{type:"hbox",align:"stretch"},initComponent:function(){var a=this;a.ddGroup=a.id+"-dd";a.callParent();a.bindStore(a.store)},createList:function(c,a){var b=this;return Ext.create("Ext.ux.form.MultiSelect",{submitValue:false,getSubmitData:function(){return null},getModelData:function(){return null},flex:1,title:c,store:{model:b.store.model,data:[]},displayField:b.displayField,valueField:b.valueField,disabled:b.disabled,width:215,listConfig:{tpl:Ext.create("Ext.XTemplate",'<ul><tpl for=".">','<tpl if="xindex == 1 || this.getGroupStr(parent[xindex - 2]) != this.getGroupStr(values)">','<li class="x-combo-list-group" style="padding-top: 8px; padding-left: 6px;"><b>{[Ext.util.Format.htmlEncode(this.getGroupStr(values))]}</b></li>',"</tpl>",'<li title= "{[this.getTitle(values)]}" role="option" class="x-boundlist-item" style="padding-left: 12px">{[Ext.util.Format.htmlEncode(this.getFieldText(values))]}</li>',"</tpl></ul>",{getGroupStr:function(d){if(!a){return""}else{return objNames[d.objectName]}},getFieldText:function(d){return d.text},getTitle:function(d){if(!a&&objNames[d.objectName]){return Ext.util.Format.htmlEncode(objNames[d.objectName]+": "+d.text)}else{return Ext.util.Format.htmlEncode(d.text)}}})},listeners:{boundList:{scope:b,itemdblclick:b.onItemDblClick,drop:b.syncValue,itemclick:function(l,h,n,i,j,k){if(l===this.toField.boundList){var f=h.get("width");var d=h.get("text");selectedRec=h;document.getElementById(colWidth).value=f;RemedyForceHTMLProcessor.setText(document.getElementById(fieldName),d);document.getElementById(colWidth).disabled=false;b.initBtnStyle();var g=b.getSelections(b.fromField.boundList);if(g==""){addBtn.setIconCls("bmcDisableButtonArrowMoveRight")}remBtn.setIconCls("bmcButtonArrowMoveLeft");if(i==0){topBtn.setIconCls("bmcDisableButtonArrowMoveTop");upBtn.setIconCls("bmcDisableButtonArrowUp");btmBtn.setIconCls("bmcButtonArrowMoveBottom");downBtn.setIconCls("bmcButtonArrowDown")}else{if(i==l.store.data.length-1){topBtn.setIconCls("bmcButtonArrowMoveTop");upBtn.setIconCls("bmcButtonArrowUp");btmBtn.setIconCls("bmcDisableButtonArrowMoveBottom");downBtn.setIconCls("bmcDisableButtonArrowDown")}else{topBtn.setIconCls("bmcButtonArrowMoveTop");upBtn.setIconCls("bmcButtonArrowUp");btmBtn.setIconCls("bmcButtonArrowMoveBottom");downBtn.setIconCls("bmcButtonArrowDown")}}if(selectedClassView=="BMC_BaseRelationship"&&h.get("value")=="Name__cфBaseElement"){remBtn.setIconCls("bmcDisableButtonArrowMoveLeft")}}else{if(l===this.fromField.boundList){b.initBtnStyle();var m=b.getSelections(b.toField.boundList);if(m==""){remBtn.setIconCls("bmcDisableButtonArrowMoveLeft")}addBtn.setIconCls("bmcButtonArrowMoveRight")}}},containerclick:function(d,g,f){b.initBtnStyle();if(d===this.toField.boundList){remBtn.setIconCls("bmcDisableButtonArrowMoveLeft");topBtn.setIconCls("bmcDisableButtonArrowMoveTop");upBtn.setIconCls("bmcDisableButtonArrowUp");btmBtn.setIconCls("bmcDisableButtonArrowMoveBottom");downBtn.setIconCls("bmcDisableButtonArrowDown");document.getElementById(colWidth).value="";RemedyForceHTMLProcessor.clearHTML(document.getElementById(fieldName));document.getElementById(colWidth).disabled="disabled"}else{if(d===this.fromField.boundList){addBtn.setIconCls("bmcDisableButtonArrowMoveRight")}}}}}})},initBtnStyle:function(){topBtn=Ext.getCmp("top-id1");upBtn=Ext.getCmp("up-id1");btmBtn=Ext.getCmp("bottom-id1");downBtn=Ext.getCmp("down-id1");addBtn=Ext.getCmp("add-id");remBtn=Ext.getCmp("remove-id")},setupItems:function(){var a=this;a.fromField=a.createList(a.fromTitle,true);a.toField=a.createList(a.toTitle,false);return[a.fromField,{xtype:"container",margins:"15 15",layout:{type:"vbox",pack:"center"},items:a.createButtons()},a.toField,{xtype:"container",margins:"15 15",layout:{type:"vbox",pack:"center"},items:[{xtype:"button",id:"top-id1",iconCls:"bmcDisableButtonArrowMoveTop",margin:"5 0 0 0",listeners:{click:{fn:function(){a.onTopBtnClick()}}}},{xtype:"button",id:"up-id1",iconCls:"bmcDisableButtonArrowUp",margin:"5 0 0 0",listeners:{click:{fn:function(){a.onUpBtnClick()}}}},{xtype:"button",id:"down-id1",iconCls:"bmcDisableButtonArrowDown",margin:"5 0 0 0",listeners:{click:{fn:function(){a.onDownBtnClick()}}}},{xtype:"button",id:"bottom-id1",iconCls:"bmcDisableButtonArrowMoveBottom",margin:"5 0 0 0",listeners:{click:{fn:function(){a.onBottomBtnClick()}}}}]}]},createButtons:function(){var b=this,a=[];if(!b.hideNavIcons){Ext.Array.forEach(b.buttons,function(c){a.push({id:c+"-id",xtype:"button",handler:b["on"+Ext.String.capitalize(c)+"BtnClick"],cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-"+c,navBtn:true,scope:b,margin:"5 0 0 0"})})}return a},getSelections:function(b){var a=b.getStore();return Ext.Array.sort(b.getSelectionModel().getSelection(),function(d,c){d=a.indexOf(d);c=a.indexOf(c);if(d<c){return -1}else{if(d>c){return 1}}return 0})},onTopBtnClick:function(){this.initBtnStyle();var c=this.toField.boundList,a=c.getStore(),b=this.getSelections(c);if(b!=""){topBtn.setIconCls("bmcDisableButtonArrowMoveTop");upBtn.setIconCls("bmcDisableButtonArrowUp");btmBtn.setIconCls("bmcButtonArrowMoveBottom");downBtn.setIconCls("bmcButtonArrowDown")}a.suspendEvents();a.remove(b,true);a.insert(0,b);a.resumeEvents();c.refresh();this.syncValue();c.getSelectionModel().select(b)},onBottomBtnClick:function(){this.initBtnStyle();var c=this.toField.boundList,a=c.getStore(),b=this.getSelections(c);if(b!=""){topBtn.setIconCls("bmcButtonArrowMoveTop");upBtn.setIconCls("bmcButtonArrowUp");btmBtn.setIconCls("bmcDisableButtonArrowMoveBottom");downBtn.setIconCls("bmcDisableButtonArrowDown")}a.suspendEvents();a.remove(b,true);a.add(b);a.resumeEvents();c.refresh();this.syncValue();c.getSelectionModel().select(b)},onUpBtnClick:function(){this.initBtnStyle();var f=this.toField.boundList,b=f.getStore(),e=this.getSelections(f),g,d=0,a=e.length,c=0;if(e!=""){btmBtn.setIconCls("bmcButtonArrowMoveBottom");downBtn.setIconCls("bmcButtonArrowDown")}b.suspendEvents();for(;d<a;++d,c++){g=e[d];if(b.indexOf(g)-1==0){topBtn.setIconCls("bmcDisableButtonArrowMoveTop");upBtn.setIconCls("bmcDisableButtonArrowUp")}c=Math.max(c,b.indexOf(g)-1);b.remove(g,true);b.insert(c,g)}b.resumeEvents();f.refresh();this.syncValue();f.getSelectionModel().select(e)},onDownBtnClick:function(){this.initBtnStyle();var e=this.toField.boundList,a=e.getStore(),d=this.getSelections(e),f,c=d.length-1,b=a.getCount()-1;if(d!=""){topBtn.setIconCls("bmcButtonArrowMoveTop");upBtn.setIconCls("bmcButtonArrowUp")}a.suspendEvents();for(;c>-1;--c,b--){f=d[c];if(a.indexOf(f)+1==b){btmBtn.setIconCls("bmcDisableButtonArrowMoveBottom");downBtn.setIconCls("bmcDisableButtonArrowDown")}b=Math.min(b,a.indexOf(f)+1);a.remove(f,true);a.insert(b,f)}a.resumeEvents();e.refresh();this.syncValue();e.getSelectionModel().select(d)},onAddBtnClick:function(){var g=this,f=g.getSelections(g.fromField.boundList);g.initBtnStyle();if(f!=""){remBtn.setIconCls("bmcButtonArrowMoveLeft")}addBtn.setIconCls("bmcDisableButtonArrowMoveRight");topBtn.setIconCls("bmcButtonArrowMoveTop");upBtn.setIconCls("bmcButtonArrowUp");var d=g.toField.store.getCount();if((d+f.length)>cmdbLstViewLimit){cmdbListViewLimitLabel=cmdbListViewLimitLabel.replace("{0}",cmdbLstViewLimit);alert(cmdbListViewLimitLabel)}else{var b=g.fromField.boundList.getEl().first().dom;var a=b.scrollTop-20;if(a<0){a=0}g.moveRec(true,f);b.scrollTop=a;g.toField.boundList.getSelectionModel().select(f);if(f.length==1){var e=f[0].get("width");var c=f[0].get("text");selectedRec=f[0];document.getElementById(colWidth).value=e;RemedyForceHTMLProcessor.setText(document.getElementById(fieldName),c);document.getElementById(colWidth).disabled=""}}},onRemoveBtnClick:function(){var c=this,b=c.getSelections(c.toField.boundList);c.initBtnStyle();remBtn.setIconCls("bmcDisableButtonArrowMoveLeft");btmBtn.setIconCls("bmcDisableButtonArrowMoveBottom");downBtn.setIconCls("bmcDisableButtonArrowDown");topBtn.setIconCls("bmcDisableButtonArrowMoveTop");upBtn.setIconCls("bmcDisableButtonArrowUp");if(b.length==1&&b[0].get("value")=="Name__cфBaseElement"){return false}else{if(b.length>1){var a=-1;for(var d=0;d<b.length;d++){if(b[d].get("value")=="Name__cфBaseElement"){a=d;break}}if(a>=0){b.splice(a,1)}}}document.getElementById(colWidth).disabled="disabled";document.getElementById(colWidth).value="";RemedyForceHTMLProcessor.clearHTML(document.getElementById(fieldName));if(b!=""){addBtn.setIconCls("bmcButtonArrowMoveRight")}c.moveRec(false,b);c.fromField.boundList.getSelectionModel().select(b)},moveRec:function(k,j){var h=this,l=h.fromField,f=h.toField,b=k?l.store:f.store,g=k?f.store:l.store;b.suspendEvents();g.suspendEvents();b.remove(j);g.add(j);b.resumeEvents();g.resumeEvents();if(!k&&selectedClassView=="BMC_BaseRelationship"){var c=[];var a=[];var e=l.store.data.items;for(var d=0;d<e.length;d++){if(e[d].get("objectName")=="BMC_BaseRelationship__c"){c.push(e[d])}else{if(e[d].get("objectName")=="BMC_BaseElement__c"){a.push(e[d])}}}c.sort(compareTo);a.sort(compareTo);c=c.concat(a);if(c.length>0){l.store.data.items=c}}l.boundList.refresh();f.boundList.refresh();h.syncValue()},syncValue:function(){var a=this;a.mixins.field.setValue.call(a,a.setupValue(a.toField.store.getRange()))},onItemDblClick:function(a,e){if(e.get("value")=="Name__cфBaseElement"){return false}selected=this.getSelections(this.fromField.boundList);var c=this.toField.store.getCount();if(selected.length>0&&(c+selected.length)>cmdbLstViewLimit&&a===this.fromField.boundList){cmdbListViewLimitLabel=cmdbListViewLimitLabel.replace("{0}",cmdbLstViewLimit);alert(cmdbListViewLimitLabel)}else{this.moveRec(a===this.fromField.boundList,e);document.getElementById(colWidth).disabled="disabled";if(a===this.fromField.boundList){this.toField.boundList.getSelectionModel().select(selected);var d=e.get("width");var b=e.get("text");selectedRec=e;document.getElementById(colWidth).value=d;RemedyForceHTMLProcessor.setText(document.getElementById(fieldName),b)}else{this.fromField.boundList.getSelectionModel().select(e);remBtn.setIconCls("bmcDisableButtonArrowMoveLeft");btmBtn.setIconCls("bmcDisableButtonArrowMoveBottom");downBtn.setIconCls("bmcDisableButtonArrowDown");topBtn.setIconCls("bmcDisableButtonArrowMoveTop");upBtn.setIconCls("bmcDisableButtonArrowUp")}}},setValue:function(f){var d=this,g=d.fromField,a=d.toField,b=g.store,e=a.store,c;if(!d.fromStorePopulated){d.fromField.store.on({load:Ext.Function.bind(d.setValue,d,[f]),single:true});return}f=d.setupValue(f);d.mixins.field.setValue.call(d,f);c=d.getRecordsForValue(f);b.suspendEvents();e.suspendEvents();b.removeAll();e.removeAll();d.populateFromStore(d.store);Ext.Array.forEach(c,function(h){if(b.indexOf(h)>-1){b.remove(h)}e.add(h)});b.resumeEvents();e.resumeEvents();Ext.suspendLayouts();g.boundList.refresh();a.boundList.refresh();Ext.resumeLayouts(true)},onBindStore:function(a,b){var c=this;if(c.fromField){c.fromField.store.removeAll();c.toField.store.removeAll();if(a.getCount()){c.populateFromStore(a)}else{c.store.on("load",c.populateFromStore,c)}}},populateFromStore:function(a){var b=this.fromField.store;this.fromStorePopulated=true;b.add(a.getRange());b.fireEvent("load",b)},onEnable:function(){var a=this;a.callParent();a.fromField.enable();a.toField.enable();Ext.Array.forEach(a.query("[navBtn]"),function(b){b.enable()})},onDisable:function(){var a=this;a.callParent();a.fromField.disable();a.toField.disable();Ext.Array.forEach(a.query("[navBtn]"),function(b){b.disable()})},onDestroy:function(){this.bindStore(null);this.callParent()}});