if(typeof(SDEDateFormat)=="undefined"||SDEDateFormat==null||SDEDateFormat==""){this.SDEDateFormat="m/d/Y h:i A"}Ext.Date.useStrict=true;var dataModifiedFlag=0;var cdateFormat="";function getDataModifiedFlag(){return dataModifiedFlag}function setDataModifiedFlag(){dataModifiedFlag=0}function urlencode(a){return encodeURIComponent(a).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}CMDBDatePickerPopup=function(){};CMDBDatePickerPopup.prototype={dateFormat:SDEDateFormat,selectHandler:function(h,f){if(currentTime){var e=new String(f);var g=e.replace("00:00:00",currentTime);var d=new Date(g);this.TextField.dom.value=Ext.Date.format(d,h.format)}else{this.TextField.dom.value=Ext.Date.format(f,h.format)}var a=this.TextField.dom.id;if(a.indexOf("custominputDate")>0){var b=document.getElementById(a).value;var c=b.split(" ");cdateFormat=c[1];this.TextField.dom.value=c[0].replace(",","")}dataModifiedFlag=1;this.TextField=null;h.hide();h.winHandle.close()},Show:function(b){this.TextField=Ext.get(b);var g=new Ext.DatePicker({startDay:1,monthYearText:"",listeners:{select:this.selectHandler.createDelegate(this)}});try{var c=Ext.Date.parse(this.TextField.dom.value,SDEDateFormat);g.setValue(c)}catch(f){}var a=this.TextField.getRegion();var d=new Ext.Window({x:a.right-180,y:a.top-150,cls:"CMDBWindow",animCollapse:true,header:false,modal:true,resizable:false,style:"padding: 0; border-width: 0;",autoWidth:true,layout:"fit",frame:false});d.add(g);g.winHandle=d;d.show();d._checkCloseClick=function(j){try{var h=j.getPageX(),l=j.getPageY(),i=this.getBox();if(h<i.x||h>i.x+i.width||l<i.y||l>i.y+i.height){if(this.rendered){this.mun(Ext.getBody(),"click",this._checkCloseClick,this);this.close()}}}catch(k){}};setTimeout(function(){d.mon(Ext.getBody(),"click",d._checkCloseClick,d)},500)}};var _datePicker=new CMDBDatePickerPopup();function CMDBControl(){this.DisplayName=null;this.ApiName=null;this.DisplayType=null;this.UniqueID=null;this.Element=null;this.Readonly=false;this.Required=false;this.IsExpandImage=false;this.IsDatePickerImage=false;this.IsLabel=false;this.Validate=true;this.MaxLength=null;this.ForControl=null}var __CMDBControlMap;var __EXPAND_IMG_PREFIX="EIMG";var __DATEPICK_IMG_PREFIX="DPCK";var __FIELD_LABEL_PREFIX="FLBL";function ValidateForm(){Ext.Date.useStrict=true;var f=null;var e=null;var c=null;var d=true;for(var a=0;a<__CMDBControlMap.length;a++){e=__CMDBControlMap.get(a);f=e.Element;if(e.Validate&&e.Required){if(e.DisplayType=="MULTIPICKLIST"){if(e.Element.options&&e.Element.options.length==0){GetMessageBox("bmc-message").alert("",_ServerValues.requiredAllFieldBRActionPage);d=false}else{if(!e.Element.options&&dynamicPicklistMapMultiSelect.has(e.ApiName)){var b=document.getElementById(dynamicPicklistMapMultiSelect.get(e.ApiName)+"_selected");if(b.options&&b.options.length==0){GetMessageBox("bmc-message").alert("",_ServerValues.requiredAllFieldBRActionPage);d=false}}}}else{if(e.DisplayType=="PICKLIST"&&((e.Element.value.trim()==""&&document.getElementById(e.Element.id).value.trim()=="")||document.getElementById(e.Element.id).value.trim()==String.fromCharCode(95,1,95))){GetMessageBox("bmc-message").alert("",_ServerValues.requiredAllFieldBRActionPage);d=false}else{if(e.DisplayType!="PICKLIST"&&e.Element.value.trim()==""){GetMessageBox("bmc-message").alert("",_ServerValues.requiredAllFieldBRActionPage);d=false}}}if(!d){return d}}if(e.Validate&&!e.Readonly&&(e.DisplayType=="CURRENCY"||e.DisplayType=="PERCENT"||e.DisplayType=="DOUBLE"||e.DisplayType=="NUMBER"||e.DisplayType=="PHONE")){if(e.Element.value.trim()!=""){var h=/^[-]?\d*\.?\d*$/;if(!(e.Element.value.match(h))&&e.DisplayType!="PHONE"){d=false;if(e.DisplayType=="DOUBLE"){e.DisplayType="NUMBER"}GetMessageBox("bmc-message").alert("",RemedyForceHTMLProcessor.getText(__CMDBControlMap.get(__FIELD_LABEL_PREFIX+e.UniqueID).Element)+" "+_ServerValues.numericValueRequired)}if(e.DisplayType=="PHONE"){var h=/^\([0-9]{3}\)[ ]?[0-9]{3}-[0-9]{4}$|^(?!.*--)(?!.*(-\s*)$)([+]|[-])?(\d*?[\s-\d]*)$/;var g=/^[-]?\d*\.?\d*$/;if(!(e.Element.value.match(h))&&!(e.Element.value.match(g))){d=false;GetMessageBox("bmc-message").alert("",_ServerValues.CorrectValueErrorMsg+" "+RemedyForceHTMLProcessor.getText(__CMDBControlMap.get(__FIELD_LABEL_PREFIX+e.UniqueID).Element))}}if(!d){return d}}}}return d}function LimitText(b,a){if(b.value.length>a){b.value=b.value.substring(0,a)}}function ShowStatusMessage(){if(_ServerValues.savestatus==true){GetMessageBox("bmc-message").alert("",_ServerValues.SuccessSaveMsg)}else{if(_ServerValues.savestatusMessage!=null&&_ServerValues.savestatusMessage!=""){GetMessageBox("bmc-message").alert("",_ServerValues.savestatusMessage)}}}function createControlMap(){__CMDBControlMap=new Ext.util.MixedCollection();var a=document.getElementsByTagName("*");var m=null;var f="";var l="";var j=null;for(var d=0;d<a.length;d++){l="";j=null;m=a[d];f=m.className;if(f.indexOf("CMDBControl")<0&&dynamicPicklistMap.has(m.id)){f=f+dynamicPicklistMap.get(m.id)}if(f.indexOf("CMDBControl")>=0){l=f.substring(f.indexOf("[(")+2,f.lastIndexOf(")]"));j=l.split(":");var b=new CMDBControl();b.Element=m;b.UniqueID=null;for(var c=0;c<j.length;c++){var h=j[c].split("=");switch(h[0]){case"ApiFieldName":b.ApiName=h[1];break;case"DisplayType":b.DisplayType=h[1];break;case"UniqueID":b.UniqueID=h[1];break;case"GroupName":b.GroupName=h[1];break;case"Readonly":b.Readonly=(h[1]=="true");break;case"MaxLength":try{b.MaxLength=parseInt(h[1])}catch(g){}if(b.MaxLength<=0){b.MaxLength=null}break;case"Required":b.Required=(h[1]=="true");break;default:break}}if(b.UniqueID==null||b.UniqueID.trim()==""){b.UniqueID=m.id}if(f.indexOf("CMDB_ExpandImage")>=0){b.IsExpandImage=true;b.ForControl=__CMDBControlMap.get(b.UniqueID);b.UniqueID=__EXPAND_IMG_PREFIX+b.UniqueID;b.Validate=false}if(f.indexOf("CMDB_DatePickerImage")>=0){b.IsDatePickerImage=true;b.ForControl=__CMDBControlMap.get(b.UniqueID);b.UniqueID=__DATEPICK_IMG_PREFIX+b.UniqueID;b.Validate=false}if(f.indexOf("CMDB_FieldLabel")>=0){b.IsFieldLabel=true;b.ForControl=__CMDBControlMap.get(b.UniqueID);b.UniqueID=__FIELD_LABEL_PREFIX+b.UniqueID;b.Validate=false}__CMDBControlMap.add(b.UniqueID,b)}}}function renderElementsByType(){var f=null;var e=null;var d=null;var h=null;var b=null;var a=false;for(var c=0;c<__CMDBControlMap.length;c++){e=__CMDBControlMap.get(c);f=e.Element;h=Ext.get(f);Ext.get(f).on("change",function(){dataModifiedFlag=1});if(e.IsExpandImage){var b=Ext.get(f.id);b.on("click",function(){showExpansionWindow(this)},e);continue}if(e.IsDatePickerImage){var b=Ext.get(f.id);b.on("click",function(){_datePicker.Show(this.ForControl.Element.id)},e);continue}var g={applyTo:f};g.width=200;switch(e.Element.tagName.toUpperCase()){case"INPUT":d=e.Element.type.toUpperCase();if(d=="CHECKBOX"){if(e.Readonly){e.Element.disabled=true}}else{if(e.Readonly){e.Element.readOnly=true;e.Element.className+=" InputVirtualReadOnly"}}switch(e.DisplayType.toUpperCase()){case"STRING":break;case"DATETIME":if(!e.Readonly){}break;case"BOOLEAN":break;default:break}break;case"SELECT":if(e.Readonly){e.Element.disabled=true}break;case"TEXTAREA":e.Element.readOnly=e.Readonly;if(e.MaxLength!=null){applyTextAreaLengthLimit(e)}break;default:break}}}function showExpansionWindow(a){var e=null;var h=RemedyForceHTMLProcessor.getText(__CMDBControlMap.get(__FIELD_LABEL_PREFIX+a.ForControl.UniqueID).Element);var f=a.ForControl.Element.value;var j=Ext.get(a.ForControl.Element).getX();var i=Ext.get(a.ForControl.Element).getY();var d=false;if(a.ForControl.Readonly==true){if(!f){f=RemedyForceHTMLProcessor.getText(a.ForControl.Element)}d=true}var c={value:f,readOnly:a.ForControl.Readonly,cls:"InputVirtualReadOnly",id:"textAreaPopup"};if(a.ForControl.MaxLength!=null){c.maxLength=a.ForControl.MaxLength}var g=new Ext.form.TextArea(c);var b=_ServerValues.CMDBTextFieldLimitExceeded;b=b.replace("{0}",a.ForControl.MaxLength);g.maxLengthText=b;e=new Ext.Window({layout:"fit",title:h,width:500,height:250,frame:false,animate:true,cls:"CMDBWindow",modal:true,bodyStyle:"padding: 30px 20px 30px 20px; background:#FFFFFF;",style:"padding: 0; border-width: 0;background:#FFFFFF;",defaultType:"textarea",defaultButton:"textAreaPopup",items:[g],border:false,closable:false,tools:[{type:"rfclose",handler:function(m,l,k){e.close()}}],dockedItems:[{xtype:"toolbar",height:40,cls:"rf-toolbar",dock:"bottom",items:["->",{xtype:"button",text:_ServerValues.CancelLabel,cls:"bmc-btn-small",hidden:d,handler:function(){e.close()}},{xtype:"tbspacer",width:5},{xtype:"button",text:_ServerValues.OKLabel,cls:"bmc-btn-primary",handler:function(){var l=g.getValue();var k=a.ForControl.MaxLength;if(k!=null){if(k&&l.length>k){l=l.substr(0,k)}}a.ForControl.Element.value=l;if(f!=a.ForControl.Element.value){dataModifiedFlag=1}e.close()}},{xtype:"tbspacer",width:10}]}]});e.show()}function applyTextAreaLengthLimit(b){var a=b.Element;a.maxLength=b.MaxLength;a.onkeydown=function(c){return doKeyPress(a,c)};a.onpaste=function(){return doPaste(a)};a.onkeyup=function(){return doKeyUp(a)};a.onblur=function(){return doKeyUp(a)}}var detect=navigator.userAgent.toLowerCase();function doKeyPress(d,b){var a=d.maxLength;var c=window.event?event.keyCode:b.which;if((c==32)||(c==13)||(c>47)){if(a&&(d.value.length>a-1)){if(window.event){window.event.returnValue=null}else{b.cancelDefault;return false}}}}function doKeyUp(b){var a=b.maxLength;if(a&&b.value.length>a){b.value=b.value.substr(0,a)}}function doPaste(f){var b=f.maxLength;if(b){if((window.event)&&(detect.indexOf("safari")+1==0)){var d=f.document.selection.createRange();var c=b-f.value.length+d.text.length;try{var a=window.clipboardData.getData("Text").substr(0,c);d.text=a}catch(e){}if(window.event){window.event.returnValue=null}else{f.value=f.value.substr(0,b);return false}}}}function validateInputValue(b,e,f){if(typeof f!="undefined"&&typeof e!="undefined"){var d="";var g=f.value;if(e=="dateTime"&&g!=""){var c=Ext.Date.parse(g,SDEDateFormat);if(c==undefined||Number.isNaN(c)){d=b+": "+inValidDateTimeMsg;f.value=""}}else{if(e=="date"&&g!=""){var a=SDEDateFormat.split(" ");if(a.length>0){var c=Ext.Date.parse(g,a[0]);if(c==undefined||Number.isNaN(c)){d=b+": "+inValidDateMsg;f.value=""}}}}if(d!=""){GetMessageBox("bmc-message").show({msg:d,buttons:Ext.MessageBox.OK})}}};