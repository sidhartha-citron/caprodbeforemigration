var hiddenServiceId;function callFuncOnBlur(f,d,c,a,b){if(document.getElementById(b).value==""){document.getElementById(a).nextSibling.value="";document.getElementById(a).value="";return}c=c.toLowerCase();if((change)&&(document.getElementById(b).value!="")){change=false;setTaboutValueID(a);if(c=="fkstatus__c"||c==orgNamespace.toLowerCase()+"fkstatus__c"){showalldata(f,setSelected,escape("state__c=false and appliestoincident__c = true and inactive__c = false"))}else{if(c=="fkclosedby__c"||c==orgNamespace.toLowerCase()+"fkclosedby__c"){showalldata(f,setSelected,escape("IsStaffUser__c=true"))}else{if(c=="fkcategory__c"||c==orgNamespace.toLowerCase()+"fkcategory__c"){showalldata(f,setSelected,escape("Inactive__c=false and (AvailableForIncidents__c = true OR AvailableForServiceCatalog__c = true)"))}else{showalldata(f,setSelected)}}}}}function setSelected(){setTaboutValue()}function setTaboutValue(){if(inputHTMLElement1!=null&&inputHTMLElement1!=""&&inputHTMLElement1!="undefined"){oldVal=inputHTMLElement1.nextSibling.value;inputHTMLElement1.nextSibling.value=inputHTMLElement1.value;lookupValChanged(inputHTMLElement1.id,oldVal,inputHTMLElement1.nextSibling.value)}}function setTaboutValueID(a){if(a!=null&&a!=""){inputHTMLElement1=document.getElementById(a)}}function lookupValChanged(b,a,c){if(b.toLowerCase()==closeIncidentPage.ComponentVars.categoryId.toLowerCase()){if((c!="")&&(a!=c)){setSelectedCategoryNext(c)}}}function detectChangeEvent(){change=true}Ext.onReady(function(){if(!closeIncidentPage.Labels.isUpdateable){Ext.MessageBox.show({msg:closeIncidentPage.Labels.insufficentPrivilegeMsg,buttons:Ext.MessageBox.OK})}Ext.QuickTips.init();var d="False";createFilterFieldMap();function c(){if(closeIncidentPage.ComponentVars.closedById!=""){d="False";var e=document.getElementById(closeIncidentPage.ComponentVars.closedById).value;if(e!=null&&e!=""){d="False"}else{d="True"}}}var b=function(f,g){c();if(d=="False"){var j=0;var h=0;if(closeIncidentPage.ComponentVars.incidentDescription!=""){var i=document.getElementById(closeIncidentPage.ComponentVars.incidentDescription).value;j=i.length}if(closeIncidentPage.ComponentVars.incidentResolution!=""){var e=document.getElementById(closeIncidentPage.ComponentVars.incidentResolution).value;h=e.length}if(j>32000){Ext.MessageBox.show({msg:closeIncidentPage.ComponentVars.Description+": "+closeIncidentPage.Labels.TextAreaOverflow,width:300,buttons:Ext.MessageBox.OK})}else{if(h>32000){Ext.MessageBox.show({msg:closeIncidentPage.ComponentVars.Resolution+": "+closeIncidentPage.Labels.TextAreaOverflow,width:300,buttons:Ext.MessageBox.OK})}else{closeIncident()}}}else{Ext.MessageBox.show({msg:closeIncidentPage.Labels.labelCloseByEmpty,buttons:Ext.MessageBox.OK});return}};var a=Ext.extend(Ext.Panel,{renderTo:"btnToolbar",defaults:{bodyStyle:"border:0px;padding:0px;margin:0px;zoom:0px;"}});new a({title:"",cls:"toolCloseCls",bodyStyle:"border:0px;padding:0px;margin:0px;zoom:0px;",tbar:[{scale:"medium",tooltipType:"title",tooltip:closeIncidentPage.Labels.labelSave,iconCls:"bmcSave",disabled:!closeIncidentPage.Labels.isUpdateable,handler:b}]});toggleFollowUpDateTime();initData()});function toggleFollowUpDateTime(){if((closeIncidentPage.ComponentVars.followUp!="")&&(closeIncidentPage.ComponentVars.followUpDateTime!="")){objFollowUp=document.getElementById(closeIncidentPage.ComponentVars.followUp);objFollowUpDateTime=document.getElementById(closeIncidentPage.ComponentVars.followUpDateTime);var b;if(objFollowUpDateTime.parentNode.nextSibling!=null){b=objFollowUpDateTime.parentNode.nextSibling}else{b=objFollowUpDateTime.parentNode.parentNode.parentNode.getElementsByTagName("img")[0]}var a=navigator.appName;if(objFollowUp.checked==true){b.style.display="";objFollowUpDateTime.value=follwupdatetimeval;objFollowUpDateTime.className="clsDateInputTextBox"}else{b.style.display="none";objFollowUpDateTime.value="";objFollowUpDateTime.className="dateInputDisable"}}}function validateAndCloseWindow(){if(msgvalue==""){if((errorString!=null&&errorString!="")){showError()}else{if(calledFrom=="stdform"){window.opener.location.href="/"+incidentId;window.close()}else{if(calledFrom=="rfconsole"){var a=window.dialogArguments;var c=window.location.hash=!!window.MSInputMethodContext;if(typeof(window.opener)!="undefined"&&window.opener!="undefined"){window.opener.startWaitMsgBar();window.opener.isNeedToRefreshIncList=true;window.opener.refreshIncident()}else{if(a!=null&&(typeof(window.opener)=="undefined"||window.opener=="undefined")&&(Ext.isIE||c)){a.startWaitMsgBar();a.isNeedToRefreshIncList=true;a.refreshIncident()}}if(typeof window.close()!=="undefined"){window.close()}else{var b=window.open("","_self","");b.close()}}else{window.parent.setPopUpVar(incidentId);window.parent.renderAddNoteAfterClose();window.parent.updateTitle();parent.window.closePopup()}}}}}function enableCheckboxes(){if(closeIncidentPage.ComponentVars.incidentResolution!=""){var a=getElementsByValue("isStdResolution","input");if(document.getElementById(closeIncidentPage.ComponentVars.incidentResolution).value==""){a[0].disabled=true;a[0].checked=false}else{a[0].disabled=false}}}function disabledCheckboxes(){if(closeIncidentPage.ComponentVars.incidentResolution!=""){if(document.getElementById(closeIncidentPage.ComponentVars.incidentResolution).value==""){var b=getElementsByValue("isStdResolution","input");b[0].disabled=true}}if(closeIncidentPage.ComponentVars.incidentDescription!=""){if(document.getElementById(closeIncidentPage.ComponentVars.incidentDescription).value==""){var a=getElementsByValue("isStdDescription","input");a[0].disabled=true}}}function getElementsByValue(g,a,f){var b=new Array();if(a==null){a="*"}if(f==null){f=document}var e=f.getElementsByTagName(a);var c=new RegExp(g,"i");for(var d=0;d<e.length;d++){if(c.test(e[d].value)){b.push(e[d])}}return b}function changeDescCheckboxStatus(){var b=getElementsByValue("isStdDescription","input");var a=getElementsByValue("isStdResolution","input");if(a[0].checked&&!b[0].checked){b[0].checked=true}}function refreshRelatedPortlets(){if(typeof(window.parent.parent.parent.refreshActionItemsPortlet)=="function"){window.parent.parent.parent.refreshActionItemsPortlet("Action Items","INC")}var a=document.getElementById(closeIncidentPage.ComponentVars.closeTasks);if(a!=null&&a!=""&&typeof(a)!="undefined"&&a.checked&&typeof(window.parent.parent.parent.refreshActionItemsPortlet)=="function"){window.parent.parent.parent.refreshActionItemsPortlet("Action Items","TASK")}}function updateFollowUp(){if((closeIncidentPage.ComponentVars.followUp!="")&&(closeIncidentPage.ComponentVars.followUpDateTime!="")){objFollowUp=document.getElementById(closeIncidentPage.ComponentVars.followUp);objFollowUpDateTime=document.getElementById(closeIncidentPage.ComponentVars.followUpDateTime);objFollowUp.checked=follwupval;var b;if(objFollowUpDateTime.parentNode.nextSibling!=null){b=objFollowUpDateTime.parentNode.nextSibling}else{b=objFollowUpDateTime.parentNode.parentNode.parentNode.getElementsByTagName("img")[0]}var a=navigator.appName;if(objFollowUp.checked==true){b.style.display="";objFollowUpDateTime.value=follwupdatetimeval;objFollowUpDateTime.className="clsDateInputTextBox"}else{b.style.display="none";objFollowUpDateTime.value="";objFollowUpDateTime.className="dateInputDisable"}}}function closeWindow(){closeIncident()}function disableSIMenues(){window.parent.frames.SIIframeID.disableAll();if(errorString.indexOf(closeIncidentPage.Labels.labelIncidentCloseError)!=-1){window.parent.frames.SIIframeID.enableAll()}}function setPopUpValue(a,b){if(a!=null&&a!=""&&a!="undefined"){if(inputHTMLElement!=null&&inputHTMLElement!=""&&inputHTMLElement!="undefined"){inputHTMLElement.value=a;oldVal=inputHTMLElement.previousSibling.value;inputHTMLElement.previousSibling.value=a;inputHTMLElement.previousSibling.previousSibling.previousSibling.value=htmlDecode(b);lookupValChanged(inputHTMLElement.previousSibling.id,oldVal,inputHTMLElement.previousSibling.value)}}}function setPopUpValueID(a){if(a!=null&&a!=""){inputHTMLElement=document.getElementById(a)}}function setFSFieldDetail(i,d,b,a,f,g,h){if(document.getElementById(f)!=null){var c=document.getElementById(f);var e=document.getElementById(g);if(i.toLowerCase().indexOf("followup__c")>-1){closeIncidentPage.ComponentVars.followUp=c.id}else{if(i.toLowerCase().indexOf("followupdatetime__c")>-1){closeIncidentPage.ComponentVars.followUpDateTime=c.id}else{if(i.toLowerCase().indexOf("closedatetime__c")>-1){c.disabled=true;c.className="dateInputDisable"}else{if(i.toLowerCase().indexOf("incidentresolution__c")>-1){closeIncidentPage.ComponentVars.incidentResolution=c.id;c.title=closeIncidentPage.Labels.lblResolutionTitle;c.setAttribute("onchange","enableCheckboxes()")}else{if(i.toLowerCase().indexOf("fkclosedby__c")>-1){closeIncidentPage.ComponentVars.closedById=e.id;closedById=e.id}else{if(i.toLowerCase().indexOf("fkstatus__c")>-1){closeIncidentPage.ComponentVars.StatusId=e.id}else{if(i.toLowerCase().indexOf("fkcategory__c")>-1){closeIncidentPage.ComponentVars.categoryId=c.id}else{if(i.indexOf("FKOpenBy__c")>0){staffId=e.id}else{if(i.indexOf("FKBMC_BaseElement__c")>0){ciId=e.id}else{if(i.indexOf("FKBusinessService__c")>0){serviceId=e.id;hiddenServiceId=c.id}else{if(i.indexOf("FKServiceOffering__c")>0){offeringId=e.id}}}}}}}}}}}}}function openTextEditorPopup(g,b,e,c,d,f){var h;if(g.parentNode.previousSibling.previousSibling!=null){var a=g.parentNode.previousSibling.previousSibling;if(Ext.isIE){if(g.parentNode.previousSibling.childNodes[0]==null){h=a.querySelector(".clsRelativePosition").getElementsByTagName("textarea")[0].id}else{h=g.parentNode.previousSibling.childNodes[0].getElementsByTagName("textarea")[0].id}}else{if(a.querySelector(".clsRelativePosition")!=null){h=a.querySelector(".clsRelativePosition").getElementsByTagName("textarea")[0].id}}showTextEditor(h,b,e,c,d,300,450)}if(f!=null&&f!="undefined"&&f){Ext.getCmp("formTextId").el.dom.setAttribute("readOnly",true);Ext.getCmp("formTextId").addClass("disabledTextEditor");Ext.getCmp("formTextId").blur()}}function openPopUpForLookupPopup(e,a,b,d,c){showLookupPopup(e,a,b,d,c,"Incident__c","incident");return false}function initData(){updateFollowUp();objClosedBy=document.getElementById(closeIncidentPage.ComponentVars.closedById);objStatus=document.getElementById(closeIncidentPage.ComponentVars.StatusId);if(objClosedBy!=null){objClosedBy.value=strClosedByUserName}if(objStatus!=null){objStatus.value=strStatusName}if(closeIncidentPage.ComponentVars.incidentResolution!=""){document.getElementById(closeIncidentPage.ComponentVars.incidentResolution).focus()}disabledCheckboxes()};