var DataStore;var grid;var keyValueOption;var keyvalueStore;var IncidentStore;var IncidentFieldsCombo;var IncidentTypeStore;var IncidentTypeFieldsCombo;var dataList;var ds;var ds1;var selectedComboValue="";var selectedTextFieldValue="";var blanklabel="";var selectedRecord;var customFieldComboValue;var splitedIncidentAssignedTo;var selectedDelimiter="";var DelimiterCombovalue="";var gridordering;var index;Ext.onReady(function(){var createdIncidentsAssignedTo=emailIncidentAssignedTovar;if(createdIncidentsAssignedTo!=""&&createdIncidentsAssignedTo!=null){var splitedIncidentAssignedTo=createdIncidentsAssignedTo.split(";");selectedComboValue=splitedIncidentAssignedTo[0];if(selectedComboValue==""&&selectedComboValue==null){selectedComboValue="ContextUser"}selectedTextFieldValue=splitedIncidentAssignedTo[1]}else{selectedComboValue="ContextUser"}var selectedDelimiterAssigned=delimiterAssignedvar;DelimiterCombovalue=selectedDelimiterAssigned;if(selectedDelimiterAssigned!=""&&selectedDelimiterAssigned!=null){selectedDelimiter=selectedDelimiterAssigned}var IncidentEmailTextfield=new Ext.form.TextField({id:"incidenttextfield",value:emailSubjectvar,width:200});var IncidentEmailPanel=new Ext.Panel({border:false,id:"incidentemailpanel",layout:"column",renderTo:"incset1",items:[{xtype:"radiogroup",id:"radiob",columns:2,style:"width: 770px;height:52px",items:[{id:"radioone",boxLabel:IncidentEmailSettingsPage.Labels.IncidentEmailSubject,name:"rbauto",inputValue:1},{xtype:"component",fieldLabel:"&nbsp;",labelSeparator:" "},{id:"radiotwo",boxLabel:IncidentEmailSettingsPage.Labels.IncidentEmailSubject2,name:"rbauto",inputValue:2,height:30},IncidentEmailTextfield],listeners:{render:{fn:function(item){if(document.getElementById("incidenttextfield").value==""){document.getElementById("radioone").checked=true;document.getElementById("incidenttextfield").disabled=true}else{document.getElementById("radiotwo").checked=true}}},change:{fn:function(item){var rd=document.getElementsByName("rbauto");for(var i=0;i<rd.length;i++){if(rd[i].checked){if(rd[i].value==1){document.getElementById("incidenttextfield").value="";document.getElementById("incidenttextfield").disabled=true}else{var subjectline=IncidentEmailSettingsPage.Labels.OpenIncident;subjectline=subjectline.toUpperCase();if(emailSubjectvar==null||emailSubjectvar==""){document.getElementById("incidenttextfield").value=subjectline}else{document.getElementById("incidenttextfield").value=emailSubjectvar}document.getElementById("incidenttextfield").disabled=false}}}}}}}]});eval(AssignIncidentListvar);var IncidentObjStore=new Ext.data.ArrayStore({id:"IncidentObjStore",fields:[{name:"Id"},{name:"IncidentObjFieldLabel"}]});IncidentObjStore.loadData(AssignIncidentListData);IncidentObjStore.sort("IncidentObjFieldLabel");var IncidentObjDesc=new Ext.form.Label({id:"IncidentObjDesc",text:IncidentEmailSettingsPage.Labels.AssignEmailIncidents});var IncidentObjectCombo=new Ext.form.ComboBox({id:"incidentassignedto",fieldLabel:"",hiddenName:"IncidentObject",store:IncidentObjStore,valueField:"Id",displayField:"IncidentObjFieldLabel",typeAhead:false,mode:"local",editable:false,width:150,value:selectedComboValue,triggerAction:"all",forceSelection:true,selectOnFocus:true});var IncidentObjectAssignedToPanel=new Ext.Panel({id:"IncidentObjectAssignedTo",border:false,layout:"table",cls:"ClsLeftMargin ClsMarginBottom",style:"height:10px",items:[{xtype:"textfield",name:"lookupvalue",readOnly:true,height:20,width:200,id:"lookupvalueid"},{xtype:"box",autoEl:{tag:"img",src:getSDEFStylePath()+"/SDEFbuttons/b_darrow_D.gif"},name:"lookupbutton",id:"lookupbuttonid",style:"padding-left:4px;",cls:"lookupbuttontest",listeners:{render:function(c){c.getEl().on("load",function(){if((document.images.lookupbuttonid)!=null){if(document.images.lookupbuttonid.getAttribute("isBtnDisabled")==null){selectedComboValue=IncidentObjectCombo.getValue();if((selectedComboValue=="Staff")||(selectedComboValue=="Queue")){document.images.lookupbuttonid.setAttribute("isBtnDisabled",false);document.images.lookupbuttonid.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D.gif"}else{document.images.lookupbuttonid.setAttribute("isBtnDisabled",true);document.images.lookupbuttonid.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D_disable_custom.gif"}}}});c.getEl().on("click",function(){var popupId="",srchPageUrl="";var incidentObjWithNamespaceVal=incidentObjWithNamespacevar;if(selectedComboValue=="Staff"){popupId="Client";srchPageUrl="SearchPage?popupId=Client&isLookup=true&filterClause=IsStaffUser__c=true"}else{if(selectedComboValue=="Queue"){popupId="Queue";srchPageUrl="SearchPage?popupId="+popupId+"&isLookup=true&queueFor="+incidentObjWithNamespaceVal;srchPageUrl=srchPageUrl+"&filterClause="+escape("sobjectType='"+incidentObjWithNamespaceVal+"'")}}if((document.images.lookupbuttonid.getAttribute("isBtnDisabled")==false)||(document.images.lookupbuttonid.getAttribute("isBtnDisabled")=="false")){openPopupRF(srchPageUrl,findNameField)}})}}}]});IncidentObjectCombo.on("select",function(){selectedComboValue=IncidentObjectCombo.getValue();Ext.getCmp("lookupvalueid").setValue("");if(selectedComboValue=="Staff"||selectedComboValue=="Queue"){var lookupbuttonid=document.images.lookupbuttonid;document.images.lookupbuttonid.setAttribute("isBtnDisabled",false);lookupbuttonid.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D.gif"}else{var lookupbuttonid=document.images.lookupbuttonid;document.images.lookupbuttonid.setAttribute("isBtnDisabled",true);lookupbuttonid.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D_disable_custom.gif"}});eval(CustomObjectsListvar);var objectstore=new Ext.data.ArrayStore({id:"objectstore",fields:[{name:"comboId"},{name:"comboName"}]});ds=new Ext.data.ArrayStore({data:AvailableEmailFields,fields:["value","text"]});ds1=new Ext.data.ArrayStore({data:SelectedEmailFields,fields:["value","text"]});delimiterstore=new Ext.data.ArrayStore({fields:[{name:"comboId"},{name:"comboName"}]});var UserComboLabel=new Ext.form.Label({id:"userComboLabel",text:IncidentEmailSettingsPage.Labels.For});var CustomObjCombo=new Ext.form.ComboBox({id:"customobject",fieldLabel:"",selectOnFocus:true,editable:false,triggerAction:"all",store:objectstore,valueField:"comboId",width:191,displayField:"comboName",mode:"local",value:selectedCustomObject});objectstore.loadData(CustomObjectsListData);CustomObjCombo.on("select",function(){customFieldComboValue=CustomObjCombo.getValue();SelectObjectCustomFields(customFieldComboValue)});var CustomObjNamePanel=new Ext.Panel({id:"CustomObjNamePanel",border:false,layout:"table",height:40,renderTo:"id2",style:"padding-top:10px;padding-right:15px;padding-left:8px;",items:[UserComboLabel,CustomObjCombo]});eval(AssignDelimterListvar);var DelimiterLabel=new Ext.form.Label({id:"DelimiterLabel",text:IncidentEmailSettingsPage.Labels.SelectDelimiter});var DelimiterCombo=new Ext.form.ComboBox({id:"delimiterCombo",fieldLabel:"",selectOnFocus:true,editable:false,triggerAction:"all",store:delimiterstore,valueField:"comboId",displayField:"comboName",value:selectedDelimiter,mode:"local",width:200});delimiterstore.loadData(AssignDelimiterListData);DelimiterCombo.on("select",function(){DelimiterCombovalue=DelimiterCombo.getValue("comboId")});var DelimiterComboPanel=new Ext.Panel({id:"DelimiterComboPanel",border:false,layout:"table",height:45,renderTo:"delimiterid",cls:"ClsPadding10",items:[DelimiterLabel,DelimiterCombo]});var CustomObjAvailableFields=new Ext.form.Label({id:"CustomObjAvailableFields",cls:"clsInputBoldLabelTDI",text:IncidentEmailSettingsPage.Labels.AvailableEmailFields});var CustomObjSelectedFields=new Ext.form.Label({id:"CustomObjSelectedFields",style:"padding-left:100px;",cls:"clsInputBoldLabelTDI",text:IncidentEmailSettingsPage.Labels.SelectedEmailFields});var CustomObjFieldsSelectionLabels=new Ext.Panel({id:"CustomObjFieldsSelectionLabels",border:false,layout:"table",renderTo:"emailselector",cls:"ClsPadding10",items:[CustomObjAvailableFields,CustomObjSelectedFields]});var CustomFieldsSettingForm=new Ext.Panel({id:"CustomFieldsSettingForm",width:550,height:160,cls:"incf",border:false,renderTo:"emailselector",style:"padding-right:15px;padding-left:10px;",layout:"column",items:[{xtype:"itemselector",id:"itemselectorDiv",width:600,name:"itemselector",drawLeftIcon:true,drawRightIcon:true,drawUpIcon:false,drawDownIcon:false,fieldLabel:"ItemSelector",iconLeft:"b_darrow_L_disable_custom.gif",iconRight:"b_darrow_R_disable_custom.gif",imagePath:getSDEFStylePath()+"/SDEFbuttons/",multiselects:[{id:"customFieldList1",legend:false,width:200,height:146,store:ds,cls:"clsCustomFieldList",displayField:"text",valueField:"value",draggable:false,listeners:{click:function(c){document.getElementById("iconRightId").src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_R_new.gif";document.getElementById("iconLeftId").src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_L_disable_custom.gif"}}},{id:"selectedFieldList1",legend:false,width:200,cls:"ClsSelectedFieldList",height:146,store:ds1,displayField:"text",valueField:"value",draggable:false,listeners:{click:function(c){document.getElementById("iconRightId").src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_R_disable_custom.gif";document.getElementById("iconLeftId").src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_L_new.gif"}}}]}]});eval(fetchdataListvar);eval(IncidentFieldsvar);eval(keywordOptionvar);eval(IncidentFieldsDataTypevar);DataStore=new Ext.data.ArrayStore({id:"DataStore",fields:[{name:"Id"},{name:"FieldName"},{name:"Keyvalue"},{name:"FieldLabel"},{name:"Datatype"}]});DataStore.loadData(fieldListData);grid=new Ext.grid.GridPanel({sm:new Ext.grid.RowSelectionModel({singleSelect:true}),id:"Sgrid",width:578,border:true,stripeRows:false,enableHdMenu:false,sortable:false,store:DataStore,columns:[{id:"FieldName",header:"Field Name",width:190,hidden:true,dataIndex:"FieldName"},{id:"datatype",header:"Data Type",width:180,hidden:true,dataIndex:"Datatype"},{header:IncidentEmailSettingsPage.Labels.IncidentField,id:"ValueLabel",width:195,dataIndex:"FieldLabel"},{header:IncidentEmailSettingsPage.Labels.EmailContent,id:"EmailType",width:190,dataIndex:"Id"},{header:IncidentEmailSettingsPage.Labels.Emailkeyword,id:"KeywordValue",width:182,dataIndex:"Keyvalue"}]});grid.on("rowclick",selectedvalue,this);var orderlist=new Ext.Panel({id:"orderlist",layout:{type:"table",columns:1},border:false,items:[{xtype:"box",id:"upbutton",autoEl:{tag:"img",src:getSDEFStylePath()+"/SDEFbuttons/b_darrow_U_disable_custom.gif"},listeners:{render:function(c){c.getEl().on("click",function(){moveRecords(-1)})}}},{xtype:"box",id:"downbutton",autoEl:{tag:"img",src:getSDEFStylePath()+"/SDEFbuttons/b_darrow_D_disable_custom.gif"},listeners:{render:function(c){c.getEl().on("click",function(){moveRecords(1)})}}}]});IncidentStore=new Ext.data.ArrayStore({id:"IncidentStore",fields:[{name:"label"},{name:"fieldname"}]});IncidentStore.loadData(FieldsofIncident);IncidentStore.sort("label");IncidentFieldsCombo=new Ext.form.ComboBox({id:"IncidentFields",store:IncidentStore,valueField:"fieldname",displayField:"label",forceSelection:true,selectOnFocus:true,renderTo:"IncidentTD",FieldLabel:"Incident Fields",mode:"local",editable:false,width:180,triggerAction:"all",forceSelection:true,emptyText:IncidentEmailSettingsPage.Labels.IncidentFieldCombo,selectOnFocus:true,viewConfig:{enableKeyEvents:true}});IncidentTypeStore=new Ext.data.ArrayStore({id:"IncidentTypeStore",fields:[{name:"DataType"},{name:"fieldname"}]});IncidentTypeStore.loadData(FieldTypeofIncident);IncidentTypeStore.sort("fieldname");IncidentTypeFieldsCombo=new Ext.form.ComboBox({id:"IncidentTypeFields",store:IncidentTypeStore,valueField:"fieldname",displayField:"DataType",forceSelection:true,selectOnFocus:true,renderTo:"IncidentTD1",FieldLabel:"Incident Fields",mode:"local",editable:false,width:150,triggerAction:"all",forceSelection:true,emptyText:IncidentEmailSettingsPage.Labels.IncidentFieldCombo,selectOnFocus:true,viewConfig:{enableKeyEvents:true}});IncidentFieldsCombo.on("select",function(combo,record,index){IncidentTypeFieldsCombo.setValue(IncidentFieldsCombo.getValue());Ext.getCmp("keyvalueOptions").reset();document.getElementById("inputTxt").disabled=true;document.getElementById("inputTxt").value=IncidentEmailSettingsPage.Labels.Keyword;document.getElementById("updateButtonId").style.display="none";document.getElementById("removeButtonId").disabled=true;document.getElementById("addButtonId").style.display="inline";document.getElementById("removeButtonId").src=getSDEFStylePath()+"/SDEFbuttons/b_remove_disabled.png";Ext.getCmp("Sgrid").getSelectionModel().clearSelections();document.images.upbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_U_disable_custom.gif";document.images.downbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D_disable_custom.gif"});keyvalueStore=new Ext.data.ArrayStore({id:"keyvalueStore",fields:[{name:"label"},{name:"value"}]});keyvalueStore.loadData(KeywordValue);keyValueOption=new Ext.form.ComboBox({id:"keyvalueOptions",store:keyvalueStore,valueField:"label",displayField:"value",forceSelection:true,selectOnFocus:true,renderTo:"keyvalueTD",FieldLabel:"KeyValuePair",mode:"local",width:180,editable:false,triggerAction:"all",forceSelection:true,selectOnFocus:true,emptyText:IncidentEmailSettingsPage.Labels.EmailContentCombo});keyValueOption.on("select",function(combo,record,index){var keyoptValue=keyValueOption.getValue();if(keyoptValue=="Body"||keyoptValue=="Subject"){document.getElementById("inputTxt").disabled=false;document.getElementById("inputTxt").value=""}else{document.getElementById("inputTxt").disabled=true;document.getElementById("inputTxt").value="<Keyword>"}});var msgsendersLabel=new Ext.form.Label({id:"msgincidentLabel",border:false,width:200,text:IncidentEmailSettingsPage.Labels.unidentifiedUser,renderTo:"id6",cls:"clsNormalFont ClsmsgincidentLabel"});function findNameFieldForUser(id){getUserName(id)}var lookupUser=new Ext.Panel({id:"lookupUserId",border:false,layout:{type:"table",columns:3},items:[{xtype:"textfield",name:"lookupvalue",cls:"clsInputTextBox",height:20,width:246,readOnly:true,id:"UserLookupId"},{xtype:"box",autoEl:{tag:"img",src:getSDEFStylePath()+"/SDEFbuttons/b_darrow_D.gif"},name:"AccountLookupButton",id:"AccountLookupButtonId",style:"padding-left:4px;",cls:"lookupbuttontestsat",listeners:{render:function(c){c.getEl().on("click",function(){openPopupRF("SearchPage?popupId=Client&isLookup=true",findNameFieldForUser)})}}},{xtype:"box",autoEl:{tag:"img",src:getSDEFStylePath()+"/SDEFbuttons/b_field_clear.gif",title:IncidentEmailSettingsPage.Labels.lblReset},name:"ClearButton",id:"ClearButtonId",style:"padding-left:4px;",listeners:{render:function(c){c.getEl().on("click",function(){var userLookupValue=Ext.getCmp("UserLookupId");if(userLookupValue!=null&&userLookupValue!="undefined"){getUserName("")}})}}}]});var inboundsender=new Ext.Panel({id:"inboundsenderid",border:false,layout:"column",renderTo:"id6",items:[msgsendersLabel,lookupUser]});var FwdEmailLabel=new Ext.form.Label({id:"FwdEmailLabelid",border:false,width:350,text:IncidentEmailSettingsPage.Labels.FwdErrMail});function findNameFieldForAdmin(id){getAdminName(id)}var lookupAdmin=new Ext.Panel({id:"lookupAdminId",border:false,cls:"ClsLeftMargin",layout:{type:"table",columns:3},items:[{xtype:"textfield",name:"lookupvalue",cls:"clsInputTextBox",height:20,width:200,readOnly:true,id:"AdminLookupId"},{xtype:"box",autoEl:{tag:"img",src:getSDEFStylePath()+"/SDEFbuttons/b_darrow_D.gif"},name:"AccountLookupButton",id:"AccountLookupButtonId",style:"padding-left:4px;",cls:"lookupbuttontestsat",listeners:{render:function(c){c.getEl().on("click",function(){openPopupRF("SearchPage?popupId=Client&isLookup=true&filterId=0001",findNameFieldForAdmin)})}}},{xtype:"box",autoEl:{tag:"img",src:getSDEFStylePath()+"/SDEFbuttons/b_field_clear.gif",title:IncidentEmailSettingsPage.Labels.lblReset},name:"ClearErrUNotificationButton",id:"ClearErrUNotificationButtonId",style:"padding-left:4px;",listeners:{render:function(c){c.getEl().on("click",function(){var adminLookupValue=Ext.getCmp("AdminLookupId");if(adminLookupValue!=null&&adminLookupValue!="undefined"){getAdminName("")}})}}}]});var FwdErrMail=new Ext.Panel({id:"FwdErrMailid",border:false,layout:"column",items:[FwdEmailLabel,lookupAdmin]});var IncidentObjandComboPanel=new Ext.Panel({id:"IncidentObjandComboPanel",border:false,cls:"ClsMarginBottom",style:"height:10px",layout:{type:"table",columns:2},items:[IncidentObjDesc,IncidentObjectCombo]});var createIncidentFromCCValCheckbox=new Ext.form.Checkbox({id:"createIncidentFromCCValCheckboxId",cls:"saveEmailMsgInActionHistCheckbox",boxLabel:IncidentEmailSettingsPage.Labels.CreateIncidentEmailinCcBccLabel,checked:createIncidentFromCCVal,renderTo:"createIncidentFromCCValDiv",handler:function(){createIncidentFromCCVal=this.getValue()}});var tablePanel=new Ext.Panel({id:"tablePanel",border:false,layout:{type:"table",columns:2},renderTo:"id8",items:[IncidentObjandComboPanel,IncidentObjectAssignedToPanel,FwdEmailLabel,lookupAdmin]});var saveEmailMsgInActionHistCheckbox=new Ext.form.Checkbox({id:"saveEmailMsgInActionHistCheckboxId",cls:"saveEmailMsgInActionHistCheckbox",boxLabel:IncidentEmailSettingsPage.Labels.saveEmailReceivedMessage,checked:saveEmailMsgInActionHistPropVar,renderTo:"saveEmailMsgInActionHistCheckboxDiv",handler:function(){saveEmailMsgInActionHistPropVar=this.getValue()}});var includeprefixCheckbox=new Ext.form.Checkbox({id:"includeprefixCheckboxId",cls:"saveEmailMsgInActionHistCheckbox",boxLabel:IncidentEmailSettingsPage.Labels.IncludePrefix,checked:includeprefixCheckboxPropVar,renderTo:"includeprefixCheckboxCheckboxDiv",handler:function(){includeprefixCheckboxPropVar=this.getValue()}});var createIncidentFromCCValCheckbox=new Ext.form.Checkbox({id:"matchWholeWordCheckboxId",cls:"saveEmailMsgInActionHistCheckbox",boxLabel:IncidentEmailSettingsPage.Labels.MatchWholeWord,checked:matchWholeWord,renderTo:"matchWholeWordSpan",handler:function(){matchWholeWord=this.getValue()}});gridordering=new Ext.Panel({id:"gridorderingid",border:false,layout:"column",renderTo:"extGridPanel",items:[grid,orderlist]});document.getElementById("incidenttextfield").title=IncidentEmailSettingsPage.Labels.EmailSubjectTooltip;Ext.getCmp("lookupvalueid").setValue(selectedTextFieldValue);Ext.getCmp("UserLookupId").setValue(selectedUserEmailvar);Ext.getCmp("AdminLookupId").setValue(selectedAdminEmail);var mainHeaderPanel=new Ext.Panel({id:"mainHeaderPanel",border:false,tbar:[{scale:"medium",iconCls:"saveCls",id:"save",tooltipType:"title",tooltip:lblSave,id:"saveBtn",handler:savegrid}],autoWidth:true,renderTo:"toolBarDiv"})});function findNameField(a){getNameField(selectedComboValue,a)}function selectedvalue(b,d,c){if(d==0){Ext.getCmp("upbutton").disabled=true;document.images.downbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D_new.gif";document.images.upbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_U_disable_custom.gif"}else{if(d>0&&(d+1)<DataStore.data.length){Ext.getCmp("upbutton").disabled=false;Ext.getCmp("downbutton").disabled=false;document.images.downbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D_new.gif";document.images.upbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_U_new.gif"}else{if(d>0&&(d+1)==DataStore.data.length){Ext.getCmp("upbutton").disabled=false;Ext.getCmp("downbutton").disabled=true;document.images.downbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D_disable_custom.gif";document.images.upbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_U_new.gif"}}}selectedRecord=d;IncidentFieldsCombo.setRawValue(DataStore.getAt(d).get("FieldLabel"));IncidentFieldsCombo.setValue(DataStore.getAt(d).get("FieldName"));IncidentTypeFieldsCombo.setValue(IncidentFieldsCombo.getValue());document.getElementById("updateButtonId").style.display="inline";document.getElementById("removeButtonId").disabled=false;document.getElementById("addButtonId").style.display="none";document.getElementById("removeButtonId").src=getSDEFStylePath()+"/SDEFbuttons/b_remove.png";var a=DataStore.getAt(d).get("Id");if(a.indexOf(keyvalueStore.getAt(1).get("value"))!=-1){keyValueOption.setValue(keyvalueStore.getAt(1).get("label"));Ext.getCmp("keyvalueOptions").show();document.getElementById("inputTxt").disabled=true;document.getElementById("inputTxt").value=DataStore.getAt(d).get("Keyvalue")}else{if(a.indexOf(keyvalueStore.getAt(2).get("value"))!=-1){keyValueOption.setValue(keyvalueStore.getAt(2).get("label"));Ext.getCmp("keyvalueOptions").show();document.getElementById("inputTxt").disabled=true;document.getElementById("inputTxt").value=DataStore.getAt(d).get("Keyvalue")}else{if(a.indexOf(keyvalueStore.getAt(5).get("value"))!=-1){keyValueOption.setValue(keyvalueStore.getAt(5).get("label"));Ext.getCmp("keyvalueOptions").show();document.getElementById("inputTxt").disabled=false;document.getElementById("inputTxt").value=DataStore.getAt(d).get("Keyvalue")}else{if(a.indexOf(keyvalueStore.getAt(6).get("value"))!=-1){keyValueOption.setValue(keyvalueStore.getAt(6).get("label"));document.getElementById("inputTxt").disabled=false;document.getElementById("inputTxt").value=DataStore.getAt(d).get("Keyvalue")}else{if(a.indexOf(keyvalueStore.getAt(3).get("value"))!=-1){keyValueOption.setValue(keyvalueStore.getAt(3).get("label"));Ext.getCmp("keyvalueOptions").show();document.getElementById("inputTxt").disabled=true;document.getElementById("inputTxt").value=DataStore.getAt(d).get("Keyvalue")}else{if(a.indexOf(keyvalueStore.getAt(4).get("value"))!=-1){keyValueOption.setValue(keyvalueStore.getAt(4).get("label"));Ext.getCmp("keyvalueOptions").show();document.getElementById("inputTxt").disabled=true;document.getElementById("inputTxt").value=DataStore.getAt(d).get("Keyvalue")}else{keyValueOption.setValue(keyvalueStore.getAt(0).get("label"));Ext.getCmp("keyvalueOptions").show();document.getElementById("inputTxt").disabled=true;document.getElementById("inputTxt").value=DataStore.getAt(d).get("Keyvalue")}}}}}}}function addnewdata(){var kword="";var recordExists=0;var fieldname=IncidentFieldsCombo.getValue();var fieldlabl=IncidentFieldsCombo.getRawValue();var fieldtype=IncidentTypeFieldsCombo.getRawValue();var keyOptionValue=keyValueOption.getRawValue();var keyOptionV=keyValueOption.getValue();var lkword="";if(fieldname==""){Ext.MessageBox.show({msg:IncidentEmailSettingsPage.Labels.incidentfieldrequired,title:lblMsgTitle,buttons:Ext.MessageBox.OK})}else{if(keyOptionV==""){Ext.MessageBox.show({msg:IncidentEmailSettingsPage.Labels.Emailcontentrequired,title:lblMsgTitle,buttons:Ext.MessageBox.OK})}else{if(fieldtype!="TEXTAREA"&&fieldtype!="STRING"&&(keyOptionV=="Sent"||keyOptionV=="To"||keyOptionV=="Cc"||(keyOptionV=="From"&&fieldtype!="EMAIL"))){Ext.MessageBox.show({msg:IncidentEmailSettingsPage.Labels.InvalidMappingMsg,title:lblMsgTitle,buttons:Ext.MessageBox.OK})}else{if(keyOptionV=="Body"||keyOptionV=="Subject"){kword=document.getElementById("inputTxt").value;kword=Ext.util.Format.htmlEncode(kword)}else{kword=""}lkword=kword.toLowerCase();if(kword.indexOf("#")!=-1||kword.indexOf("%")!=-1){Ext.MessageBox.show({msg:IncidentEmailSettingsPage.Labels.keyworddelimitererror,title:lblMsgTitle,buttons:Ext.MessageBox.OK});return}kword=kword.replace(/"/g,'\\"');dataList="var fieldListData=[";for(var i=0;i<DataStore.data.length;i++){if(DataStore.getAt(i).get("Keyvalue").toLowerCase()==lkword&&lkword!=""){recordExists=1;Ext.MessageBox.show({msg:IncidentEmailSettingsPage.Labels.keyworderror,title:lblMsgTitle,buttons:Ext.MessageBox.OK});return}if(DataStore.getAt(i).get("FieldName")==fieldname&&fieldtype!="TEXTAREA"&&fieldtype!="STRING"){recordExists=1;Ext.MessageBox.show({msg:IncidentEmailSettingsPage.Labels.Fielderror,title:lblMsgTitle,buttons:Ext.MessageBox.OK});return}if(DataStore.getAt(i).get("FieldName")==fieldname&&fieldname=="templatename__c"){recordExists=1;Ext.MessageBox.show({msg:IncidentEmailSettingsPage.Labels.Fielderror,title:lblMsgTitle,buttons:Ext.MessageBox.OK});return}var keywords=DataStore.getAt(i).get("Keyvalue").replace(/"/g,'\\"');dataList+='["'+DataStore.getAt(i).get("Id")+'","'+DataStore.getAt(i).get("FieldName")+'","'+keywords+'","'+replaceSpecialChar(DataStore.getAt(i).get("FieldLabel"))+'","'+DataStore.getAt(i).get("Datatype")+'"],'}if(DataStore.data.length==0){fieldlabl=replaceSpecialChar(fieldlabl);dataList+='["'+keyOptionValue+'","'+fieldname+'","'+kword+'","'+fieldlabl+'","'+fieldtype+'"]];'}else{if(recordExists==0){fieldlabl=replaceSpecialChar(fieldlabl);dataList=dataList.substring(0,dataList.length-1)+',["'+keyOptionValue+'","'+fieldname+'","'+kword+'","'+fieldlabl+'","'+fieldtype+'"]];'}else{dataList=dataList.substring(0,dataList.length-1)}}eval(dataList);DataStore.loadData(fieldListData);resetgrid()}}}}function replaceSpecialChar(a){a=a.replace(/\"/g,"&quot;");a=a.replace(/\'/g,"&#039;");return a}function updateValue(){var a="";var j="";var m=grid.getSelectionModel();var f=m.getSelected();var c=IncidentTypeFieldsCombo.getRawValue();var h=0;var g=IncidentFieldsCombo.getValue();var d=IncidentFieldsCombo.getRawValue();var b=keyValueOption.getRawValue();var k=keyValueOption.getValue();if(k=="Body"||k=="Subject"){a=document.getElementById("inputTxt").value}else{a=""}j=a.toLowerCase();var l=j.replace(/\s/g,"");if(a.indexOf("#")!=-1||a.indexOf("%")!=-1){Ext.MessageBox.show({msg:IncidentEmailSettingsPage.Labels.keyworddelimitererror,title:lblMsgTitle,buttons:Ext.MessageBox.OK});return}if(c!="TEXTAREA"&&c!="STRING"&&(k=="Sent"||k=="To"||k=="Cc"||(k=="From"&&c!="EMAIL"))){Ext.MessageBox.show({msg:IncidentEmailSettingsPage.Labels.InvalidMappingMsg,title:lblMsgTitle,buttons:Ext.MessageBox.OK});return}for(var e=0;e<DataStore.data.length;e++){if(selectedRecord!=e){if(DataStore.getAt(e).get("Keyvalue").toLowerCase()==j&&j!=""){h=1;Ext.MessageBox.show({msg:IncidentEmailSettingsPage.Labels.keyworderror,title:lblMsgTitle,buttons:Ext.MessageBox.OK})}}}if(h==0){f.set("FieldName",g);f.set("FieldLabel",d);f.set("Keyvalue",a);f.set("Datatype",c);f.set("Id",b);document.getElementById("updateButtonId").style.display="none";document.getElementById("removeButtonId").disabled=true;document.getElementById("addButtonId").style.display="inline";document.getElementById("removeButtonId").src=getSDEFStylePath()+"/SDEFbuttons/b_remove_disabled.png";Ext.getCmp("Sgrid").getSelectionModel().clearSelections();resetgrid()}}function moveRecords(c){if(0<grid.getSelectionModel().getSelections().length&&((selectedRecord!=0&&c<0)||(c>0&&selectedRecord<=grid.getStore().getCount()-2))){var b=grid.getSelectionModel().getSelections();if(c<0){selectedRecord--;if(selectedRecord<0){return}}else{selectedRecord++;if(selectedRecord>=grid.getStore().getCount()){return}}for(var a=0;a<=b.length;a++){grid.store.remove(b[a])}grid.store.insert(selectedRecord,b);if(selectedRecord==0){document.images.upbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_U_disable_custom.gif";Ext.getCmp("upbutton").disabled=true;grid.getSelectionModel().selectRow(selectedRecord,true);return}else{document.images.upbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_U_new.gif";Ext.getCmp("upbutton").disabled=false;grid.getSelectionModel().selectRow(selectedRecord,true)}if(selectedRecord==grid.getStore().getCount()-1){document.images.downbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D_disable_custom.gif";Ext.getCmp("downbutton").disabled=true;return}else{document.images.downbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D_new.gif";Ext.getCmp("downbutton").disabled=false}grid.getSelectionModel().selectRow(selectedRecord,true)}}function removeRecord(){var a=grid.getSelectionModel().getSelections();for(var b=0;b<=a.length;b++){grid.store.remove(a[b])}document.getElementById("updateButtonId").style.display="none";document.getElementById("removeButtonId").disabled=true;document.getElementById("addButtonId").style.display="inline";document.getElementById("removeButtonId").src=getSDEFStylePath()+"/SDEFbuttons/b_remove_disabled.png";resetgrid()}function resetgrid(){document.getElementById("inputTxt").disabled=true;document.getElementById("inputTxt").value=IncidentEmailSettingsPage.Labels.Keyword;Ext.getCmp("keyvalueOptions").reset();Ext.getCmp("IncidentFields").reset();document.images.upbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_U_disable_custom.gif";document.images.downbutton.src=getSDEFStylePath()+"/SDEFbuttons/b_darrow_D_disable_custom.gif"}function savegrid(){waitMsg.show();var b="";for(var f=0;f<DataStore.data.length;f++){b+=String.format("{0};,,;{1};,,;{2};,,;{3};;;",DataStore.getAt(f).get("Id"),DataStore.getAt(f).get("FieldName"),DataStore.getAt(f).get("Keyvalue"),DataStore.getAt(f).get("Datatype"))}var l="";if(selectedComboValue=="Staff"||selectedComboValue=="Queue"){if(Ext.getCmp("lookupvalueid").getValue()==""){waitMsg.hide();showMessage(IncidentEmailSettingsPage.Labels.SelectEmailIncidentAssignTo+" "+selectedComboValue);return false}else{var e=selectedComboValue+";"+Ext.getCmp("lookupvalueid").getValue()}}else{var e=selectedComboValue+";"+Ext.getCmp("lookupvalueid").getValue()}var d="";if(document.getElementById("radiotwo").checked==true){d=document.getElementById("incidenttextfield").value;if(d==""){waitMsg.hide();Ext.MessageBox.show({width:250,title:lblMsgTitle,msg:IncidentEmailSettingsPage.Labels.Incidentemailsubjecterror,buttons:Ext.MessageBox.OK});return false}}var m=document.getElementById("saveEmailMsgInActionHistCheckboxId").checked;var h=document.getElementById("createIncidentFromCCValCheckboxId").checked;var j=document.getElementById("includeprefixCheckboxId").checked;var p=document.getElementById("matchWholeWordCheckboxId").checked;if(Ext.getCmp("selectedFieldList1")){var g=Ext.getCmp("selectedFieldList1").store;var k=g.data.length;var n=0;while(k>n){var q=g.getAt(n);n++;if(q.get("value")!="Email"){if(k==n){l=l+q.get("value")}else{l=l+q.get("value")+";"}}}}var o=document.getElementById("incidenttextArea").value;var c=true;if(o.length!=0){if(o.length>32000){c=false;waitMsg.hide();Ext.MessageBox.show({width:300,title:lblMsgTitle,msg:IncidentEmailSettingsPage.Labels.EmailSetting2ErrorMsg1,buttons:Ext.MessageBox.OK})}else{var a=o.split(",");for(var f=0;f<a.length;f++){if(a[f].length<2){c=false;waitMsg.hide();Ext.MessageBox.show({width:300,title:lblMsgTitle,msg:IncidentEmailSettingsPage.Labels.EmailSetting2ErrorMsg,buttons:Ext.MessageBox.OK});break}}}}if(c){SavegridData(b,l,e,d,DelimiterCombovalue,m,h,o,j,p)}}function setData(){ds.loadData(AvailableEmailFields);ds1.loadData(SelectedEmailFields)}function openPopup(a,b){onCompleteFunction=b;popUpWindow=new Ext.Window({height:550,width:670,modal:true,constrain:true,viewConfig:{forceFit:true},html:'<iframe src ="/apex/'+a+'" style="width:100%;height:100%;border:none"/>'});popUpWindow.show()}function showMessage(a){waitMsg.hide();Ext.MessageBox.show({width:250,title:lblMsgTitle,msg:a,buttons:Ext.MessageBox.OK})};