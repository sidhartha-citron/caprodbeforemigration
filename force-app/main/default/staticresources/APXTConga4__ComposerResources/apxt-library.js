Ext.define('Ext.ux.grid.filter.Filter',{extend:'Ext.util.Observable',active:false,dataIndex:null,menu:null,updateBuffer:500,constructor: function(config){Ext.apply(this,config);this.addEvents('activate','deactivate','serialize','update');Ext.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=this.createMenu(config);this.init(config);if(config&&config.value){this.setValue(config.value);this.setActive(config.active!==false,true);delete config.value;}},destroy:function(){if(this.menu){this.menu.destroy();}this.clearListeners();},init:Ext.emptyFn,createMenu:function(config){config.plain=true;return Ext.create('Ext.menu.Menu',config);},getValue:Ext.emptyFn,setValue:Ext.emptyFn,isActivatable:function(){return true;},getSerialArgs:Ext.emptyFn,validateRecord:function(){return true;},serialize:function(){var args=this.getSerialArgs();this.fireEvent('serialize',args,this);return args;},fireUpdate:function(){if(this.active){this.fireEvent('update',this);}this.setActive(this.isActivatable());},setActive:function(active,suppressEvent){if(this.active!=active){this.active=active;if(suppressEvent!==true){this.fireEvent(active?'activate':'deactivate',this);}}}});Ext.define('Ext.ux.grid.FiltersFeature',{extend:'Ext.grid.feature.Feature',alias:'feature.filters',uses:['Ext.ux.grid.menu.ListMenu','Ext.ux.grid.menu.RangeMenu','Ext.ux.grid.filter.BooleanFilter','Ext.ux.grid.filter.DateFilter','Ext.ux.grid.filter.DateTimeFilter','Ext.ux.grid.filter.ListFilter','Ext.ux.grid.filter.NumericFilter','Ext.ux.grid.filter.StringFilter'],autoReload:true,filterCls:'ux-filtered-column',local:false,menuFilterText:'Filters',paramPrefix:'filter',showMenu:true,stateId:undefined,updateBuffer:500,hasFeatureEvent:false,constructor: function(config){var me=this;me.callParent(arguments);me.deferredUpdate=Ext.create('Ext.util.DelayedTask',me.reload,me);me.filters=me.createFiltersCollection();me.filterConfigs=config.filters;},init:function(grid){var me=this,view=me.view,headerCt=view.headerCt;me.bindStore(view.getStore(),true);headerCt.on('menucreate',me.onMenuCreate,me);view.on('refresh',me.onRefresh,me);grid.on({scope:me,beforestaterestore:me.applyState,beforestatesave:me.saveState,beforedestroy:me.destroy});grid.filters=me;grid.addEvents('filterupdate');},createFiltersCollection: function(){return Ext.create('Ext.util.MixedCollection',false, function(o){return o?o.dataIndex:null;});},createFilters:function(){var me=this,hadFilters=me.filters.getCount(),grid=me.getGridPanel(),filters=me.createFiltersCollection(),model=grid.store.model,fields=model.prototype.fields,field,filter,state;if(hadFilters){state={};me.saveState(null,state);}function add(dataIndex,config,filterable){if(dataIndex&&(filterable||config)){field=fields.get(dataIndex);filter={dataIndex:dataIndex,type:(field&&field.type&&field.type.type)||'auto'};if(Ext.isObject(config)){Ext.apply(filter,config);}filters.replace(filter);}}Ext.Array.each(me.filterConfigs, function(filterConfig){add(filterConfig.dataIndex,filterConfig);});Ext.Array.each(grid.columnManager.getColumns(), function(column){if(column.filterable===false){filters.removeAtKey(column.dataIndex);}else{add(column.dataIndex,column.filter,column.filterable);}});me.removeAll();if(filters.items){me.initializeFilters(filters.items);}if(hadFilters){me.applyState(null,state);}},initializeFilters:function(filters){var me=this,filtersLength=filters.length,i,filter,FilterClass;for(i=0;i<filtersLength;i++){filter=filters[i];if(filter){FilterClass=me.getFilterClass(filter.type);filter=filter.menu?filter: new FilterClass(Ext.apply({grid:me.grid},filter));me.filters.add(filter);Ext.util.Observable.capture(filter,this.onStateChange,this);}}},onMenuCreate:function(headerCt,menu){var me=this;me.createFilters();menu.on('beforeshow',me.onMenuBeforeShow,me);},onMenuBeforeShow:function(menu){var me=this,menuItem,filter;if(me.showMenu){menuItem=me.menuItem;if(!menuItem||menuItem.isDestroyed){me.createMenuItem(menu);menuItem=me.menuItem;}filter=me.getMenuFilter();if(filter){menuItem.setMenu(filter.menu,false);menuItem.setChecked(filter.active);menuItem.setDisabled(filter.disabled===true);}menuItem.setVisible(!!filter);this.sep.setVisible(!!filter);}},createMenuItem:function(menu){var me=this;me.sep=menu.add('-');me.menuItem=menu.add({checked:false,itemId:'filters',text:me.menuFilterText,listeners:{scope:me,checkchange:me.onCheckChange,beforecheckchange:me.onBeforeCheck}});},getGridPanel:function(){return this.view.up('gridpanel');},applyState: function(grid,state){var me=this,key,filter;me.applyingState=true;me.clearFilters();if(state.filters){for(key in state.filters){if(state.filters.hasOwnProperty(key)){filter=me.filters.get(key);if(filter){filter.setValue(state.filters[key]);filter.setActive(true);}}}}me.deferredUpdate.cancel();if(me.local){me.reload();}delete me.applyingState;delete state.filters;},saveState: function(grid,state){var filters={};this.filters.each(function(filter){if(filter.active){filters[filter.dataIndex]=filter.getValue();}});return(state.filters=filters);},destroy: function(){var me=this;Ext.destroyMembers(me,'menuItem','sep');me.removeAll();me.clearListeners();},removeAll: function(){if(this.filters){Ext.destroy.apply(Ext,this.filters.items);this.filters.clear();}},bindStore:function(store){var me=this;if(me.store&&me.storeListeners){me.store.un(me.storeListeners);}if(store){me.storeListeners={scope:me};if(me.local){me.storeListeners.load=me.onLoad;}else{me.storeListeners['before'+(store.buffered?'prefetch':'load')]=me.onBeforeLoad;}store.on(me.storeListeners);}else{delete me.storeListeners;}me.store=store;},getMenuFilter: function(){var header=this.view.headerCt.getMenu().activeHeader;return header?this.filters.get(header.dataIndex):null;},onCheckChange: function(item,value){this.getMenuFilter().setActive(value);},onBeforeCheck: function(check,value){return !value||this.getMenuFilter().isActivatable();},onStateChange: function(event,filter){if(event!=='serialize'){var me=this,grid=me.getGridPanel();if(filter==me.getMenuFilter()){me.menuItem.setChecked(filter.active,false);}if((me.autoReload||me.local)&&!me.applyingState){me.deferredUpdate.delay(me.updateBuffer);}me.updateColumnHeadings();if(!me.applyingState){grid.saveState();}grid.fireEvent('filterupdate',me,filter);}},onBeforeLoad: function(store,options){options.params=options.params||{};this.cleanParams(options.params);var params=this.buildQuery(this.getFilterData());Ext.apply(options.params,params);},onLoad: function(store){store.filterBy(this.getRecordFilter());},onRefresh: function(){this.updateColumnHeadings();},updateColumnHeadings: function(){var me=this,headerCt=me.view.headerCt;if(headerCt){headerCt.items.each(function(header){var filter=me.getFilter(header.dataIndex);header[filter&&filter.active?'addCls':'removeCls'](me.filterCls);});}},reload: function(){var me=this,store=me.view.getStore();if(me.local){store.clearFilter(true);store.filterBy(me.getRecordFilter());store.sort();}else{me.deferredUpdate.cancel();if(store.buffered){store.data.clear();}store.loadPage(1);}},getRecordFilter: function(){var f=[],len,i,lockingPartner=this.lockingPartner;this.filters.each(function(filter){if(filter.active){f.push(filter);}});if(lockingPartner){lockingPartner.filters.each(function(filter){if(filter.active){f.push(filter);}});}len=f.length;return function(record){for(i=0;i<len;i++){if(!f[i].validateRecord(record)){return false;}}return true;};},addFilter: function(config){var me=this,columns=me.getGridPanel().columnManager.getColumns(),i,columnsLength,column,filtersLength,filter;for(i=0,columnsLength=columns.length;i<columnsLength;i++){column=columns[i];if(column.dataIndex===config.dataIndex){column.filter=config;}}if(me.view.headerCt.menu){me.createFilters();}else{me.view.headerCt.getMenu();}for(i=0,filtersLength=me.filters.items.length;i<filtersLength;i++){filter=me.filters.items[i];if(filter.dataIndex===config.dataIndex){return filter;}}},addFilters: function(filters){if(filters){var me=this,i,filtersLength;for(i=0,filtersLength=filters.length;i<filtersLength;i++){me.addFilter(filters[i]);}}},getFilter: function(dataIndex){return this.filters.get(dataIndex);},clearFilters: function(){this.filters.each(function(filter){filter.setActive(false);});},getFilterItems: function(){var me=this;if(me.lockingPartner){return me.filters.items.concat(me.lockingPartner.filters.items);}return me.filters.items;},getFilterData: function(){var items=this.getFilterItems(),filters=[],n,nlen,item,d,i,len;for(n=0,nlen=items.length;n<nlen;n++){item=items[n];if(item.active){d=[].concat(item.serialize());for(i=0,len=d.length;i<len;i++){filters.push({field:item.dataIndex,data:d[i]});}}}return filters;},buildQuery: function(filters){var p={},i,f,root,dataPrefix,key,tmp,len=filters.length;if(!this.encode){for(i=0;i<len;i++){f=filters[i];root=[this.paramPrefix,'[',i,']'].join('');p[root+'[field]']=f.field;dataPrefix=root+'[data]';for(key in f.data){p[[dataPrefix,'[',key,']'].join('')]=f.data[key];}}}else{tmp=[];for(i=0;i<len;i++){f=filters[i];tmp.push(Ext.apply({},{field:f.field},f.data));}if(tmp.length>0){p[this.paramPrefix]=Ext.JSON.encode(tmp);}}return p;},cleanParams: function(p){if(this.encode){delete p[this.paramPrefix];}else{var regex,key;regex=new RegExp('^'+this.paramPrefix+'\[[0-9]+\]');for(key in p){if(regex.test(key)){delete p[key];}}}},getFilterClass: function(type){switch(type){case 'auto':type='string';break;case 'int': case 'float':type='numeric';break;case 'bool':type='boolean';break;}return Ext.ClassManager.getByAlias('gridfilter.'+type);}});Ext.define('Ext.ux.grid.TransformGrid',{extend:'Ext.grid.Panel',constructor:function(table,config){config=Ext.apply({},config);table=this.table=Ext.get(table);var configFields=config.fields||[],configColumns=config.columns||[],fields=[],cols=[],headers=table.query("thead th"),i=0,len=headers.length,data=table.dom,width,height,store,col,text,name;for(;i<len;++i){col=headers[i];text=col.innerHTML;name='tcol-'+i;fields.push(Ext.applyIf(configFields[i]||{},{name:name,mapping:'td:nth('+(i+1)+')/@innerHTML'}));cols.push(Ext.applyIf(configColumns[i]||{},{text:text,dataIndex:name,width:col.offsetWidth,tooltip:col.title,sortable:true}));}if(config.width){width=config.width;}else{width=table.getWidth()+1;}if(config.height){height=config.height;}Ext.applyIf(config,{store:{data:data,fields:fields,proxy:{type:'memory',reader:{record:'tbody tr',type:'xml'}}},columns:cols,width:width,height:height});this.callParent([config]);if(config.remove!==false){data.parentNode.removeChild(data);}},onDestroy:function(){this.callParent();this.table.remove();delete this.table;}});Ext.define('Ext.ux.grid.filter.BooleanFilter',{extend:'Ext.ux.grid.filter.Filter',alias:'gridfilter.boolean',defaultValue:false,yesText:'Yes',noText:'No',init: function(config){var gId=Ext.id();this.options=[Ext.create('Ext.menu.CheckItem',{text:this.yesText,group:gId,checked:this.defaultValue===true}),Ext.create('Ext.menu.CheckItem',{text:this.noText,group:gId,checked:this.defaultValue===false})];this.menu.add(this.options[0],this.options[1]);for(var i=0;i<this.options.length;i++){this.options[i].on('click',this.fireUpdate,this);this.options[i].on('checkchange',this.fireUpdate,this);}},getValue: function(){return this.options[0].checked;},setValue: function(value){this.options[value?0:1].setChecked(true);},getSerialArgs: function(){var args={type:'boolean',value:this.getValue()};return args;},validateRecord: function(record){return record.get(this.dataIndex)==this.getValue();}});Ext.define('Ext.ux.grid.filter.DateFilter',{extend:'Ext.ux.grid.filter.Filter',alias:'gridfilter.date',uses:['Ext.picker.Date','Ext.menu.Menu'],afterText:'After',beforeText:'Before',compareMap:{before:'lt',after:'gt',on:'eq'},dateFormat:'m/d/Y',menuItems:['before','after','-','on'],menuItemCfgs:{selectOnFocus:true,width:125},onText:'On',pickerOpts:{},init: function(config){var me=this,pickerCfg,i,len,item,cfg;pickerCfg=Ext.apply(me.pickerOpts,{xtype:'datepicker',minDate:me.minDate,maxDate:me.maxDate,format:me.dateFormat,listeners:{scope:me,select:me.onMenuSelect}});me.fields={};for(i=0,len=me.menuItems.length;i<len;i++){item=me.menuItems[i];if(item!=='-'){cfg={itemId:'range-'+item,text:me[item+'Text'],menu:Ext.create('Ext.menu.Menu',{plain:true,items:[Ext.apply(pickerCfg,{itemId:item,listeners:{select:me.onPickerSelect,scope:me}})]}),listeners:{scope:me,checkchange:me.onCheckChange}};item=me.fields[item]=Ext.create('Ext.menu.CheckItem',cfg);}me.menu.add(item);}me.values={};},onCheckChange: function(item,checked){var me=this,picker=item.menu.items.first(),itemId=picker.itemId,values=me.values;if(checked){values[itemId]=picker.getValue();}else{delete values[itemId]}me.setActive(me.isActivatable());me.fireEvent('update',me);},onInputKeyUp: function(field,e){var k=e.getKey();if(k==e.RETURN&&field.isValid()){e.stopEvent();this.menu.hide();}},onMenuSelect: function(picker,date){var fields=this.fields,field=this.fields[picker.itemId];field.setChecked(true);if(field==fields.on){fields.before.setChecked(false,true);fields.after.setChecked(false,true);}else{fields.on.setChecked(false,true);if(field==fields.after&&this.getFieldValue('before')<date){fields.before.setChecked(false,true);}else if(field==fields.before&&this.getFieldValue('after')>date){fields.after.setChecked(false,true);}}this.fireEvent('update',this);picker.up('menu').hide();},getValue: function(){var key,result={};for(key in this.fields){if(this.fields[key].checked){result[key]=this.getFieldValue(key);}}return result;},setValue: function(value,preserve){var key;for(key in this.fields){if(value[key]){this.getPicker(key).setValue(value[key]);this.fields[key].setChecked(true);}else if(!preserve){this.fields[key].setChecked(false);}}this.fireEvent('update',this);},isActivatable: function(){var key;for(key in this.fields){if(this.fields[key].checked){return true;}}return false;},getSerialArgs: function(){var args=[];for(var key in this.fields){if(this.fields[key].checked){args.push({type:'date',comparison:this.compareMap[key],value:Ext.Date.format(this.getFieldValue(key),this.dateFormat)});}}return args;},getFieldValue:function(item){return this.values[item];},getPicker:function(item){return this.fields[item].menu.items.first();},validateRecord: function(record){var key,pickerValue,val=record.get(this.dataIndex),clearTime=Ext.Date.clearTime;if(!Ext.isDate(val)){return false;}val=clearTime(val,true).getTime();for(key in this.fields){if(this.fields[key].checked){pickerValue=clearTime(this.getFieldValue(key),true).getTime();if(key=='before'&&pickerValue<=val){return false;}if(key=='after'&&pickerValue>=val){return false;}if(key=='on'&&pickerValue!=val){return false;}}}return true;},onPickerSelect:function(picker,date){this.values[picker.itemId]=date;this.fireEvent('update',this);}});Ext.define('Ext.ux.grid.filter.DateTimeFilter',{extend:'Ext.ux.grid.filter.DateFilter',alias:'gridfilter.datetime',dateDefaults:{xtype:'datepicker',format:'m/d/Y'},timeDefaults:{xtype:'timepicker',width:100,height:200,format:'g:i A'},dockDefaults:{dock:'top',buttonText:'Filter'},selectDateToFilter:true,positionDatepickerFirst:true,reTime:/\s(am|pm)/i,reItemId:/\w*-(\w*)$/,addTimeSelection: function(date,timepicker){var me=this,selection=timepicker.getSelectionModel().getSelection(),time,len,fn,val,i=0,arr=[],timeFns=['setHours','setMinutes','setSeconds','setMilliseconds'];if(selection.length){time=selection[0].get('disp');arr=time.replace(me.reTime,'').split(':');for(len=arr.length;i<len;i++){fn=timeFns[i];val=arr[i];if(val){date[fn](parseInt(val,10));}}}return date;},init: function(config){var me=this,dateCfg=Ext.applyIf(me.date||{},me.dateDefaults),timeCfg=Ext.applyIf(me.time||{},me.timeDefaults),dockCfg=me.dock,defaultListeners={click:{scope:me,click:me.onMenuSelect},select:{scope:me,select:me.onMenuSelect}},pickerCtnCfg,i,len,item,cfg,items=[dateCfg,timeCfg],datepickerPosition=0;if(!me.positionDatepickerFirst){items=items.reverse();datepickerPosition=1;}pickerCtnCfg=Ext.apply(me.pickerOpts,{xtype:!dockCfg?'container':'panel',layout:'hbox',items:items});if(!dockCfg){if(me.selectDateToFilter){dateCfg.listeners=defaultListeners.select;}else{timeCfg.listeners=defaultListeners.select;}}else if(dockCfg){me.selectDateToFilter=null;if(dockCfg.dockedItems){pickerCtnCfg.dockedItems=dockCfg.dockedItems;pickerCtnCfg.dockedItems.items[dockCfg.bindToItem||0].listeners=defaultListeners.click;}else{if(Ext.isBoolean(dockCfg)){dockCfg={};}dockCfg=Ext.applyIf(dockCfg,me.dockDefaults);pickerCtnCfg.dockedItems={xtype:'toolbar',dock:dockCfg.dock,items:[{xtype:'button',text:dockCfg.buttonText,flex:1,listeners:defaultListeners.click}]};}}me.fields={};for(i=0,len=me.menuItems.length;i<len;i++){item=me.menuItems[i];if(item!=='-'){pickerCtnCfg.items[datepickerPosition].itemId=item;cfg={itemId:'range-'+item,text:me[item+'Text'],menu:Ext.create('Ext.menu.Menu',{items:pickerCtnCfg}),listeners:{scope:me,checkchange:me.onCheckChange}};item=me.fields[item]=Ext.create('Ext.menu.CheckItem',cfg);}me.menu.add(item);}me.values={};},onCheckChange: function(item,checked){var me=this,menu=item.menu,timepicker=menu.down('timepicker'),datepicker=menu.down('datepicker'),itemId=datepicker.itemId,values=me.values;if(checked){values[itemId]=me.addTimeSelection(datepicker.value,timepicker);}else{delete values[itemId];}me.setActive(me.isActivatable());me.fireEvent('update',me);},onMenuSelect: function(picker,date){var me=this,menu=me.menu,checkItemId=menu.getFocusEl().itemId.replace(me.reItemId,'$1'),fields=me.fields,field;picker=menu.queryById(checkItemId);field=me.fields[picker.itemId];field.setChecked(true);if(field==fields.on){fields.before.setChecked(false,true);fields.after.setChecked(false,true);}else{fields.on.setChecked(false,true);if(field==fields.after&&me.getFieldValue('before')<date){fields.before.setChecked(false,true);}else if(field==fields.before&&me.getFieldValue('after')>date){fields.after.setChecked(false,true);}}me.fireEvent('update',me);picker.ownerCt.ownerCt.hide();},getSerialArgs: function(){var me=this,key,fields=me.fields,args=[];for(key in fields){if(fields[key].checked){args.push({type:'datetime',comparison:me.compareMap[key],value:Ext.Date.format(me.getFieldValue(key),(me.date.format||me.dateDefaults.format)+' '+(me.time.format||me.timeDefaults.format))});}}return args;},setValue: function(value,preserve){var me=this,fields=me.fields,key,val,datepicker;for(key in fields){val=value[key];if(val){datepicker=me.menu.down('datepicker[itemId="'+key+'"]');datepicker.update(val);datepicker.value=val;fields[key].setChecked(true);}else if(!preserve){fields[key].setChecked(false);}}me.fireEvent('update',me);},validateRecord: function(record){var me=this,key,pickerValue,val=record.get(me.dataIndex);if(!Ext.isDate(val)){return false;}val=val.getTime();for(key in me.fields){if(me.fields[key].checked){pickerValue=me.getFieldValue(key).getTime();if(key=='before'&&pickerValue<=val){return false;}if(key=='after'&&pickerValue>=val){return false;}if(key=='on'&&pickerValue!=val){return false;}}}return true;}});Ext.define('Ext.ux.grid.filter.ListFilter',{extend:'Ext.ux.grid.filter.Filter',alias:'gridfilter.list',phpMode:false,init: function(config){this.dt=Ext.create('Ext.util.DelayedTask',this.fireUpdate,this);},createMenu:function(config){var menu=Ext.create('Ext.ux.grid.menu.ListMenu',config);menu.on('checkchange',this.onCheckChange,this);return menu;},getValue: function(){return this.menu.getSelected();},setValue: function(value){this.menu.setSelected(value);this.fireEvent('update',this);},isActivatable: function(){return this.getValue().length>0;},getSerialArgs: function(){return{type:'list',value:this.phpMode?this.getValue().join(','):this.getValue()};},onCheckChange:function(){this.dt.delay(this.updateBuffer);},validateRecord: function(record){var valuesArray=this.getValue();return Ext.Array.indexOf(valuesArray,record.get(this.dataIndex))>-1;}});Ext.define('Ext.ux.grid.filter.NumericFilter',{extend:'Ext.ux.grid.filter.Filter',alias:'gridfilter.numeric',uses:['Ext.form.field.Number'],createMenu:function(config){var me=this,menu;menu=Ext.create('Ext.ux.grid.menu.RangeMenu',config);menu.on('update',me.fireUpdate,me);return menu;},getValue: function(){return this.menu.getValue();},setValue: function(value){this.menu.setValue(value);},isActivatable: function(){var values=this.getValue(),key;for(key in values){if(values[key]!==undefined){return true;}}return false;},getSerialArgs: function(){var key,args=[],values=this.menu.getValue();for(key in values){args.push({type:'numeric',comparison:key,value:values[key]});}return args;},validateRecord: function(record){var val=record.get(this.dataIndex),values=this.getValue(),isNumber=Ext.isNumber;if(isNumber(values.eq)&&val!=values.eq){return false;}if(isNumber(values.lt)&&val>=values.lt){return false;}if(isNumber(values.gt)&&val<=values.gt){return false;}return true;}});Ext.define('Ext.ux.grid.filter.StringFilter',{extend:'Ext.ux.grid.filter.Filter',alias:'gridfilter.string',iconCls:'ux-gridfilter-text-icon',emptyText:'Enter Filter Text...',selectOnFocus:true,width:125,init: function(config){Ext.applyIf(config,{enableKeyEvents:true,labelCls:'ux-rangemenu-icon '+this.iconCls,hideEmptyLabel:false,labelSeparator:'',labelWidth:29,listeners:{scope:this,keyup:this.onInputKeyUp,el:{click:function(e){e.stopPropagation();}}}});this.inputItem=Ext.create('Ext.form.field.Text',config);this.menu.add(this.inputItem);this.menu.showSeparator=false;this.updateTask=Ext.create('Ext.util.DelayedTask',this.fireUpdate,this);},getValue: function(){return this.inputItem.getValue();},setValue: function(value){this.inputItem.setValue(value);this.fireEvent('update',this);},isActivatable: function(){return this.inputItem.getValue().length>0;},getSerialArgs: function(){return{type:'string',value:this.getValue()};},validateRecord: function(record){var val=record.get(this.dataIndex);if(typeof val!='string'){return(this.getValue().length===0);}return val.toLowerCase().indexOf(this.getValue().toLowerCase())>-1;},onInputKeyUp: function(field,e){var k=e.getKey();if(k==e.RETURN&&field.isValid()){e.stopEvent();this.menu.hide();return;}this.updateTask.delay(this.updateBuffer);}});Ext.define('Ext.ux.grid.menu.ListMenu',{extend:'Ext.menu.Menu',idField:'id',labelField:'text',loadingText:'Loading...',loadOnShow:true,single:false,plain:true,constructor: function(cfg){var me=this,options,i,len,value;me.selected=[];me.addEvents('checkchange');me.callParent(arguments);if(!me.store&&!me.options){me.options=me.grid.store.collect(me.dataIndex,false,true);}if(!me.store&&me.options){options=[];for(i=0,len=me.options.length;i<len;i++){value=me.options[i];switch(Ext.type(value)){case 'array':options.push(value);break;case 'object':options.push([value[me.idField],value[me.labelField]]);break;default:if(value!=null){options.push([value,value]);}}}me.store=Ext.create('Ext.data.ArrayStore',{fields:[me.idField,me.labelField],data:options,listeners:{load:me.onLoad,scope:me}});me.loaded=true;me.autoStore=true;}else{me.add({text:me.loadingText,iconCls:'loading-indicator'});me.store.on('load',me.onLoad,me);}},destroy: function(){var me=this,store=me.store;if(store){if(me.autoStore){store.destroyStore();}else{store.un('unload',me.onLoad,me);}}me.callParent();},show: function(){var me=this;if(me.loadOnShow&&!me.loaded&&!me.store.loading){me.store.load();}me.callParent();},onLoad: function(store,records){var me=this,gid,itemValue,i,len,listeners={checkchange:me.checkChange,scope:me};Ext.suspendLayouts();me.removeAll(true);gid=me.single?Ext.id():null;for(i=0,len=records.length;i<len;i++){itemValue=records[i].get(me.idField);me.add(Ext.create('Ext.menu.CheckItem',{text:records[i].get(me.labelField),group:gid,checked:Ext.Array.contains(me.selected,itemValue),hideOnClick:false,value:itemValue,listeners:listeners}));}me.loaded=true;Ext.resumeLayouts(true);me.fireEvent('load',me,records);},getSelected: function(){return this.selected;},setSelected: function(value){value=this.selected=[].concat(value);if(this.loaded){this.items.each(function(item){item.setChecked(false,true);for(var i=0,len=value.length;i<len;i++){if(item.value==value[i]){item.setChecked(true,true);}}});}},checkChange: function(item,checked){var value=[];this.items.each(function(item){if(item.checked){value.push(item.value);}});this.selected=value;this.fireEvent('checkchange',item,checked);}});Ext.define('Ext.ux.grid.menu.RangeMenu',{extend:'Ext.menu.Menu',fieldCls:'Ext.form.field.Number',itemIconCls:{gt:'ux-rangemenu-gt',lt:'ux-rangemenu-lt',eq:'ux-rangemenu-eq'},fieldLabels:{gt:'Greater Than',lt:'Less Than',eq:'Equal To'},menuItemCfgs:{emptyText:'Enter Number...',selectOnFocus:false,width:155},menuItems:['lt','gt','-','eq'],plain:true,constructor: function(config){var me=this,fields,fieldCfg,i,len,item,cfg,Cls;me.callParent(arguments);fields=me.fields=me.fields||{};fieldCfg=me.fieldCfg=me.fieldCfg||{};me.addEvents('update');me.updateTask=Ext.create('Ext.util.DelayedTask',me.fireUpdate,me);for(i=0,len=me.menuItems.length;i<len;i++){item=me.menuItems[i];if(item!=='-'){cfg={itemId:'range-'+item,enableKeyEvents:true,hideEmptyLabel:false,labelCls:'ux-rangemenu-icon '+me.itemIconCls[item],labelSeparator:'',labelWidth:29,listeners:{scope:me,change:me.onInputChange,keyup:me.onInputKeyUp,el:{click:this.stopFn}},activate:Ext.emptyFn,deactivate:Ext.emptyFn};Ext.apply(cfg,Ext.applyIf(fields[item]||{},fieldCfg[item]),me.menuItemCfgs);Cls=cfg.fieldCls||me.fieldCls;item=fields[item]=Ext.create(Cls,cfg);}me.add(item);}},stopFn:function(e){e.stopPropagation();},fireUpdate: function(){this.fireEvent('update',this);},getValue: function(){var result={},fields=this.fields,key,field;for(key in fields){if(fields.hasOwnProperty(key)){field=fields[key];if(field.isValid()&&field.getValue()!==null){result[key]=field.getValue();}}}return result;},setValue: function(data){var me=this,fields=me.fields,key,field;for(key in fields){if(fields.hasOwnProperty(key)){field=fields[key];field.suspendEvents();field.setValue(key in data?data[key]:'');field.resumeEvents();}}me.fireEvent('update',me);},onInputKeyUp:function(field,e){if(e.getKey()===e.RETURN&&field.isValid()){e.stopEvent();this.hide();}},onInputChange:function(field){var me=this,fields=me.fields,eq=fields.eq,gt=fields.gt,lt=fields.lt;if(field==eq){if(gt){gt.setValue(null);}if(lt){lt.setValue(null);}}else{eq.setValue(null);}this.updateTask.delay(this.updateBuffer);}});apxtExt=window.Ext||{};apxt.ns('{base}.data.Environment','apxtEnv', new function(){var win=apxt.getWin(),env=(!!win.apxtData)?win.apxtData.Environment:location.host;if(!win.apxtData)if(env=='localhost')env='local';else if(env.indexOf('beta')!=-1)env='beta';else env='prod';var appHost='composer.congamerge.com';if(env=='local')appHost='localhost';else if(env=='beta')appHost='beta-composer.congamerge.com';return{name:env,appHost:appHost};});apxt.ns('{base}.data.IdGenerator','apxtIdGen', new function(){function toHex(value){return value.toString(16);};function generateGuid(){var guid="{0}{1}-{2}-{3}-{4}-{5}{6}{7}";for(var i=0;i<8;i++){var sec='';for(var b=0;b<4;b++)sec+=toHex(Math.floor((Math.random()*16)));guid=guid.replace('{'+i+'}',sec);}return guid;};return{Guid:generateGuid};});apxt.ns('{base}.text.encoding.Ascii','apxtAscii', new function(){function d(s){var a=[];for(var i=0;i<s.length;++i){a[i]=String.fromCharCode(s[i]);}return a.join('');};function e(s){var u=[];for(var i=0;i<s.length;++i){u.push(s.charCodeAt(i));}return u;};return{decode:d,encode:e};});apxt.ns('{base}.text.encoding.Base64','apxtBase64', new function(){var T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=(function(){var a=[];for(var i=0;i<T.length;++i){a[T.charCodeAt(i)]=i;}a['='.charCodeAt(0)]=0;return a;})();function ea(u){var i=0,a=[],n=0|(u.length/3);while(0<n--){var v=(u[i]<<16)+(u[i+1]<<8)+u[i+2];i+=3;a.push(T.charAt(63&(v>>18)));a.push(T.charAt(63&(v>>12)));a.push(T.charAt(63&(v>>6)));a.push(T.charAt(63&v));}if(2==(u.length-i)){var v=(u[i]<<16)+(u[i+1]<<8);a.push(T.charAt(63&(v>>18)));a.push(T.charAt(63&(v>>12)));a.push(T.charAt(63&(v>>6)));a.push('=');}else if(1==(u.length-i)){var v=(u[i]<<16);a.push(T.charAt(63&(v>>18)));a.push(T.charAt(63&(v>>12)));a.push('==');}return a.join('');};function de(s){var i=0,u=[],n=0|(s.length/4);while(0<n--){var v=(R[s.charCodeAt(i)]<<18)+(R[s.charCodeAt(i+1)]<<12)+(R[s.charCodeAt(i+2)]<<6)+R[s.charCodeAt(i+3)];i+=4;u.push(255&(v>>16));u.push(255&(v>>8));u.push(255&v);}if(u){if('='==s.charAt(i-2)){u.pop();u.pop();}else if('='==s.charAt(i-1)){u.pop();}}return u;};function eas(s){var u=apxt.text.encoding.Ascii.encode(s);return ea(u);};function das(s){var a=de(s);return apxt.text.encoding.Ascii.decode(a);};function eu(s){var u=apxt.text.encoding.Utf8.encode(s);return ea(u);};function du(s){var u=de(s);return apxt.text.encoding.Utf8.decode(u);};return{encodeArray:ea,decodeArray:de,encodeASCII:eas,decodeASCII:das,encodeUTF8:eu,decodeUTF8:du};});apxt.ns('{base}.text.encoding.Utf8','apxtUtf8', new function(){function enc(s){var u=[];for(var i=0;i<s.length;++i){var c=s.charCodeAt(i);if(c<0x80){u.push(c);}else if(c<0x800){u.push(0xC0|(c>>6));u.push(0x80|(63&c));}else if(c<0x10000){u.push(0xE0|(c>>12));u.push(0x80|(63&(c>>6)));u.push(0x80|(63&c));}else{u.push(0xF0|(c>>18));u.push(0x80|(63&(c>>12)));u.push(0x80|(63&(c>>6)));u.push(0x80|(63&c));}}return u;};function dec(u){var a=[];var i=0;while(i<u.length){var v=u[i++];if(v<0x80){}else if(v<0xE0){v=(31&v)<<6;v|=(63&u[i++]);}else if(v<0xF0){v=(15&v)<<12;v|=(63&u[i++])<<6;v|=(63&u[i++]);}else{v=(7&v)<<18;v|=(63&u[i++])<<12;v|=(63&u[i++])<<6;v|=(63&u[i++]);}a.push(String.fromCharCode(v));}return a.join('');};return{encode:enc,decode:dec};});apxt.ns('{base}.text.encoding.Xml','apxtXml', new function(){function enc(s){if(window.ActiveXObject){var oXML=new ActiveXObject("Microsoft.XMLDOM");oXML.loadXML(s);return oXML;}else{return(new DOMParser()).parseFromString(s,"text/xml");}};function dec(x){if(window.ActiveXObject){var oString=x.xml;return oString;}else{return(new XMLSerializer()).serializeToString(x);}};return{encode:enc,decode:dec};});apxt.ns('{base}.data.url.Params','apxtParams', function(config){apxt.Object.apply(config||{},this);var me=this,qBuild=function(){me.queryString='?'+apxt.Object.encodeQuerystring(me.items);},finalDecode=function(value){if(apxt.Object.isArray(value))for(var i=0;i<value.length;i++)value[i]=finalDecode(value[i]);else if(typeof(value)=='object')for(var key in value)value[key]=finalDecode(value[key]);else if(typeof(value)=='string'){value=value.replace(/\+/g,' ');}return value;},toLowerCase=function(ar){var nar={};for(var k in ar)nar[k.toLowerCase()]=ar[k];return nar;};me.each=function(func,scope){if(!scope)scope=this;for(var key in me.items)func.apply(scope,[key,me.items[key]]);};me.getParam=function(name){if(!name)return null;name=name.toLowerCase();var p=null;for(var key in me.items)if(key==name)p=me.items[key];return p;};me.getAllParams=function(){return me.items;};me.getParamValue=function(name){if(!name)return null;name=name.toLowerCase();return me.items[name]||'';};me.setParam=function(name,value,overwrite){if(!name)return null;name=name.toLowerCase();var param=me.items[name];if(!param)me.items[name]=value;else if(overwrite)me.items[name]=value;else{if(typeof param=='string')me.items[name]=[param,value];else me.items[name].push(value);}qBuild();return me.getParam(name);};me.addParam=function(params){if(!params)return null;if(apxt.Object.isArray(params)){for(i=0;i<params.length;i++)if(typeof params[i]=='object')apxt.Object.apply(params[i],me.items);}else if(typeof params=='object'){if(params.items!=undefined)apxt.Object.apply(params.items,me.items);else apxt.Object.apply(params,me.items);}else if(typeof params=='string')apxt.Object.apply(apxt.Object.decodeQuerystring(params),me.items);me.items=toLowerCase(me.items);qBuild();return this.items;};me.delParam=function(name){if(!name)return null;name=name.toLowerCase();delete me.items[name];qBuild();};me.delParams=function(params){for(var i in params)me.delParam(params[i]);};me.clearParams=function(){me.items=[];qBuild();};me.hasParam=function(name){var val=me.getParamValue(name);if(!!val&&val.length>0)return true;return false;};if(!!me.queryString){me.queryString=me.queryString.replace(/[\n\r\t]/g,'');me.items=apxt.Object.decodeQuerystring(this.queryString);var lparams={};for(var key in me.items)lparams[key.toLowerCase()]=finalDecode(me.items[key]);me.items=lparams;}else me.items={};qBuild();return me;}).prototype={queryString:null,items:null,getParam:apxt.emFn,setParam:apxt.emFn,delParam:apxt.emFn,clearParams:apxt.emFn,hasParam:apxt.emFn};apxt.ns('{base}.data.url.Url','apxtUrl', function(config){apxt.Object.apply(config||{},this);var me=this,parseUrl=function(){if(!!me.url){var tmp=me.url;me.isRoot=false;me.isRelative=false;if(tmp.indexOf('://')!=-1)me.protocol=tmp.substring(0,tmp.indexOf('://')).toLowerCase();else if(tmp.indexOf('/')==0){me.isRoot=true;me.isRelative=true;}else me.isRelative=true;if(me.protocol=='https')me.isSecure=true;var start=(!me.isRoot&&!me.isRelative)?(tmp.indexOf('://')+3):0;tmp=tmp.substring(start);if(me.isRelative)me.host='';else if(tmp.indexOf('/')==-1)me.host=tmp;else me.host=tmp.substring(0,tmp.indexOf('/'));me.host=me.host.toLowerCase();if(me.host=='localhost')me.isLocal=true;if(tmp!=me.host){if(!me.isRelative)tmp=tmp.substring(tmp.indexOf('/'));if(tmp.indexOf('?')!=-1){var qString=tmp.substring(tmp.indexOf('?'));tmp=tmp.substring(0,tmp.indexOf('?'));if(qString.indexOf('#')!=-1){me.hash=qString.substring(qString.indexOf('#'));qString=qString.substring(0,qString.indexOf('#'));}me.params=new apxt.data.url.Params({queryString:me.queryString||qString});}delete me.queryString;if(tmp.indexOf('#')!=-1){me.hash=tmp.substring(tmp.indexOf('#'));tmp=tmp.substring(0,tmp.indexOf('#'));}if(tmp.indexOf('/')!=-1&&tmp.lastIndexOf('/')!=tmp.length-1){if(tmp.indexOf('.')>tmp.lastIndexOf('/')){var tmpPage=tmp.substring(tmp.lastIndexOf('/')+1);if(tmpPage.match(/\.[a-z]{2,3}$/)){me.page=tmpPage;tmp=tmp.substring(0,tmp.lastIndexOf('/')+1);}}}me.path=tmp;if(tmp.indexOf('/')==0)tmp=tmp.substring(1);if(tmp.lastIndexOf('/')==tmp.length-1)tmp=tmp.substring(0,tmp.length-1);me.pathSections=tmp.split('/');}if(!me.params)me.params=new apxt.data.url.Params({queryString:''});var prtIndx=me.host.indexOf(':');if(prtIndx!=-1){me.port=me.host.substring(prtIndx+1);me.host=me.host.substring(0,prtIndx);}var test=me.host.match(/[0-z]+\.[a-z]{3}$/);if(test==null)test=me.host.match(/[0-z]+\.[a-z]{2}\.[a-z]{2}$/);if(test!=null){me.domain=test[0];me.subdomain=me.host.replace('.'+me.domain,'');me.topLevelDomain=me.domain.substring(me.domain.lastIndexOf('.')+1);}else{me.domain=me.host;}if(apxt.data.LocationUrl!=null){if(apxt.data.LocationUrl.domain.length>0)if(apxt.data.LocationUrl.domain!=me.domain)me.isCrossDomain=true;else if(apxt.data.LocationUrl.subdomain!=null&&apxt.data.LocationUrl.subdomain!=me.subdomain&&apxt.browser.Agent.isIE)me.isCrossDomain=true;}me.hashData={};if(me.hash!=null){try{me.hashData=apxt.data.conversion.Object.decodeQuerystring(me.hash.substring(1));}catch(e){}}}};parseUrl();me.getUrl=function(q){var url=me.getUrlNoPage()+((me.page!=null)?me.page:'');if(q==undefined||q==null)q=true;if(me.params!=null&&!!q&&me.params.queryString!="?")url+=me.params.queryString;return url;};me.getUrlNoPage=function(){var url='';if(!!me.protocol&&me.protocol.length>0)url=me.protocol+'://';url+=((me.host!=null)?me.host:'')+((me.port!=null)?':'+me.port:'')+((me.path!=null)?me.path:'');return url;};me.getUrlNoQuery=function(){return me.getUrlNoPage()+((me.page!=null)?me.page:'');};me.getQueryString=function(){return me.params.queryString;};me.getAllParams=function(){return me.params.items;};me.getParam=function(name){return me.params.getParam(name);};me.getParamValue=function(name){return me.params.getParamValue(name);};me.setParam=function(name,value,overwrite){return me.params.setParam(name,value,overwrite);};me.addParam=function(params){return me.params.addParam(params);};me.delParam=function(name){return me.params.delParam(name);};me.delParams=function(params){return me.params.delParams(params);};me.hasParam=function(name){return me.params.hasParam(name);};me.clearParams=function(){return me.params.clearParams();};me.clone=function(){return new apxtUrl({url:me.getUrl()});};return me;}).prototype={url:null,protocol:null,host:null,port:null,domain:null,subdomain:null,topLevelDomain:null,path:null,pathSections:null,page:null,isRoot:false,isRelative:false,isSecure:false,isCrossDomain:false,isLocal:false,params:null,hash:null,hashData:null,getUrl:apxt.emFn,getUrlNoQuery:apxt.emFn,getUrlNoPage:apxt.emFn,getParam:apxt.emFn,getParamValue:apxt.emFn,setParam:apxt.emFn,addParam:apxt.emFn,delParam:apxt.emFn,hasParam:apxt.emFn,clearParams:apxt.emFn,clone:apxt.emFn};apxt.data.url.Url.supportsDataUri=false;apxt.data.url.Url.checkDataUriSupport=function(){var data=new Image();data.onload=data.onerror=function(){if(this.width!=1||this.height!=1)apxt.data.url.Url.supportsDataUri=false;else apxt.data.url.Url.supportsDataUri=true;};data.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";};apxt.data.url.Url.checkDataUriSupport();apxt.data.LocationUrl=new apxtUrl({url:location.href});locationUrl=apxt.data.LocationUrl;apxt.ns('{base}.data.ajax.Request', function(config){apxt.Object.apply(config,this);var me=this,xhr=null,state=0,getXhr=function(cors){if(window.XMLHttpRequest){xhr=new XMLHttpRequest();if(cors&& typeof XDomainRequest!=null&&apxt.browser.Agent.isIE)xhr=new XDomainRequest();else if(cors){me.exception={name:'Error',message:'Unable to support cross origin calls.'};return;}}else xhr=new ActiveXObject('Microsoft.XMLHTTP');setXhrMethods();},setXhrMethods=function(){if(typeof xhr=='XDomainRequest'){xhr.onerror=error;}else if(typeof xhr=='XMLHttpRequest'){xhr.onabort=abort;xhr.onloadstart=loadStart;}if(xhr.ontimeout!=undefined)xhr.ontimeout=config.timeout||timeout;if(xhr.onprogress!=undefined)xhr.onprogress=progress;if(me.async)if(xhr.onloadend==undefined)xhr.onreadystatechange=function(e){if(xhr.readyState==4)loadEnd(e);};else xhr.onloadend=loadEnd;},setHeaders=function(){if(!!me.headers)for(var key in me.headers)xhr.setRequestHeader(key,me.headers[key]);},loadEnd=function(){requestReturn();},abort=function(e){if(!me.exception)me.exception={name:'Error',message:'The request was aborted.'};requestReturn();},timeout=function(e){if(!me.exception)me.exception={name:'Error',message:'The request timed out.'};requestReturn();},error=function(e){alert(e);if(!me.exception)me.exception={name:'Error',message:'The request had an error.'};me.status=500;me.statusText='500 Server Error';requestReturn();},loadStart=function(e){},progress=function(e){var perc=-1;if(e.lengthComputable)perc=e.loaded/e.total;},requestReturn=function(){if(state>0){state=0;me.responseType=xhr.responseType;try{me.responseHeaders=xhr.getAllResponseHeaders();}catch(e){}var resp=xhr.response||xhr.responseText;if(me.binaryResponse==true&&!bootstrapper.browser.isIE){var bytes=Array.prototype.map.call(resp, function(c){return c.charCodeAt(0)&0xff;});resp="";for(var c=0;c<bytes.length;c++)resp+=String.fromCharCode(bytes[c]);}me.response=resp;me.responseText=xhr.responseText;me.responseXML=xhr.responseXML;if(me.status==0){me.status=xhr.status||200;me.statusText=xhr.statusText||'200 OK';}me.runtime=new Date()-me.loadStart;if(!!me.callback)me.callback.apply(me.scope||me,[me]);}};me.send=function(){me.exception=null;me.startDate=new Date();try{var url=me.url.getUrl();xhr.open(me.method,url,me.async);if(xhr.timeout!=undefined)xhr.timeout=me.timeout;setHeaders();state=1;if(!me.data)xhr.send();else xhr.send(me.data);}catch(ex){alert(ex);me.exception=ex;requestReturn();}if(!me.async)requestReturn();return me;};me.abort=function(){if(state==1){try{xhr.abort();}catch(ex){}me.exception={name:'Abort',message:'The request was aborted.'};requestReturn();}};if(!!me.data&& typeof me.data=='object')me.data=JSON.stringify(me.data);if(typeof(me.url)=='string')me.url=new apxtUrl({url:me.url});var cors=me.url.isCrossDomain;if(!!me.allowCrossDomain)cors=false;getXhr(cors);if(me.binaryResponse==true){if(xhr.overrideMimeType!=undefined)xhr.overrideMimeType('text/plain; charset=x-user-defined');if(apxt.browser.Agent.isIE)me.url.addParam({binary:'iso-8859-1'});}me.scope=me.scope||me;return me;}).prototype={exception:null,data:null,method:'GET',headers:null,timeout:120000,binaryResponse:false,status:0,statusText:'',response:null,responseText:null,responseXml:null,responseType:null,responseHeaders:null};apxt.ns('{base}.data.Connection','apxtConn', function(config){apxt.Object.apply(config,this);var me=this;me.call=function(c){c=c||{};var updUrl=me.url.clone();if(!!me.params)updUrl.addParam(me.params);if(c.cacheBuster==undefined||c.cacheBuster==true)updUrl.addParam({_dc:apxt.data.IdGenerator.Guid()});if(!!c.params)updUrl.addParam(c.params);var d=me.data;if(!!c.data)d=c.data;var m=me.method;if(!!c.method)m=c.method;var a=me.async;if(!!c.async)a=c.async;var c=me.callReturn;if(!!c.callReturn)c=c.callReturn;var h=me.headers||{};if(!!c.headers)for(var key in c.headers)h[key]=c.headers[key];if(!h["Content-Type"]){var ctype="application/json";switch(me.type){case "xml":ctype="application/xml";break;}h["Content-Type"]=ctype;}var bin=false;if(me.type=='raw')bin=true;var req=new apxt.data.ajax.Request({method:m,url:updUrl,async:a,callback:(me.async)?c:null,headers:h,data:d,timeout:c.timeout||120000,binaryResponse:bin||false,allowCrossDomain:me.allowCrossDomain});if(!!req.exception)c(req);else if(me.async)return req.send();else return c(req.send());};me.callReturn=function(response){var returnObj;var success=false;try{switch(me.type){case 'xml':returnObj=response.responseXml;if(!!returnObj)success=true;break;case 'html':returnObj=response.responseText;break;case 'element':returnObj=new apxtExt.dom.Element(response.responseText,true);break;case 'text':returnObj=response.responseText;break;case 'panel':returnObj=new apxtExt.panel.Panel({html:response.responseText});break;case 'blob':returnObj=new Blob([response.response]);break;case 'arraybuffer':returnObj=response.response;break;case 'document':returnObj=response.response;break;case 'ext': case 'json':returnObj=JSON.parse(response.responseText);break;case 'raw':default:returnObj=response.response;break;}}catch(ex){if(!response.exception)response.exception={name:'Parse Error',message:'Failed to parse the response. '+(ex.message||ex)};}if(response.status>=200&&response.status<300){if(!!returnObj)success=true;}if(me.type=='ext'&&success)if(!returnObj.success)success=false;me.start=response.start;me.runtime=response.runtime;if(response.status!=200&&!me.callback){return null;}if(!!me.callback){var args=[returnObj,success,me.scope,response.exception];me.callback.apply(me.scope,args);}return returnObj;};if(typeof(me.url)=='string')me.url=new apxtUrl({url:me.url});return me;}).prototype={url:null,params:null,headers:{},async:true,method:'GET',type:'json',callback:null,call:null,callReturn:null,scope:this,includeGlobal:false};apxt.ns("{base}.utils.QuickPost",'apxtQuickPost', new function(){function post(cfg){var f,p,i='',b;for(p in cfg.params)i+='<input type="hidden" name="'+p+'" value="'+cfg.params[p]+'" />';f=document.createElement('form');f.innerHTML=i;b=cfg.body||document.body;b.appendChild(f);f.setAttribute("action",cfg.url);f.setAttribute("method","POST");cfg.target=cfg.target||'_self';f.setAttribute("target",cfg.target);f.submit();};return{post:post};});apxt.ns('{base}.process.CallbackManager', function(config){var me=this,win=apxt.getWin(),findCallback=function(guid){for(var i=0;i<me.callbacks.length;i++){if(me.callbacks[i].guid==guid)return me.callbacks[i];}},getCallbackIndex=function(guid){indx=-1;for(var i=0;i<me.callbacks.length;i++)if(me.callbacks[i].guid==guid)indx=i;return indx;},onMessage=function(msg){if(!msg.data)return;if(!msg.data.callbackId)return;if(!msg.data.data)msg.data.data={error:'error',error_description:'There was an unknown error.'};var rslt=me.runCallback(msg.data.callbackId,msg.data.data);if(!!msg.data.returnId)msg.source.postMessage({callbackId:msg.data.returnId,data:rslt},msg.origin);};me.addCallback=function(c,s,i,p){var guid=(!!i)?i:apxt.data.IdGenerator.Guid(),entry={guid:guid,callback:c,scope:s||me,params:p};me.callbacks.push(entry);return guid;};me.getCallback=function(guid){var entry=findCallback(guid);return entry.callback;};me.popCallback=function(guid){var entry=findCallback(guid);var callback=entry.callback;me.callbacks.splice(getCallbackIndex(guid),1);return callback;};me.runCallback=function(guid){var me=this,entry=findCallback(guid),args=[];if(!entry)return false;me.popCallback(guid);for(var i=1;i<arguments.length;i++)args.push(arguments[i.toString()]);if(!!entry.params)args.push(entry.params);try{if(!!entry.callback){entry.callback.apply(entry.scope,args);return true;}}catch(ex){return ex;}return false;};me.callbacks=[];apxt.dom.Dom.addListener('message',apxt.getWin(),onMessage);return me;});apxtCallback=new apxt.process.CallbackManager();apxt.ns('{base}.security.OAuthWindow', function(config){apxt.Object.apply(config,this);var me=this,chkCnt=0,oAuthQueryTpl='?response_type={response_type}&client_id={client_id}&redirect_uri={redirect_uri}&display={display}&scope={scope}&state={state}&prompt={prompt}',authReturned=false,monitorAuthorization=function(win,guid){chkCnt++;if(!!win){if(!win.closed&&chkCnt==1){try{if(win.location.href.indexOf(location.host)>-1)win.focus();}catch(ignore){}}if(win.closed){return setTimeout(function(){if(!authReturned)badAuthorization(win,guid,"win_closed");},1000);}else if(chkCnt>600)return badAuthorization(win,guid,"no_response");else return setTimeout(function(){monitorAuthorization(win,guid);},50);}else{if(chkCnt>200)return badAuthorization(win,guid,"no_window");else return setTimeout(function(){monitorAuthorization(win,guid);},50);}},badAuthorization=function(win,guid,err){var data={error:err,error_description:(err=="no_window")?"The OAuth window did not popup. Please ensure you have popups enabled.":(err=="no_response")?"The process timed out while waiting for the OAuth window to reply.":"The OAuth window was closed without a user response."};try{if(!!win)win.close();}catch(ex){}apxtCallback.runCallback(guid,data);},oauthCallReturn=function(data,config){if(!authReturned){authReturned=true;if(!!config.callback)config.callback.apply(config.scope||apxt.getWin(),[data]);else{}}};me.call=function(config){chkCnt=0;authReturned=false;var redirect=config.redirect_uri,guid=apxtCallback.addCallback(oauthCallReturn,me,null,config),url=config.oAuthUrl+oAuthQueryTpl,win=null;apxt.Object.applyIf({left:window.screenX+(window.outerWidth/2)-331,top:window.screenY+(window.outerHeight/2)-245,width:700,height:565},config);url=apxt.String.apply(config,url);win=apxtWin.openWithLoadingMask({title:config.title||'Authorizing',url:url,windowName:config.windowName||'CongaAuthorize',options:apxt.String.apply('left={left},top={top},width={width},height={height}',config),overwrite:true});setTimeout(function(){monitorAuthorization(win,guid);},50);};return me;});apxt.ns('{base}.security.CongaSession','apxtCongaSession', function(config){config=config||{};var me=this,win=apxt.getWin(),isOwnWin=(win.top==win),capp=win["congaApp"]||{},auto=(apxt.Object.isNothing(config.auto))?true:config.auto,sid=(auto)?locationUrl.getParamValue('sessionid'):config.sessionId,surl=(auto)?locationUrl.getParamValue('serverurl'):config.serverUrl,rtkn=(auto)?locationUrl.getParamValue('refreshtoken'):config.refreshtoken,shost=null,tgtOrgn=config.targetOrigin,instId=(auto)?locationUrl.getParamValue('instanceid'):config.instanceId,instUrl=(auto)?locationUrl.getParamValue('instanceurl'):config.instanceUrl,idUrl=(auto)?locationUrl.getParamValue('idurl'):config.idUrl,params=(auto)?locationUrl.params.getAllParams():config.parameters||{},oauthUrl=(auto)?capp.oAuthUrl:config.oauthUrl,clientId=(auto)?capp.clientId:config.clientId,displayType=((auto)?capp.displayType:config.displayType)||'popup',source=((auto)?capp.source:config.source)||'sfdc',scope=config.scope||'full web',sfdcVersion=(auto||!config.sfdcVersion)?capp.sfdcVersion||'31.0':config.sfdcVersion,sfdcSoapTpl=(auto||!config.sfdcSoapTpl)?'https://{proxy}{host}/services/Soap/u/v{version}/{orgId}':config.sfdcSoapTpl,sfdcOAuthTpl='https://{host}/services/oauth2/authorize',apiTpl=(auto||config.apiTemplate)?capp.apiTemplate:config.apiTemplate,sfdcApiTmpl=(auto||!!config.sfdcApiTmpl)?'https://{proxy}{host}/services/data/v{version}/':config.sfdcApiTmpl,lastError=null;function initSession(){if(!!surl&&!tgtOrgn)tgtOrgn='https://'+shost;if(!hasSession())if(!processHash()){if(isOwnWin){win.location=oauthUrl+locationUrl.getQueryString();return;}else if(!!win.Sfdc&&!!win.Sfdc.canvas){loginSfdc();return;}else if(!apxt.String.isNullOrEmpty(sid)&&!apxt.String.isNullOrEmpty(surl)){return;}else{runOAuth({callback:loginSfdcCallback,oAuthUrl:apxt.String.apply(sfdcOAuthTpl,{host:shost})});return;}}initParameters();};function hasSession(){if((!apxt.String.isNullOrEmpty(sid)||!apxt.String.isNullOrEmpty(rtkn))&&!!surl)return(me.isLoggedIn=true);return(me.isLoggedIn=false);};function processHash(){if(!!locationUrl.hashData["access_token"]){sid=locationUrl.hashData["access_token"];if(!surl&&!!locationUrl.hashData["instanceUrl"]){instUrl=locationUrl.hashData["instanceUrl"];var basePath=apxt.String.apply(basePathTpl,{orgId:sid.substring(15),version:sfdcVersion});surl=new apxtUrl({url:instUrl,path:basePath});tgtOrgn=locationUrl.hashData["targetOrigin"];instId=locationUrl.hashData["instanceId"];}rtkn=locationUrl.hashData["refreshToken"];}return hasSession();};function loginSfdc(){var win=apxt.getWin(),guid=apxtCallback.addCallback(loginSfdcCallback,me);Sfdc.canvas.oauth.login({uri:Sfdc.canvas.oauth.loginUrl(),params:{response_type:"code",client_id:config.clientId||clientId,display:displayType,prompt:null,scope:scope,state:source+guid+clientId,redirect_uri:encodeURIComponent(oauthUrl)}});};function runOAuth(config){var win=apxt.getWin(),guid=apxtCallback.addCallback(config.callback,me,null),cid=config.clientId||clientId,ppc=0,state=(config.source||source)+guid+cid,oauth=new apxt.security.OAuthWindow({response_type:config.response_type||"code",client_id:cid,display:config.displayType||displayType,prompt:config.prompt||null,scope:scope,state:state,redirect_uri:encodeURIComponent(config.redirectUri||oauthUrl),oAuthUrl:config.oAuthUrl});oauth.call();};function loginSfdcCallback(data){if(!!data){sid=data.sessionId;if(!!data.serverUrl)surl=new apxtUrl({url:data.serverUrl});rtkn=data.refreshToken;if(!!data.error)lastError=data.error+'\n'+data.error_description;else initParameters(data);}me.isLoggedIn=hasSession();};function initParameters(data){location.setSearchData(data);locationUrl=new apxtUrl({url:location.href});if(!apxt.String.isNullOrEmpty(params["params"])){var p=params["params"];getParameters(p, function(data){apxt.Object.apply(data,params);runCallback();});return;}runCallback();};function getParameters(paramId,callback){me.callCongaApi({method:'GET',type:'ext',scope:callback,callback:getParametersReturn,apiMethod:'Parameter',id:paramId});};function getParametersReturn(response,success){var data=null;if(success&&!!response.results)data=response.results[0];this.apply(me,[data]);};function getClient(){var client=Sfdc.canvas.oauth.client();client.targetOrigin=tgtOrgn;client.instanceId=instId;client.instanceUrl=instUrl;apxt.Object.applyIf({oauthToken:sid,refresh:rtkn},client);return client;};function runCallback(){locationUrl.delParam('refreshtoken');locationUrl.delParam('instanceurl');locationUrl.delParam('sessionid');locationUrl.delParam('serverurl');locationUrl.delParam('instanceid');locationUrl.delParam('idUrl');locationUrl.delParam('targetorigin');me.OrgId=sid.substring(0,15);me.UserId=(!!idUrl)?idUrl.substring(idUrl.lastIndexOf('/')+1):null;me.Id=locationUrl.getParamValue('id');if(!!config.callback)config.callback.apply(config.scope||this,[me,me.isLoggedIn,lastError]);};function onMessage(msg){if(msg.returnValue&&msg.origin==tgtOrgn){var data=JSON.parse(msg.data),payload=data.payload;if(!!payload.status&&payload.status!=200)payload={error:payload.statusText};if(!!payload.payload)payload=payload.payload;apxtCallback.runCallback(data.seq,payload);return;}};function postSfdc(module,body,callback){var cbid=apxtCallback.addCallback(callback,this),msg={seq:cbid,src:'client',clientVersion:sfdcVersion,targetModule:module,body:body};parent.postMessage(JSON.stringify(msg),"*");};me.isLoggedIn=false;me.getSessionParams=function(){return params;};me.getCongaApiUrl=function(cfg){var id=(cfg.id===undefined)?params[id]:(cfg.id===null)?"null":cfg.id,urlText=apxt.String.apply(apiTpl,apxt.Object.applyIf(cfg,{method:cfg.apiMethod,id:id,host:config.host||win.location.host})),url=new apxtUrl({url:urlText});if(!!cfg.includeToken)url.addParam({token:sid,serverUrl:surl.getUrl()});if(!!cfg.extraParams)url.addParam(cfg.extraParams);var textUrl=url.getUrl();textUrl=textUrl.replace("/null","");textUrl=textUrl.replace("null","");return textUrl;};me.createCongaApiConn=function(config){var url=me.getCongaApiUrl(config);config.url=url;config.headers=config.headers||{};apxt.Object.apply({Authorization:'Bearer '+sid,"X-Server-Url":surl.getUrl(),"Cache-Control":'no-cache,no-store,must-revalidate',Accept:'application/json'},config.headers);return new apxtConn(config);};me.callCongaApi=function(config){var conn=me.createCongaApiConn(config);return conn.call();};me.getCongaApiProxy=function(config){var url=me.getCongaApiUrl(config),proxy=new apxtExt.data.proxy.Ajax({url:url,extraParams:config.params,headers:{Authorization:'Bearer '+sid,"X-Server-Url":surl.getUrl(),"Cache-Control":'no-cache,no-store,must-revalidate',Accept:'application/json'},reader:{type:'json',rootProperty:'results',successProperty:'success',totalProperty:'total'}});return proxy;};me.callSfdcApi=function(config){};me.fireSfdcEvent=function(event,args){var msg={event:event,arguments:args};top.postMessage(JSON.stringify(msg),'*');};me.getCanvasContext=function(callback,module){postSfdc(module||'Canvas',{type:'ctx',accessToken:sid,config:{client:getClient()}},callback);};me.getSessionId=function(){return sid;};me.getServerUrl=function(){return surl.getUrl();};me.runOAuth=runOAuth;me.getCanvasClient=getClient;me.getInstanceUrl=function(){return instUrl;};me.getParameters=getParameters;apxt.dom.Dom.addListener('message',apxt.getWin(),onMessage);if(!!surl)shost=((surl=new apxtUrl({url:surl})).host);initSession();return me;});apxtExt.define('apxt.utils.PostMe', function(){var defaults={target:'Composer',server:'www',page:'https://{server}.appextremes.com/apps/Conga/PointMerge.aspx',height:700,width:500},appendLoader=function(win){var style='<style>body{width: 100%;height: 100%;background:#eeeeee;margin:0px;} html {width: 100%;height: 100%;} .apxt-main-background{font-family: Cambria Arial Sans-Serif;background: #FFFFFF;margin: 0;padding: 0;width: 100%;height: 100%;} #apxt-main{text-align: center;padding: 0;margin: 0;width: 100%;height: 100%;border: 0px;} #apxt-main-loading-area{width:100%;top:50%;position:fixed;} #apxt-main-loading-image{background: url("https://d1x31vk703fwnw.cloudfront.net/apxtlibraryjs/resources/images/apxt-main-loading.gif") no-repeat center;}</style>',child='<div id="apxt-main-loading-area"><center><table width="140"><tr><td>Loading ...</td></tr><tr><td><div id="apxt-main-loading-image">&nbsp</div></td></tr></table></center></div></div>',div=win.document.createElement('div');div.innerHTML=style+child;div.id="apxt-main";win.document.body.appendChild(div);},createForm=function(win,cfg){var form=win.document.createElement('form');var html="";for(var name in cfg.params)html+=getTextParameter({name:name,value:cfg.params[name]});form.innerHTML=html;win.document.body.appendChild(form);form.setAttribute("action",getActionUrl(cfg));form.setAttribute("method","POST");form.setAttribute("target",cfg.target);return form;},getActionUrl=function(cfg){return cfg.page.replace('{server}',cfg.server);},getTextParameter=function(param){if(typeof(param.value)=='object')param.value=apxt.data.encoding.Object.Encode(param.value);return apxtExt.String.format('<input type="hidden" name="{0}" id="{0}" value="{1}" />',param.name,param.value);},createTextUrl=function(cfg){var url=getActionUrl(cfg),params=decodeURIComponent(apxt.Object.encodeQuerystring(cfg.params));url+='</br>?'+params.replace(/&/g,'</br>&').replace(/,/g,'</br>,');return url;};return{singleton:true,showMask:true,post: function(cfg){apxtExt.applyIf(cfg,defaults);if(!!cfg.url){var url=new apxtUrl({url:cfg.url});cfg.params=url.getAllParams();cfg.page=url.getUrl(false);}if(cfg.useNewWindow==undefined)cfg.useNewWindow=true;var win=self;if(cfg.useNewWindow)win=window.open('',cfg.target,apxtExt.String.format('scrollbars=no,menubar=no,height={0},width={1},resizable=yes,toolbar=no,status=no',cfg.width,cfg.height));appendLoader(win);var form=createForm(win,cfg);setTimeout(function(){form.submit();},250);if(!!cfg.debug){var textUrl=createTextUrl(cfg),debugWin=window.open('','PostMeDebug','scrollbars=no,menubar=no,height=400,width=600,resizable=yes,toolbar=no,status=no');debugWin.document.body.innerHTML=textUrl;}}}});apxt.ns('{base}.utils.Window','apxtWin', new function(c){var me=this,w=null,loadTime=0,chkCnt=0,returned=false,loadImageUrl=apxt.Constants.get(28);apxt.Object.apply(c,me);function addMask(win,msg){var bdy=win.document.getElementsByTagName('body')[0];apxt.dom.Style.applyStyles(bdy,{width:'100%',height:'100%',margin:'0px'});apxt.dom.Dom.createEl({tag:'div',document:win.document,target:bdy,style:{backgroundColor:'#f0f0f0',position:'absolute',padding:'0px',margin:'0px',width:'100%',height:'100%'},items:[{tag:'div',style:{display:'table',position:'absolute',height:'48px',width:'200px',top:'50%',left:'50%',marginTop:'-24px',marginLeft:'-100px',backgroundPosition:'1% 50%',backgroundRepeat:'no-repeat',padding:'7px 10px 7px 60px',backgroundImage:'Url('+loadImageUrl+')'},items:[{tag:'div',attributes:{innerHTML:msg},style:{display:'table-cell',verticalAlign:'middle',fontSize:'14px',fontWeight:'bold'}}]}]});};function init(){me.closed=false;loadTime=0;chkCnt=0;returned=false;me.exception=null;};function openWindow(cfg){w=window.open('about:blank',cfg.windowName||'_blank',cfg.options||'',cfg.overwrite||true);};function opening(cfg){loadTime+=50;if(!!w&&w.closed==false){if(loadTime<350)setTimeout(function(){opening(cfg);},50);else monitor(cfg);}else{if(loadTime<350)callback(false,'security',cfg);}};function monitor(cfg){chkCnt++;if(!!w){if(!w.closed){try{if(!!w.location&&!!w.location.host&&w.location.host.indexOf(location.host)>-1)w.blur();}catch(e){}}if(w.closed){return setTimeout(function(){if(!returned)callback(true,null,cfg);},1000);}else if(chkCnt>600)return callback(false,'timeout',cfg);else return setTimeout(function(){monitor(cfg);},50);}else{if(chkCnt>200)return callback(false,'blocked',cfg);else return setTimeout(function(){monitor(cfg);},50);}};function callback(success,ex,cfg){returned=true;me.closed=true;if(!!ex)switch(ex){case "timeout":me.exception={error:ex,error_description:'The operation timed out while waiting for authorization.'};break;case "blocked":me.exception={error:ex,error_description:'It appear the OAuth popup window was blocked by a popup blocker.'};break;case "security":me.exception={error:ex,error_description:'The OAuth popup window could not be accessed; add https://*.salesforce.com to the list of Trusted Sites.'};break;default:me.exception={error:'error',error_description:'There was an issue with the authorization.'};break;}if(!!cfg.callback)cfg.callback.apply(cfg.scope||me,[success,me.exception]);};return{openWithLoadingMask: function(cfg){init();openWindow(cfg);try{addMask(w,cfg.title||'Loading');}catch(e){}try{w.location.href=cfg.url;}catch(e){me.exception=e;return me;}setTimeout(function(){opening(cfg);},50);return me;}};});Ext.override(Ext.String,{isNullOrEmpty: function(string){if(!!string&&string.length>0)return false;return true;}});Ext.override(Ext.view.Table,{getRecord: function(node){node=this.getNode(node);if(node){return this.dataSource.data.get(node.getAttribute('data-recordId'));}},indexInStore: function(node){node=this.getNode(node,true);if(!node&&node!==0){return -1;}return this.dataSource.indexOf(this.getRecord(node));}});Ext.override(Ext.dom.Element,{mask: function(msg,cls,height){var maskCls;if(Ext.isObject(cls)){maskCls=cls.maskCls;cls=cls.cls;}var maskEl=this.callParent([msg,cls,height]);maskCls&&maskEl.addCls(maskCls);return maskEl;}});Ext.override(Ext.String,{trimChar: function(value,char){var searchStart=new RegExp('^'+char+'+','gi'),searchEnd=new RegExp(char+'+$','gi');value=value.replace(searchStart,'');value=value.replace(searchEnd,'');return value;}});Ext.override(Ext.data.proxy.Server,{encodeFilters: function(filters){var min=[],length=filters.length,i=0;for(;i<length;i++){min[i]={property:filters[i].property,value:filters[i].value,operator:filters[i].comparison||filters[i].operator};}return this.applyEncoding(min);}});Ext.override(Ext.ux.grid.FiltersFeature,{createMenuItem:function(menu){var me=this;me.sep=menu.add('-');me.menuItem=menu.add({checked:false,itemId:'filters',text:me.menuFilterText,listeners:{scope:me,checkchange:me.onCheckChange,beforecheckchange:me.onBeforeCheck}});}});apxtExt.define('apxt.file.File',{mixins:{observable:'apxtExt.util.Observable'},alternateClassName:'apxtFile',fileName:'file.txt',contentType:'application/octet-stream',currentLength:0,fileLength:0,fileUrl:null,isSaveSupported:false,constructor: function(config){this.mixins.observable.constructor.call(this,config);apxtExt.apply(this,config);var me=this,fileData=[],defaultContentType='application/octet-stream',view=null,isBlobSupported=(function(){try{return !!Blob&&!!Blob.constructor;}catch(ex){return false;}})(),isFileReaderSupported=(function(){try{return !!FileReader&&!!FileReader.constructor;}catch(ex){return false;}})(),urlObj=null,doc=apxt.getDoc(),saveLink=null,isSaveLinkSupported=false,reqFs=null,saveFunc=null,getView=function(){if(!!window)return window;else return apxtExt.androidWindow;},useSaveLink=function(data,fileName){var url=getFileUrl(data);saveLink.href=url;saveLink.download=fileName;var event=doc.createEvent("MouseEvents");event.initMouseEvent("click",true,false,view,0,0,0,0,0,false,false,false,false,0,null);saveLink.dispatchEvent(event);finishSave(url);},useFsAlt=function(data,fileName){if(isFileReaderSupported)useFileReader(data,fileName);else{var url=getFileUrl(data);me.download(url);finishSave(url);}},useFileReader=function(data,fileName){var reader=new FileReader();reader.onload=function(event){me.download(event.target.result);me.fireEvent('complete',[me]);};reader.readAsDataURL(data);},useFs=function(data,fileName){reqFs(view.TEMPORARY,data.length, function(fs){fsCallback(fs,data,fileName);}, function(ex){fsFailCallback(ex,data,fileName);});},getSaveFunc=function(){if(me.getMaxSize()<me.fileLength&&me.fileLength>0)return null;if(apxt.browser.Agent.isIE10h)return saveMS;else if(apxtExt.isIE9m)return null;else if(isSaveLinkSupported)return useSaveLink;else if(!reqFs)return useFsAlt;else return useFs;},getUrlObj=function(){return view.URL||view.webkitURL||view;},getFileUrl=function(data){return urlObj.createObjectURL(data);},fsCallback=function(fs,data,fileName){var dir=fs.root;dir.getFile(fileName,{create:false}, function(file){fsDeleteFile(file,data,fileName);}, function(ex){fsFailCallback(ex,data,fileName);});dir.getFile(fileName,{create:true,exclusive:false}, function(file){fsSaveFile(file,data,fileName);}, function(ex){fsFailCallback(ex,data,fileName);});},fsFailCallback=function(ex,data,fileName){if(ex.code===ex.NOT_FOUND_ERR){fsSaveFile();}else{useFsAlt(data,fileName);}},fsDeleteFile=function(file,data,fileName){file.remove();fsSaveFile(file,data,fileName);},fsSaveFile=function(file,data,fileName){file.createWriter(function(writer){writer.onwriteend=function(event){view.location.href=file.toURL();finishSave(file);};writer.onerror=function(){var error=writer.error;if(error.code!==error.ABORT_ERR){useFsAlt(data,fileName);}};writer.write(data);}, function(ex){fsFailCallback(ex,data,fileName);});},saveMS=function(blob,name){var retVal=navigator.msSaveOrOpenBlob(blob,name);if(retVal===false)me.exception='An unknown exception occurred while downloading the file(IE).';finishSave();},finishSave=function(file){if(!!file)setTimeout(function(){if(typeof file==="string"){urlObj.revokeObjectURL(file);}else{file.remove();}},100);me.fireEvent('complete',[me]);};me.appendBase64=function(data,seq){me.append(apxt.text.encoding.Base64.decodeArray(data),seq);};me.append=function(data,seq){var array=new Uint8Array(data);fileData[seq-1]=array;};me.getFileData=function(){if(isBlobSupported)return new Blob(fileData,{type:me.contentType});return apxtExt.Array.flatten(fileData);};me.download=function(url){view.location.href=url||me.fileUrl;};me.saveFile=function(fileName){fileName=fileName||me.fileName;saveFunc(me.getFileData(),fileName);};me.getMaxSize=function(){if(apxt.browser.Agent.isIE10h)return 629145600;else if(apxtExt.firefoxVersion>=20)return 838860800;return 361758720;};view=getView();saveLink=doc.createElementNS("http://www.w3.org/1999/xhtml","a");isSaveLinkSupported=!view.externalHost&&"download" in saveLink;urlObj=getUrlObj();reqFs=view.requestFileSystem||view.webkitRequestFileSystem||view.mozRequestFileSystem;saveFunc=getSaveFunc();me.isSaveSupported=(!!saveFunc);return me;}});Ext.define('apxt.layout.FlipCard',{extend:'Ext.layout.container.Card',alias:'layout.flipcard',deferredRender:false,hideInactive:false,flipDirection:'up',flipDuration:'1.0s',flipEasing:'linear',flipOrigin:'150px 150px',flipFlop:false,flipPerspective:'auto',constructor: function(){var me=this,hasFirstLayout=false,flipped=false,axis='Y',changeDeg=180,ownCt,setPerspective=function(cmp,val){var el=cmp.getEl&&cmp.getEl().dom||cmp.dom,per=(me.flipPerspective=='auto')?val:me.flipPerspective;apxt.dom.Style.applyStyles(el,{webkitPerspective:per,webkitPerspectiveOrigin:me.flipOrigin,mozPerspective:per,mozPerspectiveOrigin:me.flipOrigin,msPerspective:per,msPerspectiveOrigin:me.flipOrigin,oPerspective:per,oPerspectiveOrigin:me.flipOrigin,perspective:per,perspectiveOrigin:me.flipOrigin});},setTransformStyle=function(cmp,val){var el=cmp.getEl&&cmp.getEl().dom||cmp.dom;apxt.dom.Style.applyStyles(el,{webkitTransformStyle:val,MozTransformStyle:val,msTransformStyle:val,OTransformStyle:val,transformStyle:val});},setTransition=function(cmp){var el=cmp.getEl&&cmp.getEl().dom||cmp.dom;apxt.dom.Style.applyStyles(el,{webkitTransition:'-webkit-transform '+me.flipDuration+' '+me.flipEasing+' !important',mozTransition:'-moz-transform '+me.flipDuration+' '+me.flipEasing+' !important',msTransition:'-ms-transform '+me.flipDuration+' '+me.flipEasing+' !important',oTransition:'-o-transform '+me.flipDuration+' '+me.flipEasing+' !important',transition:'transform '+me.flipDuration+' '+me.flipEasing+' !important'});},unsetTransition=function(cmp){var el=cmp.getEl&&cmp.getEl().dom||cmp.dom;apxt.dom.Style.applyStyles(el,{webkitTransition:'-webkit-transform  0s ease 0s !important',mozTransition:'-moz-transform  0s ease 0s !important',msTransition:'-ms-transform  0s ease 0s !important',oTransition:'-o-transform  0s ease 0s !important',transition:'transform  0s ease 0s !important'});},setBackfaceVisibility=function(cmp,val){var el=cmp.getEl&&cmp.getEl().dom||cmp.dom;apxt.dom.Style.applyStyles(el,{webkitBackfaceVisibility:val,mozBackfaceVisibility:val,msBackfaceVisibility:val,oBackfaceVisibility:val,backfaceVisibility:val});},setTransform=function(cmp,val){var el=cmp.getEl&&cmp.getEl().dom||cmp.dom;apxt.dom.Style.applyStyles(el,{webkitTransform:val,mozTransform:val,msTransform:val,oTransform:val,transform:val});},setFlipFace=function(cmp){var el=cmp.getEl&&cmp.getEl().dom||cmp.dom;apxt.dom.Style.applyStyles(el,{position:'absolute !important',boxSizing:'border-box !important'});if(!apxt.browser.Agent.isIE)setBackfaceVisibility(cmp,'hidden');},bringForward=function(cmp){var el=cmp.getEl&&cmp.getEl().dom||cmp.dom;apxt.dom.Style.applyStyles(el,{zIndex:'99999999 !important',visibility:'visible !important'});},sendBackward=function(cmp){var el=cmp.getEl&&cmp.getEl().dom||cmp.dom;apxt.dom.Style.applyStyles(el,{zIndex:'99 !important',visibility:'visible !important'});},sendBack=function(cmp){var el=cmp.getEl&&cmp.getEl().dom||cmp.dom;apxt.dom.Style.applyStyles(el,{zIndex:'-1 !important',visibility:'hidden !important'});},flip=function(newCard){flipTransition1(newCard);setTimeout(flipTransition2,20);setTimeout(flipTransition3,40);},flipTransition1=function(newCard){var owner=me.owner,curIndx=owner.items.indexOf(me.activeItem),newIndx=owner.items.indexOf(newCard),cardCnt=me.owner.items.items.length-1,direction=newIndx==0&&curIndx==cardCnt&&'forward'||curIndx<newIndx&&'forward'||'backward';if(!me.flipFlop&&((flipped&&direction=='forward')||(!flipped&&direction=='backward'))){unsetTransition(me.owner);flipCard();}flipFaces(newIndx,curIndx);},flipTransition2=function(){setTransition(me.owner);},flipTransition3=function(){flipCard();},flipCard=function(){setTransform(me.owner,getFlipVal(flipped));flipped=!flipped;},getFlipVal=function(flip){var deg=(!flip)?changeDeg:0;return 'rotate'+axis+'('+deg+'deg)';},flipFaces=function(newIndx,oldIndx){var owner=me.owner,newCard=owner.items.items[newIndx],oldCard=owner.items.items[oldIndx];setTransform(newCard,getFlipVal(flipped));bringForward(newCard);setTransform(oldCard,getFlipVal(!flipped));sendBackward(oldCard);for(var i=0;i<owner.items.items.length;i++){var card=owner.items.items[i];if(i!=newIndx&&i!=oldIndx){var trans=getFlipVal(!flipped);sendBack(card);setTransform(card,trans);}}},getPerspectiveSize=function(cmp){cmp=cmp.getEl&&cmp.getEl()||cmp;switch(me.flipDirection){case 'right': case 'left': case 'top': case 'bottom': return cmp.getWidth()+'px';break;case 'up': case 'down':default: return cmp.getHeight()+'px';break;}},firstLayout=function(){hasFirstLayout=true;ownCt=me.owner.getEl().up('div');setTransformStyle(me.owner,'preserve-3d');setTransition(me.owner);me.setFlipDirection(me.flipDirection);me.activeItem=me.owner.items.items[0];var items=me.owner.items.items;for(var i=0;i<items.length;i++)if(items[i].rendered)setFlipFace(items[i]);},beginLayout=function(){if(!hasFirstLayout)firstLayout();var size=getPerspectiveSize(this.owner);setPerspective(ownCt,size);};me.doBeginLayout=function(){beginLayout.apply(this,arguments);};me.setFlipDirection=function(direction){me.flipDirection=direction;switch(me.flipDirection){case 'right': case 'left':axis='Y';break;case 'top': case 'bottom':axis='Z';break;case 'down': case 'up':default:axis='X';break;}switch(me.flipDirection){case 'right': case 'top': case 'up':default:changeDeg=180;break;case 'left': case 'bottom': case 'down':changeDeg=-180;break;}};me.setActiveItem=function(newCard){var owner=me.owner,oldCard=me.activeItem,nextCard,rendered=owner.rendered,cardIndex;newCard=me.parseActiveItem(newCard);cardIndex=owner.items.indexOf(newCard);if(cardIndex==-1){cardIndex=owner.items.items.length;Ext.suspendLayouts();newCard=owner.add(newCard);Ext.resumeLayouts();}if(cardIndex>=owner.items.items.length-1)nextCard=owner.items.items[0];else nextCard=owner.items.items[cardIndex+1];if(newCard&&oldCard!=newCard){if(newCard.fireEvent('beforeactivate',newCard,oldCard)===false){return false;}if(oldCard&&oldCard.fireEvent('beforedeactivate',oldCard,newCard)===false){return false;}if(rendered){Ext.suspendLayouts();if(!newCard.rendered){me.renderItem(newCard,me.getRenderTarget(),owner.items.length);setFlipFace(newCard);}if(oldCard){if(me.hideInactive||!!apxt.browser.Agent.isIE){oldCard.hide();oldCard.hiddenByLayout=true;}oldCard.fireEvent('deactivate',oldCard,newCard);}if(newCard.hidden){newCard.show();}flip(newCard);if(!newCard.hidden){me.activeItem=newCard;}Ext.resumeLayouts(true);}else{me.activeItem=newCard;}newCard.fireEvent('activate',newCard,oldCard);me.owner.fireEvent('itemchange',me,newCard,oldCard);return me.activeItem;}return false;};this.callParent(arguments);},beginLayout: function(){this.doBeginLayout(arguments);this.callParent(arguments);}});apxtExt.define('apxt.button.ClipButton',{extend:'apxtExt.button.Button',alias:'widget.clipbutton',statics:{defaults:{flashPath:'../apxtlibraryjs/resources/flash/ClipButton.swf',callback:'ClipButtonCallback'},eventCallback: function(eventName,args){var comp=apxtExt.ComponentQuery.query('#'+args.id)[0];if(!!comp){var event=new Ext.EventObjectImpl();event.setEvent.apply(event,[args]);event.button=0;event.type=eventName;switch(eventName){case 'mousedown':comp.onMouseDown.apply(comp,[event]);break;case 'mouseup':comp.onMouseUp.apply(comp,[event]);break;case 'mouseover':comp.onMouseOver.apply(comp,[event]);break;case 'mouseout':comp.onMouseOut.apply(comp,[event]);break;}comp.fireEvent.apply(comp,[eventName,comp,event]);}}},constructor: function(cfg){var me=this,htmlTpl=null,wait=new Ext.util.DelayedTask(setFlash,me,[],true),getHtmlTplText=function(){var protocol=location.href.match(/^https/i)?'https://':'http://';if(apxt.browser.Agent.isIE)return '<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+protocol+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="{width}" height="{height}" id="{id}" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="{flashPath}" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="{clipParams}"/><param name="wmode" value="transparent"/></object>';else return '<embed id="{id}" name="{id}" src="{flashPath}" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="{width}" height="{height}" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="'+protocol+'www.macromedia.com/go/getflashplayer" flashvars="{clipParams}" wmode="transparent" />';},hasFlash=function(){try{if(!! new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return true;}catch(error){if(!!navigator.mimeTypes["application/x-shockwave-flash"])return true;}return false;},initFlash=function(){if(hasFlash()&&!apxtExt.get('apxt-clipbutton-flash-div')){var params=apxt.Object.encodeQuerystring({callback:me.clipOptions.callback}),flashHtml=htmlTpl.apply({id:'apxt-clipbutton-flash',flashPath:me.clipOptions.flashPath,width:1,height:1,clipParams:params}),div=document.createElement('div');div.id='apxt-clipbutton-flash-div';div.style.position='absolute';div.style.left='0px';div.style.top='0px';div.style.width='1px';div.style.height='1px';div.style.zIndex=99999;div.innerHTML=flashHtml;document.body.appendChild(div);window.ClipButtonCallback=apxt.button.ClipButton.eventCallback;}},mouseOver=function(e){wait.delay(250,setFlash,[e]);},setFlash=function(e){resetPosition();setText();setId();me.fireEvent('mouseover',arguments);},mouseOut=function(e){wait.delay(250,resetFlash);},resetFlash=function(){var div=apxtExt.get('apxt-clipbutton-flash-div');div.setLeftTop(0,0);div.setSize(1,1);},resetPosition=function(){var div=apxtExt.get('apxt-clipbutton-flash-div'),flash=apxtExt.get('apxt-clipbutton-flash'),size=me.getSize(),pos=me.getPosition();if(!!div){div.setSize(size.width,size.height);flash.setSize(size.width,size.height);div.setLeftTop(pos[0],pos[1]);try{document['apxt-clipbutton-flash'].setSize(size.width,size.height);}catch(ex){}}},setText=function(){try{document['apxt-clipbutton-flash'].setText(me.getCopyText(me));}catch(ex){}},setId=function(){try{document['apxt-clipbutton-flash'].setId(me.getId());}catch(ex){}};me.clipOptions={};me.getCopyText=function(btn){return 'Test text';};htmlTpl=new apxtExt.Template(getHtmlTplText());if(!arguments[0].listeners)arguments[0].listeners={};apxtExt.apply(arguments[0].listeners,{'mouseover':mouseOver,'mouseout':mouseOut});apxtExt.apply(this,cfg);apxtExt.applyIf(me.clipOptions,apxt.button.ClipButton.defaults);this.callParent(arguments);initFlash();}});apxtExt.define('apxt.button.ToolBtn',{extend:'apxtExt.Component',alias:'widget.toolbtn',width:22,height:22,cls:'x-tool x-tool-default',initComponent: function(){var me=this,enabled=true,tpl='<img class="x-tool-img {toolCls}" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" />',toolCls='',boxready=function(box){this.getEl().applyStyles('padding-top:3px;padding-left:3px;');box.mon(box.getEl(),'mouseover',onMouseOver,box);box.mon(box.getEl(),'mouseout',onMouseOut,box);box.mon(box.getEl(),'click',onClick,box);me.setToolType(me.toolType);if(!apxtExt.String.isNullOrEmpty(me.tip))createTip();},createTip=function(){var config=me.tip;if(apxtExt.isString(me.tip)){config={target:me.getEl(),autoHide:true,dismissDelay:0,showDelay:1000,html:me.tip,renderTo:'apxt-main-body',anchor:'left'};}var tip=apxtExt.create('apxtExt.tip.ToolTip',config);},onMouseOver=function(){if(me.isDisabled()==false){}},onMouseOut=function(){if(me.isDisabled()==false){}},onClick=function(e){if(me.isDisabled()==false)me.fireEvent('click',me,e);};me.setToolType=function(toolType){me.toolType=toolType;toolCls='apxt-ext-tools-'+toolType;me.update({toolCls:toolCls});};me.tpl=tpl;this.callParent(arguments);me.addListener('afterrender',boxready);}});Ext.define('apxt.form.field.ClearableTextField',{extend:'Ext.form.field.Text',alias:'widget.clearabletextfield',afterSubTpl:'<div class="apxt-clearabletextfield-trigger">&nbsp;</div>',onRender: function(){var me=this;me.callParent(arguments);me.on({change: function(field,newVal){var bodyEl=field.bodyEl;if(newVal.length>0){bodyEl.addCls('apxt-field-populated');}else{bodyEl.removeCls('apxt-field-populated');}},click:{fn: function(){me.reset();me.focus();},element:'bodyEl',delegate:'.apxt-clearabletextfield-trigger'}});}});apxtExt.define('apxt.process.DebugLog',{constructor: function(config){apxtExt.apply(this,config);var me=this,logEntries=[],lastLog=0,sendLog=false,sendLogEntries=function(){if(logEntries.length>lastLog){for(var i=lastLog;i<logEntries.length;i++){try{if(sendLog==true){var conn=new apxtConn({url:me.url,data:logEntries[lastLog],method:'POST'});conn.call();}}catch(e){}lastLog++;}}setTimeout(sendLogEntries,5000);};me.addLogEntry=function(title,data){var entry={LogTitle:title,LogData:data,LogDate: new Date()};if(!!me.options)for(var i=0;i<me.options.length;i++)entry[me.options[i]]=me.scope[me.options[i]];logEntries.push(entry);};me.getLogList=function(){return logEntries;};me.setSendLog=function(p){sendLog=p||false;};if(typeof me.url=='string')me.url=new apxtUrl({url:me.url});if(!me.scope)me.scope=window;if(!!config.sendLog&&(config.sendLog==true||config.sendLog.toLowerCase()=='true'))sendLog=true;setTimeout(sendLogEntries,5000);return this;}});apxtExt.define('apxt.process.ErrorManager',{mixins:{observable:'apxtExt.util.Observable'},constructor: function(config){this.mixins.observable.constructor.call(this,config);apxtExt.apply(config,this);var me=this,errList=[],lastErr=0,sendError=false,sendErrors=function(){if(errList.length>lastErr){for(var i=lastErr;i<errList.length;i++){try{if(sendError==true){var conn=new apxtConn({url:me.url,data:errList[lastErr],method:'POST'});conn.call();}}catch(e){}lastErr++;}}setTimeout(sendErrors,5000);};me.addError=function(err){var time=new Date(),method=me.addError.caller;if(!err)return false;if(Ext.isString(err))err={msg:err};if(method){if(method.$name&&!err.sourceMethod)err.sourceMethod=method.$name;if(method.$owner&&!err.sourceClass)err.sourceClass=method.$owner.$className;}err.errorTime=time;err.sentToServer=false;if(!!me.options)for(var i=0;i<me.options.length;i++)err[me.options[i]]=me.scope[me.options[i]];errList.push(err);me.fireEvent('errorAdded',err);if(!!err.raise&&err.raise==true){delete err.raise;throwerr;}};me.getErrorList=function(){return errList;};me.setSendErrors=function(p){sendError=p||false;};this.mixins.observable.constructor.call(this,config);this.addEvents('errorAdded','errorSent');if(!!config.sendErrors&&(config.sendErrors==true||config.sendErrors.toLowerCase()=='true'))sendError=true;if(typeof me.url=='string')me.url=new apxtUrl({url:me.url});if(!me.scope)me.scope=window;window.onerror=function(msg,file,line){me.addError({msg:msg,file:file,line:line,handled:false});};setTimeout(sendErrors,5000);return this;}});apxt.ns('{base}.culture.Translate','apxtTranslate', function(cfg){var me=this,translations=cfg.translations,culture=(!!cfg.culture)?cfg.culture.toLowerCase():'en',url=new apxtUrl({url:cfg.url});function getTranslations(){var conn=new apxtConn({url:url,callback:returnTranslataions});conn.send();};function returnTranslataions(success,response){if(success){translations=response;}};me.ref=function(refId,def){var value=def;if(translations.hasOwnProperty(refId))if(translations[refId].hasOwnProperty(culture)&&translations[refId][culture].length>0)return translations[refId][culture];else return translations[refId]['en'];return value;};me.setCulture=function(cul){culture=cul.toLowerCase();};});apxtExt.define('apxt.panel.MainPnl',{extend:'apxtExt.panel.Panel',alias:'widget.mainpnl',id:'apxt-main-body-scrn',renderTo:'apxt-main-body',baseCls:'',layout:{type:'card',align:'stretch'},initComponent: function(){var me=this,initPanel=function(pnl){pnl.fireEvent('initpanel');},addScreens=function(){var scrns=window["congaApp"].screens;me.items=[];for(var i=0;i<scrns.length;i++)me.items.push(scrns[i]);};addScreens();this.callParent(arguments);me.addListener('boxready',initPanel)}});apxtExt.define('apxt.panel.Screen',{extend:'apxtExt.Container',alias:'widget.screen',margin:'0px',padding:'0px',flex:1,bodyMargin:'5px',bodyBorder:'border-top: 1px solid #dbdbdb',backgroundColor:'background-color:#f8f8f8 !important',baseCls:'',initComponent: function(){var me=this,items=[],bodyItems=[],ready=function(scrn){};me.setTitle=function(title,activate){var titlePnl=me.down('titlepnl');if(!!titlePnl)titlePnl.setTitle(title,activate);};me.updateMessage=function(message){if(!!message&&apxtExt.isString(message))message={MessageText:message,MessageSeverity:'Error'};var titlePnl=me.down('titlepnl');if(!!titlePnl)titlePnl.updateMessage(message);};me.showMask=function(message,icon){apxt.Mask.hide();apxt.Mask.show({msg:message,opacity:0.90,target:'apxt-main-body',icon:icon});};me.hideMask=function(){apxt.Mask.hide();};me.disableContent=function(){me.down('[itemId="screenBody"]').disable();};me.enableContent=function(){me.down('[itemId="screenBody"]').enable();};me.layout={type:'vbox',align:'stretch'};if(!!me.headerHtml||!!me.headerType)items.push({xtype:me.headerType||'box',height:40,margin:'0px 5px 0px 5px',html:me.headerHtml||''});if(!!me.screenTitle)bodyItems.push({xtype:'titlepnl',height:36,text:(!!me.screenTitle)?me.screenTitle.text:null,endText:(!!me.screenTitle)?me.screenTitle.endText:null,hidden:(!me.screenTitle)});bodyItems.push({xtype:'container',itemId:'screenBody',style:apxt.String.apply('background-color:{backgroundColor};box-sizing:content-box;',me),layout:me.itemLayout||'hbox',margin:me.bodyMargin,flex:1,items:me.items});items.push({xtype:'container',flex:1,layout:{type:'vbox',align:'stretch'},style:apxt.String.apply('background-color:{backgroundColor};{bodyBorder};',me),items:bodyItems});me.items=items;this.callParent(arguments);this.addListener('boxready',ready);}});apxtExt.define('apxt.panel.TitlePnl',{extend:'apxtExt.panel.Panel',alias:'widget.titlepnl',height:35,width:'100%',border:false,layout:{type:'card',align:'stretch'},style:'background-color:#f8f8f8;overflow:hidden !important;',bodyStyle:'background-color:#f8f8f8;',initComponent: function(){var me=this,task=new Ext.util.DelayedTask(grow,me,null,true),ready=function(box){},mouseover=function(e,t){if(me.getLayout().getActiveItem().xtype=='messagecmp'&&e.getXY()[0]<me.getWidth()-40)task.delay(100,grow);},mouseout=function(e,t){if(me.getLayout().getActiveItem().xtype=='messagecmp')task.delay(100,shrink);},grow=function(){var h=me.getLayout().getActiveItem().down('box[itemId="message-text"]').getEl().dom.scrollHeight+10;me.animate({to:{height:h}});},shrink=function(){me.animate({to:{height:35}});};me.setTitle=function(title,activate){activate=(!!activate)?activate:false;me.items.items[0].update(title);if(!!activate)me.getLayout().setActiveItem(0);};me.updateMessage=function(message,closable){if(!message)me.getLayout().setActiveItem(0);else{me.items.items[1].updateMessage(message,closable);me.getLayout().setActiveItem(1);}};if(!me.text)me.text='';if(!me.endText)me.endText='';if(!!me.title)me.title=null;me.items=[{xtype:'box',margin:'5px 5px 0px 5px',width:'100%',style:'text-align:left;background-color:transparent;',tpl:'<table width="100%"><tr><td><span class="apxt-title-name">{text}</span></td><td align="right" style="font-size: 80%;">{endText}</td></tr></table>',data:{text:me.text,endText:me.endText}},{xtype:'messagecmp',width:'100%',margin:'5px 5px 0px 5px',listeners:{close: function(){me.setHeight(35);me.getLayout().setActiveItem(0);},expand:grow,collapse:shrink}}];this.callParent(arguments);me.addListener('boxready',ready);}});apxt.ns('{base}.component.ChevronBar', function(cfg){var me=this,innerHtml,suspendResize=false,cnst=apxt.Constants.get,parent=cfg.renderTo||apxt.getBody(),chevCont,tipCont,highCnt,skew=(!apxt.Object.isNothing(cfg.skew))?cfg.skew:30,height=cfg.height||30,visibleItems,offset,offsetR,isOver=false,tipVisible=false,sizeTask,tipTask,stubItem={},stubWidth=50,gap=cfg.gap||2,gradStart='bottom',dir=cfg.direction||'left',tpl=['<div class="{baseCls}-content apxt-noselect">','{title}','</div>','<div class="{baseCls}-chevron-horiz upper"></div>','<div class="{baseCls}-chevron-horiz lower"></div>'],lowerTpl=['transform:skew{axis}({lowerDeg}deg);','-ms-transform:skew{axis}({lowerDeg}deg);','-webkit-transform:skew{axis}({lowerDeg}deg);','-moz-transform:skew{axis}({lowerDeg}deg);','-o-transform:skew{axis}({lowerDeg}deg);'],upperTpl=['transform:skew{axis}({upperDeg}deg);','-ms-transform:skew{axis}({upperDeg}deg);','-webkit-transform:skew{axis}({upperDeg}deg);','-moz-transform:skew{axis}({upperDeg}deg);','-o-transform:skew{axis}({upperDeg}deg);'],cntntTpl=['overflow:hidden;','margin-left:{offset}px;','margin-right:{offset}px;','max-height:{maxHeight}px;','width:{width}px;'],chevCntTpl=['width:{width}px;','height:{height}px;','position:relative;','background-color:#f8f8f8;','overflow-x:visible;','white-space:nowrap;','z-index:99;'],tipTpl=['min-height:{tipHeight}px;','width:{width}px;','top:{heightOffset}px;','z-index:98;'],anchorContTpl=['top:{top}px;','left:{left}px;','height:{height}px;','width:{width}px;','z-index: {index};'],anchorTpl=['transform:rotate({deg}deg);','-ms-transform:rotate({deg}deg);','-webkit-transform:rotate({deg}deg);','-moz-transform:rotate({deg}deg);','-o-transform:rotate({deg}deg);','top:{top}px;','left:{left}px;','background-color:{color};','width:16px;','height:16px;'],upperBorder=['border-top-width:{btw};border-top-style:{bts};border-top-color:{btc};','border-left-width:{blw};border-left-style:{bls};border-left-color:{blc};','border-right-width:{brw};border-right-style:{brs};border-right-color: {brc};'],lowerBorder=['border-bottom-width:{bbw};border-bottom-style:{bbs};border-bottom-color:{bbc};','border-left-width:{blw};border-left-style:{bls};border-left-color:{blc};','border-right-width:{brw};border-right-style:{brs};border-right-color:{brc};'],gradientTpl=['background: {baseColor};','background: -moz-linear-gradient({gradStart}, {baseColor} 20%, {gradColor} 100%);','background: -webkit-linear-gradient({gradStart}, {baseColor} 20%, {gradColor} 100%);','background: -o-linear-gradient({gradStart}, {baseColor} 20%, {gradColor} 100%);','background: -ms-linear-gradient({gradStart}, {baseColor} 20%, {gradColor} 100%);','background: linear-gradient(to {gradEnd}, {baseColor} 20%, {gradColor} 100%);'],highlightTpl=['width:{width}px;','height:{height}px;','top:{top}px;','left:{left}px;','border:1px solid red;'],initialize=function(){me.baseCls="apxt-chevron-bar";createContainer();calcContSize();createChevronCont();createStubChevron();createTipCont();createHighlight();createChevrons();onResize();},createContainer=function(){var style,width=cfg.width||'100%',height=cfg.height||'100%';if(typeof(width)==='number')width=width+'px';if(typeof(height)==='number')height=height+'px';style=apxt.String.apply('overflow-y:visible;width:{width};height:{height};background-color:#f8f8f8;',{height:height,width:width});if(!!cfg.style)style=cfg.style+style;me.el=apxt.dom.Dom.createEl({tag:'div',target:cfg.renderTo,cls:me.baseCls,style:style});},createChevronCont=function(){chevCont=apxt.dom.Dom.createEl({tag:'div',target:me.el,cls:apxt.String.apply('{baseCls}-cont',me)});},createStubChevron=function(){stubItem.baseCls=me.baseCls;stubItem.title='<img src="https://d1x31vk703fwnw.cloudfront.net/apxtlibraryjs/resources/images/apxt-running-white-32.png" />';stubItem.size={width:stubWidth};stubItem.status='done';stubItem.el=apxt.dom.Dom.createEl({tag:'div',cls:apxt.String.apply('{baseCls}-wrapper',stubItem),innerHTML:apxt.String.apply(tpl,stubItem).replace('-content','-stub')});stubItem.lower=stubItem.el.querySelector('.lower');stubItem.upper=stubItem.el.querySelector('.upper');stubItem.title=stubItem.el.querySelector(apxt.String.apply('.{baseCls}-stub',stubItem));sizeStubChevron(stubItem);setDoneColor(stubItem);outsetBorder(stubItem);apxt.dom.Dom.appendEl(stubItem.el,chevCont);},createTipCont=function(){tipCont=apxt.dom.Dom.createEl({tag:'div',target:me.el,cls:apxt.String.apply('{baseCls}-tip',me),items:[{tag:'div',style:'overflow-x:hidden;'},{tag:'div',innerHTML:'[Required]',cls:apxt.String.apply('apxt-noselect {baseCls}-tip-required',me)},{tag:'div',innerHTML:'Show Me',cls:apxt.String.apply('apxt-noselect apxt-button-gray {baseCls}-tip-link {baseCls}-tip-show',me),listeners:{click:onClickShow,mousedown:onMouseDownShow,mouseup:onMouseUpShow}},{tag:'div',innerHTML:'Skip',cls:apxt.String.apply('apxt-noselect apxt-button-gray {baseCls}-tip-link {baseCls}-tip-skip',me),style:'display:none;',listeners:{click:onClickSkip,mousedown:onMouseDownSkip,mouseup:onMouseUpSkip}},{tag:'div',innerHTML:'',cls:apxt.String.apply('apxt-noselect {baseCls}-tip-close',me),listeners:{click:hideTip}}],listeners:{mouseover: function(e){onMouseOver(tipCont.item,e);},mouseout: function(e){onMouseOut(tipCont.item,e);}}});tipCont.required=tipCont.children[1];tipCont.showMe=tipCont.children[2];tipCont.skip=tipCont.children[3];tipCont.close=tipCont.children[4];tipCont.anchor=apxt.dom.Dom.createEl({tag:'div',target:'body',style:'display:none;',cls:apxt.String.apply('apxt-noselect {baseCls}-tip-anchor',me),items:[{tag:'div',style:'position:relative;'}]});tipCont.anchor.symbol=tipCont.anchor.children[0];tipCont.tipDelay=new apxtExt.util.DelayedTask(showTip,me,[],true);},createHighlight=function(){highCnt=apxt.dom.Dom.createEl({tag:'div',target:'body',style:'width:0%;height:0%;top:0%;left:0%;border:0px;',cls:apxt.String.apply('{baseCls}-highlight',me),items:[{tag:'div',cls:apxt.String.apply('{baseCls}-highlight-mask',me),style:'background-color:red;'}],listeners:{mouseover:hideHighlight}});highCnt.delay=new apxtExt.util.DelayedTask(highlightTarget,me,[],true);},calcContSize=function(){me.size=getContSize();calcOffset();calcWidths();calcHeights();},getContSize=function(){var sz=apxt.dom.Style.getSizing(me.el);return{width:sz.innerWidth,height:sz.innerHeight};},calcOffset=function(){offset=Math.tan(skew*Math.PI/ 180) * (me.size.height /2);offsetR=offset%2;offset=Math.ceil(offset);},calcWidths=function(){var ttlw=0,nowidth=0,item,i,w,g,scw,rw=0,cw=me.size.width-stubWidth;for(i=0;i<cfg.items.length;i++){item=cfg.items[i];item.size={width:0,height:0};if(item.hidden===true)continue;if(!!item.width){if(typeof(item.width)==='string'){if(item.width.indexOf('%')!==-1){var itemGap=i!=0&&gap||0;item.size.width=(item.width.replace('%','')/100)*cw;}else item.size.width=item.width.replace('px','');}else item.size.width=item.width;ttlw+=Number(item.size.width);}else{nowidth++;}}visibleItems=0;w=cw-ttlw-gap;w=Math.floor(w/nowidth)-gap;for(i=0;i<cfg.items.length;i++){item=cfg.items[i];if(item.hidden===true){item.size.width=0;continue;}if(!item.size.width){item.size.width=w;ttlw+=w;}visibleItems++;}},calcHeights=function(){},createChevrons=function(){var i,item;if(!cfg.activeItem)cfg.activeItem=0;for(i=0;i<cfg.items.length;i++){var item=cfg.items[i];item.index=i;createChevron(item);apxt.dom.Dom.appendEl(item.el,chevCont);}},getVisible=function(){visibleItems=0;for(i=0;i<cfg.items.length;i++){var item=cfg.items[i];if(!item.hidden)visibleItems++;}},createChevron=function(item){item.baseCls=me.baseCls;item.el=apxt.dom.Dom.createEl({tag:'div',innerHTML:apxt.String.apply(tpl,item),cls:apxt.String.apply('{baseCls}-wrapper',item),style:item.hidden===true&&'display:none;'||'',listeners:{mousedown:(function(itm){return function(e){onMouseDown(itm,e);}})(item),mouseup:(function(itm){return function(e){onMouseUp(itm,e);}})(item),click:(function(itm){return function(e){onClick(itm,e);}})(item),mouseover:(function(itm){return function(e){onMouseOver(itm,e);}})(item),mouseout:(function(itm){return function(e){onMouseOut(itm,e);}})(item)}});item.lower=item.el.querySelector('.lower');item.upper=item.el.querySelector('.upper');item.title=item.el.querySelector(apxt.String.apply('.{baseCls}-content',item));item.allowActivate=apxt.Object.isNothing(item.allowActivate)&&true||item.allowActivate;item.allowReturn=apxt.Object.isNothing(item.allowReturn)&&true||item.allowReturn;sizeChevron(item);item.borderDelay=new apxtExt.util.DelayedTask(setBorder,me,[item],true);item.colorDelay=new apxtExt.util.DelayedTask(setColor,me,[item],true);if(cfg.activeItem==item.index)setWork(item);else if(item.index<cfg.activeItem)setDone(item);else setWait(item);return item;},sizeTip=function(){cfg.tipHeight=me.size.height;tipCont.style.cssText+=apxt.String.apply(tipTpl,{tipHeight:cfg.tipHeight,width:me.size.width-offset,heightOffset:cfg.tipHeight*-1});tipCont.anchor.style.cssText+=apxt.String.apply(anchorContTpl,{top:0,left:0,width:32,height:17,index:0});tipCont.anchor.symbol.style.cssText+=apxt.String.apply(anchorTpl,{color:'#e9f2ff',deg:'45',top:8,left:8});},sizeChevCont=function(){var h=me.size.height,w=me.size.width;chevCont.style.cssText+=apxt.String.apply(chevCntTpl,{height:h,width:w});},sizeStubChevron=function(item){var itemGap=0,width=item.size.width-((dir==='left'||dir==='right')&&itemGap||0),height=(item.size.height||me.size.height)-((dir==='top'||dir==='bottom')&&itemGap||0),style=apxt.String.apply('z-index:100;height:{height}px;width:{width}px;left:-{offset}px;top:0px;',{dir:dir,gap:itemGap,height:height,width:width,offset:offset}),lwrStyle,uprStyle;item.upperDeg=180-skew*((dir==='left'||dir==='bottom')&&-1||1);item.lowerDeg=skew*((dir==='left'||dir==='bottom')&&-1||1);item.axis=(dir==='top'||dir==='bottom')&&'Y'||'X';uprStyle=apxt.String.apply(upperTpl,item);lwrStyle=apxt.String.apply(lowerTpl,item);if(!!item.style)style=item.style+style;item.el.style.cssText+=style;item.lower.style.cssText+=lwrStyle;item.upper.style.cssText+=uprStyle;},sizeChevron=function(item){var itemGap=gap,width=item.size.width,height=item.size.height||me.size.height,style,lwrStyle,uprStyle,cntntStyle;item.upperDeg=180-skew*((dir==='left'||dir==='bottom')&&-1||1);item.lowerDeg=skew*((dir==='left'||dir==='bottom')&&-1||1);item.axis=(dir==='top'||dir==='bottom')&&'Y'||'X';uprStyle=apxt.String.apply(upperTpl,item);lwrStyle=apxt.String.apply(lowerTpl,item);style=apxt.String.apply('margin-{dir}:{gap}px;height:{height}px;width:{width}px;left:{offset}px;',{dir:dir,gap:itemGap,height:height,width:width,offset:-offset});cntntStyle=apxt.String.apply(cntntTpl,{offset:(offset+2),maxHeight:height,width:width-((offset+2)*2)});if(!!item.style)style=item.style+style;item.el.style.cssText+=style;item.lower.style.cssText+=lwrStyle;item.upper.style.cssText+=uprStyle;item.title.style.cssText+=cntntStyle;},setBorder=function(item,border){var lwrBorder=apxt.String.apply(lowerBorder,border,true),uprBorder=apxt.String.apply(upperBorder,border,true);item.lower.style.cssText+=lwrBorder;item.upper.style.cssText+=uprBorder;},outsetBorder=function(item){var border={bbw:'1px',bbs:'solid',bbc:'#989898',btw:'1px',bts:'solid',btc:'#ffffff',blw:'1px',bls:'solid',blc:'#ffffff',brw:'1px',brs:'solid',brc:'#989898'};setBorder(item,border);},insetBorder=function(item){var border={bbw:'1px',bbs:'solid',bbc:'#ffffff',btw:'1px',bts:'solid',btc:'#989898',blw:'1px',bls:'solid',blc:'#989898',brw:'1px',brs:'solid',brc:'#ffffff'};setBorder(item,border);},removeBorder=function(item){var border={bbw:'',bbs:'none',bbc:'',btw:'',bts:'none',btc:'',blw:'',bls:'none',blc:'',brw:'',brs:'none',brc:''},lwrBorder=apxt.String.apply(lowerBorder,border,true),uprBorder=apxt.String.apply(upperBorder,border,true);item.lower.style.cssText+=lwrBorder;item.upper.style.cssText+=uprBorder;},setColor=function(item,color){var stylu=apxt.String.apply(gradientTpl,{baseColor:color.gradColor,gradColor:color.baseColor,gradStart:color.gradStart}),styll=apxt.String.apply(gradientTpl,{baseColor:color.baseColor,gradColor:color.gradColor,gradStart:color.gradStart});if(!color.reverse){item.upper.style.cssText+=stylu;item.lower.style.cssText+=styll;}else{item.lower.style.cssText+=stylu;item.upper.style.cssText+=styll;}},setDoneColor=function(item,reverse){var color={reverse:reverse,baseColor:'#73DB53',gradColor:'#81F55D',gradStart:gradStart};setColor(item,color);},setWorkColor=function(item,reverse){var color={reverse:reverse,baseColor:'#87C3FF',gradColor:'#87D9FF',gradStart:gradStart};setColor(item,color);},setWaitColor=function(item,reverse){var color={reverse:reverse,baseColor:'#D4D4D4',gradColor:'#F4F4F4',gradStart:gradStart};setColor(item,color);},insetColor=function(item){if(item.status==='done')setDoneColor(item,true);else if(item.status==='work')setWorkColor(item,true);else setWaitColor(item,true);},outsetColor=function(item){if(item.status==='done')setDoneColor(item,false);else if(item.status==='work')setWorkColor(item,false);else setWaitColor(item,false);},getBaseColor=function(item){if(item.status==='done')return '#73DB53';else if(item.status==='work')return '#87C3FF';else if(item.status==='error')return '#f80000';else return '#c4c4c4';},getGradColor=function(item){if(item.status==='done')return '#73DB53';else if(item.status==='work')return '#81F55D';else return '#F4F4F4';},getBorderColor=function(item){if(item.status==='done')return '#35881C';else if(item.status==='work')return '#0069d2';else return '#848484';},setDone=function(item){item.status='done';outsetBorder(item);setDoneColor(item);setFont(item);setState(item);},setWork=function(item){item.status='work';insetBorder(item);setWorkColor(item);setFont(item);setState(item);},setWait=function(item){item.status='wait';removeBorder(item);setWaitColor(item);setFont(item);setState(item);},setActive=function(activeItem,force){var i,item=cfg.items[cfg.activeItem||0],msg;if(activeItem.allowActivate===false&&!force)return -1;if(!!activeItem.validate){msg=activeItem.validate(activeItem.index,cfg.activeItem);if(!!msg){showTip({tip:msg,status:'error',colorDelay:{delay:apxt.emFn}});highlightTarget(item);if(cfg.activeItem==activeItem.index)cfg.activeItem--;setActive(cfg.activeItem);return 0;}}cfg.activeItem=activeItem.index;for(i=0;i<cfg.items.length;i++){item=cfg.items[i];if(activeItem===item)setWork(item);else if(i<activeItem.index)setDone(item);else setWait(item);setFont(item);}return 1;},setDoneFont=function(item){item.title.style.cssText+='font-weight:normal;font-style:normal;color:#000000;';},setWaitFont=function(item){item.title.style.cssText+='font-weight:normal;font-style:normal;color:#000000;';},setWorkFont=function(item){item.title.style.cssText+='font-weight:bolder;font-style:normal;color:#000000;';},setFont=function(item){if(item.status==='done')setDoneFont(item);else if(item.status==='work')setWorkFont(item);else setWaitFont(item);},disable=function(item){item.isDisabled=true;setEnabled(item);},enable=function(item){item.isDisabled=false;setEnabled(item);},setState=function(item){if(!!item.isDisabled)setDisabled(item);else setEnabled(item);},setDisabled=function(item){item.el.style.cssText+='cursor:default;opacity:0.5;';item.title.style.cssText+='cursor:default;';},setEnabled=function(item){item.el.style.cssText+='cursor:pointer;opacity:1;';item.title.style.cssText+='cursor:pointer;';},setSize=function(width,height){var style='',size;if(!apxt.Object.isNothing(width)){if(typeof(width)!=='string'||(width.indexOf('%')===-1&&width.indexOf('px')===-1))width+='px';style='width:'+width+';';}if(!apxt.Object.isNothing(height)){if(typeof(height)!=='string'||(height.indexOf('%')===-1&&height.indexOf('px')===-1))height+='px';style='height:'+height+';';}me.el.style.cssText+=style;onResize();},getTipBackground=function(){var bckgrnd='{color} {url} {repeat} {align} {position}',obj={color:'#e9f2ff',repeat:'no-repeat',align:'2px',position:'2px'};if(tipCont.item.status==='done')obj.url="url('https://d1x31vk703fwnw.cloudfront.net/apxtlibraryjs/resources/images/apxt-bubble-green-check-32.png')";else if(tipCont.item.status==='work')obj.url="url('https://d1x31vk703fwnw.cloudfront.net/apxtlibraryjs/resources/images/apxt-star-full-32.png')";else if(tipCont.item.status==='error')obj.url="url('https://d1x31vk703fwnw.cloudfront.net/apxtlibraryjs/resources/images/apxt-error-red-dash-32.gif')";else obj.url="url('https://d1x31vk703fwnw.cloudfront.net/apxtlibraryjs/resources/images/apxt-bubble-blue-info-32.png')";return apxt.String.apply(bckgrnd,obj);},setTipContent=function(){var tip;if(!tipCont.item)return;tip=tipCont.item.tip||tipCont.item.title.innerHTML;if(apxt.Object.isArray(tip))tip=tip.join('');tipCont.firstChild.innerHTML=tip;},showTip=function(item){if(!!tipCont.item&&tipCont.item.status==='error')return;if(!tipVisible||tipCont.item!==item){tipVisible=true;tipCont.item=item;var color=getBaseColor(item),brdrColor=getBorderColor(item),background=getTipBackground(),offset=!!item.el&&apxt.dom.Dom.getTotalOffset(item.el)||null,height=!!item.el&&item.size.height||me.size.height;setTipContent();tipCont.style.cssText+=apxt.String.apply('top:{top}px;border-color:{color};color:#282828;background:{background};',{color:color,top:0,background:background});tipCont.anchor.symbol.style.cssText+=apxt.String.apply('border-top:1px solid {colorA};border-left:1px solid {colorB};',{colorA:color,colorB:color});if(!!offset){tipCont.anchor.style.cssText+=apxt.String.apply('top:{top}px;left:{left}px;z-index:{index};',{top:(offset.top+height)-16,left:offset.left-15,index:110});setTimeout(function(){tipCont.anchor.style.cssText+='display:inline-block;';},375);}tipCont.skip.style.cssText+='display:none;';if((!!item.allowSkip||!!item.allowComplete)&&item.index===cfg.activeItem){tipCont.skip.style.cssText+='display:inline-block;';if(!!item.allowSkip)tipCont.skip.innerHTML='Skip';else tipCont.skip.innerHTML='Done';}if(item.index<cfg.activeItem&&item.allowReturn==true){tipCont.skip.style.cssText+='display:inline-block;';tipCont.skip.innerHTML='Return';}if(!item.target)tipCont.showMe.style.cssText+='display:none;';else tipCont.showMe.style.cssText+='display:inline-block;';if(apxt.Object.isNothing(item.isRequired))tipCont.required.innerHTML='';else if(!!item.isRequired)tipCont.required.innerHTML='[Required]';else tipCont.required.innerHTML='[Optional]';}},hideTip=function(force){if((!isOver||!!force)&&!!tipVisible){tipVisible=false;setTimeout(function(){tipCont.item=null;tipCont.firstChild.innerHTML='';},150);tipCont.style.cssText+='top:-'+(cfg.tipHeight)+'px';tipCont.skip.style.cssText+='display:none;';tipCont.anchor.style.cssText+='display:none;';}},highlightTarget=function(item){if(!!item.target){var target=apxt.Object.isFunction(item.target)&&item.target()||item.target;var offset=apxt.dom.Dom.getTotalOffset(target),sz=apxt.dom.Style.getSizing(target);highCnt.firstChild.style.cssText+='display:block;';highCnt.style.cssText+=apxt.String.apply(highlightTpl,{top:offset.top-1,left:offset.left-1,width:sz.width+2,height:sz.height+2});}},hideHighlight=function(){highCnt.firstChild.style.cssText+='display:none;';highCnt.style.cssText+='width:0%;height:0%;top:0%;left:0%;border:0px;';},setHidden=function(item,hidden){item.hidden=hidden;if(hidden===true){item.el.style.cssText+='display:none;';visibleItems--;}else{visibleItems++;item.el.style.cssText+='display:inline-block;';}calcContSize();onResize();},onMouseDown=function(item){if(!item.isDisabled)insetColor(item);},onMouseUp=function(item){outsetColor(item);},onMouseOver=function(item,e){isOver=true;},onMouseOut=function(item,e){isOver=false;if(!item||apxt.Object.isNothing(item.autoHide)||item.autoHide===true)tipCont.tipDelay.delay(500,hideTip,me,[]);if(!!item)item.colorDelay.delay(10,outsetColor,[item]);},onClick=function(item){var st;if(!!tipTask&&!!isOver)tipTask.cancel();if(!item.isDisabled&&(!tipVisible||tipCont.item!==item))if((st=setActive(item))<1){if(st===-1)showTip(item);return;}hideTip(true);},onClickShow=function(){var item=tipCont.item;hideTip(true);setTimeout(function(){highlightTarget(item);},100);},onMouseDownShow=function(){tipCont.showMe.className+=' apxt-button-reverse';},onMouseUpShow=function(){tipCont.showMe.className=tipCont.showMe.className.replace('apxt-button-reverse','').trim();},onClickSkip=function(){var item=tipCont.item;hideTip(true);setTimeout(function(){if(item.index<cfg.activeItem)setActive(item,true);else if(cfg.activeItem+1>=cfg.items.length)setDone(item);else setActive(cfg.items[cfg.activeItem+1],true);},100);},onMouseDownSkip=function(){tipCont.skip.className+=' apxt-button-reverse';},onMouseUpSkip=function(){tipCont.skip.className=tipCont.skip.className.replace('apxt-button-reverse','').trim();},onResize=function(){calcContSize();sizeStubChevron(stubItem);sizeChevCont();hideTip();sizeTip();ttlWidth=0;for(i=0;i<cfg.items.length;i++)sizeChevron(cfg.items[i]);};me.destroy=function(){if(!!me.el.parentNode)me.el.parentNode.removeChild(me.el);me=null;};me.setActive=function(indx){if(indx>=cfg.items.length)indx=cfg.items.length-1;setActive(cfg.items[indx],true);};me.getActive=function(){return cfg.activeItem;};me.setDone=function(indx){if(indx>=cfg.items.length)indx=cfg.items.length-1;if(!setActive(cfg.items[indx],true))return;setDone(cfg.items[indx]);};me.setTitle=function(indx,title){var item=cfg.items[indx];if(!!item)item.title.innerHTML=title;};me.setTip=function(indx,tip){var item=cfg.items[indx];if(!!item)item.tip=tip;};me.setValidateFn=function(indx,fn){var item=cfg.items[indx];if(!!item)item.validate=fn;};me.showTip=function(tip,status,autoHide,target){tipCont.tipDelay.delay(100,showTip,me,[{tip:tip,status:status,colorDelay:{delay:apxt.emFn},autoHide:autoHide,target:target}]);};me.hideTip=function(){hideTip();};me.clearHighlight=function(){hideHighlight();};me.setItemSize=function(indx,width,height){var item=cfg.items[indx];if(!!item){if(!!width)item.width=width;if(!!height)item.height=width;onResize();}};me.addItem=function(item,indx){var i;if(!indx)indx=cfg.items.length;item.index=indx;if(indx===cfg.items.length)cfg.items.push(item);else{for(i=indx;i<cfg.items.length;i++)cfg.items[i].index++;cfg.items.splice(indx,0,item);}calcContSize();createChevron(item);if(indx===cfg.items.length)apxt.dom.Dom.appendEl(item.el,chevCont);else apxt.dom.Dom.insertEl(item.el,chevCont,indx);onResize();};me.hideItem=function(indx){var item=cfg.items[indx];if(!!item)setHidden(item,true);};me.showItem=function(indx){var item=cfg.items[indx];if(!!item)setHidden(item,false);};me.enableItem=function(indx){if(indx>=cfg.items.length)return;enable(cfg.items[indx]);};me.disableItem=function(indx){if(indx>=cfg.items.length)return;disable(cfg.items[indx]);};me.setSize=function(width,height){if(!sizeTask)sizeTask=new Ext.util.DelayedTask(setSize,me,[],true);sizeTask.delay(100,setSize,me,[width,height]);};cfg=cfg||{};initialize();return me;});apxtExt.define('apxt.component.MessageCmp',{extend:'apxtExt.Container',alias:'widget.messagecmp',style:'border: 1px dashed Red;display:absolute;',hidden:true,closable:true,initComponent: function(){var me=this,classes=['apxt-message-normal','apxt-message-warning','apxt-message-error'],closeBtn=null,ready=function(box){if(!!me.closable){me.items.items[2].show();}},close=function(){collapse(me.down('box[itemId="expand-collapse-btn"]'));me.fireEvent('close',me);},updateExpandCollapse=function(){var btn=me.down('box[itemId="expand-collapse-btn"]'),msg=me.down('box[itemId="message-text"]'),sz=apxt.dom.Style.getSizing(msg.getEl().dom);if(sz.hidden.height>0){btn.show();}else{btn.hide();}},expandCollapse=function(e){var btn=me.down('box[itemId="expand-collapse-btn"]');if(btn.isVisible())if(btn.collapsed==true)expand(btn);else collapse(btn);},expand=function(btn){btn.collapsed=false;btn.update({cls:'apxt-message-collapse'});me.fireEvent('expand',me);},collapse=function(btn){btn.collapsed=true;btn.update({cls:'apxt-message-expand'});me.fireEvent('collapse',me);};me.updateMessage=function(message,closable){if(!message||!message.MessageText){if(me.isHidden()==false)me.hide();me.down('box[itemId="expand-collapse-btn"]').hide();}else{var cls=classes[0];if(message.MessageSeverity=='Warning')cls=classes[1];else if(message.MessageSeverity=='Error')cls=classes[2];message.MessageText=message.MessageText.replace(/\n/g,"</br>");var obj={cls:cls,icon:cls+'-icon',message:message.MessageText};me.down('box[itemId="message-icon"]').update(obj);me.down('box[itemId="message-text"]').update(obj);if(closable==undefined)closable=me.closable;if(closable)me.down('box[itemId="close-btn"]').show();else me.down('box[itemId="close-btn"]').hide();me.show();me.getEl().highlight();setTimeout(updateExpandCollapse,10);}};me.layout={type:'hbox',align:'stretch'};me.items=[{xtype:'box',width:24,style:'margin-top:2px;margin-left:4px;margin-right: 10px;',tpl:'<div class="{icon}"></div>',data:{icon:classes[1]+'-icon'},itemId:'message-icon'},{xtype:'box',tpl:'<div class="{cls}">&nbsp</div>',data:{cls:'apxt-message-expand'},style:'margin-top:6px;margin-right:2px;',hidden:true,itemId:'expand-collapse-btn',collapsed:true,listeners:{boxready: function(box){box.getEl().on('click',expandCollapse);}}},{xtype:'box',flex:1,cls:'apxt-message',style:'',tpl:'<div class="{cls}" align="left" style="margin-top:6px;position:absolute;">{message}</div>',data:{cls:classes[1],message:'',dotDisplay:'none'},itemId:'message-text',overflowY:'hidden',overflowX:'hidden'},{xtype:'box',html:'<div class="apxt-message-close">&nbsp</div>',style:'margin-top:6px;margin-right:4px;margin-left:4px;',hidden:true,itemId:'close-btn',listeners:{boxready: function(box){box.getEl().on('click',close);}}}];this.callParent(arguments);me.addListener('boxready',ready);}});apxtExt.define('apxt.toolbar.StatusBar',{extend:'apxtExt.Component',alias:'widget.statusbar',tpl:['<span class="{baseCls}-label"><tpl if="!hideLabel">{label}</tpl></span>','<span class="{baseCls}-label-separator"><tpl if="!hideSeparator">{separator}</tpl></span>','<span class="{baseCls}-status-text" style="{textStyle}">{status}</span>'],status:'',label:'Status',separator:':',hideSeparator:false,hideLabel:false,baseCls:'apxt-status-bar',changeAnim:'highlight',scale:'small',rounded:true,textStyle:null,initComponent: function(){var me=this,animTask,animateChange=function(){if(!me.changeAnim)return;if(typeof(me.changeAnim)==='string')me.changeAnim={animation:me.changeAnim,options:[]};var el=me.getEl();if(!!el[me.changeAnim.animation]&&apxt.Object.isFunction(el[me.changeAnim.animation]))el[me.changeAnim.animation].apply(el,me.changeAnim.options);};me.updateStatus=function(status,textStyle){if(me.status===status)return;var oldStatus=me.status;me.status=status;if(textStyle!=undefined)me.textStyle=textStyle;me.update(me);me.fireEvent('change',[status,oldStatus]);animTask.delay(100);};animTask=new apxtExt.util.DelayedTask(animateChange,me,[],true);me.data=me;this.callParent(arguments);me.addCls(me.baseCls+'-'+me.scale);if(!!me.rounded)me.addCls(me.baseCls+'-rounded');}});Ext.define('Ext.ux.data.PagingStore',{extend:'Ext.data.Store',alias:'store.pagingstore',destroyStore: function(){this.callParent(arguments);this.allData=null;},isPaging: function(options){var me=this,start=options.start,limit=options.limit,page=options.page,currentParams;if((typeof start!='number')||(typeof limit!='number')){delete me.start;delete me.limit;delete me.page;me.lastParams=options.params;return false;}me.start=start;me.limit=limit;me.currentPage=page;var lastParams=this.lastParams;currentParams=Ext.apply({},options.params,this.proxy?this.proxy.extraParams:{});me.lastParams=currentParams;if(!this.proxy){return true;}if(!lastParams){return false;}for(var param in currentParams){if(currentParams.hasOwnProperty(param)&&(currentParams[param]!==lastParams[param])){return false;}}for(param in lastParams){if(lastParams.hasOwnProperty(param)&&(currentParams[param]!==lastParams[param])){return false;}}return true;},applyPaging: function(){var me=this,start=me.start,limit=me.limit,allData,data;if((typeof start=='number')&&(typeof limit=='number')){allData=this.data;data=new Ext.util.MixedCollection(allData.allowFunctions,allData.getKey);data.addAll(allData.items.slice(start,start+limit));me.allData=allData;me.data=data;}},loadRecords: function(records,options){var me=this,i=0,length=records.length,start,addRecords,snapshot=me.snapshot,allData=me.allData;if(options){start=options.start;addRecords=options.addRecords;}if(!addRecords){delete me.allData;delete me.snapshot;me.clearData(true);}else if(allData){allData.addAll(records);}else if(snapshot){snapshot.addAll(records);}me.data.addAll(records);if(!me.allData){me.applyPaging();}if(start!==undefined){for(;i<length;i++){records[i].index=start+i;records[i].join(me);}}else{for(;i<length;i++){records[i].join(me);}}me.suspendEvents();if(me.filterOnLoad&&!me.remoteFilter){me.filter();}if(me.sortOnLoad&&!me.remoteSort){me.sort(undefined,undefined,undefined,true);}me.resumeEvents();me.fireEvent('datachanged',me);me.fireEvent('refresh',me);},loadData: function(data,append){var me=this,model=me.model,length=data.length,newData=[],i,record;me.isPaging(Ext.apply({},this.lastOptions?this.lastOptions:{}));for(i=0;i<length;i++){record=data[i];if(!(record.isModel)){record=Ext.ModelManager.create(record,model);}newData.push(record);}me.loadRecords(newData,append?me.addRecordsOptions:undefined);},loadRawData: function(data,append){var me=this,result=me.proxy.reader.read(data),records=result.records;if(result.success){me.totalCount=result.total;me.isPaging(Ext.apply({},this.lastOptions?this.lastOptions:{}));me.loadRecords(records,append?me.addRecordsOptions:undefined);me.fireEvent('load',me,records,true);}},load: function(options){var me=this,pagingOptions;options=options||{};if(typeof options=='function'){options={callback:options};}options.groupers=options.groupers||me.groupers.items;options.page=options.page||me.currentPage;options.start=(options.start!==undefined)?options.start:(options.page-1)*me.pageSize;options.limit=options.limit||me.pageSize;options.addRecords=options.addRecords||false;if(me.buffered){return me.loadToPrefetch(options);}var operation;options=Ext.apply({action:'read',filters:me.filters.items,sorters:me.getSorters()},options);me.lastOptions=options;operation=new Ext.data.Operation(options);if(me.fireEvent('beforeload',me,operation)!==false){me.loading=true;pagingOptions=Ext.apply({},options);if(me.isPaging(pagingOptions)){Ext.Function.defer(function(){if(me.allData){me.data=me.allData;delete me.allData;}me.applyPaging();me.fireEvent("datachanged",me);me.fireEvent('refresh',me);var r=[].concat(me.data.items);me.loading=false;me.fireEvent("load",me,r,true);if(me.hasListeners.read){me.fireEvent('read',me,r,true);}if(options.callback){options.callback.call(options.scope||me,r,options,true);}},1,me);return me;}me.proxy.read(operation,me.onProxyLoad,me);}return me;},insert: function(index,records){var me=this,sync=false,i,record,len;records=[].concat(records);for(i=0,len=records.length;i<len;i++){record=me.createModel(records[i]);record.set(me.modelDefaults);records[i]=record;me.data.insert(index+i,record);record.join(me);sync=sync||record.phantom===true;}if(me.allData){me.allData.addAll(records);}if(me.snapshot){me.snapshot.addAll(records);}if(me.requireSort){me.suspendEvents();me.sort();me.resumeEvents();}me.fireEvent('add',me,records,index);me.fireEvent('datachanged',me);if(me.autoSync&&sync&&!me.autoSyncSuspended){me.sync();}},doSort: function(sorterFn){var me=this,range,ln,i;if(me.remoteSort){if(me.buffered){me.pageMap.clear();me.loadPage(1);}else{me.load();}}else{if(me.allData){me.data=me.allData;delete me.allData;}me.data.sortBy(sorterFn);if(!me.buffered){range=me.getRange();ln=range.length;for(i=0;i<ln;i++){range[i].index=i;}}me.applyPaging();me.fireEvent('datachanged',me);me.fireEvent('refresh',me);}},getTotalCount: function(){return this.allData?this.allData.getCount():this.totalCount||0;},getNewRecords: function(){if(this.allData){return this.allData.filterBy(this.filterNew).items;}return this.data.filterBy(this.filterNew).items;},getUpdatedRecords: function(){if(this.allData){return this.allData.filterBy(this.filterUpdated).items;}return this.data.filterBy(this.filterUpdated).items;},remove: function(records,isMove){if(!Ext.isArray(records)){records=[records];}isMove=isMove===true;var me=this,sync=false,i=0,length=records.length,isNotPhantom,index,record;for(;i<length;i++){record=records[i];index=me.data.indexOf(record);if(me.allData){me.allData.remove(record);}if(me.snapshot){me.snapshot.remove(record);}if(index>-1){isNotPhantom=record.phantom!==true;if(!isMove&&isNotPhantom){record.removedFrom=index;me.removed.push(record);}record.unjoin(me);me.data.remove(record);sync=sync||isNotPhantom;me.fireEvent('remove',me,record,index);}}me.fireEvent('datachanged',me);if(!isMove&&me.autoSync&&sync&&!me.autoSyncSuspended){me.sync();}},filter: function(filters,value){if(Ext.isString(filters)){filters={property:filters,value:value};}var me=this,decoded=me.decodeFilters(filters),i=0,doLocalSort=me.sorters.length&&me.sortOnFilter&&!me.remoteSort,length=decoded.length;for(;i<length;i++){me.filters.replace(decoded[i]);}if(me.remoteFilter){delete me.totalCount;if(me.buffered){me.pageMap.clear();me.loadPage(1);}else{me.currentPage=1;me.load();}}else{if(me.filters.getCount()){me.snapshot=me.snapshot||me.allData.clone()||me.data.clone();if(me.allData){me.data=me.allData;delete me.allData;}me.data=me.data.filter(me.filters.items);me.applyPaging();if(doLocalSort){me.sort();}else{me.fireEvent('datachanged',me);me.fireEvent('refresh',me);}}}},clearFilter: function(suppressEvent){var me=this;me.filters.clear();if(me.remoteFilter){if(suppressEvent){return;}delete me.totalCount;if(me.buffered){me.pageMap.clear();me.loadPage(1);}else{me.currentPage=1;me.load();}}else if(me.isFiltered()){me.data=me.snapshot.clone();delete me.allData;delete me.snapshot;me.applyPaging();if(suppressEvent!==true){me.fireEvent('datachanged',me);me.fireEvent('refresh',me);}}},isFiltered: function(){var snapshot=this.snapshot;return !!snapshot&&snapshot!==(this.allData||this.data);},filterBy: function(fn,scope){var me=this;me.snapshot=me.snapshot||me.allData.clone()||me.data.clone();me.data=me.queryBy(fn,scope||me);me.applyPaging();me.fireEvent('datachanged',me);me.fireEvent('refresh',me);},queryBy: function(fn,scope){var me=this,data=me.snapshot||me.allData||me.data;return data.filterBy(fn,scope||me);},collect: function(dataIndex,allowNull,bypassFilter){var me=this,data=(bypassFilter===true&&(me.snapshot||me.allData))?(me.snapshot||me.allData):me.data;return data.collect(dataIndex,'data',allowNull);},getById: function(id){return(this.snapshot||this.allData||this.data).findBy(function(record){return record.getId()===id;});},removeAll: function(silent){var me=this;me.clearData();if(me.snapshot){me.snapshot.clear();}if(me.allData){me.allData.clear();}if(me.pageMap){me.pageMap.clear();}if(silent!==true){me.fireEvent('clear',me);}}});