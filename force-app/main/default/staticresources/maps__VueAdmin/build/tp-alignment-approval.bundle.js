"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[6293],{5146:(s,e,t)=>{t.r(e),t.d(e,{default:()=>n});var l=t(2766),a=t(5658),i=t(257);const{MAToastMessages:p}=window,r={components:{Checkbox:l.XZ,Picklist:l.Gp},data(){return{approvalSettings:{enabled:!1,publishPDF:!1,pdfAOnly:!1,publishCSV:!1,pubcsvAOnly:!1,exportCSV:!1,csvAOnly:!1,publishETM:!1,etmAOnly:!1,publishMaps:!1,mapAOnly:!1,publishObj:!1,oAOnly:!1,publishFSL:!1,fslAOnly:!1},searchTerm:{label:"",value:null},searches:[{options:s=>this.searchUserProfile(s)}],alignmentApprovers:[]}},async created(){await this.getApprovalSettings(),await this.getApprovers()},methods:{searchUserProfile(s){return new Promise((e=>{const t={ajaxResource:"TooltipAJAXResources",action:"get_lookup_optionsv2",baseObject:"User",fieldApiName:"Id",fieldName:"Id",grandparentField:"--none--",term:s,keepSearch:!1};(new i.Z).setAction(this.$Remoting.processAJAXRequest).setErrorHandler((()=>{e({results:[]})})).invoke([t],(s=>{if(s.success){const{lookupOptions:t=[]}=s;e(t)}else e({results:[]})}),{escape:!1,buffer:!1})}))},async selectItem(s){this.searchTerm=s,await this.updateApprover(s.value,s.label,!0),this.clearResults()},clearResults(){this.searchTerm={label:"",value:null}},async getApprovalSettings(){try{const{data:s,message:e,success:t}=await this.$remote("maps.TPRemoteActions.GetAlignmentApprovalSettings");if(t){const e={enabled:!1,publishFSL:!1,publishMaps:!1,publishETM:!1,publishObj:!1,publishPDF:!1,publishCSV:!1,exportCSV:!1,...s.maps__Value__c?JSON.parse(s.maps__Value__c):{}},t={fslAOnly:!1,mapAOnly:!1,pdfAOnly:!1,csvAOnly:!1,pubcsvAOnly:!1,oAOnly:!1,etmAOnly:!1,...s.maps__Value2__c?JSON.parse(s.maps__Value2__c):{}};this.approvalSettings={...e,...t};const l=Object.keys(s.maps__Value__c?JSON.parse(s.maps__Value__c):{});l.includes("publishCSV")&&!l.includes("exportCSV")&&(this.approvalSettings.exportCSV=this.approvalSettings.publishCSV,this.approvalSettings.publishCSV=!1)}else console.error(e)}catch(s){console.error(s)}},async saveApprovalSettings(){try{this.approvalSettings.enabled||this.alignmentApprovers.forEach((s=>{this.removeApprover(s.Id,s.Name)}));const s={enabled:this.approvalSettings.enabled,publishPDF:this.approvalSettings.publishPDF,publishMaps:this.approvalSettings.publishMaps,publishETM:this.approvalSettings.publishETM,publishFSL:this.approvalSettings.publishFSL,publishObj:this.approvalSettings.publishObj,publishCSV:this.approvalSettings.publishCSV,exportCSV:this.approvalSettings.exportCSV},e={pdfAOnly:!!this.approvalSettings.enabled&&this.approvalSettings.pdfAOnly,csvAOnly:!!this.approvalSettings.enabled&&this.approvalSettings.csvAOnly,pubcsvAOnly:!!this.approvalSettings.enabled&&this.approvalSettings.pubcsvAOnly,etmAOnly:!!this.approvalSettings.enabled&&this.approvalSettings.etmAOnly,oAOnly:!!this.approvalSettings.enabled&&this.approvalSettings.oAOnly,mapAOnly:!!this.approvalSettings.enabled&&this.approvalSettings.mapAOnly,fslAOnly:!!this.approvalSettings.enabled&&this.approvalSettings.fslAOnly},{data:t,message:l,success:a}=await this.$remote("maps.TPRemoteActions.SaveAlignmentApprovalSettings",[JSON.stringify(s),JSON.stringify(e)]),i=this.approvalSettings.enabled?this.$Labels.settingsTPAlignmentApproval_Approver_Enabled:this.$Labels.settingsTPAlignmentApproval_Approver_Disabled;if(a){const s=JSON.parse(t.maps__Value__c),e=JSON.parse(t.maps__Value2__c);this.approvalSettings={...s,...e},p.showSuccess({position:"toast-top-right",message:i,timeOut:8e3})}else console.error(l)}catch(s){console.error(s)}},async updateApprover(s,e,t){try{const{message:l,success:i}=await this.$remote("maps.TPRemoteActions.UpdateObjectBatch",[[{Id:s,maps__TPApprover__c:t}],!0]);i?(t?this.alignmentApprovers.push({Id:s,Name:e,maps__TPApprover__c:!0}):this.alignmentApprovers.splice(this.alignmentApprovers.findIndex((e=>e.Id===s)),1),p.showSuccess({position:"toast-top-right",message:t?(0,a.N4)(this.$Labels.settingsTPAlignmentApproval_Approver_Added,[e]):(0,a.N4)(this.$Labels.settingsTPAlignmentApproval_Approver_Removed,[e]),timeOut:8e3})):console.error(l)}catch(s){console.error(s)}},async removeApprover(s,e){await this.updateApprover(s,e,!1)},async getApprovers(){try{const{data:s,message:e,success:t}=await this.$remote("maps.TPRemoteActions.GetApprovers");t?this.alignmentApprovers=s.approvers:console.error(e)}catch(s){console.error(s)}}}},n=(0,t(1900).Z)(r,(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",[t("div",{staticClass:"slds-p-top_large"},[t("Checkbox",{attrs:{labels:{name:s.$Labels.MA_Alignment_Approval,stateOn:s.$Labels.MA_Enabled,stateOff:s.$Labels.MA_Disabled},toggleBuffer:500,showStateLabels:"",slide:!0},on:{changed:function(e){return s.saveApprovalSettings()}},model:{value:s.approvalSettings.enabled,callback:function(e){s.$set(s.approvalSettings,"enabled",e)},expression:"approvalSettings.enabled"}})],1),s._v(" "),s.approvalSettings.enabled?t("fieldset",{staticClass:"slds-form-element slds-p-top_medium"},[t("div",{staticClass:"slds-grid slds-grid_vertical"},[t("Picklist",{staticClass:"slds-size_2-of-7",class:{"slds-has-error":0===s.alignmentApprovers.length},attrs:{options:s.searches,filterable:"",idKey:"value",titleKey:"label",labels:{name:s.$Labels.settingsTPAlignmentApproval_AlignmentApprovers,search:s.$Labels.settingsTPAlignmentApproval_Search_For_Users,noSearchResults:s.$Labels.MA_NO_RESULTS_FOUND}},on:{clear:s.clearResults,"selected-option":s.selectItem},scopedSlots:s._u([{key:"result",fn:function(e){return t("span",{staticClass:"slds-listbox__option-text_entity slds-listbox__option slds-listbox__option_plain"},[t("div",[t("div",{staticClass:"slds-text-body_small"},[s._v(s._s(s._f("decode")(e.result.label)))]),s._v(" "),t("div",{staticClass:"slds-grid slds-grid_vertical-align-center"},[e.result.folder?t("span",{staticClass:"ma-icon ma-icon-folder ma-icon-small slds-m-right_x-small"}):s._e(),s._v(" "),t("span",{staticClass:"slds-text-color_weak slds-text-body_small"},[s._v(s._s(s._f("decode")(e.result.folder)))])])])])}}],null,!1,287910314),model:{value:s.searchTerm.label,callback:function(e){s.$set(s.searchTerm,"label",e)},expression:"searchTerm.label"}})],1),s._v(" "),0===s.alignmentApprovers.length?t("div",{staticClass:"slds-text-color_error slds-m-top_xx-small"},[s._v("\n            "+s._s(s.$Labels.settingsTPAlignmentApproval_Approver_Error)+"\n        ")]):s._e(),s._v(" "),t("div",{staticClass:"slds-m-top_small"},[t("ul",{staticClass:"slds-grid slds-grid_vertical",attrs:{"aria-label":"Selected Options:"}},s._l(s.alignmentApprovers,(function(e){return t("li",{key:e.Id,staticClass:"slds-size_2-of-7",attrs:{role:"presentation"}},[t("span",{staticClass:"slds-pill slds-p-around_x-small slds-m-bottom_xx-small",staticStyle:{width:"100%"},attrs:{role:"option","aria-selected":"true"}},[t("span",{staticClass:"slds-pill__label",attrs:{title:"Reports"}},[s._v(s._s(e.Name))]),s._v(" "),t("span",{staticStyle:{cursor:"pointer"},on:{click:function(t){return s.removeApprover(e.Id,e.Name)}}},[t("Icon",{attrs:{category:"utility",name:"close",assistiveText:"remove",size:"x-small"}})],1)])])})),0)])]):s._e()])}),[],!1,null,null,null).exports}}]);