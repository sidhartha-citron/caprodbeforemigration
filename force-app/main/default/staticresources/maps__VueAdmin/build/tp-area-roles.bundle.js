(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[867],{8591:(e,t,s)=>{e.exports=s.p+"images/9d62e0ccd443ed97c86f992a410320dc.svg"},1303:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(2766);const{MAToastMessages:o}=window,l={components:{PageHeader:a.mr,ActionMenu:a.PC,ActionMenuItem:a.F9,Spinner:a.$j,Popover:a.J2,TextInput:a.oi,Picklist:a.Gp,ButtonIcon:a.Ei},data:()=>({popoverEditMode:!1,showErrorPopoverBindTo:null,roleToEdit:null,isLoading:!1,areaRolesEnabled:!1,accountTeamsEnabled:!1,etmEnabled:!1,showAreaRolePopover:!1,showInvalidRolePopover:!1,areaRolePopoverBindto:null,sortTableBy:null,sortDirection:null,areaRoles:[],areaRole:{name:"",storedName:"",accountTeamRole:{value:"",label:""},accountAccess:"",opportunityAccess:"",caseAccess:"",territoryTeamRole:{value:"",label:""}},accessOptions:[{label:"Private",value:"None"},{label:"Read Only",value:"Read"},{label:"Read/Write",value:"Edit"}],territoryTeamRoleOptions:[{label:"None",value:""}],accountTeamRoleOptions:[{label:"None",value:""}],errors:{areaRoleName:[],accountTeamRole:[],territoryTeamRole:[],accountAccess:[],caseAccess:[],opportunityAccess:[]}}),computed:{tableColumnsAvailable(){const e=["Area Role","Account Team Role","Account Team Access","Territory Team Role"];return this.accountTeamsEnabled&&this.areaRolesEnabled||e.splice(e.indexOf("Account Team Role"),1),this.accountTeamsEnabled&&this.areaRolesEnabled||e.splice(e.indexOf("Account Team Access"),1),this.etmEnabled||e.splice(e.indexOf("Territory Team Role"),1),e},sortedRows(){const e=this.areaRoles;return e.sort(((e,t)=>(e=e[this.sortTableBy]&&e[this.sortTableBy].label?e[this.sortTableBy].label:e[this.sortTableBy]||"",t=t[this.sortTableBy]&&t[this.sortTableBy].label?t[this.sortTableBy].label:t[this.sortTableBy]||"","descending"===this.sortDirection?e<t?-1:e>t?1:0:"ascending"===this.sortDirection?e>t?-1:e<t?1:0:null))),e}},async created(){this.isLoading=!0,await this.getETMRoles(),await this.checkFeatureEnabled(),await this.getAccountTeamRoles(),await this.getAreaRoles(),this.isLoading=!1},methods:{sortClick(e){const t={"Area Role":"name","Account Team Role":"accountTeamRole","Account Team Access":"accountTeamRole","Territory Team Role":"territoryTeamRole"};this.sortTableBy!==t[e]&&(this.sortTableBy=t[e],this.sortDirection="descending"),"descending"===this.sortDirection?this.sortDirection="ascending":"ascending"===this.sortDirection&&(this.sortDirection="descending")},etmRoleLabel(e){const t=e.territoryTeamRole?e.territoryTeamRole.value:e.maps__TerritoryTeamRole__c;if(t){const s=this.territoryTeamRoleOptions.find((e=>e.value===t));return s?s.label:(e.isEtmRoleValid=!1,"Invalid Role")}},checkValidAccoutTeamRole(e){const t=e.accountTeamRole?e.accountTeamRole.value:e.maps__TerritoryTeamRole__c;if(t){const s=this.accountTeamRoleOptions.find((e=>e.value===t));return s?s.label:(e.isAccountTeamRoleValid=!1,"Invalid Role")}},validateInputs(){this.clearValidationErrors(),this.areaRole.name||this.errors.areaRoleName.push("Area role name cannot be blank"),this.areaRoles.map((e=>e.name)).includes(this.areaRole.name)&&(this.popoverEditMode&&this.areaRole.name!==this.roleToEdit.name||!this.popoverEditMode)&&this.errors.areaRoleName.push("Area role name cannot be the same as an existing role"),this.territoryTeamRoleOptions.map((e=>e.value)).includes(this.areaRole.territoryTeamRole.value)||void 0===this.areaRole.territoryTeamRole.value||this.errors.territoryTeamRole.push("Invalid Role"),this.accountTeamRoleOptions.map((e=>e.value)).includes(this.areaRole.accountTeamRole.value)||void 0===this.areaRole.accountTeamRole.value||this.errors.accountTeamRole.push("Invalid Role"),this.areaRole.accountTeamRole.value&&(this.areaRole.accountAccess||this.errors.accountAccess.push("Selection Required"),this.areaRole.caseAccess||this.errors.caseAccess.push("Selection Required"),this.areaRole.opportunityAccess||this.errors.opportunityAccess.push("Selection Required"),this.areaRole.accountAccess&&!this.compliesWithOWD(this.areaRole.accountAccess,window.MA.Organization.DefaultAccountAccess)&&this.errors.accountAccess.push("Must be less restrictive or equal to the organization-wide default."),this.areaRole.caseAccess&&!this.compliesWithOWD(this.areaRole.caseAccess,window.MA.Organization.DefaultCaseAccess)&&this.errors.caseAccess.push("Must be less restrictive or equal to the organization-wide default."),this.areaRole.opportunityAccess&&!this.compliesWithOWD(this.areaRole.opportunityAccess,window.MA.Organization.DefaultOpportunityAccess)&&this.errors.opportunityAccess.push("Must be less restrictive or equal to the organization-wide default."))},compliesWithOWD:(e,t)=>!!{None:["None","Read","Edit","ReadEditTransfer"],Read:["Read","Edit","ReadEditTransfer"],Edit:["Edit","ReadEditTransfer"],ReadEditTransfer:["Edit","ReadEditTransfer"]}[t].includes(e),clearValidationErrors(){this.errors={areaRoleName:[],accountTeamRole:[],territoryTeamRole:[],accountAccess:[],caseAccess:[],opportunityAccess:[]}},showErrorPopover(e){this.showInvalidRolePopover=!1,this.showErrorPopoverBindTo=e,this.showInvalidRolePopover=!0},showPopover(e,t,s){this.roleToEdit=null,this.areaRole={name:"",storedName:"",accountTeamRole:{value:"",label:""},accountAccess:"",opportunityAccess:"",caseAccess:"",territoryTeamRole:{value:"",label:""}},this.areaRolePopoverBindto=e,t&&t.id&&(this.popoverEditMode=!0,this.roleToEdit=t,this.areaRole=JSON.parse(JSON.stringify(t))),s&&(this.popoverEditMode=!1),this.clearValidationErrors(),this.showAreaRolePopover=!0},async checkFeatureEnabled(){const e=await this.$remote("maps.TPRemoteActions.CheckForManageAreaRoles");e&&e.data&&"true"===e.data.maps__Value__c?this.areaRolesEnabled=!0:this.areaRolesEnabled=!1},async getAreaRoles(){try{const e=await this.$remote("maps.TPRemoteActions.GetTerritoryPlanningRoles");e.success?this.areaRoles=e.data.map((e=>({id:e.Id,name:e.Name,storedName:e.Name,accountTeamRole:{value:e.maps__AccountTeamRole__c||void 0,label:e.maps__AccountTeamRole__c||""},accountAccess:e.maps__AccountAccessLevel__c||void 0,opportunityAccess:e.maps__OpportunityAccessLevel__c||void 0,caseAccess:e.maps__CaseAccessLevel__c||void 0,territoryTeamRole:{value:e.maps__TerritoryTeamRole__c,label:this.etmRoleLabel(e)},isAccountTeamRoleValid:!0,isEtmRoleValid:!0}))):console.error(e.message)}catch(e){console.error(e)}},async getAccountTeamRoles(){try{const{data:e,success:t}=await this.$remote("maps.TPRemoteActions.GetTeamMemberRoles");t&&(e.length<1?o.showError({position:"toast-top-right",message:"No Account Team Roles Defined",timeOut:3e3}):(this.accountTeamsEnabled=!0,this.accountTeamRoleOptions=this.accountTeamRoleOptions.concat(e),[this.areaRole.accountTeamRole.value]=this.accountTeamRoleOptions))}catch(e){console.error("Issue fetching Account Team roles",e)}},async getETMRoles(){try{const{success:e,data:t}=await this.$remote("maps.TPRemoteActions.GetTerritoryRoles");if(e)if(this.etmEnabled=!0,t.length<1)o.showWarning({position:"toast-top-right",message:"No ETM Roles Defined",timeOut:3e3});else{this.territoryTeamRoleOptions=this.territoryTeamRoleOptions.concat(t.filter((e=>e.active))),this.areaRole.territoryTeamRole=this.territoryTeamRoleOptions[0];const e=t.filter((e=>e.active&&e.defaultValue));e[0]&&(this.areaRole.territoryTeamRole=e[0])}}catch(e){console.error("Issue fetching ETM roles",e)}},async saveRole(){try{if(this.isLoading=!0,this.validateInputs(),Object.values(this.errors).filter((e=>e.length>0)).length>0)return this.isLoading=!1,void o.showError({position:"toast-top-right",message:"Please fix validation errors",timeOut:3e3});const e={Id:this.popoverEditMode?this.roleToEdit.id:void 0,SObjectType:this.popoverEditMode?void 0:"maps__TPRole__c",Name:this.areaRole.name,maps__AccountTeamRole__c:this.areaRole.accountTeamRole.value,maps__AccountAccessLevel__c:this.areaRole.accountTeamRole.value?this.areaRole.accountAccess:"",maps__OpportunityAccessLevel__c:this.areaRole.accountTeamRole.value?this.areaRole.opportunityAccess:"",maps__CaseAccessLevel__c:this.areaRole.accountTeamRole.value?this.areaRole.caseAccess:"",maps__TerritoryTeamRole__c:this.areaRole.territoryTeamRole.value},{success:t,message:s}=await this.$remote("maps.TPRemoteActions."+(this.popoverEditMode?"UpdateObjectBatch":"InsertObjectBatch"),[[e],!0]);t?(this.showAreaRolePopover=!1,await this.getAreaRoles(),this.isLoading=!1,o.showSuccess({position:"toast-top-right",message:`Area Role (${e.Name}) ${this.popoverEditMode?"Modified":"Created"}`,timeOut:3e3})):(this.isLoading=!1,o.showError({position:"toast-top-right",message:`Error ${this.popoverEditMode?"updating":"creating"} role`,timeOut:3e3}),console.error(s))}catch(e){this.isLoading=!1,console.error(e)}},async deleteRole(e){try{this.isLoading=!0;const{success:t}=await this.$remote("maps.TPRemoteActions.DeleteObjects",[[e.id]]);t&&(await this.getAreaRoles(),this.isLoading=!1,o.showSuccess({position:"toast-top-right",message:`Area Role (${e.name}) Deleted`,timeOut:3e3}))}catch(e){this.isLoading=!1,console.error(e)}}}},r=(0,s(1900).Z)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{height:"100%"},attrs:{id:"app"}},[a("div",{staticClass:"slds-is-relative slds-p-vertical_medium"},[a("PageHeader",{attrs:{iconCategory:"custom",iconName:"Maps Logo",label:"Territory Planning",title:"Area Roles"}},[a("Icon",{staticClass:"slds-icon_container slds-icon-standard-screen",attrs:{slot:"icon",src:s(8591),iconClass:["slds-icon","ma-Maps-icon"]},slot:"icon"}),e._v(" "),a("div",{attrs:{slot:"actions"},slot:"actions"},[a("button",{ref:"newButton",staticClass:"slds-button slds-button_neutral",attrs:{type:"button"},on:{click:function(t){return e.showPopover(e.$refs.newButton,!1,!0)}}},[e._v("\n                    New\n                ")])])],1)],1),e._v(" "),a("Spinner",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}]}),e._v(" "),e.isLoading?e._e():a("div",{staticClass:"slds-box slds-p-around_none"},[e._m(0),e._v(" "),a("div",{staticClass:"slds-grid slds-align-middle"},[a("div",{staticClass:"slds-table_header-fixed_container slds-grid slds-grid_vertical slds-border_top"},[a("div",{ref:"tableContainer",staticClass:"slds-table_header-fixed_scroller"},[a("table",{staticClass:"slds-table slds-table_fixed-layout slds-table_header-fixed slds-table_resizable-cols slds-table_bordered",attrs:{id:"table-header","aria-multiselectable":"true",role:"grid"}},[a("thead",[a("tr",{staticClass:"slds-line-height_reset"},[a("th",{staticClass:"slds-text-align_right",staticStyle:{height:"0px","line-height":"0",width:"3.25rem"},attrs:{scope:"col"}}),e._v(" "),e._l(e.tableColumnsAvailable,(function(t,s){return a("th",{key:s,staticClass:"slds-is-sortable",class:{"slds-is-sorted":e.sortTableBy==t,"slds-is-sorted_asc":"ascending"==e.sortDirection},staticStyle:{height:"0px","line-height":"0"},attrs:{"aria-label":t,"aria-sort":e.sortDirection,scope:"col"},on:{click:function(s){return e.sortClick(t)}}},[a("a",{staticClass:"slds-th__action slds-text-link_reset",staticStyle:{display:"flex",height:"0px",overflow:"hidden","padding-bottom":"0px","padding-top":"0px",visibility:"hidden",border:"1px solid blue"},attrs:{href:"javascript:void(0)",role:"button",tabindex:"0"}},["ascending"===e.sortDirection?a("Icon",{attrs:{category:"utility",name:"arrowup",iconClass:["slds-is-sortable__icon"],"aria-hidden":"true"}}):a("Icon",{attrs:{category:"utility",name:"arrowdown",iconClass:["slds-is-sortable__icon"],"aria-hidden":"true"}}),e._v(" "),a("span",{staticClass:"slds-assistive-text",attrs:{"aria-live":"assertive","aria-atomic":"true"}},[e._v("\n                                            $Labels.Sort_By\n                                        ")])],1),e._v(" "),a("div",{staticClass:"slds-cell-fixed",staticStyle:{display:"flex","flex-flow":"row nowrap"}},[a("a",{staticClass:"slds-th__action slds-text-link_reset",staticStyle:{"align-items":"center",display:"flex",flex:"1 1 auto","line-height":"1.25",width:"100%"},attrs:{href:"javascript:void(0)",role:"button",tabindex:"0"}},[a("span",{staticClass:"slds-truncate",attrs:{title:t}},[e._v("\n                                                "+e._s(t)+"\n                                            ")]),e._v(" "),"ascending"===e.sortDirection?a("Icon",{attrs:{category:"utility",name:"arrowup",iconClass:["slds-is-sortable__icon","slds-icon","slds-icon_x-small","slds-icon-text-default"],"aria-hidden":"true"}}):a("Icon",{attrs:{category:"utility",name:"arrowdown",iconClass:["slds-is-sortable__icon","slds-icon","slds-icon_x-small","slds-icon-text-default"],"aria-hidden":"true"}})],1)])])})),e._v(" "),a("th",{staticClass:"slds-text-align_right",staticStyle:{height:"0px","line-height":"0",width:"3.25rem"},attrs:{scope:"col"}})],2)]),e._v(" "),a("tbody",e._l(e.sortedRows,(function(t,s){return a("tr",{key:s,staticClass:"slds-hint-parent"},[a("td",{staticStyle:{width:"3.25rem"},attrs:{role:"gridcell"}}),e._v(" "),a("td",{attrs:{role:"gridcell"}},[a("div",{staticClass:"slds-truncate",attrs:{title:t.name}},[e._v("\n                                        "+e._s(t.name)+"\n                                    ")])]),e._v(" "),e.accountTeamsEnabled&&e.areaRolesEnabled?a("td",{attrs:{role:"gridcell"}},[t.isAccountTeamRoleValid?a("div",{ref:"accountTeamRole",refInFor:!0,staticClass:"slds-truncate",attrs:{title:e.checkValidAccoutTeamRole(t)}},[e._v("\n                                        "+e._s(e.checkValidAccoutTeamRole(t))+"\n                                    ")]):a("div",[a("ButtonIcon",{ref:"accountTeamRole+"+t.id,refInFor:!0,attrs:{title:"Invalid Role",assistiveText:"Invalid Role",iconCategory:"utility",iconName:"error",iconSize:"medium"},on:{click:function(s){return e.showErrorPopover(e.$refs["accountTeamRole+"+t.id].$el)}}}),e._v("\n                                        "+e._s(e.checkValidAccoutTeamRole(t))+"\n                                    ")],1)]):e._e(),e._v(" "),e.accountTeamsEnabled&&e.areaRolesEnabled?a("td",{attrs:{role:"gridcell"}},[t.accountTeamRole.value?a("div",{staticClass:"slds-grid slds-grid_vertical",attrs:{title:"Access Level"}},[a("span",[e._v("Account: "+e._s(t.accountAccess))]),e._v(" "),a("span",[e._v("Opportunity: "+e._s(t.opportunityAccess))]),e._v(" "),a("span",[e._v("Case: "+e._s(t.caseAccess))])]):e._e()]):e._e(),e._v(" "),e.etmEnabled?a("td",{attrs:{role:"gridcell"}},[t.isEtmRoleValid?a("div",{ref:"etmRole",refInFor:!0,staticClass:"slds-truncate",attrs:{title:e.etmRoleLabel(t)}},[e._v("\n                                        "+e._s(e.etmRoleLabel(t))+"\n                                    ")]):a("div",[a("ButtonIcon",{ref:"etmRole+"+t.id,refInFor:!0,attrs:{title:"Invalid Role",assistiveText:"Invalid Role",iconCategory:"utility",iconName:"error",iconSize:"medium"},on:{click:function(s){return e.showErrorPopover(e.$refs["etmRole+"+t.id].$el)}}}),e._v("\n                                        "+e._s(e.etmRoleLabel(t))+"\n                                    ")],1)]):e._e(),e._v(" "),a("td",{attrs:{role:"gridcell"}},[a("ActionMenu",{attrs:{alignment:"right"}},[a("button",{ref:"editButton",refInFor:!0,staticClass:"slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-x-small",attrs:{slot:"button"},slot:"button"},[a("span",{staticClass:"slds-button__icon ma-icon ma-icon-down"})]),e._v(" "),a("ActionMenuItem",{attrs:{label:"Edit"},on:{click:function(a){return e.showPopover(e.$refs.editButton[s],t)}}}),e._v(" "),a("ActionMenuItem",{directives:[{name:"show",rawName:"v-show",value:"Area Owner"!==t.storedName,expression:"role.storedName !== 'Area Owner'"}],attrs:{label:"Delete"},on:{click:function(s){return e.deleteRole(t)}}})],1)],1)])})),0)])])])])]),e._v(" "),e.showAreaRolePopover?a("Popover",{attrs:{bindTo:e.areaRolePopoverBindto,direction:"slds-nubbin_left",alignment:"left bottom",closeOnClickOutside:""},on:{close:function(t){e.showAreaRolePopover=!1}}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"slds-align_absolute-center"},[e._v("\n                New Role\n            ")])]),e._v(" "),a("div",{staticClass:"slds-grid slds-grid_vertical slds-p-around_xx-small slds-border_top",attrs:{slot:"content"},slot:"content"},[a("TextInput",{attrs:{labels:{name:"Name",placeholder:"Name",placeholder:""},errors:e.errors.areaRoleName,disabled:"Area Owner"===e.areaRole.storedName&&e.popoverEditMode,required:""},model:{value:e.areaRole.name,callback:function(t){e.$set(e.areaRole,"name",t)},expression:"areaRole.name"}}),e._v(" "),e.accountTeamsEnabled&&e.areaRolesEnabled?a("Picklist",{directives:[{name:"show",rawName:"v-show",value:"Area Owner"!==e.areaRole.storedName,expression:"areaRole.storedName !== 'Area Owner'"}],attrs:{options:e.accountTeamRoleOptions,idKey:"value",titleKey:"label",labels:{name:"Account Team Role",placeholder:""},errors:e.errors.accountTeamRole},model:{value:e.areaRole.accountTeamRole.value,callback:function(t){e.$set(e.areaRole.accountTeamRole,"value",t)},expression:"areaRole.accountTeamRole.value"}}):e._e(),e._v(" "),e.accountTeamsEnabled&&e.areaRolesEnabled?a("Picklist",{directives:[{name:"show",rawName:"v-show",value:"Area Owner"!==e.areaRole.storedName,expression:"areaRole.storedName !== 'Area Owner'"}],attrs:{disabled:!e.areaRole.accountTeamRole.value,options:e.accessOptions,idKey:"value",titleKey:"label",labels:{name:"Account Access",placeholder:""},errors:e.errors.accountAccess},model:{value:e.areaRole.accountAccess,callback:function(t){e.$set(e.areaRole,"accountAccess",t)},expression:"areaRole.accountAccess"}}):e._e(),e._v(" "),e.accountTeamsEnabled&&e.areaRolesEnabled?a("Picklist",{directives:[{name:"show",rawName:"v-show",value:"Area Owner"!==e.areaRole.storedName,expression:"areaRole.storedName !== 'Area Owner'"}],attrs:{disabled:!e.areaRole.accountTeamRole.value,options:e.accessOptions,idKey:"value",titleKey:"label",labels:{name:"Opportunity Access",placeholder:""},errors:e.errors.opportunityAccess},model:{value:e.areaRole.opportunityAccess,callback:function(t){e.$set(e.areaRole,"opportunityAccess",t)},expression:"areaRole.opportunityAccess"}}):e._e(),e._v(" "),e.accountTeamsEnabled&&e.areaRolesEnabled?a("Picklist",{directives:[{name:"show",rawName:"v-show",value:"Area Owner"!==e.areaRole.storedName,expression:"areaRole.storedName !== 'Area Owner'"}],attrs:{disabled:!e.areaRole.accountTeamRole.value,options:e.accessOptions,idKey:"value",titleKey:"label",labels:{name:"Case Access",placeholder:""},errors:e.errors.caseAccess},model:{value:e.areaRole.caseAccess,callback:function(t){e.$set(e.areaRole,"caseAccess",t)},expression:"areaRole.caseAccess"}}):e._e(),e._v(" "),e.etmEnabled?a("Picklist",{attrs:{options:e.territoryTeamRoleOptions,idKey:"value",titleKey:"label",labels:{name:"Territory Team Role",placeholder:""},errors:e.errors.territoryTeamRole},model:{value:e.areaRole.territoryTeamRole.value,callback:function(t){e.$set(e.areaRole.territoryTeamRole,"value",t)},expression:"areaRole.territoryTeamRole.value"}}):e._e()],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"slds-text-align_right"},[a("button",{staticClass:"slds-button slds-button_neutral",on:{click:function(t){e.showAreaRolePopover=!1}}},[e._v("\n                    Cancel\n                ")]),e._v(" "),a("button",{staticClass:"slds-button slds-button_brand",on:{click:function(t){return e.saveRole()}}},[e._v("\n                    Save\n                ")])])])]):e._e(),e._v(" "),e.showInvalidRolePopover?a("Popover",{attrs:{bindTo:e.showErrorPopoverBindTo,theme:"error",position:"absolute",alignment:"top",closeOnClickOutside:"",width:"medium"},on:{close:function(t){e.showInvalidRolePopover=!1}}},[a("template",{slot:"header"},[e._v("Invalid Role")]),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[e._v("Role has been deactivated or deleted.")])],2):e._e()],1)}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"slds-grid slds-grid_vertical dashboard-header"},[s("div",{staticClass:"slds-grid slds-wrap slds-m-around--medium"},[s("div",{staticClass:"slds-form-element slds-col slds-size_1-of-1 slds-large-size_4-of-12"},[s("div",{staticClass:"slds-media__body"},[s("h2",{staticClass:"slds-card__header-title slds-text-heading_medium"},[s("span",[e._v("Area Roles")])])])])])])}],!1,null,null,null).exports}}]);