"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[7995],{5585:(e,s,t)=>{t.r(s),t.d(s,{default:()=>o});var a=t(3088),l=t(2766);const{MAToastMessages:i}=window,c={components:{Spinner:l.$j,Select:l.Ph},data:()=>({isLoading:!1,scheduledBatchData:null,batchesToSchedule:{title:null},frequencyOptions:{options:[{value:"5mins",label:"Every 5 mins"},{value:"10mins",label:"Every 10 mins"},{value:"15mins",label:"Every 15 mins"},{value:"30mins",label:"Every 30 mins"},{value:"Hourly",label:"Hourly"},{value:"Daily",label:"Daily"}],label:"Frequency",selectedValue:"Hourly"},selectedDailyTime:null,dailyTimeOptions:{options:[{value:"0",label:"12:00 AM"},{value:"1",label:"1:00 AM"},{value:"2",label:"2:00 AM"},{value:"3",label:"3:00 AM"},{value:"4",label:"4:00 AM"},{value:"5",label:"5:00 AM"},{value:"6",label:"6:00 AM"},{value:"7",label:"7:00 AM"},{value:"8",label:"8:00 AM"},{value:"9",label:"9:00 AM"},{value:"10",label:"10:00 AM"},{value:"11",label:"11:00 AM"},{value:"12",label:"12:00 PM"},{value:"13",label:"1:00 PM"},{value:"14",label:"2:00 PM"},{value:"15",label:"3:00 PM"},{value:"16",label:"4:00 PM"},{value:"17",label:"5:00 PM"},{value:"18",label:"6:00 PM"},{value:"19",label:"7:00 PM"},{value:"20",label:"8:00 PM"},{value:"21",label:"9:00 PM"},{value:"22",label:"10:00 PM"},{value:"23",label:"11:00 PM"}],label:"Preferred Time",selectedValue:"0"},scheduleSettings:{DailySummBatchFrequency:null,DailySummBatchPreferredTime:null,DailySummBatchScheduled:!1,LastPositionBatchScheduled:!1}}),async created(){await this.scheduleBatchChecker(),await this.checkIfBatchesScheduled()},methods:{determineBatchesForUpdate(e){e&&(e.DailySummBatchScheduled&&e.LastPositionBatchScheduled||(e.DailySummBatchScheduled||e.LastPositionBatchScheduled?e.DailySummBatchScheduled&&!e.LastPositionBatchScheduled?(this.batchesToSchedule.title="Set Last Position Batch Job",this.scheduleSettings.DailySummBatchScheduled=!0,this.scheduleSettings.LastPositionBatchScheduled=!1):!e.DailySummBatchScheduled&&e.LastPositionBatchScheduled?(this.batchesToSchedule.title="Set Summary Batch Job",this.scheduleSettings.DailySummBatchScheduled=!1,this.scheduleSettings.LastPositionBatchScheduled=!0):i.showError({position:"toast-top-right",message:"Error",subMessage:"There was an issue checking if batches are already scheduled.",timeOut:8e3}):(this.batchesToSchedule.title="Set Summary & Last Position Batch Job",this.scheduleSettings.DailySummBatchScheduled=!1,this.scheduleSettings.LastPositionBatchScheduled=!1)))},async checkIfBatchesScheduled(){this.isLoading=!0;try{const{success:e,data:s}=await(0,a.wX)("maps.LiveRemoteFunctions.checkIfBatchesScheduled",[]);e?(this.scheduledBatchData=s,this.determineBatchesForUpdate(s)):i.showError({position:"toast-top-right",message:"Error",subMessage:"There was an issue retrieving your org's batch scheduling settings.",timeOut:8e3})}catch(e){i.showError({position:"toast-top-right",message:"Error",subMessage:e,timeOut:8e3})}finally{this.isLoading=!1}},async scheduleBatchChecker(){this.isLoading=!0;try{const{success:e,error:s}=await(0,a.wX)("maps.LiveRemoteFunctions.checkScheduledBatches",[]);e||i.showError({position:"toast-top-right",message:"Error",subMessage:s,timeOut:8e3})}catch(e){i.showError({position:"toast-top-right",message:"Error",subMessage:e,timeOut:8e3})}finally{this.isLoading=!1}},async saveAndscheduleBatches(){this.isLoading=!0;try{this.scheduleSettings.DailySummBatchFrequency=this.frequencyOptions.selectedValue,this.scheduleSettings.DailySummBatchPreferredTime=this.dailyTimeOptions.selectedValue;const{success:e,data:s}=await(0,a.wX)("maps.LiveRemoteFunctions.saveAndscheduleBatches",[this.scheduleSettings]);e?(i.showSuccess({position:"toast-top-right",message:"Success",subMessage:s,timeOut:8e3}),await this.checkIfBatchesScheduled()):i.showError({position:"toast-top-right",message:"Error",subMessage:"There was an issue retrieving your org's batch scheduling settings.",timeOut:8e3})}catch(e){i.showError({position:"toast-top-right",message:"Remoting Error",subMessage:e,timeOut:8e3})}finally{this.isLoading=!1}}}},o=(0,t(1900).Z)(c,(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"slds-m-around--medium",attrs:{id:"app"}},[e.isLoading?t("Spinner"):e._e(),e._v(" "),t("div",{staticClass:"slds-section__title slds-theme--shade"},[t("div",{staticClass:"slds-media__figure slds-m-right_x-small"},[t("Icon",{staticStyle:{"background-color":"transparent"},attrs:{category:"custom",name:"custom109",iconClass:"slds-icon-text-default",assistiveText:"Batch Job Scheduling"}})],1),e._v(" "),t("span",{staticClass:"section-header-title slds-truncate"},[e._v("Batch Job Scheduling")])]),e._v(" "),t("div",{staticClass:"slds-m-around--small"},[e.scheduledBatchData&&e.scheduledBatchData.DailySummBatchScheduled&&e.scheduledBatchData.CountOfActiveConfigs>0?t("div",[t("div",{staticClass:"slds-text-heading_medium slds-p-top--small slds-p-bottom--small"},[e._v("\n                Live Tracking Summary Batch Job\n            ")]),e._v(" "),e._m(0)]):e._e(),e._v(" "),e.scheduledBatchData&&e.scheduledBatchData.DailySummBatchScheduled&&e.scheduledBatchData.CountOfActiveConfigs<1?t("div",[t("div",{staticClass:"slds-text-heading_medium slds-p-top--small slds-p-bottom--small"},[e._v("\n                Live Tracking Summary Batch Job\n            ")]),e._v(" "),e._m(1)]):e._e(),e._v(" "),e.scheduledBatchData&&e.scheduledBatchData.LastPositionBatchScheduled?t("div",[t("div",{staticClass:"slds-text-heading_medium slds-p-top--large slds-p-bottom--small"},[e._v("\n                Last Position Batch Job\n            ")]),e._v(" "),e._m(2)]):e._e(),e._v(" "),!e.scheduledBatchData||e.scheduledBatchData.DailySummBatchScheduled&&e.scheduledBatchData.LastPositionBatchScheduled?e._e():t("div",[t("div",{staticClass:"slds-text-heading_medium slds-p-top--medium slds-p-bottom--small"},[e._v("\n                "+e._s(e.batchesToSchedule.title)+" Schedule\n            ")]),e._v(" "),t("div",{staticClass:"slds-box"},[t("Select",{attrs:{options:e.frequencyOptions.options,labels:{name:e.frequencyOptions.label},hasNoneOption:!1,keyString:"value",valueString:"label"},model:{value:e.frequencyOptions.selectedValue,callback:function(s){e.$set(e.frequencyOptions,"selectedValue",s)},expression:"frequencyOptions.selectedValue"}}),e._v(" "),"Daily"===e.frequencyOptions.selectedValue?t("Select",{attrs:{options:e.dailyTimeOptions.options,labels:{name:e.dailyTimeOptions.label},hasNoneOption:!1,keyString:"value",valueString:"label"},model:{value:e.dailyTimeOptions.selectedValue,callback:function(s){e.$set(e.dailyTimeOptions,"selectedValue",s)},expression:"dailyTimeOptions.selectedValue"}}):e._e(),e._v(" "),t("div",{staticClass:"slds-p-left_x-small slds-p-top_x-small"},[t("button",{staticClass:"slds-button slds-button--success slds-button--brand",attrs:{id:"alertsavebtn",type:"button"},on:{click:e.saveAndscheduleBatches}},[e._v("\n                        Save\n                    ")])])],1)])])],1)}),[function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"slds-box slds-p-top--small"},[e._v("\n                Daily or Hourly Summary Job "),t("span",{staticClass:"slds-text-color_success"},[e._v("already scheduled")]),e._v(", to manage please go to "),t("strong",[e._v("Setup -> Scheduled Jobs")]),e._v(".\n            ")])},function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"slds-box slds-p-top--small"},[e._v("\n                Please "),t("a",{attrs:{href:"/apex/maps__Settings?tabId=LiveDailySummaries"}},[e._v("create a Daily Summary configuration")]),e._v(" to schedule a job.\n            ")])},function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"slds-box"},[e._v("\n                Last Position Job "),t("span",{staticClass:"slds-text-color_success"},[e._v("already scheduled")]),e._v(", to manage please go to "),t("strong",[e._v("Setup -> Scheduled Jobs")]),e._v(".\n            ")])}],!1,null,null,null).exports}}]);