"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[3538],{9030:(s,e,t)=>{t.r(e),t.d(e,{default:()=>V});var l=t(2766),a=t(1296),i=t.n(a),n=t(3465),r=t.n(n),o=t(5658),d=t(5908),c=t.n(d);const _=s=>({data:()=>({displayedRows__displayedRowsCount:0,displayedRows__displayedRowsIncrementer:50,displayedRows__maxDisplayedNumberOfRows:2e3,displayedRows__maxRowsDisplayed:!1}),computed:{displayedRows__displayedRows(){return this[s].slice(0,this.displayedRows__displayedRowsCount)}},destroyed(){this.displayedRows__removeScrollEventListener()},methods:{displayedRows__pageBottom(){if(Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)+window.innerHeight!==document.documentElement.offsetHeight)return;const e=this.displayedRows__displayedRowsCount+this.displayedRows__displayedRowsIncrementer;if(this[s].length<=e)this.displayedRows__maxRowsDisplayed=!0,this.displayedRows__removeScrollEventListener(),this.displayedRows__displayedRowsCount=this[s].length;else if(this.displayedRows__displayedRows.length<this.displayedRows__maxDisplayedNumberOfRows){if(this.displayedRows__displayedRowsCount+=this.displayedRows__displayedRowsIncrementer,this.displayedRows__displayedRowsCount!==this.displayedRows__maxDisplayedNumberOfRows)return;this.displayedRows__maxRowsDisplayed=!0,this.displayedRows__removeScrollEventListener()}},displayedRows__removeScrollEventListener(){window.removeEventListener("scroll",this.displayedRows__pageBottom)},displayedRows__addScrollEventListener(){window.addEventListener("scroll",this.displayedRows__pageBottom)},displayedRows__applyListenerBasedOnRowsRetrieved(){this[s].length<=50?this.displayedRows__displayedRowsCount=this[s].length:(this.displayedRows__addScrollEventListener(),this.displayedRows__displayedRowsCount=this.displayedRows__displayedRowsIncrementer)}}}),u={components:{Icon:l.JO},props:{heading:{type:String,default:"Default Heading"},subHeading:{type:String,default:"Default Sub-Heading"}}};var m=t(1900);const h=(0,m.Z)(u,(function(){var s=this,e=s.$createElement,l=s._self._c||e;return l("div",{staticClass:"slds-illustration slds-illustration_small slds-m-top_medium"},[l("Icon",{attrs:{src:t(4079)}}),s._v(" "),l("div",{staticClass:"slds-text-longform slds-m-top_medium"},[l("h3",{staticClass:"slds-text-heading_medium"},[s._v(s._s(s.heading))]),s._v(" "),l("p",[s._v(" "+s._s(s.subHeading))])])],1)}),[],!1,null,null,null).exports,g={components:{Spinner:l.$j,Picklist:l.Gp,Modal:l.u_,TextInput:l.oi,Icon:l.JO,Button:l.zx,ButtonIcon:l.Ei,EmptyState:h,Checkbox:l.XZ},mixins:[_("planRuns")],data(){return{callouts:0,planRuns:[],originalPlanRuns:[],scheduledJob:{},searchTerm:"",searchIsHappening:!1,modalShow:!1,runschedule:!1,interval:4,intervals:[],defaultSummaryText:this.$Labels.AutoAssignment_Plans_Not_Scheduled,plannedSummaryText:""}},computed:{isLoading(){return this.callouts>0},emptyStateHeader(){return this.searchIsHappening?"":this.$Labels.AutoAssignment_Scheduled_Plans_Empty_State_Header_Text},emptyStateSubHeader(){return this.searchIsHappening?"":this.$Labels.AutoAssignment_Scheduled_Plans_Empty_State_SubHeader_Text}},watch:{searchTerm(){(this.searchTerm.length>=3||0===this.searchTerm.length)&&this.debouncedGetPlanRunsBySearchTerm()}},mounted(){[1,2,4,8,24].forEach((s=>{this.intervals.push({value:s,label:(0,o.N4)(this.$Labels.AutoAssignment_Schedule_Job_Interval_Options,[s])})})),this.getScheduledJob(),this.getJobs()},methods:{...(0,d.mapGetters)(["getAssignmentPlans"]),debouncedGetPlanRunsBySearchTerm:i()((async function(){this.planRuns=this.originalPlanRuns.filter((({planName:s=""})=>s.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.displayedRows__applyListenerBasedOnRowsRetrieved(),this.searchIsHappening=0!==this.searchTerm.length,0===this.searchTerm.length&&this.displayedRows__applyListenerBasedOnRowsRetrieved()}),500),resetSearch(){this.searchTerm="",this.displayedRows__applyListenerBasedOnRowsRetrieved()},hideModal(){this.modalShow=!1},showModal(){this.modalShow=!0},navigateToRecord(s){window.ma_navigateToSObject(s.id)},saveCalled(){!this.runschedule&&this.scheduledJob&&this.scheduledJob.id?this.cancelScheduledJob(!0):!this.runschedule||!this.interval||this.scheduledJob&&void 0!==this.scheduledJob&&this.interval===this.scheduledJob.interval||this.saveBatchInterval(),this.hideModal()},async saveBatchInterval(){this.callouts++;try{const{success:s,error:e}=await this.$remoting("AutoAssignmentController.saveBatchInterval",[this.interval]);s||this.$root.$emit("toast",{message:e.message,state:"error",closeLabel:this.$Labels.MA_Close})}catch(s){this.$root.$emit("toast",{message:s.message,state:"error",closeLabel:this.$Labels.MA_Close})}finally{await this.cancelScheduledJob()||(this.runPlans(),this.schedulePlans()),this.callouts--}},async runPlans(){this.callouts++;try{const{success:s,error:e}=await this.$remoting("AutoAssignmentController.runPlans",[]);s?this.getJobs():this.$root.$emit("toast",{message:e.message,state:"error",closeLabel:this.$Labels.MA_Close})}catch(s){this.$root.$emit("toast",{message:s.message,state:"error",closeLabel:this.$Labels.MA_Close})}finally{this.callouts--}},async getJobs(){this.callouts++;try{const s=await this.$remoting("AutoAssignmentController.getJobs",[0]);let{success:e,error:t}=s;const{data:l}=s;if(e&&l.queryMore){const s=[];for(;l.iterator<l.numRecords;)s.push(this.$remoting("AutoAssignmentController.getJobs",[l.iterator])),l.iterator+=l.batchSize;const a=await Promise.all(s);for(let s=0;s<a.length;s++){const i=a[s];if(!i.success){e=!1,t=i.error;break}l.jobs.concat(i.data.jobs)}}e?(this.planRuns=l.jobs,this.displayedRows__applyListenerBasedOnRowsRetrieved(),l.jobs.forEach((s=>{const e={};switch(s.status){case"Caching":e.class="slds-badge_inverse",e.text=this.$Labels.AutoAssignment_Scheduled_Plans_Caching_Badge_Text;break;case"Processing":e.class="slds-badge_inverse",e.text=this.$Labels.AutoAssignment_Scheduled_Plans_Running_Badge_Text;break;case"Completed":e.class="slds-theme_success",e.text=this.$Labels.AutoAssignment_Scheduled_Plans_Finished_Badge_Text;break;case"Failed":e.class="slds-theme_error",e.text=this.$Labels.AutoAssignment_Scheduled_Plans_Failed_Badge_Text;break;case"Aborted":e.class="slds-theme_warning",e.text=this.$Labels.AutoAssignment_Scheduled_Plans_Aborted_Badge_Text;break;default:e.class="slds-badge_lightest",e.text=this.$Labels.AutoAssignment_Scheduled_Plans_Queued_Badge_Text}s.badge=e})),this.originalPlanRuns=r()(l)):this.$root.$emit("toast",{message:t.message,state:"error",closeLabel:this.$Labels.MA_Close})}catch(s){this.$root.$emit("toast",{message:s.message,state:"error",closeLabel:this.$Labels.MA_Close})}finally{this.callouts--}},async schedulePlans(){this.callouts++;try{const{success:s,message:e,error:t}=await this.$remoting("AutoAssignmentController.schedulePlans",[]);s?(this.getScheduledJob(),this.$root.$emit("toast",{message:e,state:"success",closeLabel:this.$Labels.MA_Close,duration:6e3})):this.$root.$emit("toast",{message:t.message,state:"error",closeLabel:this.$Labels.MA_Close})}catch(s){this.$root.$emit("toast",{message:s.message,state:"error",closeLabel:this.$Labels.MA_Close})}finally{this.callouts--}},async getScheduledJob(){this.callouts++;try{const{data:s,success:e,error:t}=await this.$remoting("AutoAssignmentController.getScheduledJob",[]);e?(this.scheduledJob=s,s&&s.id&&(this.runschedule=!0,this.interval=s.interval,this.plannedSummaryText=(0,o.N4)(this.$Labels.AutoAssignment_ScheduledPlans_Summary,[s.ownerName,this.interval]))):this.$root.$emit("toast",{message:t.message,state:"error",closeLabel:this.$Labels.MA_Close})}catch(s){this.$root.$emit("toast",{message:s.message,state:"error",closeLabel:this.$Labels.MA_Close})}finally{this.callouts--}},async cancelScheduledJob(s){this.callouts++;let e=!1;try{const{success:t,message:l,error:a}=await this.$remoting("AutoAssignmentController.abortScheduledJob",[]);t?(this.scheduledJob={},l&&s&&(this.$root.$emit("toast",{message:l,state:"success",closeLabel:this.$Labels.MA_Close,duration:6e3}),this.plannedSummaryText=null)):(e=!0,this.$root.$emit("toast",{message:a.message,state:"error",closeLabel:this.$Labels.MA_Close}))}catch(s){e=!0,this.$root.$emit("toast",{message:s.message,state:"error",closeLabel:this.$Labels.MA_Close})}finally{this.callouts--}return e}}},p=(0,m.Z)(g,(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"slds-is-relative"},[t("div",[t("Spinner",{directives:[{name:"show",rawName:"v-show",value:s.isLoading,expression:"isLoading"}],attrs:{loadingLabel:s.$Labels.MA_Loading}})],1),s._v(" "),t("div",{staticClass:"slds-grid slds-p-horizontal_small slds-m-bottom_small"},[t("Button",{attrs:{variant:"neutral",title:s.$Labels.AutoAssignment_Set_Schedule_Button},on:{click:s.showModal}},[s._v("\n            "+s._s(s.$Labels.AutoAssignment_Set_Schedule_Button)+"\n        ")])],1),s._v(" "),t("div",{staticClass:"slds-grid slds-p-horizontal_small slds-m-bottom_small"},[s.plannedSummaryText?t("p",[s._v(s._s(s.plannedSummaryText)+" "),t("strong",[s._v(s._s(s.getAssignmentPlans().filter((function(s){return"Active"===s.status})).length))])]):t("p",[s._v(s._s(s.defaultSummaryText))]),s._v(" "),t("div",{staticClass:"slds-col_bump-left slds-grid"},[t("div",{staticClass:"slds-col slds-m-right_x-small"},[t("TextInput",{staticClass:"slds-input-has-icon slds-input-has-icon_left-right",attrs:{labels:{placeholder:s.$Labels.AutoAssignment_Scheduled_Plans_Search_Plans_Placeholder_Text}},model:{value:s.searchTerm,callback:function(e){s.searchTerm=e},expression:"searchTerm"}},[t("template",{slot:"extend"},[t("Icon",{attrs:{category:"utility",name:"search",iconClass:["slds-input__icon","slds-input__icon_left"]}}),s._v(" "),t("ButtonIcon",{staticClass:"slds-button slds-button_icon slds-input__icon slds-input__icon_right",attrs:{iconCategory:"utility",iconName:"clear",assistiveText:s.$Labels.AutoAssignment_Clear_Button_Search,iconClass:["slds-button__icon","slds-icon-text-light"],title:s.$Labels.AutoAssignment_Clear_Button_Search},on:{click:s.resetSearch}})],1)],2)],1),s._v(" "),t("div",{staticClass:"slds-col"},[t("ButtonIcon",{attrs:{variant:"border",iconCategory:"utility",iconName:"refresh",assistiveText:s.$Labels.MA_REFRESH,title:s.$Labels.MA_REFRESH,stretched:""},on:{click:s.getJobs}})],1)])]),s._v(" "),t("div",{staticClass:"slds-is-relative slds-m-top_medium"},[t("table",{staticClass:"slds-table slds-table_bordered slds-table_fixed-layout",attrs:{"aria-multiselectable":"true",role:"grid"}},[t("thead",[t("tr",{staticClass:"slds-line-height_reset"},[t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_Scheduled_Plans_Status_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Scheduled_Plans_Status_Column_Header}},[s._v(" "+s._s(s.$Labels.AutoAssignment_Scheduled_Plans_Status_Column_Header))])])]),s._v(" "),t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_Scheduled_Plans_Plan_Name_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Scheduled_Plans_Plan_Name_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Scheduled_Plans_Plan_Name_Column_Header))])])]),s._v(" "),t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_Scheduled_Plans_Errors_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Scheduled_Plans_Errors_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Scheduled_Plans_Errors_Column_Header))])])]),s._v(" "),t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_Scheduled_Plans_Records_Assigned_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Scheduled_Plans_Records_Assigned_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Scheduled_Plans_Records_Assigned_Column_Header))])])]),s._v(" "),t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_Scheduled_Plans_Records_Executed_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Scheduled_Plans_Records_Executed_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Scheduled_Plans_Records_Executed_Column_Header))])])]),s._v(" "),t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_Scheduled_Plans_Started_On_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Scheduled_Plans_Started_On_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Scheduled_Plans_Started_On_Column_Header))])])]),s._v(" "),t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_Scheduled_Plans_Finished_On_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Scheduled_Plans_Finished_On_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Scheduled_Plans_Finished_On_Column_Header))])])])])]),s._v(" "),t("tbody",s._l(s.displayedRows__displayedRows,(function(e){return t("tr",{key:e.id},[t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-badge",class:e.badge.class,attrs:{title:e.badge.text}},[s._v(s._s(e.badge.text))])])]),s._v(" "),t("th",{staticClass:"slds-cell-edit",attrs:{scope:"row",tabindex:"0"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("a",{staticClass:"slds-truncate",attrs:{tabindex:"-1",title:e.planName},on:{click:function(t){return s.navigateToRecord(e)}}},[s._v(s._s(e.planName))])])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:""}},[s._v(s._s(e.recordsErrorCount||0))])])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:""}},[s._v(s._s(e.recordsAssigned||0))])])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:""}},[s._v(s._s(e.recordsUnassigned||0))])])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:""}},[s._v(s._s(e.processingStart))])])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:""}},[s._v(s._s(e.processingEnd))])])])])})),0)]),s._v(" "),s.planRuns.length?s._e():t("EmptyState",{attrs:{heading:s.emptyStateHeader,subHeading:s.emptyStateSubHeader}})],1),s._v(" "),s.modalShow?t("Modal",{attrs:{title:s.$Labels.AutoAssignment_Set_Schedule_Modal_Header,labels:{prompt:s.$Labels.MA_Continue},size:"small"},on:{close:s.hideModal}},[t("div",{attrs:{slot:"content"},slot:"content"},[s._v("\n            "+s._s(s.$Labels.AutoAssignment_Set_Schedule_Modal_Text)+"\n            "),t("div",{staticClass:"slds-form-element"},[t("div",{staticClass:"slds-form-element__control slds-m-bottom_medium slds-m-top_medium"},[t("Checkbox",{attrs:{id:"runschedcheckbox",labels:{name:s.$Labels.AutoAssignment_Run_Schedule_Label,stateOn:s.$Labels.enabled,stateOff:s.$Labels.disabled,required:s.$Labels.required}},model:{value:s.runschedule,callback:function(e){s.runschedule=e},expression:"runschedule"}})],1),s._v(" "),t("Picklist",{staticClass:"slds-p-vertical_xx-small",attrs:{options:s.intervals,detach:!0,required:!0,labels:{name:s.$Labels.AutoAssignment_Intervals_Label,required:s.$Labels.required,search:s.$Labels.MA_Search,placeholder:s.$Labels.MA_Select_an_Option,noSearchResults:s.$Labels.MA_NO_RESULTS_FOUND,cancel:s.$Labels.MA_Cancel,clear:s.$Labels.MA_Clear,save:s.$Labels.MA_Save,removeTitle:s.$Labels.MA_Remove,removeAssistiveText:s.$Labels.MA_Remove,comboboxSearchAssistiveText:s.$Labels.MA_Search},idKey:"value",titleKey:"label"},model:{value:s.interval,callback:function(e){s.interval=e},expression:"interval"}})],1)]),s._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{variant:"neutral",title:s.$Labels.AutoAssignment_Delete_Cancel_Modal_Button},on:{click:s.hideModal}},[s._v("\n                "+s._s(s.$Labels.AutoAssignment_Delete_Cancel_Modal_Button)+"\n            ")]),s._v(" "),t("Button",{attrs:{variant:"brand",title:s.$Labels.AutoAssignment_Save_Modal_Button},on:{click:s.saveCalled}},[s._v("\n                "+s._s(s.$Labels.AutoAssignment_Save_Modal_Button)+"\n            ")])],1)]):s._e()],1)}),[],!1,null,"6bae7811",null).exports;var b=t(5602),A=t(379),v=t(553);const $={required:window.MASystem.Labels.MA_This_Field_Is_Required,notSameLocationFields:window.MASystem.Labels.AutoAssignment_Not_Same_Location_Field_Error,mustBeTested:window.MASystem.Labels.AutoAssignment_SOQL_Filter_Must_Pass_Testing,minLength:({$params:s})=>"Must be at least {0} characters.".format(s.minLength.min)};var L=t(3088);const C={methods:{genericExceptionHandler(s){this.$root.$emit("toast",{message:s.message,subMessage:`${s.action}.${s.method}`,state:"error"})},genericErrorHandler({type:s,message:e}){this.$root.$emit("toast",{message:s,subMessage:e,state:"error"})}}};var S=t(2307),y=t.n(S),w=t(9486);const f=new L.pT({ADD:{label:window.MASystem.Labels.AutoAssignment_Add_Rule},EDIT:{label:window.MASystem.Labels.AutoAssignment_Revise_Rule}});function R(){return{options:async s=>this.getUsersByTerm(s)}}const P={components:{Button:l.zx,ButtonIcon:l.Ei,Modal:l.u_,Checkbox:l.XZ,Picklist:l.Gp,Popover:l.J2,Spinner:l.$j,TextInput:l.oi},mixins:[C],props:{mode:{type:L.Jr,required:!0},rule:{type:Object,default:()=>{}}},data(){return{isLoading:!1,territories:[],bindTo:null,renderPopover:!1,renderErrorIcon:!1,originalRecord:null,record:{Name:"",AssignmentPlan__c:"",ShapeLayer__r:{Id:"",Name:""},User__r:{Id:"",Name:""},Active__c:!0},userOptions:[R.call(this)]}},validations:{record:{Name:{required:w.required},ShapeLayer__r:{Id:{required:w.required}},User__r:{Id:{required:w.required}}}},computed:{disableSave(){return y()(this.originalRecord,this.record)},saveButtonText(){return this.mode===f.ADD?this.$Labels.MA_Add:this.$Labels.AutoAssignment_Revise}},watch:{"$props.rule":{handler(s){if(this.originalRecord=r()({AssignmentPlan__c:"",...s}),Object.keys(s).length&&(this.record=r()({...this.record,...s})),this.mode===f.EDIT){const{Id:s,Name:e}=this.record.User__r;this.userOptions=[R.call(this),{id:s,title:e}]}},immediate:!0,deep:!0}},async mounted(){await this.getTerritories()},methods:{getValidationMessages:(0,b.ed)($),togglePopover(){this.renderPopover=!this.renderPopover},resetErrorState(){this.renderErrorIcon=!1,this.renderPopover=!1},onShapeLayerSelect({title:s}){this.record.ShapeLayer__r.Name=s},onUserClear(){2===this.userOptions.length&&this.userOptions.pop()},onUserSelect({title:s}){this.record.User__r.Name=s},async save(){if(this.resetErrorState(),await this.$nextTick(),this.$v.$touch(),this.$v.$invalid)return this.renderErrorIcon=!0,this.bindTo=this.$refs.errorIcon.$el,void this.togglePopover();this.record.Id?this.$emit(this.record.Id?"edit-rule":"add-rule",this.record):this.$emit(this.record.guid?"edit-rule":"add-rule",this.record)},async getTerritories(){try{this.isLoading=!0;const{success:s,data:e,error:t}=await this.$remoting("AutoAssignmentController.getTerritories");s?this.territories=e:this.genericErrorHandler(t)}catch(s){this.genericExceptionHandler(s)}finally{this.isLoading=!1}},async getUsersByTerm(s){let e=[];try{const{success:t,data:l,error:a}=await this.$remoting("AutoAssignmentController.getUsersByTerm",[s]);t?e=l:this.genericErrorHandler(a)}catch(s){this.genericExceptionHandler(s)}return e}}},x=(0,m.Z)(P,(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("Modal",{attrs:{title:s.$props.mode.label,size:"small"},on:{close:function(e){return s.$emit("close")}}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("Spinner",{directives:[{name:"show",rawName:"v-show",value:s.isLoading,expression:"isLoading"}]}),s._v(" "),t("div",{staticClass:"slds-grid slds-wrap slds-grid_pull-padded-medium slds-p-around_small"},[t("div",{staticClass:"slds-size_1-of-2 slds-p-horizontal_medium slds-p-bottom_x-small"},[t("TextInput",{attrs:{labels:{name:s.$Labels.AutoAssignment_Assignment_Rule_Name,placeholder:s.$Labels.AutoAssignment_Assignment_Rule_Placeholder},errors:s.getValidationMessages(s.$v.record.Name),required:""},model:{value:s.$v.record.Name.$model,callback:function(e){s.$set(s.$v.record.Name,"$model",e)},expression:"$v.record.Name.$model"}})],1),s._v(" "),s.renderPopover?t("Popover",{attrs:{bindTo:s.bindTo,theme:"error",position:"fixed"},on:{close:s.togglePopover}},[t("template",{slot:"header"},[s._v(s._s(s.$Labels.Snag_Error_Button_Text))]),s._v(" "),t("div",{attrs:{slot:"content"},slot:"content"},[s._v(s._s(s.$Labels.Review_Fields_Button_Text))])],2):s._e(),s._v(" "),t("div",{staticClass:"slds-size_1-of-2 slds-p-horizontal_medium",staticStyle:{"margin-top":"29px"}},[t("Checkbox",{attrs:{labels:{name:s.$Labels.AutoAssignment_Active}},model:{value:s.record.Active__c,callback:function(e){s.$set(s.record,"Active__c",e)},expression:"record.Active__c"}})],1),s._v(" "),t("div",{staticClass:"slds-size_1-of-2 slds-p-horizontal_medium slds-p-bottom_x-small"},[t("Picklist",{attrs:{options:s.territories,labels:{name:s.$Labels.AutoAssignment_Maps_Shape_Layer},errors:s.getValidationMessages(s.$v.record.ShapeLayer__r.Id),filterable:"",required:""},on:{"selected-option":s.onShapeLayerSelect},model:{value:s.$v.record.ShapeLayer__r.Id.$model,callback:function(e){s.$set(s.$v.record.ShapeLayer__r.Id,"$model",e)},expression:"$v.record.ShapeLayer__r.Id.$model"}})],1),s._v(" "),t("div",{staticClass:"slds-size_1-of-2 slds-p-horizontal_medium slds-p-bottom_x-small"},[t("Picklist",{attrs:{options:s.userOptions,labels:{name:s.$Labels.MA_User},errors:s.getValidationMessages(s.$v.record.User__r.Id),minSearchLength:3,filterable:"",required:""},on:{"selected-option":s.onUserSelect,clear:s.onUserClear},model:{value:s.$v.record.User__r.Id.$model,callback:function(e){s.$set(s.$v.record.User__r.Id,"$model",e)},expression:"$v.record.User__r.Id.$model"}})],1)],1)],1),s._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("ButtonIcon",{directives:[{name:"show",rawName:"v-show",value:s.renderErrorIcon,expression:"renderErrorIcon"}],ref:"errorIcon",staticClass:"slds-button_icon-error",attrs:{assistiveText:s.$Labels.MA_Error,iconCategory:"utility",iconName:"error",iconSize:"large"},on:{click:s.togglePopover}}),s._v(" "),t("Button",{attrs:{variant:"neutral"},on:{click:function(e){return s.$emit("close")}}},[s._v("\n            "+s._s(s.$Labels.MA_Cancel)+"\n        ")]),s._v(" "),t("Button",{attrs:{variant:"brand",disabled:s.disableSave},on:{click:s.save}},[s._v("\n            "+s._s(s.saveButtonText)+"\n        ")])],1)])}),[],!1,null,null,null).exports,T={name:"PlanAssignmentRules",components:{Button:l.zx,ButtonIcon:l.Ei,Checkbox:l.XZ,EmptyState:h,ExpandableSection:l.Lm,Icon:l.JO,RuleModal:x,Spinner:l.$j,Modal:l.u_,TextInput:l.oi},mixins:[C,_("rules")],props:{planId:{type:String,default:""}},data(){return{isLoading:!1,toggleAllFlag:!0,doToggleAll:!1,chooseRowId:(0,L.x$)(),rules:[],originalRules:[],rulesForUpsert:[],numRulesTotal:this.getNumRulesFromStore(),ruleForModal:{},renderRuleModal:!1,mode:null,modalShow:!1,singleRuleToDelete:null,isSingleRowDelete:!1,searchIsHappening:!1,searchTerm:""}},computed:{anyRulesSelected(){return this.$store.state.selectedRules.length>0},numRulesAvailable(){return 5e3-this.numRulesTotal},modalText(){return this.isSingleRowDelete?(0,o.N4)(this.$Labels.AutoAssignment_Delete_Single_Selected_Rules_Modal_Text,[this.singleRuleToDelete.Name]):0===this.$store.state.selectedRules.length?"":this.$store.state.selectedRules.length>1?(0,o.N4)(this.$Labels.AutoAssignment_Delete_Selected_Rules_Modal_Text,[this.$store.state.selectedRules.length]):(0,o.N4)(this.$Labels.AutoAssignment_Delete_Single_Selected_Rules_Modal_Text,[this.$store.state.selectedRules[0].Name])},modalTitle(){return this.isSingleRowDelete||1===this.$store.state.selectedRules.length?this.$Labels.AutoAssignment_Delete_Single_Rule_Modal_Header:this.$Labels.AutoAssignment_Delete_Rule_Modal_Header},emptyStateHeader(){return this.searchIsHappening?"":this.$Labels.AutoAssignment_Rules_Empty_State_Heading},emptyStateSubHeader(){return this.searchIsHappening?"":this.$Labels.AutoAssignment_Rules_Empty_State_Sub_Heading}},watch:{planId:{handler(s){s&&this.loadRules()},immediate:!0},rules:{handler(s){const e=s.filter(((s,e)=>(s.selected&&(s.targetIndex=e),s.selected)));this.$store.commit("updateSelectedRules",e),!this.toggleAllFlag||s.length===e.length&&0!==e.length||(this.doToggleAll=!1,this.toggleAllFlag=!1)},deep:!0},searchTerm(){(this.searchTerm.length>=3||0===this.searchTerm.length)&&this.debouncedGetAssignmentsBySearchTerm()},toggleAllFlag(s){this.doToggleAll?this.toggleAll(s):this.$nextTick((()=>{this.doToggleAll=!0}))}},destroyed(){this.$store.dispatch("resetRules")},mounted(){this.$props.planId&&this.loadRules()},methods:{getNumRulesFromStore(){return this.$store.state.assignmentPlans.reduce(((s,{numberOfRules:e=0})=>s+e),0)},toggleAll(s){this.rules.forEach((e=>{e.selected=s}))},addRule(s){s={...s,guid:(0,L.x$)(),selected:!1,dirty:!0},this.rules.unshift(s),this.originalRules.unshift(s),this.numRulesTotal++,this.displayedRows__displayedRowsCount++,this.dispatchRule(s),this.closeRule()},editRule(s){const e=this.rules.findIndex((e=>e.guid===s.guid));this.$set(this.rules,e,{...s,dirty:!0}),this.dispatchRule(s),this.closeRule()},editRulesInBulk(){this.$store.state.selectedRules.forEach((s=>{this.$set(this.rules,s.targetIndex,{...s,dirty:!0}),this.dispatchRule(s)}))},dispatchRule(s){const{Id:e=null,guid:t=null,Name:l,Active__c:a,AssignmentPlan__c:i,ShapeLayer__r:{Id:n},User__r:{Id:r}}=s;this.$store.dispatch("addRuleForUpsert",{Id:e,guid:t,Name:l,Active__c:a,AssignmentPlan__c:i,ShapeLayer__c:n,User__c:r})},getStatusBadge:s=>s?"slds-badge slds-theme_success":"slds-badge",getStatusText(s){return s?this.$Labels.AutoAssignment_Active:this.$Labels.AutoAssignment_Inactive},getLookupName:(s={})=>s.Name,async renderAddRuleModal(){const{success:s,data:e}=await this.$remoting("AutoAssignmentController.checkRuleQuantity",[]);!s||e?(this.$props.planId&&(this.ruleForModal.AssignmentPlan__c=this.$props.planId),this.mode=f.ADD,this.renderRuleModal=!0):this.$root.$emit("toast",{state:"error",message:this.$Labels.AutoAssignment_Rules_Limit_Message,subMessage:this.$Labels.AutoAssignment_Rules_Limit_SubMessage})},renderEditRuleModal(s){this.mode=f.EDIT,this.ruleForModal=s,this.renderRuleModal=!0},openDeleteRuleModalForSingleRule(s){this.isSingleRowDelete=!0,this.singleRuleToDelete=s,this.showDeleteModal()},showDeleteModal(){this.modalShow=!0},hideModal(){this.singleRuleToDelete=null,this.isSingleRowDelete=!1,this.modalShow=!1},confirmDelete(){this.isSingleRowDelete?this.deleteRule(this.singleRuleToDelete):this.deleteSelectedRules(),this.$nextTick((()=>{this.hideModal()}))},deleteRule(s){this.rules=this.rules.filter((e=>e.guid!==s.guid)),this.numRulesTotal--,this.displayedRows__displayedRowsCount--,this.displayedRows__applyListenerBasedOnRowsRetrieved();const{Id:e}=s;e?(this.$store.dispatch("checkAndRemoveRuleforUpsert",e),this.$store.dispatch("addRuleForDelete",{Id:e})):this.$store.dispatch("checkAndRemoveRuleforUpsert",s.guid)},debouncedGetAssignmentsBySearchTerm:i()((async function(){this.rules=this.originalRules.filter((({Name:s=""})=>s.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.displayedRows__applyListenerBasedOnRowsRetrieved(),this.searchIsHappening=0!==this.searchTerm.length,0===this.searchTerm.length&&this.displayedRows__applyListenerBasedOnRowsRetrieved()}),500),resetSearch(){this.displayedRows__applyListenerBasedOnRowsRetrieved(),this.searchTerm=""},closeRule(){this.ruleForModal={},this.renderRuleModal=!1},switchRulesStatus(s){this.$store.state.selectedRules.forEach((e=>{e.Active__c=s})),this.editRulesInBulk()},deleteSelectedRules(){this.$store.state.selectedRules.forEach((s=>{this.deleteRule(s)}))},async loadRules(){try{this.isLoading=!0;const{success:s,data:e,error:t}=await this.$remoting("AutoAssignmentController.getRulesByPlanId",[this.$props.planId]);s?(this.rules=e.map((s=>({...s,guid:(0,L.x$)(),selected:!1}))),this.displayedRows__applyListenerBasedOnRowsRetrieved(),this.originalRules=r()(this.rules)):this.genericErrorHandler(t)}catch(s){this.genericExceptionHandler(s)}finally{this.isLoading=!1}}}},M=(0,m.Z)(T,(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ExpandableSection",{staticClass:"slds-p-top_large slds-p-bottom_xx-large",attrs:{title:s.$Labels.AutoAssignment_Assignment_Rules,disabled:""}},[t("Spinner",{directives:[{name:"show",rawName:"v-show",value:s.isLoading,expression:"isLoading"}]}),s._v(" "),t("div",{staticClass:"slds-p-left_small slds-p-right_small slds-p-top_xx-small"},[t("p",[s._v(s._s(s.$Labels.AutoAssignment_Assignment_Rules_Description))]),s._v(" "),t("div",{staticClass:"slds-grid slds-m-top_medium"},[t("Button",{attrs:{variant:"neutral"},on:{click:s.renderAddRuleModal}},[s._v("\n                "+s._s(s.$Labels.AutoAssignment_Add_Rule)+"\n            ")]),s._v(" "),t("div",{staticClass:"slds-col_bump-left"},[t("div",{staticClass:"slds-button-group",attrs:{role:"group"}},[t("Button",{attrs:{variant:"neutral",disabled:!s.anyRulesSelected},on:{click:function(e){return s.switchRulesStatus(!0)}}},[s._v("\n                        "+s._s(s.$Labels.AutoAssignment_Activate_Button)+"\n                    ")]),s._v(" "),t("Button",{attrs:{variant:"neutral",disabled:!s.anyRulesSelected},on:{click:function(e){return s.switchRulesStatus(!1)}}},[s._v("\n                        "+s._s(s.$Labels.AutoAssignment_Deactivate_Button)+"\n                    ")]),s._v(" "),t("Button",{attrs:{variant:"neutral",disabled:!s.anyRulesSelected},on:{click:s.showDeleteModal}},[s._v("\n                        "+s._s(s.$Labels.AutoAssignment_Delete_Button)+"\n                    ")])],1)])],1),s._v(" "),t("div",{staticClass:"slds-grid slds-m-top_medium"},[t("div",[s._v("\n                "+s._s(s.$Labels.AutoAssignment_Number_Of_Rules)),t("strong",[s._v(" "+s._s(s.rules.length)+" ")]),s._v(" "),s.numRulesAvailable<=500?t("span",{staticClass:"slds-p-left_medium"},[s._v("\n                    "+s._s(s.$Labels.AutoAssignment_Number_Of_Rules_Available)+" "),t("strong",[s._v(" "+s._s(s.numRulesAvailable)+" ")])]):s._e()]),s._v(" "),t("div",{staticClass:"slds-col_bump-left"},[t("TextInput",{staticClass:"slds-input-has-icon slds-input-has-icon_left-right",attrs:{labels:{placeholder:s.$Labels.AutoAssignment_Search_Rules_Placeholder}},model:{value:s.searchTerm,callback:function(e){s.searchTerm=e},expression:"searchTerm"}},[t("template",{slot:"extend"},[t("Icon",{attrs:{category:"utility",name:"search",iconClass:["slds-input__icon","slds-input__icon_left"]}}),s._v(" "),t("ButtonIcon",{staticClass:"slds-button slds-button_icon slds-input__icon slds-input__icon_right",attrs:{iconCategory:"utility",iconName:"clear",assistiveText:s.$Labels.AutoAssignment_Clear_Button_Search,iconClass:["slds-button__icon","slds-icon-text-light"],title:s.$Labels.AutoAssignment_Clear_Button_Search},on:{click:s.resetSearch}})],1)],2)],1)])]),s._v(" "),t("div",{staticClass:"slds-is-relative slds-m-top_medium"},[t("table",{staticClass:"slds-table slds-table_bordered slds-table_fixed-layout",attrs:{"aria-multiselectable":"true",role:"grid"}},[t("thead",[t("tr",{staticClass:"slds-line-height_reset"},[t("th",{staticClass:"slds-text-align_left",staticStyle:{width:"3.25rem","padding-left":"0"},attrs:{scope:"col"}},[t("span",{staticClass:"slds-assistive-text",attrs:{id:s.chooseRowId}},[s._v(s._s(s.$Labels.AutoAssignment_Table_Choose_Row))]),s._v(" "),t("div",{staticClass:"slds-th__action slds-th__action_form"},[t("Checkbox",{staticClass:"flex-row slds-form-element",attrs:{ariaLabeledBy:s.chooseRowId,hideLabel:""},model:{value:s.toggleAllFlag,callback:function(e){s.toggleAllFlag=e},expression:"toggleAllFlag"}})],1)]),s._v(" "),t("th",{staticStyle:{width:"10rem"},attrs:{"aria-label":s.$Labels.AutoAssignment_Status_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Status_Column_Header}},[s._v(" "+s._s(s.$Labels.AutoAssignment_Status_Column_Header))])])]),s._v(" "),t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_Rule_Name_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Rule_Name_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Rule_Name_Column_Header))])])]),s._v(" "),t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_Shape_Layer_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Shape_Layer_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Shape_Layer_Column_Header))])])]),s._v(" "),t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_User_Column_Header,scope:"col"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_User_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_User_Column_Header))])])]),s._v(" "),t("th",{attrs:{"aria-label":s.$Labels.AutoAssignment_Table_Actions,scope:"col"}})])]),s._v(" "),t("tbody",s._l(s.displayedRows__displayedRows,(function(e){return t("tr",{key:e.guid,class:{dirty:e.dirty},attrs:{"aria-selected":e.selected}},[t("td",{staticClass:"slds-cell-edit slds-text-align_right",attrs:{role:"gridcell"}},[t("Checkbox",{staticClass:"flex-row slds-form-element",attrs:{ariaLabeledBy:s.chooseRowId,hideLabel:""},model:{value:e.selected,callback:function(t){s.$set(e,"selected",t)},expression:"rule.selected"}})],1),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{class:s.getStatusBadge(e.Active__c),attrs:{title:s.getStatusText(e.Active__c)}},[s._v(s._s(s.getStatusText(e.Active__c)))])])]),s._v(" "),t("th",{staticClass:"slds-cell-edit",attrs:{scope:"row",tabindex:"0"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("a",{staticClass:"slds-truncate",attrs:{tabindex:"-1",title:e.Name},on:{click:function(t){return s.renderEditRuleModal(e)}}},[s._v(s._s(e.Name))])])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.getLookupName(e.ShapeLayer__r)}},[s._v(s._s(s.getLookupName(e.ShapeLayer__r)))])])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.getLookupName(e.User__r)}},[s._v(s._s(s.getLookupName(e.User__r)))])])]),s._v(" "),t("td",{staticStyle:{"text-align":"center"},attrs:{role:"gridcell"}},[t("ButtonIcon",{attrs:{iconCategory:"utility",iconName:"delete",iconSize:"x-small",assistiveText:s.$Labels.AutoAssignment_Delete_Button,title:s.$Labels.AutoAssignment_Delete_Button},on:{click:function(t){return s.openDeleteRuleModalForSingleRule(e)}}})],1)])})),0)]),s._v(" "),s.rules.length?s._e():t("EmptyState",{attrs:{heading:s.emptyStateHeader,subHeading:s.emptyStateSubHeader}}),s._v(" "),s.renderRuleModal?t("RuleModal",{attrs:{mode:s.mode,rule:s.ruleForModal},on:{close:s.closeRule,"add-rule":s.addRule,"edit-rule":s.editRule}}):s._e(),s._v(" "),s.modalShow?t("Modal",{attrs:{title:s.modalTitle,size:"small"},on:{close:s.hideModal}},[t("div",{attrs:{slot:"content"},slot:"content"},[s._v(s._s(s.modalText))]),s._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("button",{staticClass:"slds-button slds-button_neutral",on:{click:s.hideModal}},[s._v("\n                    "+s._s(s.$Labels.AutoAssignment_Delete_Cancel_Modal_Button)+"\n                ")]),s._v(" "),t("button",{staticClass:"slds-button slds-button_brand",on:{click:s.confirmDelete}},[s._v("\n                    "+s._s(s.$Labels.AutoAssignment_Delete_Modal_Button)+"\n                ")])])]):s._e()],1)],1)}),[],!1,null,"54b89760",null).exports,F=(0,m.Z)({},(function(s,e){return(0,e._c)("div",{staticClass:"slds-size_1-of-1 slds-p-horizontal_medium slds-p-bottom_x-small"})}),[],!0,null,null,null).exports,E={name:"Plan",components:{Rules:M,Button:l.zx,Checkbox:l.XZ,ExpandableSection:l.Lm,Picklist:l.Gp,Spacer:F,Spinner:l.$j,TextInput:l.oi},mixins:[C],props:{planForEdit:{type:Object,default:()=>null}},data:()=>({plan:{Id:null,CustomAssignmentField__c:"",Description__c:"",ErrorField__c:"",LatField__c:"",LngField__c:"",ReassignOwner__c:!1,RuleLookupField__c:"",SObject__c:"",SObject_Name__c:"",SOQLFilter__c:"",Name:"",Active__c:!0},queryFilter:{error:"",isValid:!1,isDirty:!1},metadata:{assignmentFields:[],doubleFields:[],textFields:[]},callouts:0,reassignByField:!1,sobject:"",sobjects:[],rules:[]}),validations(){const s={plan:{Name:{required:A.C1},LatField__c:{required:A.C1,notSameLocationFields:(0,v.Z)((0,A.sH)((()=>this.plan.LngField__c)))},LngField__c:{required:A.C1,notSameLocationFields:(0,v.Z)((0,A.sH)((()=>this.plan.LatField__c)))},SOQLFilter__c:{mustBeTested:()=>this.queryFilter.isValid||!this.queryFilter.isDirty},ReassignOwner__c:{assignmentTypeRequired:()=>this.plan.ReassignOwner__c||this.reassignByField}},reassignByField:{assignmentTypeRequired:()=>this.plan.ReassignOwner__c||this.reassignByField},sobject:{required:A.C1}};return this.reassignByField&&(s.plan.CustomAssignmentField__c={required:A.C1}),s},computed:{notificationFields(){return[{id:"",title:this.$Labels.MA_None},...this.metadata.textFields]},disableTestFilterBtn(){return!this.plan.SObject__c||!this.plan.SOQLFilter__c},isLoading(){return this.callouts>0},filterErrors(){let s=this.getValidationMessages(this.$v.plan.SOQLFilter__c);return this.queryFilter.error&&(s=s.concat(this.queryFilter.error)),s},formattedFilterDescriptionLabel(){return(0,o.N4)(this.$Labels.AutoAssignment_Plan_Detail_Filter_Description_Example2,[this.plan.SObject__c])},planIdForEdit(){return this.plan.Id},showAssignmentTypeError(){const s=this.$v.plan.ReassignOwner__c.$dirty||this.$v.reassignByField.$dirty,e=!this.$v.plan.ReassignOwner__c.assignmentTypeRequired&&!this.$v.reassignByField.assignmentTypeRequired;return s&&e}},watch:{reassignByField(s){s||(this.plan.CustomAssignmentField__c="")},"plan.CustomAssignmentField__c":{handler(s){s&&(this.reassignByField=!0)}}},mounted(){this.$el.closest(".slds-card").style.paddingBottom="0px",this.init()},methods:{getValidationMessages:(0,b.ed)($),async init(){await this.loadSObjects(),this.$props.planForEdit&&this.initEdit()},async initEdit(){const s=this.sobjects.find((s=>s.obj===this.$props.planForEdit.SObject__c&&s.ruleField.toLowerCase()===this.$props.planForEdit.RuleLookupField__c.toLowerCase()));this.sobject=s.id,await this.onSObjectSelect(s),Object.keys(this.plan).forEach((s=>{Object.prototype.hasOwnProperty.call(this.$props.planForEdit,s)&&(this.plan[s]=this.$props.planForEdit[s])}))},async loadSObjects(){try{this.callouts++,this.sobjects=await this.$remote("maps.AutoAssignmentController.getSObjects")}catch(s){this.genericExceptionHandler(s)}finally{this.callouts--}},onQueryFilterChange(){this.queryFilter.error="",this.queryFilter.isValid=""===this.plan.SOQLFilter__c,this.queryFilter.isDirty=!this.queryFilter.isValid},async save(){if(this.$v.$touch(),this.$v.$invalid)this.$root.$emit("toast",{duration:3e3,message:this.$Labels.MA_Validation_Error,state:"error"});else if(this.queryFilter.isValid||!this.queryFilter.isDirty)try{this.callouts++;const{error:s,success:e}=await this.$remoting("AutoAssignmentController.commitAbstractPlan",[{plan:this.plan,rulesForUpsert:Array.from(this.$store.state.rules.mapForUpsert.values()),rulesForDelete:this.$store.state.rules.forDelete}]);if(e){const s=this.planForEdit?this.$Labels.AutoAssignment_EditPlan_Success:this.$Labels.AutoAssignment_New_Plan_Created;this.$root.$emit("toast",{message:s,state:"success",duration:3e3}),this.$emit("close-plan-detail")}else this.genericErrorHandler(s)}catch(s){this.genericExceptionHandler(s)}finally{this.callouts--}else this.$root.$emit("toast",{message:this.$Labels.AutoAssignment_Error_SOQL_Filter_Not_Tested,subMessage:this.$Labels.AutoAssignment_Error_SOQL_Filter_Not_Tested_SubMessage,state:"error"})},async onSObjectSelect(s){if(this.plan.SObject__c=s.obj,this.plan.SObject_Name__c=s.label,this.plan.RuleLookupField__c=s.ruleField,s.id)try{this.callouts++,this.metadata=await this.$remoting("AutoAssignmentController.getFieldInfoBySObjectName",[s.obj])}catch(s){this.genericExceptionHandler(s)}finally{this.callouts--}},async testFilter(){try{if(this.disableTestFilterBtn)return;this.queryFilter.error="",this.callouts++;const s=await this.$remoting("AutoAssignmentController.isQueryFilterValid",[this.plan.SObject__c,this.plan.SOQLFilter__c],{timeout:5e3});this.queryFilter.isValid=s.isValid,s.isValid||(this.queryFilter.error=`ERROR: ${s.error}`)}catch(s){this.genericExceptionHandler(s)}finally{this.callouts--}}}},D=(0,m.Z)(E,(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",[t("Spinner",{directives:[{name:"show",rawName:"v-show",value:s.isLoading,expression:"isLoading"}],attrs:{adjustForOverflow:""}}),s._v(" "),t("div",{staticClass:"slds-p-bottom_x-small slds-text-heading_small"},[s._v(s._s(s.$Labels.AutoAssignment_Assignment_Plan))]),s._v(" "),t("p",{staticClass:"slds-p-vertical_medium slds-m-left_medium"},[s._v("\n        "+s._s(s.$Labels.AutoAssignment_Plan_Detail_Description)+" "),t("a",{attrs:{href:"https://help.salesforce.com/articleView?id=sf.salesforce_maps_setup_autoassignment_configure.htm",target:"_blank"}},[s._v(s._s(s.$Labels.AutoAssignment_Tell_Me_More))])]),s._v(" "),t("ExpandableSection",{attrs:{title:s.$Labels.AutoAssignment_Plan_Details,disabled:""}},[t("div",{staticClass:"slds-p-left_small slds-p-right_small slds-p-top_xx-small"},[t("div",{staticClass:"slds-grid slds-wrap slds-p-top_small"},[t("div",{staticClass:"slds-p-right_medium",staticStyle:{width:"325px"}},[t("TextInput",{attrs:{labels:{name:s.$Labels.AutoAssignment_Plan_Name_Column_Header},errors:s.getValidationMessages(s.$v.plan.Name),required:""},model:{value:s.$v.plan.Name.$model,callback:function(e){s.$set(s.$v.plan.Name,"$model",e)},expression:"$v.plan.Name.$model"}})],1),s._v(" "),t("div",{staticClass:"slds-p-left_medium",staticStyle:{"margin-top":"28px",width:"325px"}},[t("Checkbox",{attrs:{labels:{name:s.$Labels.AutoAssignment_Active},showStateLabels:""},model:{value:s.plan.Active__c,callback:function(e){s.$set(s.plan,"Active__c",e)},expression:"plan.Active__c"}})],1),s._v(" "),t("Spacer"),s._v(" "),t("div",{staticClass:"slds-p-right_medium",staticStyle:{width:"325px"}},[t("TextInput",{attrs:{labels:{name:s.$Labels.AutoAssignment_Plan_Detail_Description_Label}},model:{value:s.plan.Description__c,callback:function(e){s.$set(s.plan,"Description__c",e)},expression:"plan.Description__c"}})],1),s._v(" "),t("div",{staticClass:"slds-p-left_medium",staticStyle:{width:"325px"}},[t("Picklist",{attrs:{options:s.sobjects,labels:{name:s.$Labels.AutoAssignment_Plan_Detail_Object},required:"",errors:s.getValidationMessages(s.$v.sobject)},on:{"selected-option":s.onSObjectSelect},model:{value:s.$v.sobject.$model,callback:function(e){s.$set(s.$v.sobject,"$model",e)},expression:"$v.sobject.$model"}})],1),s._v(" "),t("Spacer"),s._v(" "),t("div",{staticClass:"slds-p-right_medium",staticStyle:{width:"325px"}},[t("Picklist",{attrs:{labels:{name:s.$Labels.MA_Latitude},options:s.metadata.doubleFields,errors:s.getValidationMessages(s.$v.plan.LatField__c),required:""},model:{value:s.$v.plan.LatField__c.$model,callback:function(e){s.$set(s.$v.plan.LatField__c,"$model",e)},expression:"$v.plan.LatField__c.$model"}})],1),s._v(" "),t("div",{staticClass:"slds-p-left_medium",staticStyle:{width:"325px"}},[t("Picklist",{attrs:{labels:{name:s.$Labels.MA_Longitude},options:s.metadata.doubleFields,errors:s.getValidationMessages(s.$v.plan.LngField__c),required:""},model:{value:s.$v.plan.LngField__c.$model,callback:function(e){s.$set(s.$v.plan.LngField__c,"$model",e)},expression:"$v.plan.LngField__c.$model"}})],1)],1)])]),s._v(" "),t("ExpandableSection",{staticClass:"slds-p-top_large",attrs:{title:s.$Labels.AutoAssignment_Assignment_Options,disabled:""}},[t("div",{staticClass:"slds-p-left_small slds-p-right_small slds-p-top_xx-small"},[t("p",{staticClass:"slds-p-vertical_small"},[t("abbr",{staticClass:"slds-required",attrs:{title:s.$Labels.MA_Required}},[s._v("*")]),s._v(" "+s._s(s.$Labels.AutoAssignment_Plan_Detail_Reassignment_Description)+"\n            ")]),s._v(" "),t("Checkbox",{attrs:{labels:{name:s.$Labels.AutoAssignment_Assign_Record_Owner}},model:{value:s.$v.plan.ReassignOwner__c.$model,callback:function(e){s.$set(s.$v.plan.ReassignOwner__c,"$model",e)},expression:"$v.plan.ReassignOwner__c.$model"}}),s._v(" "),t("Checkbox",{attrs:{labels:{name:s.$Labels.AutoAssignment_Assign_User_Field}},model:{value:s.$v.reassignByField.$model,callback:function(e){s.$set(s.$v.reassignByField,"$model",e)},expression:"$v.reassignByField.$model"}}),s._v(" "),s.showAssignmentTypeError?t("div",{staticClass:"slds-has-error"},[t("div",{staticClass:"slds-form-element__help"},[s._v(s._s(s.$Labels.AutoAssignment_Assignment_Type_Must_Be_Selected))])]):s._e(),s._v(" "),t("div",{staticClass:"slds-grid slds-wrap slds-p-top_small"},[t("div",{staticClass:"slds-p-right_medium",staticStyle:{width:"325px"}},[s.reassignByField?t("Picklist",{attrs:{options:s.metadata.assignmentFields,labels:{name:s.$Labels.AutoAssignment_User_Field},errors:s.getValidationMessages(s.$v.plan.CustomAssignmentField__c),required:""},model:{value:s.$v.plan.CustomAssignmentField__c.$model,callback:function(e){s.$set(s.$v.plan.CustomAssignmentField__c,"$model",e)},expression:"$v.plan.CustomAssignmentField__c.$model"}}):s._e()],1)]),s._v(" "),t("p",{staticClass:"slds-m-top_large"},[t("strong",[s._v(s._s(s.$Labels.AutoAssignment_Plan_Detail_Filter_Description))])]),s._v(" "),t("p",{staticClass:"slds-m-top_x-small"},[s._v("\n                "+s._s(s.$Labels.AutoAssignment_Plan_Detail_Filter_Description_Example1)),t("br"),s._v(s._s(s.formattedFilterDescriptionLabel)+" "),t("a",{attrs:{href:"https://help.salesforce.com/articleView?id=sf.salesforce_maps_setup_autoassignment_plan.htm",target:"_blank"}},[s._v(s._s(s.$Labels.AutoAssignment_Tell_Me_More))])]),s._v(" "),t("div",{staticClass:"slds-grid slds-wrap slds-p-top_small"},[t("div",{staticClass:"slds-p-right_medium",staticStyle:{width:"325px"}},[t("TextInput",{attrs:{labels:{name:s.$Labels.AutoAssignment_SOQL_Statements,placeholder:s.$Labels.AutoAssignment_SOQL_Statements_Placeholder},errors:s.filterErrors,helpText:s.$Labels.AutoAssignment_SOQL_Statements_Help_Text,useTextArea:""},on:{changed:s.onQueryFilterChange},model:{value:s.$v.plan.SOQLFilter__c.$model,callback:function(e){s.$set(s.$v.plan.SOQLFilter__c,"$model",e)},expression:"$v.plan.SOQLFilter__c.$model"}})],1),s._v(" "),t("div",{staticClass:"slds-p-left_small slds-p-right_small",staticStyle:{"margin-top":"24px"}},[t("Button",{attrs:{variant:"neutral",disabled:s.disableTestFilterBtn},on:{click:s.testFilter}},[s._v("\n                        "+s._s(s.$Labels.AutoAssignment_Test_Filter)+"\n                    ")]),s._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:s.queryFilter.isValid&&s.queryFilter.isDirty,expression:"queryFilter.isValid && queryFilter.isDirty"}],staticClass:"slds-icon slds-icon_large ma-icon ma-icon-check slds-m-left_medium",staticStyle:{color:"green"}})],1)]),s._v(" "),t("Spacer"),s._v(" "),t("p",{staticClass:"slds-p-top_small"},[t("strong",[s._v(s._s(s.$Labels.AutoAssignment_Assignment_Notices))])]),s._v(" "),t("p",[s._v(s._s(s.$Labels.AutoAssignment_Assignment_Notices_Description))]),s._v(" "),t("div",{staticClass:"slds-grid slds-wrap slds-p-top_small"},[t("div",{staticClass:"slds-p-right_medium",staticStyle:{width:"325px"}},[t("Picklist",{attrs:{labels:{name:s.$Labels.AutoAssignment_Notification_Field},options:s.notificationFields},model:{value:s.plan.ErrorField__c,callback:function(e){s.$set(s.plan,"ErrorField__c",e)},expression:"plan.ErrorField__c"}})],1)])],1)]),s._v(" "),t("Rules",{attrs:{planId:s.planIdForEdit}}),s._v(" "),t("div",{ref:"actionButtonGroup",staticClass:"slds-p-around_small action-button-group"},[t("div",{staticClass:"slds-col_bump-left"},[t("Button",{attrs:{variant:"neutral"},on:{click:function(e){return s.$emit("close-plan-detail")}}},[s._v("\n                "+s._s(s.$Labels.MA_Cancel)+"\n            ")]),s._v(" "),t("Button",{attrs:{variant:"brand"},on:{click:s.save}},[s._v("\n                "+s._s(s.$Labels.MA_Save)+"\n            ")])],1)])],1)}),[],!1,null,"5aaa5e80",null).exports;var I=t(257);const{Labels:B}=window.MASystem;class k{static handleRemoteActionError(s){Error(`Remote action exception: ${s}`)}static getBatchDetails(s){try{return(0,o.wX)("AutoAssignmentController.getBatchDetails",[s])}catch(s){throw new Error({status:"error",message:"error loading plans"})}}static getBaseObjectFields(s){return new Promise(((e,t)=>{(new I.Z).setAction("maps.AutoAssignmentController.getFieldInfoBySObjectName").setErrorHandler(this.handleRemoteActionError.bind(this,t)).invoke([s],(s=>{s?e(s):t(new Error({status:"error",message:"error loading settings"}))}),{buffer:!1})}))}static async getPlans(){try{const{success:s,plans:e}=await(0,o.wX)("AutoAssignmentController.getPlans");return s||this.throwGenericToastMessage(B.Error,"placeholder error for labels"),e}catch(s){return this.throwGenericToastMessage(B.Error,"placeholder error for labels"),{}}}static async getPlanSummaries(){try{const{success:s,error:e,data:t}=await(0,o.wX)("AutoAssignmentController.getPlanSummaries");return s?t:(this.throwGenericToastMessage(B.Error,e.message),[])}catch(s){return this.throwGenericToastMessage(B.Error,s),[]}}static async executePlans(s){try{const{error:e}=await(0,o.wX)("AutoAssignmentController.checkSelectedPlansStatus",[s]),{success:t,error:l}=await(0,o.wX)("AutoAssignmentController.runSelectedPlans",[s]);return l?{success:"false",errorMessage:l.message}:e&&t?{success:!0,errorMessage:e.message}:{success:!0,errorMessage:null}}catch(s){return this.throwGenericToastMessage(B.Error,s),{}}}static async switchActiveFlagForPlans(s){try{const{success:e,message:t}=await(0,o.wX)("AutoAssignmentController.switchActiveFlagForPlans",[s.planIds,s.activateFlag]);return e||this.throwGenericToastMessage(B.Error,t),e}catch(s){return this.throwGenericToastMessage(B.Error,s),{}}}static async deletePlans(s){try{const{success:e,message:t}=await(0,o.wX)("AutoAssignmentController.deletePlans",[s]);return e||this.throwGenericToastMessage(B.Error,t),e}catch(s){return this.throwGenericToastMessage(B.Error,s),{}}}static throwGenericToastMessage(s,e){const{MAToastMessages:t}=window;t.showError({message:s,subMessage:e,timeOut:0,extendedTimeOut:0,closeButton:!0})}}const O={components:{Checkbox:l.XZ,Spinner:l.$j,ActionMenuItem:l.F9,EmptyState:h,ActionMenu:l.PC},data:()=>({isLoading:!1,toggleAllFlag:!1,doToggleAll:!0}),computed:{plans(){return this.getAssignmentPlans()},emptyStateSubHearder(){return this.getIsSearchingPlans()?"":this.$Labels.AutoAssignment_Plans_Table_Empty_State_Subheader},emptyStateHearder(){return this.getIsSearchingPlans()?"":this.$Labels.AutoAssignment_Plans_Table_Empty_State_Header}},watch:{plans:{handler(s){const e=s.filter((s=>s.isSelected));this.updateSelectedPlans(e),!this.toggleAllFlag||s.length===e.length&&0!==e.length||(this.doToggleAll=!1,this.toggleAllFlag=!1)},deep:!0},toggleAllFlag(s){this.doToggleAll?this.toggleAll(s):this.$nextTick((()=>{this.doToggleAll=!0}))}},async created(){try{this.isLoading=!0,await this.fetchAssigmentPlans()}catch(s){console.error(s)}finally{this.isLoading=!1}},methods:{toggleAll(s){this.plans.forEach((e=>{e.isSelected=s}))},statusBadge:s=>"Active"===s?"slds-badge slds-theme_success":"slds-badge",async executePlan(s,e,t){let l;try{this.isLoading=!0;const a=[s];if(!t)throw l=`${this.$Labels.AutoAssignment_RunPlan_Error_SinglePlan} ${e} ${this.$Labels.AutoAssignment_RunPlans_NoRules_SinglePlan}`,new Error(l);const{success:i,errorMessage:n}=await k.executePlans(a);if(!i&&n)throw new Error(n);i&&n&&this.$root.$emit("toast",{message:this.$Labels.AutoAssignment_RunPlan_Warning_SinglePlan,state:"warning",closeLabel:this.$Labels.MA_Close}),i&&!n&&this.$root.$emit("toast",{message:`${this.$Labels.AutoAssignment_RunPlan_Success_SinglePlan} ${e}`,state:"success",closeLabel:this.$Labels.MA_Close,position:"top-center",duration:4e3})}catch(s){this.$root.$emit("toast",{message:s.message,state:l?"warning":"error",closeLabel:this.$Labels.MA_Close})}finally{this.isLoading=!1}},async activatePlan(...s){try{this.isLoading=!0,await this.activateAssigmentPlans(s)&&this.$root.$emit("toast",{message:`${this.$Labels.AutoAssignment_Single_Plan_Activated}`,state:"success",closeLabel:this.$Labels.MA_Close,duration:4e3})}catch(s){console.error(s)}finally{this.isLoading=!1}},async deactivatePlan(...s){try{this.isLoading=!0,await this.deactivateAssigmentPlans(s)&&this.$root.$emit("toast",{message:`${this.$Labels.AutoAssignment_Single_Plan_Deactivated}`,state:"success",closeLabel:this.$Labels.MA_Close,position:"top-center",duration:4e3})}catch(s){console.error(s)}finally{this.isLoading=!1}},async deletePlan(s,e){this.$emit("deleteSingleRowPlan",{planId:s,planName:e})},...(0,d.mapMutations)(["updateAssignmentPlans","updateSelectedPlans"]),...(0,d.mapActions)(["fetchAssigmentPlans","activateAssigmentPlans","deactivateAssigmentPlans"]),...(0,d.mapGetters)(["getAssignmentPlans","getHasAnyPlanSelected","getIsSearchingPlans"])}},N={components:{PlanTable:(0,m.Z)(O,(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",[s.isLoading?t("Spinner"):s._e(),s._v(" "),t("div",{staticClass:"slds-table_edit_container slds-is-relative"},[t("table",{staticClass:"slds-table slds-no-cell-focus slds-table_bordered slds-table_resizable-cols",attrs:{"aria-multiselectable":"true",role:"grid"}},[t("thead",[t("tr",{staticClass:"slds-line-height_reset"},[t("th",{staticClass:"slds-text-align_left",attrs:{scope:"col"}},[t("span",{staticClass:"slds-assistive-text",attrs:{id:"column-group-header"}},[s._v(s._s(s.$Labels.AutoAssignment_Table_Choose_Row))]),s._v(" "),t("div",{staticClass:"slds-th__action slds-th__action_form"},[t("Checkbox",{staticClass:"flex-row slds-form-element",attrs:{hideLabel:""},model:{value:s.toggleAllFlag,callback:function(e){s.toggleAllFlag=e},expression:"toggleAllFlag"}})],1)]),s._v(" "),t("th",{staticClass:"slds-is-resizable slds-is-sortable",attrs:{"aria-label":s.$Labels.AutoAssignment_Status_Column_Header,"aria-sort":"none",scope:"col"}},[t("a",{staticClass:"slds-th__action slds-text-link_reset",attrs:{href:"#",role:"button",tabindex:"-1"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Status_Column_Header}},[s._v(" "+s._s(s.$Labels.AutoAssignment_Status_Column_Header))])])])]),s._v(" "),t("th",{staticClass:"slds-is-resizable slds-is-sortable",attrs:{"aria-label":s.$Labels.AutoAssignment_Plan_Name_Column_Header,"aria-sort":"none",scope:"col"}},[t("a",{staticClass:"slds-th__action slds-text-link_reset",attrs:{href:"#",role:"button",tabindex:"-1"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Plan_Name_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Plan_Name_Column_Header))])])])]),s._v(" "),t("th",{staticClass:"slds-is-resizable slds-is-sortable",attrs:{"aria-label":s.$Labels.AutoAssignment_Object_Column_Header,"aria-sort":"none",scope:"col"}},[t("a",{staticClass:"slds-th__action slds-text-link_reset",attrs:{href:"#",role:"button",tabindex:"-1"}},[t("span",{staticClass:"slds-assistive-text"},[s._v("Sort by: ")]),s._v(" "),t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Object_Column_Header}},[s._v(" "+s._s(s.$Labels.AutoAssignment_Object_Column_Header)+" ")])])])]),s._v(" "),t("th",{staticClass:"slds-is-resizable slds-is-sortable",attrs:{"aria-label":s.$Labels.AutoAssignment_Plan_Description_Column_Header,"aria-sort":"none",scope:"col"}},[t("a",{staticClass:"slds-th__action slds-text-link_reset",attrs:{href:"#",role:"button",tabindex:"-1"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Plan_Description_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Plan_Description_Column_Header))])])])]),s._v(" "),t("th",{staticClass:"slds-is-resizable slds-is-sortable",attrs:{"aria-label":s.$Labels.AutoAssignment_Number_Of_Rules_Column_Header,"aria-sort":"none",scope:"col"}},[t("a",{staticClass:"slds-th__action slds-text-link_reset",attrs:{href:"#",role:"button",tabindex:"-1"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Number_Of_Rules_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Number_Of_Rules_Column_Header))])])])]),s._v(" "),t("th",{staticClass:"slds-is-resizable slds-is-sortable",attrs:{"aria-label":s.$Labels.AutoAssignment_Date_Created_Column_Header,"aria-sort":"none",scope:"col"}},[t("a",{staticClass:"slds-th__action slds-text-link_reset",attrs:{href:"#",role:"button",tabindex:"-1"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Date_Created_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Date_Created_Column_Header))])])])]),s._v(" "),t("th",{staticClass:"slds-is-resizable slds-is-sortable",attrs:{"aria-label":s.$Labels.AutoAssignment_Last_Run_Column_Header,"aria-sort":"none",scope:"col"}},[t("a",{staticClass:"slds-th__action slds-text-link_reset",attrs:{href:"#",role:"button",tabindex:"-1"}},[t("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate"},[t("span",{staticClass:"slds-truncate",attrs:{title:s.$Labels.AutoAssignment_Last_Run_Column_Header}},[s._v(s._s(s.$Labels.AutoAssignment_Last_Run_Column_Header))])])])]),s._v(" "),t("th",{attrs:{scope:"col"}},[t("div",{staticClass:"slds-truncate slds-assistive-text",attrs:{title:s.$Labels.AutoAssignment_Table_Actions}},[s._v("\n                            "+s._s(s.$Labels.AutoAssignment_Table_Actions)+"\n                        ")])])])]),s._v(" "),t("tbody",s._l(s.plans,(function(e){return t("tr",{key:e.Id,staticClass:"slds-hint-parent",attrs:{"aria-selected":e.isSelected}},[t("td",{staticClass:"slds-cell-edit slds-text-align_right",attrs:{role:"gridcell"}},[t("Checkbox",{staticClass:"flex-row slds-form-element",attrs:{hideLabel:""},model:{value:e.isSelected,callback:function(t){s.$set(e,"isSelected",t)},expression:"plan.isSelected"}})],1),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{class:s.statusBadge(e.status),attrs:{title:e.status}},[s._v(s._s(e.status))])])]),s._v(" "),t("th",{staticClass:"slds-cell-edit",attrs:{scope:"row",tabindex:"0"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("a",{staticClass:"slds-truncate",attrs:{id:"link-01",href:"#",tabindex:"-1",title:e.planName},on:{click:function(t){return s.$bus.$emit("edit-assignment-plan",e.record)}}},[s._v(s._s(e.planName))])])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:s._f("decode")(e.objectName)}},[s._v(s._s(s._f("decode")(e.objectName)))]),s._v(" "),t("button",{staticClass:"slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small",attrs:{tabindex:"-1",title:s._f("decode")(e.objectName)}})])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:e.planDescription}},[s._v(s._s(e.planDescription))]),s._v(" "),t("button",{staticClass:"slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small",attrs:{tabindex:"-1",title:e.planDescription}})])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{"aria-readonly":"true",role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:e.numberOfRules}},[s._v(s._s(e.numberOfRules))]),s._v(" "),t("button",{staticClass:"slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small",attrs:{disabled:"",tabindex:"-1",title:"Edit Confidence of Acme - 1,200 Widgets"}})])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:e.createdDate}},[s._v(s._s(e.createdDate))]),s._v(" "),t("button",{staticClass:"slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small",attrs:{tabindex:"-1",title:"Edit Amount of Acme - 1,200 Widgets"}})])]),s._v(" "),t("td",{staticClass:"slds-cell-edit",attrs:{role:"gridcell"}},[t("span",{staticClass:"slds-grid slds-grid_align-spread"},[t("span",{staticClass:"slds-truncate",attrs:{title:e.lastRunDate}},[s._v(s._s(e.lastRunDate))]),s._v(" "),t("button",{staticClass:"slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small",attrs:{tabindex:"-1",title:e.lastRunDate}})])]),s._v(" "),t("td",{attrs:{role:"gridcell"}},[t("ActionMenu",{attrs:{showMoreLabel:s.$Labels.MA_SHOW_MORE}},[t("button",{staticClass:"slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-x-small",attrs:{slot:"button"},slot:"button"},[t("span",{staticClass:"slds-button__icon ma-icon ma-icon-down"})]),s._v(" "),t("ActionMenuItem",{attrs:{label:s.$Labels.AutoAssignment_Execute_Plan_Action_Item},on:{click:function(t){return s.executePlan(e.id,e.planName,e.hasActiveRules)}}}),s._v(" "),t("ActionMenuItem",{attrs:{label:s.$Labels.AutoAssignment_Activate_Action_Item},on:{click:function(t){return s.activatePlan(e.id)}}}),s._v(" "),t("ActionMenuItem",{attrs:{label:s.$Labels.AutoAssignment_Deactivate_Action_Item},on:{click:function(t){return s.deactivatePlan(e.id)}}}),s._v(" "),t("ActionMenuItem",{attrs:{label:s.$Labels.AutoAssignment_Delete_Action_Item},on:{click:function(t){return s.deletePlan(e.id,e.planName)}}})],1)],1)])})),0)]),s._v(" "),s.plans.length?s._e():t("EmptyState",{attrs:{heading:s.emptyStateHearder,subHeading:s.emptyStateSubHearder}})],1)],1)}),[],!1,null,null,null).exports,Button:l.zx,ButtonIcon:l.Ei,Icon:l.JO,Modal:l.u_,Spinner:l.$j,TextInput:l.oi},data:()=>({isLoading:!1,modalShow:!1,isSingleRowDelete:!1,singleRowDeleteOptions:null,searchTerm:""}),computed:{numberOfPlans(){return this.getCopyOfOriginalPlans().length>=40},anyPlansSelected(){return this.getSelectedPlans().length>0},modalText(){return this.isSingleRowDelete?(0,o.N4)(this.$Labels.AutoAssignment_Delete_Single_Assignment_Plan_Modal_Text,[this.singleRowDeleteOptions.planName]):this.getSelectedPlans().length>1?(0,o.N4)(this.$Labels.AutoAssignment_Delete_Assignment_Plans_Modal_Text,[this.getSelectedPlans().length]):(0,o.N4)(this.$Labels.AutoAssignment_Delete_Single_Assignment_Plan_Modal_Text,[this.getSelectedPlans()[0].planName])}},watch:{searchTerm(){(this.searchTerm.length>=3||0===this.searchTerm.length)&&this.debouncedGetAssignmentsBySearchTerm()}},methods:{async activateSelectedPlans(){try{this.isLoading=!0;const s=this.getSelectedPlans().map((s=>s.id));await this.activateAssigmentPlans(s)&&this.$root.$emit("toast",{message:1===s.length?`${this.$Labels.AutoAssignment_Single_Plan_Activated}`:`${this.$Labels.AutoAssignment_Plans_Activated}`,state:"success",closeLabel:this.$Labels.MA_Close,position:"top-center",duration:4e3})}catch(s){console.error(s)}finally{this.isLoading=!1}},checkQuantity(){this.getAssignmentPlans().length>=50?this.$root.$emit("toast",{message:this.$Labels.AutoAssignment_Plan_Limit_Message,subMessage:this.$Labels.AutoAssignment_Plan_Limit_SubMessage,state:"error"}):this.$emit("create-plan")},async deactivateSelectedPlans(){try{this.isLoading=!0;const s=this.getSelectedPlans().map((s=>s.id));await this.deactivateAssigmentPlans(s)&&this.$root.$emit("toast",{message:1===s.length?`${this.$Labels.AutoAssignment_Single_Plan_Deactivated}`:`${this.$Labels.AutoAssignment_Plans_Deactivated}`,state:"success",closeLabel:this.$Labels.MA_Close,position:"top-center",duration:4e3})}catch(s){console.error(s)}finally{this.isLoading=!1}},async deleteSelectedPlans(){try{this.isLoading=!0;const s=this.getSelectedPlans().map((s=>s.id));this.showDeleteModal(),await this.deleteAssigmentPlans(s)&&this.$root.$emit("toast",{message:1===s.length?`${this.$Labels.AutoAssignment_Single_Plan_Deleted}`:`${this.$Labels.AutoAssignment_Plans_Deleted}`,state:"success",closeLabel:this.$Labels.MA_Close,position:"top-center",duration:4e3})}catch(s){console.error(s)}finally{this.isLoading=!1}},async runSelectedPlans(){const s=this.getSelectedPlans();let e;const t={planIds:[],planNames:[]},l={planIds:[],planNames:[]};s.forEach((s=>{s.hasActiveRules?(t.planIds.push(s.id),t.planNames.push(s.planName)):(l.planIds.push(s.id),l.planNames.push(s.planName))}));const a=l.planIds.length;a&&(e=1===a?`${this.$Labels.AutoAssignment_RunPlan_Error_SinglePlan} ${l.planNames[0]} ${this.$Labels.AutoAssignment_RunPlans_NoRules_SinglePlan}`:`${this.$Labels.AutoAssignment_RunPlans_Error_Plural} ${l.planNames.join(", ")} ${this.$Labels.AutoAssignment_RunPlans_NoRules_Plural}`);try{if(this.isLoading=!0,!t.planIds.length)throw new Error(e);const{success:a,errorMessage:i}=await k.executePlans(t.planIds);if(!a&&i)throw new Error(i);if(a&&i)this.$root.$emit("toast",{message:i,state:"warning",closeLabel:this.$Labels.MA_Close});else if(a&&!i){let s=this.$Labels.AutoAssignment_RunPlans_Success_Plural;1===t.planIds.length&&null!=t.planNames[0]&&(s=`${this.$Labels.AutoAssignment_RunPlan_Success_SinglePlan} ${t.planNames[0]}`),this.$root.$emit("toast",{message:s,state:"success",closeLabel:this.$Labels.MA_Close,position:"top-center",duration:4e3})}if(l.planIds.length)throw new Error(e)}catch(s){this.$root.$emit("toast",{message:s.message,state:e?"warning":"error",closeLabel:this.$Labels.MA_Close})}finally{s.forEach((s=>(s.isSelected=!1,s))),this.isLoading=!1}},openModalForSingleRowDelete(s){this.isSingleRowDelete=!0,this.singleRowDeleteOptions=s,this.showDeleteModal()},hideModal(){this.singleRowDeleteOptions=null,this.isSingleRowDelete=!1,this.modalShow=!1},showDeleteModal(){this.modalShow=!0},async confirmDelete(){if(this.isSingleRowDelete)try{this.isLoading=!0,await this.deleteAssigmentPlans([this.singleRowDeleteOptions.planId])&&this.$root.$emit("toast",{message:`${this.$Labels.AutoAssignment_Single_Plan_Deleted}`,state:"success",closeLabel:this.$Labels.MA_Close,position:"top-center",duration:4e3})}catch(s){console.error(s)}finally{this.isLoading=!1}else this.deleteSelectedPlans();this.hideModal()},debouncedGetAssignmentsBySearchTerm:i()((async function(){const s=this.getCopyOfOriginalPlans().filter((s=>(s.isSelected=!1,s.planName.toLowerCase().includes(this.searchTerm.toLowerCase()))));this.updateAssignmentPlans(s),this.updateIsSearchingPlans(0!==this.searchTerm.length)}),500),resetSearch(){this.searchTerm=""},...(0,d.mapActions)(["activateAssigmentPlans","deactivateAssigmentPlans","deleteAssigmentPlans","fetchAssignmentPlans"]),...(0,d.mapMutations)(["updateAssignmentPlans","updateSelectedPlans","updateIsSearchingPlans"]),...(0,d.mapGetters)(["getAssignmentPlans","getSelectedPlans","getCopyOfOriginalPlans"])}},H=(0,m.Z)(N,(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"slds-is-relative"},[s.isLoading?t("Spinner"):s._e(),s._v(" "),t("div",{staticClass:"slds-grid slds-p-horizontal_small slds-m-bottom_small"},[t("Button",{attrs:{variant:"neutral",title:s.$Labels.AutoAssignment_Create_New_Plan_Button},on:{click:s.checkQuantity}},[s._v("\n            "+s._s(s.$Labels.AutoAssignment_Create_New_Plan_Button)+"\n        ")]),s._v(" "),t("div",{staticClass:"slds-col_bump-left"},[t("div",{staticClass:"slds-button-group",attrs:{role:"group"}},[t("Button",{attrs:{variant:"neutral",disabled:!s.anyPlansSelected,title:s.$Labels.AutoAssignment_Execute_Plan_Button},on:{click:s.runSelectedPlans}},[s._v("\n                    "+s._s(s.$Labels.AutoAssignment_Execute_Plan_Button)+"\n                ")]),s._v(" "),t("Button",{attrs:{variant:"neutral",disabled:!s.anyPlansSelected,title:s.$Labels.AutoAssignment_Activate_Button},on:{click:s.activateSelectedPlans}},[s._v("\n                    "+s._s(s.$Labels.AutoAssignment_Activate_Button)+"\n                ")]),s._v(" "),t("Button",{attrs:{variant:"neutral",disabled:!s.anyPlansSelected,title:s.$Labels.AutoAssignment_Deactivate_Button},on:{click:s.deactivateSelectedPlans}},[s._v("\n                    "+s._s(s.$Labels.AutoAssignment_Deactivate_Button)+"\n                ")]),s._v(" "),t("Button",{attrs:{variant:"neutral",disabled:!s.anyPlansSelected,title:s.$Labels.AutoAssignment_Delete_Button},on:{click:s.showDeleteModal}},[s._v("\n                    "+s._s(s.$Labels.AutoAssignment_Delete_Button)+"\n                ")])],1)])],1),s._v(" "),t("div",{staticClass:"slds-grid slds-p-horizontal_small slds-m-bottom_small"},[t("div",[s._v("\n            "+s._s(s.$Labels.AutoAssignment_Number_Of_Plans)+" "),t("strong",[s._v(" "+s._s(s.getAssignmentPlans().length)+" ")]),s._v(" "),s.numberOfPlans?t("span",[s._v(" - "+s._s(s.$Labels.AutoAssignment_Number_Of_Plans_Available))]):s._e(),s._v(" "),s.numberOfPlans?t("strong",[s._v(" "+s._s(50-s.getCopyOfOriginalPlans().length)+" ")]):s._e()]),s._v(" "),t("div",{staticClass:"slds-col_bump-left"},[t("div",{staticClass:"slds-col"},[t("TextInput",{staticClass:"slds-input-has-icon slds-input-has-icon_left-right",attrs:{labels:{placeholder:s.$Labels.AutoAssignment_Scheduled_Plans_Search_Plans_Placeholder_Text}},model:{value:s.searchTerm,callback:function(e){s.searchTerm=e},expression:"searchTerm"}},[t("template",{slot:"extend"},[t("Icon",{attrs:{category:"utility",name:"search",iconClass:["slds-input__icon","slds-input__icon_left"]}}),s._v(" "),t("ButtonIcon",{staticClass:"slds-button slds-button_icon slds-input__icon slds-input__icon_right",attrs:{iconCategory:"utility",iconName:"clear",assistiveText:s.$Labels.AutoAssignment_Clear_Button_Search,iconClass:["slds-button__icon","slds-icon-text-light"],title:s.$Labels.AutoAssignment_Clear_Button_Search},on:{click:s.resetSearch}})],1)],2)],1)])]),s._v(" "),t("PlanTable",{on:{deleteSingleRowPlan:s.openModalForSingleRowDelete}}),s._v(" "),s.modalShow?t("Modal",{attrs:{title:s.$Labels.AutoAssignment_Delete_Assignment_Plans_Modal_Header,size:"small"},on:{close:s.hideModal}},[t("div",{attrs:{slot:"content"},slot:"content"},[s._v(s._s(s.modalText))]),s._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{variant:"neutral",title:s.$Labels.AutoAssignment_Delete_Cancel_Modal_Button},on:{click:s.hideModal}},[s._v("\n                "+s._s(s.$Labels.AutoAssignment_Delete_Cancel_Modal_Button)+"\n            ")]),s._v(" "),t("Button",{attrs:{variant:"brand",title:s.$Labels.AutoAssignment_Delete_Modal_Button},on:{click:s.confirmDelete}},[s._v("\n                "+s._s(s.$Labels.AutoAssignment_Delete_Modal_Button)+"\n            ")])],1)]):s._e()],1)}),[],!1,null,null,null).exports;var j=t(2934),q=t.n(j),U=t(9048);q().use(c());const z=new(c().Store)({state:{assignmentPlans:[],isSearchingPlans:!1,selectedPlans:[],selectedRules:[],copyOfOriginalPlans:[],rules:{mapForUpsert:new Map,forDelete:[]}},getters:{getAssignmentPlans:s=>s.assignmentPlans||[],getSelectedPlans:s=>s.selectedPlans||[],getCopyOfOriginalPlans:s=>s.copyOfOriginalPlans||[],getIsSearchingPlans:s=>s.isSearchingPlans||!1},mutations:{updateAssignmentPlans(s,e){s.assignmentPlans=e},updateCopyOfOriginalPlans(s,e){s.copyOfOriginalPlans=e},updateSelectedPlans(s,e){s.selectedPlans=e},updateSelectedRules(s,e){s.selectedRules=e},updateIsSearchingPlans(s,e){s.isSearchingPlans=e}},actions:{resetRules({state:s}){s.rules.forDelete=[],s.rules.mapForUpsert=new Map},addRuleForUpsert({state:s},e){const t=e.id?e.id:e.guid;delete e.guid,s.rules.mapForUpsert.set(t,e)},checkAndRemoveRuleforUpsert({state:s},e){s.rules.mapForUpsert.delete(e)},addRuleForDelete({state:s},e){s.rules.forDelete.push(e)},async fetchAssigmentPlans({commit:s}){try{const e=await k.getPlanSummaries();if(e){(0,U.a)(e,"maps__").forEach((s=>{s.isSelected=!1}));const t=r()(e);s("updateAssignmentPlans",e),s("updateCopyOfOriginalPlans",t)}}catch(s){console.error(s)}},async activateAssigmentPlans({dispatch:s},e){const t={activateFlag:!0,planIds:e};try{const e=await k.switchActiveFlagForPlans(t);if(e)return await s("fetchAssigmentPlans"),e}catch(s){console.error(s)}return!1},async deactivateAssigmentPlans({dispatch:s},e){const t={activateFlag:!1,planIds:e};try{const e=await k.switchActiveFlagForPlans(t);if(e)return await s("fetchAssigmentPlans"),e}catch(s){console.error(s)}return!1},async deleteAssigmentPlans({dispatch:s},e){try{const t=await k.deletePlans(e);return t&&await s("fetchAssigmentPlans"),t}catch(s){console.error(s)}return!1}}}),J={name:"AutoAssignmentRoot",components:{AssignmentPlans:H,ScheduledPlans:p,PlanDetail:D,Spinner:l.$j,Tabs:l.mQ,Tab:l.OK},data:()=>({isLoading:!1,showPlanDetail:!1,planForEdit:null,tabIds:["assignmentPlansTab","scheduledPlansTab"]}),beforeCreate(){this.$store=z},async created(){this.$bus.$on("edit-assignment-plan",this.editPlan)},destroyed(){this.$bus.$off("edit-assignment-plan")},methods:{toggleScrollListener(s){const[e,t]=this.tabIds,l=this.$refs[t]&&!this.$refs[t].displayedRows__maxRowsDisplayed;e===s&&l?this.$refs[t].displayedRows__removeScrollEventListener():t===s&&l&&this.$refs[t].displayedRows__addScrollEventListener()},closePlanDetail(){this.showPlanDetail=!1,this.planForEdit=null,window.scrollTo(0,0)},editPlan(s){if(!s)throw new Error("Plan Id must be provided in order to edit a plan.");this.planForEdit=s,this.showPlanDetail=!0}}},V=(0,m.Z)(J,(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",[s.isLoading?t("Spinner"):s._e(),s._v(" "),s.showPlanDetail?t("PlanDetail",{attrs:{planForEdit:s.planForEdit},on:{"close-plan-detail":s.closePlanDetail}}):[t("Tabs",{on:{changed:s.toggleScrollListener}},[t("Tab",{attrs:{id:s.tabIds[0],title:s.$Labels.AutoAssignment_Assignment_Plans_Tab}},[t("AssignmentPlans",{on:{"create-plan":function(e){s.showPlanDetail=!0}}})],1),s._v(" "),t("Tab",{attrs:{id:s.tabIds[1],title:s.$Labels.AutoAssignment_Scheduled_Plans_Tab}},[t("ScheduledPlans",{ref:s.tabIds[1]})],1)],1)]],2)}),[],!1,null,null,null).exports}}]);