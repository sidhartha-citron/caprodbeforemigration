"use strict";(globalThis.webpackChunkmaps_desktop=globalThis.webpackChunkmaps_desktop||[]).push([[3675],{9048:(e,t,s)=>{s.d(t,{_:()=>r,a:()=>a});const r=(e,t)=>{if(e&&"object"==typeof e&&Array.isArray(t)){for(;t.length&&e;)e=e[t.shift()];return e}},a=(e,t="maps__")=>{try{const s=new Set(["marker","scatterMarker","clusterMarker","clusterGroup","workers","DeviceHistory","orderedPolyline","distanceLimitCircle","heatmapLayer"]);Object.entries(e).forEach((([r,l])=>{if(!s.has(r))if(r.startsWith(t)){const s=r.replace(t,"");e[s]=l,delete e[r],null!=e[s]&&"object"==typeof e[s]&&a(e[s],t)}else"object"==typeof l&&a(l,t)}))}catch(e){}return e}},9575:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var r=s(3088),a=s(2766),l=s(257),o=s(9048);const i={props:{record:{type:Object,required:!0},objectNames:{type:Object,required:!0},layerNames:{type:Object,required:!0}},data:()=>({Labels:window.MASystem.Labels}),computed:{objectName(){return this.objectNames[this.record.ObjectName__c]},layerName(){return this.layerNames[this.record.LayerID__c]}},methods:{resetSync(){this.$emit("reset-sync",this.record.Id)},testSync(){this.$emit("test-sync",this.record.Id)},editRecord(){this.$emit("edit-record",{...this.record})},deleteRecord(){this.$emit("delete-record",this.record.Id)}}};var c=s(1900);const n=(0,c.Z)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("article",{staticClass:"slds-card slds-container_medium slds-m-bottom_medium"},[s("div",{staticClass:"slds-card__header slds-p-around_x-small"},[s("div",{staticClass:"slds-grid slds-grid_align-spread slds-grid_vertical-align-center"},[s("div",{staticClass:"slds-col slds-text-heading_small slds-p-left_x-small"},[e._v("\n                "+e._s(e.record.Name)+"\n            ")]),e._v(" "),s("div",{staticClass:"slds-grid slds-grid_vertical-align-center slds-p-right_x-small"},[s("div",{staticClass:"slds-m-right_xx-small"},[s("button",{staticClass:"slds-button slds-button_icon slds-button_icon-container",on:{click:e.deleteRecord}},[s("span",{staticClass:"slds-button__icon ma-icon ma-icon-delete"})])]),e._v(" "),s("button",{staticClass:"slds-button slds-button_neutral slds-m-around_xx-small",on:{click:e.resetSync}},[e._v("\n                    "+e._s(e.Labels.ArcGIS_ResetSync)+"\n                ")]),e._v(" "),s("button",{staticClass:"slds-button slds-button_neutral slds-m-around_xx-small",on:{click:e.testSync}},[e._v("\n                    "+e._s(e.Labels.ArcGIS_TestSync)+"\n                ")]),e._v(" "),s("button",{staticClass:"slds-button slds-button_neutral slds-m-around_xx-small",on:{click:e.editRecord}},[e._v("\n                    "+e._s(e.Labels.ArcGIS_Edit)+"\n                ")])])])]),e._v(" "),s("div",{staticClass:"slds-card__body slds-card__body_inner slds-m-around_xx-small"},[s("div",{staticClass:"slds-grid slds-gutters"},[s("div",{staticClass:"slds-col"},[s("div",{staticClass:"slds-form-element slds-m-bottom_small"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"select-01"}},[e._v(e._s(e.Labels.ArcGIS_Object))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},[s("input",{staticClass:"slds-input",attrs:{id:"objectName",type:"text",readonly:""},domProps:{value:e.objectName}})])]),e._v(" "),s("div",{staticClass:"slds-form-element slds-m-bottom_small"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"select-01"}},[e._v(e._s(e.Labels.ArcGIS_FeatureID))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},[s("input",{staticClass:"slds-input",attrs:{id:"featureIdFieldName",type:"text",readonly:""},domProps:{value:e.record.FeatureIDFieldName__c}})])]),e._v(" "),s("div",{staticClass:"slds-form-element slds-m-bottom_small"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"select-01"}},[e._v(e._s(e.Labels.ArcGIS_LastPushed))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},[s("input",{staticClass:"slds-input",attrs:{id:"lastPushedFieldName",type:"text",readonly:""},domProps:{value:e.record.LastPushedFieldName__c}})])]),e._v(" "),s("div",{staticClass:"slds-form-element slds-m-bottom_medium"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"select-01"}},[e._v(e._s(e.Labels.ArcGIS_Updated))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},[s("input",{staticClass:"slds-input",attrs:{id:"isUpdatedFieldName",type:"text",readonly:""},domProps:{value:e.record.IsUpdatedFieldName__c}})])]),e._v(" "),s("div",{staticClass:"slds-form-element slds-m-bottom_medium"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"select-01"}},[e._v(e._s(e.Labels.ArcGIS_Log))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},[s("input",{staticClass:"slds-input",attrs:{id:"enableLog",type:"text",readonly:""},domProps:{value:e.record.EnableLog__c?e.Labels.ArcGIS_Enabled:e.Labels.ArcGIS_Disabled}})])])]),e._v(" "),s("div",{staticClass:"slds-col"},[s("div",{staticClass:"slds-form-element slds-m-bottom_small"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"select-01"}},[e._v(e._s(e.Labels.ArcGIS_Layer))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},[s("input",{staticClass:"slds-input",attrs:{id:"layerName",type:"text",readonly:""},domProps:{value:e.layerName}})])]),e._v(" "),s("div",{staticClass:"slds-form-element slds-m-bottom_small"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"select-01"}},[e._v(e._s(e.Labels.ArcGIS_Template))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},[s("input",{staticClass:"slds-input",attrs:{id:"templateName",type:"text",readonly:""},domProps:{value:e.record.TemplateName__c}})])]),e._v(" "),s("div",{staticClass:"slds-form-element slds-m-bottom_small"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"select-01"}},[e._v(e._s(e.Labels.ArcGIS_FeatureLayerURL))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},[s("input",{staticClass:"slds-input",attrs:{id:"featureLayerUrl",type:"text",readonly:""},domProps:{value:e.record.FeatureLayerURL__c}})])]),e._v(" "),s("div",{staticClass:"slds-form-element slds-m-bottom_small"},[s("label",{staticClass:"slds-form-element__label",attrs:{for:"select-01"}},[e._v(e._s(e.Labels.ArcGIS_AuthenticationToken))]),e._v(" "),s("div",{staticClass:"slds-form-element__control"},[s("input",{staticClass:"slds-input",attrs:{id:"token",type:"text",readonly:""},domProps:{value:e.record.Token__c||e.record.Token2__c?e.Labels.ArcGIS_TokenHidden:""}})])])])])])])}),[],!1,null,"781c64ba",null).exports,{MARemoting:d}=window,m={components:{Modal:a.u_,TextInput:a.oi},props:{tokenServicesUrl:{type:String,required:!0}},data(){return{Labels:window.MASystem.Labels,title:`${window.MASystem.Labels.ArcGIS_RequestForPermission}: ${this.tokenServicesUrl.replace(/^(https?:\/\/[^/?]+).*$/,"$1")}`,username:null,password:null,toast:null}},methods:{cancel(){this.$emit("close-generateToken")},validateInput(){return this.username&&this.password},generateToken(){if(this.validateInput()){const e={ajaxResource:"ArcGISAPI",action:"generateToken",tokenServicesURL:this.tokenServicesUrl,username:this.username,password:this.password};(new l.Z).setAction(d.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([e],(e=>{e.success?this.$emit("close-generateToken",e.token):e.error?"You are not authorized to access this information"===e.error?this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToGenerateTokenInvalidCredentials,state:"error"}):this.$root.$emit("toast",{message:e.error,state:"error"}):this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToGenerateTokenContactAdministrator,state:"error"})}),{escape:!1,buffer:!1})}else this.$root.$emit("toast",{message:this.Labels.ArcGIS_MissingRequiredFields,state:"error"})},handleRemoteActionError(e,t){console.log("TODO: handleRemoteActionError",t)}}},u=(0,c.Z)(m,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Modal",{staticClass:"generate-token-modal",attrs:{title:e.title,doDetach:!0},on:{close:e.cancel}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-grid slds-gutters"},[s("div",{staticClass:"slds-col"},[s("TextInput",{staticClass:"slds-form-element slds-m-bottom_small",attrs:{required:!0,labels:{name:e.Labels.ArcGIS_Username}},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),s("TextInput",{staticClass:"slds-form-element slds-m-bottom_large",attrs:{required:!0,labels:{name:e.Labels.ArcGIS_Password},type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1)])]),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:e.cancel}},[e._v("\n                "+e._s(e.Labels.ArcGIS_Cancel)+"\n            ")]),e._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:e.generateToken}},[e._v("\n                "+e._s(e.Labels.ArcGIS_GenerateToken)+"\n            ")])])])],1)}),[],!1,null,"e2b0bbe4",null).exports,{MARemoting:_}=window,h={components:{Modal:a.u_,TextInput:a.oi,Picklist:a.Gp,Checkbox:a.XZ,GenerateToken:u},props:{objects:{type:[Array,String],required:!0},layerNames:{type:Object,required:!0},layerUrls:{type:Object,required:!0},templateNames:{type:Object,required:!0},recordToEdit:{type:Object,default:null}},data:()=>({Labels:window.MASystem.Labels,record:{Id:null,Name:null,ObjectName__c:null,FeatureIDFieldName__c:null,LastPushedFieldName__c:null,IsUpdatedFieldName__c:null,LayerID__c:null,TemplateName__c:null,FeatureLayerURL__c:null,Token__c:null,Token2__c:null,EnableLog__c:!0},doubleFields:[],datetimeFields:[],booleanFields:[],isTokenBasedSecurity:!1,tokenServicesUrl:null,currentToken:null,isGenerateTokenVisible:!1,toast:null}),computed:{title(){return this.recordToEdit?this.Labels.ArcGIS_EditArcGISObject:this.Labels.ArcGIS_NewArcGISObject},saveAction(){return(this.recordToEdit?"update":"create")+"BatchPushSetting"},layers(){return Object.keys(this.templateNames).length>0&&this.record.ObjectName__c?Object.keys(this.templateNames[this.record.ObjectName__c]).map((e=>({id:e,name:this.layerNames[e]}))):[]},templates(){return Object.keys(this.templateNames).length>0&&this.record.ObjectName__c&&this.record.LayerID__c?this.templateNames[this.record.ObjectName__c][this.record.LayerID__c]:[]},isToastVisible(){return null!=this.toast}},watch:{recordToEdit:{handler(e){e&&(this.record=e,this.getFields(this.record.ObjectName__c))}},"record.LayerID__c":{handler(e){this.layerUrls[e].indexOf("/rest/")>-1&&(this.record.FeatureLayerURL__c=this.layerUrls[e])}},"record.FeatureLayerURL__c":{handler(e){if(this.isTokenBasedSecurity=!1,e){const t=e.match(/^(https?:\/\/[^ \t]+\/rest)\/services\/[^/ \t]+\/FeatureServer\/[0-9]+$/);if(t){const e={ajaxResource:"ArcGISAPI",action:"get",requestURL:`${t[1]}/info?f=json`};(new l.Z).setAction(_.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([e],(e=>{if(e.success){const t=e.data;this.isTokenBasedSecurity=t.authInfo.isTokenBasedSecurity,this.tokenServicesUrl=t.authInfo.tokenServicesUrl.replace(/\/+$/,"")}}),{escape:!1,buffer:!1})}}}}},created(){this.init()},methods:{init(){this.recordToEdit&&(this.record=this.recordToEdit,this.getFields(this.record.ObjectName__c),this.currentToken=this.record.Token__c||this.record.Token2__c?this.Labels.ArcGIS_TokenHidden:"")},getFields(e){if(this.doubleFields.length=0,this.datetimeFields.length=0,this.booleanFields.length=0,e){const t={ajaxResource:"ArcGISAPI",action:"getFields",objectName:e};(new l.Z).setAction(_.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([t],(e=>{e.success&&Object.keys(e.fields).forEach((t=>{switch(e.fields[t].toUpperCase()){case"DOUBLE":this.doubleFields.push(t);break;case"DATETIME":this.datetimeFields.push(t);break;case"BOOLEAN":this.booleanFields.push(t)}}))}),{escape:!1,buffer:!1}),this.doubleFields.sort(),this.datetimeFields.sort(),this.booleanFields.sort()}},onSelectObject(){this.getFields(this.record.ObjectName__c),this.record.FeatureIDFieldName__c=null,this.record.LastPushedFieldName__c=null,this.record.IsUpdatedFieldName__c=null,this.record.LayerID__c=null,this.record.TemplateName__c=null,this.record.FeatureLayerURL__c=null,this.record.Token__c=null,this.record.Token2__c=null,this.currentToken=null},generateToken(){this.record.FeatureLayerURL__c?this.isTokenBasedSecurity&&(this.isGenerateTokenVisible=!0):this.$root.$emit("toast",{message:this.Labels.ArcGIS_MissingFeatureLayerURL,state:"error"})},setToken(e){e&&(this.record.Token__c=null,this.record.Token2__c=e,this.currentToken=this.Labels.ArcGIS_TokenHidden)},closeGenerateToken(e){this.isGenerateTokenVisible=!1,e&&this.setToken(e)},cancel(){this.$emit("close-editor")},validateInput(){return this.record.ObjectName__c&&this.record.FeatureIDFieldName__c&&this.record.LastPushedFieldName__c&&this.record.IsUpdatedFieldName__c&&this.record.LayerID__c&&this.record.TemplateName__c&&this.record.FeatureLayerURL__c},save(){if(this.validateInput()){const e={ajaxResource:"ArcGISAPI",action:this.saveAction,record:JSON.stringify(this.record)};(new l.Z).setAction(_.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([e],(e=>{e.success?this.$emit("close-editor",!0):this.toast=this.Labels.ArcGIS_FailedToSaveData}),{escape:!1,buffer:!1})}else this.$root.$emit("toast",{message:this.Labels.ArcGIS_MissingRequiredFields,state:"error"})},clearToast(){this.toast=null},handleRemoteActionError(e,t){console.log("TODO: handleRemoteActionError",t)}}},b=(0,c.Z)(h,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Modal",{attrs:{title:e.title,doDetach:!0},on:{close:e.cancel}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-grid slds-wrap slds-container_medium slds-m-bottom_large"},[s("div",{staticClass:"slds-has-flexi-truncate slds-p-horizontal_medium slds-size_1-of-2"},[s("TextInput",{staticClass:"slds-form-element slds-m-bottom_small",attrs:{required:!0,labels:{name:e.Labels.ArcGIS_SettingName}},model:{value:e.record.Name,callback:function(t){e.$set(e.record,"Name",t)},expression:"record.Name"}})],1),e._v(" "),s("div",{staticClass:"slds-has-flexi-truncate slds-p-horizontal_medium slds-size_1-of-2"},[s("Picklist",{staticClass:"slds-m-bottom_small",attrs:{options:e.objects,disabled:0==e.objects.length,required:!0,detach:!0,labels:{name:e.Labels.ArcGIS_Object,placeholder:e.Labels.MA_Select_an_Option},idKey:"path",titleKey:"label",filterable:""},on:{changed:e.onSelectObject},model:{value:e.record.ObjectName__c,callback:function(t){e.$set(e.record,"ObjectName__c",t)},expression:"record.ObjectName__c"}})],1),e._v(" "),s("div",{staticClass:"slds-has-flexi-truncate slds-p-horizontal_medium slds-size_1-of-2"},[s("Picklist",{staticClass:"slds-m-bottom_small",attrs:{options:e.doubleFields,disabled:0==e.doubleFields.length,required:!0,hasNoneOption:!1,detach:!0,labels:{name:e.Labels.ArcGIS_FeatureID,placeholder:e.Labels.MA_Select_an_Option},filterable:""},model:{value:e.record.FeatureIDFieldName__c,callback:function(t){e.$set(e.record,"FeatureIDFieldName__c",t)},expression:"record.FeatureIDFieldName__c"}})],1),e._v(" "),s("div",{staticClass:"slds-has-flexi-truncate slds-p-horizontal_medium slds-size_1-of-2"},[s("Picklist",{staticClass:"slds-m-bottom_small",attrs:{options:e.datetimeFields,disabled:0==e.datetimeFields.length,required:!0,hasNoneOption:!1,detach:!0,labels:{name:e.Labels.ArcGIS_LastPushed,placeholder:e.Labels.MA_Select_an_Option},filterable:""},model:{value:e.record.LastPushedFieldName__c,callback:function(t){e.$set(e.record,"LastPushedFieldName__c",t)},expression:"record.LastPushedFieldName__c"}})],1),e._v(" "),s("div",{staticClass:"slds-has-flexi-truncate slds-p-horizontal_medium slds-size_1-of-2"},[s("Picklist",{staticClass:"slds-m-bottom_small",attrs:{options:e.booleanFields,disabled:0==e.booleanFields.length,required:!0,hasNoneOption:!1,detach:!0,labels:{name:e.Labels.ArcGIS_Updated,placeholder:e.Labels.MA_Select_an_Option},filterable:""},model:{value:e.record.IsUpdatedFieldName__c,callback:function(t){e.$set(e.record,"IsUpdatedFieldName__c",t)},expression:"record.IsUpdatedFieldName__c"}})],1),e._v(" "),s("div",{staticClass:"slds-has-flexi-truncate slds-p-horizontal_medium slds-size_1-of-2"},[s("Picklist",{staticClass:"slds-m-bottom_small",attrs:{options:e.layers,disabled:0==e.layers.length,required:!0,hasNoneOption:!1,detach:!0,labels:{name:e.Labels.ArcGIS_Layer,placeholder:e.Labels.MA_Select_an_Option},idKey:"id",titleKey:"name",filterable:""},model:{value:e.record.LayerID__c,callback:function(t){e.$set(e.record,"LayerID__c",t)},expression:"record.LayerID__c"}})],1),e._v(" "),s("div",{staticClass:"slds-has-flexi-truncate slds-p-horizontal_medium slds-size_1-of-2"},[s("Picklist",{staticClass:"slds-m-bottom_small",attrs:{options:e.templates,disabled:0==e.templates.length,required:!0,hasNoneOption:!1,detach:!0,labels:{name:e.Labels.ArcGIS_Template,placeholder:e.Labels.MA_Select_an_Option},filterable:""},model:{value:e.record.TemplateName__c,callback:function(t){e.$set(e.record,"TemplateName__c",t)},expression:"record.TemplateName__c"}})],1),e._v(" "),s("div",{staticClass:"slds-has-flexi-truncate slds-p-horizontal_medium slds-size_1-of-2"},[s("TextInput",{staticClass:"slds-m-bottom_small",attrs:{disabled:null==e.record.LayerID__c,required:!0,labels:{name:e.Labels.ArcGIS_FeatureLayerURL}},model:{value:e.record.FeatureLayerURL__c,callback:function(t){e.$set(e.record,"FeatureLayerURL__c",t)},expression:"record.FeatureLayerURL__c"}})],1),e._v(" "),s("div",{staticClass:"slds-has-flexi-truncate slds-p-horizontal_medium slds-size_1-of-2"},[s("div",{staticClass:"slds-grid slds-grid_vertical-align-end slds-gutters"},[s("div",{staticClass:"slds-col"},[s("TextInput",{staticClass:"slds-m-bottom_small",attrs:{value:e.currentToken,required:!1,disabled:!e.isTokenBasedSecurity,labels:{name:e.Labels.ArcGIS_AuthenticationToken}},on:{changed:e.setToken}})],1),e._v(" "),s("div",{staticClass:"slds-col"},[s("button",{staticClass:"slds-button slds-m-bottom_small slds-button_neutral",attrs:{disabled:!e.isTokenBasedSecurity},on:{click:e.generateToken}},[e._v("\n                                "+e._s(e.Labels.ArcGIS_Generate)+"\n                            ")]),e._v(" "),e.isGenerateTokenVisible?s("GenerateToken",{attrs:{tokenServicesUrl:e.tokenServicesUrl},on:{"close-generateToken":e.closeGenerateToken}}):e._e()],1)])]),e._v(" "),s("div",{staticClass:"slds-has-flexi-truncate slds-p-horizontal_medium slds-size_1-of-2"},[s("Checkbox",{staticClass:"slds-m-top_large",attrs:{labels:{name:e.Labels.ArcGIS_EnableLog},slide:""},model:{value:e.record.EnableLog__c,callback:function(t){e.$set(e.record,"EnableLog__c",t)},expression:"record.EnableLog__c"}})],1)])]),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:e.cancel}},[e._v("\n                "+e._s(e.Labels.ArcGIS_Cancel)+"\n            ")]),e._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:e.save}},[e._v("\n                "+e._s(e.Labels.ArcGIS_Save)+"\n            ")])])])],1)}),[],!1,null,null,null).exports,{MARemoting:p}=window,v={components:{Modal:a.u_,ArcGISObject:n,EditArcGISObject:b},data:()=>({Labels:window.MASystem.Labels,objects:[],objectNames:{},layerNames:{},layerUrls:{},templateNames:{},isEditorVisible:!1,record:null,records:[],confirm:{title:null,message:null,button:null,ok:null,cancel:null}}),computed:{isConfirmVisible(){return null!=this.confirm.title}},created(){this.init()},methods:{init(){this.loadLayers(),this.loadSettingRecords()},loadLayers(){this.objects.length=0,this.objectNames={},this.layerNames={},this.layerUrls={},this.templateNames={},(new l.Z).setAction(p.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([{ajaxResource:"ArcGISAPI",action:"getLayers"}],(e=>{if(e.success){const t=(0,o.a)(e.records,"maps__"),s=[],r=[],a=[];t.forEach((e=>{const t=e.Id,l=e.Name;this.$set(this.layerNames,t,l),this.$set(this.layerUrls,t,JSON.parse(e.Options__c).baseURL),s.push(`${l}\n${t}`),e.ArcGISWebMapC2C__c&&JSON.parse(e.ArcGISWebMapC2C__c).forEach((e=>{if(e.active&&e.salesforceObject.path){const s=e.salesforceObject,l=e.templateName;r.indexOf(s.path)<0&&(r.push(s.path),a.push(`${s.label}\n${s.path}`),this.$set(this.templateNames,s.path,{})),this.templateNames[s.path][t]||this.$set(this.templateNames[s.path],t,[]),this.templateNames[s.path][t].push(l)}}))})),a.sort().forEach((e=>{const t=e.split("\n"),s=t[1],r=t[0];this.objects.push({path:s,label:r}),this.$set(this.objectNames,s,r)}))}}),{escape:!1,buffer:!1})},loadSettingRecords(){this.records.length=0,(new l.Z).setAction(p.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([{ajaxResource:"ArcGISAPI",action:"getBatchPushSettings"}],(e=>{e.success&&(0,o.a)(e.records,"maps__").forEach((e=>{e={Token__c:null,Token2__c:null,...e},this.records.push(e)}))}),{escape:!1,buffer:!1})},createRecord(){this.record=null,this.isEditorVisible=!0},confirmResetSync(e){this.confirm={title:this.Labels.ArcGIS_ResetSync,message:this.Labels.ArcGIS_ResetSyncConfirm,button:this.Labels.ArcGIS_ResetSync,ok:()=>{this.confirm.title=null,this.resetSync(e)},cancel:()=>{this.confirm.title=null}}},resetSync(e){this.records.forEach((t=>{if(t.Id===e){const t={ajaxResource:"ArcGISAPI",action:"resetBatchPushLastPushed",settingId:e};return(new l.Z).setAction(p.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([t],(e=>{e.success?this.$root.$emit("toast",{message:this.Labels.ArcGIS_SucceededToResetSync,state:"success"}):this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToResetSync,state:"success"})}),{escape:!1,buffer:!1}),!1}return!0}))},testSync(e){this.records.forEach((t=>{if(t.Id===e){const t={ajaxResource:"ArcGISAPI",action:"testBatchPushSetting",settingId:e};return(new l.Z).setAction(p.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([t],(e=>{e.success?this.$root.$emit("toast",{message:this.Labels.ArcGIS_SucceededToTestSync,state:"success"}):this.$root.$emit("toast",{message:`${this.Labels.ArcGIS_FailedToTestSync} <a href="/${e.object}">${e.error}</a>`,state:"error"})}),{escape:!1,buffer:!1}),!1}return!0}))},editRecord(e){this.record=e,this.isEditorVisible=!0},closeEditor(e){this.record=null,this.isEditorVisible=!1,e&&(this.loadSettingRecords(),this.$emit("refresh"))},confirmDeleteRecord(e){this.confirm={title:this.Labels.ArcGIS_DeleteArcGISObject,message:this.Labels.ArcGIS_DeleteArcGISObjectConfirm,button:this.Labels.MA_Delete,ok:()=>{this.confirm.title=null,this.deleteRecord(e)},cancel:()=>{this.confirm.title=null}}},deleteRecord(e){this.records.forEach(((t,s)=>{if(t.Id===e){const t={ajaxResource:"ArcGISAPI",action:"deleteBatchPushSetting",settingId:e};return(new l.Z).setAction(p.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([t],(e=>{e.success?(this.records.splice(s,1),this.$emit("refresh")):this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToDeleteData,state:"error"})}),{escape:!1,buffer:!1}),!1}return!0}))},handleRemoteActionError(e,t){console.log("TODO: handleRemoteActionError",t)}}},A=(0,c.Z)(v,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.isEditorVisible?s("EditArcGISObject",{attrs:{objects:e.objects,layerNames:e.layerNames,layerUrls:e.layerUrls,templateNames:e.templateNames,recordToEdit:e.record},on:{"close-editor":e.closeEditor}}):e._e(),e._v(" "),s("div",{staticClass:"slds-grid slds-container_medium"},[s("button",{staticClass:"slds-button slds-button_brand slds-m-bottom_medium slds-shrink-none",on:{click:e.createRecord}},[e._v("\n            "+e._s(e.Labels.MA_Add_New)+"\n        ")]),e._v(" "),s("div",{staticClass:"slds-m-left_small slds-m-top_x-small"},[e._v("\n            "+e._s(e.Labels.ArcGIS_AddNewArcGISObjectDescription)+"\n        ")])]),e._v(" "),e._l(e.records,(function(t,r){return s("ArcGISObject",{key:r,attrs:{record:t,objectNames:e.objectNames,layerNames:e.layerNames},on:{"reset-sync":e.confirmResetSync,"test-sync":e.testSync,"edit-record":e.editRecord,"delete-record":e.confirmDeleteRecord}})})),e._v(" "),e.isConfirmVisible?s("Modal",{attrs:{title:e.confirm.title},on:{close:e.confirm.cancel}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-grid slds-gutters"},[e._v("\n                "+e._s(e.confirm.message)+"\n            ")])]),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:e.confirm.cancel}},[e._v("\n                "+e._s(e.Labels.MA_Cancel)+"\n            ")]),e._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:e.confirm.ok}},[e._v("\n                "+e._s(e.confirm.button)+"\n            ")])])]):e._e()],2)}),[],!1,null,"83ae7424",null).exports,f={components:{ActionMenu:a.PC,ActionMenuItem:a.F9},props:{record:{type:Object,required:!0},settingNames:{type:Object,required:!0}},data:()=>({Labels:window.MASystem.Labels}),computed:{recordInfo(){return JSON.parse(this.record.CronJobDetail.Name.substring(16))},settingName(){return this.settingNames[this.recordInfo.settingId]},nextFireTime(){return new Date(this.record.NextFireTime).toLocaleString().replace(", "," &bull; ")}},methods:{runJob(){this.$emit("run-job",this.recordInfo.settingId)},editRecord(){const e={jobId:this.record.Id,jobName:this.recordInfo.jobName,settingId:this.recordInfo.settingId,repeats:this.recordInfo.repeats};this.$emit("edit-record",e)},deleteRecord(){this.$emit("delete-record",this.record.Id)},handleRemoteActionError(e,t){console.log("TODO: handleRemoteActionError",t)}}},I=(0,c.Z)(f,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("tr",[s("td",[s("div",{staticClass:"slds-truncate"},[e._v("\n            "+e._s(e.recordInfo.jobName)+"\n        ")])]),e._v(" "),s("td",[s("div",{staticClass:"slds-truncate"},[e._v("\n            "+e._s(e.settingName)+"\n        ")])]),e._v(" "),s("td",[s("div",{staticClass:"slds-badge slds-badge_inverse"},[e._v("\n            "+e._s(e.record.State)+"\n        ")])]),e._v(" "),s("td",[s("div",{staticClass:"slds-truncate"},[e._v("\n            "+e._s(e.nextFireTime)+"\n        ")])]),e._v(" "),s("td",[s("div",{staticClass:"slds-truncate"},[e._v("\n            "+e._s(e.record.CreatedBy.Name)+"\n        ")])]),e._v(" "),s("td",[s("ActionMenu",{attrs:{doDetach:!0}},[s("button",{directives:[{name:"show",rawName:"v-show",value:!e.showEditMode,expression:"!showEditMode"}],staticClass:"slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-x-small",attrs:{slot:"button"},slot:"button"},[s("span",{staticClass:"slds-button__icon ma-icon ma-icon-down"})]),e._v(" "),s("ActionMenuItem",{attrs:{label:e.Labels.ArcGIS_Run},on:{click:e.runJob}}),e._v(" "),s("ActionMenuItem",{attrs:{label:e.Labels.ArcGIS_Edit},on:{click:e.editRecord}}),e._v(" "),s("ActionMenuItem",{attrs:{label:e.Labels.ArcGIS_Delete},on:{click:e.deleteRecord}})],1)],1)])}),[],!1,null,"2cf8aa94",null).exports,{MARemoting:S}=window,g={components:{Modal:a.u_,RadioGroup:a.Ee,TextInput:a.oi,Picklist:a.Gp},props:{recordToEdit:{type:Object,default:null},settings:{type:Array,default:null}},data:()=>({Labels:window.MASystem.Labels,record:{jobId:null,jobName:null,settingId:null,repeats:null},frequency:"Recurring",options:{frequency:[{label:window.MASystem.Labels.ArcGIS_Once,value:"Just_Once"},{label:window.MASystem.Labels.ArcGIS_Recurring,value:"Recurring"}],repeats:[{key:"15m",value:window.MASystem.Labels.ArcGIS_Every15Minutes},{key:"30m",value:window.MASystem.Labels.ArcGIS_Every30Minutes},{key:"1h",value:window.MASystem.Labels.ArcGIS_Hourly},{key:"1d",value:window.MASystem.Labels.ArcGIS_Daily},{key:"1w",value:window.MASystem.Labels.ArcGIS_Weekly}]}}),computed:{title(){return this.recordToEdit?this.Labels.ArcGIS_EditBatch:this.Labels.ArcGIS_NewBatch},action(){return this.isRecurring?this.Labels.ArcGIS_ScheduleBatch:this.Labels.ArcGIS_RunOneTimeBatch},isRecurring(){return"Recurring"===this.frequency}},created(){this.init()},methods:{init(){this.recordToEdit&&(this.record=this.recordToEdit)},cancel(){this.$emit("close-editor")},validateInput(){return this.record.settingId&&(!this.isRecurring||this.record.jobName&&this.record.repeats)},runJob(e,t,s){const r={ajaxResource:"ArcGISAPI",action:"runBatchPush",settingId:e};(new l.Z).setAction(S.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([r],(e=>{e.success?t():s()}),{escape:!1,buffer:!1})},createJob(e,t,s){const r={ajaxResource:"ArcGISAPI",action:"createBatchPushJob",record:JSON.stringify(e)};(new l.Z).setAction(S.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([r],(e=>{e.success?t():s()}),{escape:!1,buffer:!1})},deleteJob(e,t,s){const r={ajaxResource:"ArcGISAPI",action:"deleteBatchPushJob",jobId:e};(new l.Z).setAction(S.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([r],(e=>{e.success?t():s()}),{escape:!1,buffer:!1})},schedule(){this.validateInput()?this.isRecurring?this.recordToEdit?this.deleteJob(this.record.jobId,(()=>{this.createJob(this.record,(()=>{this.$emit("close-editor",{saved:!0,toast:{message:this.Labels.ArcGIS_BatchScheduled,state:"success"}})}),(()=>{this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToScheduleBatch,state:"error"})}))}),(()=>{this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToDeleteBatch,state:"error"})})):this.createJob(this.record,(()=>{this.$emit("close-editor",{saved:!0,toast:{message:this.Labels.ArcGIS_BatchScheduled,state:"success"}})}),(()=>{this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToScheduleBatch,state:"error"})})):this.runJob(this.record.settingId,(()=>{this.$emit("close-editor",{saved:!0,toast:{message:this.Labels.ArcGIS_BatchStarted,state:"success"}})}),(()=>{this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToRunBatch,state:"error"})})):this.$root.$emit("toast",{message:this.Labels.ArcGIS_MissingRequiredFields,state:"error"})},handleRemoteActionError(e,t){console.log("TODO: handleRemoteActionError",t)}}},L=(0,c.Z)(g,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Modal",{attrs:{title:e.title},on:{close:e.cancel}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-col"},[s("RadioGroup",{staticClass:"slds-form-element slds-m-bottom_medium",attrs:{options:e.options.frequency,required:!1,labels:{name:e.Labels.ArcGIS_RunThisBatch}},model:{value:e.frequency,callback:function(t){e.frequency=t},expression:"frequency"}}),e._v(" "),s("TextInput",{staticClass:"slds-form-element slds-m-bottom_medium",attrs:{required:e.isRecurring,disabled:!e.isRecurring,labels:{name:e.Labels.ArcGIS_BatchName}},model:{value:e.record.jobName,callback:function(t){e.$set(e.record,"jobName",t)},expression:"record.jobName"}}),e._v(" "),s("Picklist",{staticClass:"slds-form-element__control slds-m-bottom_medium",attrs:{options:e.settings,hasNoneOption:!1,required:"",detach:"",labels:{name:e.Labels.ArcGIS_ArcGISObject},idKey:"id",titleKey:"name",filterable:""},model:{value:e.record.settingId,callback:function(t){e.$set(e.record,"settingId",t)},expression:"record.settingId"}}),e._v(" "),s("Picklist",{staticClass:"slds-form-element__control",attrs:{options:e.options.repeats,hasNoneOption:!1,required:e.isRecurring,disabled:!e.isRecurring,detach:"",labels:{name:e.Labels.ArcGIS_Repeats},idKey:"key",titleKey:"value",filterable:""},model:{value:e.record.repeats,callback:function(t){e.$set(e.record,"repeats",t)},expression:"record.repeats"}})],1)]),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:e.cancel}},[e._v("\n                "+e._s(e.Labels.ArcGIS_Cancel)+"\n            ")]),e._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:e.schedule}},[e._v("\n                "+e._s(e.action)+"\n            ")])])])],1)}),[],!1,null,null,null).exports,{MARemoting:y}=window,k={components:{Modal:a.u_,BatchSetting:I,EditBatchSetting:L},data:()=>({Labels:window.MASystem.Labels,isEditorVisible:!1,record:null,records:[],settings:[],settingNames:{},logs:[],confirm:{title:null,message:null,button:null,ok:null,cancel:null}}),computed:{isConfirmVisible(){return null!=this.confirm.title}},created(){this.init(),this.$bus.$on("refresh",this.loadSettings)},methods:{init(){this.loadJobRecords(),this.loadSettings()},loadJobRecords(){this.records.length=0,(new l.Z).setAction(y.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([{ajaxResource:"ArcGISAPI",action:"getBatchPushJobs"}],(e=>{e.success&&(0,o.a)(e.jobs,"maps__").forEach((e=>{const t={...e.record};let s=new Date(t.NextFireTime)-(new Date).getTime();e.childRecords.length>0&&e.childRecords.forEach((e=>{const r=new Date(e.NextFireTime)-(new Date).getTime();r<s&&(s=r,t.NextFireTime=e.NextFireTime)})),this.records.push(t)}))}),{escape:!1,buffer:!1})},loadSettings(){this.settingNames={},this.settings.length=0,(new l.Z).setAction(y.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([{ajaxResource:"ArcGISAPI",action:"getBatchPushSettings"}],(e=>{if(e.success){const t=(0,o.a)(e.records,"maps__"),s=[];t.forEach((e=>{this.$set(this.settingNames,e.Id,e.Name),s.push(`${e.Name}\n${e.Id}`)})),s.sort().forEach((e=>{const t=e.split("\n");this.settings.push({id:t[1],name:t[0]})}))}}),{escape:!1,buffer:!1})},createRecord(){this.records.length>=10?this.$root.$emit("toast",{message:this.Labels.ArcGIS_MaxBatchesReached.replace("#",10),state:"info"}):(this.record=null,this.isEditorVisible=!0)},editRecord(e){this.record=e,this.isEditorVisible=!0},closeEditor(e){this.record=null,this.isEditorVisible=!1,e&&(e.saved&&this.loadJobRecords(),e.toast&&this.$root.$emit("toast",e.toast))},confirmDeleteRecord(e){this.confirm={title:this.Labels.ArcGIS_DeleteBatchSetting,message:this.Labels.ArcGIS_DeleteBatchSettingConfirm,button:this.Labels.ArcGIS_Delete,ok:()=>{this.confirm.title=null,this.deleteRecord(e)},cancel:()=>{this.confirm.title=null}}},deleteRecord(e){this.records.forEach(((t,s)=>{if(t.Id===e){const t={ajaxResource:"ArcGISAPI",action:"deleteBatchPushJob",jobId:e};return(new l.Z).setAction(y.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([t],(e=>{e.success?this.records.splice(s,1):this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToDeleteData,state:"error"})}),{escape:!1,buffer:!1}),!1}return!0}))},runJob(e){const t={ajaxResource:"ArcGISAPI",action:"runBatchPush",settingId:e};(new l.Z).setAction(y.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([t],(e=>{e.success?this.$root.$emit("toast",{message:this.Labels.ArcGIS_BatchStarted,state:"success"}):this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToRunBatch,state:"error"})}),{escape:!1,buffer:!1})},confirmDeleteLogs(){this.confirm={title:this.Labels.ArcGIS_DeleteLogs,message:this.Labels.ArcGIS_DeleteLogsConfirm,button:this.Labels.ArcGIS_Delete,ok:()=>{this.confirm.title=null,this.deleteLogs()},cancel:()=>{this.confirm.title=null}}},deleteLogs(){(new l.Z).setAction(y.processAJAXRequest).setErrorHandler(this.handleRemoteActionError.bind(this)).invoke([{ajaxResource:"ArcGISAPI",action:"deleteBatchPushLogs"}],(e=>{e.success||this.$root.$emit("toast",{message:this.Labels.ArcGIS_FailedToDeleteLogs,state:"error"})}),{escape:!1,buffer:!1})},handleRemoteActionError(e,t){console.log("TODO: handleRemoteActionError",t)}}},C=(0,c.Z)(k,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.isEditorVisible?s("EditBatchSetting",{attrs:{settings:e.settings,recordToEdit:e.record},on:{"close-editor":e.closeEditor}}):e._e(),e._v(" "),s("div",{staticClass:"slds-col slds-scrollable"},[s("div",{staticClass:"slds-grid slds-grid_align-spread slds-m-bottom_medium"},[s("div",{staticClass:"slds-col"},[s("button",{staticClass:"slds-button slds-button_brand slds-grid_align-center",on:{click:e.createRecord}},[e._v("\n                    "+e._s(e.Labels.ArcGIS_AddNew)+"\n                ")])]),e._v(" "),s("div",{staticClass:"slds-col slds-button-group",attrs:{role:"group"}},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:e.init}},[s("span",{staticClass:"slds-button__icon slds-button__icon_left ma-icon ma-icon-refresh"}),e._v(e._s(e.Labels.ArcGIS_Refresh)+"\n                ")]),e._v(" "),s("button",{staticClass:"slds-button slds-button_neutral",on:{click:e.confirmDeleteLogs}},[e._v("\n                    "+e._s(e.Labels.ArcGIS_DeleteLogs)+"\n                ")])])]),e._v(" "),s("table",{staticClass:"slds-table slds-table_bordered slds-table_cell-buffer rounded-table slds-border_left slds-border_right"},[s("thead",[s("tr",{staticClass:"slds-text-title_caps"},[s("th",{attrs:{scope:"col"}},[s("div",{staticClass:"slds-truncate"},[e._v("\n                            "+e._s(e.Labels.ArcGIS_BatchName)+"\n                        ")])]),e._v(" "),s("th",{attrs:{scope:"col"}},[s("div",{staticClass:"slds-truncate"},[e._v("\n                            "+e._s(e.Labels.ArcGIS_ArcGISObject)+"\n                        ")])]),e._v(" "),s("th",{attrs:{scope:"col"}},[s("div",{staticClass:"slds-truncate"},[e._v("\n                            "+e._s(e.Labels.ArcGIS_Status)+"\n                        ")])]),e._v(" "),s("th",{attrs:{scope:"col"}},[s("div",{staticClass:"slds-truncate"},[e._v("\n                            "+e._s(e.Labels.ArcGIS_NextScheduledRun)+"\n                        ")])]),e._v(" "),s("th",{attrs:{scope:"col"}},[s("div",{staticClass:"slds-truncate"},[e._v("\n                            "+e._s(e.Labels.ArcGIS_CreatedBy)+"\n                        ")])]),e._v(" "),e._m(0)])]),e._v(" "),s("tbody",e._l(e.records,(function(t,r){return s("BatchSetting",{key:r,attrs:{record:t,settingNames:e.settingNames},on:{"run-job":e.runJob,"edit-record":e.editRecord,"delete-record":e.confirmDeleteRecord}})})),1)])]),e._v(" "),e.isConfirmVisible?s("Modal",{attrs:{title:e.confirm.title},on:{close:e.confirm.cancel}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("div",{staticClass:"slds-grid slds-gutters slds-p-around_medium"},[e._v("\n                "+e._s(e.confirm.message)+"\n            ")])]),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"slds-button slds-button_neutral",on:{click:e.confirm.cancel}},[e._v("\n                "+e._s(e.Labels.ArcGIS_Cancel)+"\n            ")]),e._v(" "),s("button",{staticClass:"slds-button slds-button_brand",on:{click:e.confirm.ok}},[e._v("\n                "+e._s(e.confirm.button)+"\n            ")])])]):e._e()],1)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("th",{attrs:{scope:"col"}},[t("div",{staticClass:"slds-truncate"})])}],!1,null,"1117d0e3",null).exports,{MASystem:R}=window,G={components:{Tabs:a.mQ,Tab:a.OK,ArcGISObjects:A,BatchSettings:C},data:()=>({Labels:R.Labels}),methods:{getTabId:()=>(0,r.x$)(),refresh(){this.$bus.$emit("refresh")},handleRemoteActionError(e,t){console.log("TODO: handleRemoteActionError",t)}}},N=(0,c.Z)(G,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Tabs",{staticClass:"slds-m-bottom_medium"},[s("Tab",{staticClass:"slds-m-around_medium",attrs:{id:e.getTabId(),title:e.Labels.ArcGIS_ArcGISObject}},[s("ArcGISObjects",{on:{refresh:e.refresh}})],1),e._v(" "),s("Tab",{staticClass:"slds-m-around_medium",attrs:{id:e.getTabId(),title:e.Labels.MA_Batch_Settings}},[s("BatchSettings")],1)],1)],1)}),[],!1,null,null,null).exports}}]);