<apex:page docType="html-5.0" showheader="false" sidebar="false" standardStyleSheets="false" controller="sma.MapAnything" action="{!StartUpAction}" extensions="sma.MARemoteFunctions,sma.MAAdminAJAXResources">
    <apex:includeLightning />
    <head>
        <style>
            /* Fix SF Styles */
            h1, h2, h3, h4, h5, h6 {
                margin : 0;
            }

            @media only screen and (max-width: 768px) {
                .slds-scope .slds-modal-fullscreen-phone .slds-modal__container {
                    padding: 0;
                    margin: 0 auto;
                    border-radius: 0;
                }
                .slds-scope .slds-modal-fullscreen-phone .slds-modal__container .slds-modal__header {
                    border-radius: 0;
                }
                .slds-scope .slds-modal-fullscreen-phone .slds-modal__container .slds-modal__header h2 {
                    font-size: 18px;
                    font-weight: 400;
                }
                .slds-scope .slds-modal-fullscreen-phone .slds-modal__container .slds-modal__header .slds-modal__close {
                    top: 11px;
                    right: 11px;
                    color: #706e6b;
                    font-size: 20px;
                }
                .slds-scope .slds-modal-fullscreen-phone .slds-modal__container .slds-modal__content {
                    flex-grow: 1;
                    background-color: #fff;
                }
                .slds-scope .slds-modal-fullscreen-phone .slds-modal__container .slds-modal__footer {
                    border-radius: 0;
                }
            }
            
        </style>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!--<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, target-densityDpi=device-dpi" />-->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <title>MapAnything Salesforce1 Mobile</title>

        <!--<apex:stylesheet value="{!URLFOR($Resource.MAPhone, 's1Mobile/css/ma2-style.css')}"/>-->
        <apex:stylesheet value="{!URLFOR($Resource.sma__MAPhone, 's1Mobile/css/test.css')}"/>
        <apex:stylesheet value="{!URLFOR($Resource.sma__MAPhone, '/s1Mobile/styles.css')}"/>

        <!-- Lightning Design System 2.3.0 -->
        <link type="text/css" rel="stylesheet" href="{!URLFOR($Resource.MapAnythingJS, 'styles/css/salesforce-lightning-design-system-2.4.6_scoped.min.css')}" />

        <script
            type='text/javascript'
            src='{!GoogleURL}/maps/api/js?v=3.45&client=gme-cloudbiltinc&libraries=places,visualization,drawing,geometry'
        ></script>

        <!-- Google Maps - Spiderfy (https://github.com/jawj/OverlappingMarkerSpiderfier) -->
        <script type='text/javascript' src="{!URLFOR($Resource.MapAnything, 'js/google/overlappingmarkerspiderfier/oms.min.js')}"></script>

        <!-- Prevent scroll bouncing iOS -->
        <script type="text/javascript" src="{!URLFOR($Resource.MapAnything, 'js/inobounce.min.js')}"></script>

        <!-- async -->
        <script async="true" defer="true" type='text/javascript' src="{!URLFOR($Resource.MapAnything, 'async/async.min.js')}"></script>

        <script type='text/javascript' src="{!URLFOR($Resource.MapAnything, 'jquery/jquery-3.4.1.min.js')}"></script>

        <style>
                /* case 00020872 */
            html body.sfdcBody {
                padding: 0 !important;
            }

            .js-maPopup .js-close-this-slds-modal {
                display: none;
            }

            #layersIndexWrap.half-nest-out {
                z-index: -100;
            }

            #routeEditBottomBar .routeBottomButton {
                text-align: center;
                flex: 1 0 0px;
                line-height: 1;
                font-size: .625rem;
                padding: .5rem 0;
                border-top: 3px solid transparent;
            }

            /* Layers search*/

            #layersSearchWrapper {
                position: absolute;
                width: 100%;
                background: white;
                height: calc(100% - 57px);
            }

            .ma-render-icon[type="markers"] {
                height: 24px;
                width: 24px;
                background-image: url('{!URLFOR($Resource.MapAnything, "malayersv2/img/plot_type_marker.svg")}');
                background-size: 24px;
                border-image-width: 0 !important;
                background-repeat: no-repeat;
                border: 0 !important;
                background-position: center 0;
            }

            .ma-render-icon[type="cluster"] {
                height: 24px;
                width: 24px;
                background-image: url('{!URLFOR($Resource.MapAnything, "malayersv2/img/plot_type_cluster.svg")}');
                background-size: 24px;
                border-image-width: 0 !important;
                background-repeat: no-repeat;
                border: 0 !important;
                background-position: center 0;
            }

            .ma-render-icon[type="scatter"] {
                height: 24px;
                width: 24px;
                background-image: url('{!URLFOR($Resource.MapAnything, "malayersv2/img/plot_type_scatter.svg")}');
                background-size: 24px;
                border-image-width: 0 !important;
                background-repeat: no-repeat;
                border: 0 !important;
                background-position: center 0;
            }

            .ma-render-icon[type="heatmap"] {
                height: 24px;
                width: 24px;
                background-image: url('{!URLFOR($Resource.MapAnything, "malayersv2/img/plot_type_heatmap.png")}');
                background-size: 24px;
                border-image-width: 0 !important;
                background-repeat: no-repeat;
                border: 0 !important;
                background-position: center 0;
            }

            /* live marker */

            .liveColorOption {
                display: inline-block;
                height: 30px;
                width: 30px;
                cursor: pointer;
                border: 1px solid transparent;
                position: relative;
                margin-right: 10px;
                margin-top: 10px;
                padding-bottom: 0;
                text-align: center;
                vertical-align: top;
            }

            /* live-device marker */

            .ma-icon[type="live-device"] {
                height: 100%;
                width: 100%;
                background-image: url('{!URLFOR($Resource.MapAnything, "malayersv2/img/folder_device.svg")}');
                background-size: auto;
                border-image-width: 0 !important;
                background-repeat: no-repeat;
                border: 0 !important;
                background-position: center 0;
            }

            /* geofence marker */

            .ma-icon[type="geofence"] {
                height: 100%;
                width: 100%;
                background-image: url('{!URLFOR($Resource.MapAnything, "malayersv2/img/folder_geofence.svg")}');
                background-size: auto;
                border-image-width: 0 !important;
                background-repeat: no-repeat;
                border: 0 !important;
                background-position: center 0;
            }


            #queryPlottingOptions .queryselectWrapper {
                font-size: 16px;
                margin: 0px;
            }

            #queryPlottingOptions .ma-icon {
                margin-right: 10px;
                font-size: 26px;
            }

            .full-width {
                width: 100%;
            }

            #queryPlottingOptions .ma-checkbox-label {
                margin: 0 15px;
            }

            #queryPlottingOptions .displayLabel {
                vertical-align: top;
                line-height: 28px;
                margin-left: 15px;
            }

            #queryPlottingOptions .ma-checkbox-faux {
                margin-top: 4px;
            }
            .tracking-history-content .liveColorInput {
                display: none;
            }

            .tracking-history-content .cor1 {
                background-color: #4986E7;
                border-color: #4986E7;
            }

            .tracking-history-content .cor2 {
                background-color: #000000;
                border-color: #000000;
            }

            .tracking-history-content .cor3 {
                background-color: #A4BDFC;
                border-color: #A4BDFC;
            }

            .tracking-history-content .cor4 {
                background-color: #46D6DB;
                border-color: #46D6DB;
            }

            .tracking-history-content .cor5 {
                background-color: #7AE7BF;
                border-color: #7AE7BF;
            }

            .tracking-history-content .cor6 {
                background-color: #51B749;
                border-color: #51B749;
            }

            .tracking-history-content .cor7 {
                background-color: #FBD75B;
                border-color: #FBD75B;
            }

            .tracking-history-content .cor8 {
                background-color: #FFB878;
                border-color: #FFB878;
            }

            .route-month {
                height: calc(100% - 60px);
            }

            .tracking-history-content .cor9 {
                background-color: #FF887C;
                border-color: #FF887C;
            }

            .tracking-history-content .cor10 {
                background-color: #DC2127;
                border-color: #DC2127;
            }

            .tracking-history-content .cor11 {
                background-color: #DBADFF;
                border-color: #DBADFF;
            }

            .tracking-history-content .cor12 {
                background-color: #E1E1E1;
                border-color: #E1E1E1;
            }

            .BadGeocodeForWaypoint {
                background: #ffc8c8;
            }

            .GoodGeocodeForWaypoint {
                background-color: #D4F8D4;
            }

            /* Click 2 Create Form */

            .fieldInput select[multiple="multiple"] {
                overflow: scroll;
                -webkit-overflow-scrolling: touch;
                height: 130px;
                width: 165px;
            }

            .customDisWrapper {
                /*min-width : 300px;*/
            }

            .customDisWrapper .fieldInput input.Subject {
                width: 100%!important;
            }

            .multiSelectPicklistCell {
                min-width: 40px;
            }

            #ListActionSheet .ma-action-sheet-item.header {
                background-color: #0070d2;
                color: white;
            }

            .fieldInput input,
            .dateInput input {
                width: 95% !important;
                padding: 0 5px;
                line-height: 30px;
                border: 1px solid #dddbda !important;
                border-radius: 3px;
                display: block !important;
            }

            .fieldInput input[type="checkbox"] {
                height: 20px;
            }

            .fieldInput select {
                width: 95%;
                padding: 8px;
                line-height: 30px;
                border: 1px solid silver;
                border-radius: 3px;
                margin-bottom: 5px;
                display: block;
            }

            .fieldInput textarea {
                width: 95%;
                padding: 0 5px;
                line-height: 30px;
                border: 1px solid silver;
                border-radius: 3px;
                display: block;
            }

            .fieldSetTable td {
                border-top: 1px solid #dddbda;
            }

            .fieldSetTable {
                /*border-top: 1px solid #dddbda;*/
                /*border-bottom: 1px solid #dddbda;*/
                /*text-align: left;*/
                /*border-collapse: collapse;*/
                /*border-spacing: 0;*/
                /*width: 100%;*/
            }

            .ma-modal-content {
                overflow-x: scroll;
                overflow-y: scroll !important;
                -webkit-overflow-scrolling: touch;
            }

            .maPopup-container {
                position: fixed;
            }

            #layersIndividualWrap .layersIndividual[type="datalayer"] .plotOnLoadWrapper {
                display: none;
            }

            .link {
                color: #0070d2;
            }

            .ma-folder-item.active {
                background: #f1f1f1;
            }

            #folder-contents {
                margin-top: 0px;
            }

            #toast-container .toast {
                padding: 15px 15px 15px 55px;
            }

            #toast-container .ma-toast-loading {
                background-color: #16325c;
                background-image: url('{!URLFOR($Resource.MAPhone, "/s1Mobile/images/spinners/slds_spinner_inverse.gif")}');
                background-size: 30px 30px;
            }

            #toast-container .toast-warning {
                background-color: #e3924a;
            }

            #toast-container .toast-error {
                background-color: #d4504c;
            }

            #toast-container .toast-success {
                background-color: #003c4c;
            }

            #tabLayersRecent .emptyList {
                padding: 10px 30px;
                width: 100%;
                text-align: center;
                font-size: 16px;
                color: #a7a7a7;
            }

            #createrecord-fieldset-errors,
            .createrecordDataLayer2-fieldset-errors,
            .createrecord2-fieldset-errors {
                padding: 5px 15px;
                border: 1px solid #F00;
                background-color: rgba(255, 0, 0, 0.05);
                color: #DF5555;
                font-weight: bold;
                font-size: 10px;
            }

            /* Tooltip Actions */

            .layout-tooltip {
                width: 400px;
                min-height: 60px;
            }

            .layout-tooltip .buttoncolumn {
                float: left;
                margin: 0 10px 0 0;
            }

            .layout-tooltip .buttonset-section {
                overflow: hidden;
            }

            .layout-tooltip .actionbutton {
                position: relative;
                display: block;
                background-color: #F5F5F5;
                background: #F8F8F8;
                background: url('images/white-button-bg.png');
                background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#FFF), to(#F5F5F5));
                background: -webkit-linear-gradient(top, #FFF, #F5F5F5);
                background: -moz-linear-gradient(center top, #FFF 20%, #F5F5F5 100%) repeat scroll 0 0 rgba(0, 0, 0, 0);
                background: -ms-linear-gradient(top, #FFF, #F5F5F5);
                background: -o-linear-gradient(top, #FFF, #F5F5F5);
                background-repeat: repeat-x;
                border: medium none;
                border-radius: 3px 3px 3px 3px;
                border: 1px solid #BBB;
                box-shadow: 0 1px 0 #FFF inset, 0 0 4px rgba(255, 255, 255, 0.5) inset, 0 1px 2px rgba(0, 0, 0, 0.1);
                color: #000;
                font-family: "Helvetica Neue", Helvetica, arial, sans-serif;
                font-size: 10px;
                font-weight: normal;
                line-height: auto;
                text-align: center;
                margin: 5px 0;
                padding: 4px 9px;
                height: auto;
                width: 100px;
                cursor: pointer;
            }

            .layout-tooltip .actionbutton:hover {
                background: #FFF;
                box-shadow: 0 1px 0 rgba(255, 255, 255, 0.3) inset, 0 0 4px rgba(255, 255, 255, 0.2) inset, 0 1px 2px rgba(0, 0, 0, 0.2);
                color: #666;
                text-decoration: none;
            }

            .layout-tooltip .actionbutton.disabled {
                display: none;
            }

            .layout-tooltip .actionbutton.disabled-button {
                color: #B0B0B0;
                border: 1px solid #ccc;
                pointer-events: none;
            }

            input.error, select.error {
                border: 1px solid #E48585 !important;
                box-shadow: 0 0 0 2px rgba(255, 0, 0, 0.6) !important;
                transition: box-shadow 0.2s !important;
            }

            .ma-breadcrumb-text {
                /*width: 375px;*/
            }

            /*#layersFolders {
                    height: calc(100% - 99px);
                    overflow-y: scroll;
                    -webkit-overflow-scrolling: touch;
                }*/

            #markerTooltipTopBar .recordName {
                /*max-width: 295px;*/
            }
            .view-panel.half-bottom-phone.in.full-height {
                max-height: 50%;
            }

            .ma-action-sheet {
                max-height: 300px;
                overflow: scroll !important;
                /*-webkit-overflow-scrolling: touch;*/
            }

            #routesWrap .waypoint-row .time-label {
                flex: 0 0 50px;
            }

            #routesWrap.isTimeBased .waypoint-row .time-label {
                flex: 0 0 133px;
            }

            #routesWrap.isTimeBased .waypoint-row .time-label-text {
                display: block;
            }

            #routesWrap .route-drive-row {
                margin-left: 25px;
            }

            #addtocampaign-select-grid-wrapper {
                margin-top: 15px;
                height: calc(100% - 120px);
                margin-bottom: 10px;
                overflow: scroll !important;
                -webkit-overflow-scrolling: touch;
            }

            .legend-row.empty,
            .legend-item.empty {
                display: none;
            }

            #shape-popup-accordion .legend-row td {
                font-size: 14px;
                white-space: normal;
                width: 100%;
            }

            #shape-popup-accordion .accordianIcon {
                margin-right: 10px;
                font-size: 17px;
                color: #a7b8d1;
            }

            #shape-popup-accordion .shape-cluster-popup-message-firstXXmarkers {
                font-size: 12px;
                text-align: center;
                color: #a7b8d1;
                background-color: #d9edf7;
                border: 1px solid #bce8f1;
                padding: 5px;
            }

            #clusterWrap .panel-title-row {
                padding-left: 16px;
                -webkit-transition: 0.22s padding;
                -moz-transition: 0.22s padding;
                -ms-transition: 0.22s padding;
                -o-transition: 0.22s padding;
                transition: 0.22s padding;
            }

            #clusterWrap .ma-list-item,
            #clusterWrap .ma-table td {
                font-size: 14px;
            }

            #clusterWrap .shape-cluster-popup-header-count {
                font-size: 16px;
            }

            .inline {
                display: inline-block;
            }


            /* FASTCLICK FIX for IOS */

            label>* {
                pointer-events: none;
            }

            .select2-selection__rendered {
                pointer-events: none;
            }

            .select2-results__option.needsclick {
                font-size: 16px;
            }

            .select2-container {
                min-width: 100%;
            }

            .select2-container .select2-dropdown {
                z-index: 4005;
            }

            .ma-form-control.icon-right .ma-icon.icon-right {
                z-index: 1;
            }

            /******** Chatter Fix ****************/

            #markerInfoTab2.chatterContent {
                height: 100%;
                overflow: hidden !important;
                -webkit-overflow-scrolling: inherit;
            }

            @media screen and (max-width: 769px) {
                .toast-bottom-right {
                    bottom: 65px !important;
                }

                .js-maPopup .slds-modal__container {
                    width: auto !important;
                }

                .ma-breadcrumb-text {
                    width: 100%;
                    max-width: 100%;
                }
                /* saved layers scrolling fixes */
                /*#layersFolders  {
                        height: calc(100% - 160px);
                    }*/
                .ma-folder-content-wrap {
                    overflow-y: auto;
                }
                #markerInfoTab2.chatterContent {
                    height: 100% !important;
                }
                #markerTooltipTopBar .recordName {
                    /*max-width: 70%;*/
                }
                .ma-action-sheet {
                    max-height: 70%;
                }
                /* make popups full screen */
                /*.ma-modal-container {
                        margin: 0;
                        padding: 10px;
                        height: 100%;
                    }*/
            }

            #layersIndividualBody .legend-wrap .legend-count {
                display: block;
            }

            /*legend select box*/

            #legendLayerSelector .selectOption .ma-icon,
            #listLayerSelector .selectOption .ma-icon,
            #listLayerSelectorTop .selectOption .ma-icon {
                display: none;
            }

            #legendLayerSelector .selectOption.rowSelected .ma-icon,
            #listLayerSelector .selectOption.rowSelected .ma-icon,
            #listLayerSelectorTop .selectOption.rowSelected .ma-icon {
                display: block;
            }

            #toast-container {
                z-index: 1000;
            }

            #toast-container .toast {
                opacity: 0.95;
            }

            .MAbutton.button-white {
                background-color: #fff;
                color: #0070d2;
            }

            .hidden {
                display: none !important;
            }

            #listScrollingBodyFull {
                overflow-y: auto;
            }

            #listScrollingBody,
            #legendBodyInner .legend-body-scrolling-body {
                overflow-y: auto;
            }

            #listScrollingBodyFull .legendMarkerImg {
                max-height: 25px;
            }

            #listScrollingBodyFull {
                z-index: -1;
            }

            #listWrap.sidebar-panel-full-width #listScrollingBodyFull {
                z-index: 1;
            }

            .clearFilters {
                color: #d4504c;
            }

            .clearFilters:hover,
            .clearFilters:focus {
                color: #bf322e;
            }

            #createDataLayerRecordV2 .maPopup-footer {
                min-height: 60px;
            }

            /*************************************
                * jQuery UI Slider defaults
                ***************************************/

            .ui-slider {
                position: relative;
                text-align: left;
            }

            .ui-slider .ui-slider-handle {
                position: absolute;
                z-index: 2;
                width: 1.2em;
                height: 1.2em;
                cursor: default;
            }

            .ui-slider .ui-slider-range {
                position: absolute;
                z-index: 1;
                font-size: .7em;
                display: block;
                border: 0;
                background-position: 0 0;
            }

            .ui-slider-horizontal {
                height: .8em;
            }

            .ui-slider-horizontal .ui-slider-handle {
                top: -.3em;
                margin-left: -.6em;
            }

            .ui-slider-horizontal .ui-slider-range {
                top: 0;
                height: 100%;
            }

            .ui-slider-horizontal .ui-slider-range-min {
                left: 0;
            }

            .ui-slider-horizontal .ui-slider-range-max {
                right: 0;
            }

            .ui-slider-vertical {
                width: .8em;
                height: 100px;
            }

            .ui-slider-vertical .ui-slider-handle {
                left: -.3em;
                margin-left: 0;
                margin-bottom: -.6em;
            }

            .ui-slider-vertical .ui-slider-range {
                left: 0;
                width: 100%;
            }

            .ui-slider-vertical .ui-slider-range-min {
                bottom: 0;
            }

            .ui-slider-vertical .ui-slider-range-max {
                top: 0;
            }

            /***************************************
                *   Modifications to Derek Style
                *****************************************/


            .ma-dropdown-list li>a {
                white-space: normal;
            }

            .ma-top-bar-title--left {
                max-width: calc(100% - 100px);
            }

            .ma-top-bar-title--left>a:hover,
            .ma-top-bar-title--left>a:active,
            .ma-top-bar-title--left>a:focus {
                text-decoration: underline;
            }

            .ma-top-bar-title--left .ma-top-bar-subtext {
                color: #3e3e3c;
            }

            /*.ma-folder-item .ma-item-name {
                    max-width: calc(100% - 135px);
                }*/

            label.ma-checkbox {
                min-height: 20px;
            }

            .center-text {
                text-align: center;
            }

            .nav-drawer-item {
                font-size: 16px !important;
            }

            .moreInfoLine {
                margin-bottom: 2rem;
                margin-left: 16.666667%;
                width: 66.666667%;
            }

            hr {
                width: 100%;
                height: 1px;
                border: 0;
                margin-left: auto;
                margin-right: auto;
            }

            .linear-grad-blue {
                background: linear-gradient(to right, rgba(48, 131, 211, 0.25), #3083d3);
            }

            .ma-slider {
                width: 100%;
                padding: 0px;
                background: #e0e5ee;
                margin-top: 5px;
                height: 20px;
                border-radius: 25px;
            }

            .ma-slider .ui-slider-range {
                background: #3083d3;
                padding: 0px !important;
                border-radius: 25px;
            }

            .ma-slider .ui-slider-handle {
                background: #a7b8d1;
                height: 28px;
                width: 28px;
                border-radius: 5px;
            }

            .ma-form-control .ma-icon.inset-icon--right {
                position: absolute;
                top: 13px;
                right: 11px;
                margin: 0;
                pointer-events: none;
                cursor: pointer;
            }

            .ma-table.ma-table--sortable th.sortable-column.headerSortDown div.sortable-column-inner:after {
                right: 10px;
                font-family: 'ma-icons-2';
                content: "\6e";
                font-size: 16px;
                width: 16px;
                height: 16px;
                line-height: 1;
                position: absolute;
                text-transform: none !important;
            }

            .ma-table.ma-table--sortable th.sortable-column.headerSortUp div.sortable-column-inner:after {
                right: 10px;
                font-family: 'ma-icons-2';
                content: "\6f";
                font-size: 16px;
                width: 16px;
                height: 16px;
                line-height: 1;
                position: absolute;
                text-transform: none !important;
            }

            .ma-button--sm {
                height: 26px;
                line-height: 26px;
                font-size: 12px;
                padding: 0 12px;
            }

            .ma-list-item .float-right,
            .ma-list-item .pull-right,
            .ma-list-header .float-right,
            .ma-list-header .pull-right {
                float: none;
                margin-left: auto;
            }

            .ma-list-header .ma-list-item-name {
                font-weight: 700;
            }

            .ma-list-item-name {
                font-size: 1rem;
                line-height: 1.25rem;
            }

            .ma-list.ma-list-border .ma-list-item {
                border-bottom: 1px solid #dddbda;
            }

            .ma-list .ma-list-item.active,
            .ma-list .ma-list-item.Active {
                background-color: #f3f2f2;
                border-color: #dddbda;
                cursor: pointer;
            }

            .ma-list-header {
                display: -ms-flexbox;
                display: -webkit-flex;
                display: flex;
                -ms-flex-align: center;
                -webkit-align-items: center;
                -webkit-box-align: center;
                align-items: center;
                margin: 0;
                width: 100%;
                padding: .75rem .5rem;
                background-color: #ffffff;
                border-bottom: 2px solid #dddbda;
            }

            .ma-list .ma-list-item {
                display: -webkit-box;
                display: -moz-box;
                display: -ms-flexbox;
                display: -webkit-flex;
                display: flex;
                margin: 0;
                width: 100%;
                padding: .5rem;
                background-color: #ffffff;
            }

            .ma-list-icon-left {
                margin-right: .75rem;
                -webkit-align-self: flex-start;
                align-self: flex-start;
            }

            #routesWrap.isTimeBased .route-drive-row {
                margin-left: 25px;
            }

            #scheduleBody {
                z-index: -1;
            }

            #scheduleBody .routeInfo.route-drive-row {
                padding-left: 12px;
            }

            .ma-tab-link-group .ma-tab-link {
                width: 33%;
                font-size: .775rem;
            }

            #layersTopBarTabIndicator.pos-center {
                transform: translate(100%, 0);
            }

            /*-----------------------
                TABLE
                -----------------------*/

            /* .ma-table {
                border-top: 1px solid #dddbda;
                border-bottom: 1px solid #dddbda;
                text-align: left;
                border-collapse: collapse;
                border-spacing: 0;
            }

            .ma-table td,
            .ma-table th {
                padding: .5rem 2rem .5rem .5rem;
                white-space: nowrap;
                position: relative;
                border-top: 1px solid #dddbda;
            }

            .ma-table td:last-child {
                width: 100%;
            }

            .ma-table.ma-table--fullwidth {
                width: 100%;
            }

            .ma-table.ma-table--fullwidth td:last-child {
                width: auto;
            }

            .ma-table-header {
                background-color: #f3f2f2;
                border-top-color: #dddbda;
                border-bottom: 2px solid #dddbda;
            }

            .ma-table-header tr td {
                width: 50px;
            }

            .ma-table-footer {
                background-color: #f3f2f2;
                border-bottom-color: #dddbda;
                border-top: 2px solid #dddbda;
            }

            .ma-table th {
                text-transform: uppercase;
                font-weight: 700;
                font-size: .75rem;
            }

            .ma-cell-shrink {
                width: 1%;
            }

            .ma-table.ma-table-hoverable tbody tr:hover>td {
                background-color: #f3f2f2;
            }

            .ma-table.ma-table-border-horizontal {
                border-left: 1px solid #dddbda;
                border-right: 1px solid #dddbda;
            }

            .ma-table.ma-table-pad-left thead>tr>th:first-child,
            .ma-table.ma-table-pad-left tbody>tr>td:first-child {
                padding-left: 1.5rem;
            }

            .ma-table td span.disabled {
                pointer-events: none;
                opacity: 0.5;
            } */

            #sortAway th {
                cursor: pointer;
            }

            #sortAway th.headerSortUp {
                color: #ffffff;
                background-color: #0070d2;
            }

            #sortAway th.headerSortDown {
                color: #ffffff;
                background-color: #0070d2;
            }

            #sortExample th,
            #combinationTable th {
                cursor: pointer;
            }

            #sortExample th.headerSortUp,
            #combinationTable th.headerSortUp {
                color: #ffffff;
                background-color: #a7b8d1;
            }

            #sortExample th.headerSortDown,
            #combinationTable th.headerSortDown {
                color: #ffffff;
                background-color: #333538;
            }

            .ma-table th.header {
                padding-right: 10px;
                position: relative;
            }

            .ma-table th.header.headerSortDown {
                padding-right: 10px;
                position: relative;
            }

            .ma-table th.header.headerSortUp {
                padding-right: 10px;
                position: relative;
            }

            .ma-table.ma-table-fixed {
                table-layout: fixed;
                width: 100%;
                white-space: nowrap;
            }

            .ma-table.ma-table-fixed-75 {
                table-layout: fixed;
                width: 75%;
                white-space: nowrap;
            }

            .ma-table.ma-table-fixed-50 {
                table-layout: fixed;
                width: 50%;
                white-space: nowrap;
            }

            /* disabled toggle css */

            .ma-toggle-label.disabled:after {
                background-color: #dddbda;
            }

            .ma-modal .ma-modal-close .ma-icon {
                font-size: 20px;
                color: white;
            }

            /** Select2 Mods **/

            .ma-form-control.icon-left .select2-selection__rendered {
                padding-left: 40px;
            }

            .select2-results__options {
                overflow: scroll;
                -webkit-overflow-scrolling: touch;
            }

            /** Date Picker **/

            .ui-datepicker-header {
                width: 100%;
                max-width: 400px;
                margin: 0 auto;
                padding: 1rem .25rem !important;
                background: transparent !important;
                border: 0 !important;
            }

            .ui-datepicker-calendar th span {
                font-weight: normal;
            }

            #ui-datepicker-div {
                
                background-color: #ffffff;
                display: none;
                -webkit-border-radius: 0.25rem;
                -moz-border-radius: 0.25rem;
                -ms-border-radius: 0.25rem;
                -o-border-radius: 0.25rem;
                border-radius: 0.25rem;
                border: 1px solid #dddbda;
                z-index: 9002 !important;
                box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.16);
                max-width: 375px;
                margin: 0% auto;
                left: 0!important;
                right: 0;
                
            }
            @media screen and (max-width: 425px) {
                    .ui-datepicker-calendar thead tr th {
                    font-size: 9px;
                    }
            }
            table.ui-datepicker-calendar {
                width: 100%;
                max-width: 400px;
                padding: .25rem;
                margin: 0 auto !important;
            }

            #ui-datepicker-div td {
                text-align: center;
                vertical-align: middle;
                padding: .25rem;
                text-align: center;
                font-size: .75rem;
            }

            #ui-datepicker-div td a {
                color: #16325c;
                text-decoration: none;
                font-weight: normal;
                display: block;
                background: transparent;
                border: 0;
                text-align: center;
                width: 2rem;
                height: 2rem;
                display: block;
                position: relative;
                min-width: 2rem;
                line-height: 2rem;
                -webkit-border-radius: 50%;
                -moz-border-radius: 50%;
                -ms-border-radius: 50%;
                -o-border-radius: 50%;
                border-radius: 50%;
                margin: auto;
            }

            #ui-datepicker-div td.ui-datepicker-today a {
                background-color: #f3f2f2;
                -webkit-border-radius: 35px;
                -moz-border-radius: 35px;
                -ms-border-radius: 35px;
                -o-border-radius: 35px;
                border-radius: 35px;
            }

            #ui-datepicker-div td.ui-datepicker-current-day a {
                background-color: #16325c;
                color: #ffffff;
                -webkit-border-radius: 35px;
                -moz-border-radius: 35px;
                -ms-border-radius: 35px;
                -o-border-radius: 35px;
                border-radius: 35px;
            }

            /************* jQuery UI fixes ************************/

            .ui-datepicker-prev,
            .ui-datepicker-next {
                font-size: 24px;
                margin-top: 4px;
                text-align: center;
                color: inherit !important;
            }

            .ui-datepicker-prev:before {
                font-family: "ma-icons-2" !important;
                font-style: normal !important;
                font-weight: normal !important;
                font-variant: normal !important;
                text-transform: none !important;
                speak: none;
                line-height: 1;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                content: "X";
            }

            .ui-datepicker-next:before {
                font-family: "ma-icons-2" !important;
                font-style: normal !important;
                font-weight: normal !important;
                font-variant: normal !important;
                text-transform: none !important;
                speak: none;
                line-height: 1;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                content: "Y";
            }

            .ui-datepicker-prev {
                width: 50px !important;
                display: block;
                float: left;
                cursor: pointer;
            }

            .ui-datepicker-next {
                width: 50px !important;
                display: block;
                float: right;
                cursor: pointer;
                opacity: 0.8;
            }

            .ui-datepicker-prev:hover,
            .ui-datepicker-next:hover {
                opacity: 1;
            }

            .ui-datepicker-prev span,
            .ui-datepicker-next span {
                display: none !important;
                background-image: none !important;
            }

            .ui-datepicker-title {
                padding-top: 9px;
                font-size: 1rem;
                line-height: 1 !important;
                text-align: center;
                margin: 0 !important;
            }

            /* remove margin from li (Salesforce) */

            .ma-dropdown-list li {
                margin: 0px;
            }

            /* fix loading (sF) */

            .loading {
                border: inherit;
                color: inherit;
                padding: inherit;
                font-size: inherit;
                text-align: inherit;
            }

            /* old loading css */

            .MA2-loading-mask {
                height: 100%;
                width: 100%;
                position: absolute;
                top: 0px;
                left: 0px;
                background: rgba(255, 255, 255, 0.5);
                z-index: 10;
            }

            .ma-list-item {
                color: #16325c;
                font-size: 1rem;
                line-height: 1.25rem;
                display: -webkit-box;
                display: -moz-box;
                display: -ms-flexbox;
                display: -webkit-flex;
                display: flex;
                margin: 0;
                width: 100%;
                padding: .5rem;
                background-color: #ffffff;
            }

            .ma-list-header {
                display: -ms-flexbox;
                display: -webkit-flex;
                display: flex;
                -ms-flex-align: center;
                -webkit-align-items: center;
                -webkit-box-align: center;
                align-items: center;
                margin: 0;
                width: 100%;
                padding: .75rem .5rem;
                background-color: #ffffff;
                border-bottom: 2px solid #dddbda;
            }

            .loadingText {
                position: absolute;
                top: 50%;
                left: 50%;
                width: 300px;
                z-index: 11;
                margin-left: -150px;
                margin-top: -12px;
                text-align: center;
                font-size: 17px;
            }

            .MA2-loader {
                background-image: url(/resource/1470364544000/sma__MAPhone/s1Mobile/images/spinners/slds_spinner_brand.gif);
                background-size: 30px 30px;
                height: 30px;
                width: 30px;
                display: inline-block;
                margin-right: 5px;
                position: relative;
                top: 10px;
            }


            /* action button fix */

            .action-bar-button {
                background: none;
                border: none;
            }

            /* Just for me to see that this is working... need to discuss styling  */

            #layersIndividualWrap .legend-row.sectionRow,
            #legendBodyInner .legend-item.sectionRow {
                padding-left: 15px;
            }

            /* hiding this for now until I have time to deal with it */

            #legendBodyInner .legend-body-fixed-header {
                height: 54px;
            }

            #legendFilterRow {
                display: none;
            }

            /* jquery ui autocomplete don't want to include all the ui nonsense need to discuss*/

            .ui-autocomplete {
                z-index: 4005;
                background: white;
                max-width: 300px;
                list-style: none;
                padding: 0px;
                font-size: 14px;
                border: 1px solid #8c8c8c;
            }

            .ui-autocomplete .ui-menu-item {
                padding: 10px;
                margin-left: 0px;
            }

            .ui-autocomplete .ui-menu-item:hover {
                background: #efeeee;
                cursor: pointer;
            }


            /* Intermediate checkbox testing */

            .ma-checkbox input.intermediate~.ma-checkbox-faux {
                background-color: #0070d2;
            }

            .ma-checkbox input.intermediate~.ma-checkbox-faux:after {
                display: block;
                content: "\e04c";
                height: .875rem;
                width: .875rem;
                text-align: center;
                position: absolute;
                top: 2px;
                left: 2px;
                color: #ffffff;
                font-size: .875rem;
                line-height: 0;
                font-family: "ma-icons-2" !important;
                font-style: normal !important;
                font-weight: normal !important;
                font-variant: normal !important;
                text-transform: none !important;
                speak: none;
                line-height: 1;
                -moz-osx-font-smoothing: grayscale;
            }

            /* Derek changes on Oct 21, 2016 */

            .margin-16-0-0 {
                margin: 16px 0 0;
            }

            .pad-0-16-8 {
                padding: 0 16px 8px;
            }

            .advanced-settings-header {
                border-bottom: 1px solid #dddbda;
            }

            .inverted-color .ma-input-label {
                color: #dddbda;
            }

            .inverted-color .ma-form-control .ma-icon {
                color: #0070d2;
            }

            .inverted-color .ma-top-bar-button--fullsize {
                color: #0070d2;
            }

            .inverted-color .ma-section-title {
                background-color: transparent;
                color: #3e3e3c;
            }

            .advanced-settings-header-text {
                font-size: 20px;
                line-height: 1.9;
                padding: 16px;
                text-align: center;
            }

            #advancedSettingsWrap.in {
                z-index: 2100;
                visibility: visible;
                -webkit-transition: 0s visibility 0s, 0s z-index 0s, 0.25s transform 0s;
                -moz-transition: 0s visibility 0s, 0s z-index 0s, 0.25s transform 0s;
                -ms-transition: 0s visibility 0s, 0s z-index 0s, 0.25s transform 0s;
                -o-transition: 0s visibility 0s, 0s z-index 0s, 0.25s transform 0s;
                transition: 0s visibility 0s, 0s z-index 0s, 0.25s transform 0s;
            }

            #advancedSettingsWrap {
                background-color: #fff;
                z-index: -1;
                visibility: hidden;
                opacity: 1;
                -webkit-transition: 0s visibility 0.25s, 0s z-index 0.25s, 0.25s transform 0s;
                -moz-transition: 0s visibility 0.25s, 0s z-index 0.25s, 0.25s transform 0s;
                -ms-transition: 0s visibility 0.25s, 0s z-index 0.25s, 0.25s transform 0s;
                -o-transition: 0s visibility 0.25s, 0s z-index 0.25s, 0.25s transform 0s;
                transition: 0s visibility 0.25s, 0s z-index 0.25s, 0.25s transform 0s;
                height: 100%;
                overflow: hidden;
            }

            .nav-drawer-item .ma-toggle-label {
                margin-right: 6px;
            }

            .ma-button.icon-alone {
                color: #706e6b;
                padding: 0 12px;
                text-align: center;
                height: 42px;
            }

            .ma-button.icon-alone:hover,
            .ma-button.icon-alone:active {
                color: #005fb2;
            }

            .ma-button.icon-alone .ma-icon {
                display: block;
                margin: 0 !important;
                padding: 0;
                font-size: 16px;
                line-height: 1;
                width: 16px;
                height: 16px;
            }

            #navDrawerWrap #navDrawerMenu .ma-icon-close.hide-nav-drawer {
                font-size: 21px;
                top: 0px;
                right: 0;
            }

            #navDrawerWrap .ma-logo {
                max-width: 255px;
                margin: 10px 0 16px 8px;
            }

            #navDrawerWrap .ma-divider {
                margin-left: 28px;
                max-width: calc(100% - 28px);
            }

            #navDrawerWrap .nav-drawer-item {
                max-width: 100%;
                padding: 12px 0 12px 16px;
                margin-bottom: 4px;
            }

            #navDrawerWrap .nav-drawer-item.nav-drawer-item-secondary {
                max-width: 100%;
                padding: 10px 0 10px 16px;
                font-size: 14px !important;
                margin-bottom: 0;
            }

            #navDrawerWrap .nav-drawer-item .nav-drawer-item-subtext {
                color: #3e3e3c;
                font-size: 12px;
                display: block;
                margin-top: 6px;
                margin-bottom: 6px;
                line-height: 1.3;
            }

            #navDrawerWrap .nav-drawer-item.nav-drawer-item-secondary .nav-drawer-item-subtext {
                margin: 0;
            }

            #navDrawerWrap .nav-drawer-inner {
                max-width: 100%;
            }

            #navDrawerWrap #navDrawerMenu {
                padding: 0;
            }

            #navDrawerWrap .nav-drawer-spacer {
                padding: 16px 12px;
            }

            .action-bar-wrap .action-bar-button.open-marker-action-sheet {
                min-width: 0;
                margin-left: auto;
                flex: 0 0 auto;
                padding-left: 10px;
            }
            
            .action-bar-wrap {
                background-color: #0070d2;
            }

            #layersTopBarTabIndicator {
                background-color: #fff;
            }

            #searchTopBar .ma-form-control.icon-right .ma-icon.icon-right.clear-input-button {
                font-size: 16px;
                padding: 8px;
                top: 3px;
                width: 32px;
                height: 32px;
                right: 3px;
            }

            .ma-button.ma-button--blue {
                background-color: #0070d2;
                border-color: #0070d2;
            }

            .ma-button {
                color: #0070d2;
            }

            /* Test text selection bug */

            #bottomBarWrap .ma-bottom-bar-button {
                -webkit-touch-callout: none;
                /* iOS Safari */
                -webkit-user-select: none;
                /* Chrome/Safari/Opera */
                -khtml-user-select: none;
                /* Konqueror */
                -moz-user-select: none;
                /* Firefox */
                -ms-user-select: none;
                /* Internet Explorer/Edge */
                user-select: none;
                -webkit-touch-callout: none;
                /* iOS Safari */
                -webkit-user-select: none;
                /* Chrome/Safari/Opera */
                -khtml-user-select: none;
                /* Konqueror */
                -moz-user-select: none;
                /* Firefox */
                -ms-user-select: none;
                /* Internet Explorer/Edge */
                user-select: none;
            }

            #schedmonthPrevButton {
                float: right;
            }

            #schedmonthNextButton {
                float: left;
            }

            #schedmonthPrevButton span,
            #schedmonthNextButton span {
                line-height: 48px;
            }


            #schedmonthText {
                width: 180px;
            }

            /* Mobile Drive profile style */

            .ma-button.mobile-drive-button {
                padding-right: 0;
            }

            .mobile-drive-button .ma-icon:first-child {
                width: 22px;
                height: 22px;
                display: block;
                line-height: 1;
                float: left;
                margin-top: 5px;
            }

            .mobile-drive-button .ma-icon:first-child:before {
                font-size: 22px;
            }

            .ma-form-control .ma-radio {
                display: block;
            }

            #driveProfilePopup .ma-radio {
                margin: 5px 0;
            }

            #driveProfilePopup .ma-form-control-wrap {
                padding: 16px;
            }

            #driveProfilePopup .ma-custom-drive-dropdown {
                margin-left: 24px;
            }

            #driveProfilePopup .ma-input-label {
                font-size: 16px;
            }

            .ma-radio {
                display: block;
            }

            .ma-radio [type="radio"] {
                width: 1px;
                height: 1px;
                border: 0;
                clip: rect(0 0 0 0);
                margin: -1px;
                overflow: hidden;
                padding: 0;
                position: absolute;
            }

            .ma-radio [type='radio'] + .ma-radio_label .ma-radio_faux {
                margin-right: 0.5rem;
            }

            .ma-radio_label .ma-radio_faux {
                pointer-events: auto;
            }

            .ma-radio .ma-radio_faux {
                width: 1rem;
                height: 1rem;
                display: inline-block;
                position: relative;
                vertical-align: middle;
                border: 1px solid #dddbda;
                border-radius: 50%;
                background: white;
                transition: border 0.1s linear, background-color 0.1s linear;
            }

            .ma-radio [type="radio"]:checked + .ma-radio_label .ma-radio_faux:after {
                width: 0.5rem;
                height: 0.5rem;
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate3d(-50%, -50%, 0);
                border-radius: 50%;
                background: #0070d2;
            }

            .ma-tablet-map-buttons {
                position: fixed;
                bottom: -50px;
                left: 16px;
                -webkit-transition: 0.2s left, 0.2s bottom;
                -moz-transition: 0.2s left, 0.2s bottom;
                -ms-transition: 0.2s left, 0.2s bottom;
                -o-transition: 0.2s left, 0.2s bottom;
                transition: 0.2s left, 0.2s bottom;
            }

            .map-secondary-view-button {
                position: static;
            }

            #mapListButton {
                margin-right: 12px;
            }

            #maMasterWrap #mapListButton .ma-icon {
                margin-right: 10px;
                display: block;
                float: left;
                width: 14px;
                height: 14px;
                line-height: 1;
                margin-top: 8px;
            }

            #maMasterWrap.has-list-results.has-marker-legend .ma-tablet-map-buttons {
                bottom: 68px;
            }

            @media screen and (min-width: 769px) {
                #maMasterWrap.has-list-results.has-marker-legend .ma-tablet-map-buttons {
                    left: 80px;
                    bottom: 16px;
                }

                #searchTopBar {
                    box-shadow: 0 2px 0 #dddbda;
                }

                #maMasterWrap.has-list-results.sidebar-in .ma-tablet-map-buttons {
                    left: 507px;
                    bottom: 16px;
                }

                #maMasterWrap.has-list-results.tooltip-in .ma-tablet-map-buttons {
                    left: 440px;
                    bottom: 16px;
                }
            }

            #closeStreetView {
                right: 15px !important;
                top: 7px !important;
            }

            .ui-state-highlight {
                height: 5em;
                line-height: 1.2em;
                background-color: #dddbda;
            }
        </style>
    </head>

    <apex:outputPanel layout="none" rendered="{!(PendoEnabled == 'true'||TotangoEnabled == 'true')}">
        <script>
            (function(apiKey){
                (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=[];
                v=['initialize','identify','updateOptions','pageLoad'];for(w=0,x=v.length;w<x;++w)(function(m){
                o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
                y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
                z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');

                // Call this whenever information about your visitors becomes available
                // Please use Strings, Numbers, or Bools for value types.
                pendo.initialize({
                visitor: { 
                    id: '{!JSENCODE($User.Id)}',
                    email: '{!JSENCODE($User.Email)}',
                    firstName: '{!JSENCODE($User.FirstName)}',
                    lastName: '{!JSENCODE($User.LastName)}'
                },

                account: { 
                    id: '{!JSENCODE($Organization.Id)}', // Highly recommended
                    name: '{!JSENCODE($Organization.Name)}'
                    // planLevel:    // Optional
                    // planPrice:    // Optional
                    // creationDate: // Optional

                    // You can add any additional account level key-values here,
                    // as long as it's not one of the above reserved names.
                }
                });
            })('3678d139-e89d-4a02-78a2-9822552912f0');
        </script>
    </apex:outputPanel>

<body>

<!-- Controller Communication -->
<apex:form >
    <apex:inputHidden id="serializedDefaultQueries" value="{!serializedDefaultQueries}" />
    <apex:inputHidden id="serializedOptions" value="{!serializedOptions}" />
</apex:form>

<c:MA />

<script>
    var userSettings = {};
    var MARemoting = {
        phase_4 : '{!$RemoteAction.MARemoteFunctions.GetRecords}',
        getShapes : '{!$RemoteAction.MARemoteFunctions.GetShapeInfo}',
        placeSearch : '{!$RemoteAction.MARemoteFunctions.googleAPISearch}',
        geocodeRecord : '{!$RemoteAction.MARemoteFunctions.geoCodeRecord}',
        live_phase_4 : '{!$RemoteAction.MARemoteFunctions.GetLatestPosition}',
        live_history: '{!$RemoteAction.MARemoteFunctions.GetLiveDeviceHistory}',
        getEsriToken : '{!$RemoteAction.MARemoteFunctions.getEsriToken}',
        getEsriRoute : '{!$RemoteAction.MARemoteFunctions.getEsriRoute}',
        getDriveProfile : '{!$RemoteAction.MARemoteFunctions.getCustomDriveProfile}',
        get_service_area: '{!$RemoteAction.MARemoteFunctions.getServiceArea}',
        processAJAXRequest : '{!$RemoteAction.MARemoteFunctions.processAJAXRequest}',
        processAJAXRequestReadOnly : '{!$RemoteAction.MARemoteFunctions.processAJAXRequestReadOnly}',
        MapAnythingIORequest : '{!$RemoteAction.MARemoteFunctions.MapAnythingIORequest}',
        searchMAObjectsForRecords : '{!$RemoteAction.MARemoteFunctions.searchMAObjectsForRecords}',
        validateMABaseObjectTooltips : '{!$RemoteAction.MARemoteFunctions.validateMABaseObjectTooltips}',
        MapAnythingIORequestPOST : '{!$RemoteAction.MARemoteFunctions.MapAnythingIORequestPOST}',
        getRoute: '{!$RemoteAction.MARemoteFunctions.getRoute}',
        getRouteV2: '{!$RemoteAction.MARemoteFunctions.getRouteV2}',
        getCalendarEvents: '{!$RemoteAction.MARemoteFunctions.getCalendarEvents}',
        saveCalendarEvents: '{!$RemoteAction.MARemoteFunctions.saveCalendarEvents}',
        getCalendarResourcesByUserId: '{!$RemoteAction.MARemoteFunctions.getCalendarResourcesByUserId}',
        saveCalendarResources: '{!$RemoteAction.MARemoteFunctions.saveCalendarResources}',
        getShapeGeometry: '{!$RemoteAction.MARemoteFunctions.GetShapeGeometry}',            
        AdminStartUpAction: '{!$RemoteAction.MAAdminAJAXResources.AdminStartUpAction}',
        getLiveConfigs: '{!$RemoteAction.MARemoteFunctions.getLiveConfigs}',
        updateWaypointNote: '{!$RemoteAction.MARemoteFunctions.updateWaypointNote}'
    }
    var pageSuffix = '{!pageSuffix}';
</script>

<div id="ma-vue-root"></div>
<script src="{!resourcePaths['MapAnythingJS']}/JSHelperFunctions.js"></script>


<div id="templates" style="display:none;">

    <!--UpdateFieldPopup rows-->
    <div id="updateFieldPopupRowTemplate">
        <div class="slds-grid slds-grid_vertical-align-center mass-update-row slds-p-vertical_small slds-wrap slds-border_top">
            <div class="slds-col slds-size_5-of-12 slds-form-element slds-p-right_x-small slds-p-bottom_small select2-form-element updatefield-query-wrapper">
                <label class="slds-form-element__label" for="select-query">{!$Label.MA_Marker_Layer}</label>
                <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--right">
                    <span class="slds-input__icon slds-icon-text-default ma-icon ma-icon-down" aria-hidden="true"></span>
                    <div class="slds-select_container">
                        <select class="slds-select updatefield-query select2-fluid select2-input select2-input-hide-search slds-truncate" onchange='UpdateField_QueryChanged(this);' id="select-query"></select>
                    </div>
                </div>
            </div>
            <div class="slds-col slds-size_5-of-12 slds-form-element slds-p-right_x-small slds-p-bottom_small select2-form-element updatefield-field-wrapper" style="display:none;">
                <label class="slds-form-element__label" for="select-field">{!$Label.MA_Field}</label>
                <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--right">
                    <span class="slds-input__icon slds-icon-text-default ma-icon ma-icon-down" aria-hidden="true"></span>
                    <div class="slds-select_container">
                        <select class="slds-select updatefield-field select2-fluid select2-input select2-input-hide-search slds-truncate" id="select-field" onchange='UpdateField_FieldChanged(this);'></select>
                    </div>
                </div>
            </div>
            <div class="slds-col slds-size_2-of-12 slds-p-right_xx-small">
                <button class="slds-button slds-button_icon slds-button_icon-container remove-mass-update-row" title="Close">
                    <span class="slds-button__icon slds-button__icon_hint slds-button__icon_small icon ma-icon-close"></span>
                </button>
            </div>
            <div class="slds-form-element slds-p-right_xx-small updatefield-value-wrapper" style="display:none;">
                <label class="slds-form-element__label" for="input-601">Value</label>

            <div id="input-601" class="slds-form-element__control updatefield-value">

                </div>
            </div>
        </div>
    </div>

    <!-- SVG Marker - Waypoint Start -->
    <svg id="svgMarkerWaypointFirst" xmlns="http://www.w3.org/2000/svg" width="28" height="34.958" viewBox="0 0 28 34.958"><path d="M24,0H4A4,4,0,0,0,0,4V24a4,4,0,0,0,4,4H8.437L14,34.278,19.563,28H24a4,4,0,0,0,4-4V4A4,4,0,0,0,24,0Z" style="fill:#4bca81"/><path d="M24,0H4A4,4,0,0,0,0,4V24a4,4,0,0,0,4,4H8.437L14,34.278,19.563,28H24a4,4,0,0,0,4-4V4A4,4,0,0,0,24,0Zm3,24a3,3,0,0,1-3,3H19.112L14,32.771,8.887,27H4a3,3,0,0,1-3-3V4A3,3,0,0,1,4,1H24a3,3,0,0,1,3,3Z" style="opacity:0.3199999928474426;isolation:isolate"/><path d="M7,6A.945.945,0,0,0,6,7V20.8a1,1,0,0,0,2,0V7A1,1,0,0,0,7,6ZM21.3,7.5C17,9.7,13.7,5.9,9.6,7.4a.446.446,0,0,0-.3.4v7.3c0,.4.4.6.8.5,3.9-1.1,7.2,2.5,11.4.2a.55.55,0,0,0,.3-.5V7.7A.365.365,0,0,0,21.3,7.5Z" style="fill:#fff"/></svg>

    <!-- SVG Marker - Waypoint end/last/destination -->
    <svg id="svgMarkerWaypointLast" xmlns="http://www.w3.org/2000/svg" width="28" height="34.958" viewBox="0 0 28 34.958"><title>waypoint-finish-v2</title><path d="M24,0H4A4,4,0,0,0,0,4V24a4,4,0,0,0,4,4H8.437L14,34.278,19.563,28H24a4,4,0,0,0,4-4V4A4,4,0,0,0,24,0Z" style="fill:#061c3f"/><path d="M24,0H4A4,4,0,0,0,0,4V24a4,4,0,0,0,4,4H8.437L14,34.278,19.563,28H24a4,4,0,0,0,4-4V4A4,4,0,0,0,24,0Zm3,24a3,3,0,0,1-3,3H19.112L14,32.771,8.887,27H4a3,3,0,0,1-3-3V4A3,3,0,0,1,4,1H24a3,3,0,0,1,3,3Z" style="opacity:0.3199999928474426;isolation:isolate"/><path d="M6.983,5.9A.965.965,0,0,0,6,6.883V20.65a.984.984,0,0,0,1.967,0V6.883A.966.966,0,0,0,6.983,5.9ZM21.34,7.375C17.079,9.6,13.7,5.769,9.671,7.244a.563.563,0,0,0-.393.492v7.342a.591.591,0,0,0,.754.524c3.867-1.147,7.211,2.491,11.406.2a.554.554,0,0,0,.3-.459V7.6A.268.268,0,0,0,21.34,7.375Zm-.918,7.441-.164.065a4.319,4.319,0,0,1-1.737.2h-.065V13.439a10.922,10.922,0,0,1-1.967-.23v1.738c-.557-.1-1.082-.2-1.508-.295-.164-.033-.328-.1-.459-.131v-1.8c-.557-.164-1.409-.328-1.966-.459v1.868a4.187,4.187,0,0,0-.918-.1,3.179,3.179,0,0,0-.525.033l-.524.032v-1.9a6.235,6.235,0,0,1,1.147-.065,3.152,3.152,0,0,1,.82.1V10.259a7.918,7.918,0,0,0-1.967.033V8.26l.295-.033a7.345,7.345,0,0,1,1.672.131v1.9c.458.1,1.245.263,1.835.427.033,0,.1.032.131.032v-1.9a15.716,15.716,0,0,0,1.967.459v1.868a13.543,13.543,0,0,0,1.967.164v-1.8h.065a10.394,10.394,0,0,0,1.541-.23l.393-.131v1.967a6.871,6.871,0,0,1-1.836.229h-.131v2.1h.066a4.956,4.956,0,0,0,1.9-.492v1.869Zm-5.9-4.1v1.967a1.917,1.917,0,0,1,.394.131c.491.131,1.016.295,1.573.393V11.177C15.8,11.046,15.112,10.882,14.522,10.718Z" style="fill:#fff"/></svg>

    <!-- SVG Marker - Waypoint combined start/end -->
    <svg id="svgMarkerWaypointCombo" xmlns="http://www.w3.org/2000/svg" width="42" height="34.354" viewBox="0 0 42 34.354"><title>waypoint-finish-and-start-v3</title><path d="M38,0H21V34.278L26.563,28H38a4,4,0,0,0,4-4V4A4,4,0,0,0,38,0Z" style="fill:#061c3f"/><path d="M4,0A4,4,0,0,0,0,4V24a4,4,0,0,0,4,4H15.437L21,34.278V0Z" style="fill:#4bca81"/><g style="opacity:0.32"><path d="M38,1a3,3,0,0,1,3,3V24a3,3,0,0,1-3,3H26.113l-.3.337L21,32.77l-4.815-5.433-.3-.337H4a3,3,0,0,1-3-3V4A3,3,0,0,1,4,1H38m0-1H4A4,4,0,0,0,0,4V24a4,4,0,0,0,4,4H15.437L21,34.278,26.563,28H38a4,4,0,0,0,4-4V4a4,4,0,0,0-4-4Z"/></g><path d="M24.7,6.224a.924.924,0,0,0-1.154.666L21,16.378,18.467,6.919a.943.943,0,1,0-1.821.488L20.061,20.15a.945.945,0,0,0,1.154.667.93.93,0,0,0,.141-.071.919.919,0,0,0,.594-.624L25.364,7.378A.925.925,0,0,0,24.7,6.224Z" style="fill:#fff"/><path d="M30.481,12.554l-.487,1.82a1.789,1.789,0,0,1,.331.219c.423.244.868.526,1.359.755l.5-1.881C31.583,13.174,30.987,12.852,30.481,12.554Z" style="fill:#fff"/><path d="M37.622,11.15c-4.5,1.006-6.671-3.381-10.769-3.016a.54.54,0,0,0-.486.358l-1.822,6.8a.567.567,0,0,0,.568.672c3.865-.1,6.058,4.1,10.511,3.011a.528.528,0,0,0,.386-.351l1.919-7.161A.257.257,0,0,0,37.622,11.15Zm-1.746,3.24a6.618,6.618,0,0,1-1.756-.243L34,14.114l-.52,1.942.061.016a4.745,4.745,0,0,0,1.882.017l-.464,1.729-.03-.008-.168.02a4.127,4.127,0,0,1-1.657-.249l-.061-.016.407-1.517a10.625,10.625,0,0,1-1.764-.7l-.431,1.608c-.491-.229-.952-.45-1.322-.647-.144-.071-.279-.172-.393-.235l.448-1.669c-.476-.29-1.224-.653-1.707-.913l-.464,1.73a3.918,3.918,0,0,0-.825-.319,3.074,3.074,0,0,0-.493-.1L26,14.7l.471-1.76a5.861,5.861,0,0,1,1.079.224,2.981,2.981,0,0,1,.734.294l.488-1.821a7.543,7.543,0,0,0-1.829-.457l.5-1.881.281.042a7.041,7.041,0,0,1,1.515.536l-.471,1.76c.4.205,1.088.552,1.593.85.031.008.083.055.113.063l.472-1.76a15.2,15.2,0,0,0,1.707.913L32.2,13.436a13.15,13.15,0,0,0,1.78.64l.447-1.669.061.016a9.985,9.985,0,0,0,1.483.17l.4-.024Z" style="fill:#fff"/><path d="M15.158,8.163c-4.1-.365-6.272,4.022-10.77,3.016a.257.257,0,0,0-.307.31L6,18.65A.531.531,0,0,0,6.387,19c4.453,1.084,6.645-3.114,10.51-3.011a.568.568,0,0,0,.568-.673l-1.821-6.8A.541.541,0,0,0,15.158,8.163Z" style="fill:#fff"/></svg>

    <button id="closeStreetView" class="ma-button ma-button--red">Close Street View</button>

    <div class="UpdateFieldPopup slds-scope">
        <div class="slds-form slds-form_compound">
            <fieldset class="slds-form-element">
                <div class="slds-form-element__group mass-row-update-group">
                    <div class="slds-grid slds-grid_vertical-align-center mass-update-row slds-p-vertical_small slds-wrap">
                        <div class="slds-col slds-size_5-of-12 slds-form-element slds-p-right_x-small slds-p-bottom_small select2-form-element updatefield-query-wrapper">
                            <label class="slds-form-element__label" for="select-query">{!$Label.MA_Marker_Layer}</label>
                            <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--right">
                                <span class="slds-input__icon slds-icon-text-default ma-icon ma-icon-down" aria-hidden="true"></span>
                                <div class="slds-select_container">
                                    <select class="slds-select updatefield-query select2-fluid select2-input select2-input-hide-search slds-truncate" onchange='UpdateField_QueryChanged(this);' id="select-query"></select>
                                </div>
                            </div> 
                        </div>
                        <div class="slds-col slds-size_5-of-12 slds-form-element slds-p-right_x-small slds-p-bottom_small select2-form-element updatefield-field-wrapper" style="display:none;">
                            <label class="slds-form-element__label" for="select-field">{!$Label.MA_Field}</label>
                            <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon--right">
                                <span class="slds-input__icon slds-icon-text-default ma-icon ma-icon-down" aria-hidden="true"></span>
                                <div class="slds-select_container">
                                    <select class="slds-select updatefield-field select2-fluid select2-input select2-input-hide-search slds-truncate" id="select-field" onchange='UpdateField_FieldChanged(this);'></select>
                                </div>
                            </div>
                        </div>
                        <div class="slds-col slds-size_2-of-12 slds-p-right_xx-small">
                            <button class="slds-button slds-button_icon slds-button_icon-container remove-mass-update-row" title="Remove">
                                <span class="slds-button__icon slds-button__icon_hint slds-button__icon_small icon ma-icon-close"></span>
                                <span class="slds-assistive-text">Remove</span>
                            </button>
                        </div>
                        <div class="slds-form-element slds-p-right_xx-small updatefield-value-wrapper" style="display:none;">
                            <label class="slds-form-element__label" for="input-601">Value</label>
                            <div id="input-601" class="slds-form-element__control updatefield-value">
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>
        <button class="slds-button slds-button_neutral" onclick="UpdateField_AddNewRow();">
            <span class="slds-button__icon slds-button__icon_left ma-icon ma-icon-add add-mass-update"></span>Add Field
        </button>



        <!--<div class="slds-form-element updatefield-value-wrapper" style="display:none;">
            <label class="slds-form-element__label">{!$Label.MA_Value}</label>
            <div class="slds-form-element__control updatefield-value">

            </div>
        </div>-->

        <div class="slds-form-element autoRefreshWrapper" style="display:none;">
            <label class="slds-form-element__label">Automatically refresh this query after completion?</label>
            <input type="checkbox" class="autoRefreshQuery"/>
        </div>
    </div>

    <!-- End Routes -->

    <!-- Data Layer Popup V2 -->
    <div class="CreateRecordDataLayerPopup2">

        <!-- Step 1 -->
        <div class='createrecordDataLayer2-step1 createrecord-step'>
            <h3>Step 1</h3>

            <div class="overflow">
                <div class="ma-form-control-wrap">
                    <label class="ma-input-label">What would you like to create?</label>
                    <div class="ma-form-control has-inset-icon--right">
                        <i class="ma-icon ma-icon-down inset-icon--right"></i>
                        <select class="ma-input createrecordDataLayer2-object" onchange="MAData.createRecordFromDataLayer.object_Change_V2();"></select>
                    </div>
                </div>
                <div class="ma-form-control-wrap">
                    <label class="ma-input-label">Select a record type:</label>
                    <div class="ma-form-control has-inset-icon--right">
                        <i class="ma-icon ma-icon-down inset-icon--right"></i>
                        <select class="ma-input createrecordDataLayer2-recordtype"></select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2 -->
        <div class='createrecordDataLayer2-step2 createrecordDataLayer-step' style="display:none;">
            <h3>Step 2</h3>

            <div>
                <label>Fill in the fields below</label>
                <div class="overflow">
                    <div class='createrecordDataLayer-fieldset'></div>
                </div>
                <ul class='createrecordDataLayer2-fieldset-errors'></ul>
            </div>
        </div>

    </div>

    <!-- Click 2 Create Popup V2-->
    <div class="CreateRecordPopup">

        <!-- Step 1 -->
        <div class='createrecord2-step1 createrecord-step'>
            <h3>Step 1</h3>

            <div class="overflow" style="max-height:400px; overflow: scroll;">
                <div class='createrecord-formitem'>
                    <label>What would you like to create?</label>
                    <select class="createrecord2-object" onchange="c2c.CreateRecord_Object_Change();"></select>
                </div>
                <div class='createrecord-formitem'>
                    <label>Select a record type:</label>
                    <select class='createrecord2-recordtype'></select>
                </div>
            </div>
        </div>

        <!-- Step 2 -->
        <div class='createrecord2-step2 createrecord-step' style="display:none;">
            <h3>Step 2</h3>

            <div>
                <label>Fill in the fields below</label>
                <div class="overflow" style="max-height:400px; overflow: scroll;">
                    <div class='createrecord-fieldset'></div>
                </div>
                <ul class='createrecord2-fieldset-errors'></ul>
            </div>
        </div>

    </div>

    <div id="MAFolderSelectorTemplates">
        <div id="MAFolderSelectorListItemTemplate">
            <li class="ma-folder-list-item" data-folder-id="::folderId::" data-folder-name="::folderName::">
                <div class="ma-folder-item" type="folder">
                    <div class="layer-toggle ma-folder-checkbox">
                        <span class="ma-radio">
                            <input type="radio" name="MAFolder" id="::folderId::" />
                            <label class="ma-toggle-label ma-radio_label" for="::folderId::">
                                <span class="ma-radio_faux"></span>
                            </label>
                        </span>
                    </div>
                    <div class="layer-nest-click-area ma-folder-body">
                        <div class="layer-nest-click-area-inner">
                            <div class="layer-type-icon ftu-icon-left">
                                <div class="ma-icon ma-icon-folder" type="folder"></div>
                            </div>
                            <div class="ma-item-name">
                                <div class="ma-item-name-title">::folderName::</div>
                            </div>
                        </div>
                    </div>
                    <div class="layer-nest-click-area ma-folder-drilldown">
                        <div class="layer-nest-click-area-inner">
                            <div class="layer-action-icon">
                                <div class="ma-icon ma-icon-chevronright"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </div>

        <div id="MAFolderBreadCrumbItemTemplate">
            <li class="ma-breadcrumb-item ma-folder-breadcrumb" data-folder-id="::folderId::" data-folder-name="::folderName::">
                <a><span>::folderName::</span></a>
            </li>
        </div>
    </div>

    <div class="legend-section-item template">
        <div data-sectionid="::sectionID::" class="legend-item empty legend-row-header ma-form-control-wrap ma-checkbox-wrap flex-horizontal">
            <div class="flex-grow-1">
                <label class="ma-checkbox">
                <input onchange="MAPlotting.mobile.toggleLegendHeaderRow(this);" id="::legendCheckboxId::" data-rule="::dataRule::" checked="checked" name="checkbox" class="legend-checkbox" type="checkbox"/>
                <span class="ma-checkbox-faux"></span>
                <span class="ma-checkbox-label">::Label::</span>
                </label>
            </div>
            <div class="legend-count">
                <span class="visiblemarkers">0</span>
                <span class="of">{!$Label.MA_of}</span>
                <span class="totalmarkers">0</span>
            </div>
            <div class="legend-marker">::Marker::</div>
        </div>
    </div>

    <div class="legend-item template" >
        <div data-id='lid::dataRule::' uid="::dataRule::" class="::isAuto:: ::OTHER:: legend-item empty legend-row ma-form-control-wrap ma-checkbox-wrap flex-horizontal">
            <div class="flex-grow-1">
                <label class="ma-checkbox">
                <input onchange="MAPlotting.mobile.toggleRow(this);" id="::legendCheckboxId::" data-rule="::dataRule::" uid="::dataRule::" data-type="::type::" checked="checked" name="checkbox" class="legend-checkbox" type="checkbox"/>
                <span class="ma-checkbox-faux"></span>
                <span class="ma-checkbox-label">::Label::</span>
                </label>
            </div>
            <div class="legend-count">
                <span class="visiblemarkers">0</span>
                <span class="of">{!$Label.MA_of}</span>
                <span class="totalmarkers">0</span>
            </div>
            <div class="legend-marker">::Marker::</div>
        </div>
    </div>

    <div class="legend-item-ArcGISLayer template" >
        <div data-id='lid::dataRule::' uid="::dataRule::" class="::isAuto:: ::OTHER:: legend-item legend-row ma-form-control-wrap ma-checkbox-wrap flex-horizontal">
            <div class="flex-grow-1">
                <label class="ma-checkbox">
                <input onchange="ArcGIS.layerLegendHelpers.onClickSublayerLengendCheckbox(this, '::layerId::', '::sublayerId::');" id="::legendCheckboxId::" data-rule="::dataRule::" uid="::dataRule::" data-type="::type::" checked="checked" name="checkbox" class="legend-checkbox" type="checkbox"/>
                <span class="ma-checkbox-faux"></span>
                <span class="ma-checkbox-label">::Label::</span>
                </label>
            </div>
            <div class="legend-marker">::Marker::</div>
        </div>
    </div>

    <svg class='svg-circle-num' width="20" height="20" xmlns="http://www.w3.org/2000/svg">
        <g>
            <circle fill="#28a2ff" stroke="#f9f9f9" stroke-width="2" cx="10" cy="10" r="8.83163" id="svg_1"/>
            <text fill="#f9f9f9" stroke="#f9f9f9" stroke-width="0" x="8.3" y="10" id="svg_2" font-size="18" font-family="Monospace" text-anchor="middle" xml:space="preserve" transform="matrix(0.7992677323256553,0,0,0.6748139102469572,3.3995968056728256,7.2131973728906305) ">__TEXT__</text>
        </g>
    </svg>

    <div class="dynamicFilterPopup template">
        <div class="pad-16-16-32">
            <p class="lead">{!$Label.MA_Dynamic_Info_Layer}</p>
            <div class='form-stretch filter-wrapper'></div>
        </div>
    </div>

    <div class="queryFilter template">
        <div class="filter-row ma-form-control-wrap" data-parentfield="::parentfield::" data-fieldapiname="::fieldapiname::" data-fieldlabel="::fieldlabel::" data-operator="::operator::">
            <label class="ma-input-label"><strong>Field:</strong> ::FIELD::</label>
            <input class="ma-input fieldInput ::RowUID::" id="accountPlotDynamicField" placeholder="{!$Label.MA_Value}..." type="text"/>
            <div class="slds-p-top--xx-small filter-item-pills" style=""></div>
        </div>
    </div>

    <!-- ArcGIS tooltip table -->
    <table class="tooltip-table">
        <tbody class="tooltip-bodyrows">
        </tbody>
    </table>
    <table>
    <tr class="tooltip-rowTemplate">
        <td><span class="tooltip-label"></span></td>
        <td class="tooltip-value"></td>
    </tr>
    </table>
    <!-- End of ArcGIS tooltip table -->

    <!-- ArcGIS ServerLogin Template -->
    <div class="slds-form slds-form_stacked arcgis-server-login">
        <div class="slds-form-element">
        <label class="slds-form-element__label " for="input-id-01">Username</label>
        <div class="slds-form-element__control">
            <input type="text" id="input-id-user" class="slds-input arc-server-username" placeholder="Username" />
        </div>
        </div>
        <div class="slds-form-element">
        <label class="slds-form-element__label " for="input-id-01">Password</label>
        <div class="slds-form-element__control">
            <input type="password" id="input-id-password" class="slds-input arc-server-password" placeholder="Password" />
        </div>
        </div>
    </div>
    <!-- End of ArcGIS ServerLogin Template -->
</div>
<script type='text/javascript' src="{!URLFOR($Resource.MapAnything, 'js/google/markerclustererplus/markerclusterer.js')}"></script>

<script async="true" defer="true" type='text/javascript'>
    //markerclusterer doesn't support a rightclick event on clusters.  adding it
    ClusterIcon.prototype.onAdd = function () {
        var cClusterIcon = this;
        var cMouseDownInCluster;
        var cDraggingMapByCluster;
        this.div_ = document.createElement("div");
        this.div_.className = this.className_;
        if (this.visible_) {
            this.show();
        }

        this.getPanes().overlayMouseTarget.appendChild(this.div_);

        // Fix for Issue 157
        this.boundsChangedListener_ = google.maps.event.addListener(this.getMap(), "bounds_changed", function () {
            cDraggingMapByCluster = cMouseDownInCluster;
        });

        google.maps.event.addDomListener(this.div_, "mousedown", function () {
            cMouseDownInCluster = true;
            cDraggingMapByCluster = false;
        });

        google.maps.event.addDomListener(this.div_, "click", function (e) {
            cMouseDownInCluster = false;
            if (!cDraggingMapByCluster) {
                var theBounds;
                var mz;
                var mc = cClusterIcon.cluster_.getMarkerClusterer();
                /**
                * This event is fired when a cluster marker is clicked.
                * @name MarkerClusterer#click
                * @param {Cluster} c The cluster that was clicked.
                * @event
                */
                google.maps.event.trigger(mc, "click", cClusterIcon.cluster_);
                google.maps.event.trigger(mc, "clusterclick", cClusterIcon.cluster_); // deprecated name

                // The default click handler follows. Disable it by setting
                // the zoomOnClick property to false.
                if (mc.getZoomOnClick()) {
                    // Zoom into the cluster.
                    mz = mc.getMaxZoom();
                    theBounds = cClusterIcon.cluster_.getBounds();
                    mc.getMap().fitBounds(theBounds);
                    // There is a fix for Issue 170 here:
                    setTimeout(function () {
                        mc.getMap().fitBounds(theBounds);
                        // Don't zoom beyond the max zoom level
                        if (mz !== null && (mc.getMap().getZoom() > mz)) {
                            mc.getMap().setZoom(mz + 1);
                        }
                    }, 100);
                }

                // Prevent event propagation to the map:
                e.cancelBubble = true;
                if (e.stopPropagation) {
                    e.stopPropagation();
                }
            }
        });

        //adding rightclick event handling - DK 11/25/14
        google.maps.event.addDomListener(this.div_, "contextmenu", function (e)
        {
            //trigger rightclick event
            google.maps.event.trigger(cClusterIcon.cluster_.getMarkerClusterer(), "rightclick", cClusterIcon.cluster_);

            // Prevent event propagation to the map:
            e.cancelBubble = true;
            if (e.stopPropagation) { e.stopPropagation(); }
            if (e.preventDefault) { e.preventDefault(); }
        });

        google.maps.event.addDomListener(this.div_, "mouseover", function () {
            var mc = cClusterIcon.cluster_.getMarkerClusterer();
            /**
            * This event is fired when the mouse moves over a cluster marker.
            * @name MarkerClusterer#mouseover
            * @param {Cluster} c The cluster that the mouse moved over.
            * @event
            */
            google.maps.event.trigger(mc, "mouseover", cClusterIcon.cluster_);
        });

        google.maps.event.addDomListener(this.div_, "mouseout", function () {
            var mc = cClusterIcon.cluster_.getMarkerClusterer();
            /**
            * This event is fired when the mouse moves out of a cluster marker.
            * @name MarkerClusterer#mouseout
            * @param {Cluster} c The cluster that the mouse moved out of.
            * @event
            */
            google.maps.event.trigger(mc, "mouseout", cClusterIcon.cluster_);
        });
    };

</script>

<script type='text/javascript' src="{!URLFOR($Resource.MAPhone, '/s1Mobile/js/vendor/jquery-ui-1.11.4.min.js')}"></script>
<script async="true" defer="true" type='text/javascript' src="{!URLFOR($Resource.MapAnything, 'js/select2/select2.full.min.js')}"></script>

<script src="{!URLFOR($Resource.MapAnything, 'js/moment.js')}" type="text/javascript"></script>
<script src="{!URLFOR($Resource.MapAnything, 'js/moment_tz.js')}" type="text/javascript"></script>
<script async="true" defer="true" type="text/javascript" src="{!URLFOR($Resource.MapAnything, 'toastr/toastr.min.js')}"></script>
<link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.MapAnything, 'toastr/toastr.min.css')}"></link>
<script src="{!resourcePaths['MapAnythingJS']}/JSActionFramework.js"></script>
<script async="true" defer="true" type='text/javascript' src="{!URLFOR($Resource.MapAnythingJS, 'MAShapeProcess.js')}"></script>

<script type='text/javascript' src="{!URLFOR($Resource.MAPhone, '/s1Mobile/js/vendor/fastclick.min.js')}"></script>
<!-- jsColor -->
<script type='text/javascript' src="{!URLFOR($Resource.MapAnything, 'jscolor/jscolor.js')}"></script>
<script type='text/javascript' src="{!resourcePaths['MapAnythingJS']}/MARecordProcessJS.js"></script>
<script type='text/javascript' src="{!resourcePaths['MapAnythingJS']}/MapAnythingPlottingJS.js"></script>
<script type='text/javascript' src="{!resourcePaths['MapAnythingJS']}/MATerritoryBuilder.js"></script>
<link type="text/css" rel="stylesheet" href="{!resourcePaths['MAPhone']}/dist/styles.css" />
<script async="true" defer="true" src="{!resourcePaths['MAPhone']}/dist/bundle.js"/>
<script async="true" defer="true" src="{!resourcePaths['MapAnythingJS']}/MATabletJS.js"></script>
<script type='text/javascript' src="{!URLFOR($Resource.MapAnything, 'js/google/cryptojs/core-min.js')}"></script>
<script>
    //lazy load our javascript files
    function asyncLoadScript(url) {
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = url;
        var x = document.getElementsByTagName('head')[0];
        x.appendChild(s);
    }

    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/googleExtensions/ShapeManager.js");
    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/googleExtensions/ruler.js");
    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/googleExtensions/drawPolygon.js");
    asyncLoadScript("{!URLFOR($Resource.MapAnything, 'jquery/jquery.ui.touch-punch.min.js')}");
    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/MADemographicLayer.js");
    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/MADemographicsJS.js");
    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/MATerritoryLayer.js");
    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/MARecordProcessJS.js");
    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/MAMarkerBuilder.js");
    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/MACheckIn.js");
    var MAListView = {
        MergeSortAsc: function(array) {
            var len = array.length;

            if(len < 2) 
            { 
                return array;
            }
            else
            {
                var pivot = Math.ceil(len/2);
                return MAListView.MergeAsc(MAListView.MergeSortAsc(array.slice(0,pivot)), MAListView.MergeSortAsc(array.slice(pivot)));
            }
        },

        // Does a merge sort in descending fashion
        MergeSortDesc: function(array) {
            var len = array.length;

            if(len < 2) 
            { 
                return array;
            }
            else
            {
                var pivot = Math.ceil(len/2);
                return MAListView.MergeDesc(MAListView.MergeSortDesc(array.slice(0,pivot)), MAListView.MergeSortDesc(array.slice(pivot)));
            }
        },

        // Merges two objects in ascending fashion
        MergeAsc: function(left, right) {
            var result = [];

            while((left.length > 0) && (right.length > 0))
            {
                if(left[0].sortBy <= right[0].sortBy && left[0].sortBy !== '' && left[0].sortBy !== null && left[0].sortBy !== undefined) {
                    result.push(left.shift());
                }
                else if(right[0].sortBy === '' || right[0].sortBy === null || right[0].sortBy === undefined) {
                    result.push(left.shift());
                }
                else {
                    result.push(right.shift());
                }
            }

            result = result.concat(left, right);
            return result;
        },

        // Merges two objects in descending fashion
        MergeDesc: function(left, right) {
            var result = [];

            while((left.length > 0) && (right.length > 0))
            {
                if(left[0].sortBy >= right[0].sortBy && left[0].sortBy !== '' && left[0].sortBy !== null && left[0].sortBy !== undefined) {
                    result.push(left.shift());
                }
                else if(right[0].sortBy === '' || right[0].sortBy === null || right[0].sortBy === undefined) {
                    result.push(left.shift());
                }
                else {
                    result.push(right.shift());
                }
            }

            result = result.concat(left, right);
            return result;
        }
    };
    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/MAFavoriteLocation.js");
    asyncLoadScript("{!resourcePaths['MapAnythingJS']}/utils.js");
    asyncLoadScript("{!resourcePaths['MapAnything']}/js/google/geoxml3/ZipFile.complete.js");
    asyncLoadScript("{!resourcePaths['MapAnything']}/js/google/geoxml3/ProjectedOverlay.js");
    asyncLoadScript("{!resourcePaths['MapAnything']}/js/google/geoxml3/geoxml3.js");
    asyncLoadScript("{!URLFOR($Resource.MapAnything, 'js/google/cryptojs/enc-utf16-min.js')}");
    asyncLoadScript("{!URLFOR($Resource.MapAnything, 'js/google/cryptojs/enc-base64-min.js')}");
    asyncLoadScript("{!URLFOR($Resource.MapAnything, 'js/proj4.js')}");
    asyncLoadScript("{!URLFOR($Resource.MapAnything, 'js/proj4.defs.js')}");
</script>

<!-- If Arc License, Load Scripts -->
<apex:outputPanel rendered="{!isMAArcGISEnabled}">
    <script type='text/javascript' src="{!resourcePaths['MapAnythingJS']}/ArcGIS.js"></script>
    <script>
        asyncLoadScript("{!resourcePaths['MapAnythingJS']}/ArcGIS.plotHelpers.js");
        asyncLoadScript("{!resourcePaths['MapAnythingJS']}/ArcGIS.tokenHelpers.js");
        asyncLoadScript("{!resourcePaths['MapAnythingJS']}/ArcGIS.featureLayerHelpers.js");
        asyncLoadScript("{!resourcePaths['MapAnythingJS']}/ArcGIS.projectionHelpers.js");
        asyncLoadScript("{!resourcePaths['MapAnythingJS']}/ArcGIS.styleHelpers.js");
        asyncLoadScript("{!resourcePaths['MapAnythingJS']}/ArcGIS.layerLegendHelpers.js");
        asyncLoadScript("{!resourcePaths['MapAnythingJS']}/ArcGIS.click2CreateHelpers.js");
        asyncLoadScript("{!resourcePaths['MapAnythingJS']}/ArcGIS.Arcade.js");
    </script> 
</apex:outputPanel>

<!-- Dynamic Component Overrides -->
<apex:repeat value="{!overrideComponentStrings}" var="c">
    <apex:outputText escape="false" value="{!c}" />
</apex:repeat>

</body>

<script>

function showChatterTabFullScreen() {
    $('#markerTooltipWrap').addClass('full-tooltip-body-in');
    $('#chatterFullScreenItems').show();
}

function hideChatterTabFullScreen() {
    $('#markerTooltipWrap').removeClass('full-tooltip-body-in');
    $('#chatterFullScreenItems').hide();
}

    // close currently open slds modal
    $(document).on('click', '.js-close-this-slds-modal', function() {
        //$('#sldsModalBackDrop').removeClass('slds-backdrop--open');
        //$(this).closest('.slds-modal').removeClass('slds-fade-in-open');
        closeThisSLDSModal(this);
    });

    function closeThisSLDSModal(theModal){
         $('.slds-backdrop').removeClass('slds-backdrop_open');
         $(theModal).closest('.slds-modal').removeClass('slds-fade-in-open');
    }

</script>

</apex:page>